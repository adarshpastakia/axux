"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[47859],{"./node_modules/@arcgis/core/geometry/support/scaleUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X_:()=>i,i1:()=>o,zx:()=>d});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js");const r=96;function i(t,i){const o=i||t.extent,u=t.width,c=(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.GA)(o?.spatialReference);return o&&u?o.width/u*c*_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.dy*r:0}function o(t,i){return t/((0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.GA)(i)*_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.dy*r)}function d(t,n,e){return function a(n,e){return 0===e||(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Sp)(n,e)||n<e}(t,n)&&function p(n,e){return 0===e||(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Sp)(n,e)||n>e}(t,e)}},"./node_modules/@arcgis/core/layers/effects/EffectView.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$B:()=>a});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_lang_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_parser_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/parser.js"),_utils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/utils.js");const l=-1;let a=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,_core_has_js__WEBPACK_IMPORTED_MODULE_2__.A)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(h(t))}catch(e){this._transitionTo([]),_core_Logger_js__WEBPACK_IMPORTED_MODULE_4__.A.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&u(this._current,h(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&u(this._current,t,this.scale)?(this._final=t,this._to=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.o8)(t),function _(t,e,s){const r=t.length>e.length?t:e,i=t.length>e.length?e:t,n=i[i.length-1],c=n?.scale??s,o=n?.effects??[];for(let f=i.length;f<r.length;f++)i.push({scale:c,effects:[...o]});for(let a=0;a<r.length;a++)i[a].scale=i[a].scale===l?s:i[a].scale,r[a].scale=r[a].scale===l?s:r[a].scale,(0,_utils_js__WEBPACK_IMPORTED_MODULE_9__.O9)(i[a].effects,r[a].effects)}(this._current,this._to,this.scale),this._from=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.o8)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],r=this._from[s],i=this._to[s];t.scale=p(r.scale,i.scale,e);for(let s=0;s<t.effects.length;s++){const n=t.effects[s],c=r.effects[s],o=i.effects[s];n.interpolate(c,o,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let r,i,n=1;if(1===e.length||t>=e[0].scale)i=r=e[0].effects;else if(t<=e[s].scale)i=r=e[s].effects;else for(let c=0;c<s;c++){const s=e[c],o=e[c+1];if(s.scale>=t&&o.scale<=t){n=(t-s.scale)/(o.scale-s.scale),r=s.effects,i=o.effects;break}}for(let c=0;c<this.effects.length;c++)this.effects[c].interpolate(r[c],i[c],n)}};function h(t){const e=(0,_parser_js__WEBPACK_IMPORTED_MODULE_8__.q)(t)||[];return function m(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:l,effects:e}]:e}function u(t,e,s){return!t[0]?.effects||!e[0]?.effects||!((t[0]?.scale===l||e[0]?.scale===l)&&(t.length>1||e.length>1)&&s<=0)&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_9__.mj)(t[0].effects,e[0].effects)}function p(t,e,s){return t+(e-t)*s}(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)()],a.prototype,"_to",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)()],a.prototype,"duration",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)({value:""})],a.prototype,"effect",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)({readOnly:!0})],a.prototype,"effects",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)({readOnly:!0})],a.prototype,"hasEffects",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)({value:0})],a.prototype,"scale",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.MZ)({readOnly:!0})],a.prototype,"transitioning",null),a=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.$)("esri.layers.effects.EffectView")],a)},"./node_modules/@arcgis/core/layers/support/ExportImageParameters.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>m});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_sql_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_support_scaleUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/scaleUtils.js"),_commonProperties_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");const y={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let m=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_10__.f)(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_9__.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(y[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const t=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_10__.f)(this.floors,r),i=(0,_core_sql_js__WEBPACK_IMPORTED_MODULE_11__.m)(t,r.definitionExpression);return null!=i&&(e[r.id]=i),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=this.scale,t=r=>{r.visible&&(0===s||(0,_geometry_support_scaleUtils_js__WEBPACK_IMPORTED_MODULE_7__.zx)(s,r.minScale,r.maxScale))&&(r.sublayers?r.sublayers.forEach(t):e.unshift(r))};r&&r.forEach(t);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((r,s)=>e[s]!==r))?e:i}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"dynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"floors",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"hasDynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)()],m.prototype,"layer",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"layers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"layerDefs",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({type:Number})],m.prototype,"scale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)(_commonProperties_js__WEBPACK_IMPORTED_MODULE_8__.ui)],m.prototype,"timeExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"version",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.MZ)({readOnly:!0})],m.prototype,"visibleSublayers",null),m=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.$)("esri.layers.mixins.ExportImageParameters")],m)},"./node_modules/@arcgis/core/layers/support/rasterFormats/pixelRangeUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>u,h:()=>s});const e=9999999e31,t=2e-7,n={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function s(e){return n[e]??[-34028234663852886e22,34028234663852886e22]}function u(n,u,a){if(n.depthCount&&n.depthCount>1)return;const{pixels:i,statistics:l,pixelType:o}=n,c=i[0].length,r=n.bandMasks??[],f=n.mask??new Uint8Array(c).fill(255),b="f32"===o||"f64"===o,m=s(o);let d=!1;for(let s=0;s<i.length;s++){const n="number"==typeof u?u:u[s];if(null==n)continue;const c=l?.[s]?.minValue??m[0],h=l?.[s]?.maxValue??m[1];if(c>n+Number.EPSILON||h<n-Number.EPSILON)continue;const p=r[s]||f.slice(),M=i[s],N=a?.customFloatTolerance;if(b&&0!==N){let s=N;s||(s=Math.abs(n)>=e?t*Math.abs(n):"f32"===o?2**-23:Number.EPSILON);for(let e=0;e<M.length;e++)p[e]&&Math.abs(M[e]-n)<s&&(M[e]=0,p[e]=0,f[e]=0,d=!0)}else for(let e=0;e<M.length;e++)p[e]&&M[e]===n&&(M[e]=0,p[e]=0,f[e]=0,d=!0);r[s]=p}d&&(n.bandMasks=n.bandMasks||n.pixels.length>1?r:null,n.mask=f),d&&"updateStatistics"in n&&n.updateStatistics()}},"./node_modules/@arcgis/core/layers/support/sublayerUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Sk:()=>n,Zx:()=>e,_X:()=>o});var _core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js");function e(r,e,n){const o=e.flatten((({sublayers:r})=>r)).length;return o!==r.length||(!!r.some((r=>r.originIdOf("minScale")>n||r.originIdOf("maxScale")>n||r.originIdOf("renderer")>n||r.originIdOf("labelingInfo")>n||r.originIdOf("opacity")>n||r.originIdOf("labelsVisible")>n||r.originIdOf("source")>n))||!i(r,e))}function n(e,n,o){return!!e.some((e=>{const n=e.source;return!(!n||"map-layer"===n.type&&n.mapLayerId===e.id&&(null==n.gdbVersion||n.gdbVersion===o))||e.originIdOf("renderer")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.Gr.SERVICE||e.originIdOf("labelingInfo")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.Gr.SERVICE||e.originIdOf("opacity")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.Gr.SERVICE||e.originIdOf("labelsVisible")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.Gr.SERVICE}))||!i(e,n)}function i(r,e){if(!r?.length||null==e)return!0;const n=e.slice().reverse().flatten((({sublayers:r})=>r&&r.toArray().reverse())).map((r=>r.id)).toArray();if(r.length>n.length)return!1;let i=0;const o=n.length;for(const{id:t}of r){for(;i<o&&n[i]!==t;)i++;if(i>=o)return!1}return!0}function o(r){return!!r&&r.some((r=>null!=r.minScale||null!=r.layerDefinition?.minScale))}},"./node_modules/@arcgis/core/renderers/support/rendererConversion.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>s,l:()=>t});var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js")),_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/symbolConversion.js");function t(r){return null==r||"simple"===r.type||"unique-value"===r.type||"class-breaks"===r.type||"dictionary"===r.type||"heatmap"===r.type}function s(r,n){if(null==r)return null;if(!t(r))return new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.A("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${r.type||r.declaredClass}'`,{renderer:r});switch(r.type){case"simple":return function u(r){return l(r,(0,_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.t)(r.symbol).error)}(r);case"unique-value":return function i(e,t){const s={..._symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.c,...t},u=e.uniqueValueInfos?.map((r=>(0,_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.t)(r.symbol,s).error)).filter(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ru),i=(0,_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.t)(e.defaultSymbol,s);return i.error&&u?.unshift(i.error),l(e,u)}(r,n);case"class-breaks":return function a(e){const o=e.classBreakInfos.map((r=>(0,_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.t)(r.symbol).error)).filter(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ru),t=(0,_symbols_support_symbolConversion_js__WEBPACK_IMPORTED_MODULE_3__.t)(e.defaultSymbol);return t.error&&o.unshift(t.error),l(e,o)}(r);case"dictionary":case"heatmap":return null}return null}function l(r,n){if(!n)return null;let o;if(o=Array.isArray(n)?n:[n],o.length>0){const n=o.map((r=>r.details.symbol.type||r.details.symbol.declaredClass)).filter((r=>!!r));n.sort();const t=[];return n.forEach(((r,e)=>{0!==e&&r===n[e-1]||t.push(r)})),new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.A("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${t.join(", ")}) which are not supported in 3D`,{renderer:r,symbolErrors:o})}return null}},"./node_modules/@arcgis/core/widgets/Legend.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>Legend_L});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),cast=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/cast.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),Widget=__webpack_require__("./node_modules/@arcgis/core/widgets/Widget.js"),Accessor=(__webpack_require__("./node_modules/@arcgis/core/intl.js"),__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js")),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),get=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/get.js")),Color=__webpack_require__("./node_modules/@arcgis/core/Color.js"),kernel=__webpack_require__("./node_modules/@arcgis/core/kernel.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),symbols=__webpack_require__("./node_modules/@arcgis/core/symbols.js"),jsonMap=__webpack_require__("./node_modules/@arcgis/core/core/jsonMap.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),timeUtils=__webpack_require__("./node_modules/@arcgis/core/core/timeUtils.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),PropertyOrigin=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js"),EffectView=__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/layers/effects/jsonUtils.js"),ExportImageParameters=__webpack_require__("./node_modules/@arcgis/core/layers/support/ExportImageParameters.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),layerUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/layerUtils.js"),pixelRangeUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/rasterFormats/pixelRangeUtils.js"),support_jsonUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/jsonUtils.js"),rendererConversion=__webpack_require__("./node_modules/@arcgis/core/renderers/support/rendererConversion.js"),SizeVariableLegendOptions=__webpack_require__("./node_modules/@arcgis/core/renderers/visualVariables/support/SizeVariableLegendOptions.js"),utils=__webpack_require__("./node_modules/@arcgis/core/smartMapping/support/utils.js"),cimSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/cimSymbolUtils.js"),previewUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/previewUtils.js"),renderUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/renderUtils.js"),symbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/symbolUtils.js"),support_utils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/utils.js"),SizeVariable=__webpack_require__("./node_modules/@arcgis/core/renderers/visualVariables/SizeVariable.js");function a(a,i){if(!a||!("visualVariables"in a)||!a.visualVariables)return null;const s=a.visualVariables.find((e=>"size"===e.type)),n=((e,l)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return l?.levels?l.levels[a]:null})(i,s);return n?new SizeVariable.A({field:s.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}var colorRampUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/colorRampUtils.js"),heatmapRampUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/heatmapRampUtils.js"),relationshipRampUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/relationshipRampUtils.js"),numberUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/numberUtils.js"),Legend_support_utils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/utils.js"),widgetUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/support/widgetUtils.js"),themeUtils=__webpack_require__("./node_modules/@arcgis/core/support/themeUtils.js"),SimpleMarkerSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleMarkerSymbol.js"),SimpleLineSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleLineSymbol.js");const p=30,y=12,b=[255,255,255],h=[200,200,200],d=[128,128,128],w=20,g=5;async function k(e,l,n,i,o,a,u){const c=l.legendOptions,m=c?.customValues,f=u||await U(e,n),p=l.stops,y=!!f,b=!!m,h=null!=l.minSize&&null!=l.maxSize,d=p&&p.length>1,w=!!l.target;if(!y||!b&&!(h||d&&!w))return;const g=(0,support_utils.$d)(f);let S=!1,v=null,z=null;v=g&&!d?(0,numberUtils.LI)([l.minDataValue,l.maxDataValue]):m??await D(l,f,i,o?.type);const j=e?.authoringInfo,k="univariate-color-size"===j?.type,C=k&&"above-and-below"===j?.univariateTheme;if(!v&&d&&(v=p.map((e=>e.value)),S=p.some((e=>!!e.label)),"flow"===e.type&&(v=(0,numberUtils.LI)(v)),S&&(z=p.map((e=>e.label)))),g&&null!=v&&v?.length>2&&!C&&(v=[v[0],v[v.length-1]]),!v)return null;k&&5!==v?.length&&(v=E({minSize:v[0],maxSize:v[v.length-1]}));const I=g?x(e,v):null,M=(0,support_utils.k_)(f),T=S?null:function V(e,l){const t=e.length-1;return e.map(((e,n)=>(0,Legend_support_utils.Dd)(e,n,t,l)))}(v,a);return(await Promise.all(v.map((async(t,n)=>{const s=g?I[n]:await B(l,f,t,i,o?.type);return{value:t,symbol:P(C&&"class-breaks"===e.type?L(e,n):f,s),label:S?z[n]:T[n],size:s,outlineSize:M}})))).reverse()}function x(e,l){const t=e?.authoringInfo,n="univariate-color-size"===t?.type;let i=[y,p];if(n){const e=l[0],t=l[l.length-1],n=y,o=p;i=l.map((l=>n+(l-e)/(t-e)*(o-n)))}return n&&"below"===t?.univariateTheme&&i.reverse(),i}function L(e,l){const t=e.classBreakInfos,n=t.length,i=n<2||!(l>=2)?t[0].symbol.clone():t[n-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(i.type.includes("3d")?I(i):M(i)),i}async function U(e,l){if("flow"===e.type)return(0,Legend_support_utils.Zo)(e,l);if("pie-chart"===e.type)return new SimpleMarkerSymbol.A({color:null,outline:e.outline?.width?e.outline:new SimpleLineSymbol.A});let t=null,n=null;if("simple"===e.type)t=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;t=l&&l[0]&&l[0].symbol,n=l.length>1}else if("unique-value"===e.type){const l=e.uniqueValueInfos;t=l?.[0]?.symbol,n=null!=l&&l.length>1}return!t||function C(e){if(e)return(0,symbols.wk)(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):e.type.includes("fill");return!1}(t)?null:(t=t.clone(),(l||n)&&(t.type.includes("3d")?I(t):M(t)),t)}function I(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:d}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource?.href?e.material={color:h}:(e.material={color:b},e.outline={color:d,size:1.5})}))}function M(l){const t=(0,themeUtils.g4)();if("cim"===l.type)(0,cimSymbolUtils.Fe)(l,new Color.A(h));else if(l.type.includes("line"))l.color=d;else if(l.color=t?d:b,"simple-marker"===l.type)if(l.outline){const e=l.outline?.color?.toHex();"#ffffff"===e&&(l.outline.color=d)}else l.outline={color:d,width:1.5}}async function D(e,l,n,i){const o=(await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"))).getSizeRangeAtScale(e,n,i),s=o&&E(o);if(!o||!s)return;let r=s.map((l=>function T(e,l,t){const n=t.minSize,i=t.maxSize,o=l.minDataValue,s=l.maxDataValue;let r;r=e<=n?o:e>=i?s:(e-n)/(i-n)*(s-o)+o;return r}(l,e,o)));r=(0,numberUtils.LI)(r);for(let t=1;t<r.length-1;t++){const o=await q(e,l,r[t],r[t-1],n,i);o&&(r[t]=o[0],s[t]=o[1])}return r}function E(e){const l=e.minSize,t=e.maxSize,n=g,i=(t-l)/(n-1),o=[];for(let s=0;s<n;s++)o.push(l+i*s);return o}async function q(e,l,o,s,r,a){const u=await B(e,l,o,r,a),c=await B(e,l,s,r,a),m=(0,numberUtils.lc)(o),f=m.fractional,p=w;let y=m.integer,b=null,h=null;o>0&&o<1&&(b=10**f,y=(0,numberUtils.lc)(o*=b).integer);for(let n=y-1;n>=0;n--){const s=10**n;let m=Math.floor(o/s)*s,f=Math.ceil(o/s)*s;null!=b&&(m/=b,f/=b);let y=(m+f)/2;[,y]=(0,numberUtils.LI)([m,y,f],{indexes:[1]});const d=await B(e,l,m,r,a),w=await B(e,l,f,r,a),g=await B(e,l,y,r,a),S=(0,numberUtils.u5)(u,d,c,null),v=(0,numberUtils.u5)(u,w,c,null),z=(0,numberUtils.u5)(u,g,c,null);let j=S.previous<=p,V=v.previous<=p;if(j&&V&&(S.previous<=v.previous?(j=!0,V=!1):(V=!0,j=!1)),j?h=[m,d]:V?h=[f,w]:z.previous<=p&&(h=[y,g]),h)break}return h}async function B(e,l,t,n,i){const{getSize:o}=await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"));return o(e,t,{scale:n,view:i,shape:"simple-marker"===l.type?l.style:null})}function P(e,t){const n=e.clone();if((0,symbols.wk)(n))(0,support_utils.$d)(n)||n.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function S(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(n))n.size=t;else if(function v(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(n)){const e=n.width,l=n.height;n.height=t,n.width=t*(e/l)}else!function z(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(n)?function j(e){return"esri.symbols.TextSymbol"===e.declaredClass}(n)&&n.font&&(n.font.size=t):n.width=t;return n}__webpack_require__("./node_modules/@arcgis/core/intl/date.js");var number=__webpack_require__("./node_modules/@arcgis/core/intl/number.js");__webpack_require__("./node_modules/@arcgis/core/renderers/support/utils.js");var SimpleFillSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleFillSymbol.js"),messages=__webpack_require__("./node_modules/@arcgis/core/intl/messages.js"),substitute=__webpack_require__("./node_modules/@arcgis/core/intl/substitute.js");const ce=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,de=new jsonMap.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ye=new SimpleMarkerSymbol.A({size:6,outline:{color:[128,128,128,.5],width:.5}}),he=new SimpleFillSymbol.A({style:"solid"});function me(e){return"flow"===e.type}function fe(e){return"vector-field"===e.type}function pe(e){return"raster-colormap"===e.type}function ge(e){return"raster-stretch"===e.type}function be(e){return"raster-shaded-relief"===e.type}function Se(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function _e(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function we(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function ve(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Ce(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Ie(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Re(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Fe(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Ve(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function De(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function Pe(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Ae(e){return"esri.layers.TileLayer"===e.declaredClass}function Me(e){return"esri.layers.ImageryLayer"===e.declaredClass}function Ue(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function He(e){return"sublayers"in e}async function $e(e,t){const s=await(0,messages.ud)("esri/widgets/Legend/t9n/Legend");return"previewTemplateAriaLabel"!==e||t||(e="previewAriaLabel"),(0,substitute.V)(s[e],{label:t})}const We=new SimpleMarkerSymbol.A({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Ge={},Je=class extends Accessor.A{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new Collection.A,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this.addHandles([(0,reactiveUtils.on)((()=>this.children),"change",(t=>{const{added:s,removed:l}=t;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;this.addHandles((0,reactiveUtils.wB)((()=>t.ready),e,reactiveUtils.Vh),s)})),l.forEach((e=>this.removeHandles(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(Ge={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Ge=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new EffectView.$B,t.effect=e.effect,t.endTransitions(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,s=this.layer.parent,l=s&&"uid"in s?this._getParentLayerOpacity(s):null;return null!=t?t*e:null!=l?l*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if((0,layerUtils.yZ)(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet?.features.length){const t=e.layerDefinition,s=t?.drawingInfo,l=s&&(0,support_jsonUtils.r)(s.renderer),i=de.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:i}):(Logger.A.getLogger(this).warn("drawingInfo not available!"),null)}return null}));try{const e=[],s=await Promise.allSettled(t);for(const t of s)if("fulfilled"===t.status)for(const s of t.value??[])e.push(s);this.legendElements=e,this.notifyChange("ready")}catch(s){Logger.A.getLogger(this).warn("error while building legend for layer!",s)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){Logger.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForFeatureReduction(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){Logger.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;if(function xe(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxellayer();else if(function Oe(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function je(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(function ze(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}(e))await this._constructLegendElementsForBuildingSceneLayer();else if(Pe(e)||Ae(e)||De(e))await this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(Me(e)){const s=e;t=(s?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")}await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Me(e)||Ue(e)){const t=(0,reactiveUtils.wB)((()=>["renderingRule"in e&&e.rasterFunction,e.bandIds]),(()=>(0,promiseUtils.sg)((async()=>{Ge.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this.addHandles(t,"imageryLayers-watcher")}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Me(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready")}));await Promise.allSettled(s)})).catch((e=>{Logger.A.getLogger(this).warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(s||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,reactiveUtils.C_)((()=>!t.updating));const l=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return!l||(l.geometry=this.view.extent,0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(l):"queryFeatureCount"in e&&await e.queryFeatureCount(l)))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e?e.valueExpression:null;if(ce.test(t))return!0;const s="visualVariables"in e?e.visualVariables:null;return!!s?.some((e=>this._isScaleDrivenSizeVariable(e)))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some((e=>this._isScaleDrivenSymbol(e.symbol)));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some((e=>this._isScaleDrivenSymbol(e.symbol)))}return!1}_isScaleDrivenSymbol(e){if("cim"===e?.type){const{primitiveOverrides:t,minScale:s,maxScale:l}=e.data,i=t?.some((e=>/\$view\.scale/.test(e.valueExpressionInfo?.expression||"")))??!1;return null!=s||null!=l||i}return!1}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,s=t.minSize,l=t.maxSize;return!("object"!=typeof s||!s||!this._isScaleDrivenSizeVariable(s))||!("object"!=typeof l||!l||!this._isScaleDrivenSizeVariable(l))||!!t.expression||ce.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&Pe(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers??[])if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");const e=this.layer;this.addHandles((0,reactiveUtils.wB)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-current-variable"),this.addHandles((0,reactiveUtils.wB)((()=>e.getVariableStyles()),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=e.getVariableStyle(null),s=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new SimpleFillSymbol.A({color:t.color,outline:null})})})),e.length&&s.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:l}=t.transferFunction,i=e.toArray().reverse(),r=l.map(((e,t)=>`${0===t?Legend_support_utils.l5:Legend_support_utils.kC} ${function utils_s(t){const o=Math.floor(Math.log10(Math.abs(t)))+1,e=o<4||o>6?4:o,s=Math.abs(t)>=1e6?"compact":"standard";return(0,number.ZV)(t,{notation:s,minimumSignificantDigits:2,maximumSignificantDigits:e})}(e)}`)).reverse(),n=i.map((e=>({color:e.color,value:null,label:null})));n[0].label=r[0],n[n.length-1].label=r[1],s.push({type:"color-ramp",title:t.label,infos:n,preview:(0,symbolUtils.J0)(i.map((e=>e.color)),{ariaLabel:await $e("previewColorRampAriaLabel")})})}const l=e.opacity,i=s.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,l)));await Promise.allSettled(i),this.legendElements=s,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this.addHandles((0,reactiveUtils.wB)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this.addHandles((0,reactiveUtils.wB)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const l=e.toArray();for(const i of l){const e=(0,reactiveUtils.wB)((()=>[i.title,i.visible,i.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this.addHandles(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||i.visible&&i.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(i,t);e?.infos.length&&s.unshift(e)}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let s=e.legendUrl;if(!s)return;const i={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(s=(0,urlUtils.a6)(s,t));let r=null;const n=e.layer?.opacity;try{r=(await(0,request.A)(s,{responseType:"image"})).data,r&&(r.style.opacity=n)}catch{}return i.infos.push({src:s,preview:r,opacity:n}),i}_getLegendLayers(e,t){const s=Ge&&Ge[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return Ge[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Me(t)){const e=t.exportImageServiceParameters.rasterFunction;if(e&&(s.renderingRule=JSON.stringify(e.functionDefinition?.toJSON()||e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:l,customParameters:i}=t;s={raster:e,viewId:l,...s,...i}}}let i=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){const e=i.indexOf("?");e>-1?i=i.substring(0,e)+"/legend"+i.substring(e):i+="/legend"}else{const e=i.toLowerCase().indexOf("/rest/"),t=i.substring(0,e)+i.substring(e+5,i.length);i="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,request.A)(i,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;this.addHandles((0,reactiveUtils.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Logger.A.getLogger(this).warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const l=e.toArray();for(const i of l){const e=(0,reactiveUtils.wB)((()=>["renderer"in i&&i.renderer,i.opacity,i.title,i.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||i.visible){const e=null!=i?.opacity?i.opacity:null,l=null!=e?e*t:t;if("building-group"===i.type){const e={type:"symbol-table",title:i.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(i.sublayers,l);e.infos.push(...t),s=[e,...s]}else i.renderer&&(s=[...await this._getRendererLegendElements(i.renderer,{title:i.title,opacity:l,sublayer:i}),...s])}}return s.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;if(Pe(e)||Ae(e)||De(e)){this.addHandles((0,reactiveUtils.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Logger.A.getLogger(this).warn("Request to server for legend has failed!",t)}}}async _generateLegendElementsForSublayers(e,t,s){const l=this.layer;let i=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let n=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(n=De(l)?this.sublayerIds.map((e=>l.findSublayerForSubtypeCode(e))).filter(arrayUtils.Ru):this.sublayerIds.map((e=>l.findSublayerById(e))).filter(arrayUtils.Ru));for(const r of n){const e=(0,reactiveUtils.wB)((()=>[r.renderer,r.opacity,r.title,r.visible,r.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled&&this._isSublayerInScale(r)){const e=null!=r?.opacity?r.opacity:null,l=null!=e?e*t:t,n=!He(r)||r.originIdOf("renderer")>PropertyOrigin.Gr.SERVICE&&!r.sublayers;if(r.renderer&&n)await r.load(),i=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...i];else if(He(r)){const e=await this._generateSymbolTableElementForSublayer(r,l,s);e&&i.unshift(e)}}}return i.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,l=e.source;let i=null;if(l&&("map-layer"!==l.type||l.mapLayerId!==e.id||l.gdbVersion&&l.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>PropertyOrigin.Gr.SERVICE||e.originIdOf("labelingInfo")>PropertyOrigin.Gr.SERVICE||e.originIdOf("labelsVisible")>PropertyOrigin.Gr.SERVICE){const e=new ExportImageParameters.g({layer:this.layer});i=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const r=i||`${t.uid}-default`;(await this._getLegendLayers(r,i)).forEach((e=>s.set(e.layerId,e)))}const l=s.get(e.id);if((!l||l?.subLayerIds&&l.defaultVisibility)&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return{type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const l=t?.renderer;let i=t?.title||e.layerName;if(l&&(!t||t?.originIdOf("renderer")>PropertyOrigin.Gr.SERVICE)){const e=t?.title||this._getRendererTitle(l,t);e&&(i&&"string"!=typeof e&&"title"in e&&(e.title=i),i=e)}const r={type:"symbol-table",title:i,legendType:e.legendType||null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach((t=>{const l={type:"symbol-table",title:t.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter((e=>e.groupId===t.id)),e.layerId,s)};l.infos?.length>0&&r.infos.push(l)})):r.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,s),r.infos.length>0?r:null}_generateSymbolTableElementInfosForLegendLayer(e,t,l){return e.map((e=>{let i=e.url;if(e.imageData&&e.imageData.length>0)i=`data:image/png;base64,${e.imageData}`;else{if(0===i.indexOf("http"))return null;i=(0,kernel.Y3)(`${this.layer.url}/${t}/images/${i}`)}return{label:e.label,src:i,opacity:l??this.opacity,width:e.width,height:e.height}})).filter(arrayUtils.Ru)}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return!(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let l=null,i=null,r=!0;return!s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(l=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(i=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(l=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,i=Math.max(s.maxScale,e.maxScale)),(l>0&&l<this.scale||i>this.scale)&&(r=!1),r}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||0===e.length)return e;const s=t.renderer,l=e.some((e=>e.values));let i=0,r=null;return l&&e.some(((e,t)=>(e.values||(i=t,r=e,r.label||(r.label="others")),null!=r))),s?"unique-value"===s.type?r&&(e.splice(i,1),e.push(r)):"class-breaks"===s.type&&(r&&e.splice(i,1),e.reverse(),r&&e.push(r)):r&&(e.splice(i,1),e.push(r)),e}async _getRendererLegendElements(e,t={}){if(!function Te(e,t){return Se(e)||_e(e)||we(e)||ve(e)||Fe(e)||Ve(e)?"2d"===t.type||(0,rendererConversion.l)(e):ge(e)||pe(e)||be(e)||Ce(e)||Ie(e)||Re(e)||fe(e)||me(e)}(e,this.view))return Logger.A.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(function Le(e){return Ce(e)||Ie(e)||Re(e)||function Ee(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e))return this._constructPointCloudRendererLegendElements(e,t);if(Fe(e))return this._constructDotDensityRendererLegendElements(e);const s=await this._loadRenderer(e);return Ve(s)?this._constructPieChartRendererLegendElements(s):this._constructRendererLegendElements(s,t)}async _getLegendElementsForFeatureReduction(e){let t=null;return"binning"===e.type?t=e.renderer:"cluster"===e.type&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}async _constructPointCloudRendererLegendElements(e,t={}){const s=t.title,l=[];let i=null,r=null;if(Ce(e))i={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{i.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(ye,e.color)})}));else if(Ie(e)){const t=e.stops;let l=null;if(t?.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,s=t[t.length-1].value;null!=e&&null!=s&&(l=(0,colorRampUtils.G9)(e+(s-e)/2,t))}i={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(ye,l||ye.color)}]};const n=(0,colorRampUtils.y0)(e.stops??[])??[];r={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:n,preview:(0,symbolUtils.J0)(n.map((e=>e.color)),{ariaLabel:await $e("previewColorRampAriaLabel")})}}else Re(e)&&(i={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach((e=>{i.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(ye,e.color)})})));i&&i.infos.length&&l.push(i),r&&r.infos.length&&l.push(r);const n=l.reduce(((e,t)=>[...e,...t.infos??[]]),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return await Promise.allSettled(n),l}async _getElementInfoForDotDensity(e,t){const{color:s,label:l,valueExpressionTitle:i}=t,{backgroundColor:r,outline:n,dotSize:a}=e,o=this.effectList,u=o?.effects.map((e=>e.toJSON())),c=(0,jsonUtils.zu)(u),d=await $e("previewTemplateAriaLabel",l||i),y=a+"-"+s+"-"+r+"-"+(n&&JSON.stringify(n.toJSON()))+"-"+c,h=this._dotDensityUrlCache,m=h.has(y)?h.get(y):(0,symbolUtils.xg)(e,s,{ariaLabel:d});h.set(y,m);const f={shape:{type:"image",x:0,y:0,width:m.width,height:m.height,src:m.src},fill:null,stroke:null,offset:[0,0]},p=(0,renderUtils.fz)([[f]],[m.width,m.height],{effectView:this.effectList,ariaLabel:d});return{opacity:1,src:m.src,preview:p,width:m.width,height:m.height}}async _constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions?.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};for(const i of e.attributes){const t=await this._getElementInfoForDotDensity(e,i);t.label=i.label||i.valueExpressionTitle||i.field,l.infos.push(t)}return[l]}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,s=[];let l=null;const i=e.outline;e.attributes.forEach((e=>{const t=new SimpleMarkerSymbol.A({color:e.color,outline:i}),l=e.label||e.valueExpressionTitle||e.field;s.push({label:l,symbol:t})}));const r=s.length?[...s]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new SimpleMarkerSymbol.A({color:e.othersCategory.color,outline:i});l=e.othersCategory.label||"Other",s.push({label:l,symbol:t})}if(e.defaultColor?.a){const t=new SimpleMarkerSymbol.A({color:e.defaultColor,outline:i});s.push({label:e.defaultLabel,symbol:t})}const n=await this._getVisualVariableLegendElements(e,this.layer)||[];if(s.length){n.unshift({type:"symbol-table",title:null,infos:s});const t=r.filter((e=>e.label!==l)).map((e=>e.symbol.color)).filter(Boolean),a=(0,symbolUtils.es)(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:i,ariaLabel:await $e("previewPieChartAriaLabel")});n.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:s,preview:a})}const a=n.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await Promise.allSettled(a),n}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:l}=t,i=l||this.layer;this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const r=await this._getVisualVariableLegendElements(e,i)||[],n={type:"symbol-table",title:s||this._getRendererTitle(e,i),infos:[]};let a=null,o=!1;const u=new Set;if(me(e)&&!this._hasSizeRamp){const t=await(0,Legend_support_utils.Zo)(e);n.infos.push({label:null,symbol:t})}else if(function Ne(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type}(e)){let t=s;const l=function qe(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",i=r.findIndex((e=>"color-ramp"===e.type)),n=-1!==i?r.splice(i,1)[0]:null,a=r.findIndex((e=>"size-ramp"===e.type)),o=-1!==a?r.splice(a,1)[0]:null,u=[];n&&(t=n.title,u.push(n)),o&&(t=o.title,u.push(o)),u.length>0&&r.push({type:l,title:t,infos:u})}else if(ve(e)){const t=(0,heatmapRampUtils.Y)(e);r.push({type:"heatmap-ramp",title:s||this._getRendererTitle(e,i),infos:t,preview:(0,symbolUtils.J0)(t.map((e=>e.color)),{effectList:this.effectList,ariaLabel:await $e("previewColorRampAriaLabel")})})}else if(we(e)){const t=e&&e.authoringInfo;if(t&&"relationship"===t.type){const{numClasses:s,field1:l,field2:a}=t,o=t.focus;if(s&&l&&a){const t=[l,a];let c=(0,relationshipRampUtils.zv)(o)||0;for(const e of t){const{field:t,normalizationField:s,label:l}=e,r=l||{field:this._getFieldAlias(t,i),normField:s&&this._getFieldAlias(s,i)},a=We.clone();a.angle=c,n.infos.push({label:r,symbol:a}),u.add(a),c+=90}const d=(0,relationshipRampUtils.Jr)({focus:o,numClasses:s,infos:e.uniqueValueInfos??[]});r.unshift(d)}}else if(Me(this.layer)||Ue(this.layer))e.uniqueValueInfos?.forEach((e=>{e.symbol&&n.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})}));else{const{field:t,field2:l,field3:r,fieldDelimiter:a,valueExpression:u,defaultSymbol:c}=e,d=!(!t&&!u||!l&&!r),y=[];if(e.uniqueValueGroups?.forEach((e=>{const s={type:"symbol-table",title:e.heading,infos:[]};e.classes?.forEach((e=>{const{symbol:n,values:o}=e;if(n){const c=[],y=[];for(const e of o??[]){const{value:s,value2:n,value3:o}=e,h=[],m=[];(t||u)&&(h.push(s),m.push(this._getDomainName(t,s,i))),l&&(h.push(n),m.push(this._getDomainName(l,n,i))),r&&(h.push(o),m.push(this._getDomainName(r,o,i))),c.push(d?h.join(a||""):h[0]),y.push(m.join(" - "))}const h=c.join(", ");let m=e.label;if(!m){const e=y.filter(Boolean);m=e.length?e.join(", "):h}s.infos.push({label:m,value:h,symbol:n})}})),s.infos.length&&y.push(s)})),y.length){const t=y[0];1===y.length&&"title"in t&&!t.title?n.infos.push(...t.infos??[]):(c&&(y.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:c}]}),o=!0),n.infos.push(...y)),s||e.legendOptions?.title||e.valueExpressionTitle||(n.title=null)}}e.defaultSymbol&&!o&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),o=!0)}else if(_e(e))a=this._isUnclassedRenderer(e),(!a||!this._hasSizeRamp)&&(e.classBreakInfos.forEach((e=>{e.symbol&&n.infos.unshift({label:e.label||(a?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),a&&(n.title=null),this._updateInfosforClassedSizeRenderer(e,n.infos)),e.defaultSymbol&&!a&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),o=!0);else if(ge(e))if(Ue(this.layer)||function ke(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const t=await this._constructTileImageryStretchRendererElements(e);!function Be(e){return"stretch-ramp"===e.type}(t)?n.infos=t:r.push(t)}else{const t=this.layer;let s,l;if(e.statistics?.length){const t=e.statistics[0];(0,Legend_support_utils.sx)(t)?(s=t.min,l=t.max):[s,l]=t}let i=[],a=t.serviceRasterInfo;if(t.rasterFunction)try{a=await t.generateRasterInfo(t.rasterFunction)}catch{}const o=(0,pixelRangeUtils.h)(a.pixelType);if(1===a.bandCount){const i=t.bandIds?.[0]||0;s=null!=s?s:a.statistics?a.statistics[i].min:o[0],l=null!=l?l:a.statistics?a.statistics[i].max:o[1],s||l?r.push(await this._getStretchLegendElements(e,{min:s,max:l})):this._getServerSideLegend()}else if(t.bandIds&&1===t.bandIds.length)s=null!=s?s:a.statistics?a.statistics[t.bandIds[0]].min:o[0],l=null!=l?l:a.statistics?a.statistics[t.bandIds[0]].max:o[1],s||l?r.push(await this._getStretchLegendElements(e,{min:s,max:l})):this._getServerSideLegend();else if(a.bandCount>=3){const{bandInfos:e}=a,{bandIds:s}=t;e.length>=a.bandCount?3===s?.length?(i=s.map((t=>e[t].name)),n.infos=this._createSymbolTableElementMultiBand(i)):"lerc"===t.format?(i=[0,1,2].map((t=>e[t].name)),n.infos=this._createSymbolTableElementMultiBand(i)):this._getServerSideLegend():"lerc"===t.format?(i=["band1","band2","band3"],n.infos=this._createSymbolTableElementMultiBand(i)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(pe(e))e.colormapInfos.forEach((e=>{n.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(he,e.color)})}));else if(Se(e)){let s=e.symbol;switch(t.geometryType){case"point":s="pointSymbol"in i?i.pointSymbol:null;break;case"polyline":s="lineSymbol"in i?i.lineSymbol:null;break;case"polygon":s="polygonSymbol"in i?i.polygonSymbol:null}const l=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&l&&n.infos.push({label:e.label,symbol:s})}else if(fe(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),n.title=e.attributeField;const t=e.getClassBreakInfos();t?.length?t.forEach((e=>{n.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):n.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else be(e)&&r.push(await this._getStretchLegendElements(e,{min:0,max:255}));const c=e.defaultSymbol;!c||o||Se(e)||a&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||r.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:c}]}),n.infos.length&&r.unshift(n);const d=null==t.opacity?this.opacity:t.opacity,y=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),h=Me(this.layer)||Ue(this.layer),m=r.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol)).filter((e=>{if("cim"===e.symbol.type){const{minScale:t,maxScale:s}=e.symbol.data;if(t&&t<this.scale||s&&s>this.scale)return!1}return!0})).map((e=>this._getSymbolPreview(e,d,{isDefault:e.symbol===c,applyScaleDrivenSize:!u.has(e.symbol),symbolConfig:{isTall:y,isSquareFill:h},effectList:u.has(e.symbol)?null:this.effectList})));return e=null,await Promise.allSettled(m),r}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}async _constructTileImageryStretchRendererElements(e){const t=this.layer,s=t.symbolizer.rasterInfo??t.raster.rasterInfo;let l,i;const r=e?.statistics?.length?e.statistics:s?.statistics;if(r){const e=r[0];(0,Legend_support_utils.sx)(e)?(l=e.min,i=e.max):[l,i]=e}else{const e=(0,pixelRangeUtils.h)(s.pixelType);l=e[0],i=e[1]}if(t.hasStandardTime()&&(l=t.getStandardTimeValue(l),i=t.getStandardTimeValue(i)),1===s.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:l,max:i});const n=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((e=>s.bandInfos[e].name));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),this._createSymbolTableElementMultiBand(n)}async _getStretchLegendElements(e,t){const s=e.colorRamp,l=(0,colorRampUtils.k4)(s,t);return{type:"stretch-ramp",title:"",infos:l,preview:(0,symbolUtils.J0)(l.map((e=>e.color)),{ariaLabel:await $e("previewColorRampAriaLabel")})}}_getClusterSymbol(){const e=this.layer,t="featureReduction"in e&&e.featureReduction,s=t&&"symbol"in t&&t.renderer;return s&&!0!==s?.authoringInfo?.isAutoGenerated?null:t&&"symbol"in t?t.symbol:null}async _getSizeLegendElement(e,t,s,l){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await k(s,t,await(0,Legend_support_utils.uM)(s),this.scale,this.view,l,this._hasClusterSizeVariable?this._getClusterSymbol():null)}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach(((e,l)=>{t.push({label:{colorName:s[l],bandName:e},src:Legend_support_utils.E2[l],opacity:this.opacity??1})})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some((e=>(0,support_utils.$d)(e.symbol)));if(s&&l){const s=p,l=y,i=e.classBreakInfos.length,r=(s-l)/(i>1?i-1:i);t.forEach(((e,t)=>{e.size=s-r*t}))}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let l=0;l<e.length&&(!t||!s);l++){const i=e[l];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(s=!0))}return t&&s}async _getSymbolPreview(e,t,s){let l=!s?.isDefault&&null==e.size&&this._hasSizeRamp?(0,screenUtils.PN)(previewUtils.CB.size):e.size;if(this._scaleDrivenSizeVariable&&s?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"));l=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}const i=!s?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!s?.applyScaleDrivenSize);return(0,symbolUtils.Gr)(e.symbol,{size:l,opacity:t,scale:!1,symbolConfig:s?.symbolConfig,effectView:s?.effectList,style:"legend",cimOptions:{allowScalingUp:i,viewParams:this.isScaleDriven?{viewingMode:"2d"===this.view?.type?"map":this.view?.viewingMode,scale:this.view?.scale}:null},ariaLabel:e.label&&"string"!=typeof e.label?null:await $e("previewTemplateAriaLabel",e.label)}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;const t="renderer"in this.layer?this.layer.renderer:null,s=e.renderer?.clone()||t?.clone(),l=a(this.layerView._effectiveRenderer,this.view);if(l&&null!=s&&"visualVariables"in s){const t=s.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!ce.test(e.valueExpression)));if(!t){if("clusterMinSize"in e&&"clusterMaxSize"in e){const{clusterMinSize:t,clusterMaxSize:s}=e;l.legendOptions=new SizeVariableLegendOptions.A({showLegend:t!==s})}const t=s.visualVariables||[];s.visualVariables=t.concat([l]),this._hasClusterSizeVariable=!0}}return s}async _loadRenderer(e){const t=[],s=e.clone(),l=await(0,Legend_support_utils.uM)(s);if(_e(s)||we(s)){const e=(s.classBreakInfos||s.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,l).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,e)}return t.push(this._fetchSymbol(s.symbol||s.defaultSymbol,s.defaultSymbol?null:l).then((e=>{this._applySymbolToRenderer(s,e,Se(s))})).catch((()=>{this._applySymbolToRenderer(s,null,Se(s))}))),await Promise.allSettled(t),s}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const s=this._webStyleSymbolCache;try{const l=await("2d"===this.view.type?e.fetchCIMSymbol({cache:s}):e.fetchSymbol({cache:s}));return this._getAppliedCloneSymbol(l,t)}catch{throw Logger.A.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,s){if(!e||!s)return e;const l=e.clone(),i=s&&s.toRgba();return l.type.includes("3d")?this._applyColorTo3dSymbol(l,i):"cim"===l.type?(0,cimSymbolUtils.Fe)(l,s):l.color&&(l.color=new Color.A(i||l.color)),l}_applyColorTo3dSymbol(e,s){s&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new Color.A(s))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,l=[],i=[],n=[];for(const r of s)"color"===r.type?l.push(r):"size"===r.type?i.push(r):"opacity"===r.type&&n.push(r);const a=[...l,...i,...n];let o,u;if(0===l.length&&_e(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];o=t&&t.symbol}if(0===l.length&&Se(e)&&(o=e.symbol),o)if(o.type.includes("3d")){const e=o.symbolLayers.at(0);"water"===e.type?null!=e.color&&(u=e.color):null!=e.material?.color&&(u=e.material.color)}else o.url||(u=o.color);const c=this.effectList;return(await Promise.all(a.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const l=me(e)?s.field:this._getRampTitle(s,t);let i=null;const r=this._getDateFormatOptions(t,s);if("color"===s.type){const e=await(0,colorRampUtils.Cm)(s,null,r)??[];i={type:"color-ramp",title:l,infos:e,preview:(0,symbolUtils.J0)(e.map((e=>e.color)),{effectList:c,ariaLabel:await $e("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=e.length>0)}else if("size"===s.type&&"outline"!==s.target)ce.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(i=await this._getSizeLegendElement(l,s,e,r),this._hasSizeRamp||(this._hasSizeRamp=!(null==i.infos||!i.infos.length)));else if("opacity"===s.type){const e=await(0,colorRampUtils.Cm)(s,u,r)??[];i={type:"opacity-ramp",title:l,infos:e,preview:(0,symbolUtils.J0)(e.map((e=>e.color)),{effectList:c,ariaLabel:await $e("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=e.length>0)}return i&&i.infos?i:null}})))).filter(arrayUtils.Ru)}_getFieldInfo(e,t){if(!t.field)return null;if("featureReduction"in e)switch(e.featureReduction?.type){case"cluster":case"binning":{const s=e.featureReduction.fields.find((({name:e})=>e.toLowerCase()===t.field.toLowerCase()));return s&&"getField"in e?e.getField(s.onStatisticField):null}}return"getField"in e?e.getField?.(t.field):null}_getDateFormat(e,t){const s="popupTemplate"in e?e.popupTemplate?.fieldInfos:null;if(s?.length&&t)return s.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))?.format?.dateFormat}_getDateFormatOptions(e,t){const s=this._getFieldInfo(e,t);if(!s||!(0,utils.fs)(s)&&!(0,fieldUtils.OH)(s))return null;let l=this._getDateFormat(e,s.name);if(!l&&"date"===s.type){let e=0,s=0;t.stops?(e=t.stops?.at(0)?.value??e,s=t.stops?.at(-1)?.value??s):"minDataValue"in t&&"maxDataValue"in t&&(e=t.minDataValue??e,s=t.maxDataValue??s),l=s-e>2*timeUtils.vf.days?"short-date":"short-date-short-time"}return{fieldType:s.type,format:l,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:this.view.timeZone,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}}}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const l="getField"in s&&s.getField?.(e),i=l&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(l.name):null;return"coded-value"===i?.type?i.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,i=l&&l.fieldInfos;if(i)for(const t of i)if(t.fieldName===s)return"cluster_count"===s?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let s=e.field,l=e.normalizationField,i=!1,r=!1,n=!1,a=null;s="function"==typeof s?null:s,l="function"==typeof l?null:l;const o=e.legendOptions?.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){i=!0;break}if("percent"===s.style){r=!0;break}if("percent-of-total"===s.style){n=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:l&&this._getFieldAlias(l,t),ratio:i,ratioPercent:r,ratioPercentTotal:n}}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions?.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let l=s.field,i=null,r=null;if(_e(s)&&(i=s.normalizationField,r="percent-of-total"===s.normalizationType),l="function"==typeof l?null:l,i="function"==typeof i?null:i,we(s)){const{field2:e,field3:i,fieldDelimiter:r}=s;let n=l&&this._getFieldAlias(l,t);return e&&(n=`<${n}>${r}<${this._getFieldAlias(e,t)}>`,i&&(n=`${n}${r}<${this._getFieldAlias(i,t)}>`)),n}let n=null;return(l||i)&&(n={field:l&&this._getFieldAlias(l,t),normField:i&&this._getFieldAlias(i,t),normByPct:r}),n}_getFieldAlias(e,t){const s="popupTemplate"in t?t.popupTemplate:null,l=s?.fieldInfos;let i;l&&l.some((t=>e===t.fieldName&&(i=t,!0)));let r=null;"getField"in t&&t.getField?r=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(r=t.fieldsIndex.get(e));let n=null;const a="featureReduction"in t&&t.featureReduction;a&&(!i&&"popupTemplate"in a&&a.popupTemplate?.fieldInfos&&a.popupTemplate.fieldInfos.some((t=>e?.toLowerCase()===t.fieldName?.toLowerCase()&&(i=t,!0))),"fields"in a&&a.fields&&(n=a.fields.find((t=>t.name?.toLowerCase()===e?.toLowerCase()))));const o=i||r||n;let u=null;return o&&(u=i?.label||r?.alias||n?.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName||null),u}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return _e(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"children",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Je.prototype,"effectList",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"layerView",void 0),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"legendElements",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Je.prototype,"opacity",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"parent",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0,dependsOn:[]})],Je.prototype,"ready",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"hideLayersNotInCurrentView",void 0),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"keepCacheOnDestroy",void 0),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"respectLayerVisibility",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Je.prototype,"scale",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"sublayerIds",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Je.prototype,"isScaleDriven",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"title",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0,dependsOn:["ready"],value:0})],Je.prototype,"version",null),(0,tslib_es6._)([(0,property.MZ)()],Je.prototype,"view",void 0),Je=(0,tslib_es6._)([(0,subclass.$)("esri.widgets.Legend.support.ActiveLayerInfo")],Je);const Qe=Je;var locale=__webpack_require__("./node_modules/@arcgis/core/intl/locale.js");const LegendViewModel_h_state="state",LegendViewModel_h_view="view",LegendViewModel_h_allLayerViews="all-layer-views",LegendViewModel_h_legendProperties="legend-properties",c=Collection.A.ofType(Qe),LegendViewModel_L=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer"]),_=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];let LegendViewModel_v=class extends Accessor.A{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new Collection.A,this.activeLayerInfos=new c,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles((0,reactiveUtils.wB)((()=>this.view),(()=>this._viewHandles()),reactiveUtils.Vh),LegendViewModel_h_view),this.addHandles((0,locale.oQ)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(LegendViewModel_h_state),this.view&&this.addHandles((0,reactiveUtils.wB)((()=>this.state),(()=>this._stateHandles()),reactiveUtils.Vh),LegendViewModel_h_state)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([LegendViewModel_h_allLayerViews,LegendViewModel_h_legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);const r=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],r?.parent&&r.parent.children.remove(r)}_watchPropertiesAndAllLayerViews(){const{view:e}=this;if(!e)return;const{allLayerViews:r}=e;r.length&&this._refresh(),this.addHandles(r.on("change",(e=>this._allLayerViewsChangeHandle(e))),LegendViewModel_h_allLayerViews),this.addHandles((0,reactiveUtils.wB)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),LegendViewModel_h_legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){const r=this.view;if(e.length<2||!r)return;const i=[];e.forEach((r=>{if(!r.parent){const t=r.layer.parent,s=t&&"uid"in t&&this._layerViewByLayerId[t.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&e.includes(a)&&(i.push(r),r.parent=a,a.children.add(r),this._sortActiveLayerInfos(a.children))}})),e.removeMany(i);const t={};r.allLayerViews.forEach(((e,r)=>t[e.layer.uid]=r)),e.sort(((e,r)=>{const i=t[e.layer.uid]||0;return(t[r.layer.uid]||0)-i}))}_generateLayerViews(){const e=[];return _.filter(this._filterLayerViews,this).map((e=>(0,get.Jt)(this,e))).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const r=!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===e||"view.basemapView.referenceLayerViews"===e),i=!this.groundLegendVisible&&"view.groundView.layerViews"===e;return!r&&!i}_collectLayerViews(e,r){const i=t=>(t&&t.forEach((t=>{r.push(t),i(t[e])})),r);return i}_filterLayerViewsByLayerInfos(e){const r=this.layerInfos;return!r||!r.length||r.some((r=>this._hasLayerInfo(r,e)))}_hasLayerInfo(e,r){const i=this._isLayerUIDMatching(e.layer,r.layer.uid);return i&&(this._layerInfosByLayerViewId[r.uid]=e),i}_isLayerUIDMatching(e,r){return e&&(e.uid===r||this._hasLayerUID(e.layers,r))}_hasLayerUID(e,r){return e&&e.some((e=>this._isLayerUIDMatching(e,r)))}_isLayerViewSupported(e){return!!LegendViewModel_L.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles((0,reactiveUtils.wB)((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){const r=e.layer,i=e.uid,n=this._layerInfosByLayerViewId[i];let o=this._activeLayerInfosByLayerViewId[i];if(!o){const t=void 0!==n?.title&&n.layer.uid===r.uid;o=new Qe({layer:r,layerView:e,title:t?n.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:n?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=o}const l=r.parent&&"uid"in r.parent?this._layerViewByLayerId[r.parent?.uid]:null;if(o.parent=this._activeLayerInfosByLayerViewId[l?.uid],!this.hasHandles(i)){const n=[(0,reactiveUtils.wB)((()=>r.title),(e=>this._titleHandle(e,o))),(0,reactiveUtils.wB)((()=>[r.opacity,"renderer"in r&&r.renderer,"pointSymbol"in r&&r.pointSymbol,"lineSymbol"in r&&r.lineSymbol,"polygonSymbol"in r&&r.polygonSymbol]),(()=>this._constructLegendElements(o))),(0,reactiveUtils.z7)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(o)),reactiveUtils.Vh),(0,reactiveUtils.wB)((()=>e._effectiveRenderer),(()=>this._constructLegendElements(o))),(0,reactiveUtils.wB)((()=>"effect"in r&&r.effect),(()=>this._constructLegendElements(o))),(0,reactiveUtils.z7)((()=>this.view?.timeZone),(()=>this._constructLegendElements(o)),reactiveUtils.Vh)];if(this.respectLayerVisibility){const i=(0,reactiveUtils.wB)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,o))),s=(0,reactiveUtils.wB)((()=>r.legendEnabled),(e=>this._legendEnabledHandle(e,o)));n.push(i,s)}this.addHandles(n,i)}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o)}_titleHandle(e,r){r.title=e,this._constructLegendElements(r)}_legendEnabledHandle(e,r){e?this._addActiveLayerInfo(r):this._removeActiveLayerInfo(r)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:r,layer:i}=e;if(this._isLayerActive(r)&&!this.activeLayerInfos.includes(e)){const r=e.parent;if(r)r.children.includes(e)||r.children.push(e),this._sortActiveLayerInfos(r.children);else{const r=this.layerInfos?.some((e=>e.layer.uid===i.uid));i.parent&&"uid"in i.parent&&!r?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((r=>{const i=r.layer.parent,t=i&&"uid"in i?this._layerViewByLayerId[i?.uid]:null,s=this._activeLayerInfosByLayerViewId[t?.uid];s&&(e.push(r),r.parent=s)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const r=e.parent;r?r.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const r=e.layer;"featureCollections"in r&&r.featureCollections?e.buildLegendElementsForFeatureCollections(r.featureCollections):"featureReduction"in r&&r.featureReduction&&"renderer"in r.featureReduction&&("binning"===r.featureReduction.type||"cluster"===r.featureReduction.type)?e.buildLegendElementsForFeatureReduction(r.featureReduction):"renderer"in r&&r.renderer&&!("sublayers"in r)?e.buildLegendElementsForRenderer(r.renderer):"url"in r&&r.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,tslib_es6._)([(0,property.MZ)({type:c})],LegendViewModel_v.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"basemapLegendVisible",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"groundLegendVisible",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"hideLayersNotInCurrentView",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"keepCacheOnDestroy",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"respectLayerVisibility",void 0),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"layerInfos",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],LegendViewModel_v.prototype,"state",null),(0,tslib_es6._)([(0,property.MZ)()],LegendViewModel_v.prototype,"view",void 0),LegendViewModel_v=(0,tslib_es6._)([(0,subclass.$)("esri.widgets.Legend.LegendViewModel")],LegendViewModel_v);const LegendViewModel_I=LegendViewModel_v;var svgUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/svgUtils.js");const CardCSS_e="esri-legend--card",CardCSS_r={activated:`${CardCSS_e}__carousel-indicator--activated`,base:CardCSS_e,stacked:"esri-legend--stacked",carouselTitle:`${CardCSS_e}__carousel-title`,indicator:`${CardCSS_e}__carousel-indicator`,intervalSeparator:`${CardCSS_e}__interval-separator`,imageryLayerStretchedImage:`${CardCSS_e}__imagery-layer-image--stretched`,imageLabel:`${CardCSS_e}__image-label`,layerCaption:`${CardCSS_e}__layer-caption`,labelElement:`${CardCSS_e}__label-element`,layerRow:`${CardCSS_e}__layer-row`,labelCell:`${CardCSS_e}__label-cell`,message:`${CardCSS_e}__message`,rampLabel:`${CardCSS_e}__ramp-label`,section:`${CardCSS_e}__section`,relationshipSection:`${CardCSS_e}__relationship-section`,serviceCaptionText:`${CardCSS_e}__service-caption-text`,serviceContent:`${CardCSS_e}__service-content`,service:`${CardCSS_e}__service`,groupLayer:`${CardCSS_e}__group-layer`,groupLayerChild:`${CardCSS_e}__group-layer-child`,symbol:`${CardCSS_e}__symbol`,sizeRampRow:`${CardCSS_e}__size-ramp-row`,symbolRow:`${CardCSS_e}__symbol-row`,symbolCell:`${CardCSS_e}__symbol-cell`,indicatorContainer:`${CardCSS_e}__carousel-indicator-container`,intervalSeparatorsContainer:`${CardCSS_e}__interval-separators-container`,relationshipLabelContainer:`${CardCSS_e}__relationship-label-container`,labelContainer:`${CardCSS_e}__label-container`,serviceCaptionContainer:`${CardCSS_e}__service-caption-container`,symbolContainer:`${CardCSS_e}__symbol-container`,sizeRampContainer:`${CardCSS_e}__size-ramp-container`,sizeRampPreview:`${CardCSS_e}__size-ramp-preview`,pieChartRampPreview:`${CardCSS_e}__pie-chart-ramp-preview`,rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var relationshipUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/styles/support/relationshipUtils.js"),projector=(__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projection.js"),__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projector.js")),jsxFactory=__webpack_require__("./node_modules/@arcgis/core/widgets/support/jsxFactory.js");const univariateUtils_l=(0,projector.F)(),univariateUtils_n=10,univariateUtils_r=20,s=10,univariateUtils_a=20,univariateUtils_c={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function univariateUtils_f(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,jsxFactory.K)("svg",{height:"4",width:"10"},(0,jsxFactory.K)("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):(0,jsxFactory.K)("svg",{height:"10",width:"10"},(0,jsxFactory.K)("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function univariateUtils_p(e,t="vertical"){const o=document.createElement("div");return o.style.height=`${univariateUtils_r}px`,o.className=univariateUtils_c.univariateAboveAndBelowSymbol,null!=e&&(o.style.opacity=e.toString()),univariateUtils_l.append(o,univariateUtils_f.bind(null,t)),o}function univariateUtils_m(t,o,i="vertical",l){t.infos.forEach(((t,n)=>{if(l&&2===n)t.preview=univariateUtils_p(o,i);else{const o=(0,screenUtils.Lz)(t.size)+("horizontal"===i?univariateUtils_a:s),l=t.preview,n="div"===l?.tagName.toLowerCase(),r=n?l:document.createElement("div");r.className=univariateUtils_c.univariateAboveAndBelowSymbol,"horizontal"===i?r.style.width=`${o}px`:r.style.height=`${o}px`,!n&&l&&r.appendChild(l),t.preview=r}}))}function univariateUtils_u(t,o="classic"){const i=t.infos;return"classic"===o?((0,screenUtils.Lz)(i[0].size)+s)/2:((0,screenUtils.Lz)(i[0].size)-(0,screenUtils.Lz)(i[i.length-1].size))/2}function univariateUtils_h(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),l=(0,symbolUtils.J0)("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return l.className=univariateUtils_c.colorRamp,null!=t.opacity&&(l.style.opacity=t.opacity.toString()),l}function univariateUtils_v(t,o,i,l="vertical"){let c=0;const f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p;for(let h=m;h<=u;h++)c+=i&&h===p?"horizontal"===l?univariateUtils_n:univariateUtils_r:(0,screenUtils.Lz)(f[h].size)+("horizontal"===l?univariateUtils_a:s);return Math.round(c)}function univariateUtils_y(t,o,i,l="vertical"){const c=univariateUtils_v(t,o,i,l),f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p,h="full"===o?f[m].size+f[u].size:"above"===o?f[m].size:f[u].size,y=i?"vertical"===l?univariateUtils_r:univariateUtils_n:0,d="vertical"===l?s*("full"===o?2:1):univariateUtils_a*("full"===o?2:1);return Math.round(c-((0,screenUtils.Lz)(h)/2+y/2+d/2))}function univariateUtils_d(e,t,o="vertical"){const i=e.infos;let l=i.find((({type:e})=>"size-ramp"===e)),n=i.find((({type:e})=>"color-ramp"===e));return l&&(l={...l},l.infos=[...l.infos],univariateUtils_m(l,t,o,!0)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===o&&(l?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:l,colorRampElement:n}}function univariateUtils_b(e,t="vertical"){const o=e.infos;let i=o.find((({type:e})=>"size-ramp"===e)),l=o.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],univariateUtils_m(i,null,t,!1)),l&&(l={...l},l.infos=[...l.infos]),"horizontal"===t&&(i?.infos.reverse(),l?.infos.reverse()),{sizeRampElement:i,colorRampElement:l}}var string=__webpack_require__("./node_modules/@arcgis/core/core/string.js");function styleUtils_i(e){e.appendChild(this)}function styleUtils_o(n,i,o){if(!i)return;if("number"==typeof i)return i;if("string"==typeof i)return(0,string._e)(i);if("value"in i||"unit"in i)return(0,substitute.V)(n.dotValue,i);if("colorName"in i&&"bandName"in i)return n[i.colorName]+": "+(n[i.bandName]||i.bandName);if("showCount"in i)return i.showCount?n.clusterCountTitle:void 0;let u=null;return function styleUtils_r(e,t){return t}(0,o)?u=i.ratioPercentTotal?"showRatioPercentTotal":i.ratioPercent?"showRatioPercent":i.ratio?"showRatio":i.normField?"showNormField":i.field?"showField":null:styleUtils_l(i,o)&&(u=i.normField?"showNormField":i.normByPct?"showNormPct":i.field?"showField":null),u?(0,substitute.V)("showField"===u?"{field}":n[u],{field:i.field,normField:i.normField}):void 0}function styleUtils_l(e,t){return!t}function styleUtils_u(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}function styleUtils_a(e,t){return e.label?t[e.label]+": "+("string"==typeof e.value?e.value:(0,number.ZV)(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}var Heading=__webpack_require__("./node_modules/@arcgis/core/widgets/support/Heading.js"),accessibleHandler=__webpack_require__("./node_modules/@arcgis/core/widgets/support/decorators/accessibleHandler.js"),messageBundle=__webpack_require__("./node_modules/@arcgis/core/widgets/support/decorators/messageBundle.js");var N;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(N||(N={}));const Card_j=window.devicePixelRatio;let Card_T=class extends Widget.A{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=N.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles((0,reactiveUtils.wB)((()=>this.activeLayerInfos),(e=>{this.removeAllHandles(),this._watchForSectionChanges(e)})))}render(){const{view:e}=this;this._hasIndicators=this.layout===N.Auto&&e&&e.container.clientWidth<=768||this.layout===N.Stack;const t=this.activeLayerInfos,s=t&&t.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,a=this._sectionNames.map(((e,t)=>{const s=(0,substitute.V)(this.messagesCommon.pagination.pageText,{index:t+1,total:i});return(0,jsxFactory.K)("div",{"aria-controls":`${e}-panel`,"aria-label":s,"aria-selected":(this._selectedSectionName===e).toString(),bind:this,class:this.classes(CardCSS_r.indicator,{[CardCSS_r.activated]:this._selectedSectionName===e}),"data-section-name":e,id:e,key:e,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===e?0:-1,title:s})})),r=this._hasIndicators&&i>1?(0,jsxFactory.K)("div",{class:CardCSS_r.indicatorContainer,key:"carousel-navigation",role:"tablist"},a):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s&&s.length?s:null,l={[CardCSS_r.stacked]:this._hasIndicators};return(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.base,l)},o||(0,jsxFactory.K)("div",{class:CardCSS_r.message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),a=this._sectionNames.indexOf(i),r=this._sectionNames;let o=null;-1!==a&&(r[a+s]?o=document.getElementById(r[a+s]):"ArrowLeft"===t?o=document.getElementById(r[r.length-1]):"ArrowRight"===t&&(o=document.getElementById(r[0])),o?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const s=`activeLayerInfo-${e.layer.uid}-version-change`;this.removeHandles(s),this._watchForSectionChanges(e.children),this.addHandles((0,reactiveUtils.wB)((()=>e.version),(()=>this._generateSectionNames())),s)}));const s="activeLayerInfos-collection-change";this.removeHandles(s),this.addHandles(e.on("change",(()=>this._watchForSectionChanges(e))),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,s){return`${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.service,CardCSS_r.groupLayer),key:e.layer.uid},(0,jsxFactory.K)("div",{class:CardCSS_r.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const a={[CardCSS_r.groupLayerChild]:!!e.parent};return(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.service,a),key:e.layer.uid},(0,jsxFactory.K)("div",{class:CardCSS_r.serviceCaptionContainer},(0,jsxFactory.K)("div",{class:CardCSS_r.serviceCaptionText},e.title)),(0,jsxFactory.K)("div",{class:CardCSS_r.serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1,a=!1){const r="color-ramp"===e.type,o="opacity-ramp"===e.type,l=t.layer;let p=null;if("string"==typeof e.title)p=e.title;else if(e.title){const t=e.title,s=styleUtils_o(this.messages,t,r||o);p=t.title?`${t.title} (${s})`:s}const d=this._getSectionName(l,e,s),m=this._hasIndicators&&!a?(0,jsxFactory.K)("div",null,(0,jsxFactory.K)(Heading.D,{class:CardCSS_r.carouselTitle,level:this.headingLevel},t.title),(0,jsxFactory.K)(Heading.D,{class:CardCSS_r.layerCaption,level:(0,Heading.S)(this.headingLevel)},p)):p?(0,jsxFactory.K)(Heading.D,{class:CardCSS_r.layerCaption,level:this.headingLevel},p):null,h=t.effectList;let y=null;switch(e.type){case"symbol-table":{const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes?.[CardCSS_r.symbolRow],t={[CardCSS_r.labelContainer]:!e&&!i,[CardCSS_r.relationshipLabelContainer]:i};y=(0,jsxFactory.K)("div",{class:this.classes(t)},s)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":y=this._renderLegendForRamp(e,l.opacity,h);break;case"size-ramp":y=this._renderSizeRamp(e,l.opacity);break;case"pie-chart-ramp":y=this._renderPieChartRamp(e);break;case"relationship-ramp":y=(0,relationshipUtils.p)(e,this.id,{opacity:l.opacity,effectList:h,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":y=this._renderUnivariateAboveAndBelowRamp(e,l.opacity,h);break;case"univariate-color-size-ramp":y=this._renderUnivariateColorSizeRamp(e,l.opacity,h)}if(!y)return null;const g=(0,jsxFactory.K)("div",{"aria-labelledby":d,class:CardCSS_r.section,id:`${d}-panel`,key:d,role:"tabpanel",tabIndex:0},[m,y]);return a||this._sectionMap.set(d,g),g}_renderPieChartRamp(e){return(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:CardCSS_r.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:a}=univariateUtils_d(e,t,"horizontal");if(!i)return null;const r=univariateUtils_v(i,"full",!0,"horizontal"),o=univariateUtils_y(i,"above",!0,"horizontal"),l=univariateUtils_y(i,"below",!0,"horizontal"),g=this.messages?.previewColorRampAriaLabel,v=univariateUtils_h(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:s,ariaLabel:g}),u=univariateUtils_h(a,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:s,ariaLabel:g}),b=univariateUtils_u(i,"card"),_=i.infos.map((e=>e.label)),w=_.length-1,L=_.map(((e,t)=>0===t||t===w?(0,jsxFactory.K)("div",{key:t},e):null)),$={marginTop:"3px",display:"flex"};(0,widgetUtils.V8)(this.container)?$.marginRight=`${b}px`:$.marginLeft=`${b}px`;const k={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,jsxFactory.K)("div",{class:CardCSS_r.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.symbolContainer,CardCSS_r.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:CardCSS_r.symbol,key:t})))),v?(0,jsxFactory.K)("div",{class:CardCSS_r.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:$},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:v}),(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:u})):null,(0,jsxFactory.K)("div",{class:CardCSS_r.layerInfo},(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabelsContainer,styles:k},L)))}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:a}=univariateUtils_b(e,"horizontal");if(!i)return null;const r=univariateUtils_v(i,"full",!1,"horizontal"),l=univariateUtils_h(a,{width:univariateUtils_y(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:s,ariaLabel:this.messages?.previewColorRampAriaLabel}),c=univariateUtils_u(i,"card"),p=i.infos.length-1,v=i.infos.map(((e,t)=>0===t||t===p?(0,jsxFactory.K)("div",{key:t},e.label):null)),_={marginTop:"3px",display:"flex"};(0,widgetUtils.V8)(this.container)?_.marginRight=`${c}px`:_.marginLeft=`${c}px`;const w={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,jsxFactory.K)("div",{class:CardCSS_r.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.symbolContainer,CardCSS_r.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:CardCSS_r.symbol,key:t})))),(0,jsxFactory.K)("div",{class:CardCSS_r.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:_},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:l})),(0,jsxFactory.K)("div",{class:CardCSS_r.layerInfo},(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabelsContainer,styles:w},v)))}_renderLegendForElementInfo(e,t,s,i){const a=t.layer;if(e.type)return this._renderLegendForElement(e,t,i,!1,!0);const r=styleUtils_u(a,s),l=styleUtils_o(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,key:i});const t={[CardCSS_r.symbolCell]:this._hasIndicators};return(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.layerRow,{[CardCSS_r.symbolRow]:this._hasIndicators}),key:i},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:this.classes(t)}),(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.imageLabel,{[CardCSS_r.labelCell]:this._hasIndicators})},l))}let s=255,r=255,c=255,p=0,d=255,m=255,h=255,y=0;const g=e.symbol.color?.a,v=e.symbol.outline?.color?.a;g&&(s=e.symbol.color.r,r=e.symbol.color.g,c=e.symbol.color.b,p=e.symbol.color.a*a.opacity),v&&(d=e.symbol.outline.color.r,m=e.symbol.outline.color.g,h=e.symbol.outline.color.b,y=e.symbol.outline.color.a*a.opacity);const u=e.symbol.color?.isBright??!0,b=u?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",_={background:g?`rgba(${s}, ${r}, ${c}, ${p})`:"none",color:u?"black":"white",textShadow:`-1px -1px 0 ${b},\n                                              1px -1px 0 ${b},\n                                              -1px 1px 0 ${b},\n                                              1px 1px 0 ${b}`,border:v?`1px solid rgba(${d}, ${m}, ${h}, ${y})`:"none",filter:(0,support_utils.di)(t.effectList)??void 0};return(0,jsxFactory.K)("div",{class:CardCSS_r.layerRow,key:i},(0,jsxFactory.K)("div",{class:CardCSS_r.labelElement,styles:_},l))}if(e.src){const t=this._renderImage(e,a,r);return(0,jsxFactory.K)("div",{class:CardCSS_r.layerRow,key:i},t,(0,jsxFactory.K)("div",{class:CardCSS_r.imageLabel},l))}}_renderImage(e,t,s){const{label:i,src:a,opacity:r}=e,o={[CardCSS_r.imageryLayerStretchedImage]:s,[CardCSS_r.symbol]:!s},l={opacity:`${null!=r?r:t.opacity}`};return(0,jsxFactory.K)("img",{alt:styleUtils_o(this.messages,i,!1),"aria-label":styleUtils_o(this.messages,i,!1),border:0,class:this.classes(o),height:e.height,src:a,styles:l,width:e.width})}_renderSizeRampLines(e){const t=e.infos,i=t[0],a=t[t.length-1],r=i.symbol,o=this._hasIndicators,l=(0,screenUtils.Lz)(i.size+i.outlineSize)*Card_j,n=(0,screenUtils.Lz)(a.size+a.outlineSize)*Card_j,c=o?l:l+50*Card_j,p=o?l/2+50*Card_j:l,d=function F(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const s=e.symbolLayers.at(t-1).get("resource.primitive");return"triangle"===s||"cone"===s||"tetrahedron"===s}return"triangle"===e.style}}(r),m=function Card_E(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const s=e.symbolLayers.at(t-1),i=s.resource?.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(r),h=document.createElement("canvas");h.width=c,h.height=p,h.style.width=h.width/Card_j+"px",h.style.height=h.height/Card_j+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=c/2-n/2,i=p;y.moveTo(e,t),y.lineTo(s,i);const a=c,r=0,o=c/2+n/2,l=p;y.moveTo(a,r),y.lineTo(o,l)}else{y.beginPath();const e=0,t=p/2-n/2,s=c,i=0;y.moveTo(e,t),y.lineTo(s,i);const a=0,r=p/2+n/2,o=c,l=p;y.moveTo(a,r),y.lineTo(o,l)}return y.strokeStyle="#ddd",y.stroke(),(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:h,styles:o?{display:"flex",marginTop:`-${d?0:m?l/2:0}px`,marginBottom:`-${d?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${d?0:m?l/2:0}px`,marginLeft:`-${d?0:m?n/2:0}px`}})}_renderSizeRamp(e,t){const s=e.infos,i=s[0].label,a=s[s.length-1].label;let r=s[0].preview,o=s[s.length-1].preview;const l=this._hasIndicators,c={"flex-direction":l?"column":"row-reverse"};r&&(r=r.cloneNode(!0),r.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const p={opacity:null!=t?`${t}`:""};return(0,jsxFactory.K)("div",{class:this.classes(CardCSS_r.layerRow,{[CardCSS_r.sizeRampRow]:l})},(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabel},l?i:a),(0,jsxFactory.K)("div",{class:CardCSS_r.sizeRampContainer,styles:c},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:r,class:CardCSS_r.sizeRampPreview,styles:p}),this._renderSizeRampLines(e),(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:o,class:CardCSS_r.sizeRampContainer,styles:p})),(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabel},l?a:i))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return styleUtils_a(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,s){const i=e.infos,a=e.type,l="heatmap-ramp"===a,c=i.length-1,p=25,d=c>2&&!l?25*c:100,m=d+20,h=10,y=i.slice(0).reverse(),g=y.length-1,v=y.length%2!=0?y[y.length/2|0]:null,f=v&&(0,jsxFactory.K)("div",{class:CardCSS_r.intervalSeparatorsContainer},(0,jsxFactory.K)("div",{class:CardCSS_r.intervalSeparator},"|"),(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabel},this._getRampStopLabel(v,a))),u=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:y[0].color,stroke:{width:0}},{shape:{type:"rect",x:h,y:0,width:d,height:p},fill:{type:"linear",x1:h,y1:0,x2:d+h,y2:0,colors:y.map(((e,t)=>({color:e.color,offset:l&&"ratio"in e?e.ratio:t/c})))},stroke:{width:0}},{shape:{type:"path",path:`M${d+h} 0 L${m} 12.5 L${d+h} 25 Z`},fill:y[g].color,stroke:{width:0}}]],b=(0,svgUtils.d8)(u,m,p),_={filter:(0,support_utils.di)(s)??void 0,opacity:null==t?void 0:`${t}`};return(0,jsxFactory.K)("div",{class:CardCSS_r.layerRow,styles:{justifyContent:"center"}},(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabel},this._getRampStopLabel(y[0],a)),(0,jsxFactory.K)("div",{class:CardCSS_r.symbolContainer},(0,jsxFactory.K)("div",{styles:_},b),f),(0,jsxFactory.K)("div",{class:CardCSS_r.rampLabel},this._getRampStopLabel(y[g],a)))}};(0,tslib_es6._)([(0,property.MZ)()],Card_T.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.MZ)()],Card_T.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.MZ)()],Card_T.prototype,"layout",void 0),(0,tslib_es6._)([(0,property.MZ)(),(0,messageBundle.G)("esri/widgets/Legend/t9n/Legend")],Card_T.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.MZ)(),(0,messageBundle.G)("esri/t9n/common")],Card_T.prototype,"messagesCommon",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Card_T.prototype,"type",void 0),(0,tslib_es6._)([(0,property.MZ)()],Card_T.prototype,"view",void 0),(0,tslib_es6._)([(0,accessibleHandler.$)()],Card_T.prototype,"_selectSection",null),Card_T=(0,tslib_es6._)([(0,subclass.$)("esri.widgets.Legend.styles.Card")],Card_T);const Card_U=Card_T,ClassicCSS_e="esri-legend",ClassicCSS_a={service:`${ClassicCSS_e}__service`,label:`${ClassicCSS_e}__service-label`,layer:`${ClassicCSS_e}__layer`,groupLayer:`${ClassicCSS_e}__group-layer`,groupLayerChild:`${ClassicCSS_e}__group-layer-child`,layerTable:`${ClassicCSS_e}__layer-table`,layerTableSizeRamp:`${ClassicCSS_e}__layer-table--size-ramp`,layerChildTable:`${ClassicCSS_e}__layer-child-table`,layerCaption:`${ClassicCSS_e}__layer-caption`,layerBody:`${ClassicCSS_e}__layer-body`,layerRow:`${ClassicCSS_e}__layer-row`,layerCell:`${ClassicCSS_e}__layer-cell`,layerInfo:`${ClassicCSS_e}__layer-cell ${ClassicCSS_e}__layer-cell--info`,imageryLayerStretchedImage:`${ClassicCSS_e}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${ClassicCSS_e}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${ClassicCSS_e}__imagery-layer-info--stretched`,symbolContainer:`${ClassicCSS_e}__layer-cell ${ClassicCSS_e}__layer-cell--symbols`,symbol:`${ClassicCSS_e}__symbol`,rampContainer:`${ClassicCSS_e}__ramps`,sizeRamp:`${ClassicCSS_e}__size-ramp`,colorRamp:`${ClassicCSS_e}__color-ramp`,opacityRamp:`${ClassicCSS_e}__opacity-ramp`,borderlessRamp:`${ClassicCSS_e}__borderless-ramp`,rampTick:`${ClassicCSS_e}__ramp-tick`,rampFirstTick:`${ClassicCSS_e}__ramp-tick-first`,rampLastTick:`${ClassicCSS_e}__ramp-tick-last`,rampLabelsContainer:`${ClassicCSS_e}__ramp-labels`,rampLabel:`${ClassicCSS_e}__ramp-label`,message:`${ClassicCSS_e}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};var globalCss=__webpack_require__("./node_modules/@arcgis/core/widgets/support/globalCss.js");const Classic_w=`${ClassicCSS_e}__`,R={display:"flex",alignItems:"flex-start"},Classic_A={marginLeft:"3px"},Classic_={display:"table-cell",verticalAlign:"middle"};let Classic_j=class extends Widget.A{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return(0,jsxFactory.K)("div",null,s&&s.length?s:(0,jsxFactory.K)("div",{class:ClassicCSS_a.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`${Classic_w}${e.layer.uid}-version-${e.version}`,a=e.title?(0,Heading.D)({level:this.headingLevel,class:this.classes(globalCss.D.heading,ClassicCSS_a.label)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.service,ClassicCSS_a.groupLayer),key:t},a,s)}{const s=e.legendElements;if(s&&!s.length)return null;const i=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList))).filter((e=>!!e));if(!i.length)return null;const l={[ClassicCSS_a.groupLayerChild]:!!e.parent};return(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.service,l),key:t},a,(0,jsxFactory.K)("div",{class:ClassicCSS_a.layer},i))}}_renderLegendForElement(e,s,t,a){const i="color-ramp"===e.type,o="opacity-ramp"===e.type,n="size-ramp"===e.type;let p=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,s,t,n,e.legendType))).filter((e=>!!e));a.length&&(p=(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?p=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?p=(0,relationshipUtils.p)(e,this.id,{opacity:s.opacity,effectList:t,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?p=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?p=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t):"univariate-color-size-ramp"===e.type&&(p=this._renderUnivariateColorSizeRamp(e,s.opacity,t));if(!p)return null;const d=e.title;let c=null;if("string"==typeof d)c=d;else if(d){const e=styleUtils_o(this.messages,d,i||o);c=styleUtils_l(0,i||o)&&d.title?`${d.title} (${e})`:e}const v=a?ClassicCSS_a.layerChildTable:ClassicCSS_a.layerTable,h=c?(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerCaption},c):null,g={[ClassicCSS_a.layerTableSizeRamp]:n||!a};return(0,jsxFactory.K)("div",{class:this.classes(v,g)},h,p)}_renderPieChartRamp(e){return(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:a,colorRampElement:i}=univariateUtils_d(e,s);if(!a)return null;const l=this.messages?.previewColorRampAriaLabel,c=univariateUtils_y(a,"above",!0),m=univariateUtils_y(a,"below",!0),h=univariateUtils_h(i,{width:12,height:c,rampAlignment:"vertical",opacity:s,type:"above",effectList:t,ariaLabel:l}),g=univariateUtils_h(i,{width:12,height:m,rampAlignment:"vertical",opacity:s,type:"below",effectList:t,ariaLabel:l}),u=univariateUtils_u(a),b=a.infos.map((e=>e.label)),f=b.map(((e,s)=>{const t=2===s;return 0===s?(0,jsxFactory.K)("div",{class:e?h?ClassicCSS_a.univariateAboveAndBelowLabel:ClassicCSS_a.rampLabel:void 0,key:s},e):t?(0,jsxFactory.K)("div",null):null})),w=b.length-1,C=Math.floor(b.length/2),j=b.map(((e,s)=>s===C||s===w?(0,jsxFactory.K)("div",{class:e?h?ClassicCSS_a.univariateAboveAndBelowLabel:ClassicCSS_a.rampLabel:void 0,key:s},e):null)),$={display:"table-cell",verticalAlign:"middle"},I={marginTop:`${u}px`},x={height:`${c}px`},S={height:`${m}px`};return(0,jsxFactory.K)("div",{key:"univariate-above-and-below-ramp-preview",styles:R},(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerBody},a.infos.map(((e,s)=>(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.layerRow,ClassicCSS_a.sizeRamp)},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:ClassicCSS_a.symbol,styles:$}),h||s%2!=0?null:(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerInfo},b[s]))))),h?(0,jsxFactory.K)("div",{key:"color-ramp-preview",styles:I},(0,jsxFactory.K)("div",{styles:Classic_A},(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:h,class:ClassicCSS_a.rampContainer})),(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{class:ClassicCSS_a.rampLabelsContainer,styles:x},f))),(0,jsxFactory.K)("div",{styles:Classic_A},(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:g,class:ClassicCSS_a.rampContainer})),(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{class:ClassicCSS_a.rampLabelsContainer,styles:S},j)))):null)}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:a,colorRampElement:i}=univariateUtils_b(e);if(!a)return null;const l=univariateUtils_u(a),m=univariateUtils_y(a,"full",!1),y=univariateUtils_h(i,{width:12,height:m,rampAlignment:"vertical",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),h=a.infos.length-1,g=a.infos.map(((e,s)=>0===s||s===h?(0,jsxFactory.K)("div",{class:e.label?i?ClassicCSS_a.univariateAboveAndBelowLabel:ClassicCSS_a.rampLabel:void 0,key:s},e.label):null)),u={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${l}px`},f={height:`${m}px`};return(0,jsxFactory.K)("div",{key:"univariate-above-and-below-ramp-preview",styles:R},(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerBody},a.infos.map((e=>(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.layerRow,ClassicCSS_a.sizeRamp)},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:ClassicCSS_a.symbol,styles:u}))))),(0,jsxFactory.K)("div",{key:"color-ramp-preview",styles:b},(0,jsxFactory.K)("div",{styles:Classic_A},(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:y,class:ClassicCSS_a.rampContainer})),(0,jsxFactory.K)("div",{styles:Classic_},(0,jsxFactory.K)("div",{class:ClassicCSS_a.rampLabelsContainer,styles:f},g)))))}_renderLegendForRamp(e,s){const t=e.infos,a="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,o=e.preview,n=a?ClassicCSS_a.opacityRamp:"";o.className=`${ClassicCSS_a.colorRamp} ${n}`,null!=s&&(o.style.opacity=s.toString());const p=t.map((e=>(0,jsxFactory.K)("div",{class:e.label?ClassicCSS_a.rampLabel:void 0},i?this.messages[e.label]||e.label:l?styleUtils_a(e,this.messages):e.label))),d={width:"24px"},c={height:o.style.height};return(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerRow},(0,jsxFactory.K)("div",{class:ClassicCSS_a.symbolContainer,styles:d},(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:o,class:ClassicCSS_a.rampContainer})),(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerInfo},(0,jsxFactory.K)("div",{class:ClassicCSS_a.rampLabelsContainer,styles:c},p)))}_renderLegendForElementInfo(e,s,t,a,i){if(e.type)return this._renderLegendForElement(e,s,t,!0);let l=null;const o=styleUtils_u(s,i);if(e.preview?l=(0,jsxFactory.K)("div",{afterCreate:styleUtils_i,bind:e.preview,class:ClassicCSS_a.symbol}):e.src&&(l=this._renderImage(e,s,o)),!l)return null;const n={[ClassicCSS_a.imageryLayerInfoStretched]:o},p={[ClassicCSS_a.imageryLayerInfoStretched]:o,[ClassicCSS_a.sizeRamp]:!o&&a};return(0,jsxFactory.K)("div",{class:ClassicCSS_a.layerRow},(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.symbolContainer,p)},l),(0,jsxFactory.K)("div",{class:this.classes(ClassicCSS_a.layerInfo,n)},styleUtils_o(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:a,src:i,opacity:l}=e,o={[ClassicCSS_a.imageryLayerStretchedImage]:t,[ClassicCSS_a.symbol]:!t},n={opacity:`${null!=l?l:s.opacity}`};return(0,jsxFactory.K)("img",{alt:styleUtils_o(this.messages,a,!1),"aria-label":styleUtils_o(this.messages,a,!1),border:0,class:this.classes(o),height:e.height,src:i,styles:n,width:e.width})}};(0,tslib_es6._)([(0,property.MZ)()],Classic_j.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.MZ)()],Classic_j.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.MZ)(),(0,messageBundle.G)("esri/widgets/Legend/t9n/Legend")],Classic_j.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],Classic_j.prototype,"type",void 0),Classic_j=(0,tslib_es6._)([(0,subclass.$)("esri.widgets.Legend.styles.Classic")],Classic_j);const Classic_$=Classic_j;const Legend_g={base:"esri-legend",widgetIcon:__webpack_require__("./node_modules/@arcgis/core/widgets/support/legacyIcon.js").T.layerList};let Legend_u=class extends Widget.A{constructor(e,t){super(e,t),this.headingLevel=3,this.iconClass=Legend_g.widgetIcon,this.icon=null,this.messages=null,this.style=new Classic_$,this.viewModel=new LegendViewModel_I}initialize(){this.addHandles([(0,reactiveUtils.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,reactiveUtils.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,reactiveUtils.wB)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,reactiveUtils.wB)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),reactiveUtils.Vh)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof Card_U||e instanceof Classic_$)return e;if("string"==typeof e)return"card"===e?new Card_U:new Classic_$;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Card_U:Classic_$)(t)}return new Classic_$}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return(0,jsxFactory.K)("div",{class:this.classes(Legend_g.base,globalCss.D.widget,this.style instanceof Classic_$?globalCss.D.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach((e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const r=(0,reactiveUtils.wB)((()=>e.version),(()=>this.scheduleRender()));this.addHandles(r,`version_${e.layer.uid}`);const o=(0,reactiveUtils.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),reactiveUtils.Vh);this.addHandles(o,`version_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"activeLayerInfos",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"basemapLegendVisible",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"groundLegendVisible",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"hideLayersNotInCurrentView",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"keepCacheOnDestroy",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"respectLayerVisibility",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"iconClass",void 0),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"icon",void 0),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"label",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"layerInfos",null),(0,tslib_es6._)([(0,property.MZ)(),(0,messageBundle.G)("esri/widgets/Legend/t9n/Legend")],Legend_u.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"style",void 0),(0,tslib_es6._)([(0,cast.w)("style")],Legend_u.prototype,"castStyle",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"view",null),(0,tslib_es6._)([(0,property.MZ)()],Legend_u.prototype,"viewModel",void 0),Legend_u=(0,tslib_es6._)([(0,subclass.$)("esri.widgets.Legend")],Legend_u);const Legend_L=Legend_u}}]);