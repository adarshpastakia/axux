"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[27972],{"./node_modules/@arcgis/core/core/perspectiveUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>j,r:()=>h});var _chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f64.js"),_chunks_vec2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js");const f=(0,__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js").c)(),i=(0,_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.a)(),e=(0,_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.a)(),p=(0,_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_1__.a)();function h(t,r,n){return(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__.s)(f,r[0],r[1],1),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__.t)(f,f,(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.t)(i,n)),0===f[2]?(0,_chunks_vec2_js__WEBPACK_IMPORTED_MODULE_2__.s)(t,f[0],f[1]):(0,_chunks_vec2_js__WEBPACK_IMPORTED_MODULE_2__.s)(t,f[0]/f[2],f[1]/f[2])}function j(s,n,o){return k(e,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),k(p,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.m)(s,(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.a)(e,e),p),0!==s[8]&&(s[0]/=s[8],s[1]/=s[8],s[2]/=s[8],s[3]/=s[8],s[4]/=s[8],s[5]/=s[8],s[6]/=s[8],s[7]/=s[8],s[8]/=s[8]),s}function k(o,c,u,e,p,h,j,k,v){(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.s)(o,c,e,h,u,p,j,1,1,1),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__.s)(f,k,v,1),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.a)(i,o);const[x,b,d]=(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__.t)(f,f,(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.t)(i,i));return(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.s)(i,x,0,0,0,b,0,0,0,d),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_0__.m)(o,i,o)}},"./node_modules/@arcgis/core/layers/support/MediaElementView.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>i});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_geometry_support_normalizeUtilsSync_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtilsSync.js");let i=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.c{constructor(o){super(o)}get bounds(){const o=this.coords;return null==o?.extent?null:(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.ER)(o.extent)}get coords(){const o=this.element.georeference?.coords;return(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_8__.projectOrLoad)(o,this.spatialReference).geometry}get normalizedCoords(){return _geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_7__.c.fromJSON((0,_geometry_support_normalizeUtilsSync_js__WEBPACK_IMPORTED_MODULE_10__.UH)(this.coords))}get normalizedBounds(){const o=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=o?(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.ER)(o):null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"spatialReference",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"element",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"bounds",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"coords",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"normalizedCoords",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.qq)()],i.prototype,"normalizedBounds",null),i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.c)("esri.layers.support.MediaElementView")],i)},"./node_modules/@arcgis/core/views/2d/layers/MediaLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>R});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Logger=(__webpack_require__("./node_modules/@arcgis/core/geometry.js"),__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/ClassBreaksRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/DictionaryRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/DotDensityRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/HeatmapRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/PieChartRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/Renderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/SimpleRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/UniqueValueRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/support/jsonUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/Logger.js")),Collection=(__webpack_require__("./node_modules/@arcgis/core/symbols.js"),__webpack_require__("./node_modules/@arcgis/core/core/Collection.js")),MapUtils=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js")),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),contains=__webpack_require__("./node_modules/@arcgis/core/geometry/support/contains.js"),intersectsBase=__webpack_require__("./node_modules/@arcgis/core/geometry/support/intersectsBase.js"),MediaElementView=__webpack_require__("./node_modules/@arcgis/core/layers/support/MediaElementView.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),DisplayObject=(__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking/Flags.js"),__webpack_require__("./node_modules/@arcgis/core/config.js"),__webpack_require__("./node_modules/@arcgis/core/request.js"),__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js")),mathUtils=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/HighlightGradient.js"),__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js")),contextUtils=__webpack_require__("./node_modules/@arcgis/core/views/webgl/contextUtils.js"),enums=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/BufferPool.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js")),webgl_enums=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/BrushBitmap.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BackgroundPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js")),BufferObject=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/materialKey/MaterialKey.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/Technique.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/dotDensity/TechniqueDotDensity.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/heatmap/TechniqueHeatmap.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/pieChart/TechniquePieChart.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js")),Texture=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/GLObjectType.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js")),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"),vec2f32=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushHeatmap.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DefaultVertexAttributeLayouts.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/TileInfoPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/style/StyleDefinition.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js")),vec3f32=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/sources/resolver.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BitBlitPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/sources/resolver.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TextureManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/StencilPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/effects/BlendEffect.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/HighlightPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Profiler.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/OrderIndependentTransparency.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/testSVGPremultipliedAlpha.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/LabelManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AttributeStoreView.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js")),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),TileQueue=(__webpack_require__("./node_modules/@arcgis/core/views/2d/navigation/MapViewNavigation.js"),__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/MagnifierPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileQueue.js")),TileStrategy=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileStrategy.js"),events=__webpack_require__("./node_modules/@arcgis/core/core/events.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),perspectiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/perspectiveUtils.js"),mat3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f64.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),cim_enums=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/enums.js"),utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"),TextureDescriptor=__webpack_require__("./node_modules/@arcgis/core/views/webgl/TextureDescriptor.js");const j=(0,mat3f64.a)(),V={none:cim_enums.aG.None,loop:cim_enums.aG.Loop,oscillate:cim_enums.aG.Oscillate};class T extends DisplayObject.O{constructor(s){super(),this.elementView=s,this.isWrapAround=!1,this.perspectiveTransform=(0,vec2f64.a)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,reactiveUtils.aE)((()=>this.elementView.element.opacity),(e=>this.opacity=e),reactiveUtils._8),(0,reactiveUtils.aE)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),reactiveUtils._8),(0,reactiveUtils.aE)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{this._playHandle?.remove(),this.texture=(0,maybe.yI)(this.texture),this.requestRender()}),reactiveUtils._8),(0,reactiveUtils._I)((()=>this.elementView.element.loaded),(()=>{const e=this.elementView.element;this.ready(),"video"===e.type&&null!=e.content&&this._handles.push((0,events.on)(e.content,"play",(()=>this.requestRender())))}),reactiveUtils._8)),s.element.load().catch((t=>{Logger.c.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new Error.c("element-load-error","Element cannot be displayed",{element:s,error:t}))}))}destroy(){this._playHandle?.remove(),this._handles.forEach((e=>e.remove())),this.texture=(0,maybe.yI)(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,r=this.elementView.element.content;if(null!=r){const e=r instanceof HTMLImageElement,i=r instanceof HTMLVideoElement,o=e?r.naturalWidth:i?r.videoWidth:r.width,n=e?r.naturalHeight:i?r.videoHeight:r.height;if(this._updatePerspectiveTransform(o,n),this.texture)i&&!r.paused&&(this.texture.setData(r),this.requestRender(),(t.type===contextUtils.cV.WEBGL2||(0,mathUtils.Ki)(o)&&(0,mathUtils.Ki)(n))&&this.texture.generateMipmap());else{const e=new TextureDescriptor.O;if(e.wrapMode=webgl_enums.Qz.CLAMP_TO_EDGE,e.preMultiplyAlpha=!0,e.width=o,e.height=n,"getFrame"in r){const s=r=>{this.texture?this.texture.setData(r):this.texture=new Texture.w(t,e,r),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,utils.Eb)(r,function b(e){return e?{...e,playAnimation:e.playing,repeatType:e.repeatType?V[e.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,s))}else this.texture=new Texture.w(t,e,r);(t.type===contextUtils.cV.WEBGL2||(0,mathUtils.Ki)(o)&&(0,mathUtils.Ki)(n))&&this.texture.generateMipmap(),i&&!r.paused&&this.requestRender()}}super.beforeRender(e)}_createTransforms(){return null}updateDrawCoords(e,t){const r=this.elementView.coords;if(null==r)return;const[s,i,o,n]=r.rings[0],a=this._vertices,{x:m,y:l}=e,h=0!==t;h?a.set([i[0]-m,i[1]-l,s[0]-m,s[1]-l,o[0]-m,o[1]-l,n[0]-m,n[1]-l,n[0]-m,n[1]-l,i[0]+t-m,i[1]-l,i[0]+t-m,i[1]-l,s[0]+t-m,s[1]-l,o[0]+t-m,o[1]-l,n[0]+t-m,n[1]-l]):a.set([i[0]-m,i[1]-l,s[0]-m,s[1]-l,o[0]-m,o[1]-l,n[0]-m,n[1]-l]),this.isWrapAround=h}getVAO(e,t,r){if(null==this.elementView.coords)return null;const s=this._vertices;if(this._vao)this._geometryVbo.setData(s);else{this._geometryVbo=BufferObject.g.createVertex(e,webgl_enums._m.DYNAMIC_DRAW,s);const i=BufferObject.g.createVertex(e,webgl_enums._m.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new VertexArrayObject._(e,r,t,{geometry:this._geometryVbo,tex:i})}return this._vao}_updatePerspectiveTransform(e,t){const r=this._vertices;(0,perspectiveUtils.a)(j,[0,0,e,0,0,t,e,t],[r[0],r[1],r[4],r[5],r[2],r[3],r[6],r[7]]),(0,vec2.s)(this.perspectiveTransform,j[6]/j[8]*e,j[7]/j[8]*t)}}var screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),viewpointUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/viewpointUtils.js"),brushes=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/brushes.js"),WGLContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js");class u extends WGLContainer.c{constructor(){super(...arguments),this._localOrigin=(0,screenUtils.Gy)(0,0),this._viewStateId=-1,this._dvsMat3=(0,mat3f32.c)()}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"overlay",brushes:[brushes.s.overlay],target:()=>this.children,drawPhase:enums.aM.MAP});return[...super.prepareRenderPasses(t),e]}_updateMatrices(t){const{state:i}=t,{id:l,size:d,pixelRatio:h,resolution:m,rotation:f,viewpoint:u,displayMat3:M}=i;if(this._viewStateId===l)return;const v=Math.PI/180*f,_=h*d[0],w=h*d[1],{x:g,y}=u.targetGeometry,j=(0,normalizeUtils.Se)(g,i.spatialReference);this._localOrigin.x=j,this._localOrigin.y=y;const R=m*_,b=m*w,P=(0,mat3.g)(this._dvsMat3);(0,mat3.m)(P,P,M),(0,mat3.h)(P,P,(0,vec2f32.f)(_/2,w/2)),(0,mat3.c)(P,P,(0,vec3f32.f)(_/R,-w/b,1)),(0,mat3.r)(P,P,-v),this._viewStateId=l}_updateOverlays(t,e){const{state:s}=t,{rotation:r,spatialReference:o,worldScreenWidth:a,size:i,viewpoint:n}=s,c=this._localOrigin;let p=0;const h=(0,spatialReferenceUtils.Nq)(o);if(h&&o.isWrappable){const t=i[0],l=i[1],m=180/Math.PI*r,f=Math.abs(Math.cos(m)),u=Math.abs(Math.sin(m)),M=Math.round(t*f+l*u),[v,_]=h.valid,w=(0,viewpointUtils.eU)(o),{x:g,y}=n.targetGeometry,j=[g,y],R=[0,0];s.toScreen(R,j);const b=[0,0];let P;P=M>a?.5*a:.5*M;const x=Math.floor((g+.5*w)/w),O=v+x*w,C=_+x*w,I=[R[0]+P,0];s.toMap(b,I),b[0]>C&&(p=w),I[0]=R[0]-P,s.toMap(b,I),b[0]<O&&(p=-w);for(const s of e){const t=s.elementView.bounds;if(null==t)continue;const[e,,r]=t;e<v&&r>v?s.updateDrawCoords(c,w):r>_&&e<_?s.updateDrawCoords(c,-w):s.updateDrawCoords(c,p)}}else for(const l of e)l.updateDrawCoords(c,p)}}var LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");let w=class extends((0,LayerView2D.y)(LayerView.c)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new Collection.c}attach(){this.addAttachHandles([(0,reactiveUtils.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,reactiveUtils.on)((()=>this.layer.effectiveSource),"change",(({element:e})=>this._elementUpdateHandler(e)))]),this._overlayContainer=new u,this.container.addChild(this._overlayContainer),this._fetchQueue=new TileQueue.c({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,r)=>this._queryElements(e,r)}),this._tileStrategy=new TileStrategy.c({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,r){const t=[],s=e.normalize(),i=[s.x,s.y];for(const{projectedElement:{normalizedCoords:n,element:o}}of this._elementReferences.values())null!=n&&(0,contains.Uz)(n.rings,i)&&t.push({type:"media",element:o,layer:this.layer,mapPoint:e,sourcePoint:o.toSource(e)});return t.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const r=new MediaLayerView2D_T(e.clone());return this._updateTile(r),r}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((r=>{const[t,s]=e.setElements(r);this._referenceElements(e,t),this._dereferenceElements(e,s),this.requestUpdate()}),(e=>{(0,promiseUtils.mA)(e)||Logger.c.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,r){const t=this.layer.effectiveSource;if(null==t)return[];this.view.featuresTilingScheme.getTileBounds(MediaLayerView2D_b,e,!0);const s=new Extent.c({xmin:MediaLayerView2D_b[0],ymin:MediaLayerView2D_b[1],xmax:MediaLayerView2D_b[2],ymax:MediaLayerView2D_b[3],spatialReference:this.view.spatialReference});return t.queryElements(s,r)}_referenceElements(e,r){if(null!=this.layer.source)for(const t of r)this._referenceElement(e,t)}_referenceElement(e,r){(0,MapUtils.wJ)(this._elementReferences,r.uid,(()=>{const e=new MediaElementView.S({element:r,spatialReference:this.view.spatialReference}),t=new T(e);this._overlayContainer.addChild(t),this.elements.add(r);return{tiles:new Set,projectedElement:e,overlay:t,debugGraphic:null}})).tiles.add(e)}_dereferenceElements(e,r){for(const t of r)this._dereferenceElement(e,t)}_dereferenceElement(e,r){const t=this._elementReferences.get(r.uid);t.tiles.delete(e),t.tiles.size||(this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(r.uid),this.elements.remove(r),this._debugGraphicsView?.graphics.remove(t.debugGraphic))}_elementUpdateHandler(e){let r=this._elementReferences.get(e.uid);if(r){const t=r.projectedElement.normalizedCoords;if(null==t)return this._overlayContainer.removeChild(r.overlay),r.overlay.destroy(),r.projectedElement.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(r.debugGraphic);const s=[],i=[];for(const e of this._tileStrategy.tiles){const n=v(this.view.featuresTilingScheme,e,t);r.tiles.has(e)?n||i.push(e):n&&s.push(e)}for(const r of s)this._referenceElement(r,e);for(const r of i)this._dereferenceElement(r,e);return r=this._elementReferences.get(e.uid),void(r?.debugGraphic&&(r.debugGraphic.geometry=r.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:r.debugGraphic,property:"geometry"})))}const t=new MediaElementView.S({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=t)for(const s of this._tileStrategy.tiles)v(this.view.featuresTilingScheme,s,t)&&this._referenceElement(s,e)}};(0,tslib_es6._)([(0,property.qq)()],w.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.qq)({readOnly:!0})],w.prototype,"elements",void 0),w=(0,tslib_es6._)([(0,subclass.c)("esri.views.2d.layers.MediaLayerView2D")],w);const MediaLayerView2D_b=(0,aaBoundingRect.Su)(),_={xmin:0,ymin:0,xmax:0,ymax:0};function v(e,r,t){return e.getTileBounds(MediaLayerView2D_b,r.key,!0),_.xmin=MediaLayerView2D_b[0],_.ymin=MediaLayerView2D_b[1],_.xmax=MediaLayerView2D_b[2],_.ymax=MediaLayerView2D_b[3],(0,intersectsBase.yu)(_,t)}class MediaLayerView2D_T{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const r=[],t=new Set(this.elements);this.elements=e;for(const s of e)t.has(s)?t.delete(s):r.push(s);return this.isReady=!0,[r,Array.from(t)]}destroy(){}}const R=w}}]);