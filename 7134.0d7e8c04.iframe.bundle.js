"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[7134],{"./node_modules/@arcgis/core/geometry/support/scaleUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{dp:()=>r,yZ:()=>i});var _core_unitUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js");function i(i,r){const o=r||i.extent,c=i.width,d=(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_0__.c9)(o&&o.spatialReference);return o&&c?o.width/c*d*_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_0__.hd*96:0}function r(i,r){return i/((0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_0__.c9)(r)*_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_0__.hd*96)}},"./node_modules/@arcgis/core/layers/support/ExportImageParameters.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>c});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_sql_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_commonProperties_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");const m={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let c=class extends((0,_core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_1__.p)(_core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__.Z)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__.f)(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_7__.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(m[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const s=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__.f)(this.floors,r),o=(0,_core_sql_js__WEBPACK_IMPORTED_MODULE_9__._)(s,r.definitionExpression);return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(o)&&(e[r.id]=o),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get("visibleSublayers");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"dynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)()],c.prototype,"floors",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"hasDynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)()],c.prototype,"layer",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"layers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"layerDefs",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({type:Number})],c.prototype,"scale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)(_commonProperties_js__WEBPACK_IMPORTED_MODULE_6__.qG)],c.prototype,"timeExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"version",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.layers.mixins.ExportImageParameters")],c)},"./node_modules/@arcgis/core/layers/support/floorFilterUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function o(o){const n=o.layer;return"floorInfo"in n&&n.floorInfo?.floorField&&"floors"in o.view?l(o.view.floors,n.floorInfo.floorField):null}function n(o,n){return"floorInfo"in n&&n.floorInfo?.floorField?l(o,n.floorInfo.floorField):null}function l(o,n){if(!o?.length)return null;const l=o.filter((o=>""!==o)).map((o=>`'${o}'`));return l.push("''"),`${n} IN (${l.join(",")}) OR ${n} IS NULL`}__webpack_require__.d(__webpack_exports__,{c:()=>o,f:()=>n})},"./node_modules/@arcgis/core/layers/support/sublayerUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{FN:()=>i,QV:()=>n,ac:()=>t});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js");function n(r,e,n){const i=e.flatten((({sublayers:r})=>r)).length;return i!==r.length||(!!r.some((r=>r.originIdOf("minScale")>n||r.originIdOf("maxScale")>n||r.originIdOf("renderer")>n||r.originIdOf("labelingInfo")>n||r.originIdOf("opacity")>n||r.originIdOf("labelsVisible")>n||r.originIdOf("source")>n))||!o(r,e))}function i(n,i,t){return!!n.some((n=>{const i=n.source;return!(!i||"map-layer"===i.type&&i.mapLayerId===n.id&&((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.Wi)(i.gdbVersion)||i.gdbVersion===t))||n.originIdOf("renderer")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("labelingInfo")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("opacity")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("labelsVisible")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE}))||!o(n,i)}function o(e,n){if(!e||!e.length||(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.Wi)(n))return!0;const i=n.slice().reverse().flatten((({sublayers:r})=>r&&r.toArray().reverse())).map((r=>r.id)).toArray();if(e.length>i.length)return!1;let o=0;const t=i.length;for(const{id:r}of e){for(;o<t&&i[o]!==r;)o++;if(o>=t)return!1}return!0}function t(r){return!!r&&r.some((r=>null!=r.minScale||r.layerDefinition&&null!=r.layerDefinition.minScale))}},"./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function t(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,n){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;"number"==typeof s&&(e+=s,n++)}return e/n}(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o="visualVariables"in n?r(s,n.visualVariables):s;if("simple"===n.type)return t(o,n.symbol);if("unique-value"===n.type){let e=o;return n.uniqueValueInfos?.forEach((n=>{e=t(e,n.symbol)})),e}if("class-breaks"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return"dot-density"===n.type||n.type,o}__webpack_require__.d(__webpack_exports__,{k:()=>s})},"./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>v});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),ensureType=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js")),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),BitmapContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js"),LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),GraphicsView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),HighlightGraphicContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js"),ExportStrategy=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),Error=(__webpack_require__("./node_modules/@arcgis/core/symbols.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js")),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),MapUtils=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),scaleUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/scaleUtils.js"),commonProperties=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),ExportImageParameters=__webpack_require__("./node_modules/@arcgis/core/layers/support/ExportImageParameters.js"),floorFilterUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),clickToleranceUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),utils=__webpack_require__("./node_modules/@arcgis/core/rest/utils.js"),sql=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),sublayerUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");const o=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function identify_l(r,i){const{dpi:n,gdbVersion:s,geometry:l,geometryPrecision:f,height:p,layerOption:m,mapExtent:y,maxAllowableOffset:c,returnFieldName:u,returnGeometry:d,returnUnformattedValues:g,returnZ:x,spatialReference:b,timeExtent:h,tolerance:E,width:O}=r.toJSON(),{dynamicLayers:S,layerDefs:j,layerIds:N}=a(r),J=i&&(0,maybe.pC)(i.geometry)?i.geometry:null,R={geometryPrecision:f,maxAllowableOffset:c,returnFieldName:u,returnGeometry:d,returnUnformattedValues:g,returnZ:x,tolerance:E},$=J&&J.toJSON()||l;if(R.imageDisplay=`${O},${p},${n}`,s&&(R.gdbVersion=s),$&&(delete $.spatialReference,R.geometry=JSON.stringify($),R.geometryType=(0,jsonUtils.Ji)($)),b?R.sr=b.wkid||JSON.stringify(b):$&&$.spatialReference?R.sr=o($):y&&y.spatialReference&&(R.sr=o(y)),R.time=h?[h.start,h.end].join(","):null,y){const{xmin:e,ymin:r,xmax:t,ymax:i}=y;R.mapExtent=`${e},${r},${t},${i}`}return j&&(R.layerDefs=j),S&&!j&&(R.dynamicLayers=S),R.layers="popup"===m?"visible":m,N&&!S&&(R.layers+=`:${N.join(",")}`),R}function a(r){const{mapExtent:t,floors:o,width:l,sublayers:a,layerIds:p,layerOption:m,gdbVersion:y}=r,c=a?.find((e=>null!=e.layer))?.layer?.serviceSublayers,u="popup"===m,d={},g=(0,scaleUtils.yZ)({extent:t,width:l,spatialReference:t?.spatialReference}),x=[],b=e=>{const r=0===g,t=0===e.minScale||g<=e.minScale,i=0===e.maxScale||g>=e.maxScale;if(e.visible&&(r||t&&i))if(e.sublayers)e.sublayers.forEach(b);else{if(!1===p?.includes(e.id)||u&&(!e.popupTemplate||!e.popupEnabled))return;x.unshift(e)}};if(a?.forEach(b),a&&!x.length)d.layerIds=[];else{const r=(0,sublayerUtils.FN)(x,c,y),t=x.map((e=>{const r=(0,floorFilterUtils.f)(o,e);return e.toExportImageJSON(r)}));if(r)d.dynamicLayers=JSON.stringify(t);else{if(a){let e=x.map((({id:e})=>e));p&&(e=e.filter((e=>p.includes(e)))),d.layerIds=e}else p?.length&&(d.layerIds=p);const r=function f(e,t){const i=!!e?.length,s=t.filter((e=>null!=e.definitionExpression||i&&null!=e.floorInfo));return s.length?s.map((t=>{const i=(0,floorFilterUtils.f)(e,t),s=(0,sql._)(i,t.definitionExpression);return{id:t.id,definitionExpression:s}})):null}(o,x);if((0,maybe.pC)(r)&&r.length){const e={};for(const t of r)t.definitionExpression&&(e[t.id]=t.definitionExpression);Object.keys(e).length&&(d.layerDefs=JSON.stringify(e))}}}return d}var m,geometry=__webpack_require__("./node_modules/@arcgis/core/geometry.js"),TimeExtent=__webpack_require__("./node_modules/@arcgis/core/TimeExtent.js"),JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),SpatialReference=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js");let IdentifyParameters_a=m=class extends JSONSupport.wq{constructor(t){super(t),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}static from(t){return(0,ensureType.TJ)(m,t)}};(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"dpi",void 0),(0,tslib_es6._)([(0,property.Cb)()],IdentifyParameters_a.prototype,"floors",void 0),(0,tslib_es6._)([(0,property.Cb)({type:String,json:{write:!0}})],IdentifyParameters_a.prototype,"gdbVersion",void 0),(0,tslib_es6._)([(0,property.Cb)({types:geometry.qM,json:{read:jsonUtils.im,write:!0}})],IdentifyParameters_a.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"geometryPrecision",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"height",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number],json:{write:!0}})],IdentifyParameters_a.prototype,"layerIds",void 0),(0,tslib_es6._)([(0,property.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],IdentifyParameters_a.prototype,"layerOption",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Extent.Z,json:{write:!0}})],IdentifyParameters_a.prototype,"mapExtent",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"maxAllowableOffset",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnFieldName",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnGeometry",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnM",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnUnformattedValues",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnZ",void 0),(0,tslib_es6._)([(0,property.Cb)({type:SpatialReference.Z,json:{write:!0}})],IdentifyParameters_a.prototype,"spatialReference",void 0),(0,tslib_es6._)([(0,property.Cb)()],IdentifyParameters_a.prototype,"sublayers",void 0),(0,tslib_es6._)([(0,property.Cb)({type:TimeExtent.Z,json:{write:!0}})],IdentifyParameters_a.prototype,"timeExtent",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"tolerance",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"width",void 0),IdentifyParameters_a=m=(0,tslib_es6._)([(0,subclass.j)("esri.rest.support.IdentifyParameters")],IdentifyParameters_a);const IdentifyParameters_u=IdentifyParameters_a;var reader=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/reader.js"),writer=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/writer.js"),typeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/typeUtils.js");let IdentifyResult_m=class extends JSONSupport.wq{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,t){return Graphic.Z.fromJSON({attributes:{...t.attributes},geometry:{...t.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:t,geometry:s}=r;t&&(e.attributes={...t}),(0,maybe.pC)(s)&&(e.geometry=s.toJSON(),e.geometryType=typeUtils.P$.toJSON(s.type))}};(0,tslib_es6._)([(0,property.Cb)({type:String,json:{write:!0}})],IdentifyResult_m.prototype,"displayFieldName",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Graphic.Z})],IdentifyResult_m.prototype,"feature",void 0),(0,tslib_es6._)([(0,reader.r)("feature",["attributes","geometry"])],IdentifyResult_m.prototype,"readFeature",null),(0,tslib_es6._)([(0,writer.c)("feature")],IdentifyResult_m.prototype,"writeFeature",null),(0,tslib_es6._)([(0,property.Cb)({type:Number,json:{write:!0}})],IdentifyResult_m.prototype,"layerId",void 0),(0,tslib_es6._)([(0,property.Cb)({type:String,json:{write:!0}})],IdentifyResult_m.prototype,"layerName",void 0),IdentifyResult_m=(0,tslib_es6._)([(0,subclass.j)("esri.rest.support.IdentifyResult")],IdentifyResult_m);const y=IdentifyResult_m;async function identify_f(u,i,f){const c=(i=function identify_a(r){return IdentifyParameters_u.from(r)}(i)).geometry?[i.geometry]:[],l=(0,utils.en)(u);return l.path+="/identify",(0,normalizeUtils.aX)(c).then((e=>{const t=identify_l(i,{geometry:e&&e[0]}),u=(0,utils.cv)({...l.query,f:"json",...t}),a=(0,utils.lA)(u,f);return(0,request.default)(l.path,a).then(identify_m).then((r=>function p(r,e){if(!e?.length)return r;const t=new Map;function o(r){t.set(r.id,r),r.sublayers&&r.sublayers.forEach(o)}e.forEach(o);for(const s of r.results)s.feature.sourceLayer=t.get(s.layerId);return r}(r,i.sublayers)))}))}function identify_m(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=Boolean(e.exceededTransferLimit),e.results=e.results.map((r=>y.fromJSON(r))),e}var arcadeOnDemand=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),GraphicsCollection=__webpack_require__("./node_modules/@arcgis/core/support/GraphicsCollection.js"),popupUtils=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js"),SimpleMarkerSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleMarkerSymbol.js");let _=null;const F=F=>{let I=class extends F{constructor(){super(...arguments),this._featuresResolutions=new WeakMap,this.highlightGraphics=new GraphicsCollection.J,this.updateHighlightedFeatures=(0,promiseUtils.Ds)((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){this.exportImageParameters=new ExportImageParameters.R({layer:this.layer}),this.handles.add([(0,reactiveUtils.on)((()=>this.highlightGraphics),"change",(e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e.added).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)}))])}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,r){const{layer:s}=this;if(!e)throw new Error.Z("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const i=this.layer.capabilities?.operations?.supportsQuery??!0;if(!((this.layer.capabilities?.operations?.supportsIdentify??1)&&this.layer.version>=10.5||i))throw new Error.Z("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:s});return i?this._fetchPopupFeaturesUsingQueries(e,r):this._fetchPopupFeaturesUsingIdentify(e,r)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}async _updateHighlightedFeaturesSymbols(e){for(const t of e){const e="renderer"in t.sourceLayer&&t.sourceLayer.renderer;"geometryType"in t.sourceLayer&&"point"===t.sourceLayer.geometryType&&e&&"getSymbolAsync"in e&&e.getSymbolAsync(t).then((async r=>{let s="width"in r&&"height"in r&&null!=r.width&&null!=r.height?Math.max(r.width,r.height):"size"in r?r.size:null;const i="visualVariables"in e&&e.visualVariables?.find((e=>"size"===e.type));i&&(_||(_=(await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"))).getSize),s=_(i,t,{view:this.view.type,scale:this.view.scale,shape:"simple-marker"===r.type?r.style:null})),this.highlightGraphics.includes(t)&&(t.symbol=new SimpleMarkerSymbol.Z({style:"square",size:s,xoffset:"xoffset"in r?r.xoffset:0,yoffset:"yoffset"in r?r.yoffset:0}),t.visible=!0,this.highlightGraphicUpdated(t,"symbol"))}))}}async _updateHighlightedFeaturesGeometries(e){this._highlightGeometriesResolution=e;const t=this.highlightGraphics;if(!t.length||!this.layer.capabilities.operations.supportsQuery)return;const s=this._getTargetResolution(e),i=new Map;for(const n of t)if(!this._featuresResolutions.has(n)||this._featuresResolutions.get(n)>s){const e=n.sourceLayer;(0,MapUtils.s1)(i,e,(()=>new Map)).set(n.getObjectId(),n)}const o=Array.from(i,(([e,t])=>{const r=e.createQuery();return r.objectIds=[...t.keys()],r.outFields=[e.objectIdField],r.returnGeometry=!0,r.maxAllowableOffset=s,r.outSpatialReference=this.view.spatialReference,e.queryFeatures(r)})),a=await Promise.all(o);if(!this.destroyed)for(const{features:r}of a)for(const e of r){const t=e.sourceLayer,r=i.get(t).get(e.getObjectId());r&&this.highlightGraphics.includes(r)&&(r.geometry=e.geometry,this.highlightGraphicUpdated(r,"geometry"),this._featuresResolutions.set(r,s))}}_getTargetResolution(e){const t=e*(0,unitUtils.c9)(this.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t){const r=await this._createIdentifyParameters(e,t);if((0,maybe.Wi)(r))return[];const{results:i}=await identify_f(this.layer.parsedUrl,r);return i.map((e=>e.feature))}async _createIdentifyParameters(e,t){const{floors:r,spatialReference:s,scale:o}=this.view,a=(0,maybe.pC)(t)?t.event:null,n=await this._collectPopupProviders(this.layer.sublayers,o,t);if(!n.length)return null;await Promise.all(n.map((({sublayer:e})=>e.load().catch((()=>{})))));const l=Math.min((0,has.Z)("mapimagelayer-popup-identify-max-tolerance"),this.layer.allSublayers.reduce(((e,t)=>t.renderer?(0,clickToleranceUtils.k)({renderer:t.renderer,event:a}):e),2)),p=this.createFetchPopupFeaturesQueryGeometry(e,l),u=(0,scaleUtils.dp)(o,s),m=Math.round(p.width/u),y=new Extent.Z({xmin:p.center.x-u*m,ymin:p.center.y-u*m,xmax:p.center.x+u*m,ymax:p.center.y+u*m,spatialReference:p.spatialReference});return new IdentifyParameters_u({floors:r,gdbVersion:this.layer.gdbVersion,geometry:e,height:m,layerOption:"popup",mapExtent:y,returnGeometry:!0,spatialReference:s,sublayers:this.layer.sublayers,timeExtent:this.timeExtent,tolerance:l,width:m})}async _fetchPopupFeaturesUsingQueries(e,t){const r=await this._collectPopupProviders(this.layer.sublayers,this.view.scale,t),s=(0,maybe.pC)(t)?t.event:null,o=r.map((async({sublayer:t,popupTemplate:r})=>{await t.load().catch((()=>{}));const o=t.createQuery(),a=(0,clickToleranceUtils.k)({renderer:t.renderer,event:s}),n=this.createFetchPopupFeaturesQueryGeometry(e,a);if(o.geometry=n,o.outFields=await(0,popupUtils.e)(t,r),o.timeExtent=this.timeExtent,"floors"in this.view){const e=this.view?.floors?.clone(),r=(0,floorFilterUtils.f)(e,t);(0,maybe.pC)(r)&&(o.where=o.where?`(${o.where}) AND (${r})`:r)}const l=this._getTargetResolution(n.width/a),p=await this._loadArcadeModules(r),u="point"===t.geometryType||p&&p.arcadeUtils.hasGeometryOperations(r);u||(o.maxAllowableOffset=l);const{features:h}=await t.queryFeatures(o),c=u?0:l;for(const e of h)this._featuresResolutions.set(e,c);return h}));return(await(0,promiseUtils.as)(o)).reverse().reduce(((e,t)=>t.value?[...e,...t.value]:e),[]).filter((e=>null!=e))}async _collectPopupProviders(e,t,r){const s=[],o=async e=>{const a=0===e.minScale||t<=e.minScale,n=0===e.maxScale||t>=e.maxScale;if(e.visible&&a&&n)if(e.sublayers)e.sublayers.forEach(o);else if(e.popupEnabled){const t=(0,popupUtils.V)(e,{...r,defaultPopupTemplateEnabled:!1});(0,maybe.pC)(t)&&s.unshift({sublayer:e,popupTemplate:t})}},a=e.toArray().reverse().map(o);return await Promise.all(a),s}_loadArcadeModules(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return(0,arcadeOnDemand.LC)()}};return(0,tslib_es6._)([(0,property.Cb)()],I.prototype,"highlightGraphics",void 0),(0,tslib_es6._)([(0,property.Cb)()],I.prototype,"exportImageParameters",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],I.prototype,"exportImageVersion",null),(0,tslib_es6._)([(0,property.Cb)()],I.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],I.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)(commonProperties.qG)],I.prototype,"timeExtent",void 0),I=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.MapImageLayerView")],I),I};var RefreshableLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"),drapedUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/drapedUtils.js");let MapImageLayerView2D_f=class extends(F((0,RefreshableLayerView.Z)((0,LayerView2D.y)(LayerView.Z)))){update(e){this.strategy.update(e).catch((e=>{(0,promiseUtils.D_)(e)||Logger.Z.getLogger(this.declaredClass).error(e)})),e.stationary&&this.updateHighlightedFeatures(e.state.resolution),this._highlightView.processUpdate(e)}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:i}=this.layer,r=i>=10.3,s=i>=10;this._bitmapContainer=new BitmapContainer.c,this.container.addChild(this._bitmapContainer),this._highlightView=new GraphicsView2D.Z({view:this.view,graphics:this.highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new HighlightGraphicContainer.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container),this.strategy=new ExportStrategy.Z({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:r,imageNormalizationSupported:s,hidpi:!0}),this.handles.add((0,reactiveUtils.YP)((()=>this.exportImageVersion),(()=>this.requestUpdate())),"exportImageVersion"),this.handles.add((0,reactiveUtils.YP)((()=>this.view?.floors),(()=>this.requestUpdate())),"view.floors"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e){let r=null;if(e instanceof Graphic.Z?r=[e]:Collection.Z.isCollection(e)&&e.length>0?r=e.toArray():Array.isArray(e)&&e.length>0&&(r=e),r=r?.filter(Boolean),!r||!r.length)return{remove:()=>{}};for(const t of r)"geometryType"in t.sourceLayer&&"point"===t.sourceLayer.geometryType&&(t.visible=!1);return this.highlightGraphics.addMany(r),{remove:()=>{this.highlightGraphics.removeMany(r)}}}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}createFetchPopupFeaturesQueryGeometry(e,t){return(0,drapedUtils.K)(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}highlightGraphicUpdated(e,t){this._highlightView.graphicUpdateHandler({graphic:e,property:t})}fetchImage(e,t,i,r){return this.layer.fetchImage(e,t,i,{timeExtent:this.timeExtent,floors:this.view.floors,...r})}fetchImageBitmap(e,t,i,r){return this.layer.fetchImageBitmap(e,t,i,{timeExtent:this.timeExtent,floors:this.view.floors,...r})}};(0,tslib_es6._)([(0,property.Cb)()],MapImageLayerView2D_f.prototype,"strategy",void 0),(0,tslib_es6._)([(0,property.Cb)()],MapImageLayerView2D_f.prototype,"updating",void 0),MapImageLayerView2D_f=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.MapImageLayerView2D")],MapImageLayerView2D_f);const v=MapImageLayerView2D_f},"./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>n});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");let i=class extends _BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_7__.Z{doRender(e){e.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.jx.HIGHLIGHT&&super.doRender(e)}renderChildren(e){if(this.attributeView.update(),!this.children.some((e=>e.hasData)))return;this.attributeView.bindTextures(e.context),super.renderChildren(e);const{painter:r}=e,s=r.effects.highlight;s.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(_webgl_enums_js__WEBPACK_IMPORTED_MODULE_8__.lk.COLOR_BUFFER_BIT),this._renderChildren(e,s.defines.concat(["highlightAll"])),s.draw(e),s.unbind()}};i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],i);const n=i},"./node_modules/@arcgis/core/views/layers/support/popupUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>s,e:()=>d});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");async function d(l,d=l.popupTemplate){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.Wi)(d))return[];const s=await d.getRequiredFields(l.fieldsIndex),{lastEditInfoEnabled:i}=d,{objectIdField:n,typeIdField:u,globalIdField:a,relationships:o}=l;if(s.includes("*"))return["*"];const r=i?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(l):[],f=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(l.fieldsIndex,[...s,...r]);return u&&f.push(u),f&&n&&l.fieldsIndex.has(n)&&!f.includes(n)&&f.push(n),f&&a&&l.fieldsIndex.has(a)&&!f.includes(a)&&f.push(a),o&&o.forEach((e=>{const{keyField:p}=e;f&&p&&l.fieldsIndex.has(p)&&!f.includes(p)&&f.push(p)})),f}function s(e,p){return e.popupTemplate?e.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p)&&p.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},"./node_modules/@arcgis/core/views/support/drapedUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>a});__webpack_require__("./node_modules/@arcgis/core/geometry.js");var _core_maybe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");function a(t,n,a,o=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__.Z){let s;if("2d"===a.type)s=n*a.resolution;else if("3d"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__.pC)(o)&&!o.equals(a.spatialReference)?(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.c9)(o)/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.c9)(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__.Z}}]);