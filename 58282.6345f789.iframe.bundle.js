(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[58282],{"./node_modules/@antv/algorithm/es/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{hb:()=>getConnectedComponents,CK:()=>depthFirstSearch,Lg:()=>findShortestPath});var defaultComparator=function defaultComparator(a,b){return a===b},LinkedListNode=function(){function LinkedListNode(value,next){void 0===next&&(next=null),this.value=value,this.next=next}return LinkedListNode.prototype.toString=function(callback){return callback?callback(this.value):"".concat(this.value)},LinkedListNode}();const linked_list=function(){function LinkedList(comparator){void 0===comparator&&(comparator=defaultComparator),this.head=null,this.tail=null,this.compare=comparator}return LinkedList.prototype.prepend=function(value){var newNode=new LinkedListNode(value,this.head);return this.head=newNode,this.tail||(this.tail=newNode),this},LinkedList.prototype.append=function(value){var newNode=new LinkedListNode(value);return this.head?(this.tail.next=newNode,this.tail=newNode,this):(this.head=newNode,this.tail=newNode,this)},LinkedList.prototype.delete=function(value){if(!this.head)return null;for(var deleteNode=null;this.head&&this.compare(this.head.value,value);)deleteNode=this.head,this.head=this.head.next;var currentNode=this.head;if(null!==currentNode)for(;currentNode.next;)this.compare(currentNode.next.value,value)?(deleteNode=currentNode.next,currentNode.next=currentNode.next.next):currentNode=currentNode.next;return this.compare(this.tail.value,value)&&(this.tail=currentNode),deleteNode},LinkedList.prototype.find=function(_a){var _b=_a.value,value=void 0===_b?void 0:_b,_c=_a.callback,callback=void 0===_c?void 0:_c;if(!this.head)return null;for(var currentNode=this.head;currentNode;){if(callback&&callback(currentNode.value))return currentNode;if(void 0!==value&&this.compare(currentNode.value,value))return currentNode;currentNode=currentNode.next}return null},LinkedList.prototype.deleteTail=function(){var deletedTail=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,deletedTail;for(var currentNode=this.head;currentNode.next;)currentNode.next.next?currentNode=currentNode.next:currentNode.next=null;return this.tail=currentNode,deletedTail},LinkedList.prototype.deleteHead=function(){if(!this.head)return null;var deletedHead=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),deletedHead},LinkedList.prototype.fromArray=function(values){var _this=this;return values.forEach((function(value){return _this.append(value)})),this},LinkedList.prototype.toArray=function(){for(var nodes=[],currentNode=this.head;currentNode;)nodes.push(currentNode),currentNode=currentNode.next;return nodes},LinkedList.prototype.reverse=function(){for(var currentNode=this.head,prevNode=null,nextNode=null;currentNode;)nextNode=currentNode.next,currentNode.next=prevNode,prevNode=currentNode,currentNode=nextNode;this.tail=this.head,this.head=prevNode},LinkedList.prototype.toString=function(callback){return void 0===callback&&(callback=void 0),this.toArray().map((function(node){return node.toString(callback)})).toString()},LinkedList}();!function(){function Queue(){this.linkedList=new linked_list}Queue.prototype.isEmpty=function(){return!this.linkedList.head},Queue.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},Queue.prototype.enqueue=function(value){this.linkedList.append(value)},Queue.prototype.dequeue=function(){var removeHead=this.linkedList.deleteHead();return removeHead?removeHead.value:null},Queue.prototype.toString=function(callback){return this.linkedList.toString(callback)}}();var getNeighbors=function getNeighbors(nodeId,edges,type){void 0===edges&&(edges=[]);var currentEdges=edges.filter((function(edge){return edge.source===nodeId||edge.target===nodeId}));if("target"===type){return currentEdges.filter((function neighhborsConverter_1(edge){return edge.source===nodeId})).map((function(edge){return edge.target}))}if("source"===type){return currentEdges.filter((function neighhborsConverter_2(edge){return edge.target===nodeId})).map((function(edge){return edge.source}))}return currentEdges.map((function neighhborsConverter(edge){return edge.source===nodeId?edge.target:edge.source}))},getEdgesByNodeId=function getEdgesByNodeId(nodeId,edges){return edges.filter((function(edge){return edge.source===nodeId||edge.target===nodeId}))};var detectConnectedComponents=function detectConnectedComponents(graphData){for(var _a=graphData.nodes,nodes=void 0===_a?[]:_a,_b=graphData.edges,edges=void 0===_b?[]:_b,allComponents=[],visited={},nodeStack=[],getComponent=function getComponent(node){nodeStack.push(node),visited[node.id]=!0;for(var neighbors=getNeighbors(node.id,edges),_loop_1=function _loop_1(i){var neighbor=neighbors[i];if(!visited[neighbor]){var targetNode=nodes.filter((function(node){return node.id===neighbor}));targetNode.length>0&&getComponent(targetNode[0])}},i=0;i<neighbors.length;++i)_loop_1(i)},i=0;i<nodes.length;i++){var node=nodes[i];if(!visited[node.id]){getComponent(node);for(var component=[];nodeStack.length>0;)component.push(nodeStack.pop());allComponents.push(component)}}return allComponents},detectStrongConnectComponents=function detectStrongConnectComponents(graphData){for(var _a=graphData.nodes,nodes=void 0===_a?[]:_a,_b=graphData.edges,edges=void 0===_b?[]:_b,nodeStack=[],inStack={},indices={},lowLink={},allComponents=[],index=0,getComponent=function getComponent(node){indices[node.id]=index,lowLink[node.id]=index,index+=1,nodeStack.push(node),inStack[node.id]=!0;for(var neighbors=getNeighbors(node.id,edges,"target").filter((function(n){return nodes.map((function(node){return node.id})).indexOf(n)>-1})),_loop_2=function _loop_2(i){var targetNodeID=neighbors[i];if(indices[targetNodeID]||0===indices[targetNodeID])inStack[targetNodeID]&&(lowLink[node.id]=Math.min(lowLink[node.id],indices[targetNodeID]));else{var targetNode=nodes.filter((function(node){return node.id===targetNodeID}));targetNode.length>0&&getComponent(targetNode[0]),lowLink[node.id]=Math.min(lowLink[node.id],lowLink[targetNodeID])}},i=0;i<neighbors.length;i++)_loop_2(i);if(lowLink[node.id]===indices[node.id]){for(var component=[];nodeStack.length>0;){var tmpNode=nodeStack.pop();if(inStack[tmpNode.id]=!1,component.push(tmpNode),tmpNode===node)break}component.length>0&&allComponents.push(component)}},_i=0,nodes_1=nodes;_i<nodes_1.length;_i++){var node=nodes_1[_i];indices[node.id]||0===indices[node.id]||getComponent(node)}return allComponents};function getConnectedComponents(graphData,directed){return directed?detectStrongConnectComponents(graphData):detectConnectedComponents(graphData)}function depthFirstSearchRecursive(graphData,currentNode,previousNode,callbacks,directed){void 0===directed&&(directed=!0),callbacks.enter({current:currentNode,previous:previousNode});var _a=graphData.edges;getNeighbors(currentNode,void 0===_a?[]:_a,directed?"target":void 0).forEach((function(nextNode){callbacks.allowTraversal({previous:previousNode,current:currentNode,next:nextNode})&&depthFirstSearchRecursive(graphData,nextNode,currentNode,callbacks,directed)})),callbacks.leave({current:currentNode,previous:previousNode})}function depthFirstSearch(graphData,startNodeId,callbacks,directed){void 0===directed&&(directed=!0),depthFirstSearchRecursive(graphData,startNodeId,"",function dfs_initCallbacks(callbacks){void 0===callbacks&&(callbacks={});var seen,initiatedCallback=callbacks,stubCallback=function stubCallback(){},allowTraversalCallback=(seen={},function(_a){var next=_a.next;return!seen[next]&&(seen[next]=!0,!0)});return initiatedCallback.allowTraversal=callbacks.allowTraversal||allowTraversalCallback,initiatedCallback.enter=callbacks.enter||stubCallback,initiatedCallback.leave=callbacks.leave||stubCallback,initiatedCallback}(callbacks),directed)}var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),is_type_toString={}.toString;const is_type=function(value,type){return is_type_toString.call(value)==="[object "+type+"]"},is_function=function(value){return is_type(value,"Function")},is_array=function(value){return Array.isArray?Array.isArray(value):is_type(value,"Array")};const esm_each=function each_each(elements,func){var value,type;if(elements)if(is_array(elements))for(var i=0,len=elements.length;i<len&&!1!==func(elements[i],i);i++);else if(type=typeof(value=elements),null!==value&&"object"===type||"function"===type)for(var k in elements)if(elements.hasOwnProperty(k)&&!1===func(elements[k],k))break};Object.keys;var arrPrototype=Array.prototype;arrPrototype.splice,arrPrototype.indexOf;Array.prototype.splice;const is_string=function(str){return is_type(str,"String")};Object.prototype.hasOwnProperty;const is_number=function(value){return is_type(value,"Number")};Number.isInteger&&Number.isInteger;Math.PI;Math.PI;const esm_values=Object.values?function(obj){return Object.values(obj)}:function(obj){var result=[];return esm_each(obj,(function(value,key){is_function(obj)&&"prototype"===key||result.push(value)})),result};Object.prototype;var clone=function(obj){if("object"!=typeof obj||null===obj)return obj;var rst;if(is_array(obj)){rst=[];for(var i=0,l=obj.length;i<l;i++)"object"==typeof obj[i]&&null!=obj[i]?rst[i]=clone(obj[i]):rst[i]=obj[i]}else for(var k in rst={},obj)"object"==typeof obj[k]&&null!=obj[k]?rst[k]=clone(obj[k]):rst[k]=obj[k];return rst};const esm_clone=clone;Object.prototype.hasOwnProperty;Object.prototype.hasOwnProperty;var ctx;!function(f,resolver){if(!is_function(f))throw new TypeError("Expected a function");var memoized=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=f.apply(this,args);return cache.set(key,result),result};memoized.cache=new Map}((function(text,font){void 0===font&&(font={});var fontSize=font.fontSize,fontFamily=font.fontFamily,fontWeight=font.fontWeight,fontStyle=font.fontStyle,fontVariant=font.fontVariant;return ctx||(ctx=document.createElement("canvas").getContext("2d")),ctx.font=[fontStyle,fontVariant,fontWeight,fontSize+"px",fontFamily].join(" "),ctx.measureText(is_string(text)?text:"").width}),(function(text,font){return void 0===font&&(font={}),(0,tslib_es6.aN)([text],esm_values(font)).join("")}));!function(){function default_1(){this.map={}}default_1.prototype.has=function(key){return void 0!==this.map[key]},default_1.prototype.get=function(key,def){var v=this.map[key];return void 0===v?def:v},default_1.prototype.set=function(key,value){this.map[key]=value},default_1.prototype.clear=function(){this.map={}},default_1.prototype.delete=function(key){delete this.map[key]},default_1.prototype.size=function(){return Object.keys(this.map).length}}();const es_dijkstra=function dijkstra(graphData,source,directed,weightPropertyName){var _a=graphData.nodes,nodes=void 0===_a?[]:_a,_b=graphData.edges,edges=void 0===_b?[]:_b,nodeIds=[],marks={},D={},prevs={};nodes.forEach((function(node,i){var id=node.id;nodeIds.push(id),D[id]=1/0,id===source&&(D[id]=0)}));for(var nodeNum=nodes.length,_loop_1=function _loop_1(i){var minNode=function minVertex(D,nodes,marks){for(var minNode,minDis=1/0,i=0;i<nodes.length;i++){var nodeId=nodes[i].id;!marks[nodeId]&&D[nodeId]<=minDis&&(minDis=D[nodeId],minNode=nodes[i])}return minNode}(D,nodes,marks),minNodeId=minNode.id;if(marks[minNodeId]=!0,D[minNodeId]===1/0)return"continue";var relatedEdges=[];relatedEdges=directed?function getOutEdgesNodeId(nodeId,edges){return edges.filter((function(edge){return edge.source===nodeId}))}(minNodeId,edges):getEdgesByNodeId(minNodeId,edges),relatedEdges.forEach((function(edge){var edgeTarget=edge.target,edgeSource=edge.source,w=edgeTarget===minNodeId?edgeSource:edgeTarget,weight=weightPropertyName&&edge[weightPropertyName]?edge[weightPropertyName]:1;D[w]>D[minNode.id]+weight?(D[w]=D[minNode.id]+weight,prevs[w]=[minNode.id]):D[w]===D[minNode.id]+weight&&prevs[w].push(minNode.id)}))},i=0;i<nodeNum;i++)_loop_1();prevs[source]=[source];var paths={};for(var target in D)D[target]!==1/0&&findAllPaths(source,target,prevs,paths);var path={};for(var target in paths)path[target]=paths[target][0];return{length:D,path,allPath:paths}};function findAllPaths(source,target,prevs,foundPaths){if(source===target)return[source];if(foundPaths[target])return foundPaths[target];for(var paths=[],_i=0,_a=prevs[target];_i<_a.length;_i++){var prevPaths=findAllPaths(source,_a[_i],prevs,foundPaths);if(!prevPaths)return;for(var _b=0,prevPaths_1=prevPaths;_b<prevPaths_1.length;_b++){var prePath=prevPaths_1[_b];is_array(prePath)?paths.push((0,tslib_es6.fX)((0,tslib_es6.fX)([],prePath,!0),[target],!1)):paths.push([prePath,target])}}return foundPaths[target]=paths,foundPaths[target]}var findShortestPath=function findShortestPath(graphData,start,end,directed,weightPropertyName){var _a=es_dijkstra(graphData,start,directed,weightPropertyName),length=_a.length,path=_a.path,allPath=_a.allPath;return{length:length[end],path:path[end],allPath:allPath[end]}};!function(){function Vector(arr){this.arr=arr}Vector.prototype.getArr=function(){return this.arr||[]},Vector.prototype.add=function(otherVector){var _a,otherArr=otherVector.arr;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length))return new Vector(otherArr);if(!(null==otherArr?void 0:otherArr.length))return new Vector(this.arr);if(this.arr.length===otherArr.length){var res=[];for(var index in this.arr)res[index]=this.arr[index]+otherArr[index];return new Vector(res)}},Vector.prototype.subtract=function(otherVector){var _a,otherArr=otherVector.arr;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length))return new Vector(otherArr);if(!(null==otherArr?void 0:otherArr.length))return new Vector(this.arr);if(this.arr.length===otherArr.length){var res=[];for(var index in this.arr)res[index]=this.arr[index]-otherArr[index];return new Vector(res)}},Vector.prototype.avg=function(length){var res=[];if(0!==length)for(var index in this.arr)res[index]=this.arr[index]/length;return new Vector(res)},Vector.prototype.negate=function(){var res=[];for(var index in this.arr)res[index]=-this.arr[index];return new Vector(res)},Vector.prototype.squareEuclideanDistance=function(otherVector){var _a,otherArr=otherVector.arr;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length)||!(null==otherArr?void 0:otherArr.length))return 0;if(this.arr.length===otherArr.length){var res=0;for(var index in this.arr)res+=Math.pow(this.arr[index]-otherVector.arr[index],2);return res}},Vector.prototype.euclideanDistance=function(otherVector){var _a,otherArr=otherVector.arr;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length)||!(null==otherArr?void 0:otherArr.length))return 0;if(this.arr.length===otherArr.length){var res=0;for(var index in this.arr)res+=Math.pow(this.arr[index]-otherVector.arr[index],2);return Math.sqrt(res)}console.error("The two vectors are unequal in length.")},Vector.prototype.normalize=function(){var res=[],cloneArr=esm_clone(this.arr);cloneArr.sort((function(a,b){return a-b}));var max=cloneArr[cloneArr.length-1],min=cloneArr[0];for(var index in this.arr)res[index]=(this.arr[index]-min)/(max-min);return new Vector(res)},Vector.prototype.norm2=function(){var _a;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length))return 0;var res=0;for(var index in this.arr)res+=Math.pow(this.arr[index],2);return Math.sqrt(res)},Vector.prototype.dot=function(otherVector){var _a,otherArr=otherVector.arr;if(!(null===(_a=this.arr)||void 0===_a?void 0:_a.length)||!(null==otherArr?void 0:otherArr.length))return 0;if(this.arr.length===otherArr.length){var res=0;for(var index in this.arr)res+=this.arr[index]*otherVector.arr[index];return res}console.error("The two vectors are unequal in length.")},Vector.prototype.equal=function(otherVector){var _a,otherArr=otherVector.arr;if((null===(_a=this.arr)||void 0===_a?void 0:_a.length)!==(null==otherArr?void 0:otherArr.length))return!1;for(var index in this.arr)if(this.arr[index]!==otherArr[index])return!1;return!0}}();var DistanceType;!function(DistanceType){DistanceType.EuclideanDistance="euclideanDistance"}(DistanceType||(DistanceType={}));!function(){function UnionFind(items){this.count=items.length,this.parent={};for(var _i=0,items_1=items;_i<items_1.length;_i++){var i=items_1[_i];this.parent[i]=i}}UnionFind.prototype.find=function(item){for(;this.parent[item]!==item;)item=this.parent[item];return item},UnionFind.prototype.union=function(a,b){var rootA=this.find(a),rootB=this.find(b);rootA!==rootB&&(rootA<rootB?(this.parent[b]!==b&&this.union(this.parent[b],a),this.parent[b]=this.parent[a]):(this.parent[a]!==a&&this.union(this.parent[a],b),this.parent[a]=this.parent[b]))},UnionFind.prototype.connected=function(a,b){return this.find(a)===this.find(b)}}();var defaultCompare=function defaultCompare(a,b){return a-b};!function(){function MinBinaryHeap(compareFn){void 0===compareFn&&(compareFn=defaultCompare),this.compareFn=compareFn,this.list=[]}MinBinaryHeap.prototype.getLeft=function(index){return 2*index+1},MinBinaryHeap.prototype.getRight=function(index){return 2*index+2},MinBinaryHeap.prototype.getParent=function(index){return 0===index?null:Math.floor((index-1)/2)},MinBinaryHeap.prototype.isEmpty=function(){return this.list.length<=0},MinBinaryHeap.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},MinBinaryHeap.prototype.delMin=function(){var top=this.top(),bottom=this.list.pop();return this.list.length>0&&(this.list[0]=bottom,this.moveDown(0)),top},MinBinaryHeap.prototype.insert=function(value){if(null!==value){this.list.push(value);var index=this.list.length-1;return this.moveUp(index),!0}return!1},MinBinaryHeap.prototype.moveUp=function(index){for(var parent=this.getParent(index);index&&index>0&&this.compareFn(this.list[parent],this.list[index])>0;){var tmp=this.list[parent];this.list[parent]=this.list[index],this.list[index]=tmp,index=parent,parent=this.getParent(index)}},MinBinaryHeap.prototype.moveDown=function(index){var _a,element=index,left=this.getLeft(index),right=this.getRight(index),size=this.list.length;null!==left&&left<size&&this.compareFn(this.list[element],this.list[left])>0?element=left:null!==right&&right<size&&this.compareFn(this.list[element],this.list[right])>0&&(element=right),index!==element&&(_a=[this.list[element],this.list[index]],this.list[index]=_a[0],this.list[element]=_a[1],this.moveDown(element))}}();var Edge=function Edge(id,from,to,label){void 0===id&&(id=-1),void 0===from&&(from=-1),void 0===to&&(to=-1),void 0===label&&(label="-1"),this.id=id,this.from=from,this.to=to,this.label=label},Node=function(){function Node(id,label){void 0===id&&(id=-1),void 0===label&&(label="-1"),this.id=id,this.label=label,this.edges=[],this.edgeMap={}}return Node.prototype.addEdge=function(edge){this.edges.push(edge),this.edgeMap[edge.id]=edge},Node}(),Graph=function(){function Graph(id,edgeIdAutoIncrease,directed){void 0===id&&(id=-1),void 0===edgeIdAutoIncrease&&(edgeIdAutoIncrease=!0),void 0===directed&&(directed=!1),this.id=id,this.edgeIdAutoIncrease=edgeIdAutoIncrease,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=directed}return Graph.prototype.getNodeNum=function(){return this.nodes.length},Graph.prototype.addNode=function(id,label){if(!this.nodeMap[id]){var node=new Node(id,label);this.nodes.push(node),this.nodeMap[id]=node,this.nodeLabelMap[label]||(this.nodeLabelMap[label]=[]),this.nodeLabelMap[label].push(id)}},Graph.prototype.addEdge=function(id,from,to,label){if((this.edgeIdAutoIncrease||void 0===id)&&(id=this.counter++),!(this.nodeMap[from]&&this.nodeMap[to]&&this.nodeMap[to].edgeMap[id])){var edge=new Edge(id,from,to,label);if(this.edges.push(edge),this.edgeMap[id]=edge,this.nodeMap[from].addEdge(edge),this.edgeLabelMap[label]||(this.edgeLabelMap[label]=[]),this.edgeLabelMap[label].push(edge),!this.directed){var rEdge=new Edge(id,to,from,label);this.nodeMap[to].addEdge(rEdge),this.edgeLabelMap[label].push(rEdge)}}},Graph}(),DFSedge=function(){function DFSedge(fromNode,toNode,fromNodeLabel,edgeLabel,toNodeLabel){this.fromNode=fromNode,this.toNode=toNode,this.nodeEdgeNodeLabel={nodeLabel1:fromNodeLabel||"-1",edgeLabel:edgeLabel||"-1",nodeLabel2:toNodeLabel||"-1"}}return DFSedge.prototype.equalTo=function(other){return this.fromNode===other.formNode&&this.toNode===other.toNode&&this.nodeEdgeNodeLabel===other.nodeEdgeNodeLabel},DFSedge.prototype.notEqualTo=function(other){return!this.equalTo(other)},DFSedge}(),DFScode=function(){function DFScode(){this.rmpath=[],this.dfsEdgeList=[]}return DFScode.prototype.equalTo=function(other){var aLength=this.dfsEdgeList.length;if(aLength!==other.length)return!1;for(var i=0;i<aLength;i++)if(this.dfsEdgeList[i]!==other[i])return!1;return!0},DFScode.prototype.notEqualTo=function(other){return!this.equalTo(other)},DFScode.prototype.pushBack=function(fromNode,toNode,fromNodeLabel,edgeLabel,toNodeLabel){return this.dfsEdgeList.push(new DFSedge(fromNode,toNode,fromNodeLabel,edgeLabel,toNodeLabel)),this.dfsEdgeList},DFScode.prototype.toGraph=function(graphId,directed){void 0===graphId&&(graphId=-1),void 0===directed&&(directed=!1);var graph=new Graph(graphId,!0,directed);return this.dfsEdgeList.forEach((function(dfsEdge){var fromNodeId=dfsEdge.fromNode,toNodeId=dfsEdge.toNode,_a=dfsEdge.nodeEdgeNodeLabel,nodeLabel1=_a.nodeLabel1,edgeLabel=_a.edgeLabel,nodeLabel2=_a.nodeLabel2;"-1"!==nodeLabel1&&graph.addNode(fromNodeId,nodeLabel1),"-1"!==nodeLabel2&&graph.addNode(toNodeId,nodeLabel2),"-1"!==nodeLabel1&&nodeLabel2!==nodeLabel1&&graph.addEdge(void 0,fromNodeId,toNodeId,edgeLabel)})),graph},DFScode.prototype.buildRmpath=function(){this.rmpath=[];for(var oldFrom=void 0,i=this.dfsEdgeList.length-1;i>=0;i--){var dfsEdge=this.dfsEdgeList[i],fromNodeIdx=dfsEdge.fromNode,toNodeIdx=dfsEdge.toNode;fromNodeIdx<toNodeIdx&&(void 0===oldFrom||toNodeIdx===oldFrom)&&(this.rmpath.push(i),oldFrom=fromNodeIdx)}return this.rmpath},DFScode.prototype.getNodeNum=function(){var nodeMap={};return this.dfsEdgeList.forEach((function(dfsEdge){nodeMap[dfsEdge.fromNode]||(nodeMap[dfsEdge.fromNode]=!0),nodeMap[dfsEdge.toNode]||(nodeMap[dfsEdge.toNode]=!0)})),Object.keys(nodeMap).length},DFScode}(),History=function(){function History(pdfs){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],pdfs){for(;pdfs;){var e=pdfs.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,pdfs=pdfs.preNode}this.edges=this.edges.reverse()}}return History.prototype.hasNode=function(node){return 1===this.nodesUsed[node.id]},History.prototype.hasEdge=function(edge){return 1===this.edgesUsed[edge.id]},History}();!function(){function GSpan(_a){var graphs=_a.graphs,_b=_a.minSupport,minSupport=void 0===_b?2:_b,_c=_a.minNodeNum,minNodeNum=void 0===_c?1:_c,_d=_a.maxNodeNum,maxNodeNum=void 0===_d?4:_d,_e=_a.top,top=void 0===_e?10:_e,_f=_a.directed,directed=void 0!==_f&&_f,_g=_a.verbose,verbose=void 0!==_g&&_g;this.graphs=graphs,this.dfsCode=new DFScode,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=minSupport,this.top=top,this.directed=directed,this.counter=0,this.maxNodeNum=maxNodeNum,this.minNodeNum=minNodeNum,this.verbose=verbose,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}GSpan.prototype.findForwardRootEdges=function(graph,fromNode){var _this=this,result=[],nodeMap=graph.nodeMap;return fromNode.edges.forEach((function(edge){(_this.directed||fromNode.label<=nodeMap[edge.to].label)&&result.push(edge)})),result},GSpan.prototype.findBackwardEdge=function(graph,edge1,edge2,history){if(!this.directed&&edge1===edge2)return null;for(var nodeMap=graph.nodeMap,edge2ToEdges=nodeMap[edge2.to].edges,edgeLength=edge2ToEdges.length,i=0;i<edgeLength;i++){var edge=edge2ToEdges[i];if(!history.hasEdge(edge)&&edge.to===edge1.from)if(this.directed){if(nodeMap[edge1.from].label<nodeMap[edge2.to].label||nodeMap[edge1.from].label===nodeMap[edge2.to].label&&edge1.label<=edge.label)return edge}else if(edge1.label<edge.label||edge1.label===edge.label&&nodeMap[edge1.to].label<=nodeMap[edge2.to].label)return edge}return null},GSpan.prototype.findForwardPureEdges=function(graph,rightmostEdge,minNodeLabel,history){for(var result=[],rightmostEdgeToId=rightmostEdge.to,edges=graph.nodeMap[rightmostEdgeToId].edges,edgeLength=edges.length,i=0;i<edgeLength;i++){var edge=edges[i],toNode=graph.nodeMap[edge.to];minNodeLabel<=toNode.label&&!history.hasNode(toNode)&&result.push(edge)}return result},GSpan.prototype.findForwardRmpathEdges=function(graph,rightmostEdge,minNodeLabel,history){for(var result=[],nodeMap=graph.nodeMap,toNodeLabel=nodeMap[rightmostEdge.to].label,edges=nodeMap[rightmostEdge.from].edges,edgeLength=edges.length,i=0;i<edgeLength;i++){var edge=edges[i],newToNodeLabel=nodeMap[edge.to].label;rightmostEdge.to===edge.to||minNodeLabel>newToNodeLabel||history.hasNode(nodeMap[edge.to])||(rightmostEdge.label<edge.label||rightmostEdge.label===edge.label&&toNodeLabel<=newToNodeLabel)&&result.push(edge)}return result},GSpan.prototype.getSupport=function(projected){var graphMap={};return projected.forEach((function(pro){graphMap[pro.graphId]||(graphMap[pro.graphId]=!0)})),Object.keys(graphMap).length},GSpan.prototype.findMinLabel=function(obj){var minLabel=void 0;return Object.keys(obj).forEach((function(nodeEdgeNodeLabel){var _a=obj[nodeEdgeNodeLabel],nodeLabel1=_a.nodeLabel1,edgeLabel=_a.edgeLabel,nodeLabel2=_a.nodeLabel2;minLabel?(nodeLabel1<minLabel.nodeLabel1||nodeLabel1===minLabel.nodeLabel1&&edgeLabel<minLabel.edgeLabel||nodeLabel1===minLabel.nodeLabel1&&edgeLabel===minLabel.edgeLabel&&nodeLabel2<minLabel.nodeLabel2)&&(minLabel={nodeLabel1,edgeLabel,nodeLabel2}):minLabel={nodeLabel1,edgeLabel,nodeLabel2}})),minLabel},GSpan.prototype.isMin=function(){var _this=this,dfsCode=this.dfsCode;if(this.verbose&&console.log("isMin checking",dfsCode),1===dfsCode.dfsEdgeList.length)return!0;var directed=this.directed,graph=dfsCode.toGraph(-1,directed),nodeMap=graph.nodeMap,dfsCodeMin=new DFScode,root={};graph.nodes.forEach((function(node){_this.findForwardRootEdges(graph,node).forEach((function(edge){var otherNode=nodeMap[edge.to],nodeEdgeNodeLabel="".concat(node.label,"-").concat(edge.label,"-").concat(otherNode.label);root[nodeEdgeNodeLabel]||(root[nodeEdgeNodeLabel]={projected:[],nodeLabel1:node.label,edgeLabel:edge.label,nodeLabel2:otherNode.label});var pdfs={graphId:graph.id,edge,preNode:null};root[nodeEdgeNodeLabel].projected.push(pdfs)}))}));var minLabel=this.findMinLabel(root);if(minLabel){dfsCodeMin.dfsEdgeList.push(new DFSedge(0,1,minLabel.nodeLabel1,minLabel.edgeLabel,minLabel.nodeLabel2));var key="".concat(minLabel.nodeLabel1,"-").concat(minLabel.edgeLabel,"-").concat(minLabel.nodeLabel2);return function projectIsMin(projected){for(var rmpath=dfsCodeMin.buildRmpath(),minNodeLabel=dfsCodeMin.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,maxToC=dfsCodeMin.dfsEdgeList[rmpath[0]].toNode,backwardRoot={},flag=!1,newTo=0,end=directed?-1:0,_loop_1=function _loop_1(i){if(flag)return"break";projected.forEach((function(p){var history=new History(p),backwardEdge=_this.findBackwardEdge(graph,history.edges[rmpath[i]],history.edges[rmpath[0]],history);backwardEdge&&(backwardRoot[backwardEdge.label]||(backwardRoot[backwardEdge.label]={projected:[],edgeLabel:backwardEdge.label}),backwardRoot[backwardEdge.label].projected.push({graphId:graph.id,edge:backwardRoot,preNode:p}),newTo=dfsCodeMin.dfsEdgeList[rmpath[i]].fromNode,flag=!0)}))},i=rmpath.length-1;i>end;i--){if("break"===_loop_1(i))break}if(flag){var minBackwardEdgeLabel=_this.findMinLabel(backwardRoot);dfsCodeMin.dfsEdgeList.push(new DFSedge(maxToC,newTo,"-1",minBackwardEdgeLabel.edgeLabel,"-1"));var idx_1=dfsCodeMin.dfsEdgeList.length-1;return _this.dfsCode.dfsEdgeList[idx_1]===dfsCodeMin.dfsEdgeList[idx_1]&&projectIsMin(backwardRoot[minBackwardEdgeLabel.edgeLabel].projected)}var forwardRoot={};flag=!1;var newFrom=0;projected.forEach((function(p){var history=new History(p),forwardPureEdges=_this.findForwardPureEdges(graph,history.edges[rmpath[0]],minNodeLabel,history);forwardPureEdges.length>0&&(flag=!0,newFrom=maxToC,forwardPureEdges.forEach((function(edge){var key="".concat(edge.label,"-").concat(nodeMap[edge.to].label);forwardRoot[key]||(forwardRoot[key]={projected:[],edgeLabel:edge.label,nodeLabel2:nodeMap[edge.to].label}),forwardRoot[key].projected.push({graphId:graph.id,edge,preNode:p})})))}));var pathLength=rmpath.length,_loop_2=function _loop_2(i){if(flag)return"break";var value=rmpath[i];projected.forEach((function(p){var history=new History(p),forwardRmpathEdges=_this.findForwardRmpathEdges(graph,history.edges[value],minNodeLabel,history);forwardRmpathEdges.length>0&&(flag=!0,newFrom=dfsCodeMin.dfsEdgeList[value].fromNode,forwardRmpathEdges.forEach((function(edge){var key="".concat(edge.label,"-").concat(nodeMap[edge.to].label);forwardRoot[key]||(forwardRoot[key]={projected:[],edgeLabel:edge.label,nodeLabel2:nodeMap[edge.to].label}),forwardRoot[key].projected.push({graphId:graph.id,edge,preNode:p})})))}))};for(i=0;i<pathLength;i++){if("break"===_loop_2(i))break}if(!flag)return!0;var forwardMinEdgeNodeLabel=_this.findMinLabel(forwardRoot);dfsCodeMin.dfsEdgeList.push(new DFSedge(newFrom,maxToC+1,"-1",forwardMinEdgeNodeLabel.edgeLabel,forwardMinEdgeNodeLabel.nodeLabel2));var idx=dfsCodeMin.dfsEdgeList.length-1;return dfsCode.dfsEdgeList[idx]===dfsCodeMin.dfsEdgeList[idx]&&projectIsMin(forwardRoot["".concat(forwardMinEdgeNodeLabel.edgeLabel,"-").concat(forwardMinEdgeNodeLabel.nodeLabel2)].projected)}(root[key].projected)}},GSpan.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var graph=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push(esm_clone(graph))}},GSpan.prototype.subGraphMining=function(projected){var _this=this;if(!(this.getSupport(projected)<this.minSupport)&&this.isMin()){this.report();var nodeNum=this.dfsCode.getNodeNum(),rmpath=this.dfsCode.buildRmpath(),maxToC=this.dfsCode.dfsEdgeList[rmpath[0]].toNode,minNodeLabel=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,forwardRoot={},backwardRoot={};projected.forEach((function(p){for(var graph=_this.graphs[p.graphId],nodeMap=graph.nodeMap,history=new History(p),i=rmpath.length-1;i>=0;i--){var backwardEdge=_this.findBackwardEdge(graph,history.edges[rmpath[i]],history.edges[rmpath[0]],history);if(backwardEdge){var key="".concat(_this.dfsCode.dfsEdgeList[rmpath[i]].fromNode,"-").concat(backwardEdge.label);backwardRoot[key]||(backwardRoot[key]={projected:[],toNodeId:_this.dfsCode.dfsEdgeList[rmpath[i]].fromNode,edgeLabel:backwardEdge.label}),backwardRoot[key].projected.push({graphId:p.graphId,edge:backwardEdge,preNode:p})}}if(!(nodeNum>=_this.maxNodeNum)){_this.findForwardPureEdges(graph,history.edges[rmpath[0]],minNodeLabel,history).forEach((function(edge){var key="".concat(maxToC,"-").concat(edge.label,"-").concat(nodeMap[edge.to].label);forwardRoot[key]||(forwardRoot[key]={projected:[],fromNodeId:maxToC,edgeLabel:edge.label,nodeLabel2:nodeMap[edge.to].label}),forwardRoot[key].projected.push({graphId:p.graphId,edge,preNode:p})}));var _loop_3=function _loop_3(i){_this.findForwardRmpathEdges(graph,history.edges[rmpath[i]],minNodeLabel,history).forEach((function(edge){var key="".concat(_this.dfsCode.dfsEdgeList[rmpath[i]].fromNode,"-").concat(edge.label,"-").concat(nodeMap[edge.to].label);forwardRoot[key]||(forwardRoot[key]={projected:[],fromNodeId:_this.dfsCode.dfsEdgeList[rmpath[i]].fromNode,edgeLabel:edge.label,nodeLabel2:nodeMap[edge.to].label}),forwardRoot[key].projected.push({graphId:p.graphId,edge,preNode:p})}))};for(i=0;i<rmpath.length;i++)_loop_3(i)}})),Object.keys(backwardRoot).forEach((function(key){var _a=backwardRoot[key],toNodeId=_a.toNodeId,edgeLabel=_a.edgeLabel;_this.dfsCode.dfsEdgeList.push(new DFSedge(maxToC,toNodeId,"-1",edgeLabel,"-1")),_this.subGraphMining(backwardRoot[key].projected),_this.dfsCode.dfsEdgeList.pop()})),Object.keys(forwardRoot).forEach((function(key){var _a=forwardRoot[key],fromNodeId=_a.fromNodeId,edgeLabel=_a.edgeLabel,nodeLabel2=_a.nodeLabel2;_this.dfsCode.dfsEdgeList.push(new DFSedge(fromNodeId,maxToC+1,"-1",edgeLabel,nodeLabel2)),_this.subGraphMining(forwardRoot[key].projected),_this.dfsCode.dfsEdgeList.pop()}))}},GSpan.prototype.generate1EdgeFrequentSubGraphs=function(){var graphs=this.graphs,directed=this.directed,minSupport=this.minSupport,frequentSize1Subgraphs=this.frequentSize1Subgraphs,nodeLabelCounter={},nodeEdgeNodeCounter={},nodeLableCounted={},nodeEdgeNodeLabelCounted={};return Object.keys(graphs).forEach((function(key){var graph=graphs[key],nodeMap=graph.nodeMap;graph.nodes.forEach((function(node,i){var nodeLabel=node.label,graphNodeKey="".concat(key,"-").concat(nodeLabel);if(!nodeLableCounted[graphNodeKey]){var counter=nodeLabelCounter[nodeLabel]||0;counter++,nodeLabelCounter[nodeLabel]=counter}nodeLableCounted[graphNodeKey]={graphKey:key,label:nodeLabel},node.edges.forEach((function(edge){var nodeLabel1=nodeLabel,nodeLabel2=nodeMap[edge.to].label;if(!directed&&nodeLabel1>nodeLabel2){var tmp=nodeLabel2;nodeLabel2=nodeLabel1,nodeLabel1=tmp}var edgeLabel=edge.label,graphNodeEdgeNodeKey="".concat(key,"-").concat(nodeLabel1,"-").concat(edgeLabel,"-").concat(nodeLabel2),nodeEdgeNodeKey="".concat(nodeLabel1,"-").concat(edgeLabel,"-").concat(nodeLabel2);if(!nodeEdgeNodeCounter[nodeEdgeNodeKey]){var counter=nodeEdgeNodeCounter[nodeEdgeNodeKey]||0;counter++,nodeEdgeNodeCounter[nodeEdgeNodeKey]=counter}nodeEdgeNodeLabelCounted[graphNodeEdgeNodeKey]={graphId:key,nodeLabel1,edgeLabel,nodeLabel2}}))}))})),Object.keys(nodeLabelCounter).forEach((function(label){if(!(nodeLabelCounter[label]<minSupport)){var g={nodes:[],edges:[]};g.nodes.push({id:"0",label}),frequentSize1Subgraphs.push(g)}})),frequentSize1Subgraphs},GSpan.prototype.run=function(){var _this=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var graphs=this.graphs,root=(this.directed,{});Object.keys(graphs).forEach((function(graphId){var graph=graphs[graphId],nodeMap=graph.nodeMap;graph.nodes.forEach((function(node){_this.findForwardRootEdges(graph,node).forEach((function(edge){var toNode=nodeMap[edge.to],nodeEdgeNodeLabel="".concat(node.label,"-").concat(edge.label,"-").concat(toNode.label);root[nodeEdgeNodeLabel]||(root[nodeEdgeNodeLabel]={projected:[],nodeLabel1:node.label,edgeLabel:edge.label,nodeLabel2:toNode.label});var pdfs={graphId,edge,preNode:null};root[nodeEdgeNodeLabel].projected.push(pdfs)}))}))})),Object.keys(root).forEach((function(nodeEdgeNodeLabel){var _a=root[nodeEdgeNodeLabel],projected=_a.projected,nodeLabel1=_a.nodeLabel1,edgeLabel=_a.edgeLabel,nodeLabel2=_a.nodeLabel2;_this.dfsCode.dfsEdgeList.push(new DFSedge(0,1,nodeLabel1,edgeLabel,nodeLabel2)),_this.subGraphMining(projected),_this.dfsCode.dfsEdgeList.pop()}))}}}();!function(){function Stack(maxStep){void 0===maxStep&&(maxStep=10),this.linkedList=new linked_list,this.maxStep=maxStep}Object.defineProperty(Stack.prototype,"length",{get:function get(){return this.linkedList.toArray().length},enumerable:!1,configurable:!0}),Stack.prototype.isEmpty=function(){return!this.linkedList.head},Stack.prototype.isMaxStack=function(){return this.toArray().length>=this.maxStep},Stack.prototype.peek=function(){return this.isEmpty()?null:this.linkedList.head.value},Stack.prototype.push=function(value){this.linkedList.prepend(value),this.length>this.maxStep&&this.linkedList.deleteTail()},Stack.prototype.pop=function(){var removeHead=this.linkedList.deleteHead();return removeHead?removeHead.value:null},Stack.prototype.toArray=function(){return this.linkedList.toArray().map((function(node){return node.value}))},Stack.prototype.clear=function(){for(;!this.isEmpty();)this.pop()}}()},"./node_modules/@antv/g-device-api/node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/@antv/g-lite/node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/@antv/g-plugin-device-renderer/node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/@antv/g6/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>g6_esm,DX:()=>stdLib});var mat4_namespaceObject={};__webpack_require__.r(mat4_namespaceObject),__webpack_require__.d(mat4_namespaceObject,{add:()=>mat4_add,adjoint:()=>adjoint,clone:()=>mat4_clone,copy:()=>mat4_copy,create:()=>mat4_create,determinant:()=>determinant,equals:()=>mat4_equals,exactEquals:()=>mat4_exactEquals,frob:()=>frob,fromQuat:()=>fromQuat,fromQuat2:()=>fromQuat2,fromRotation:()=>fromRotation,fromRotationTranslation:()=>fromRotationTranslation,fromRotationTranslationScale:()=>fromRotationTranslationScale,fromRotationTranslationScaleOrigin:()=>fromRotationTranslationScaleOrigin,fromScaling:()=>fromScaling,fromTranslation:()=>fromTranslation,fromValues:()=>mat4_fromValues,fromXRotation:()=>fromXRotation,fromYRotation:()=>fromYRotation,fromZRotation:()=>fromZRotation,frustum:()=>frustum,getRotation:()=>getRotation,getScaling:()=>getScaling,getTranslation:()=>getTranslation,identity:()=>identity,invert:()=>invert,lookAt:()=>lookAt,mul:()=>mat4_mul,multiply:()=>mat4_multiply,multiplyScalar:()=>multiplyScalar,multiplyScalarAndAdd:()=>multiplyScalarAndAdd,ortho:()=>ortho,orthoNO:()=>orthoNO,orthoZO:()=>orthoZO,perspective:()=>perspective,perspectiveFromFieldOfView:()=>perspectiveFromFieldOfView,perspectiveNO:()=>perspectiveNO,perspectiveZO:()=>perspectiveZO,rotate:()=>rotate,rotateX:()=>mat4_rotateX,rotateY:()=>mat4_rotateY,rotateZ:()=>mat4_rotateZ,scale:()=>mat4_scale,set:()=>mat4_set,str:()=>mat4_str,sub:()=>mat4_sub,subtract:()=>mat4_subtract,targetTo:()=>targetTo,translate:()=>translate,transpose:()=>transpose});var lib_namespaceObject={};__webpack_require__.r(lib_namespaceObject),__webpack_require__.d(lib_namespaceObject,{CircularLayout:()=>circular.k,ComboCombinedLayout:()=>comboCombined.A,ConcentricLayout:()=>concentric.v,D3ForceLayout:()=>d3Force.H,DagreLayout:()=>dagre.m,ForceAtlas2Layout:()=>forceAtlas2.d,ForceLayout:()=>force.i,FruchtermanLayout:()=>fruchterman.g,GridLayout:()=>grid.J,MDSLayout:()=>mds.f,RadialLayout:()=>radial.A,RandomLayout:()=>lib_random.u});var stdlib_behavior_namespaceObject={};__webpack_require__.r(stdlib_behavior_namespaceObject),__webpack_require__.d(stdlib_behavior_namespaceObject,{ActivateRelations:()=>ActivateRelations,BrushSelect:()=>BrushSelect,ClickSelect:()=>ClickSelect,CollapseExpandCombo:()=>CollapseExpandCombo,CollapseExpandTree:()=>CollapseExpandTree,CreateEdge:()=>CreateEdge,DragCanvas:()=>DragCanvas,DragCombo:()=>DragCombo,DragNode:()=>DragNode,HoverActivate:()=>HoverActivate,LassoSelect:()=>LassoSelect,OrbitCanvas3D:()=>OrbitCanvas3D,RotateCanvas3D:()=>RotateCanvas3D,ScrollCanvas:()=>ScrollCanvas,ShortcutsCall:()=>ShortcutsCall,TrackCanvas3D:()=>TrackCanvas3D,ZoomCanvas:()=>ZoomCanvas,ZoomCanvas3D:()=>ZoomCanvas3D});var stdlib_data_namespaceObject={};__webpack_require__.r(stdlib_data_namespaceObject),__webpack_require__.d(stdlib_data_namespaceObject,{MapNodeSize:()=>MapNodeSize,ProcessParallelEdges:()=>ProcessParallelEdges,TransformV4Data:()=>TransformV4Data,ValidateData:()=>ValidateData});var combo_namespaceObject={};__webpack_require__.r(combo_namespaceObject),__webpack_require__.d(combo_namespaceObject,{CircleCombo:()=>CircleCombo,RectCombo:()=>RectCombo});var node_namespaceObject={};__webpack_require__.r(node_namespaceObject),__webpack_require__.d(node_namespaceObject,{BaseNode:()=>BaseNode,BaseNode3D:()=>BaseNode3D,CircleNode:()=>CircleNode,CubeNode:()=>CubeNode,DiamondNode:()=>DiamondNode,DonutNode:()=>DonutNode,EllipseNode:()=>EllipseNode,HexagonNode:()=>HexagonNode,ImageNode:()=>ImageNode,ModelRectNode:()=>ModelRectNode,PlaneNode:()=>PlaneNode,RectNode:()=>RectNode,SphereNode:()=>SphereNode,StarNode:()=>StarNode,TriangleNode:()=>TriangleNode});var edge_namespaceObject={};__webpack_require__.r(edge_namespaceObject),__webpack_require__.d(edge_namespaceObject,{CubicEdge:()=>CubicEdge,CubicHorizontalEdge:()=>CubicHorizontalEdge,CubicVerticalEdge:()=>CubicVerticalEdge,LineEdge:()=>LineEdge,LoopEdge:()=>LoopEdge,PolylineEdge:()=>PolylineEdge,QuadraticEdge:()=>QuadraticEdge});var theme_namespaceObject={};__webpack_require__.r(theme_namespaceObject),__webpack_require__.d(theme_namespaceObject,{DarkTheme:()=>DarkTheme,LightTheme:()=>LightTheme});var themeSolver_namespaceObject={};__webpack_require__.r(themeSolver_namespaceObject),__webpack_require__.d(themeSolver_namespaceObject,{SpecThemeSolver:()=>SpecThemeSolver,SubjectThemeSolver:()=>SubjectThemeSolver});var stdlib_plugin_namespaceObject={};__webpack_require__.r(stdlib_plugin_namespaceObject),__webpack_require__.d(stdlib_plugin_namespaceObject,{EdgeBundling:()=>EdgeBundling,EdgeFilterLens:()=>EdgeFilterLens,Fisheye:()=>Fisheye,Grid:()=>Grid,History:()=>History,Legend:()=>Legend,LodController:()=>LodController,Menu:()=>Menu,Minimap:()=>Minimap,Snapline:()=>Snapline,Timebar:()=>Timebar,Toolbar:()=>Toolbar,Tooltip:()=>Tooltip});var esm_util_namespaceObject={};__webpack_require__.r(esm_util_namespaceObject),__webpack_require__.d(esm_util_namespaceObject,{extend:()=>util_extend_extend,getArrowPath:()=>getArrowPath,getEdgesBetween:()=>getEdgesBetween,graphComboTreeDfs:()=>graphComboTreeDfs,graphCoreTreeDfs:()=>graphCoreTreeDfs,graphData2TreeData:()=>graphData2TreeData,isEncode:()=>isEncode,isSucceed:()=>isSucceed,mock:()=>mock,transform:()=>transform,traverse:()=>traverse,traverseAncestors:()=>traverseAncestors,traverseAncestorsAndSucceeds:()=>traverseAncestorsAndSucceeds,traverseGraphAncestors:()=>traverseGraphAncestors,treeData2GraphData:()=>treeData2GraphData});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),eventemitter3=__webpack_require__("./node_modules/@antv/g-lite/node_modules/eventemitter3/index.js");const node_modules_eventemitter3=__webpack_require__.n(eventemitter3)();var EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function create(){var out=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out}function clone(a){var out=new ARRAY_TYPE(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}function vec3_length(a){var x=a[0],y=a[1],z=a[2];return Math.hypot(x,y,z)}function fromValues(x,y,z){var out=new ARRAY_TYPE(3);return out[0]=x,out[1]=y,out[2]=z,out}function copy(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}function set(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out}function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out}function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out}function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out}function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out}function normalize(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;return len>0&&(len=1/Math.sqrt(len)),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len,out}function vec3_dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out}function lerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out}function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];return w=w||1,out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w,out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w,out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w,out}function vec3_equals(a,b){var a0=a[0],a1=a[1],a2=a[2],b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}Math.hypot||(Math.hypot=function(){for(var y=0,i=arguments.length;i--;)y+=arguments[i]*arguments[i];return Math.sqrt(y)});var vec,sub=subtract,vec3_dist=function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.hypot(x,y,z)},len=vec3_length;vec=create();function mat4_create(){var out=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=0,out[12]=0,out[13]=0,out[14]=0),out[0]=1,out[5]=1,out[10]=1,out[15]=1,out}function mat4_clone(a){var out=new ARRAY_TYPE(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function mat4_copy(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function mat4_fromValues(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out}function mat4_set(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out}function identity(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out}function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(det=1/det,out[0]=(a11*b11-a12*b10+a13*b09)*det,out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out):null}function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22),out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22)),out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12),out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12)),out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22)),out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22),out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12)),out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12),out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21),out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21)),out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11),out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11)),out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21)),out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21),out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11)),out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11),out}function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return(a00*a11-a01*a10)*(a22*a33-a23*a32)-(a00*a12-a02*a10)*(a21*a33-a23*a31)+(a00*a13-a03*a10)*(a21*a32-a22*a31)+(a01*a12-a02*a11)*(a20*a33-a23*a30)-(a01*a13-a03*a11)*(a20*a32-a22*a30)+(a02*a13-a03*a12)*(a20*a31-a21*a30)}function mat4_multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out}function translate(out,a,v){var a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,x=v[0],y=v[1],z=v[2];return a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]),out}function mat4_scale(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function rotate(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.hypot(x,y,z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),t=1-(c=Math.cos(rad)),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],b00=x*x*t+c,b01=y*x*t+z*s,b02=z*x*t-y*s,b10=x*y*t-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=a00*b00+a10*b01+a20*b02,out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out)}function mat4_rotateX(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out}function mat4_rotateY(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out}function mat4_rotateZ(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];return a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out}function fromTranslation(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromScaling(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=v[1],out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=v[2],out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromRotation(out,rad,axis){var s,c,t,x=axis[0],y=axis[1],z=axis[2],len=Math.hypot(x,y,z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),t=1-(c=Math.cos(rad)),out[0]=x*x*t+c,out[1]=y*x*t+z*s,out[2]=z*x*t-y*s,out[3]=0,out[4]=x*y*t-z*s,out[5]=y*y*t+c,out[6]=z*y*t+x*s,out[7]=0,out[8]=x*z*t+y*s,out[9]=y*z*t-x*s,out[10]=z*z*t+c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out)}function fromXRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=c,out[6]=s,out[7]=0,out[8]=0,out[9]=-s,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromYRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=0,out[2]=-s,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=s,out[9]=0,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromZRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=0,out[4]=-s,out[5]=c,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromRotationTranslation(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromQuat2(out,a){var translation=new ARRAY_TYPE(3),bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],magnitude=bx*bx+by*by+bz*bz+bw*bw;return magnitude>0?(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by)/magnitude,translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz)/magnitude,translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)/magnitude):(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by),translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz),translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)),fromRotationTranslation(out,a,translation),out}function getTranslation(out,mat){return out[0]=mat[12],out[1]=mat[13],out[2]=mat[14],out}function getScaling(out,mat){var m11=mat[0],m12=mat[1],m13=mat[2],m21=mat[4],m22=mat[5],m23=mat[6],m31=mat[8],m32=mat[9],m33=mat[10];return out[0]=Math.hypot(m11,m12,m13),out[1]=Math.hypot(m21,m22,m23),out[2]=Math.hypot(m31,m32,m33),out}function getRotation(out,mat){var scaling=new ARRAY_TYPE(3);getScaling(scaling,mat);var is1=1/scaling[0],is2=1/scaling[1],is3=1/scaling[2],sm11=mat[0]*is1,sm12=mat[1]*is2,sm13=mat[2]*is3,sm21=mat[4]*is1,sm22=mat[5]*is2,sm23=mat[6]*is3,sm31=mat[8]*is1,sm32=mat[9]*is2,sm33=mat[10]*is3,trace=sm11+sm22+sm33,S=0;return trace>0?(S=2*Math.sqrt(trace+1),out[3]=.25*S,out[0]=(sm23-sm32)/S,out[1]=(sm31-sm13)/S,out[2]=(sm12-sm21)/S):sm11>sm22&&sm11>sm33?(S=2*Math.sqrt(1+sm11-sm22-sm33),out[3]=(sm23-sm32)/S,out[0]=.25*S,out[1]=(sm12+sm21)/S,out[2]=(sm31+sm13)/S):sm22>sm33?(S=2*Math.sqrt(1+sm22-sm11-sm33),out[3]=(sm31-sm13)/S,out[0]=(sm12+sm21)/S,out[1]=.25*S,out[2]=(sm23+sm32)/S):(S=2*Math.sqrt(1+sm33-sm11-sm22),out[3]=(sm12-sm21)/S,out[0]=(sm31+sm13)/S,out[1]=(sm23+sm32)/S,out[2]=.25*S),out}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];return out[0]=(1-(yy+zz))*sx,out[1]=(xy+wz)*sx,out[2]=(xz-wy)*sx,out[3]=0,out[4]=(xy-wz)*sy,out[5]=(1-(xx+zz))*sy,out[6]=(yz+wx)*sy,out[7]=0,out[8]=(xz+wy)*sz,out[9]=(yz-wx)*sz,out[10]=(1-(xx+yy))*sz,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromRotationTranslationScaleOrigin(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2],out0=(1-(yy+zz))*sx,out1=(xy+wz)*sx,out2=(xz-wy)*sx,out4=(xy-wz)*sy,out5=(1-(xx+zz))*sy,out6=(yz+wx)*sy,out8=(xz+wy)*sz,out9=(yz-wx)*sz,out10=(1-(xx+yy))*sz;return out[0]=out0,out[1]=out1,out[2]=out2,out[3]=0,out[4]=out4,out[5]=out5,out[6]=out6,out[7]=0,out[8]=out8,out[9]=out9,out[10]=out10,out[11]=0,out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz),out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz),out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz),out[15]=1,out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[1]=yx+wz,out[2]=zx-wy,out[3]=0,out[4]=yx-wz,out[5]=1-xx-zz,out[6]=zy+wx,out[7]=0,out[8]=zx+wy,out[9]=zy-wx,out[10]=1-xx-yy,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function frustum(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);return out[0]=2*near*rl,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=2*near*tb,out[6]=0,out[7]=0,out[8]=(right+left)*rl,out[9]=(top+bottom)*tb,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near*2*nf,out[15]=0,out}function perspectiveNO(out,fovy,aspect,near,far){var nf,f=1/Math.tan(fovy/2);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(nf=1/(near-far),out[10]=(far+near)*nf,out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out}var perspective=perspectiveNO;function perspectiveZO(out,fovy,aspect,near,far){var nf,f=1/Math.tan(fovy/2);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(nf=1/(near-far),out[10]=far*nf,out[14]=far*near*nf):(out[10]=-1,out[14]=-near),out}function perspectiveFromFieldOfView(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);return out[0]=xScale,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=yScale,out[6]=0,out[7]=0,out[8]=-(leftTan-rightTan)*xScale*.5,out[9]=(upTan-downTan)*yScale*.5,out[10]=far/(near-far),out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near/(near-far),out[15]=0,out}function orthoNO(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=2*nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf,out[15]=1,out}var ortho=orthoNO;function orthoZO(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=near*nf,out[15]=1,out}function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON?identity(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.hypot(z0,z1,z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.hypot(x0,x1,x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.hypot(y0,y1,y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)}function targetTo(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2],len=z0*z0+z1*z1+z2*z2;len>0&&(z0*=len=1/Math.sqrt(len),z1*=len,z2*=len);var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;return(len=x0*x0+x1*x1+x2*x2)>0&&(x0*=len=1/Math.sqrt(len),x1*=len,x2*=len),out[0]=x0,out[1]=x1,out[2]=x2,out[3]=0,out[4]=z1*x2-z2*x1,out[5]=z2*x0-z0*x2,out[6]=z0*x1-z1*x0,out[7]=0,out[8]=z0,out[9]=z1,out[10]=z2,out[11]=0,out[12]=eyex,out[13]=eyey,out[14]=eyez,out[15]=1,out}function mat4_str(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function mat4_add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out[9]=a[9]+b[9],out[10]=a[10]+b[10],out[11]=a[11]+b[11],out[12]=a[12]+b[12],out[13]=a[13]+b[13],out[14]=a[14]+b[14],out[15]=a[15]+b[15],out}function mat4_subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out[9]=a[9]-b[9],out[10]=a[10]-b[10],out[11]=a[11]-b[11],out[12]=a[12]-b[12],out[13]=a[13]-b[13],out[14]=a[14]-b[14],out[15]=a[15]-b[15],out}function multiplyScalar(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out[9]=a[9]*b,out[10]=a[10]*b,out[11]=a[11]*b,out[12]=a[12]*b,out[13]=a[13]*b,out[14]=a[14]*b,out[15]=a[15]*b,out}function multiplyScalarAndAdd(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out[9]=a[9]+b[9]*scale,out[10]=a[10]+b[10]*scale,out[11]=a[11]+b[11]*scale,out[12]=a[12]+b[12]*scale,out[13]=a[13]+b[13]*scale,out[14]=a[14]+b[14]*scale,out[15]=a[15]+b[15]*scale,out}function mat4_exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}function mat4_equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))}var mat4_mul=mat4_multiply,mat4_sub=mat4_subtract;function mat3_create(){var out=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[5]=0,out[6]=0,out[7]=0),out[0]=1,out[4]=1,out[8]=1,out}function mat3_multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22,out}function vec4_create(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0,out[3]=0),out}function vec4_transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}!function(){var vec=vec4_create()}();function quat_create(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out[3]=1,out}function setAxisAngle(out,axis,rad){rad*=.5;var s=Math.sin(rad);return out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad),out}function quat_multiply(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return out[0]=ax*bw+aw*bx+ay*bz-az*by,out[1]=ay*bw+aw*by+az*bx-ax*bz,out[2]=az*bw+aw*bz+ax*by-ay*bx,out[3]=aw*bw-ax*bx-ay*by-az*bz,out}function slerp(out,a,b,t){var omega,cosom,sinom,scale0,scale1,ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom>EPSILON?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),out[0]=scale0*ax+scale1*bx,out[1]=scale0*ay+scale1*by,out[2]=scale0*az+scale1*bz,out[3]=scale0*aw+scale1*bw,out}function quat_invert(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;return out[0]=-a0*invDot,out[1]=-a1*invDot,out[2]=-a2*invDot,out[3]=a3*invDot,out}function fromEuler(out,x,y,z){var halfToRad=.5*Math.PI/180;x*=halfToRad,y*=halfToRad,z*=halfToRad;var sx=Math.sin(x),cx=Math.cos(x),sy=Math.sin(y),cy=Math.cos(y),sz=Math.sin(z),cz=Math.cos(z);return out[0]=sx*cy*cz-cx*sy*sz,out[1]=cx*sy*cz+sx*cy*sz,out[2]=cx*cy*sz-sx*sy*cz,out[3]=cx*cy*cz+sx*sy*sz,out}var tmpvec3,xUnitVec3,yUnitVec3,temp1,temp2,matr,quat_fromValues=function vec4_fromValues(x,y,z,w){var out=new ARRAY_TYPE(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out},quat_copy=function vec4_copy(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},quat_mul=quat_multiply,quat_normalize=function vec4_normalize(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;return len>0&&(len=1/Math.sqrt(len)),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=w*len,out};tmpvec3=create(),xUnitVec3=fromValues(1,0,0),yUnitVec3=fromValues(0,1,0),temp1=quat_create(),temp2=quat_create(),matr=mat3_create();function vec2_add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out}function vec2_scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out}function vec2_normalize(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len)),out[0]=a[0]*len,out[1]=a[1]*len,out}!function(){var vec=function vec2_create(){var out=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0),out}()}();var is_number=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-number.js");function distanceSquareRoot(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]))}var is_nil=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-nil.js"),is_string=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-string.js");const lodash_clamp=function(a,min,max){return a<min?min:a>max?max:a};var paramsCount={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function isPathArray(path){return Array.isArray(path)&&path.every((function(seg){var lk=seg[0].toLowerCase();return paramsCount[lk]===seg.length-1&&"achlmqstvz".includes(lk)}))}function isAbsoluteArray(path){return isPathArray(path)&&path.every((function(_a){var x=_a[0];return x===x.toUpperCase()}))}function isNormalizedArray(path){return isAbsoluteArray(path)&&path.every((function(_a){var pc=_a[0];return"ACLMQZ".includes(pc)}))}var paramsParser={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null};function finalizeSegment(path){for(var pathCommand=path.pathValue[path.segmentStart],LK=pathCommand.toLowerCase(),data=path.data;data.length>=paramsCount[LK]&&("m"===LK&&data.length>2?(path.segments.push([pathCommand].concat(data.splice(0,2))),LK="l",pathCommand="m"===pathCommand?"l":"L"):path.segments.push([pathCommand].concat(data.splice(0,paramsCount[LK]))),paramsCount[LK]););}function scanFlag(path){var index=path.index,pathValue=path.pathValue,code=pathValue.charCodeAt(index);return 48===code?(path.param=0,void(path.index+=1)):49===code?(path.param=1,void(path.index+=1)):void(path.err='[path-util]: invalid Arc flag "'+pathValue[index]+'", expecting 0 or 1 at index '+index)}function isDigitStart(code){return code>=48&&code<=57||43===code||45===code||46===code}function isDigit(code){return code>=48&&code<=57}function scanParam(path){var ch,max=path.max,pathValue=path.pathValue,start=path.index,index=start,zeroFirst=!1,hasCeiling=!1,hasDecimal=!1,hasDot=!1;if(index>=max)path.err="[path-util]: Invalid path value at index "+index+', "pathValue" is missing param';else if(43!==(ch=pathValue.charCodeAt(index))&&45!==ch||(index+=1,ch=pathValue.charCodeAt(index)),isDigit(ch)||46===ch){if(46!==ch){if(zeroFirst=48===ch,index+=1,ch=pathValue.charCodeAt(index),zeroFirst&&index<max&&ch&&isDigit(ch))return void(path.err="[path-util]: Invalid path value at index "+start+', "'+pathValue[start]+'" illegal number');for(;index<max&&isDigit(pathValue.charCodeAt(index));)index+=1,hasCeiling=!0;ch=pathValue.charCodeAt(index)}if(46===ch){for(hasDot=!0,index+=1;isDigit(pathValue.charCodeAt(index));)index+=1,hasDecimal=!0;ch=pathValue.charCodeAt(index)}if(101===ch||69===ch){if(hasDot&&!hasCeiling&&!hasDecimal)return void(path.err="[path-util]: Invalid path value at index "+index+', "'+pathValue[index]+'" invalid float exponent');if(index+=1,43!==(ch=pathValue.charCodeAt(index))&&45!==ch||(index+=1),!(index<max&&isDigit(pathValue.charCodeAt(index))))return void(path.err="[path-util]: Invalid path value at index "+index+', "'+pathValue[index]+'" invalid integer exponent');for(;index<max&&isDigit(pathValue.charCodeAt(index));)index+=1}path.index=index,path.param=+path.pathValue.slice(start,index)}else path.err="[path-util]: Invalid path value at index "+index+', "'+pathValue[index]+'" is not a number'}function skipSpaces(path){for(var ch,pathValue=path.pathValue,max=path.max;path.index<max&&(10===(ch=pathValue.charCodeAt(path.index))||13===ch||8232===ch||8233===ch||32===ch||9===ch||11===ch||12===ch||160===ch||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(ch));)path.index+=1}function scanSegment(path){var max=path.max,pathValue=path.pathValue,index=path.index,cmdCode=pathValue.charCodeAt(index),reqParams=paramsCount[pathValue[index].toLowerCase()];if(path.segmentStart=index,function isPathCommand(code){switch(32|code){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:return!0;default:return!1}}(cmdCode))if(path.index+=1,skipSpaces(path),path.data=[],reqParams){for(;;){for(var i=reqParams;i>0;i-=1){if(97!=(32|cmdCode)||3!==i&&4!==i?scanParam(path):scanFlag(path),path.err.length)return;path.data.push(path.param),skipSpaces(path),path.index<max&&44===pathValue.charCodeAt(path.index)&&(path.index+=1,skipSpaces(path))}if(path.index>=path.max)break;if(!isDigitStart(pathValue.charCodeAt(path.index)))break}finalizeSegment(path)}else finalizeSegment(path);else path.err='[path-util]: Invalid path value "'+pathValue[index]+'" is not a path command'}var PathParser=function PathParser(pathString){this.pathValue=pathString,this.segments=[],this.max=pathString.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err=""};function path2Absolute(pathInput){if(isAbsoluteArray(pathInput))return[].concat(pathInput);var path=function parsePathString(pathInput){if(isPathArray(pathInput))return[].concat(pathInput);var path=new PathParser(pathInput);for(skipSpaces(path);path.index<path.max&&!path.err.length;)scanSegment(path);return path.err?path.err:path.segments}(pathInput),x=0,y=0,mx=0,my=0;return path.map((function(segment){var absoluteSegment,values=segment.slice(1).map(Number),pathCommand=segment[0],absCommand=pathCommand.toUpperCase();if("M"===pathCommand)return x=values[0],y=values[1],mx=x,my=y,["M",x,y];if(pathCommand!==absCommand)switch(absCommand){case"A":absoluteSegment=[absCommand,values[0],values[1],values[2],values[3],values[4],values[5]+x,values[6]+y];break;case"V":absoluteSegment=[absCommand,values[0]+y];break;case"H":absoluteSegment=[absCommand,values[0]+x];break;default:var absValues=values.map((function(n,j){return n+(j%2?y:x)}));absoluteSegment=[absCommand].concat(absValues)}else absoluteSegment=[absCommand].concat(values);var segLength=absoluteSegment.length;switch(absCommand){case"Z":x=mx,y=my;break;case"H":x=absoluteSegment[1];break;case"V":y=absoluteSegment[1];break;default:x=absoluteSegment[segLength-2],y=absoluteSegment[segLength-1],"M"===absCommand&&(mx=x,my=y)}return absoluteSegment}))}function normalizeSegment(segment,params){var pathCommand=segment[0],px1=params.x1,py1=params.y1,px2=params.x2,py2=params.y2,values=segment.slice(1).map(Number),result=segment;if("TQ".includes(pathCommand)||(params.qx=null,params.qy=null),"H"===pathCommand)result=["L",segment[1],py1];else if("V"===pathCommand)result=["L",px1,segment[1]];else if("S"===pathCommand){var x1=2*px1-px2,y1=2*py1-py2;params.x1=x1,params.y1=y1,result=["C",x1,y1].concat(values)}else if("T"===pathCommand){var qx=2*px1-params.qx,qy=2*py1-params.qy;params.qx=qx,params.qy=qy,result=["Q",qx,qy].concat(values)}else if("Q"===pathCommand){var nqx=values[0],nqy=values[1];params.qx=nqx,params.qy=nqy}return result}function normalizePath(pathInput){if(isNormalizedArray(pathInput))return[].concat(pathInput);for(var path=path2Absolute(pathInput),params=(0,tslib_es6.Cl)({},paramsParser),i=0;i<path.length;i+=1){path[i]=normalizeSegment(path[i],params);var segment=path[i],seglen=segment.length;params.x1=+segment[seglen-2],params.y1=+segment[seglen-1],params.x2=+segment[seglen-4]||params.x1,params.y2=+segment[seglen-3]||params.y1}return path}function midPoint(a,b,t){var ax=a[0],ay=a[1];return[ax+(b[0]-ax)*t,ay+(b[1]-ay)*t]}function segmentLineFactory(x1,y1,x2,y2,distance){var length=distanceSquareRoot([x1,y1],[x2,y2]),point={x:0,y:0};if("number"==typeof distance)if(distance<=0)point={x:x1,y:y1};else if(distance>=length)point={x:x2,y:y2};else{var _a=midPoint([x1,y1],[x2,y2],distance/length);point={x:_a[0],y:_a[1]}}return{length,point,min:{x:Math.min(x1,x2),y:Math.min(y1,y2)},max:{x:Math.max(x1,x2),y:Math.max(y1,y2)}}}function angleBetween(v0,v1){var v0x=v0.x,v0y=v0.y,v1x=v1.x,v1y=v1.y,p=v0x*v1x+v0y*v1y,n=Math.sqrt((Math.pow(v0x,2)+Math.pow(v0y,2))*(Math.pow(v1x,2)+Math.pow(v1y,2)));return(v0x*v1y-v0y*v1x<0?-1:1)*Math.acos(p/n)}function getPointAtArcSegmentLength(x1,y1,RX,RY,angle,LAF,SF,x,y,t){var abs=Math.abs,sin=Math.sin,cos=Math.cos,sqrt=Math.sqrt,PI=Math.PI,rx=abs(RX),ry=abs(RY),xRotRad=(angle%360+360)%360*(PI/180);if(x1===x&&y1===y)return{x:x1,y:y1};if(0===rx||0===ry)return segmentLineFactory(x1,y1,x,y,t).point;var dx=(x1-x)/2,dy=(y1-y)/2,transformedPoint={x:cos(xRotRad)*dx+sin(xRotRad)*dy,y:-sin(xRotRad)*dx+cos(xRotRad)*dy},radiiCheck=Math.pow(transformedPoint.x,2)/Math.pow(rx,2)+Math.pow(transformedPoint.y,2)/Math.pow(ry,2);radiiCheck>1&&(rx*=sqrt(radiiCheck),ry*=sqrt(radiiCheck));var cRadicand=(Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(transformedPoint.y,2)-Math.pow(ry,2)*Math.pow(transformedPoint.x,2))/(Math.pow(rx,2)*Math.pow(transformedPoint.y,2)+Math.pow(ry,2)*Math.pow(transformedPoint.x,2)),cCoef=(LAF!==SF?1:-1)*sqrt(cRadicand=cRadicand<0?0:cRadicand),transformedCenter_x=cCoef*(rx*transformedPoint.y/ry),transformedCenter_y=cCoef*(-ry*transformedPoint.x/rx),center_x=cos(xRotRad)*transformedCenter_x-sin(xRotRad)*transformedCenter_y+(x1+x)/2,center_y=sin(xRotRad)*transformedCenter_x+cos(xRotRad)*transformedCenter_y+(y1+y)/2,startVector={x:(transformedPoint.x-transformedCenter_x)/rx,y:(transformedPoint.y-transformedCenter_y)/ry},startAngle=angleBetween({x:1,y:0},startVector),sweepAngle=angleBetween(startVector,{x:(-transformedPoint.x-transformedCenter_x)/rx,y:(-transformedPoint.y-transformedCenter_y)/ry});!SF&&sweepAngle>0?sweepAngle-=2*PI:SF&&sweepAngle<0&&(sweepAngle+=2*PI);var alpha=startAngle+(sweepAngle%=2*PI)*t,ellipseComponentX=rx*cos(alpha),ellipseComponentY=ry*sin(alpha);return{x:cos(xRotRad)*ellipseComponentX-sin(xRotRad)*ellipseComponentY+center_x,y:sin(xRotRad)*ellipseComponentX+cos(xRotRad)*ellipseComponentY+center_y}}function segmentArcFactory(X1,Y1,RX,RY,angle,LAF,SF,X2,Y2,distance,options){var _a,_b=options.bbox,bbox=void 0===_b||_b,_c=options.length,length=void 0===_c||_c,_d=options.sampleSize,sampleSize=void 0===_d?30:_d,distanceIsNumber="number"==typeof distance,x=X1,y=Y1,LENGTH=0,prev=[x,y,LENGTH],cur=[x,y],POINT={x:0,y:0},POINTS=[{x,y}];distanceIsNumber&&distance<=0&&(POINT={x,y});for(var j=0;j<=sampleSize;j+=1){if(x=(_a=getPointAtArcSegmentLength(X1,Y1,RX,RY,angle,LAF,SF,X2,Y2,j/sampleSize)).x,y=_a.y,bbox&&POINTS.push({x,y}),length&&(LENGTH+=distanceSquareRoot(cur,[x,y])),cur=[x,y],distanceIsNumber&&LENGTH>=distance&&distance>prev[2]){var dv=(LENGTH-distance)/(LENGTH-prev[2]);POINT={x:cur[0]*(1-dv)+prev[0]*dv,y:cur[1]*(1-dv)+prev[1]*dv}}prev=[x,y,LENGTH]}return distanceIsNumber&&distance>=LENGTH&&(POINT={x:X2,y:Y2}),{length:LENGTH,point:POINT,min:{x:Math.min.apply(null,POINTS.map((function(n){return n.x}))),y:Math.min.apply(null,POINTS.map((function(n){return n.y})))},max:{x:Math.max.apply(null,POINTS.map((function(n){return n.x}))),y:Math.max.apply(null,POINTS.map((function(n){return n.y})))}}}function getPointAtCubicSegmentLength(x1,y1,c1x,c1y,c2x,c2y,x2,y2,t){var t1=1-t;return{x:Math.pow(t1,3)*x1+3*Math.pow(t1,2)*t*c1x+3*t1*Math.pow(t,2)*c2x+Math.pow(t,3)*x2,y:Math.pow(t1,3)*y1+3*Math.pow(t1,2)*t*c1y+3*t1*Math.pow(t,2)*c2y+Math.pow(t,3)*y2}}function segmentCubicFactory(x1,y1,c1x,c1y,c2x,c2y,x2,y2,distance,options){var _a,_b=options.bbox,bbox=void 0===_b||_b,_c=options.length,length=void 0===_c||_c,_d=options.sampleSize,sampleSize=void 0===_d?10:_d,distanceIsNumber="number"==typeof distance,x=x1,y=y1,LENGTH=0,prev=[x,y,LENGTH],cur=[x,y],POINT={x:0,y:0},POINTS=[{x,y}];distanceIsNumber&&distance<=0&&(POINT={x,y});for(var j=0;j<=sampleSize;j+=1){if(x=(_a=getPointAtCubicSegmentLength(x1,y1,c1x,c1y,c2x,c2y,x2,y2,j/sampleSize)).x,y=_a.y,bbox&&POINTS.push({x,y}),length&&(LENGTH+=distanceSquareRoot(cur,[x,y])),cur=[x,y],distanceIsNumber&&LENGTH>=distance&&distance>prev[2]){var dv=(LENGTH-distance)/(LENGTH-prev[2]);POINT={x:cur[0]*(1-dv)+prev[0]*dv,y:cur[1]*(1-dv)+prev[1]*dv}}prev=[x,y,LENGTH]}return distanceIsNumber&&distance>=LENGTH&&(POINT={x:x2,y:y2}),{length:LENGTH,point:POINT,min:{x:Math.min.apply(null,POINTS.map((function(n){return n.x}))),y:Math.min.apply(null,POINTS.map((function(n){return n.y})))},max:{x:Math.max.apply(null,POINTS.map((function(n){return n.x}))),y:Math.max.apply(null,POINTS.map((function(n){return n.y})))}}}function getPointAtQuadSegmentLength(x1,y1,cx,cy,x2,y2,t){var t1=1-t;return{x:Math.pow(t1,2)*x1+2*t1*t*cx+Math.pow(t,2)*x2,y:Math.pow(t1,2)*y1+2*t1*t*cy+Math.pow(t,2)*y2}}function segmentQuadFactory(x1,y1,qx,qy,x2,y2,distance,options){var _a,_b=options.bbox,bbox=void 0===_b||_b,_c=options.length,length=void 0===_c||_c,_d=options.sampleSize,sampleSize=void 0===_d?10:_d,distanceIsNumber="number"==typeof distance,x=x1,y=y1,LENGTH=0,prev=[x,y,LENGTH],cur=[x,y],POINT={x:0,y:0},POINTS=[{x,y}];distanceIsNumber&&distance<=0&&(POINT={x,y});for(var j=0;j<=sampleSize;j+=1){if(x=(_a=getPointAtQuadSegmentLength(x1,y1,qx,qy,x2,y2,j/sampleSize)).x,y=_a.y,bbox&&POINTS.push({x,y}),length&&(LENGTH+=distanceSquareRoot(cur,[x,y])),cur=[x,y],distanceIsNumber&&LENGTH>=distance&&distance>prev[2]){var dv=(LENGTH-distance)/(LENGTH-prev[2]);POINT={x:cur[0]*(1-dv)+prev[0]*dv,y:cur[1]*(1-dv)+prev[1]*dv}}prev=[x,y,LENGTH]}return distanceIsNumber&&distance>=LENGTH&&(POINT={x:x2,y:y2}),{length:LENGTH,point:POINT,min:{x:Math.min.apply(null,POINTS.map((function(n){return n.x}))),y:Math.min.apply(null,POINTS.map((function(n){return n.y})))},max:{x:Math.max.apply(null,POINTS.map((function(n){return n.x}))),y:Math.max.apply(null,POINTS.map((function(n){return n.y})))}}}function pathLengthFactory(pathInput,distance,options){for(var _a,_b,_c,_d,_e,_f,isM,pathCommand,seg,path=normalizePath(pathInput),distanceIsNumber="number"==typeof distance,data=[],x=0,y=0,mx=0,my=0,MIN=[],MAX=[],length=0,min={x:0,y:0},max=min,point=min,POINT=min,LENGTH=0,i=0,ll=path.length;i<ll;i+=1)data=(isM="M"===(pathCommand=(seg=path[i])[0]))?data:[x,y].concat(seg.slice(1)),isM?(max=min={x:mx=seg[1],y:my=seg[2]},length=0,distanceIsNumber&&distance<.001&&(POINT=min)):"L"===pathCommand?(length=(_a=segmentLineFactory(data[0],data[1],data[2],data[3],(distance||0)-LENGTH)).length,min=_a.min,max=_a.max,point=_a.point):"A"===pathCommand?(length=(_b=segmentArcFactory(data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],data[8],(distance||0)-LENGTH,options||{})).length,min=_b.min,max=_b.max,point=_b.point):"C"===pathCommand?(length=(_c=segmentCubicFactory(data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],(distance||0)-LENGTH,options||{})).length,min=_c.min,max=_c.max,point=_c.point):"Q"===pathCommand?(length=(_d=segmentQuadFactory(data[0],data[1],data[2],data[3],data[4],data[5],(distance||0)-LENGTH,options||{})).length,min=_d.min,max=_d.max,point=_d.point):"Z"===pathCommand&&(length=(_e=segmentLineFactory((data=[x,y,mx,my])[0],data[1],data[2],data[3],(distance||0)-LENGTH)).length,min=_e.min,max=_e.max,point=_e.point),distanceIsNumber&&LENGTH<distance&&LENGTH+length>=distance&&(POINT=point),MAX.push(max),MIN.push(min),LENGTH+=length,x=(_f="Z"!==pathCommand?seg.slice(-2):[mx,my])[0],y=_f[1];return distanceIsNumber&&distance>=LENGTH&&(POINT={x,y}),{length:LENGTH,point:POINT,min:{x:Math.min.apply(null,MIN.map((function(n){return n.x}))),y:Math.min.apply(null,MIN.map((function(n){return n.y})))},max:{x:Math.max.apply(null,MAX.map((function(n){return n.x}))),y:Math.max.apply(null,MAX.map((function(n){return n.y})))}}}var is_array=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-array.js");const lodash_min=function(arr){if((0,is_array.A)(arr))return arr.reduce((function(prev,curr){return Math.min(prev,curr)}),arr[0])},lodash_max=function(arr){if((0,is_array.A)(arr))return arr.reduce((function(prev,curr){return Math.max(prev,curr)}),arr[0])};var PRECISION=1e-5;function isNumberEqual(a,b,precision){return void 0===precision&&(precision=PRECISION),Math.abs(a-b)<precision}const lodash_mod=function(n,m){return(n%m+m)%m};function fixArc(pathArray,allPathCommands,i){if(pathArray[i].length>7){pathArray[i].shift();for(var pi=pathArray[i],ni=i;pi.length;)allPathCommands[i]="A",pathArray.splice(ni+=1,0,["C"].concat(pi.splice(0,6)));pathArray.splice(i,1)}}function rotateVector(x,y,rad){return{x:x*Math.cos(rad)-y*Math.sin(rad),y:x*Math.sin(rad)+y*Math.cos(rad)}}function arcToCubic(X1,Y1,RX,RY,angle,LAF,SF,X2,Y2,recursive){var xy,f1,f2,cx,cy,x1=X1,y1=Y1,rx=RX,ry=RY,x2=X2,y2=Y2,d120=120*Math.PI/180,rad=Math.PI/180*(+angle||0),res=[];if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{x1=(xy=rotateVector(x1,y1,-rad)).x,y1=xy.y;var x=(x1-(x2=(xy=rotateVector(x2,y2,-rad)).x))/2,y=(y1-(y2=xy.y))/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(rx*=h=Math.sqrt(h),ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(LAF===SF?-1:1)*Math.sqrt(Math.abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x)));cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=Math.asin(((y1-cy)/ry*Math.pow(10,9)>>0)/Math.pow(10,9)),f2=Math.asin(((y2-cy)/ry*Math.pow(10,9)>>0)/Math.pow(10,9)),f1=x1<cx?Math.PI-f1:f1,f2=x2<cx?Math.PI-f2:f2,f1<0&&(f1=2*Math.PI+f1),f2<0&&(f2=2*Math.PI+f2),SF&&f1>f2&&(f1-=2*Math.PI),!SF&&f2>f1&&(f2-=2*Math.PI)}var df=f2-f1;if(Math.abs(df)>d120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+d120*(SF&&f2>f1?1:-1),res=arcToCubic(x2=cx+rx*Math.cos(f2),y2=cy+ry*Math.sin(f2),rx,ry,angle,0,SF,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=Math.cos(f1),s1=Math.sin(f1),c2=Math.cos(f2),s2=Math.sin(f2),t=Math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];if(m2[0]=2*m1[0]-m2[0],m2[1]=2*m1[1]-m2[1],recursive)return m2.concat(m3,m4,res);for(var newres=[],i=0,ii=(res=m2.concat(m3,m4,res)).length;i<ii;i+=1)newres[i]=i%2?rotateVector(res[i-1],res[i],rad).y:rotateVector(res[i],res[i+1],rad).x;return newres}var lineToCubic=function(x1,y1,x2,y2){var mid=midPoint([x1,y1],[x2,y2],.5);return(0,tslib_es6.fX)((0,tslib_es6.fX)([],mid,!0),[x2,y2,x2,y2],!1)};function segmentToCubic(segment,params){var args,pathCommand=segment[0],values=segment.slice(1).map(Number),x=values[0],y=values[1],px1=params.x1,py1=params.y1,px=params.x,py=params.y;switch("TQ".includes(pathCommand)||(params.qx=null,params.qy=null),pathCommand){case"M":return params.x=x,params.y=y,segment;case"A":return args=[px1,py1].concat(values),["C"].concat(arcToCubic(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9]));case"Q":return params.qx=x,params.qy=y,args=[px1,py1].concat(values),["C"].concat(function quadToCubic(x1,y1,qx,qy,x2,y2){var r13=1/3,r23=2/3;return[r13*x1+r23*qx,r13*y1+r23*qy,r13*x2+r23*qx,r13*y2+r23*qy,x2,y2]}(args[0],args[1],args[2],args[3],args[4],args[5]));case"L":return["C"].concat(lineToCubic(px1,py1,x,y));case"Z":return px1===px&&py1===py?["C",px1,py1,px,py,px,py]:["C"].concat(lineToCubic(px1,py1,px,py))}return segment}function path2Curve(pathInput,needZCommandIndexes){if(void 0===needZCommandIndexes&&(needZCommandIndexes=!1),function isCurveArray(path){return isNormalizedArray(path)&&path.every((function(_a){var pc=_a[0];return"MC".includes(pc)}))}(pathInput)){var cloned=[].concat(pathInput);return needZCommandIndexes?[cloned,[]]:cloned}for(var segment,seglen,path=normalizePath(pathInput),params=(0,tslib_es6.Cl)({},paramsParser),allPathCommands=[],pathCommand="",ii=path.length,zCommandIndexes=[],i=0;i<ii;i+=1){path[i]&&(pathCommand=path[i][0]),allPathCommands[i]=pathCommand;var curveSegment=segmentToCubic(path[i],params);path[i]=curveSegment,fixArc(path,allPathCommands,i),ii=path.length,"Z"===pathCommand&&zCommandIndexes.push(i),seglen=(segment=path[i]).length,params.x1=+segment[seglen-2],params.y1=+segment[seglen-1],params.x2=+segment[seglen-4]||params.x1,params.y2=+segment[seglen-3]||params.y1}return needZCommandIndexes?[path,zCommandIndexes]:path}function getCurveArray(segments){return segments.map((function(segment,i,pathArray){var segmentData=i&&pathArray[i-1].slice(-2).concat(segment.slice(1)),curveLength=i?segmentCubicFactory(segmentData[0],segmentData[1],segmentData[2],segmentData[3],segmentData[4],segmentData[5],segmentData[6],segmentData[7],segmentData[8],{bbox:!1}).length:0;return{s:segment,ss:i?curveLength?function splitCubic(pts,t){void 0===t&&(t=.5);var p0=pts.slice(0,2),p1=pts.slice(2,4),p2=pts.slice(4,6),p3=pts.slice(6,8),p4=midPoint(p0,p1,t),p5=midPoint(p1,p2,t),p6=midPoint(p2,p3,t),p7=midPoint(p4,p5,t),p8=midPoint(p5,p6,t),p9=midPoint(p7,p8,t);return[["C"].concat(p4,p7,p9),["C"].concat(p8,p6,p3)]}(segmentData):[segment,segment]:[segment],l:curveLength}}))}function equalizeSegments(path1,path2,TL){var c1=getCurveArray(path1),c2=getCurveArray(path2),L1=c1.length,L2=c2.length,l1=c1.filter((function(x){return x.l})).length,l2=c2.filter((function(x){return x.l})).length,m1=c1.filter((function(x){return x.l})).reduce((function(a,_a){return a+_a.l}),0)/l1||0,m2=c2.filter((function(x){return x.l})).reduce((function(a,_a){return a+_a.l}),0)/l2||0,tl=TL||Math.max(L1,L2),mm=[m1,m2],dif=[tl-L1,tl-L2],canSplit=0,result=[c1,c2].map((function(x,i){return x.l===tl?x.map((function(y){return y.s})):x.map((function(y,j){return canSplit=j&&dif[i]&&y.l>=mm[i],dif[i]-=canSplit?1:0,canSplit?y.ss:[y.s]})).flat()}));return result[0].length===result[1].length?result:equalizeSegments(result[0],result[1],tl)}function getDrawDirection(pathArray){return function getPathArea(path){var x=0,y=0,len=0;return path2Curve(path).map((function(seg){var _a;if("M"===seg[0])return x=seg[1],y=seg[2],0;var _b=seg.slice(1),c1x=_b[0],c1y=_b[1],c2x=_b[2],c2y=_b[3],x2=_b[4],y2=_b[5];return len=function getCubicSegArea(x1,y1,c1x,c1y,c2x,c2y,x2,y2){return 3*((y2-y1)*(c1x+c2x)-(x2-x1)*(c1y+c2y)+c1y*(x1-c2x)-c1x*(y1-c2y)+y2*(c2x+x1/3)-x2*(c2y+y1/3))/20}(x,y,c1x,c1y,c2x,c2y,x2,y2),_a=seg.slice(-2),x=_a[0],y=_a[1],len})).reduce((function(a,b){return a+b}),0)}(pathArray)>=0}var is_type=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-type.js");const is_boolean=function(value){return(0,is_type.A)(value,"Boolean")};var is_object=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-object.js");const is_undefined=function(value){return void 0===value};function src_define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var brighter=1/.7,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color_color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?rgba(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?rgba(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color_color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}function index_esm_distance(x1,y1,x2,y2){var dx=x1-x2,dy=y1-y2;return Math.sqrt(dx*dx+dy*dy)}function getBBoxByArray(xArr,yArr){var minX=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr),!1)),minY=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr),!1));return{x:minX,y:minY,width:Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr),!1))-minX,height:Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr),!1))-minY}}function xAt(cx,cy,rx,ry,xRotation,angle){return rx*Math.cos(xRotation)*Math.cos(angle)-ry*Math.sin(xRotation)*Math.sin(angle)+cx}function yAt(cx,cy,rx,ry,xRotation,angle){return rx*Math.sin(xRotation)*Math.cos(angle)+ry*Math.cos(xRotation)*Math.sin(angle)+cy}function box$5(cx,cy,rx,ry,xRotation,startAngle,endAngle){for(var xDim=function xExtrema(rx,ry,xRotation){return Math.atan(-ry/rx*Math.tan(xRotation))}(rx,ry,xRotation),minX=1/0,maxX=-1/0,xs=[startAngle,endAngle],i=2*-Math.PI;i<=2*Math.PI;i+=Math.PI){var xAngle=xDim+i;startAngle<endAngle?startAngle<xAngle&&xAngle<endAngle&&xs.push(xAngle):endAngle<xAngle&&xAngle<startAngle&&xs.push(xAngle)}for(i=0;i<xs.length;i++){var x=xAt(cx,0,rx,ry,xRotation,xs[i]);x<minX&&(minX=x),x>maxX&&(maxX=x)}var yDim=function yExtrema(rx,ry,xRotation){return Math.atan(ry/(rx*Math.tan(xRotation)))}(rx,ry,xRotation),minY=1/0,maxY=-1/0,ys=[startAngle,endAngle];for(i=2*-Math.PI;i<=2*Math.PI;i+=Math.PI){var yAngle=yDim+i;startAngle<endAngle?startAngle<yAngle&&yAngle<endAngle&&ys.push(yAngle):endAngle<yAngle&&yAngle<startAngle&&ys.push(yAngle)}for(i=0;i<ys.length;i++){var y=yAt(0,cy,rx,ry,xRotation,ys[i]);y<minY&&(minY=y),y>maxY&&(maxY=y)}return{x:minX,y:minY,width:maxX-minX,height:maxY-minY}}src_define(Color,color_color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function color_formatHsl(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),src_define(Rgb,(function rgb(r,g,b,opacity){return 1===arguments.length?function rgbConvert(o){return o instanceof Color||(o=color_color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}(r):new Rgb(r,g,b,null==opacity?1:opacity)}),extend(Color,{brighter:function(k){return k=null==k?brighter:Math.pow(brighter,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),src_define(Hsl,(function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}),extend(Color,{brighter:function(k){return k=null==k?brighter:Math.pow(brighter,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));var index_esm_EPSILON=1e-4;function nearestPoint$2(xArr,yArr,x,y,tCallback,length){var t=-1,d=1/0,v0=[x,y],segNum=20;length&&length>200&&(segNum=length/10);for(var increaseRate=1/segNum,interval=increaseRate/10,i=0;i<=segNum;i++){var _t=i*increaseRate,v1=[tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr.concat([_t])),!1)),tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr.concat([_t])),!1))];(d1=index_esm_distance(v0[0],v0[1],v1[0],v1[1]))<d&&(t=_t,d=d1)}if(0===t)return{x:xArr[0],y:yArr[0]};if(1===t){var count=xArr.length;return{x:xArr[count-1],y:yArr[count-1]}}d=1/0;for(i=0;i<32&&!(interval<index_esm_EPSILON);i++){var prev=t-interval,next=t+interval,d1=(v1=[tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr.concat([prev])),!1)),tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr.concat([prev])),!1))],index_esm_distance(v0[0],v0[1],v1[0],v1[1]));if(prev>=0&&d1<d)t=prev,d=d1;else{var v2=[tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr.concat([next])),!1)),tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr.concat([next])),!1))],d2=index_esm_distance(v0[0],v0[1],v2[0],v2[1]);next<=1&&d2<d?(t=next,d=d2):interval*=.5}}return{x:tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(xArr.concat([t])),!1)),y:tCallback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(yArr.concat([t])),!1))}}function length$4(x1,y1,x2,y2){return index_esm_distance(x1,y1,x2,y2)}function pointAt$3(x1,y1,x2,y2,t){return{x:(1-t)*x1+t*x2,y:(1-t)*y1+t*y2}}function pointToLine(x1,y1,x2,y2,x,y){var d=[x2-x1,y2-y1];if(function vec2_exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]}(d,[0,0]))return Math.sqrt((x-x1)*(x-x1)+(y-y1)*(y-y1));var u=[-d[1],d[0]];vec2_normalize(u,u);var a=[x-x1,y-y1];return Math.abs(function vec2_dot(a,b){return a[0]*b[0]+a[1]*b[1]}(a,u))}function cubicAt(p0,p1,p2,p3,t){var onet=1-t;return onet*onet*onet*p0+3*p1*t*onet*onet+3*p2*t*t*onet+p3*t*t*t}function extrema$1(p0,p1,p2,p3){var t1,t2,discSqrt,a=-3*p0+9*p1-9*p2+3*p3,b=6*p0-12*p1+6*p2,c=3*p1-3*p0,extremas=[];if(isNumberEqual(a,0))isNumberEqual(b,0)||(t1=-c/b)>=0&&t1<=1&&extremas.push(t1);else{var disc=b*b-4*a*c;isNumberEqual(disc,0)?extremas.push(-b/(2*a)):disc>0&&(t2=(-b-(discSqrt=Math.sqrt(disc)))/(2*a),(t1=(-b+discSqrt)/(2*a))>=0&&t1<=1&&extremas.push(t1),t2>=0&&t2<=1&&extremas.push(t2))}return extremas}function cubicLength(x1,y1,x2,y2,x3,y3,x4,y4,iterationCount){if(0===iterationCount)return function snapLength(xArr,yArr){for(var totalLength=0,count=xArr.length,i=0;i<count;i++)totalLength+=index_esm_distance(xArr[i],yArr[i],xArr[(i+1)%count],yArr[(i+1)%count]);return totalLength/2}([x1,x2,x3,x4],[y1,y2,y3,y4]);var cubics=function divideCubic(x1,y1,x2,y2,x3,y3,x4,y4,t){var xt=cubicAt(x1,x2,x3,x4,t),yt=cubicAt(y1,y2,y3,y4,t),c1=pointAt$3(x1,y1,x2,y2,t),c2=pointAt$3(x2,y2,x3,y3,t),c3=pointAt$3(x3,y3,x4,y4,t),c12=pointAt$3(c1.x,c1.y,c2.x,c2.y,t),c23=pointAt$3(c2.x,c2.y,c3.x,c3.y,t);return[[x1,y1,c1.x,c1.y,c12.x,c12.y,xt,yt],[xt,yt,c23.x,c23.y,c3.x,c3.y,x4,y4]]}(x1,y1,x2,y2,x3,y3,x4,y4,.5),left=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(cubics[0]),!1),[iterationCount-1],!1),right=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(cubics[1]),!1),[iterationCount-1],!1);return cubicLength.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(left),!1))+cubicLength.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(right),!1))}function box$3(x1,y1,x2,y2,x3,y3,x4,y4){for(var xArr=[x1,x4],yArr=[y1,y4],xExtrema=extrema$1(x1,x2,x3,x4),yExtrema=extrema$1(y1,y2,y3,y4),i=0;i<xExtrema.length;i++)xArr.push(cubicAt(x1,x2,x3,x4,xExtrema[i]));for(i=0;i<yExtrema.length;i++)yArr.push(cubicAt(y1,y2,y3,y4,yExtrema[i]));return getBBoxByArray(xArr,yArr)}function pointDistance$3(x1,y1,x2,y2,x3,y3,x4,y4,x0,y0,length){var point=function nearestPoint$1(x1,y1,x2,y2,x3,y3,x4,y4,x0,y0,length){return nearestPoint$2([x1,x2,x3,x4],[y1,y2,y3,y4],x0,y0,cubicAt,length)}(x1,y1,x2,y2,x3,y3,x4,y4,x0,y0,length);return index_esm_distance(point.x,point.y,x0,y0)}function lengthOfSegment(points){if(points.length<2)return 0;for(var totalLength=0,i=0;i<points.length-1;i++){var from=points[i],to=points[i+1];totalLength+=index_esm_distance(from[0],from[1],to[0],to[1])}return totalLength}function quadraticAt(p0,p1,p2,t){var onet=1-t;return onet*onet*p0+2*t*onet*p1+t*t*p2}function extrema(p0,p1,p2){var a=p0+p2-2*p1;if(isNumberEqual(a,0))return[.5];var rst=(p0-p1)/a;return rst<=1&&rst>=0?[rst]:[]}function quadraticLength(x1,y1,x2,y2,x3,y3,iterationCount){if(0===iterationCount)return(index_esm_distance(x1,y1,x2,y2)+index_esm_distance(x2,y2,x3,y3)+index_esm_distance(x1,y1,x3,y3))/2;var quadratics=function divideQuadratic(x1,y1,x2,y2,x3,y3,t){var xt=quadraticAt(x1,x2,x3,t),yt=quadraticAt(y1,y2,y3,t),controlPoint1=pointAt$3(x1,y1,x2,y2,t),controlPoint2=pointAt$3(x2,y2,x3,y3,t);return[[x1,y1,controlPoint1.x,controlPoint1.y,xt,yt],[xt,yt,controlPoint2.x,controlPoint2.y,x3,y3]]}(x1,y1,x2,y2,x3,y3,.5),left=quadratics[0],right=quadratics[1];return left.push(iterationCount-1),right.push(iterationCount-1),quadraticLength.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(left),!1))+quadraticLength.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(right),!1))}function index_esm_box(x1,y1,x2,y2,x3,y3){var xExtrema=extrema(x1,x2,x3)[0],yExtrema=extrema(y1,y2,y3)[0],xArr=[x1,x3],yArr=[y1,y3];return void 0!==xExtrema&&xArr.push(quadraticAt(x1,x2,x3,xExtrema)),void 0!==yExtrema&&yArr.push(quadraticAt(y1,y2,y3,yExtrema)),getBBoxByArray(xArr,yArr)}function pointDistance(x1,y1,x2,y2,x3,y3,x0,y0){var point=function nearestPoint(x1,y1,x2,y2,x3,y3,x0,y0){return nearestPoint$2([x1,x2,x3],[y1,y2,y3],x0,y0,quadraticAt)}(x1,y1,x2,y2,x3,y3,x0,y0);return index_esm_distance(point.x,point.y,x0,y0)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self&&self;var rbush={exports:{}};rbush.exports=function(){function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}var RBush=function RBush(maxEntries){void 0===maxEntries&&(maxEntries=9),this._maxEntries=Math.max(4,maxEntries),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var i=k;i<p;i++){var child=node.children[i];extend(destNode,node.leaf?toBBox(child):child)}return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){var minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){for(var stack=[left,right];stack.length;)if(!((right=stack.pop())-(left=stack.pop())<=n)){var mid=left+Math.ceil((right-left)/n/2)*n;quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right)}}return RBush.prototype.all=function all(){return this._all(this.data,[])},RBush.prototype.search=function search(bbox){var node=this.data,result=[];if(!intersects(bbox,node))return result;for(var toBBox=this.toBBox,nodesToSearch=[];node;){for(var i=0;i<node.children.length;i++){var child=node.children[i],childBBox=node.leaf?toBBox(child):child;intersects(bbox,childBBox)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child))}node=nodesToSearch.pop()}return result},RBush.prototype.collides=function collides(bbox){var node=this.data;if(!intersects(bbox,node))return!1;for(var nodesToSearch=[];node;){for(var i=0;i<node.children.length;i++){var child=node.children[i],childBBox=node.leaf?this.toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}}node=nodesToSearch.pop()}return!1},RBush.prototype.load=function load(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(var i=0;i<data.length;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this},RBush.prototype.insert=function insert(item){return item&&this._insert(item,this.data.height-1),this},RBush.prototype.clear=function clear(){return this.data=createNode([]),this},RBush.prototype.remove=function remove(item,equalsFn){if(!item)return this;for(var i,parent,goingUp,node=this.data,bbox=this.toBBox(item),path=[],indexes=[];node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf){var index=findItem(item,node.children,equalsFn);if(-1!==index)return node.children.splice(index,1),path.push(node),this._condense(path),this}goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this},RBush.prototype.toBBox=function toBBox(item){return item},RBush.prototype.compareMinX=function compareMinX(a,b){return a.minX-b.minX},RBush.prototype.compareMinY=function compareMinY(a,b){return a.minY-b.minY},RBush.prototype.toJSON=function toJSON(){return this.data},RBush.prototype.fromJSON=function fromJSON(data){return this.data=data,this},RBush.prototype._all=function _all(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},RBush.prototype._build=function _build(items,left,right,height){var node,N=right-left+1,M=this._maxEntries;if(N<=M)return calcBBox(node=createNode(items.slice(left,right+1)),this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),(node=createNode([])).leaf=!1,node.height=height;var N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));multiSelect(items,left,right,N1,this.compareMinX);for(var i=left;i<=right;i+=N1){var right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(var j=i;j<=right2;j+=N2){var right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1))}}return calcBBox(node,this.toBBox),node},RBush.prototype._chooseSubtree=function _chooseSubtree(bbox,node,level,path){for(;path.push(node),!node.leaf&&path.length-1!==level;){for(var minArea=1/0,minEnlargement=1/0,targetNode=void 0,i=0;i<node.children.length;i++){var child=node.children[i],area=bboxArea(child),enlargement=enlargedArea(bbox,child)-area;enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child)}node=targetNode||node.children[0]}return node},RBush.prototype._insert=function _insert(item,level,isNode){var bbox=isNode?item:this.toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)},RBush.prototype._split=function _split(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},RBush.prototype._splitRoot=function _splitRoot(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},RBush.prototype._chooseSplitIndex=function _chooseSplitIndex(node,m,M){for(var index,minOverlap=1/0,minArea=1/0,i=m;i<=M-m;i++){var bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),overlap=intersectionArea(bbox1,bbox2),area=bboxArea(bbox1)+bboxArea(bbox2);overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i)}return index||M-m},RBush.prototype._chooseSplitAxis=function _chooseSplitAxis(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)},RBush.prototype._allDistMargin=function _allDistMargin(node,m,M,compare){node.children.sort(compare);for(var toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox),i=m;i<M-m;i++){var child=node.children[i];extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox)}for(var i$1=M-m-1;i$1>=m;i$1--){var child$1=node.children[i$1];extend(rightBBox,node.leaf?toBBox(child$1):child$1),margin+=bboxMargin(rightBBox)}return margin},RBush.prototype._adjustParentBBoxes=function _adjustParentBBoxes(bbox,path,level){for(var i=level;i>=0;i--)extend(path[i],bbox)},RBush.prototype._condense=function _condense(path){for(var i=path.length-1,siblings=void 0;i>=0;i--)0===path[i].children.length?i>0?(siblings=path[i-1].children).splice(siblings.indexOf(path[i]),1):this.clear():calcBBox(path[i],this.toBBox)},RBush}();var Shape,index_esm_ClipSpaceNearZ,RBush=rbush.exports;!function(Shape){Shape.GROUP="g",Shape.CIRCLE="circle",Shape.ELLIPSE="ellipse",Shape.IMAGE="image",Shape.RECT="rect",Shape.LINE="line",Shape.POLYLINE="polyline",Shape.POLYGON="polygon",Shape.TEXT="text",Shape.PATH="path",Shape.HTML="html",Shape.MESH="mesh"}(Shape||(Shape={})),function(ClipSpaceNearZ){ClipSpaceNearZ[ClipSpaceNearZ.ZERO=0]="ZERO",ClipSpaceNearZ[ClipSpaceNearZ.NEGATIVE_ONE=1]="NEGATIVE_ONE"}(index_esm_ClipSpaceNearZ||(index_esm_ClipSpaceNearZ={}));var AbstractRendererPlugin=function(){function AbstractRendererPlugin(){this.plugins=[]}return AbstractRendererPlugin.prototype.addRenderingPlugin=function(plugin){this.plugins.push(plugin),this.context.renderingPlugins.push(plugin)},AbstractRendererPlugin.prototype.removeAllRenderingPlugins=function(){var _this=this;this.plugins.forEach((function(plugin){var index=_this.context.renderingPlugins.indexOf(plugin);index>=0&&_this.context.renderingPlugins.splice(index,1)}))},AbstractRendererPlugin}(),AbstractRenderer=function(){function AbstractRenderer(config){this.clipSpaceNearZ=index_esm_ClipSpaceNearZ.NEGATIVE_ONE,this.plugins=[],this.config=(0,tslib_es6.Cl)({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1},config)}return AbstractRenderer.prototype.registerPlugin=function(plugin){-1===this.plugins.findIndex((function(p){return p===plugin}))&&this.plugins.push(plugin)},AbstractRenderer.prototype.unregisterPlugin=function(plugin){var index=this.plugins.findIndex((function(p){return p===plugin}));index>-1&&this.plugins.splice(index,1)},AbstractRenderer.prototype.getPlugins=function(){return this.plugins},AbstractRenderer.prototype.getPlugin=function(name){return this.plugins.find((function(plugin){return plugin.name===name}))},AbstractRenderer.prototype.getConfig=function(){return this.config},AbstractRenderer.prototype.setConfig=function(config){Object.assign(this.config,config)},AbstractRenderer}();function copyVec3(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function subVec3(o,a,b){return o[0]=a[0]-b[0],o[1]=a[1]-b[1],o[2]=a[2]-b[2],o}function addVec3(o,a,b){return o[0]=a[0]+b[0],o[1]=a[1]+b[1],o[2]=a[2]+b[2],o}function scaleVec3(o,a,b){return o[0]=a[0]*b,o[1]=a[1]*b,o[2]=a[2]*b,o}function dist_index_esm_getAngle(angle){return void 0===angle?0:angle>360||angle<-360?angle%360:angle}function createVec3(x,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),Array.isArray(x)&&3===x.length?clone(x):(0,is_number.A)(x)?fromValues(x,y,z):fromValues(x[0],x[1]||y,x[2]||z)}function deg2rad(deg){return deg*(Math.PI/180)}function rad2deg(rad){return rad*(180/Math.PI)}function getEuler(out,quat){return 16===quat.length?function getEulerFromMat4(out,m){var x,z,halfPi=.5*Math.PI,_a=(0,tslib_es6.zs)(getScaling(create(),m),3),sx=_a[0],sy=_a[1],sz=_a[2],y=Math.asin(-m[2]/sx);return y<halfPi?y>-halfPi?(x=Math.atan2(m[6]/sy,m[10]/sz),z=Math.atan2(m[1]/sx,m[0]/sx)):(z=0,x=-Math.atan2(m[4]/sy,m[5]/sy)):(z=0,x=Math.atan2(m[4]/sy,m[5]/sy)),out[0]=x,out[1]=y,out[2]=z,out}(out,quat):function getEulerFromQuat(out,quat){var x=quat[0],y=quat[1],z=quat[2],w=quat[3],y2=y*y,z2=z*z,w2=w*w,unit=x*x+y2+z2+w2,test=x*w-y*z;return test>.499995*unit?(out[0]=Math.PI/2,out[1]=2*Math.atan2(y,x),out[2]=0):test<-.499995*unit?(out[0]=-Math.PI/2,out[1]=2*Math.atan2(y,x),out[2]=0):(out[0]=Math.asin(2*(x*z-w*y)),out[1]=Math.atan2(2*(x*w+y*z),1-2*(z2+w2)),out[2]=Math.atan2(2*(x*y+z*w),1-2*(y2+z2))),out}(out,quat)}function index_esm_fromRotationTranslationScale(rotation,x,y,scaleX,scaleY){var cos=Math.cos(rotation),sin=Math.sin(rotation);return function mat3_fromValues(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out}(scaleX*cos,scaleY*sin,0,-scaleX*sin,scaleY*cos,0,x,y,1)}function decompose(mat){var row0x=mat[0],row0y=mat[1],row1x=mat[3],row1y=mat[4],scalingX=Math.sqrt(row0x*row0x+row0y*row0y),scalingY=Math.sqrt(row1x*row1x+row1y*row1y);row0x*row1y-row0y*row1x<0&&(row0x<row1y?scalingX=-scalingX:scalingY=-scalingY),scalingX&&(row0x*=1/scalingX,row0y*=1/scalingX),scalingY&&(row1x*=1/scalingY,row1y*=1/scalingY);var angle=rad2deg(Math.atan2(row0y,row0x));return[mat[6],mat[7],scalingX,scalingY,angle]}var tmp=mat4_create(),perspectiveMatrix=mat4_create(),tmpVec4=vec4_create(),row=[create(),create(),create()],pdum3=create();function combine(out,a,b,scale1,scale2){out[0]=a[0]*scale1+b[0]*scale2,out[1]=a[1]*scale1+b[1]*scale2,out[2]=a[2]*scale1+b[2]*scale2}var Mask,AABB=function(){function AABB(){this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return AABB.isEmpty=function(aabb){return!aabb||0===aabb.halfExtents[0]&&0===aabb.halfExtents[1]&&0===aabb.halfExtents[2]},AABB.prototype.update=function(center,halfExtents){copyVec3(this.center,center),copyVec3(this.halfExtents,halfExtents),subVec3(this.min,this.center,this.halfExtents),addVec3(this.max,this.center,this.halfExtents)},AABB.prototype.setMinMax=function(min,max){addVec3(this.center,max,min),scaleVec3(this.center,this.center,.5),subVec3(this.halfExtents,max,min),scaleVec3(this.halfExtents,this.halfExtents,.5),copyVec3(this.min,min),copyVec3(this.max,max)},AABB.prototype.getMin=function(){return this.min},AABB.prototype.getMax=function(){return this.max},AABB.prototype.add=function(aabb){if(!AABB.isEmpty(aabb))if(AABB.isEmpty(this))this.setMinMax(aabb.getMin(),aabb.getMax());else{var tc=this.center,tcx=tc[0],tcy=tc[1],tcz=tc[2],th=this.halfExtents,thx=th[0],thy=th[1],thz=th[2],tminx=tcx-thx,tmaxx=tcx+thx,tminy=tcy-thy,tmaxy=tcy+thy,tminz=tcz-thz,tmaxz=tcz+thz,oc=aabb.center,ocx=oc[0],ocy=oc[1],ocz=oc[2],oh=aabb.halfExtents,ohx=oh[0],ohy=oh[1],ohz=oh[2],ominx=ocx-ohx,omaxx=ocx+ohx,ominy=ocy-ohy,omaxy=ocy+ohy,ominz=ocz-ohz,omaxz=ocz+ohz;ominx<tminx&&(tminx=ominx),omaxx>tmaxx&&(tmaxx=omaxx),ominy<tminy&&(tminy=ominy),omaxy>tmaxy&&(tmaxy=omaxy),ominz<tminz&&(tminz=ominz),omaxz>tmaxz&&(tmaxz=omaxz),tc[0]=.5*(tminx+tmaxx),tc[1]=.5*(tminy+tmaxy),tc[2]=.5*(tminz+tmaxz),th[0]=.5*(tmaxx-tminx),th[1]=.5*(tmaxy-tminy),th[2]=.5*(tmaxz-tminz),this.min[0]=tminx,this.min[1]=tminy,this.min[2]=tminz,this.max[0]=tmaxx,this.max[1]=tmaxy,this.max[2]=tmaxz}},AABB.prototype.setFromTransformedAABB=function(aabb,m){var bc=this.center,br=this.halfExtents,ac=aabb.center,ar=aabb.halfExtents,mx0=m[0],mx1=m[4],mx2=m[8],my0=m[1],my1=m[5],my2=m[9],mz0=m[2],mz1=m[6],mz2=m[10],mx0a=Math.abs(mx0),mx1a=Math.abs(mx1),mx2a=Math.abs(mx2),my0a=Math.abs(my0),my1a=Math.abs(my1),my2a=Math.abs(my2),mz0a=Math.abs(mz0),mz1a=Math.abs(mz1),mz2a=Math.abs(mz2);bc[0]=m[12]+mx0*ac[0]+mx1*ac[1]+mx2*ac[2],bc[1]=m[13]+my0*ac[0]+my1*ac[1]+my2*ac[2],bc[2]=m[14]+mz0*ac[0]+mz1*ac[1]+mz2*ac[2],br[0]=mx0a*ar[0]+mx1a*ar[1]+mx2a*ar[2],br[1]=my0a*ar[0]+my1a*ar[1]+my2a*ar[2],br[2]=mz0a*ar[0]+mz1a*ar[1]+mz2a*ar[2],subVec3(this.min,bc,br),addVec3(this.max,bc,br)},AABB.prototype.intersects=function(aabb){var aMax=this.getMax(),aMin=this.getMin(),bMax=aabb.getMax(),bMin=aabb.getMin();return aMin[0]<=bMax[0]&&aMax[0]>=bMin[0]&&aMin[1]<=bMax[1]&&aMax[1]>=bMin[1]&&aMin[2]<=bMax[2]&&aMax[2]>=bMin[2]},AABB.prototype.intersection=function(aabb){if(!this.intersects(aabb))return null;var intersection=new AABB,min=function maxVec3(o,a,b){return o[0]=Math.max(a[0],b[0]),o[1]=Math.max(a[1],b[1]),o[2]=Math.max(a[2],b[2]),o}([0,0,0],this.getMin(),aabb.getMin()),max=function minVec3(o,a,b){return o[0]=Math.min(a[0],b[0]),o[1]=Math.min(a[1],b[1]),o[2]=Math.min(a[2],b[2]),o}([0,0,0],this.getMax(),aabb.getMax());return intersection.setMinMax(min,max),intersection},AABB.prototype.getNegativeFarPoint=function(plane){return 273===plane.pnVertexFlag?copyVec3([0,0,0],this.min):272===plane.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===plane.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===plane.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===plane.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===plane.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===plane.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]},AABB.prototype.getPositiveFarPoint=function(plane){return 273===plane.pnVertexFlag?copyVec3([0,0,0],this.max):272===plane.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===plane.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===plane.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===plane.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===plane.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===plane.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]},AABB}(),Plane=function(){function Plane(distance,normal){this.distance=distance||0,this.normal=normal||fromValues(0,1,0),this.updatePNVertexFlag()}return Plane.prototype.updatePNVertexFlag=function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)},Plane.prototype.distanceToPoint=function(point){return vec3_dot(point,this.normal)-this.distance},Plane.prototype.normalize=function(){var invLen=1/len(this.normal);scale(this.normal,this.normal,invLen),this.distance*=invLen},Plane.prototype.intersectsLine=function(start,end,point){var d0=this.distanceToPoint(start),t=d0/(d0-this.distanceToPoint(end)),intersects=t>=0&&t<=1;return intersects&&point&&lerp(point,start,end,t),intersects},Plane}();!function(Mask){Mask[Mask.OUTSIDE=4294967295]="OUTSIDE",Mask[Mask.INSIDE=0]="INSIDE",Mask[Mask.INDETERMINATE=2147483647]="INDETERMINATE"}(Mask||(Mask={}));var CameraType,CameraTrackingMode,CameraProjectionMode,Frustum=function(){function Frustum(planes){if(this.planes=[],planes)this.planes=planes;else for(var i=0;i<6;i++)this.planes.push(new Plane)}return Frustum.prototype.extractFromVPMatrix=function(projectionMatrix){var _a=(0,tslib_es6.zs)(projectionMatrix,16),m0=_a[0],m1=_a[1],m2=_a[2],m3=_a[3],m4=_a[4],m5=_a[5],m6=_a[6],m7=_a[7],m8=_a[8],m9=_a[9],m10=_a[10],m11=_a[11],m12=_a[12],m13=_a[13],m14=_a[14],m15=_a[15];set(this.planes[0].normal,m3-m0,m7-m4,m11-m8),this.planes[0].distance=m15-m12,set(this.planes[1].normal,m3+m0,m7+m4,m11+m8),this.planes[1].distance=m15+m12,set(this.planes[2].normal,m3+m1,m7+m5,m11+m9),this.planes[2].distance=m15+m13,set(this.planes[3].normal,m3-m1,m7-m5,m11-m9),this.planes[3].distance=m15-m13,set(this.planes[4].normal,m3-m2,m7-m6,m11-m10),this.planes[4].distance=m15-m14,set(this.planes[5].normal,m3+m2,m7+m6,m11+m10),this.planes[5].distance=m15+m14,this.planes.forEach((function(plane){plane.normalize(),plane.updatePNVertexFlag()}))},Frustum}(),Point=function(){function Point(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=0,this.y=0,this.x=x,this.y=y}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copyFrom=function(p){this.x=p.x,this.y=p.y},Point}(),Rectangle=function(){function Rectangle(x,y,width,height){this.x=x,this.y=y,this.width=width,this.height=height,this.left=x,this.right=x+width,this.top=y,this.bottom=y+height}return Rectangle.prototype.toJSON=function(){},Rectangle}();!function(CameraType){CameraType[CameraType.ORBITING=0]="ORBITING",CameraType[CameraType.EXPLORING=1]="EXPLORING",CameraType[CameraType.TRACKING=2]="TRACKING"}(CameraType||(CameraType={})),function(CameraTrackingMode){CameraTrackingMode[CameraTrackingMode.DEFAULT=0]="DEFAULT",CameraTrackingMode[CameraTrackingMode.ROTATIONAL=1]="ROTATIONAL",CameraTrackingMode[CameraTrackingMode.TRANSLATIONAL=2]="TRANSLATIONAL",CameraTrackingMode[CameraTrackingMode.CINEMATIC=3]="CINEMATIC"}(CameraTrackingMode||(CameraTrackingMode={})),function(CameraProjectionMode){CameraProjectionMode[CameraProjectionMode.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",CameraProjectionMode[CameraProjectionMode.PERSPECTIVE=1]="PERSPECTIVE"}(CameraProjectionMode||(CameraProjectionMode={}));var UnitType,UnitCategory,ValueRange,Nested,ParenLess,CameraEvent_UPDATED="updated",Camera=function(){function Camera(){this.clipSpaceNearZ=index_esm_ClipSpaceNearZ.NEGATIVE_ONE,this.eventEmitter=new node_modules_eventemitter3,this.matrix=mat4_create(),this.right=fromValues(1,0,0),this.up=fromValues(0,1,0),this.forward=fromValues(0,0,1),this.position=fromValues(0,0,1),this.focalPoint=fromValues(0,0,0),this.distanceVector=fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=mat4_create(),this.projectionMatrixInverse=mat4_create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=CameraType.EXPLORING,this.trackingMode=CameraTrackingMode.DEFAULT,this.projectionMode=CameraProjectionMode.PERSPECTIVE,this.frustum=new Frustum,this.orthoMatrix=mat4_create()}return Camera.prototype.isOrtho=function(){return this.projectionMode===CameraProjectionMode.ORTHOGRAPHIC},Camera.prototype.getProjectionMode=function(){return this.projectionMode},Camera.prototype.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},Camera.prototype.getPerspectiveInverse=function(){return this.projectionMatrixInverse},Camera.prototype.getFrustum=function(){return this.frustum},Camera.prototype.getPosition=function(){return this.position},Camera.prototype.getFocalPoint=function(){return this.focalPoint},Camera.prototype.getDollyingStep=function(){return this.dollyingStep},Camera.prototype.getNear=function(){return this.near},Camera.prototype.getFar=function(){return this.far},Camera.prototype.getZoom=function(){return this.zoom},Camera.prototype.getOrthoMatrix=function(){return this.orthoMatrix},Camera.prototype.getView=function(){return this.view},Camera.prototype.setEnableUpdate=function(enabled){this.enableUpdate=enabled},Camera.prototype.setType=function(type,trackingMode){return this.type=type,this.type===CameraType.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===CameraType.TRACKING&&void 0!==trackingMode&&this.setTrackingMode(trackingMode),this},Camera.prototype.setProjectionMode=function(projectionMode){return this.projectionMode=projectionMode,this},Camera.prototype.setTrackingMode=function(trackingMode){if(this.type!==CameraType.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=trackingMode,this},Camera.prototype.setWorldRotation=function(flag){return this.rotateWorld=flag,this._getAngles(),this},Camera.prototype.getViewTransform=function(){return invert(mat4_create(),this.matrix)},Camera.prototype.getWorldTransform=function(){return this.matrix},Camera.prototype.jitterProjectionMatrix=function(x,y){var translation=fromTranslation(mat4_create(),[x,y,0]);this.jitteredProjectionMatrix=mat4_multiply(mat4_create(),translation,this.projectionMatrix)},Camera.prototype.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},Camera.prototype.setMatrix=function(matrix){return this.matrix=matrix,this._update(),this},Camera.prototype.setFov=function(fov){return this.setPerspective(this.near,this.far,fov,this.aspect),this},Camera.prototype.setAspect=function(aspect){return this.setPerspective(this.near,this.far,this.fov,aspect),this},Camera.prototype.setNear=function(near){return this.projectionMode===CameraProjectionMode.PERSPECTIVE?this.setPerspective(near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,near,this.far),this},Camera.prototype.setFar=function(far){return this.projectionMode===CameraProjectionMode.PERSPECTIVE?this.setPerspective(this.near,far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,far),this},Camera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){return this.aspect=fullWidth/fullHeight,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=fullWidth,this.view.fullHeight=fullHeight,this.view.offsetX=x,this.view.offsetY=y,this.view.width=width,this.view.height=height,this.projectionMode===CameraProjectionMode.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},Camera.prototype.clearViewOffset=function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===CameraProjectionMode.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},Camera.prototype.setZoom=function(zoom){return this.zoom=zoom,this.projectionMode===CameraProjectionMode.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===CameraProjectionMode.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},Camera.prototype.setZoomByViewportPoint=function(zoom,viewportPoint){var _a=this.canvas.viewport2Canvas({x:viewportPoint[0],y:viewportPoint[1]}),ox=_a.x,oy=_a.y,roll=this.roll;this.rotate(0,0,-roll),this.setPosition(ox,oy),this.setFocalPoint(ox,oy),this.setZoom(zoom),this.rotate(0,0,roll);var _b=this.canvas.viewport2Canvas({x:viewportPoint[0],y:viewportPoint[1]}),dvec=fromValues(_b.x-ox,_b.y-oy,0),dx=vec3_dot(dvec,this.right)/vec3_length(this.right),dy=vec3_dot(dvec,this.up)/vec3_length(this.up);return this.pan(-dx,-dy),this},Camera.prototype.setPerspective=function(near,far,fov,aspect){var _a;this.projectionMode=CameraProjectionMode.PERSPECTIVE,this.fov=fov,this.near=near,this.far=far,this.aspect=aspect;var top=this.near*Math.tan(deg2rad(.5*this.fov))/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width;if(null===(_a=this.view)||void 0===_a?void 0:_a.enabled){var fullWidth=this.view.fullWidth,fullHeight=this.view.fullHeight;left+=this.view.offsetX*width/fullWidth,top-=this.view.offsetY*height/fullHeight,width*=this.view.width/fullWidth,height*=this.view.height/fullHeight}return function makePerspective(out,left,right,top,bottom,near,far,zero){void 0===zero&&(zero=!1);var c,d,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom);return zero?(c=-far/(far-near),d=-far*near/(far-near)):(c=-(far+near)/(far-near),d=-2*far*near/(far-near)),out[0]=x,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=y,out[6]=0,out[7]=0,out[8]=a,out[9]=b,out[10]=c,out[11]=-1,out[12]=0,out[13]=0,out[14]=d,out[15]=0,out}(this.projectionMatrix,left,left+width,top,top-height,near,this.far,this.clipSpaceNearZ===index_esm_ClipSpaceNearZ.ZERO),mat4_scale(this.projectionMatrix,this.projectionMatrix,fromValues(1,-1,1)),invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this},Camera.prototype.setOrthographic=function(l,r,t,b,near,far){var _a;this.projectionMode=CameraProjectionMode.ORTHOGRAPHIC,this.rright=r,this.left=l,this.top=t,this.bottom=b,this.near=near,this.far=far;var dx=(this.rright-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.rright+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;if(null===(_a=this.view)||void 0===_a?void 0:_a.enabled){var scaleW=(this.rright-this.left)/this.view.fullWidth/this.zoom,scaleH=(this.top-this.bottom)/this.view.fullHeight/this.zoom;right=(left+=scaleW*this.view.offsetX)+scaleW*this.view.width,bottom=(top-=scaleH*this.view.offsetY)-scaleH*this.view.height}return this.clipSpaceNearZ===index_esm_ClipSpaceNearZ.NEGATIVE_ONE?ortho(this.projectionMatrix,left,right,bottom,top,near,far):orthoZO(this.projectionMatrix,left,right,bottom,top,near,far),mat4_scale(this.projectionMatrix,this.projectionMatrix,fromValues(1,-1,1)),invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this},Camera.prototype.setPosition=function(x,y,z){void 0===y&&(y=this.position[1]),void 0===z&&(z=this.position[2]);var position=createVec3(x,y,z);return this._setPosition(position),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this},Camera.prototype.setFocalPoint=function(x,y,z){void 0===y&&(y=this.focalPoint[1]),void 0===z&&(z=this.focalPoint[2]);var up=fromValues(0,1,0);if(this.focalPoint=createVec3(x,y,z),this.trackingMode===CameraTrackingMode.CINEMATIC){var d=subtract(create(),this.focalPoint,this.position);x=d[0],y=d[1],z=d[2];var r=vec3_length(d),el=rad2deg(Math.asin(y/r)),az=90+rad2deg(Math.atan2(z,x)),m=mat4_create();mat4_rotateY(m,m,deg2rad(az)),mat4_rotateX(m,m,deg2rad(el)),up=transformMat4(create(),[0,1,0],m)}return invert(this.matrix,lookAt(mat4_create(),this.position,this.focalPoint,up)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this},Camera.prototype.getDistance=function(){return this.distance},Camera.prototype.getDistanceVector=function(){return this.distanceVector},Camera.prototype.setDistance=function(d){if(this.distance===d||d<0)return this;this.distance=d,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var pos=create();d=this.distance;var n=this.forward,f=this.focalPoint;return pos[0]=d*n[0]+f[0],pos[1]=d*n[1]+f[1],pos[2]=d*n[2]+f[2],this._setPosition(pos),this.triggerUpdate(),this},Camera.prototype.setMaxDistance=function(d){return this.maxDistance=d,this},Camera.prototype.setMinDistance=function(d){return this.minDistance=d,this},Camera.prototype.setAzimuth=function(az){return this.azimuth=dist_index_esm_getAngle(az),this.computeMatrix(),this._getAxes(),this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?this._getPosition():this.type===CameraType.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},Camera.prototype.getAzimuth=function(){return this.azimuth},Camera.prototype.setElevation=function(el){return this.elevation=dist_index_esm_getAngle(el),this.computeMatrix(),this._getAxes(),this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?this._getPosition():this.type===CameraType.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},Camera.prototype.getElevation=function(){return this.elevation},Camera.prototype.setRoll=function(angle){return this.roll=dist_index_esm_getAngle(angle),this.computeMatrix(),this._getAxes(),this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?this._getPosition():this.type===CameraType.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},Camera.prototype.getRoll=function(){return this.roll},Camera.prototype._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()},Camera.prototype.computeMatrix=function(){var rotZ=setAxisAngle(quat_create(),[0,0,1],deg2rad(this.roll));identity(this.matrix);var rotX=setAxisAngle(quat_create(),[1,0,0],deg2rad((this.rotateWorld&&this.type!==CameraType.TRACKING||this.type===CameraType.TRACKING?1:-1)*this.elevation)),rotY=setAxisAngle(quat_create(),[0,1,0],deg2rad((this.rotateWorld&&this.type!==CameraType.TRACKING||this.type===CameraType.TRACKING?1:-1)*this.azimuth)),rotQ=quat_multiply(quat_create(),rotY,rotX);rotQ=quat_multiply(quat_create(),rotQ,rotZ);var rotMatrix=fromQuat(mat4_create(),rotQ);this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?(translate(this.matrix,this.matrix,this.focalPoint),mat4_multiply(this.matrix,this.matrix,rotMatrix),translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===CameraType.TRACKING&&(translate(this.matrix,this.matrix,this.position),mat4_multiply(this.matrix,this.matrix,rotMatrix))},Camera.prototype._setPosition=function(x,y,z){this.position=createVec3(x,y,z);var m=this.matrix;m[12]=this.position[0],m[13]=this.position[1],m[14]=this.position[2],m[15]=1,this._getOrthoMatrix()},Camera.prototype._getAxes=function(){copy(this.right,createVec3(vec4_transformMat4(vec4_create(),[1,0,0,0],this.matrix))),copy(this.up,createVec3(vec4_transformMat4(vec4_create(),[0,1,0,0],this.matrix))),copy(this.forward,createVec3(vec4_transformMat4(vec4_create(),[0,0,1,0],this.matrix))),normalize(this.right,this.right),normalize(this.up,this.up),normalize(this.forward,this.forward)},Camera.prototype._getAngles=function(){var x=this.distanceVector[0],y=this.distanceVector[1],z=this.distanceVector[2],r=vec3_length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===CameraType.TRACKING||this.rotateWorld?(this.elevation=rad2deg(Math.asin(y/r)),this.azimuth=rad2deg(Math.atan2(-x,-z))):(this.elevation=-rad2deg(Math.asin(y/r)),this.azimuth=-rad2deg(Math.atan2(-x,-z)))},Camera.prototype._getPosition=function(){copy(this.position,createVec3(vec4_transformMat4(vec4_create(),[0,0,0,1],this.matrix))),this._getDistance()},Camera.prototype._getFocalPoint=function(){!function transformMat3(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=x*m[0]+y*m[3]+z*m[6],out[1]=x*m[1]+y*m[4]+z*m[7],out[2]=x*m[2]+y*m[5]+z*m[8],out}(this.distanceVector,[0,0,-this.distance],function fromMat4(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[4],out[4]=a[5],out[5]=a[6],out[6]=a[8],out[7]=a[9],out[8]=a[10],out}(mat3_create(),this.matrix)),add(this.focalPoint,this.position,this.distanceVector),this._getDistance()},Camera.prototype._getDistance=function(){this.distanceVector=subtract(create(),this.focalPoint,this.position),this.distance=vec3_length(this.distanceVector),this.dollyingStep=this.distance/100},Camera.prototype._getOrthoMatrix=function(){if(this.projectionMode===CameraProjectionMode.ORTHOGRAPHIC){var position=this.position,rotZ=setAxisAngle(quat_create(),[0,0,1],-this.roll*Math.PI/180);fromRotationTranslationScaleOrigin(this.orthoMatrix,rotZ,fromValues((this.rright-this.left)/2-position[0],(this.top-this.bottom)/2-position[1],0),fromValues(this.zoom,this.zoom,1),position)}},Camera.prototype.triggerUpdate=function(){if(this.enableUpdate){var viewMatrix=this.getViewTransform(),vpMatrix=mat4_multiply(mat4_create(),this.getPerspective(),viewMatrix);this.getFrustum().extractFromVPMatrix(vpMatrix),this.eventEmitter.emit(CameraEvent_UPDATED)}},Camera.prototype.rotate=function(azimuth,elevation,roll){throw new Error("Method not implemented.")},Camera.prototype.pan=function(tx,ty){throw new Error("Method not implemented.")},Camera.prototype.dolly=function(value){throw new Error("Method not implemented.")},Camera.prototype.createLandmark=function(name,params){throw new Error("Method not implemented.")},Camera.prototype.gotoLandmark=function(name,options){throw new Error("Method not implemented.")},Camera.prototype.cancelLandmarkAnimation=function(){throw new Error("Method not implemented.")},Camera}();function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||Map),memoized}memoize.Cache=Map,function(UnitType){UnitType[UnitType.kUnknown=0]="kUnknown",UnitType[UnitType.kNumber=1]="kNumber",UnitType[UnitType.kPercentage=2]="kPercentage",UnitType[UnitType.kEms=3]="kEms",UnitType[UnitType.kPixels=4]="kPixels",UnitType[UnitType.kRems=5]="kRems",UnitType[UnitType.kDegrees=6]="kDegrees",UnitType[UnitType.kRadians=7]="kRadians",UnitType[UnitType.kGradians=8]="kGradians",UnitType[UnitType.kTurns=9]="kTurns",UnitType[UnitType.kMilliseconds=10]="kMilliseconds",UnitType[UnitType.kSeconds=11]="kSeconds",UnitType[UnitType.kInteger=12]="kInteger"}(UnitType||(UnitType={})),function(UnitCategory){UnitCategory[UnitCategory.kUNumber=0]="kUNumber",UnitCategory[UnitCategory.kUPercent=1]="kUPercent",UnitCategory[UnitCategory.kULength=2]="kULength",UnitCategory[UnitCategory.kUAngle=3]="kUAngle",UnitCategory[UnitCategory.kUTime=4]="kUTime",UnitCategory[UnitCategory.kUOther=5]="kUOther"}(UnitCategory||(UnitCategory={})),function(ValueRange){ValueRange[ValueRange.kAll=0]="kAll",ValueRange[ValueRange.kNonNegative=1]="kNonNegative",ValueRange[ValueRange.kInteger=2]="kInteger",ValueRange[ValueRange.kNonNegativeInteger=3]="kNonNegativeInteger",ValueRange[ValueRange.kPositiveInteger=4]="kPositiveInteger"}(ValueRange||(ValueRange={})),function(Nested){Nested[Nested.kYes=0]="kYes",Nested[Nested.kNo=1]="kNo"}(Nested||(Nested={})),function(ParenLess){ParenLess[ParenLess.kYes=0]="kYes",ParenLess[ParenLess.kNo=1]="kNo"}(ParenLess||(ParenLess={}));var CSSStyleValueType,data=[{name:"em",unit_type:UnitType.kEms},{name:"px",unit_type:UnitType.kPixels},{name:"deg",unit_type:UnitType.kDegrees},{name:"rad",unit_type:UnitType.kRadians},{name:"grad",unit_type:UnitType.kGradians},{name:"ms",unit_type:UnitType.kMilliseconds},{name:"s",unit_type:UnitType.kSeconds},{name:"rem",unit_type:UnitType.kRems},{name:"turn",unit_type:UnitType.kTurns}];!function(CSSStyleValueType){CSSStyleValueType[CSSStyleValueType.kUnknownType=0]="kUnknownType",CSSStyleValueType[CSSStyleValueType.kUnparsedType=1]="kUnparsedType",CSSStyleValueType[CSSStyleValueType.kKeywordType=2]="kKeywordType",CSSStyleValueType[CSSStyleValueType.kUnitType=3]="kUnitType",CSSStyleValueType[CSSStyleValueType.kSumType=4]="kSumType",CSSStyleValueType[CSSStyleValueType.kProductType=5]="kProductType",CSSStyleValueType[CSSStyleValueType.kNegateType=6]="kNegateType",CSSStyleValueType[CSSStyleValueType.kInvertType=7]="kInvertType",CSSStyleValueType[CSSStyleValueType.kMinType=8]="kMinType",CSSStyleValueType[CSSStyleValueType.kMaxType=9]="kMaxType",CSSStyleValueType[CSSStyleValueType.kClampType=10]="kClampType",CSSStyleValueType[CSSStyleValueType.kTransformType=11]="kTransformType",CSSStyleValueType[CSSStyleValueType.kPositionType=12]="kPositionType",CSSStyleValueType[CSSStyleValueType.kURLImageType=13]="kURLImageType",CSSStyleValueType[CSSStyleValueType.kColorType=14]="kColorType",CSSStyleValueType[CSSStyleValueType.kUnsupportedColorType=15]="kUnsupportedColorType"}(CSSStyleValueType||(CSSStyleValueType={}));var GradientType,unitFromName=function(name){return name?"number"===name?UnitType.kNumber:"percent"===name||"%"===name?UnitType.kPercentage:function(name){return data.find((function(item){return item.name===name})).unit_type}(name):UnitType.kUnknown},conversionToCanonicalUnitsScaleFactor=function(unit_type){var factor=1;switch(unit_type){case UnitType.kPixels:case UnitType.kDegrees:case UnitType.kSeconds:break;case UnitType.kMilliseconds:factor=.001;break;case UnitType.kRadians:factor=180/Math.PI;break;case UnitType.kGradians:factor=.9;break;case UnitType.kTurns:factor=360}return factor},unitTypeToString=function(type){switch(type){case UnitType.kNumber:case UnitType.kInteger:return"";case UnitType.kPercentage:return"%";case UnitType.kEms:return"em";case UnitType.kRems:return"rem";case UnitType.kPixels:return"px";case UnitType.kDegrees:return"deg";case UnitType.kRadians:return"rad";case UnitType.kGradians:return"grad";case UnitType.kMilliseconds:return"ms";case UnitType.kSeconds:return"s";case UnitType.kTurns:return"turn"}return""},CSSStyleValue=function(){function CSSStyleValue(){}return CSSStyleValue.isAngle=function(unit){return unit===UnitType.kDegrees||unit===UnitType.kRadians||unit===UnitType.kGradians||unit===UnitType.kTurns},CSSStyleValue.isLength=function(type){return type>=UnitType.kEms&&type<UnitType.kDegrees},CSSStyleValue.isRelativeUnit=function(type){return type===UnitType.kPercentage||type===UnitType.kEms||type===UnitType.kRems},CSSStyleValue.isTime=function(unit){return unit===UnitType.kSeconds||unit===UnitType.kMilliseconds},CSSStyleValue.prototype.toString=function(){return this.buildCSSText(Nested.kNo,ParenLess.kNo,"")},CSSStyleValue.prototype.isNumericValue=function(){return this.getType()>=CSSStyleValueType.kUnitType&&this.getType()<=CSSStyleValueType.kClampType},CSSStyleValue}(),CSSColorValue=function(_super){function CSSColorValue(colorSpace){var _this=_super.call(this)||this;return _this.colorSpace=colorSpace,_this}return(0,tslib_es6.C6)(CSSColorValue,_super),CSSColorValue.prototype.getType=function(){return CSSStyleValueType.kColorType},CSSColorValue.prototype.to=function(colorSpace){return this},CSSColorValue}(CSSStyleValue);!function(GradientType){GradientType[GradientType.Constant=0]="Constant",GradientType[GradientType.LinearGradient=1]="LinearGradient",GradientType[GradientType.RadialGradient=2]="RadialGradient"}(GradientType||(GradientType={}));var CSSGradientValue=function(_super){function CSSGradientValue(type,value){var _this=_super.call(this)||this;return _this.type=type,_this.value=value,_this}return(0,tslib_es6.C6)(CSSGradientValue,_super),CSSGradientValue.prototype.clone=function(){return new CSSGradientValue(this.type,this.value)},CSSGradientValue.prototype.buildCSSText=function(n,p,result){return result},CSSGradientValue.prototype.getType=function(){return CSSStyleValueType.kColorType},CSSGradientValue}(CSSStyleValue),CSSKeywordValue=function(_super){function CSSKeywordValue(value){var _this=_super.call(this)||this;return _this.value=value,_this}return(0,tslib_es6.C6)(CSSKeywordValue,_super),CSSKeywordValue.prototype.clone=function(){return new CSSKeywordValue(this.value)},CSSKeywordValue.prototype.getType=function(){return CSSStyleValueType.kKeywordType},CSSKeywordValue.prototype.buildCSSText=function(n,p,result){return result+this.value},CSSKeywordValue}(CSSStyleValue),camelCase=memoize((function(str){return void 0===str&&(str=""),str.replace(/-([a-z])/g,(function(g){return g[1].toUpperCase()}))})),kebabize=function(str){return str.split("").map((function(letter,idx){return letter.toUpperCase()===letter?"".concat(0!==idx?"-":"").concat(letter.toLowerCase()):letter})).join("")};function index_esm_isFunction(func){return"function"==typeof func}var FORMAT_ATTR_MAP={d:{alias:"path"},strokeDasharray:{alias:"lineDash"},strokeWidth:{alias:"lineWidth"},textAnchor:{alias:"textAlign"},src:{alias:"img"}},formatAttributeName=memoize((function(name){var attributeName=camelCase(name),map=FORMAT_ATTR_MAP[attributeName];return attributeName=(null==map?void 0:map.alias)||attributeName})),formatInfinityOrNaN=function(number,suffix){void 0===suffix&&(suffix="");var result="";return Number.isFinite(number)?(!function DCHECK(bool){if(!bool)throw new Error}(Number.isNaN(number)),result="NaN"):result=number>0?"infinity":"-infinity",result+suffix},toCanonicalUnit=function(unit){return function(category){switch(category){case UnitCategory.kUNumber:return UnitType.kNumber;case UnitCategory.kULength:return UnitType.kPixels;case UnitCategory.kUPercent:return UnitType.kPercentage;case UnitCategory.kUTime:return UnitType.kSeconds;case UnitCategory.kUAngle:return UnitType.kDegrees;default:return UnitType.kUnknown}}(function(type){switch(type){case UnitType.kNumber:case UnitType.kInteger:return UnitCategory.kUNumber;case UnitType.kPercentage:return UnitCategory.kUPercent;case UnitType.kPixels:return UnitCategory.kULength;case UnitType.kMilliseconds:case UnitType.kSeconds:return UnitCategory.kUTime;case UnitType.kDegrees:case UnitType.kRadians:case UnitType.kGradians:case UnitType.kTurns:return UnitCategory.kUAngle;default:return UnitCategory.kUOther}}(unit))},CSSUnitValue=function(_super){function CSSUnitValue(value,unitOrName){void 0===unitOrName&&(unitOrName=UnitType.kNumber);var unit,_this=_super.call(this)||this;return unit="string"==typeof unitOrName?unitFromName(unitOrName):unitOrName,_this.unit=unit,_this.value=value,_this}return(0,tslib_es6.C6)(CSSUnitValue,_super),CSSUnitValue.prototype.clone=function(){return new CSSUnitValue(this.value,this.unit)},CSSUnitValue.prototype.equals=function(other){var other_unit_value=other;return this.value===other_unit_value.value&&this.unit===other_unit_value.unit},CSSUnitValue.prototype.getType=function(){return CSSStyleValueType.kUnitType},CSSUnitValue.prototype.convertTo=function(target_unit){if(this.unit===target_unit)return new CSSUnitValue(this.value,this.unit);var canonical_unit=toCanonicalUnit(this.unit);if(canonical_unit!==toCanonicalUnit(target_unit)||canonical_unit===UnitType.kUnknown)return null;var scale_factor=conversionToCanonicalUnitsScaleFactor(this.unit)/conversionToCanonicalUnitsScaleFactor(target_unit);return new CSSUnitValue(this.value*scale_factor,target_unit)},CSSUnitValue.prototype.buildCSSText=function(n,p,result){var text;switch(this.unit){case UnitType.kUnknown:break;case UnitType.kInteger:text=Number(this.value).toFixed(0);break;case UnitType.kNumber:case UnitType.kPercentage:case UnitType.kEms:case UnitType.kRems:case UnitType.kPixels:case UnitType.kDegrees:case UnitType.kRadians:case UnitType.kGradians:case UnitType.kMilliseconds:case UnitType.kSeconds:case UnitType.kTurns:var value=this.value,unit=unitTypeToString(this.unit);if(value<-999999||value>999999){var unit_1=unitTypeToString(this.unit);text=!Number.isFinite(value)||Number.isNaN(value)?formatInfinityOrNaN(value,unit_1):value+(unit_1||"")}else text="".concat(value).concat(unit)}return result+=text},CSSUnitValue}(CSSStyleValue),Opx=new CSSUnitValue(0,"px");new CSSUnitValue(1,"px");var Strategy,SortReason,Odeg=new CSSUnitValue(0,"deg"),CSSRGB=function(_super){function CSSRGB(r,g,b,alpha,isNone){void 0===alpha&&(alpha=1),void 0===isNone&&(isNone=!1);var _this=_super.call(this,"rgb")||this;return _this.r=r,_this.g=g,_this.b=b,_this.alpha=alpha,_this.isNone=isNone,_this}return(0,tslib_es6.C6)(CSSRGB,_super),CSSRGB.prototype.clone=function(){return new CSSRGB(this.r,this.g,this.b,this.alpha)},CSSRGB.prototype.buildCSSText=function(n,p,result){return result+"rgba(".concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")},CSSRGB}(CSSColorValue),unsetKeywordValue=new CSSKeywordValue("unset"),initialKeywordValue=new CSSKeywordValue("initial"),inheritKeywordValue=new CSSKeywordValue("inherit"),keywordCache={"":unsetKeywordValue,unset:unsetKeywordValue,initial:initialKeywordValue,inherit:inheritKeywordValue},getOrCreateKeyword=function(name){return keywordCache[name]||(keywordCache[name]=new CSSKeywordValue(name)),keywordCache[name]},noneColor=new CSSRGB(0,0,0,0,!0),transparentColor=new CSSRGB(0,0,0,0),getOrCreateRGBA=memoize((function(r,g,b,a){return new CSSRGB(r,g,b,a)}),(function(r,g,b,a){return"rgba(".concat(r,",").concat(g,",").concat(b,",").concat(a,")")})),getOrCreateUnitValue=function(value,unitOrName){return void 0===unitOrName&&(unitOrName=UnitType.kNumber),new CSSUnitValue(value,unitOrName)},PECENTAGE_50=new CSSUnitValue(50,"%");!function(Strategy){Strategy[Strategy.Standard=0]="Standard"}(Strategy||(Strategy={})),function(SortReason){SortReason[SortReason.ADDED=0]="ADDED",SortReason[SortReason.REMOVED=1]="REMOVED",SortReason[SortReason.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED"}(SortReason||(SortReason={}));var PropertySyntax,EMPTY_PARSED_PATH={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Rectangle(0,0,0,0)};function colorStopToString(colorStop){var type=colorStop.type,value=colorStop.value;return"hex"===type?"#".concat(value):"literal"===type?value:"rgb"===type?"rgb(".concat(value.join(","),")"):"rgba(".concat(value.join(","),")")}!function(PropertySyntax){PropertySyntax.COORDINATE="<coordinate>",PropertySyntax.COLOR="<color>",PropertySyntax.PAINT="<paint>",PropertySyntax.NUMBER="<number>",PropertySyntax.ANGLE="<angle>",PropertySyntax.OPACITY_VALUE="<opacity-value>",PropertySyntax.SHADOW_BLUR="<shadow-blur>",PropertySyntax.LENGTH="<length>",PropertySyntax.PERCENTAGE="<percentage>",PropertySyntax.LENGTH_PERCENTAGE="<length> | <percentage>",PropertySyntax.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",PropertySyntax.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",PropertySyntax.LIST_OF_POINTS="<list-of-points>",PropertySyntax.PATH="<path>",PropertySyntax.FILTER="<filter>",PropertySyntax.Z_INDEX="<z-index>",PropertySyntax.OFFSET_DISTANCE="<offset-distance>",PropertySyntax.DEFINED_PATH="<defined-path>",PropertySyntax.MARKER="<marker>",PropertySyntax.TRANSFORM="<transform>",PropertySyntax.TRANSFORM_ORIGIN="<transform-origin>",PropertySyntax.TEXT="<text>",PropertySyntax.TEXT_TRANSFORM="<text-transform>"}(PropertySyntax||(PropertySyntax={}));var parseGradient$1=function(){var tokens={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},input="";function error(msg){throw new Error(input+": "+msg)}function getAST(){var ast=function matchListDefinitions(){return matchListing(matchDefinition)}();return input.length>0&&error("Invalid input not EOF"),ast}function matchDefinition(){return matchGradient("linear-gradient",tokens.linearGradient,matchLinearOrientation)||matchGradient("repeating-linear-gradient",tokens.repeatingLinearGradient,matchLinearOrientation)||matchGradient("radial-gradient",tokens.radialGradient,matchListRadialOrientations)||matchGradient("repeating-radial-gradient",tokens.repeatingRadialGradient,matchListRadialOrientations)||matchGradient("conic-gradient",tokens.conicGradient,matchListRadialOrientations)}function matchGradient(gradientType,pattern,orientationMatcher){return matchCall(pattern,(function(captures){var orientation=orientationMatcher();return orientation&&(scan(tokens.comma)||error("Missing comma before color stops")),{type:gradientType,orientation,colorStops:matchListing(matchColorStop)}}))}function matchCall(pattern,callback){var captures=scan(pattern);if(captures){scan(tokens.startCall)||error("Missing (");var result=callback(captures);return scan(tokens.endCall)||error("Missing )"),result}}function matchLinearOrientation(){return function matchSideOrCorner(){return match("directional",tokens.sideOrCorner,1)}()||function matchAngle(){return match("angular",tokens.angleValue,1)}()}function matchListRadialOrientations(){var radialOrientations,lookaheadCache,radialOrientation=matchRadialOrientation();return radialOrientation&&((radialOrientations=[]).push(radialOrientation),lookaheadCache=input,scan(tokens.comma)&&((radialOrientation=matchRadialOrientation())?radialOrientations.push(radialOrientation):input=lookaheadCache)),radialOrientations}function matchRadialOrientation(){var radialType=function matchCircle(){var circle=match("shape",/^(circle)/i,0);circle&&(circle.style=matchLength()||matchExtentKeyword());return circle}()||function matchEllipse(){var ellipse=match("shape",/^(ellipse)/i,0);ellipse&&(ellipse.style=matchDistance()||matchExtentKeyword());return ellipse}();if(radialType)radialType.at=matchAtPosition();else{var extent=matchExtentKeyword();if(extent){radialType=extent;var positionAt=matchAtPosition();positionAt&&(radialType.at=positionAt)}else{var defaultPosition=matchPositioning();defaultPosition&&(radialType={type:"default-radial",at:defaultPosition})}}return radialType}function matchExtentKeyword(){return match("extent-keyword",tokens.extentKeywords,1)}function matchAtPosition(){if(match("position",/^at/,0)){var positioning=matchPositioning();return positioning||error("Missing positioning value"),positioning}}function matchPositioning(){var location=function matchCoordinates(){return{x:matchDistance(),y:matchDistance()}}();if(location.x||location.y)return{type:"position",value:location}}function matchListing(matcher){var captures=matcher(),result=[];if(captures)for(result.push(captures);scan(tokens.comma);)(captures=matcher())?result.push(captures):error("One extra comma");return result}function matchColorStop(){var color=function matchColor(){return function matchHexColor(){return match("hex",tokens.hexColor,1)}()||function matchRGBAColor(){return matchCall(tokens.rgbaColor,(function(){return{type:"rgba",value:matchListing(matchNumber)}}))}()||function matchRGBColor(){return matchCall(tokens.rgbColor,(function(){return{type:"rgb",value:matchListing(matchNumber)}}))}()||function matchLiteralColor(){return match("literal",tokens.literalColor,0)}()}();return color||error("Expected color definition"),color.length=matchDistance(),color}function matchNumber(){return scan(tokens.number)[1]}function matchDistance(){return match("%",tokens.percentageValue,1)||function matchPositionKeyword(){return match("position-keyword",tokens.positionKeywords,1)}()||matchLength()}function matchLength(){return match("px",tokens.pixelValue,1)||match("em",tokens.emValue,1)}function match(type,pattern,captureIndex){var captures=scan(pattern);if(captures)return{type,value:captures[captureIndex]}}function scan(regexp){var blankCaptures=/^[\n\r\t\s]+/.exec(input);blankCaptures&&consume(blankCaptures[0].length);var captures=regexp.exec(input);return captures&&consume(captures[0].length),captures}function consume(size){input=input.substring(size)}return function(code){return input=code,getAST()}}();function computeLinearGradient(width,height,angle){var rad=deg2rad(angle.value),rcx=0+width/2,rcy=0+height/2,length=Math.abs(width*Math.cos(rad))+Math.abs(height*Math.sin(rad));return{x1:rcx-Math.cos(rad)*length/2,y1:rcy-Math.sin(rad)*length/2,x2:rcx+Math.cos(rad)*length/2,y2:rcy+Math.sin(rad)*length/2}}function computeRadialGradient(width,height,cx,cy,size){var x=cx.value,y=cy.value;cx.unit===UnitType.kPercentage&&(x=cx.value/100*width),cy.unit===UnitType.kPercentage&&(y=cy.value/100*height);var r=Math.max(distanceSquareRoot([0,0],[x,y]),distanceSquareRoot([0,height],[x,y]),distanceSquareRoot([width,height],[x,y]),distanceSquareRoot([width,0],[x,y]));return size&&(size instanceof CSSUnitValue?r=size.value:size instanceof CSSKeywordValue&&("closest-side"===size.value?r=Math.min(x,width-x,y,height-y):"farthest-side"===size.value?r=Math.max(x,width-x,y,height-y):"closest-corner"===size.value&&(r=Math.min(distanceSquareRoot([0,0],[x,y]),distanceSquareRoot([0,height],[x,y]),distanceSquareRoot([width,height],[x,y]),distanceSquareRoot([width,0],[x,y]))))),{x,y,r}}var regexLG=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,regexRG=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,regexPR=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,regexColorStop=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var SideOrCornerToDegMap={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},angleToDeg=memoize((function(orientation){var angle;return angle="angular"===orientation.type?Number(orientation.value):SideOrCornerToDegMap[orientation.value]||0,getOrCreateUnitValue(angle,"deg")})),positonToCSSUnitValue=memoize((function(position){var cx=50,cy=50,unitX="%",unitY="%";if("position"===(null==position?void 0:position.type)){var _a=position.value,x=_a.x,y=_a.y;"position-keyword"===(null==x?void 0:x.type)&&("left"===x.value?cx=0:"center"===x.value?cx=50:"right"===x.value?cx=100:"top"===x.value?cy=0:"bottom"===x.value&&(cy=100)),"position-keyword"===(null==y?void 0:y.type)&&("left"===y.value?cx=0:"center"===y.value?cy=50:"right"===y.value?cx=100:"top"===y.value?cy=0:"bottom"===y.value&&(cy=100)),"px"!==(null==x?void 0:x.type)&&"%"!==(null==x?void 0:x.type)&&"em"!==(null==x?void 0:x.type)||(unitX=null==x?void 0:x.type,cx=Number(x.value)),"px"!==(null==y?void 0:y.type)&&"%"!==(null==y?void 0:y.type)&&"em"!==(null==y?void 0:y.type)||(unitY=null==y?void 0:y.type,cy=Number(y.value))}return{cx:getOrCreateUnitValue(cx,unitX),cy:getOrCreateUnitValue(cy,unitY)}})),parseGradient=memoize((function(colorStr){var _a;if(colorStr.indexOf("linear")>-1||colorStr.indexOf("radial")>-1)return parseGradient$1(colorStr).map((function(_a){var type=_a.type,orientation=_a.orientation,colorStops=_a.colorStops;!function spaceColorStops(colorStops){var _a,_b,_c,length=colorStops.length;colorStops[length-1].length=null!==(_a=colorStops[length-1].length)&&void 0!==_a?_a:{type:"%",value:"100"},length>1&&(colorStops[0].length=null!==(_b=colorStops[0].length)&&void 0!==_b?_b:{type:"%",value:"0"});for(var previousIndex=0,previousOffset=Number(colorStops[0].length.value),i=1;i<length;i++){var offset=null===(_c=colorStops[i].length)||void 0===_c?void 0:_c.value;if(!(0,is_nil.A)(offset)&&!(0,is_nil.A)(previousOffset)){for(var j=1;j<i-previousIndex;j++)colorStops[previousIndex+j].length={type:"%",value:"".concat(previousOffset+(Number(offset)-previousOffset)*j/(i-previousIndex))};previousIndex=i,previousOffset=Number(offset)}}}(colorStops);var steps=colorStops.map((function(colorStop){return{offset:getOrCreateUnitValue(Number(colorStop.length.value),"%"),color:colorStopToString(colorStop)}}));if("linear-gradient"===type)return new CSSGradientValue(GradientType.LinearGradient,{angle:orientation?angleToDeg(orientation):Odeg,steps});if("radial-gradient"===type&&(orientation||(orientation=[{type:"shape",value:"circle"}]),"shape"===orientation[0].type&&"circle"===orientation[0].value)){var _b=positonToCSSUnitValue(orientation[0].at),cx=_b.cx,cy=_b.cy,size=void 0;if(orientation[0].style){var _c=orientation[0].style,type_1=_c.type,value=_c.value;size="extent-keyword"===type_1?getOrCreateKeyword(value):getOrCreateUnitValue(value,type_1)}return new CSSGradientValue(GradientType.RadialGradient,{cx,cy,size,steps})}}));var type=colorStr[0];if("("===colorStr[1]||"("===colorStr[2])if("l"===type){var arr=regexLG.exec(colorStr);if(arr){var steps=(null===(_a=arr[2].match(regexColorStop))||void 0===_a?void 0:_a.map((function(stop){return stop.split(":")})))||[];return[new CSSGradientValue(GradientType.LinearGradient,{angle:getOrCreateUnitValue(parseFloat(arr[1]),"deg"),steps:steps.map((function(_a){var _b=(0,tslib_es6.zs)(_a,2),offset=_b[0],color=_b[1];return{offset:getOrCreateUnitValue(100*Number(offset),"%"),color}}))})]}}else if("r"===type){var parsedRadialGradient=function parseRadialGradient(gradientStr){var _a,arr=regexRG.exec(gradientStr);if(arr){var steps=(null===(_a=arr[4].match(regexColorStop))||void 0===_a?void 0:_a.map((function(stop){return stop.split(":")})))||[];return{cx:getOrCreateUnitValue(50,"%"),cy:getOrCreateUnitValue(50,"%"),steps:steps.map((function(_a){var _b=(0,tslib_es6.zs)(_a,2),offset=_b[0],color=_b[1];return{offset:getOrCreateUnitValue(100*Number(offset),"%"),color}}))}}return null}(colorStr);if(parsedRadialGradient){if(!(0,is_string.A)(parsedRadialGradient))return[new CSSGradientValue(GradientType.RadialGradient,parsedRadialGradient)];colorStr=parsedRadialGradient}}else if("p"===type)return function parsePattern(patternStr){var arr=regexPR.exec(patternStr);if(arr){var repetition=arr[1],src=arr[2];switch(repetition){case"a":repetition="repeat";break;case"x":repetition="repeat-x";break;case"y":repetition="repeat-y";break;default:repetition="no-repeat"}return{image:src,repetition}}return null}(colorStr)}));function isPattern(object){return object&&!!object.image}function isCSSRGB(object){return object&&!(0,is_nil.A)(object.r)&&!(0,is_nil.A)(object.g)&&!(0,is_nil.A)(object.b)}var parseColor=memoize((function(colorStr){if(isPattern(colorStr))return(0,tslib_es6.Cl)({repetition:"repeat"},colorStr);if((0,is_nil.A)(colorStr)&&(colorStr=""),"transparent"===colorStr)return transparentColor;"currentColor"===colorStr&&(colorStr="black");var g=parseGradient(colorStr);if(g)return g;var color=color_color(colorStr),rgba=[0,0,0,0];return null!==color&&(rgba[0]=color.r||0,rgba[1]=color.g||0,rgba[2]=color.b||0,rgba[3]=color.opacity),getOrCreateRGBA.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(rgba),!1))}));function mergeColors(left,right){if(isCSSRGB(left)&&isCSSRGB(right))return[[Number(left.r),Number(left.g),Number(left.b),Number(left.alpha)],[Number(right.r),Number(right.g),Number(right.b),Number(right.alpha)],function(color){var rgba=color.slice();if(rgba[3])for(var i=0;i<3;i++)rgba[i]=Math.round(lodash_clamp(rgba[i],0,255));return rgba[3]=lodash_clamp(rgba[3],0,1),"rgba(".concat(rgba.join(","),")")}]}function parseDimension(unitRegExp,string){if((0,is_nil.A)(string))return getOrCreateUnitValue(0,"px");if(string="".concat(string).trim().toLowerCase(),isFinite(Number(string))){if("px".search(unitRegExp)>=0)return getOrCreateUnitValue(Number(string),"px");if("deg".search(unitRegExp)>=0)return getOrCreateUnitValue(Number(string),"deg")}var matchedUnits=[];string=string.replace(unitRegExp,(function(match){return matchedUnits.push(match),"U"+match}));var taggedUnitRegExp="U("+unitRegExp.source+")";return matchedUnits.map((function(unit){return getOrCreateUnitValue(Number(string.replace(new RegExp("U"+unit,"g"),"").replace(new RegExp(taggedUnitRegExp,"g"),"*0")),unit)}))[0]}var parseLengthUnmemoize=function(css){return parseDimension(new RegExp("px","g"),css)},parseLength=memoize(parseLengthUnmemoize);memoize((function(css){return parseDimension(new RegExp("%","g"),css)}));var parseLengthOrPercentageUnmemoize=function(css){return(0,is_number.A)(css)||isFinite(Number(css))?getOrCreateUnitValue(Number(css)||0,"px"):parseDimension(new RegExp("px|%|em|rem","g"),css)},parseLengthOrPercentage=memoize(parseLengthOrPercentageUnmemoize),parseAngleUnmemoize=function(css){return parseDimension(new RegExp("deg|rad|grad|turn","g"),css)},parseAngle=memoize(parseAngleUnmemoize);function mergeDimensions(left,right,target,nonNegative,index){void 0===index&&(index=0);var unit="",leftValue=left.value||0,rightValue=right.value||0,canonicalUnit=toCanonicalUnit(left.unit),leftCanonicalUnitValue=left.convertTo(canonicalUnit),rightCanonicalUnitValue=right.convertTo(canonicalUnit);return leftCanonicalUnitValue&&rightCanonicalUnitValue?(leftValue=leftCanonicalUnitValue.value,rightValue=rightCanonicalUnitValue.value,unit=unitTypeToString(left.unit)):(CSSUnitValue.isLength(left.unit)||CSSUnitValue.isLength(right.unit))&&(leftValue=convertPercentUnit(left,index,target),rightValue=convertPercentUnit(right,index,target),unit="px"),[leftValue,rightValue,function(value){return nonNegative&&(value=Math.max(value,0)),value+unit}]}function convertAngleUnit(value){var deg=0;return value.unit===UnitType.kDegrees?deg=value.value:value.unit===UnitType.kRadians?deg=rad2deg(Number(value.value)):value.unit===UnitType.kTurns&&(deg=function turn2deg(turn){return 360*turn}(Number(value.value))),deg}function parseDimensionArrayFormat(string,size){var parsed;return Array.isArray(string)?parsed=string.map((function(segment){return Number(segment)})):(0,is_string.A)(string)?parsed=string.split(" ").map((function(segment){return Number(segment)})):(0,is_number.A)(string)&&(parsed=[string]),2===size?1===parsed.length?[parsed[0],parsed[0]]:[parsed[0],parsed[1]]:1===parsed.length?[parsed[0],parsed[0],parsed[0],parsed[0]]:2===parsed.length?[parsed[0],parsed[1],parsed[0],parsed[1]]:3===parsed.length?[parsed[0],parsed[1],parsed[2],parsed[1]]:[parsed[0],parsed[1],parsed[2],parsed[3]]}function parseDimensionArray(string){return(0,is_string.A)(string)?string.split(" ").map((function(segment){return parseLengthOrPercentage(segment)})):string.map((function(segment){return parseLengthOrPercentage(segment.toString())}))}function convertPercentUnit(valueWithUnit,vec3Index,target){if(0===valueWithUnit.value)return 0;if(valueWithUnit.unit===UnitType.kPixels)return Number(valueWithUnit.value);if(valueWithUnit.unit===UnitType.kPercentage&&target){var bounds=target.nodeName===Shape.GROUP?target.getLocalBounds():target.geometry.contentBounds;return valueWithUnit.value/100*bounds.halfExtents[vec3Index]*2}return 0}var supportedFilters=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function parseFilter(filterStr){if(void 0===filterStr&&(filterStr=""),"none"===(filterStr=filterStr.toLowerCase().trim()))return[];for(var match,filterRegExp=/\s*([\w-]+)\(([^)]*)\)/g,result=[],prevLastIndex=0;match=filterRegExp.exec(filterStr);){if(match.index!==prevLastIndex)return[];if(prevLastIndex=match.index+match[0].length,supportedFilters.indexOf(match[1])>-1&&result.push({name:match[1],params:match[2].split(" ").map((function(p){return parseDimension(/deg|rad|grad|turn|px|%/g,p)||parseColor(p)}))}),filterRegExp.lastIndex===filterStr.length)return result}return[]}function numberToString(x){return x.toString()}var parseNumberUnmemoize=function(string){return"number"==typeof string?getOrCreateUnitValue(string):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(string)?getOrCreateUnitValue(Number(string)):getOrCreateUnitValue(0)},parseNumber=memoize(parseNumberUnmemoize);function mergeNumbers(left,right){return[left,right,numberToString]}function clampedMergeNumbers(min,max){return function(left,right){return[left,right,function(x){return numberToString(lodash_clamp(x,min,max))}]}}function mergeNumberLists(left,right){if(left.length===right.length)return[left,right,function(numberList){return numberList}]}function getOrCalculatePathTotalLength(path){return 0===path.parsedStyle.path.totalLength&&(path.parsedStyle.path.totalLength=function getTotalLength(pathInput,options){return pathLengthFactory(pathInput,void 0,(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},options),{bbox:!1,length:!0})).length}(path.parsedStyle.path.absolutePath)),path.parsedStyle.path.totalLength}function isSamePoint(point1,point2){return point1[0]===point2[0]&&point1[1]===point2[1]}function getExtraFromSegmentWithAngle(segment,lineWidth){var prePoint=segment.prePoint,currentPoint=segment.currentPoint,nextPoint=segment.nextPoint,currentAndPre=Math.pow(currentPoint[0]-prePoint[0],2)+Math.pow(currentPoint[1]-prePoint[1],2),currentAndNext=Math.pow(currentPoint[0]-nextPoint[0],2)+Math.pow(currentPoint[1]-nextPoint[1],2),preAndNext=Math.pow(prePoint[0]-nextPoint[0],2)+Math.pow(prePoint[1]-nextPoint[1],2),currentAngle=Math.acos((currentAndPre+currentAndNext-preAndNext)/(2*Math.sqrt(currentAndPre)*Math.sqrt(currentAndNext)));if(!currentAngle||0===Math.sin(currentAngle)||isNumberEqual(currentAngle,0))return{xExtra:0,yExtra:0};var xAngle=Math.abs(Math.atan2(nextPoint[1]-currentPoint[1],nextPoint[0]-currentPoint[0])),yAngle=Math.abs(Math.atan2(nextPoint[0]-currentPoint[0],nextPoint[1]-currentPoint[1]));return xAngle=xAngle>Math.PI/2?Math.PI-xAngle:xAngle,yAngle=yAngle>Math.PI/2?Math.PI-yAngle:yAngle,{xExtra:Math.cos(currentAngle/2-xAngle)*(lineWidth/2*(1/Math.sin(currentAngle/2)))-lineWidth/2||0,yExtra:Math.cos(yAngle-currentAngle/2)*(lineWidth/2*(1/Math.sin(currentAngle/2)))-lineWidth/2||0}}function toSymmetry(point,center){return[center[0]+(center[0]-point[0]),center[1]+(center[1]-point[1])]}memoize((function(string){return(0,is_string.A)(string)?string.split(" ").map(parseNumber):string.map(parseNumber)}));var index_esm_angleBetween=function(v0,v1){var p=v0.x*v1.x+v0.y*v1.y,n=Math.sqrt((Math.pow(v0.x,2)+Math.pow(v0.y,2))*(Math.pow(v1.x,2)+Math.pow(v1.y,2)));return(v0.x*v1.y-v0.y*v1.x<0?-1:1)*Math.acos(p/n)},pointOnEllipticalArc=function(p0,rx,ry,xAxisRotation,largeArcFlag,sweepFlag,p1,t){rx=Math.abs(rx),ry=Math.abs(ry);var xAxisRotationRadians=deg2rad(xAxisRotation=lodash_mod(xAxisRotation,360));if(p0.x===p1.x&&p0.y===p1.y)return{x:p0.x,y:p0.y,ellipticalArcAngle:0};if(0===rx||0===ry)return{x:0,y:0,ellipticalArcAngle:0};var dx=(p0.x-p1.x)/2,dy=(p0.y-p1.y)/2,transformedPoint={x:Math.cos(xAxisRotationRadians)*dx+Math.sin(xAxisRotationRadians)*dy,y:-Math.sin(xAxisRotationRadians)*dx+Math.cos(xAxisRotationRadians)*dy},radiiCheck=Math.pow(transformedPoint.x,2)/Math.pow(rx,2)+Math.pow(transformedPoint.y,2)/Math.pow(ry,2);radiiCheck>1&&(rx=Math.sqrt(radiiCheck)*rx,ry=Math.sqrt(radiiCheck)*ry);var cRadicand=(Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(transformedPoint.y,2)-Math.pow(ry,2)*Math.pow(transformedPoint.x,2))/(Math.pow(rx,2)*Math.pow(transformedPoint.y,2)+Math.pow(ry,2)*Math.pow(transformedPoint.x,2));cRadicand=cRadicand<0?0:cRadicand;var cCoef=(largeArcFlag!==sweepFlag?1:-1)*Math.sqrt(cRadicand),transformedCenter_x=cCoef*(rx*transformedPoint.y/ry),transformedCenter_y=cCoef*(-ry*transformedPoint.x/rx),center={x:Math.cos(xAxisRotationRadians)*transformedCenter_x-Math.sin(xAxisRotationRadians)*transformedCenter_y+(p0.x+p1.x)/2,y:Math.sin(xAxisRotationRadians)*transformedCenter_x+Math.cos(xAxisRotationRadians)*transformedCenter_y+(p0.y+p1.y)/2},startVector={x:(transformedPoint.x-transformedCenter_x)/rx,y:(transformedPoint.y-transformedCenter_y)/ry},startAngle=index_esm_angleBetween({x:1,y:0},startVector),sweepAngle=index_esm_angleBetween(startVector,{x:(-transformedPoint.x-transformedCenter_x)/rx,y:(-transformedPoint.y-transformedCenter_y)/ry});!sweepFlag&&sweepAngle>0?sweepAngle-=2*Math.PI:sweepFlag&&sweepAngle<0&&(sweepAngle+=2*Math.PI);var angle=startAngle+(sweepAngle%=2*Math.PI)*t,ellipseComponentX=rx*Math.cos(angle),ellipseComponentY=ry*Math.sin(angle);return{x:Math.cos(xAxisRotationRadians)*ellipseComponentX-Math.sin(xAxisRotationRadians)*ellipseComponentY+center.x,y:Math.sin(xAxisRotationRadians)*ellipseComponentX+Math.cos(xAxisRotationRadians)*ellipseComponentY+center.y,ellipticalArcStartAngle:startAngle,ellipticalArcEndAngle:startAngle+sweepAngle,ellipticalArcAngle:angle,ellipticalArcCenter:center,resultantRx:rx,resultantRy:ry}};function getTangentAtRatio(segment,ratio,sign){void 0===sign&&(sign=!0);var _a=segment.arcParams,_b=_a.rx,rx=void 0===_b?0:_b,_c=_a.ry,ry=void 0===_c?0:_c,xRotation=_a.xRotation,arcFlag=_a.arcFlag,sweepFlag=_a.sweepFlag,p1=pointOnEllipticalArc({x:segment.prePoint[0],y:segment.prePoint[1]},rx,ry,xRotation,!!arcFlag,!!sweepFlag,{x:segment.currentPoint[0],y:segment.currentPoint[1]},ratio),p2=pointOnEllipticalArc({x:segment.prePoint[0],y:segment.prePoint[1]},rx,ry,xRotation,!!arcFlag,!!sweepFlag,{x:segment.currentPoint[0],y:segment.currentPoint[1]},sign?ratio+.005:ratio-.005),xDist=p2.x-p1.x,yDist=p2.y-p1.y,dist=Math.sqrt(xDist*xDist+yDist*yDist);return{x:-xDist/dist,y:-yDist/dist}}function vMag(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1])}function vRatio(u,v){return vMag(u)*vMag(v)?(u[0]*v[0]+u[1]*v[1])/(vMag(u)*vMag(v)):1}function vAngle(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(vRatio(u,v))}function getArcParams(startPoint,params){var rx=params[1],ry=params[2],xRotation=lodash_mod(deg2rad(params[3]),2*Math.PI),arcFlag=params[4],sweepFlag=params[5],x1=startPoint[0],y1=startPoint[1],x2=params[6],y2=params[7],xp=Math.cos(xRotation)*(x1-x2)/2+Math.sin(xRotation)*(y1-y2)/2,yp=-1*Math.sin(xRotation)*(x1-x2)/2+Math.cos(xRotation)*(y1-y2)/2,lambda=xp*xp/(rx*rx)+yp*yp/(ry*ry);lambda>1&&(rx*=Math.sqrt(lambda),ry*=Math.sqrt(lambda));var diff=rx*rx*(yp*yp)+ry*ry*(xp*xp),f=diff?Math.sqrt((rx*rx*(ry*ry)-diff)/diff):1;arcFlag===sweepFlag&&(f*=-1),isNaN(f)&&(f=0);var cxp=ry?f*rx*yp/ry:0,cyp=rx?f*-ry*xp/rx:0,cx=(x1+x2)/2+Math.cos(xRotation)*cxp-Math.sin(xRotation)*cyp,cy=(y1+y2)/2+Math.sin(xRotation)*cxp+Math.cos(xRotation)*cyp,u=[(xp-cxp)/rx,(yp-cyp)/ry],v=[(-1*xp-cxp)/rx,(-1*yp-cyp)/ry],theta=vAngle([1,0],u),dTheta=vAngle(u,v);return vRatio(u,v)<=-1&&(dTheta=Math.PI),vRatio(u,v)>=1&&(dTheta=0),0===sweepFlag&&dTheta>0&&(dTheta-=2*Math.PI),1===sweepFlag&&dTheta<0&&(dTheta+=2*Math.PI),{cx,cy,rx:isSamePoint(startPoint,[x2,y2])?0:rx,ry:isSamePoint(startPoint,[x2,y2])?0:ry,startAngle:theta,endAngle:theta+dTheta,xRotation,arcFlag,sweepFlag}}function ellipseToCommands(rx,ry,cx,cy){var factor=(-1+Math.sqrt(2))/3*4,dx=rx*factor,dy=ry*factor,left=cx-rx,right=cx+rx,top=cy-ry,bottom=cy+ry;return[["M",left,cy],["C",left,cy-dy,cx-dx,top,cx,top],["C",cx+dx,top,right,cy-dy,right,cy],["C",right,cy+dy,cx+dx,bottom,cx,bottom],["C",cx-dx,bottom,left,cy+dy,left,cy],["Z"]]}function convertToPath(object,transform){void 0===transform&&(transform=object.getLocalTransform());var commands=[];switch(object.nodeName){case Shape.LINE:var _a=object.parsedStyle,_b=_a.x1,x1=void 0===_b?0:_b,_c=_a.y1,y1=void 0===_c?0:_c,_d=_a.x2,x2=void 0===_d?0:_d,_e=_a.y2;commands=function lineToCommands(x1,y1,x2,y2){return[["M",x1,y1],["L",x2,y2]]}(x1,y1,x2,void 0===_e?0:_e);break;case Shape.CIRCLE:var _f=object.parsedStyle,_g=_f.r,r=void 0===_g?0:_g,_h=_f.cx,cx=void 0===_h?0:_h,_j=_f.cy;commands=ellipseToCommands(r,r,cx,void 0===_j?0:_j);break;case Shape.ELLIPSE:var _k=object.parsedStyle,_l=_k.rx,rx=void 0===_l?0:_l,_m=_k.ry,ry=void 0===_m?0:_m,_o=_k.cx,_p=(cx=void 0===_o?0:_o,_k.cy);commands=ellipseToCommands(rx,ry,cx,void 0===_p?0:_p);break;case Shape.POLYLINE:case Shape.POLYGON:commands=function polygonToCommands(points,closed){var result=points.map((function(point,i){return[0===i?"M":"L",point[0],point[1]]}));return closed&&result.push(["Z"]),result}(object.parsedStyle.points.points,object.nodeName===Shape.POLYGON);break;case Shape.RECT:var _q=object.parsedStyle,_r=_q.width,width_1=void 0===_r?0:_r,_s=_q.height,height_1=void 0===_s?0:_s,_t=_q.x,x=void 0===_t?0:_t,_u=_q.y,y=void 0===_u?0:_u,radius=_q.radius,hasRadius=radius&&radius.some((function(r){return 0!==r}));commands=function rectToCommands(width,height,x,y,radius){if(radius){var _a=(0,tslib_es6.zs)(radius,4),tlr=_a[0],trr=_a[1],brr=_a[2],blr=_a[3],signX=width>0?1:-1,signY=height>0?1:-1,sweepFlag=signX+signY!==0?1:0;return[["M",signX*tlr+x,y],["L",width-signX*trr+x,y],trr?["A",trr,trr,0,0,sweepFlag,width+x,signY*trr+y]:null,["L",width+x,height-signY*brr+y],brr?["A",brr,brr,0,0,sweepFlag,width+x-signX*brr,height+y]:null,["L",x+signX*blr,height+y],blr?["A",blr,blr,0,0,sweepFlag,x,height+y-signY*blr]:null,["L",x,signY*tlr+y],tlr?["A",tlr,tlr,0,0,sweepFlag,signX*tlr+x,y]:null,["Z"]].filter((function(command){return command}))}return[["M",x,y],["L",x+width,y],["L",x+width,y+height],["L",x,y+height],["Z"]]}(width_1,height_1,x,y,hasRadius&&radius.map((function(r){return lodash_clamp(r,0,Math.min(Math.abs(width_1)/2,Math.abs(height_1)/2))})));break;case Shape.PATH:var absolutePath=object.parsedStyle.path.absolutePath;commands=(0,tslib_es6.fX)([],(0,tslib_es6.zs)(absolutePath),!1)}if(commands.length)return function commandsToPathString(commands,object,transform){var _a=object.parsedStyle,_b=_a.defX,defX=void 0===_b?0:_b,_c=_a.defY,defY=void 0===_c?0:_c;return commands.reduce((function(prev,cur){var path="";if("M"===cur[0]||"L"===cur[0]){var p=fromValues(cur[1]-defX,cur[2]-defY,0);transform&&transformMat4(p,p,transform),path="".concat(cur[0]).concat(p[0],",").concat(p[1])}else if("Z"===cur[0])path=cur[0];else if("C"===cur[0]){var p1=fromValues(cur[1]-defX,cur[2]-defY,0),p2=fromValues(cur[3]-defX,cur[4]-defY,0),p3=fromValues(cur[5]-defX,cur[6]-defY,0);transform&&(transformMat4(p1,p1,transform),transformMat4(p2,p2,transform),transformMat4(p3,p3,transform)),path="".concat(cur[0]).concat(p1[0],",").concat(p1[1],",").concat(p2[0],",").concat(p2[1],",").concat(p3[0],",").concat(p3[1])}else if("A"===cur[0]){var c=fromValues(cur[6]-defX,cur[7]-defY,0);transform&&transformMat4(c,c,transform),path="".concat(cur[0]).concat(cur[1],",").concat(cur[2],",").concat(cur[3],",").concat(cur[4],",").concat(cur[5],",").concat(c[0],",").concat(c[1])}else"Q"===cur[0]&&(p1=fromValues(cur[1]-defX,cur[2]-defY,0),p2=fromValues(cur[3]-defX,cur[4]-defY,0),transform&&(transformMat4(p1,p1,transform),transformMat4(p2,p2,transform)),path="".concat(cur[0]).concat(cur[1],",").concat(cur[2],",").concat(cur[3],",").concat(cur[4],"}"));return prev+path}),"")}(commands,object,transform)}var internalParsePath=function(path){if(""===path||Array.isArray(path)&&0===path.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var absolutePath;try{absolutePath=normalizePath(path)}catch(e){absolutePath=normalizePath(""),console.error("[g]: Invalid SVG Path definition: ".concat(path))}!function removeRedundantMCommand(path){for(var i=0;i<path.length;i++){var prevSegment=path[i-1],segment=path[i];if("M"===segment[0]&&prevSegment){var prevCmd=prevSegment[0],srcPoint=[segment[1],segment[2]],destPoint=void 0;"L"===prevCmd||"M"===prevCmd?destPoint=[prevSegment[1],prevSegment[2]]:"C"!==prevCmd&&"A"!==prevCmd&&"Q"!==prevCmd||(destPoint=[prevSegment[prevSegment.length-2],prevSegment[prevSegment.length-1]]),destPoint&&isSamePoint(srcPoint,destPoint)&&(path.splice(i,1),i--)}}}(absolutePath);var hasArc=function hasArcOrBezier(path){for(var hasArc=!1,count=path.length,i=0;i<count;i++){var cmd=path[i][0];if("C"===cmd||"A"===cmd||"Q"===cmd){hasArc=!0;break}}return hasArc}(absolutePath),_a=function extractPolygons(pathArray){for(var polygons=[],polylines=[],points=[],i=0;i<pathArray.length;i++){var params=pathArray[i],cmd=params[0];"M"===cmd?(points.length&&(polylines.push(points),points=[]),points.push([params[1],params[2]])):"Z"===cmd?points.length&&(polygons.push(points),points=[]):points.push([params[1],params[2]])}return points.length>0&&polylines.push(points),{polygons,polylines}}(absolutePath),polygons=_a.polygons,polylines=_a.polylines,segments=function path2Segments(path){for(var segments=[],currentPoint=null,nextParams=null,startMovePoint=null,lastStartMovePointIndex=0,count=path.length,i=0;i<count;i++){var params=path[i];nextParams=path[i+1];var command=params[0],segment={command,prePoint:currentPoint,params,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(command){case"M":startMovePoint=[params[1],params[2]],lastStartMovePointIndex=i;break;case"A":var arcParams=getArcParams(currentPoint,params);segment.arcParams=arcParams}if("Z"===command)currentPoint=startMovePoint,nextParams=path[lastStartMovePointIndex+1];else{var len=params.length;currentPoint=[params[len-2],params[len-1]]}nextParams&&"Z"===nextParams[0]&&(nextParams=path[lastStartMovePointIndex],segments[lastStartMovePointIndex]&&(segments[lastStartMovePointIndex].prePoint=currentPoint)),segment.currentPoint=currentPoint,segments[lastStartMovePointIndex]&&isSamePoint(currentPoint,segments[lastStartMovePointIndex].currentPoint)&&(segments[lastStartMovePointIndex].prePoint=segment.prePoint);var nextPoint=nextParams?[nextParams[nextParams.length-2],nextParams[nextParams.length-1]]:null;segment.nextPoint=nextPoint;var prePoint=segment.prePoint;if(["L","H","V"].includes(command))segment.startTangent=[prePoint[0]-currentPoint[0],prePoint[1]-currentPoint[1]],segment.endTangent=[currentPoint[0]-prePoint[0],currentPoint[1]-prePoint[1]];else if("Q"===command){var cp=[params[1],params[2]];segment.startTangent=[prePoint[0]-cp[0],prePoint[1]-cp[1]],segment.endTangent=[currentPoint[0]-cp[0],currentPoint[1]-cp[1]]}else if("T"===command)cp=toSymmetry((preSegment=segments[i-1]).currentPoint,prePoint),"Q"===preSegment.command?(segment.command="Q",segment.startTangent=[prePoint[0]-cp[0],prePoint[1]-cp[1]],segment.endTangent=[currentPoint[0]-cp[0],currentPoint[1]-cp[1]]):(segment.command="TL",segment.startTangent=[prePoint[0]-currentPoint[0],prePoint[1]-currentPoint[1]],segment.endTangent=[currentPoint[0]-prePoint[0],currentPoint[1]-prePoint[1]]);else if("C"===command){var cp1=[params[1],params[2]],cp2=[params[3],params[4]];segment.startTangent=[prePoint[0]-cp1[0],prePoint[1]-cp1[1]],segment.endTangent=[currentPoint[0]-cp2[0],currentPoint[1]-cp2[1]],0===segment.startTangent[0]&&0===segment.startTangent[1]&&(segment.startTangent=[cp1[0]-cp2[0],cp1[1]-cp2[1]]),0===segment.endTangent[0]&&0===segment.endTangent[1]&&(segment.endTangent=[cp2[0]-cp1[0],cp2[1]-cp1[1]])}else if("S"===command){var preSegment;cp1=toSymmetry((preSegment=segments[i-1]).currentPoint,prePoint),cp2=[params[1],params[2]],"C"===preSegment.command?(segment.command="C",segment.startTangent=[prePoint[0]-cp1[0],prePoint[1]-cp1[1]],segment.endTangent=[currentPoint[0]-cp2[0],currentPoint[1]-cp2[1]]):(segment.command="SQ",segment.startTangent=[prePoint[0]-cp2[0],prePoint[1]-cp2[1]],segment.endTangent=[currentPoint[0]-cp2[0],currentPoint[1]-cp2[1]])}else if("A"===command){var _a=getTangentAtRatio(segment,0),dx1=_a.x,dy1=_a.y,_b=getTangentAtRatio(segment,1,!1),dx2=_b.x,dy2=_b.y;segment.startTangent=[dx1,dy1],segment.endTangent=[dx2,dy2]}segments.push(segment)}return segments}(absolutePath),_b=function getPathBBox(segments,lineWidth){for(var xArr=[],yArr=[],segmentsWithAngle=[],i=0;i<segments.length;i++){var currentPoint=(segment=segments[i]).currentPoint,params=segment.params,prePoint=segment.prePoint,box=void 0;switch(segment.command){case"Q":box=index_esm_box(prePoint[0],prePoint[1],params[1],params[2],params[3],params[4]);break;case"C":box=box$3(prePoint[0],prePoint[1],params[1],params[2],params[3],params[4],params[5],params[6]);break;case"A":var arcParams=segment.arcParams;box=box$5(arcParams.cx,arcParams.cy,arcParams.rx,arcParams.ry,arcParams.xRotation,arcParams.startAngle,arcParams.endAngle);break;default:xArr.push(currentPoint[0]),yArr.push(currentPoint[1])}box&&(segment.box=box,xArr.push(box.x,box.x+box.width),yArr.push(box.y,box.y+box.height)),lineWidth&&("L"===segment.command||"M"===segment.command)&&segment.prePoint&&segment.nextPoint&&segmentsWithAngle.push(segment)}xArr=xArr.filter((function(item){return!Number.isNaN(item)&&item!==1/0&&item!==-1/0})),yArr=yArr.filter((function(item){return!Number.isNaN(item)&&item!==1/0&&item!==-1/0}));var minX=lodash_min(xArr),minY=lodash_min(yArr),maxX=lodash_max(xArr),maxY=lodash_max(yArr);if(0===segmentsWithAngle.length)return{x:minX,y:minY,width:maxX-minX,height:maxY-minY};for(i=0;i<segmentsWithAngle.length;i++){var segment;(currentPoint=(segment=segmentsWithAngle[i]).currentPoint)[0]===minX?minX-=getExtraFromSegmentWithAngle(segment,lineWidth).xExtra:currentPoint[0]===maxX&&(maxX+=getExtraFromSegmentWithAngle(segment,lineWidth).xExtra),currentPoint[1]===minY?minY-=getExtraFromSegmentWithAngle(segment,lineWidth).yExtra:currentPoint[1]===maxY&&(maxY+=getExtraFromSegmentWithAngle(segment,lineWidth).yExtra)}return{x:minX,y:minY,width:maxX-minX,height:maxY-minY}}(segments,0),x=_b.x,y=_b.y,width=_b.width,height=_b.height;return{absolutePath,hasArc,segments,polygons,polylines,totalLength:0,rect:{x:Number.isFinite(x)?x:0,y:Number.isFinite(y)?y:0,width:Number.isFinite(width)?width:0,height:Number.isFinite(height)?height:0}}},memoizedParsePath=memoize(internalParsePath);function parsePath(path){return(0,is_string.A)(path)?memoizedParsePath(path):internalParsePath(path)}function mergePaths(left,right,object){var curve1=left.curve,curve2=right.curve;curve1&&0!==curve1.length||(curve1=path2Curve(left.absolutePath,!1),left.curve=curve1),curve2&&0!==curve2.length||(curve2=path2Curve(right.absolutePath,!1),right.curve=curve2);var curves=[curve1,curve2];curve1.length!==curve2.length&&(curves=equalizeSegments(curve1,curve2));var a,b,segCount,lineLengths,sumLensSqrd,rotations,curve0=getDrawDirection(curves[0])!==getDrawDirection(curves[1])?function reverseCurve(pathArray){var rotatedCurve=pathArray.slice(1).map((function(x,i,curveOnly){return i?curveOnly[i-1].slice(-2).concat(x.slice(1)):pathArray[0].slice(1).concat(x.slice(1))})).map((function(x){return x.map((function(y,i){return x[x.length-i-2*(1-i%2)]}))})).reverse();return[["M"].concat(rotatedCurve[0].slice(0,2))].concat(rotatedCurve.map((function(x){return["C"].concat(x.slice(2))})))}(curves[0]):function clonePath(path){return path.map((function(x){return Array.isArray(x)?[].concat(x):x}))}(curves[0]);return[curve0,(a=curves[1],b=curve0,segCount=a.length-1,lineLengths=[],sumLensSqrd=0,rotations=function getRotations(a){var segCount=a.length,pointCount=segCount-1;return a.map((function(f,idx){return a.map((function(p,i){var seg,oldSegIdx=idx+i;return 0===i||a[oldSegIdx]&&"M"===a[oldSegIdx][0]?(seg=a[oldSegIdx],["M"].concat(seg.slice(-2))):(oldSegIdx>=segCount&&(oldSegIdx-=pointCount),a[oldSegIdx])}))}))}(a),rotations.forEach((function(r,i){a.slice(1).forEach((function(s,j){sumLensSqrd+=distanceSquareRoot(a[(i+j)%segCount].slice(-2),b[j%segCount].slice(-2))})),lineLengths[i]=sumLensSqrd,sumLensSqrd=0})),rotations[lineLengths.indexOf(Math.min.apply(null,lineLengths))]),function(pathArray){return pathArray}]}function parsePoints(pointsOrStr,object){var points;points=(0,is_string.A)(pointsOrStr)?pointsOrStr.split(" ").map((function(pointStr){var _a=(0,tslib_es6.zs)(pointStr.split(","),2),x=_a[0],y=_a[1];return[Number(x),Number(y)]})):pointsOrStr;var segmentT,segmentL,segments=[],tempLength=0,totalLength=function length$2(points){return lengthOfSegment(points)}(points);points.forEach((function(p,i){points[i+1]&&((segmentT=[0,0])[0]=tempLength/totalLength,segmentL=length$4(p[0],p[1],points[i+1][0],points[i+1][1]),tempLength+=segmentL,segmentT[1]=tempLength/totalLength,segments.push(segmentT))}));var minX=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[0]}))),!1)),minY=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[1]}))),!1));return object&&(object.parsedStyle.defX=minX,object.parsedStyle.defY=minY),{points,totalLength,segments}}function mergePoints(left,right){return[left.points,right.points,function(points){return points}]}var _=null;function cast(pattern){return function(contents){var i=0;return pattern.map((function(x){return x===_?contents[i++]:x}))}}function id(x){return x}var transformFunctions={matrix:["NNNNNN",[_,_,0,0,_,_,0,0,0,0,1,0,_,_,0,1],id],matrix3d:["NNNNNNNNNNNNNNNN",id],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",cast([_,_,new CSSUnitValue(1)]),id],scalex:["N",cast([_,new CSSUnitValue(1),new CSSUnitValue(1)]),cast([_,new CSSUnitValue(1)])],scaley:["N",cast([new CSSUnitValue(1),_,new CSSUnitValue(1)]),cast([new CSSUnitValue(1),_])],scalez:["N",cast([new CSSUnitValue(1),new CSSUnitValue(1),_])],scale3d:["NNN",id],skew:["Aa",null,id],skewx:["A",null,cast([_,Odeg])],skewy:["A",null,cast([Odeg,_])],translate:["Tt",cast([_,_,Opx]),id],translatex:["T",cast([_,Opx,Opx]),cast([_,Opx])],translatey:["T",cast([Opx,_,Opx]),cast([Opx,_])],translatez:["L",cast([Opx,Opx,_])],translate3d:["TTL",id]};function parseTransform(string){if("none"===(string=(string||"none").toLowerCase().trim()))return[];for(var match,transformRegExp=/\s*(\w+)\(([^)]*)\)/g,result=[],prevLastIndex=0;match=transformRegExp.exec(string);){if(match.index!==prevLastIndex)return[];prevLastIndex=match.index+match[0].length;var functionName=match[1],functionData=transformFunctions[functionName];if(!functionData)return[];var args=match[2].split(","),argTypes=functionData[0];if(argTypes.length<args.length)return[];for(var parsedArgs=[],i=0;i<argTypes.length;i++){var arg=args[i],type=argTypes[i],parsedArg=void 0;if(void 0===(parsedArg=arg?{A:function(s){return"0"===s.trim()?Odeg:parseAngle(s)},N:parseNumber,T:parseLengthOrPercentage,L:parseLength}[type.toUpperCase()](arg):{a:Odeg,n:parsedArgs[0],t:Opx}[type]))return[];parsedArgs.push(parsedArg)}if(result.push({t:functionName,d:parsedArgs}),transformRegExp.lastIndex===string.length)return result}return[]}function parseTransformUnmemoize(string){if("none"===(string=(string||"none").toLowerCase().trim()))return[];for(var match,transformRegExp=/\s*(\w+)\(([^)]*)\)/g,result=[],prevLastIndex=0;match=transformRegExp.exec(string);){if(match.index!==prevLastIndex)return[];prevLastIndex=match.index+match[0].length;var functionName=match[1],functionData=transformFunctions[functionName];if(!functionData)return[];var args=match[2].split(","),argTypes=functionData[0];if(argTypes.length<args.length)return[];for(var parsedArgs=[],i=0;i<argTypes.length;i++){var arg=args[i],type=argTypes[i],parsedArg=void 0;if(void 0===(parsedArg=arg?{A:function(s){return"0"===s.trim()?Odeg:parseAngleUnmemoize(s)},N:parseNumberUnmemoize,T:parseLengthOrPercentageUnmemoize,L:parseLengthUnmemoize}[type.toUpperCase()](arg):{a:Odeg,n:parsedArgs[0],t:Opx}[type]))return[];parsedArgs.push(parsedArg)}if(result.push({t:functionName,d:parsedArgs}),transformRegExp.lastIndex===string.length)return result}return[]}function convertItemToMatrix(item){var x,y,z,angle;switch(item.t){case"rotatex":return angle=deg2rad(convertAngleUnit(item.d[0])),[1,0,0,0,0,Math.cos(angle),Math.sin(angle),0,0,-Math.sin(angle),Math.cos(angle),0,0,0,0,1];case"rotatey":return angle=deg2rad(convertAngleUnit(item.d[0])),[Math.cos(angle),0,-Math.sin(angle),0,0,1,0,0,Math.sin(angle),0,Math.cos(angle),0,0,0,0,1];case"rotate":case"rotatez":return angle=deg2rad(convertAngleUnit(item.d[0])),[Math.cos(angle),Math.sin(angle),0,0,-Math.sin(angle),Math.cos(angle),0,0,0,0,1,0,0,0,0,1];case"rotate3d":x=item.d[0].value,y=item.d[1].value,z=item.d[2].value,angle=deg2rad(convertAngleUnit(item.d[3]));var sqrLength=x*x+y*y+z*z;if(0===sqrLength)x=1,y=0,z=0;else if(1!==sqrLength){var length_1=Math.sqrt(sqrLength);x/=length_1,y/=length_1,z/=length_1}var s=Math.sin(angle/2),sc=s*Math.cos(angle/2),sq=s*s;return[1-2*(y*y+z*z)*sq,2*(x*y*sq+z*sc),2*(x*z*sq-y*sc),0,2*(x*y*sq-z*sc),1-2*(x*x+z*z)*sq,2*(y*z*sq+x*sc),0,2*(x*z*sq+y*sc),2*(y*z*sq-x*sc),1-2*(x*x+y*y)*sq,0,0,0,0,1];case"scale":return[item.d[0].value,0,0,0,0,item.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scalex":return[item.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,item.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,item.d[0].value,0,0,0,0,1];case"scale3d":return[item.d[0].value,0,0,0,0,item.d[1].value,0,0,0,0,item.d[2].value,0,0,0,0,1];case"skew":var xAngle=deg2rad(convertAngleUnit(item.d[0])),yAngle=deg2rad(convertAngleUnit(item.d[1]));return[1,Math.tan(yAngle),0,0,Math.tan(xAngle),1,0,0,0,0,1,0,0,0,0,1];case"skewx":return angle=deg2rad(convertAngleUnit(item.d[0])),[1,0,0,0,Math.tan(angle),1,0,0,0,0,1,0,0,0,0,1];case"skewy":return angle=deg2rad(convertAngleUnit(item.d[0])),[1,Math.tan(angle),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,x=convertPercentUnit(item.d[0],0,null)||0,y=convertPercentUnit(item.d[1],0,null)||0,0,1];case"translatex":return[1,0,0,0,0,1,0,0,0,0,1,0,x=convertPercentUnit(item.d[0],0,null)||0,0,0,1];case"translatey":return[1,0,0,0,0,1,0,0,0,0,1,0,0,y=convertPercentUnit(item.d[0],0,null)||0,0,1];case"translatez":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,z=convertPercentUnit(item.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,x=convertPercentUnit(item.d[0],0,null)||0,y=convertPercentUnit(item.d[1],0,null)||0,z=convertPercentUnit(item.d[2],0,null)||0,1];case"perspective":var t=convertPercentUnit(item.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,t?-1/t:0,0,0,0,1];case"matrix":return[item.d[0].value,item.d[1].value,0,0,item.d[2].value,item.d[3].value,0,0,0,0,1,0,item.d[4].value,item.d[5].value,0,1];case"matrix3d":return item.d.map((function(d){return d.value}))}}function multiplyMatrices(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12]*b[3],a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13]*b[3],a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14]*b[3],a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]*b[3],a[0]*b[4]+a[4]*b[5]+a[8]*b[6]+a[12]*b[7],a[1]*b[4]+a[5]*b[5]+a[9]*b[6]+a[13]*b[7],a[2]*b[4]+a[6]*b[5]+a[10]*b[6]+a[14]*b[7],a[3]*b[4]+a[7]*b[5]+a[11]*b[6]+a[15]*b[7],a[0]*b[8]+a[4]*b[9]+a[8]*b[10]+a[12]*b[11],a[1]*b[8]+a[5]*b[9]+a[9]*b[10]+a[13]*b[11],a[2]*b[8]+a[6]*b[9]+a[10]*b[10]+a[14]*b[11],a[3]*b[8]+a[7]*b[9]+a[11]*b[10]+a[15]*b[11],a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12]*b[15],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13]*b[15],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14]*b[15],a[3]*b[12]+a[7]*b[13]+a[11]*b[14]+a[15]*b[15]]}function makeMatrixDecomposition(transformList){var translate=[0,0,0],scale=[1,1,1],skew=[0,0,0],perspective=[0,0,0,1],quaternion=[0,0,0,1];return function decomposeMat4(matrix,translation,scale,skew,perspective,quaternion){if(!function index_esm_normalize(out,mat){var m44=mat[15];if(0===m44)return!1;for(var scale=1/m44,i=0;i<16;i++)out[i]=mat[i]*scale;return!0}(tmp,matrix))return!1;if(mat4_copy(perspectiveMatrix,tmp),perspectiveMatrix[3]=0,perspectiveMatrix[7]=0,perspectiveMatrix[11]=0,perspectiveMatrix[15]=1,Math.abs(determinant(perspectiveMatrix))<1e-8)return!1;var a03=tmp[3],a13=tmp[7],a23=tmp[11],a30=tmp[12],a31=tmp[13],a32=tmp[14],a33=tmp[15];if(0!==a03||0!==a13||0!==a23){if(tmpVec4[0]=a03,tmpVec4[1]=a13,tmpVec4[2]=a23,tmpVec4[3]=a33,!invert(perspectiveMatrix,perspectiveMatrix))return!1;transpose(perspectiveMatrix,perspectiveMatrix),vec4_transformMat4(perspective,tmpVec4,perspectiveMatrix)}else perspective[0]=perspective[1]=perspective[2]=0,perspective[3]=1;if(translation[0]=a30,translation[1]=a31,translation[2]=a32,function mat3from4(out,mat4x4){out[0][0]=mat4x4[0],out[0][1]=mat4x4[1],out[0][2]=mat4x4[2],out[1][0]=mat4x4[4],out[1][1]=mat4x4[5],out[1][2]=mat4x4[6],out[2][0]=mat4x4[8],out[2][1]=mat4x4[9],out[2][2]=mat4x4[10]}(row,tmp),scale[0]=vec3_length(row[0]),normalize(row[0],row[0]),skew[0]=vec3_dot(row[0],row[1]),combine(row[1],row[1],row[0],1,-skew[0]),scale[1]=vec3_length(row[1]),normalize(row[1],row[1]),skew[0]/=scale[1],skew[1]=vec3_dot(row[0],row[2]),combine(row[2],row[2],row[0],1,-skew[1]),skew[2]=vec3_dot(row[1],row[2]),combine(row[2],row[2],row[1],1,-skew[2]),scale[2]=vec3_length(row[2]),normalize(row[2],row[2]),skew[1]/=scale[2],skew[2]/=scale[2],cross(pdum3,row[1],row[2]),vec3_dot(row[0],pdum3)<0)for(var i=0;i<3;i++)scale[i]*=-1,row[i][0]*=-1,row[i][1]*=-1,row[i][2]*=-1;return quaternion[0]=.5*Math.sqrt(Math.max(1+row[0][0]-row[1][1]-row[2][2],0)),quaternion[1]=.5*Math.sqrt(Math.max(1-row[0][0]+row[1][1]-row[2][2],0)),quaternion[2]=.5*Math.sqrt(Math.max(1-row[0][0]-row[1][1]+row[2][2],0)),quaternion[3]=.5*Math.sqrt(Math.max(1+row[0][0]+row[1][1]+row[2][2],0)),row[2][1]>row[1][2]&&(quaternion[0]=-quaternion[0]),row[0][2]>row[2][0]&&(quaternion[1]=-quaternion[1]),row[1][0]>row[0][1]&&(quaternion[2]=-quaternion[2]),!0}(function convertToMatrix(transformList){return 0===transformList.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:transformList.map(convertItemToMatrix).reduce(multiplyMatrices)}(transformList),translate,scale,skew,perspective,quaternion),[[translate,scale,skew,quaternion,perspective]]}var composeMatrix=function(){function multiply(a,b){for(var result=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],i=0;i<4;i++)for(var j=0;j<4;j++)for(var k=0;k<4;k++)result[i][j]+=b[i][k]*a[k][j];return result}return function composeMatrix(translate,scale,skew,quat,perspective){for(var matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],i=0;i<4;i++)matrix[i][3]=perspective[i];for(i=0;i<3;i++)for(var j=0;j<3;j++)matrix[3][i]+=translate[j]*matrix[j][i];var x=quat[0],y=quat[1],z=quat[2],w=quat[3],rotMatrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];rotMatrix[0][0]=1-2*(y*y+z*z),rotMatrix[0][1]=2*(x*y-z*w),rotMatrix[0][2]=2*(x*z+y*w),rotMatrix[1][0]=2*(x*y+z*w),rotMatrix[1][1]=1-2*(x*x+z*z),rotMatrix[1][2]=2*(y*z-x*w),rotMatrix[2][0]=2*(x*z-y*w),rotMatrix[2][1]=2*(y*z+x*w),rotMatrix[2][2]=1-2*(x*x+y*y),matrix=multiply(matrix,rotMatrix);var temp=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(skew[2]&&(temp[2][1]=skew[2],matrix=multiply(matrix,temp)),skew[1]&&(temp[2][1]=0,temp[2][0]=skew[0],matrix=multiply(matrix,temp)),skew[0]&&(temp[2][0]=0,temp[1][0]=skew[0],matrix=multiply(matrix,temp)),i=0;i<3;i++)for(j=0;j<3;j++)matrix[i][j]*=scale[i];return function is2D(m){return 0==m[0][2]&&0==m[0][3]&&0==m[1][2]&&0==m[1][3]&&0==m[2][0]&&0==m[2][1]&&1==m[2][2]&&0==m[2][3]&&0==m[3][2]&&1==m[3][3]}(matrix)?[matrix[0][0],matrix[0][1],matrix[1][0],matrix[1][1],matrix[3][0],matrix[3][1]]:matrix[0].concat(matrix[1],matrix[2],matrix[3])}}();function numberToLongString(x){return x.toFixed(6).replace(".000000","")}function mergeMatrices(left,right){var leftArgs,rightArgs;return left.decompositionPair!==right&&(left.decompositionPair=right,leftArgs=makeMatrixDecomposition(left)),right.decompositionPair!==left&&(right.decompositionPair=left,rightArgs=makeMatrixDecomposition(right)),null===leftArgs[0]||null===rightArgs[0]?[[!1],[!0],function(x){return x?right[0].d:left[0].d}]:(leftArgs[0].push(0),rightArgs[0].push(1),[leftArgs,rightArgs,function(list){var q=function quat(fromQ,toQ,f){var product=function index_esm_dot(v1,v2){for(var result=0,i=0;i<v1.length;i++)result+=v1[i]*v2[i];return result}(fromQ,toQ);product=lodash_clamp(product,-1,1);var quat=[];if(1===product)quat=fromQ;else for(var theta=Math.acos(product),w=1*Math.sin(f*theta)/Math.sqrt(1-product*product),i=0;i<4;i++)quat.push(fromQ[i]*(Math.cos(f*theta)-product*w)+toQ[i]*w);return quat}(leftArgs[0][3],rightArgs[0][3],list[5]);return composeMatrix(list[0],list[1],list[2],q,list[4]).map(numberToLongString).join(",")}])}function typeTo2D(type){return type.replace(/[xy]/,"")}function typeTo3D(type){return type.replace(/(x|y|z|3d)?$/,"3d")}function mergeTransforms(left,right,target){var flipResults=!1;if(!left.length||!right.length){left.length||(flipResults=!0,left=right,right=[]);for(var _loop_1=function(i){var _a=left[i],type=_a.t,args=_a.d,defaultValue="scale"===type.substring(0,5)?1:0;right.push({t:type,d:args.map((function(arg){return"number"==typeof arg?getOrCreateUnitValue(defaultValue):getOrCreateUnitValue(defaultValue,arg.unit)}))})},i=0;i<left.length;i++)_loop_1(i)}var lt,rt,leftResult=[],rightResult=[],types=[];if(left.length!==right.length)leftResult=[(merged=mergeMatrices(left,right))[0]],rightResult=[merged[1]],types=[["matrix",[merged[2]]]];else for(i=0;i<left.length;i++){var leftType=left[i].t,rightType=right[i].t,leftArgs=left[i].d,rightArgs=right[i].d,leftFunctionData=transformFunctions[leftType],rightFunctionData=transformFunctions[rightType],type=void 0;if(rt=rightType,"perspective"===(lt=leftType)&&"perspective"===rt||!("matrix"!==lt&&"matrix3d"!==lt||"matrix"!==rt&&"matrix3d"!==rt)){var merged=mergeMatrices([left[i]],[right[i]]);leftResult.push(merged[0]),rightResult.push(merged[1]),types.push(["matrix",[merged[2]]])}else{if(leftType===rightType)type=leftType;else if(leftFunctionData[2]&&rightFunctionData[2]&&typeTo2D(leftType)===typeTo2D(rightType))type=typeTo2D(leftType),leftArgs=leftFunctionData[2](leftArgs),rightArgs=rightFunctionData[2](rightArgs);else{if(!leftFunctionData[1]||!rightFunctionData[1]||typeTo3D(leftType)!==typeTo3D(rightType)){leftResult=[(merged=mergeMatrices(left,right))[0]],rightResult=[merged[1]],types=[["matrix",[merged[2]]]];break}type=typeTo3D(leftType),leftArgs=leftFunctionData[1](leftArgs),rightArgs=rightFunctionData[1](rightArgs)}for(var leftArgsCopy=[],rightArgsCopy=[],stringConversions=[],j=0;j<leftArgs.length;j++){merged=mergeDimensions(leftArgs[j],rightArgs[j],target,!1,j);leftArgsCopy[j]=merged[0],rightArgsCopy[j]=merged[1],stringConversions.push(merged[2])}leftResult.push(leftArgsCopy),rightResult.push(rightArgsCopy),types.push([type,stringConversions])}}if(flipResults){var tmp=leftResult;leftResult=rightResult,rightResult=tmp}return[leftResult,rightResult,function(list){return list.map((function(args,i){var stringifiedArgs=args.map((function(arg,j){return types[i][1][j](arg)})).join(",");return"matrix"===types[i][0]&&16===stringifiedArgs.split(",").length&&(types[i][0]="matrix3d"),"matrix3d"===types[i][0]&&6===stringifiedArgs.split(",").length&&(types[i][0]="matrix"),types[i][0]+"("+stringifiedArgs+")"})).join(" ")}]}var parseTransformOrigin=memoize((function(value){if((0,is_string.A)(value)){if("text-anchor"===value)return[getOrCreateUnitValue(0,"px"),getOrCreateUnitValue(0,"px")];var values=value.split(" ");return 1===values.length&&("top"===values[0]||"bottom"===values[0]?(values[1]=values[0],values[0]="center"):values[1]="center"),2!==values.length?null:[parseLengthOrPercentage(convertKeyword2Percent(values[0])),parseLengthOrPercentage(convertKeyword2Percent(values[1]))]}return[getOrCreateUnitValue(value[0]||0,"px"),getOrCreateUnitValue(value[1]||0,"px")]})),parseTransformOriginUnmemoize=function(value){if((0,is_string.A)(value)){if("text-anchor"===value)return[getOrCreateUnitValue(0,"px"),getOrCreateUnitValue(0,"px")];var values=value.split(" ");return 1===values.length&&("top"===values[0]||"bottom"===values[0]?(values[1]=values[0],values[0]="center"):values[1]="center"),2!==values.length?null:[parseLengthOrPercentageUnmemoize(convertKeyword2Percent(values[0])),parseLengthOrPercentageUnmemoize(convertKeyword2Percent(values[1]))]}return[getOrCreateUnitValue(value[0]||0,"px"),getOrCreateUnitValue(value[1]||0,"px")]};function convertKeyword2Percent(keyword){return"center"===keyword?"50%":"left"===keyword||"top"===keyword?"0":"right"===keyword||"bottom"===keyword?"100%":keyword}var BUILT_IN_PROPERTIES=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:PropertySyntax.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:PropertySyntax.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:PropertySyntax.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:PropertySyntax.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:PropertySyntax.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:PropertySyntax.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:PropertySyntax.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:PropertySyntax.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:PropertySyntax.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:PropertySyntax.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:PropertySyntax.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:PropertySyntax.FILTER},{n:"clipPath",syntax:PropertySyntax.DEFINED_PATH},{n:"textPath",syntax:PropertySyntax.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:PropertySyntax.TRANSFORM},{n:"transformOrigin",p:100,d:function(nodeName){return nodeName===Shape.CIRCLE||nodeName===Shape.ELLIPSE?"center":nodeName===Shape.TEXT?"text-anchor":"left top"},l:!0,syntax:PropertySyntax.TRANSFORM_ORIGIN},{n:"anchor",p:99,d:function(nodeName){return nodeName===Shape.CIRCLE||nodeName===Shape.ELLIPSE?"0.5 0.5":"0 0"},l:!0,syntax:PropertySyntax.LENGTH_PERCENTAGE_12},{n:"cx",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"cy",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"cz",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"x",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"y",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"z",int:!0,d:"0",syntax:PropertySyntax.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:PropertySyntax.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"y1",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"z1",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"x2",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"y2",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"z2",int:!0,l:!0,syntax:PropertySyntax.COORDINATE},{n:"path",int:!0,l:!0,d:"",a:["d"],syntax:PropertySyntax.PATH,p:50},{n:"points",int:!0,l:!0,syntax:PropertySyntax.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:PropertySyntax.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:PropertySyntax.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:PropertySyntax.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:PropertySyntax.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:PropertySyntax.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:PropertySyntax.NUMBER,d:function(nodeName){return nodeName===Shape.PATH||nodeName===Shape.POLYGON||nodeName===Shape.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:PropertySyntax.MARKER},{n:"markerEnd",syntax:PropertySyntax.MARKER},{n:"markerMid",syntax:PropertySyntax.MARKER},{n:"markerStartOffset",syntax:PropertySyntax.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:PropertySyntax.LENGTH,l:!0,int:!0,d:"0"}],GEOMETRY_ATTRIBUTE_NAMES=BUILT_IN_PROPERTIES.filter((function(n){return!!n.l})).map((function(n){return n.n})),propertyMetadataCache={},unresolvedProperties=new WeakMap,DefaultStyleValueRegistry=function(){function DefaultStyleValueRegistry(runtime){var _this=this;this.runtime=runtime,BUILT_IN_PROPERTIES.forEach((function(property){_this.registerMetadata(property)}))}return DefaultStyleValueRegistry.prototype.registerMetadata=function(metadata){(0,tslib_es6.fX)([metadata.n],(0,tslib_es6.zs)(metadata.a||[]),!1).forEach((function(name){propertyMetadataCache[name]=metadata}))},DefaultStyleValueRegistry.prototype.unregisterMetadata=function(name){delete propertyMetadataCache[name]},DefaultStyleValueRegistry.prototype.getPropertySyntax=function(syntax){return this.runtime.CSSPropertySyntaxFactory[syntax]},DefaultStyleValueRegistry.prototype.processProperties=function(object,attributes,options){var _this=this;if(void 0===options&&(options={skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0}),!this.runtime.enableCSSParsing){Object.assign(object.attributes,attributes);var attributeNames_1=Object.keys(attributes),oldClipPath=object.parsedStyle.clipPath,oldOffsetPath=object.parsedStyle.offsetPath;object.parsedStyle=Object.assign(object.parsedStyle,attributes);var needUpdateGeometry_1=!!options.forceUpdateGeometry;if(!needUpdateGeometry_1)for(var i=0;i<GEOMETRY_ATTRIBUTE_NAMES.length;i++)if(GEOMETRY_ATTRIBUTE_NAMES[i]in attributes){needUpdateGeometry_1=!0;break}return attributes.fill&&(object.parsedStyle.fill=parseColor(attributes.fill)),attributes.stroke&&(object.parsedStyle.stroke=parseColor(attributes.stroke)),attributes.shadowColor&&(object.parsedStyle.shadowColor=parseColor(attributes.shadowColor)),attributes.filter&&(object.parsedStyle.filter=parseFilter(attributes.filter)),(0,is_nil.A)(attributes.radius)||(object.parsedStyle.radius=parseDimensionArrayFormat(attributes.radius,4)),(0,is_nil.A)(attributes.lineDash)||(object.parsedStyle.lineDash=parseDimensionArrayFormat(attributes.lineDash,2)),attributes.points&&(object.parsedStyle.points=parsePoints(attributes.points,object)),""===attributes.path&&(object.parsedStyle.path=(0,tslib_es6.Cl)({},EMPTY_PARSED_PATH)),attributes.path&&(object.parsedStyle.path=parsePath(attributes.path),object.parsedStyle.defX=object.parsedStyle.path.rect.x,object.parsedStyle.defY=object.parsedStyle.path.rect.y),attributes.textTransform&&this.runtime.CSSPropertySyntaxFactory["<text-transform>"].calculator(null,null,{value:attributes.textTransform},object,null),attributes.clipPath&&this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("clipPath",oldClipPath,attributes.clipPath,object,this.runtime),attributes.offsetPath&&this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("offsetPath",oldOffsetPath,attributes.offsetPath,object,this.runtime),attributes.anchor&&(object.parsedStyle.anchor=parseDimensionArrayFormat(attributes.anchor,2)),attributes.transform&&(object.parsedStyle.transform=parseTransform(attributes.transform)),attributes.transformOrigin&&(object.parsedStyle.transformOrigin=parseTransformOrigin(attributes.transformOrigin)),attributes.markerStart&&(object.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,attributes.markerStart,attributes.markerStart,null,null)),attributes.markerEnd&&(object.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,attributes.markerEnd,attributes.markerEnd,null,null)),attributes.markerMid&&(object.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator("",attributes.markerMid,attributes.markerMid,null,null)),(object.nodeName!==Shape.CIRCLE&&object.nodeName!==Shape.ELLIPSE||(0,is_nil.A)(attributes.cx)&&(0,is_nil.A)(attributes.cy))&&(object.nodeName!==Shape.RECT&&object.nodeName!==Shape.IMAGE&&object.nodeName!==Shape.GROUP&&object.nodeName!==Shape.HTML&&object.nodeName!==Shape.TEXT&&object.nodeName!==Shape.MESH||(0,is_nil.A)(attributes.x)&&(0,is_nil.A)(attributes.y)&&(0,is_nil.A)(attributes.z))&&(object.nodeName!==Shape.LINE||(0,is_nil.A)(attributes.x1)&&(0,is_nil.A)(attributes.y1)&&(0,is_nil.A)(attributes.z1)&&(0,is_nil.A)(attributes.x2)&&(0,is_nil.A)(attributes.y2)&&(0,is_nil.A)(attributes.z2))||this.runtime.CSSPropertySyntaxFactory["<coordinate>"].postProcessor(object,attributeNames_1),(0,is_nil.A)(attributes.zIndex)||this.runtime.CSSPropertySyntaxFactory["<z-index>"].postProcessor(object,attributeNames_1),attributes.path&&this.runtime.CSSPropertySyntaxFactory["<path>"].postProcessor(object,attributeNames_1),attributes.points&&this.runtime.CSSPropertySyntaxFactory["<list-of-points>"].postProcessor(object,attributeNames_1),(0,is_nil.A)(attributes.offsetDistance)||this.runtime.CSSPropertySyntaxFactory["<offset-distance>"].postProcessor(object,attributeNames_1),attributes.transform&&this.runtime.CSSPropertySyntaxFactory["<transform>"].postProcessor(object,attributeNames_1),void(needUpdateGeometry_1&&this.updateGeometry(object))}var skipUpdateAttribute=options.skipUpdateAttribute,skipParse=options.skipParse,forceUpdateGeometry=options.forceUpdateGeometry,usedAttributes=options.usedAttributes,memoize=options.memoize,needUpdateGeometry=forceUpdateGeometry,attributeNames=Object.keys(attributes);attributeNames.forEach((function(attributeName){var _a;skipUpdateAttribute||(object.attributes[attributeName]=attributes[attributeName]),!needUpdateGeometry&&(null===(_a=propertyMetadataCache[attributeName])||void 0===_a?void 0:_a.l)&&(needUpdateGeometry=!0)})),skipParse||attributeNames.forEach((function(name){object.computedStyle[name]=_this.parseProperty(name,object.attributes[name],object,memoize)})),(null==usedAttributes?void 0:usedAttributes.length)&&(attributeNames=Array.from(new Set(attributeNames.concat(usedAttributes)))),attributeNames.forEach((function(name){name in object.computedStyle&&(object.parsedStyle[name]=_this.computeProperty(name,object.computedStyle[name],object,memoize))})),needUpdateGeometry&&this.updateGeometry(object),attributeNames.forEach((function(name){name in object.parsedStyle&&_this.postProcessProperty(name,object,attributeNames)})),this.runtime.enableCSSParsing&&object.children.length&&attributeNames.forEach((function(name){name in object.parsedStyle&&_this.isPropertyInheritable(name)&&object.children.forEach((function(child){child.internalSetAttribute(name,null,{skipUpdateAttribute:!0,skipParse:!0})}))}))},DefaultStyleValueRegistry.prototype.parseProperty=function(name,value,object,memoized){var metadata=propertyMetadataCache[name],computed=value;if((""===value||(0,is_nil.A)(value))&&(value="unset"),"unset"===value||"initial"===value||"inherit"===value)computed=getOrCreateKeyword(value);else if(metadata){var keywords=metadata.k,syntax=metadata.syntax,handler=syntax&&this.getPropertySyntax(syntax);keywords&&keywords.indexOf(value)>-1?computed=getOrCreateKeyword(value):handler&&(!memoized&&handler.parserUnmemoize?computed=handler.parserUnmemoize(value,object):handler.parser&&(computed=handler.parser(value,object)))}return computed},DefaultStyleValueRegistry.prototype.computeProperty=function(name,computed,object,memoized){var metadata=propertyMetadataCache[name],isDocumentElement="g-root"===object.id,used=computed;if(metadata){var syntax=metadata.syntax,inherited=metadata.inh,defaultValue=metadata.d;if(computed instanceof CSSKeywordValue){var value=computed.value;if("unset"===value&&(value=inherited&&!isDocumentElement?"inherit":"initial"),"initial"===value)(0,is_nil.A)(defaultValue)||(computed=this.parseProperty(name,index_esm_isFunction(defaultValue)?defaultValue(object.nodeName):defaultValue,object,memoized));else if("inherit"===value){var resolved=this.tryToResolveProperty(object,name,{inherited:!0});return(0,is_nil.A)(resolved)?void this.addUnresolveProperty(object,name):resolved}}var handler=syntax&&this.getPropertySyntax(syntax);if(handler&&handler.calculator){var oldParsedValue=object.parsedStyle[name];used=handler.calculator(name,oldParsedValue,computed,object,this.runtime)}else used=computed instanceof CSSKeywordValue?computed.value:computed}return used},DefaultStyleValueRegistry.prototype.postProcessProperty=function(name,object,attributes){var metadata=propertyMetadataCache[name];if(metadata&&metadata.syntax){var propertyHandler=metadata.syntax&&this.getPropertySyntax(metadata.syntax);propertyHandler&&propertyHandler.postProcessor&&propertyHandler.postProcessor(object,attributes)}},DefaultStyleValueRegistry.prototype.addUnresolveProperty=function(object,name){var properties=unresolvedProperties.get(object);properties||(unresolvedProperties.set(object,[]),properties=unresolvedProperties.get(object)),-1===properties.indexOf(name)&&properties.push(name)},DefaultStyleValueRegistry.prototype.tryToResolveProperty=function(object,name,options){if(void 0===options&&(options={}),options.inherited&&object.parentElement&&function(object,name){var properties=unresolvedProperties.get(object);return!properties||0===properties.length||properties.includes(name)}(object.parentElement,name)){var usedValue=object.parentElement.parsedStyle[name];if("unset"===usedValue||"initial"===usedValue||"inherit"===usedValue)return;return usedValue}},DefaultStyleValueRegistry.prototype.recalc=function(object){var properties=unresolvedProperties.get(object);if(properties&&properties.length){var attributes_1={};properties.forEach((function(property){attributes_1[property]=object.attributes[property]})),this.processProperties(object,attributes_1),unresolvedProperties.delete(object)}},DefaultStyleValueRegistry.prototype.updateGeometry=function(object){var nodeName=object.nodeName,geometryUpdater=this.runtime.geometryUpdaterFactory[nodeName];if(geometryUpdater){var geometry_1=object.geometry;geometry_1.contentBounds||(geometry_1.contentBounds=new AABB),geometry_1.renderBounds||(geometry_1.renderBounds=new AABB);var parsedStyle=object.parsedStyle,_a=geometryUpdater.update(parsedStyle,object),width=_a.width,height=_a.height,_b=_a.depth,depth=void 0===_b?0:_b,_c=_a.offsetX,offsetX=void 0===_c?0:_c,_d=_a.offsetY,offsetY=void 0===_d?0:_d,_e=_a.offsetZ,offsetZ=void 0===_e?0:_e,halfExtents=[Math.abs(width)/2,Math.abs(height)/2,depth/2],_f=parsedStyle,stroke=_f.stroke,lineWidth=_f.lineWidth,increasedLineWidthForHitTesting=_f.increasedLineWidthForHitTesting,shadowType=_f.shadowType,shadowColor=_f.shadowColor,_g=_f.filter,filter=void 0===_g?[]:_g,transformOrigin=_f.transformOrigin,anchor=parsedStyle.anchor;nodeName===Shape.TEXT?delete parsedStyle.anchor:nodeName===Shape.MESH&&(parsedStyle.anchor[2]=.5);var center=[(1-2*(anchor&&anchor[0]||0))*width/2+offsetX,(1-2*(anchor&&anchor[1]||0))*height/2+offsetY,(1-2*(anchor&&anchor[2]||0))*halfExtents[2]+offsetZ];geometry_1.contentBounds.update(center,halfExtents);var expansion=nodeName===Shape.POLYLINE||nodeName===Shape.POLYGON||nodeName===Shape.PATH?Math.SQRT2:.5;if(stroke&&!stroke.isNone){var halfLineWidth=((lineWidth||0)+(increasedLineWidthForHitTesting||0))*expansion;halfExtents[0]+=halfLineWidth,halfExtents[1]+=halfLineWidth}if(geometry_1.renderBounds.update(center,halfExtents),shadowColor&&shadowType&&"inner"!==shadowType){var _h=geometry_1.renderBounds,min=_h.min,max=_h.max,_j=parsedStyle,shadowBlurInPixels=_j.shadowBlur||0,shadowOffsetXInPixels=_j.shadowOffsetX||0,shadowOffsetYInPixels=_j.shadowOffsetY||0,shadowLeft=min[0]-shadowBlurInPixels+shadowOffsetXInPixels,shadowRight=max[0]+shadowBlurInPixels+shadowOffsetXInPixels,shadowTop=min[1]-shadowBlurInPixels+shadowOffsetYInPixels,shadowBottom=max[1]+shadowBlurInPixels+shadowOffsetYInPixels;min[0]=Math.min(min[0],shadowLeft),max[0]=Math.max(max[0],shadowRight),min[1]=Math.min(min[1],shadowTop),max[1]=Math.max(max[1],shadowBottom),geometry_1.renderBounds.setMinMax(min,max)}filter.forEach((function(_a){var name=_a.name,params=_a.params;if("blur"===name){var blurRadius=params[0].value;geometry_1.renderBounds.update(geometry_1.renderBounds.center,addVec3(geometry_1.renderBounds.halfExtents,geometry_1.renderBounds.halfExtents,[blurRadius,blurRadius,0]))}else if("drop-shadow"===name){var shadowOffsetX=params[0].value,shadowOffsetY=params[1].value,shadowBlur=params[2].value,_b=geometry_1.renderBounds,min=_b.min,max=_b.max,shadowLeft=min[0]-shadowBlur+shadowOffsetX,shadowRight=max[0]+shadowBlur+shadowOffsetX,shadowTop=min[1]-shadowBlur+shadowOffsetY,shadowBottom=max[1]+shadowBlur+shadowOffsetY;min[0]=Math.min(min[0],shadowLeft),max[0]=Math.max(max[0],shadowRight),min[1]=Math.min(min[1],shadowTop),max[1]=Math.max(max[1],shadowBottom),geometry_1.renderBounds.setMinMax(min,max)}})),anchor=parsedStyle.anchor;var flipY=width<0,flipX=height<0,usedOriginXValue=(flipY?-1:1)*(transformOrigin?convertPercentUnit(transformOrigin[0],0,object):0),usedOriginYValue=(flipX?-1:1)*(transformOrigin?convertPercentUnit(transformOrigin[1],1,object):0);usedOriginXValue-=(flipY?-1:1)*(anchor&&anchor[0]||0)*geometry_1.contentBounds.halfExtents[0]*2,usedOriginYValue-=(flipX?-1:1)*(anchor&&anchor[1]||0)*geometry_1.contentBounds.halfExtents[1]*2,object.setOrigin(usedOriginXValue,usedOriginYValue),this.runtime.sceneGraphService.dirtifyToRoot(object)}},DefaultStyleValueRegistry.prototype.isPropertyInheritable=function(name){var metadata=propertyMetadataCache[name];return!!metadata&&metadata.inh},DefaultStyleValueRegistry}(),CSSPropertyAngle=function(){function CSSPropertyAngle(){this.parser=parseAngle,this.parserUnmemoize=parseAngleUnmemoize,this.parserWithCSSDisabled=null,this.mixer=mergeNumbers}return CSSPropertyAngle.prototype.calculator=function(name,oldParsed,parsed,object){return convertAngleUnit(parsed)},CSSPropertyAngle}(),CSSPropertyClipPath=function(){function CSSPropertyClipPath(){}return CSSPropertyClipPath.prototype.calculator=function(name,oldPath,newPath,object,runtime){return newPath instanceof CSSKeywordValue&&(newPath=null),runtime.sceneGraphService.updateDisplayObjectDependency(name,oldPath,newPath,object),"clipPath"===name&&object.forEach((function(leaf){0===leaf.childNodes.length&&runtime.sceneGraphService.dirtifyToRoot(leaf)})),newPath},CSSPropertyClipPath}(),CSSPropertyColor=function(){function CSSPropertyColor(){this.parser=parseColor,this.parserWithCSSDisabled=parseColor,this.mixer=mergeColors}return CSSPropertyColor.prototype.calculator=function(name,oldParsed,parsed,object){return parsed instanceof CSSKeywordValue?"none"===parsed.value?noneColor:transparentColor:parsed},CSSPropertyColor}(),CSSPropertyFilter=function(){function CSSPropertyFilter(){this.parser=parseFilter}return CSSPropertyFilter.prototype.calculator=function(name,oldParsed,parsed){return parsed instanceof CSSKeywordValue?[]:parsed},CSSPropertyFilter}();function getFontSize(object){var fontSize=object.parsedStyle.fontSize;return(0,is_nil.A)(fontSize)?null:fontSize}var CSSPropertyLengthOrPercentage=function(){function CSSPropertyLengthOrPercentage(){this.parser=parseLengthOrPercentage,this.parserUnmemoize=parseLengthOrPercentageUnmemoize,this.parserWithCSSDisabled=null,this.mixer=mergeNumbers}return CSSPropertyLengthOrPercentage.prototype.calculator=function(name,oldParsed,computed,object,runtime){var _a;if((0,is_number.A)(computed))return computed;if(!CSSUnitValue.isRelativeUnit(computed.unit))return computed.value;var registry=runtime.styleValueRegistry;if(computed.unit===UnitType.kPercentage)return 0;if(computed.unit===UnitType.kEms){if(object.parentNode){if(fontSize=getFontSize(object.parentNode))return fontSize*=computed.value;registry.addUnresolveProperty(object,name)}else registry.addUnresolveProperty(object,name);return 0}if(computed.unit===UnitType.kRems){if(null===(_a=null==object?void 0:object.ownerDocument)||void 0===_a?void 0:_a.documentElement){var fontSize;if(fontSize=getFontSize(object.ownerDocument.documentElement))return fontSize*=computed.value;registry.addUnresolveProperty(object,name)}else registry.addUnresolveProperty(object,name);return 0}},CSSPropertyLengthOrPercentage}(),CSSPropertyLengthOrPercentage12=function(){function CSSPropertyLengthOrPercentage12(){this.mixer=mergeNumberLists}return CSSPropertyLengthOrPercentage12.prototype.parser=function(radius){var parsed=parseDimensionArray((0,is_number.A)(radius)?[radius]:radius);return 1===parsed.length?[parsed[0],parsed[0]]:[parsed[0],parsed[1]]},CSSPropertyLengthOrPercentage12.prototype.calculator=function(name,oldParsed,computed){return computed.map((function(c){return c.value}))},CSSPropertyLengthOrPercentage12}(),CSSPropertyLengthOrPercentage14=function(){function CSSPropertyLengthOrPercentage14(){this.mixer=mergeNumberLists}return CSSPropertyLengthOrPercentage14.prototype.parser=function(radius){var parsed=parseDimensionArray((0,is_number.A)(radius)?[radius]:radius);return 1===parsed.length?[parsed[0],parsed[0],parsed[0],parsed[0]]:2===parsed.length?[parsed[0],parsed[1],parsed[0],parsed[1]]:3===parsed.length?[parsed[0],parsed[1],parsed[2],parsed[1]]:[parsed[0],parsed[1],parsed[2],parsed[3]]},CSSPropertyLengthOrPercentage14.prototype.calculator=function(name,oldParsed,computed){return computed.map((function(c){return c.value}))},CSSPropertyLengthOrPercentage14}(),tmpMat4=mat4_create();function parsedTransformToMat4(transform,object){var defX=object.parsedStyle.defX||0,defY=object.parsedStyle.defY||0;return object.resetLocalTransform(),object.setLocalPosition(defX,defY),transform.forEach((function(parsed){var t=parsed.t,d=parsed.d;if("scale"===t){var newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1,1];object.scaleLocal(newScale[0],newScale[1],1)}else if("scalex"===t){newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1];object.scaleLocal(newScale[0],1,1)}else if("scaley"===t){newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1];object.scaleLocal(1,newScale[0],1)}else if("scalez"===t){newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1];object.scaleLocal(1,1,newScale[0])}else if("scale3d"===t){newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1,1,1];object.scaleLocal(newScale[0],newScale[1],newScale[2])}else if("translate"===t){var newTranslation=d||[Opx,Opx];object.translateLocal(newTranslation[0].value,newTranslation[1].value,0)}else if("translatex"===t){newTranslation=d||[Opx];object.translateLocal(newTranslation[0].value,0,0)}else if("translatey"===t){newTranslation=d||[Opx];object.translateLocal(0,newTranslation[0].value,0)}else if("translatez"===t){newTranslation=d||[Opx];object.translateLocal(0,0,newTranslation[0].value)}else if("translate3d"===t){newTranslation=d||[Opx,Opx,Opx];object.translateLocal(newTranslation[0].value,newTranslation[1].value,newTranslation[2].value)}else if("rotate"===t){var newAngles=d||[Odeg];object.rotateLocal(0,0,convertAngleUnit(newAngles[0]))}else if("rotatex"===t){newAngles=d||[Odeg];object.rotateLocal(convertAngleUnit(newAngles[0]),0,0)}else if("rotatey"===t){newAngles=d||[Odeg];object.rotateLocal(0,convertAngleUnit(newAngles[0]),0)}else if("rotatez"===t){newAngles=d||[Odeg];object.rotateLocal(0,0,convertAngleUnit(newAngles[0]))}else if("rotate3d"===t);else if("skew"===t){var newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0,0];object.setLocalSkew(deg2rad(newSkew[0]),deg2rad(newSkew[1]))}else if("skewx"===t){newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0];object.setLocalSkew(deg2rad(newSkew[0]),object.getLocalSkew()[1])}else if("skewy"===t){newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0];object.setLocalSkew(object.getLocalSkew()[0],deg2rad(newSkew[0]))}else if("matrix"===t){var _a=(0,tslib_es6.zs)(d.map((function(s){return s.value})),6),a=_a[0],b=_a[1],c=_a[2],dd=_a[3],tx=_a[4],ty=_a[5];object.setLocalTransform(mat4_set(tmpMat4,a,b,0,0,c,dd,0,0,0,0,1,0,tx+defX,ty+defY,0,1))}else"matrix3d"===t&&(mat4_set.apply(mat4_namespaceObject,(0,tslib_es6.fX)([tmpMat4],(0,tslib_es6.zs)(d.map((function(s){return s.value}))),!1)),tmpMat4[12]+=defX,tmpMat4[13]+=defY,object.setLocalTransform(tmpMat4))})),object.getLocalTransform()}var CSSPropertyLocalPosition=function(_super){function CSSPropertyLocalPosition(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(CSSPropertyLocalPosition,_super),CSSPropertyLocalPosition.prototype.postProcessor=function(object,attributes){var x,y,z;switch(object.nodeName){case Shape.CIRCLE:case Shape.ELLIPSE:var _a=object.parsedStyle,cx=_a.cx,cy=_a.cy,cz=_a.cz;(0,is_nil.A)(cx)||(x=cx),(0,is_nil.A)(cy)||(y=cy),(0,is_nil.A)(cz)||(z=cz);break;case Shape.LINE:var _b=object.parsedStyle,x1=_b.x1,x2=_b.x2,y1=_b.y1,y2=_b.y2;x=Math.min(x1,x2),y=Math.min(y1,y2),z=0;break;case Shape.RECT:case Shape.IMAGE:case Shape.GROUP:case Shape.HTML:case Shape.TEXT:case Shape.MESH:(0,is_nil.A)(object.parsedStyle.x)||(x=object.parsedStyle.x),(0,is_nil.A)(object.parsedStyle.y)||(y=object.parsedStyle.y),(0,is_nil.A)(object.parsedStyle.z)||(z=object.parsedStyle.z)}if(object.nodeName!==Shape.PATH&&object.nodeName!==Shape.POLYLINE&&object.nodeName!==Shape.POLYGON&&(object.parsedStyle.defX=x||0,object.parsedStyle.defY=y||0),(!(0,is_nil.A)(x)||!(0,is_nil.A)(y)||!(0,is_nil.A)(z))&&-1===attributes.indexOf("transform")){var transform=object.parsedStyle.transform;if(transform&&transform.length)parsedTransformToMat4(transform,object);else{var _c=(0,tslib_es6.zs)(object.getLocalPosition(),3),ox=_c[0],oy=_c[1],oz=_c[2];object.setLocalPosition((0,is_nil.A)(x)?ox:x,(0,is_nil.A)(y)?oy:y,(0,is_nil.A)(z)?oz:z)}}},CSSPropertyLocalPosition}(CSSPropertyLengthOrPercentage),CSSPropertyMarker=function(){function CSSPropertyMarker(){}return CSSPropertyMarker.prototype.calculator=function(name,oldMarker,newMarker,object){newMarker instanceof CSSKeywordValue&&(newMarker=null);var cloned=null==newMarker?void 0:newMarker.cloneNode(!0);return cloned&&(cloned.style.isMarker=!0),cloned},CSSPropertyMarker}(),CSSPropertyNumber=function(){function CSSPropertyNumber(){this.mixer=mergeNumbers,this.parser=parseNumber,this.parserUnmemoize=parseNumberUnmemoize,this.parserWithCSSDisabled=null}return CSSPropertyNumber.prototype.calculator=function(name,oldParsed,computed){return computed.value},CSSPropertyNumber}(),CSSPropertyOffsetDistance=function(){function CSSPropertyOffsetDistance(){this.parser=parseNumber,this.parserUnmemoize=parseNumberUnmemoize,this.parserWithCSSDisabled=null,this.mixer=clampedMergeNumbers(0,1)}return CSSPropertyOffsetDistance.prototype.calculator=function(name,oldParsed,computed){return computed.value},CSSPropertyOffsetDistance.prototype.postProcessor=function(object){var _a=object.parsedStyle,offsetPath=_a.offsetPath,offsetDistance=_a.offsetDistance;if(offsetPath){var nodeName=offsetPath.nodeName;if(nodeName===Shape.LINE||nodeName===Shape.PATH||nodeName===Shape.POLYLINE){var point=offsetPath.getPoint(offsetDistance);point&&(object.parsedStyle.defX=point.x,object.parsedStyle.defY=point.y,object.setLocalPosition(point.x,point.y))}}},CSSPropertyOffsetDistance}(),CSSPropertyOpacity=function(){function CSSPropertyOpacity(){this.parser=parseNumber,this.parserUnmemoize=parseNumberUnmemoize,this.parserWithCSSDisabled=null,this.mixer=clampedMergeNumbers(0,1)}return CSSPropertyOpacity.prototype.calculator=function(name,oldParsed,computed){return computed.value},CSSPropertyOpacity}(),CSSPropertyPath=function(){function CSSPropertyPath(){this.parser=parsePath,this.parserWithCSSDisabled=parsePath,this.mixer=mergePaths}return CSSPropertyPath.prototype.calculator=function(name,oldParsed,parsed){return parsed instanceof CSSKeywordValue&&"unset"===parsed.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Rectangle(0,0,0,0)}:parsed},CSSPropertyPath.prototype.postProcessor=function(object,attributes){if(object.parsedStyle.defX=object.parsedStyle.path.rect.x,object.parsedStyle.defY=object.parsedStyle.path.rect.y,object.nodeName===Shape.PATH&&-1===attributes.indexOf("transform")){var _a=object.parsedStyle,_b=_a.defX,defX=void 0===_b?0:_b,_c=_a.defY,defY=void 0===_c?0:_c;object.setLocalPosition(defX,defY)}},CSSPropertyPath}(),CSSPropertyPoints=function(){function CSSPropertyPoints(){this.parser=parsePoints,this.mixer=mergePoints}return CSSPropertyPoints.prototype.postProcessor=function(object,attributes){if((object.nodeName===Shape.POLYGON||object.nodeName===Shape.POLYLINE)&&-1===attributes.indexOf("transform")){var _a=object.parsedStyle,defX=_a.defX,defY=_a.defY;object.setLocalPosition(defX,defY)}},CSSPropertyPoints}(),CSSPropertyShadowBlur=function(_super){function CSSPropertyShadowBlur(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.mixer=clampedMergeNumbers(0,1/0),_this}return(0,tslib_es6.C6)(CSSPropertyShadowBlur,_super),CSSPropertyShadowBlur}(CSSPropertyLengthOrPercentage),CSSPropertyText=function(){function CSSPropertyText(){}return CSSPropertyText.prototype.calculator=function(name,oldParsed,parsed,object){return parsed instanceof CSSKeywordValue?"unset"===parsed.value?"":parsed.value:"".concat(parsed)},CSSPropertyText.prototype.postProcessor=function(object){object.nodeValue="".concat(object.parsedStyle.text)||""},CSSPropertyText}(),CSSPropertyTextTransform=function(){function CSSPropertyTextTransform(){}return CSSPropertyTextTransform.prototype.calculator=function(name,oldParsed,parsed,object){var rawText=object.getAttribute("text");if(rawText){var transformedText=rawText;"capitalize"===parsed.value?transformedText=rawText.charAt(0).toUpperCase()+rawText.slice(1):"lowercase"===parsed.value?transformedText=rawText.toLowerCase():"uppercase"===parsed.value&&(transformedText=rawText.toUpperCase()),object.parsedStyle.text=transformedText}return parsed.value},CSSPropertyTextTransform}(),canvasMap={},defaultCanvasIdCounter=0;var isBrowser="undefined"!=typeof window&&void 0!==window.document;function isElement(target){return!!target.getAttribute}function sortByZIndex(o1,o2){var zIndex1=Number(o1.parsedStyle.zIndex),zIndex2=Number(o2.parsedStyle.zIndex);if(zIndex1===zIndex2){var parent_1=o1.parentNode;if(parent_1){var children=parent_1.childNodes||[];return children.indexOf(o1)-children.indexOf(o2)}}return zIndex1-zIndex2}function findClosestClipPathTarget(object){var _a,el=object;do{if(null===(_a=el.parsedStyle)||void 0===_a?void 0:_a.clipPath)return el;el=el.parentElement}while(null!==el);return null}function setDOMSize($el,width,height){isBrowser&&$el.style&&($el.style.width=width+"px",$el.style.height=height+"px")}function getStyle($el,property){if(isBrowser)return document.defaultView.getComputedStyle($el,null).getPropertyValue(property)}var TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},clock="object"==typeof performance&&performance.now?performance:Date;function isFillOrStrokeAffected(pointerEvents,fill,stroke){var hasFill=!1,hasStroke=!1,isFillOtherThanNone=!!fill&&!fill.isNone,isStrokeOtherThanNone=!!stroke&&!stroke.isNone;return"visiblepainted"===pointerEvents||"painted"===pointerEvents||"auto"===pointerEvents?(hasFill=isFillOtherThanNone,hasStroke=isStrokeOtherThanNone):"visiblefill"===pointerEvents||"fill"===pointerEvents?hasFill=!0:"visiblestroke"===pointerEvents||"stroke"===pointerEvents?hasStroke=!0:"visible"!==pointerEvents&&"all"!==pointerEvents||(hasFill=!0,hasStroke=!0),[hasFill,hasStroke]}var uId=1,root="object"==typeof self&&self.self==self?self:"object"==typeof __webpack_require__.g&&__webpack_require__.g.global==__webpack_require__.g?__webpack_require__.g:{},nowOffset=Date.now(),reservedCBs={},lastTime=Date.now(),polyfillRaf=function(callback){if("function"!=typeof callback)throw new TypeError(callback+" is not a function");var currentTime=Date.now(),gap=currentTime-lastTime,delay=gap>16?0:16-gap,id=uId++;return reservedCBs[id]=callback,Object.keys(reservedCBs).length>1||setTimeout((function(){lastTime=currentTime;var copied=reservedCBs;reservedCBs={},Object.keys(copied).forEach((function(key){return copied[key](root.performance&&"function"==typeof root.performance.now?root.performance.now():Date.now()-nowOffset)}))}),delay),id},polyfillCaf=function(id){delete reservedCBs[id]},getRequestAnimationFrame=function(vp){return"string"!=typeof vp?polyfillRaf:""===vp?root.requestAnimationFrame:root[vp+"RequestAnimationFrame"]},vp=function(arr,predicate){for(var i=0;void 0!==arr[i];){if(predicate(arr[i]))return arr[i];i+=1}}(["","webkit","moz","ms","o"],(function(vp){return!!getRequestAnimationFrame(vp)})),raf=getRequestAnimationFrame(vp),caf=function(vp){return"string"!=typeof vp?polyfillCaf:""===vp?root.cancelAnimationFrame:root[vp+"CancelAnimationFrame"]||root[vp+"CancelRequestAnimationFrame"]}(vp);root.requestAnimationFrame=raf,root.cancelAnimationFrame=caf;var AsyncParallelHook=function(){function AsyncParallelHook(){this.callbacks=[]}return AsyncParallelHook.prototype.getCallbacksNum=function(){return this.callbacks.length},AsyncParallelHook.prototype.tapPromise=function(options,fn){this.callbacks.push(fn)},AsyncParallelHook.prototype.promise=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return Promise.all(this.callbacks.map((function(callback){return callback.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(args),!1))})))},AsyncParallelHook}(),AsyncSeriesWaterfallHook=function(){function AsyncSeriesWaterfallHook(){this.callbacks=[]}return AsyncSeriesWaterfallHook.prototype.tapPromise=function(options,fn){this.callbacks.push(fn)},AsyncSeriesWaterfallHook.prototype.promise=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var result,i,_a;return(0,tslib_es6.YH)(this,(function(_b){switch(_b.label){case 0:return this.callbacks.length?[4,(_a=this.callbacks)[0].apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(args),!1))]:[3,6];case 1:result=_b.sent(),i=0,_b.label=2;case 2:return i<this.callbacks.length-1?[4,(0,this.callbacks[i])(result)]:[3,5];case 3:result=_b.sent(),_b.label=4;case 4:return i++,[3,2];case 5:return[2,result];case 6:return[2,null]}}))}))},AsyncSeriesWaterfallHook}(),SyncHook=function(){function SyncHook(){this.callbacks=[]}return SyncHook.prototype.tap=function(options,fn){this.callbacks.push(fn)},SyncHook.prototype.call=function(){var argsArr=arguments;this.callbacks.forEach((function(callback){callback.apply(void 0,argsArr)}))},SyncHook}(),SyncWaterfallHook=function(){function SyncWaterfallHook(){this.callbacks=[]}return SyncWaterfallHook.prototype.tap=function(options,fn){this.callbacks.push(fn)},SyncWaterfallHook.prototype.call=function(){if(this.callbacks.length){for(var argsArr=arguments,result=this.callbacks[0].apply(void 0,argsArr),i=0;i<this.callbacks.length-1;i++){result=(0,this.callbacks[i])(result)}return result}return null},SyncWaterfallHook}(),genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],stringRegExp=/([\"\'])[^\'\"]+\1/;var CSSPropertyTransform=function(){function CSSPropertyTransform(){this.parser=parseTransform,this.parserUnmemoize=parseTransformUnmemoize,this.parserWithCSSDisabled=parseTransformUnmemoize,this.mixer=mergeTransforms}return CSSPropertyTransform.prototype.calculator=function(name,oldParsed,parsed,object){return parsed instanceof CSSKeywordValue?[]:parsed},CSSPropertyTransform.prototype.postProcessor=function(object){parsedTransformToMat4(object.parsedStyle.transform,object)},CSSPropertyTransform}(),CSSPropertyTransformOrigin=function CSSPropertyTransformOrigin(){this.parser=parseTransformOrigin,this.parserUnmemoize=parseTransformOriginUnmemoize},CSSPropertyZIndex=function(){function CSSPropertyZIndex(){this.parser=parseNumber,this.parserUnmemoize=parseNumberUnmemoize}return CSSPropertyZIndex.prototype.calculator=function(name,oldParsed,computed,object){return computed.value},CSSPropertyZIndex.prototype.postProcessor=function(object){if(object.parentNode){var parentEntity=object.parentNode,parentRenderable=parentEntity.renderable,parentSortable=parentEntity.sortable;parentRenderable&&(parentRenderable.dirty=!0),parentSortable&&(parentSortable.dirty=!0,parentSortable.dirtyReason=SortReason.Z_INDEX_CHANGED)}},CSSPropertyZIndex}(),CircleUpdater=function(){function CircleUpdater(){}return CircleUpdater.prototype.update=function(parsedStyle,object){var r=parsedStyle.r;return{width:2*r,height:2*r}},CircleUpdater}(),EllipseUpdater=function(){function EllipseUpdater(){}return EllipseUpdater.prototype.update=function(parsedStyle,object){return{width:2*parsedStyle.rx,height:2*parsedStyle.ry}},EllipseUpdater}(),LineUpdater=function(){function LineUpdater(){}return LineUpdater.prototype.update=function(parsedStyle){var x1=parsedStyle.x1,y1=parsedStyle.y1,x2=parsedStyle.x2,y2=parsedStyle.y2,minX=Math.min(x1,x2),maxX=Math.max(x1,x2),minY=Math.min(y1,y2);return{width:maxX-minX,height:Math.max(y1,y2)-minY}},LineUpdater}(),PathUpdater=function(){function PathUpdater(){}return PathUpdater.prototype.update=function(parsedStyle){var _a=parsedStyle.path.rect;return{width:_a.width,height:_a.height}},PathUpdater}(),PolylineUpdater=function(){function PolylineUpdater(){}return PolylineUpdater.prototype.update=function(parsedStyle){if(parsedStyle.points&&(0,is_array.A)(parsedStyle.points.points)){var points=parsedStyle.points.points,minX=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[0]}))),!1)),maxX=Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[0]}))),!1)),minY=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[1]}))),!1)),maxY=Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(points.map((function(point){return point[1]}))),!1));return{width:maxX-minX,height:maxY-minY}}return{width:0,height:0}},PolylineUpdater}(),RectUpdater=function(){function RectUpdater(){}return RectUpdater.prototype.update=function(parsedStyle,object){var img=parsedStyle.img,_a=parsedStyle.width,width=void 0===_a?0:_a,_b=parsedStyle.height,contentWidth=width,contentHeight=void 0===_b?0:_b;return img&&!(0,is_string.A)(img)&&(contentWidth||(contentWidth=img.width,parsedStyle.width=contentWidth),contentHeight||(contentHeight=img.height,parsedStyle.height=contentHeight)),{width:contentWidth,height:contentHeight}},RectUpdater}(),TextUpdater=function(){function TextUpdater(globalRuntime){this.globalRuntime=globalRuntime}return TextUpdater.prototype.isReadyToMeasure=function(parsedStyle,object){var text=parsedStyle.text,textAlign=parsedStyle.textAlign,textBaseline=parsedStyle.textBaseline,fontSize=parsedStyle.fontSize,fontStyle=parsedStyle.fontStyle,fontWeight=parsedStyle.fontWeight,fontVariant=parsedStyle.fontVariant,lineWidth=parsedStyle.lineWidth;return text&&fontSize&&fontStyle&&fontWeight&&fontVariant&&textAlign&&textBaseline&&!(0,is_nil.A)(lineWidth)},TextUpdater.prototype.update=function(parsedStyle,object){var _a,_b,text=parsedStyle.text,textAlign=parsedStyle.textAlign,lineWidth=parsedStyle.lineWidth,textBaseline=parsedStyle.textBaseline,dx=parsedStyle.dx,dy=parsedStyle.dy;if(!this.isReadyToMeasure(parsedStyle,object))return parsedStyle.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{width:0,height:0,x:0,y:0,offsetX:0,offsetY:0};var offscreenCanvas=((null===(_b=null===(_a=null==object?void 0:object.ownerDocument)||void 0===_a?void 0:_a.defaultView)||void 0===_b?void 0:_b.getConfig())||{}).offscreenCanvas,metrics=this.globalRuntime.textService.measureText(text,parsedStyle,offscreenCanvas);parsedStyle.metrics=metrics;var width=metrics.width,height=metrics.height,lineHeight=metrics.lineHeight,fontProperties=metrics.fontProperties,halfExtents=[width/2,height/2,0],anchor=[0,1],lineXOffset=0;"center"===textAlign||"middle"===textAlign?(lineXOffset=lineWidth/2,anchor=[.5,1]):"right"!==textAlign&&"end"!==textAlign||(lineXOffset=lineWidth,anchor=[1,1]);var lineYOffset=0;return"middle"===textBaseline?lineYOffset=halfExtents[1]:"top"===textBaseline||"hanging"===textBaseline?lineYOffset=2*halfExtents[1]:"alphabetic"===textBaseline?lineYOffset=this.globalRuntime.enableCSSParsing?lineHeight-fontProperties.ascent:0:"bottom"!==textBaseline&&"ideographic"!==textBaseline||(lineYOffset=0),dx&&(lineXOffset+=dx),dy&&(lineYOffset+=dy),parsedStyle.anchor=[anchor[0],anchor[1],0],{width:2*halfExtents[0],height:2*halfExtents[1],offsetX:lineXOffset,offsetY:lineYOffset}},TextUpdater}();var RenderReason,FederatedEvent=function(){function FederatedEvent(manager){this.eventPhase=FederatedEvent.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Point,this.page=new Point,this.canvas=new Point,this.viewport=new Point,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=manager}return Object.defineProperty(FederatedEvent.prototype,"name",{get:function(){return this.type},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"layerX",{get:function(){return this.layer.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"layerY",{get:function(){return this.layer.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"pageX",{get:function(){return this.page.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"pageY",{get:function(){return this.page.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"x",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"y",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"canvasX",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"canvasY",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"viewportX",{get:function(){return this.viewport.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedEvent.prototype,"viewportY",{get:function(){return this.viewport.y},enumerable:!1,configurable:!0}),FederatedEvent.prototype.composedPath=function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},Object.defineProperty(FederatedEvent.prototype,"propagationPath",{get:function(){return this.composedPath()},enumerable:!1,configurable:!0}),FederatedEvent.prototype.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},FederatedEvent.prototype.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},FederatedEvent.prototype.stopPropagation=function(){this.propagationStopped=!0},FederatedEvent.prototype.initEvent=function(){},FederatedEvent.prototype.initUIEvent=function(){},FederatedEvent.prototype.clone=function(){throw new Error("Method not implemented.")},FederatedEvent}(),FederatedMouseEvent=function(_super){function FederatedMouseEvent(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.client=new Point,_this.movement=new Point,_this.offset=new Point,_this.global=new Point,_this.screen=new Point,_this}return(0,tslib_es6.C6)(FederatedMouseEvent,_super),Object.defineProperty(FederatedMouseEvent.prototype,"clientX",{get:function(){return this.client.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"clientY",{get:function(){return this.client.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"movementX",{get:function(){return this.movement.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"movementY",{get:function(){return this.movement.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"offsetX",{get:function(){return this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"offsetY",{get:function(){return this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"globalX",{get:function(){return this.global.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"globalY",{get:function(){return this.global.y},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"screenX",{get:function(){return this.screen.x},enumerable:!1,configurable:!0}),Object.defineProperty(FederatedMouseEvent.prototype,"screenY",{get:function(){return this.screen.y},enumerable:!1,configurable:!0}),FederatedMouseEvent.prototype.getModifierState=function(key){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(key)},FederatedMouseEvent.prototype.initMouseEvent=function(){throw new Error("Method not implemented.")},FederatedMouseEvent}(FederatedEvent),FederatedPointerEvent=function(_super){function FederatedPointerEvent(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.width=0,_this.height=0,_this.isPrimary=!1,_this}return(0,tslib_es6.C6)(FederatedPointerEvent,_super),FederatedPointerEvent.prototype.getCoalescedEvents=function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]},FederatedPointerEvent.prototype.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},FederatedPointerEvent.prototype.clone=function(){return this.manager.clonePointerEvent(this)},FederatedPointerEvent}(FederatedMouseEvent),FederatedWheelEvent=function(_super){function FederatedWheelEvent(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(FederatedWheelEvent,_super),FederatedWheelEvent.prototype.clone=function(){return this.manager.cloneWheelEvent(this)},FederatedWheelEvent}(FederatedMouseEvent),CustomEvent=function(_super){function CustomEvent(eventName,object){var _this=_super.call(this,null)||this;return _this.type=eventName,_this.detail=object,Object.assign(_this,object),_this}return(0,tslib_es6.C6)(CustomEvent,_super),CustomEvent}(FederatedEvent),EventTarget=function(){function EventTarget(){this.emitter=new node_modules_eventemitter3}return EventTarget.prototype.on=function(type,listener,options){return this.addEventListener(type,listener,options),this},EventTarget.prototype.addEventListener=function(type,listener,options){var capture=is_boolean(options)&&options||(0,is_object.A)(options)&&options.capture,once=(0,is_object.A)(options)&&options.once,context=index_esm_isFunction(listener)?void 0:listener,useDelegatedName=!1,delegatedName="";if(type.indexOf(":")>-1){var _a=(0,tslib_es6.zs)(type.split(":"),2),name_1=_a[0];type=_a[1],delegatedName=name_1,useDelegatedName=!0}if(type=capture?"".concat(type,"capture"):type,listener=index_esm_isFunction(listener)?listener:listener.handleEvent,useDelegatedName){var originListener_1=listener;listener=function(){for(var _a,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];(null===(_a=args[0].target)||void 0===_a?void 0:_a.name)===delegatedName&&originListener_1.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(args),!1))}}return once?this.emitter.once(type,listener,context):this.emitter.on(type,listener,context),this},EventTarget.prototype.off=function(type,listener,options){return type?this.removeEventListener(type,listener,options):this.removeAllEventListeners(),this},EventTarget.prototype.removeAllEventListeners=function(){this.emitter.removeAllListeners()},EventTarget.prototype.removeEventListener=function(type,listener,options){var capture=is_boolean(options)&&options||(0,is_object.A)(options)&&options.capture,context=index_esm_isFunction(listener)?void 0:listener;return type=capture?"".concat(type,"capture"):type,listener=index_esm_isFunction(listener)?listener:null==listener?void 0:listener.handleEvent,this.emitter.off(type,listener,context),this},EventTarget.prototype.emit=function(eventName,object){this.dispatchEvent(new CustomEvent(eventName,object))},EventTarget.prototype.dispatchEvent=function(e,skipPropagate){var _a,_b,canvas;if(void 0===skipPropagate&&(skipPropagate=!1),!function isFederatedEvent(value){return!!value.type}(e))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");if(canvas=this.document?this:this.defaultView?this.defaultView:null===(_a=this.ownerDocument)||void 0===_a?void 0:_a.defaultView){if(e.manager=canvas.getEventService()||null,!e.manager)return!1;e.defaultPrevented=!1,e.path=[],skipPropagate||(e.target=this),null===(_b=e.manager)||void 0===_b||_b.dispatchEvent(e,e.type,skipPropagate)}return!e.defaultPrevented},EventTarget}(),Node=function(_super){function Node(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.shadow=!1,_this.ownerDocument=null,_this.isConnected=!1,_this.baseURI="",_this.childNodes=[],_this.nodeType=0,_this.nodeName="",_this.nodeValue=null,_this.parentNode=null,_this}return(0,tslib_es6.C6)(Node,_super),Node.isNode=function(target){return!!target.childNodes},Object.defineProperty(Node.prototype,"textContent",{get:function(){var e_1,_a,out="";this.nodeName===Shape.TEXT&&(out+=this.style.text);try{for(var _b=(0,tslib_es6.Ju)(this.childNodes),_c=_b.next();!_c.done;_c=_b.next()){var child=_c.value;child.nodeName===Shape.TEXT?out+=child.nodeValue:out+=child.textContent}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return out},set:function(content){var _this=this;this.childNodes.slice().forEach((function(child){_this.removeChild(child)})),this.nodeName===Shape.TEXT&&(this.style.text="".concat(content))},enumerable:!1,configurable:!0}),Node.prototype.getRootNode=function(opts){return void 0===opts&&(opts={}),this.parentNode?this.parentNode.getRootNode(opts):opts.composed&&this.host?this.host.getRootNode(opts):this},Node.prototype.hasChildNodes=function(){return this.childNodes.length>0},Node.prototype.isDefaultNamespace=function(namespace){throw new Error("Method not implemented.")},Node.prototype.lookupNamespaceURI=function(prefix){throw new Error("Method not implemented.")},Node.prototype.lookupPrefix=function(namespace){throw new Error("Method not implemented.")},Node.prototype.normalize=function(){throw new Error("Method not implemented.")},Node.prototype.isEqualNode=function(otherNode){return this===otherNode},Node.prototype.isSameNode=function(otherNode){return this.isEqualNode(otherNode)},Object.defineProperty(Node.prototype,"parent",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(Node.prototype,"parentElement",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(Node.prototype,"nextSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(Node.prototype,"previousSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(Node.prototype,"firstChild",{get:function(){return this.childNodes.length>0?this.childNodes[0]:null},enumerable:!1,configurable:!0}),Object.defineProperty(Node.prototype,"lastChild",{get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null},enumerable:!1,configurable:!0}),Node.prototype.compareDocumentPosition=function(other){var _a;if(other===this)return 0;for(var node1Root=other,node2Root=this,node1Hierarchy=[node1Root],node2Hierarchy=[node2Root];null!==(_a=node1Root.parentNode)&&void 0!==_a?_a:node2Root.parentNode;)node1Root=node1Root.parentNode?(node1Hierarchy.push(node1Root.parentNode),node1Root.parentNode):node1Root,node2Root=node2Root.parentNode?(node2Hierarchy.push(node2Root.parentNode),node2Root.parentNode):node2Root;if(node1Root!==node2Root)return Node.DOCUMENT_POSITION_DISCONNECTED|Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|Node.DOCUMENT_POSITION_PRECEDING;var longerHierarchy=node1Hierarchy.length>node2Hierarchy.length?node1Hierarchy:node2Hierarchy,shorterHierarchy=longerHierarchy===node1Hierarchy?node2Hierarchy:node1Hierarchy;if(longerHierarchy[longerHierarchy.length-shorterHierarchy.length]===shorterHierarchy[0])return longerHierarchy===node1Hierarchy?Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING:Node.DOCUMENT_POSITION_CONTAINS|Node.DOCUMENT_POSITION_PRECEDING;for(var longerStart=longerHierarchy.length-shorterHierarchy.length,i=shorterHierarchy.length-1;i>=0;i--){var shorterHierarchyNode=shorterHierarchy[i],longerHierarchyNode=longerHierarchy[longerStart+i];if(longerHierarchyNode!==shorterHierarchyNode){var siblings=shorterHierarchyNode.parentNode.childNodes;return siblings.indexOf(shorterHierarchyNode)<siblings.indexOf(longerHierarchyNode)?shorterHierarchy===node1Hierarchy?Node.DOCUMENT_POSITION_PRECEDING:Node.DOCUMENT_POSITION_FOLLOWING:longerHierarchy===node1Hierarchy?Node.DOCUMENT_POSITION_PRECEDING:Node.DOCUMENT_POSITION_FOLLOWING}}return Node.DOCUMENT_POSITION_FOLLOWING},Node.prototype.contain=function(other){return this.contains(other)},Node.prototype.contains=function(other){for(var tmp=other;tmp&&this!==tmp;)tmp=tmp.parentNode;return!!tmp},Node.prototype.getAncestor=function(n){for(var temp=this;n>0&&temp;)temp=temp.parentNode,n--;return temp},Node.prototype.forEach=function(callback,assigned){void 0===assigned&&(assigned=!1),callback(this)||(assigned?this.childNodes.slice():this.childNodes).forEach((function(child){child.forEach(callback)}))},Node.DOCUMENT_POSITION_DISCONNECTED=1,Node.DOCUMENT_POSITION_PRECEDING=2,Node.DOCUMENT_POSITION_FOLLOWING=4,Node.DOCUMENT_POSITION_CONTAINS=8,Node.DOCUMENT_POSITION_CONTAINED_BY=16,Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,Node}(EventTarget),EventService=function(){function EventService(globalRuntime,context){var _this=this;this.globalRuntime=globalRuntime,this.context=context,this.emitter=new node_modules_eventemitter3,this.nativeHTMLMap=new WeakMap,this.cursor="default",this.mappingTable={},this.mappingState={trackingData:{}},this.eventPool=new Map,this.tmpMatrix=mat4_create(),this.tmpVec3=create(),this.onPointerDown=function(from){var e=_this.createPointerEvent(from);if(_this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)_this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){var isRightButton=2===e.button;_this.dispatchEvent(e,isRightButton?"rightdown":"mousedown")}_this.trackingData(from.pointerId).pressTargetsByButton[from.button]=e.composedPath(),_this.freeEvent(e)},this.onPointerUp=function(from){var _a,now=clock.now(),e=_this.createPointerEvent(from,void 0,void 0,_this.context.config.alwaysTriggerPointerEventOnCanvas?_this.rootTarget:void 0);if(_this.dispatchEvent(e,"pointerup"),"touch"===e.pointerType)_this.dispatchEvent(e,"touchend");else if("mouse"===e.pointerType||"pen"===e.pointerType){var isRightButton=2===e.button;_this.dispatchEvent(e,isRightButton?"rightup":"mouseup")}var trackingData=_this.trackingData(from.pointerId),pressTarget=_this.findMountedTarget(trackingData.pressTargetsByButton[from.button]),clickTarget=pressTarget;if(pressTarget&&!e.composedPath().includes(pressTarget)){for(var currentTarget=pressTarget;currentTarget&&!e.composedPath().includes(currentTarget);){if(e.currentTarget=currentTarget,_this.notifyTarget(e,"pointerupoutside"),"touch"===e.pointerType)_this.notifyTarget(e,"touchendoutside");else if("mouse"===e.pointerType||"pen"===e.pointerType){isRightButton=2===e.button;_this.notifyTarget(e,isRightButton?"rightupoutside":"mouseupoutside")}Node.isNode(currentTarget)&&(currentTarget=currentTarget.parentNode)}delete trackingData.pressTargetsByButton[from.button],clickTarget=currentTarget}if(clickTarget){var clickEvent=_this.clonePointerEvent(e,"click");clickEvent.target=clickTarget,clickEvent.path=[],trackingData.clicksByButton[from.button]||(trackingData.clicksByButton[from.button]={clickCount:0,target:clickEvent.target,timeStamp:now});var clickHistory=trackingData.clicksByButton[from.button];clickHistory.target===clickEvent.target&&now-clickHistory.timeStamp<200?++clickHistory.clickCount:clickHistory.clickCount=1,clickHistory.target=clickEvent.target,clickHistory.timeStamp=now,clickEvent.detail=clickHistory.clickCount,(null===(_a=e.detail)||void 0===_a?void 0:_a.preventClick)||(_this.context.config.useNativeClickEvent||"mouse"!==clickEvent.pointerType&&"touch"!==clickEvent.pointerType||_this.dispatchEvent(clickEvent,"click"),_this.dispatchEvent(clickEvent,"pointertap")),_this.freeEvent(clickEvent)}_this.freeEvent(e)},this.onPointerMove=function(from){var e=_this.createPointerEvent(from,void 0,void 0,_this.context.config.alwaysTriggerPointerEventOnCanvas?_this.rootTarget:void 0),isMouse="mouse"===e.pointerType||"pen"===e.pointerType,trackingData=_this.trackingData(from.pointerId),outTarget=_this.findMountedTarget(trackingData.overTargets);if(trackingData.overTargets&&outTarget!==e.target){var outType="mousemove"===from.type?"mouseout":"pointerout",outEvent=_this.createPointerEvent(from,outType,outTarget||void 0);if(_this.dispatchEvent(outEvent,"pointerout"),isMouse&&_this.dispatchEvent(outEvent,"mouseout"),!e.composedPath().includes(outTarget)){var leaveEvent=_this.createPointerEvent(from,"pointerleave",outTarget||void 0);for(leaveEvent.eventPhase=leaveEvent.AT_TARGET;leaveEvent.target&&!e.composedPath().includes(leaveEvent.target);)leaveEvent.currentTarget=leaveEvent.target,_this.notifyTarget(leaveEvent),isMouse&&_this.notifyTarget(leaveEvent,"mouseleave"),Node.isNode(leaveEvent.target)&&(leaveEvent.target=leaveEvent.target.parentNode);_this.freeEvent(leaveEvent)}_this.freeEvent(outEvent)}if(outTarget!==e.target){var overType="mousemove"===from.type?"mouseover":"pointerover",overEvent=_this.clonePointerEvent(e,overType);_this.dispatchEvent(overEvent,"pointerover"),isMouse&&_this.dispatchEvent(overEvent,"mouseover");for(var overTargetAncestor=outTarget&&Node.isNode(outTarget)&&outTarget.parentNode;overTargetAncestor&&overTargetAncestor!==(Node.isNode(_this.rootTarget)&&_this.rootTarget.parentNode)&&overTargetAncestor!==e.target;)overTargetAncestor=overTargetAncestor.parentNode;if(!overTargetAncestor||overTargetAncestor===(Node.isNode(_this.rootTarget)&&_this.rootTarget.parentNode)){var enterEvent=_this.clonePointerEvent(e,"pointerenter");for(enterEvent.eventPhase=enterEvent.AT_TARGET;enterEvent.target&&enterEvent.target!==outTarget&&enterEvent.target!==(Node.isNode(_this.rootTarget)&&_this.rootTarget.parentNode);)enterEvent.currentTarget=enterEvent.target,_this.notifyTarget(enterEvent),isMouse&&_this.notifyTarget(enterEvent,"mouseenter"),Node.isNode(enterEvent.target)&&(enterEvent.target=enterEvent.target.parentNode);_this.freeEvent(enterEvent)}_this.freeEvent(overEvent)}_this.dispatchEvent(e,"pointermove"),"touch"===e.pointerType&&_this.dispatchEvent(e,"touchmove"),isMouse&&(_this.dispatchEvent(e,"mousemove"),_this.cursor=_this.getCursor(e.target)),trackingData.overTargets=e.composedPath(),_this.freeEvent(e)},this.onPointerOut=function(from){var trackingData=_this.trackingData(from.pointerId);if(trackingData.overTargets){var isMouse="mouse"===from.pointerType||"pen"===from.pointerType,outTarget=_this.findMountedTarget(trackingData.overTargets),outEvent=_this.createPointerEvent(from,"pointerout",outTarget||void 0);_this.dispatchEvent(outEvent),isMouse&&_this.dispatchEvent(outEvent,"mouseout");var leaveEvent=_this.createPointerEvent(from,"pointerleave",outTarget||void 0);for(leaveEvent.eventPhase=leaveEvent.AT_TARGET;leaveEvent.target&&leaveEvent.target!==(Node.isNode(_this.rootTarget)&&_this.rootTarget.parentNode);)leaveEvent.currentTarget=leaveEvent.target,_this.notifyTarget(leaveEvent),isMouse&&_this.notifyTarget(leaveEvent,"mouseleave"),Node.isNode(leaveEvent.target)&&(leaveEvent.target=leaveEvent.target.parentNode);trackingData.overTargets=null,_this.freeEvent(outEvent),_this.freeEvent(leaveEvent)}_this.cursor=null},this.onPointerOver=function(from){var trackingData=_this.trackingData(from.pointerId),e=_this.createPointerEvent(from),isMouse="mouse"===e.pointerType||"pen"===e.pointerType;_this.dispatchEvent(e,"pointerover"),isMouse&&_this.dispatchEvent(e,"mouseover"),"mouse"===e.pointerType&&(_this.cursor=_this.getCursor(e.target));var enterEvent=_this.clonePointerEvent(e,"pointerenter");for(enterEvent.eventPhase=enterEvent.AT_TARGET;enterEvent.target&&enterEvent.target!==(Node.isNode(_this.rootTarget)&&_this.rootTarget.parentNode);)enterEvent.currentTarget=enterEvent.target,_this.notifyTarget(enterEvent),isMouse&&_this.notifyTarget(enterEvent,"mouseenter"),Node.isNode(enterEvent.target)&&(enterEvent.target=enterEvent.target.parentNode);trackingData.overTargets=e.composedPath(),_this.freeEvent(e),_this.freeEvent(enterEvent)},this.onPointerUpOutside=function(from){var trackingData=_this.trackingData(from.pointerId),pressTarget=_this.findMountedTarget(trackingData.pressTargetsByButton[from.button]),e=_this.createPointerEvent(from);if(pressTarget){for(var currentTarget=pressTarget;currentTarget;)e.currentTarget=currentTarget,_this.notifyTarget(e,"pointerupoutside"),"touch"===e.pointerType||"mouse"!==e.pointerType&&"pen"!==e.pointerType||_this.notifyTarget(e,2===e.button?"rightupoutside":"mouseupoutside"),Node.isNode(currentTarget)&&(currentTarget=currentTarget.parentNode);delete trackingData.pressTargetsByButton[from.button]}_this.freeEvent(e)},this.onWheel=function(from){var wheelEvent=_this.createWheelEvent(from);_this.dispatchEvent(wheelEvent),_this.freeEvent(wheelEvent)},this.onClick=function(from){if(_this.context.config.useNativeClickEvent){var e=_this.createPointerEvent(from);_this.dispatchEvent(e),_this.freeEvent(e)}},this.onPointerCancel=function(from){var e=_this.createPointerEvent(from,void 0,void 0,_this.context.config.alwaysTriggerPointerEventOnCanvas?_this.rootTarget:void 0);_this.dispatchEvent(e),_this.freeEvent(e)}}return EventService.prototype.init=function(){this.rootTarget=this.context.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointercancel",this.onPointerCancel),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel),this.addEventMapping("click",this.onClick)},EventService.prototype.destroy=function(){this.emitter.removeAllListeners(),this.mappingTable={},this.mappingState={},this.eventPool.clear()},EventService.prototype.client2Viewport=function(client){var bbox=this.context.contextService.getBoundingClientRect();return new Point(client.x-((null==bbox?void 0:bbox.left)||0),client.y-((null==bbox?void 0:bbox.top)||0))},EventService.prototype.viewport2Client=function(canvas){var bbox=this.context.contextService.getBoundingClientRect();return new Point(canvas.x+((null==bbox?void 0:bbox.left)||0),canvas.y+((null==bbox?void 0:bbox.top)||0))},EventService.prototype.viewport2Canvas=function(_a){var x=_a.x,y=_a.y,camera=this.rootTarget.defaultView.getCamera(),_b=this.context.config,width=_b.width,height=_b.height,projectionMatrixInverse=camera.getPerspectiveInverse(),worldMatrix=camera.getWorldTransform(),vpMatrix=mat4_multiply(this.tmpMatrix,worldMatrix,projectionMatrixInverse),viewport=set(this.tmpVec3,x/width*2-1,2*(1-y/height)-1,0);return transformMat4(viewport,viewport,vpMatrix),new Point(viewport[0],viewport[1])},EventService.prototype.canvas2Viewport=function(canvasP){var camera=this.rootTarget.defaultView.getCamera(),projectionMatrix=camera.getPerspective(),viewMatrix=camera.getViewTransform(),vpMatrix=mat4_multiply(this.tmpMatrix,projectionMatrix,viewMatrix),clip=set(this.tmpVec3,canvasP.x,canvasP.y,0);transformMat4(this.tmpVec3,this.tmpVec3,vpMatrix);var _a=this.context.config,width=_a.width,height=_a.height;return new Point((clip[0]+1)/2*width,(1-(clip[1]+1)/2)*height)},EventService.prototype.setPickHandler=function(pickHandler){this.pickHandler=pickHandler},EventService.prototype.addEventMapping=function(type,fn){this.mappingTable[type]||(this.mappingTable[type]=[]),this.mappingTable[type].push({fn,priority:0}),this.mappingTable[type].sort((function(a,b){return a.priority-b.priority}))},EventService.prototype.mapEvent=function(e){if(this.rootTarget){var mappers=this.mappingTable[e.type];if(mappers)for(var i=0,j=mappers.length;i<j;i++)mappers[i].fn(e);else console.warn("[EventService]: Event mapping not defined for ".concat(e.type))}},EventService.prototype.dispatchEvent=function(e,type,skipPropagate){if(skipPropagate){e.eventPhase=e.AT_TARGET;var canvas=this.rootTarget.defaultView||null;e.currentTarget=canvas,this.notifyListeners(e,type)}else e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,type);this.emitter.emit(type||e.type,e)},EventService.prototype.propagate=function(e,type){if(e.target){var composedPath=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(var i=composedPath.length-1;i>=1;i--)if(e.currentTarget=composedPath[i],this.notifyTarget(e,type),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,type),!e.propagationStopped&&!e.propagationImmediatelyStopped){var index=composedPath.indexOf(e.currentTarget);e.eventPhase=e.BUBBLING_PHASE;for(i=index+1;i<composedPath.length;i++)if(e.currentTarget=composedPath[i],this.notifyTarget(e,type),e.propagationStopped||e.propagationImmediatelyStopped)return}}},EventService.prototype.propagationPath=function(target){var propagationPath=[target],canvas=this.rootTarget.defaultView||null;if(canvas&&canvas===target)return propagationPath.unshift(canvas.document),propagationPath;for(var i=0;i<2048&&target!==this.rootTarget;i++)Node.isNode(target)&&target.parentNode&&(propagationPath.push(target.parentNode),target=target.parentNode);return canvas&&propagationPath.push(canvas),propagationPath},EventService.prototype.hitTest=function(position){var viewportX=position.viewportX,viewportY=position.viewportY,_a=this.context.config,width=_a.width,height=_a.height,disableHitTesting=_a.disableHitTesting;return viewportX<0||viewportY<0||viewportX>width||viewportY>height?null:!disableHitTesting&&this.pickHandler(position)||this.rootTarget||null},EventService.prototype.isNativeEventFromCanvas=function(event){var _a,$el=this.context.contextService.getDomElement(),target=null===(_a=event.nativeEvent)||void 0===_a?void 0:_a.target;if(target){if(target===$el)return!0;if($el&&$el.contains)return $el.contains(target)}return!!event.nativeEvent.composedPath&&event.nativeEvent.composedPath().indexOf($el)>-1},EventService.prototype.getExistedHTML=function(event){var e_1,_a;if(event.nativeEvent.composedPath)try{for(var _b=(0,tslib_es6.Ju)(event.nativeEvent.composedPath()),_c=_b.next();!_c.done;_c=_b.next()){var eventTarget=_c.value,existed=this.nativeHTMLMap.get(eventTarget);if(existed)return existed}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return null},EventService.prototype.pickTarget=function(event){return this.hitTest({clientX:event.clientX,clientY:event.clientY,viewportX:event.viewportX,viewportY:event.viewportY,x:event.canvasX,y:event.canvasY})},EventService.prototype.createPointerEvent=function(from,type,target,fallbackTarget){var event=this.allocateEvent(FederatedPointerEvent);this.copyPointerData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.nativeEvent=from.nativeEvent,event.originalEvent=from;var existedHTML=this.getExistedHTML(event);return event.target=null!=target?target:existedHTML||this.isNativeEventFromCanvas(event)&&this.pickTarget(event)||fallbackTarget,"string"==typeof type&&(event.type=type),event},EventService.prototype.createWheelEvent=function(from){var event=this.allocateEvent(FederatedWheelEvent);this.copyWheelData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.nativeEvent=from.nativeEvent,event.originalEvent=from;var existedHTML=this.getExistedHTML(event);return event.target=existedHTML||this.isNativeEventFromCanvas(event)&&this.pickTarget(event),event},EventService.prototype.trackingData=function(id){return this.mappingState.trackingData[id]||(this.mappingState.trackingData[id]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[id]},EventService.prototype.cloneWheelEvent=function(from){var event=this.allocateEvent(FederatedWheelEvent);return event.nativeEvent=from.nativeEvent,event.originalEvent=from.originalEvent,this.copyWheelData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.target=from.target,event.path=from.composedPath().slice(),event.type=from.type,event},EventService.prototype.clonePointerEvent=function(from,type){var event=this.allocateEvent(FederatedPointerEvent);return event.nativeEvent=from.nativeEvent,event.originalEvent=from.originalEvent,this.copyPointerData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.target=from.target,event.path=from.composedPath().slice(),event.type=null!=type?type:event.type,event},EventService.prototype.copyPointerData=function(from,to){to.pointerId=from.pointerId,to.width=from.width,to.height=from.height,to.isPrimary=from.isPrimary,to.pointerType=from.pointerType,to.pressure=from.pressure,to.tangentialPressure=from.tangentialPressure,to.tiltX=from.tiltX,to.tiltY=from.tiltY,to.twist=from.twist},EventService.prototype.copyMouseData=function(from,to){to.altKey=from.altKey,to.button=from.button,to.buttons=from.buttons,to.ctrlKey=from.ctrlKey,to.metaKey=from.metaKey,to.shiftKey=from.shiftKey,to.client.copyFrom(from.client),to.movement.copyFrom(from.movement),to.canvas.copyFrom(from.canvas),to.screen.copyFrom(from.screen),to.global.copyFrom(from.global),to.offset.copyFrom(from.offset)},EventService.prototype.copyWheelData=function(from,to){to.deltaMode=from.deltaMode,to.deltaX=from.deltaX,to.deltaY=from.deltaY,to.deltaZ=from.deltaZ},EventService.prototype.copyData=function(from,to){to.isTrusted=from.isTrusted,to.timeStamp=clock.now(),to.type=from.type,to.detail=from.detail,to.view=from.view,to.page.copyFrom(from.page),to.viewport.copyFrom(from.viewport)},EventService.prototype.allocateEvent=function(constructor){this.eventPool.has(constructor)||this.eventPool.set(constructor,[]);var event=this.eventPool.get(constructor).pop()||new constructor(this);return event.eventPhase=event.NONE,event.currentTarget=null,event.path=[],event.target=null,event},EventService.prototype.freeEvent=function(event){if(event.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var constructor=event.constructor;this.eventPool.has(constructor)||this.eventPool.set(constructor,[]),this.eventPool.get(constructor).push(event)},EventService.prototype.notifyTarget=function(e,type){type=null!=type?type:e.type;var key=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?"".concat(type,"capture"):type;this.notifyListeners(e,key),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,type)},EventService.prototype.notifyListeners=function(e,type){var emitter=e.currentTarget.emitter,listeners=emitter._events[type];if(listeners)if("fn"in listeners)listeners.once&&emitter.removeListener(type,listeners.fn,void 0,!0),listeners.fn.call(e.currentTarget||listeners.context,e);else for(var i=0;i<listeners.length&&!e.propagationImmediatelyStopped;i++)listeners[i].once&&emitter.removeListener(type,listeners[i].fn,void 0,!0),listeners[i].fn.call(e.currentTarget||listeners[i].context,e)},EventService.prototype.findMountedTarget=function(propagationPath){if(!propagationPath)return null;for(var currentTarget=propagationPath[propagationPath.length-1],i=propagationPath.length-2;i>=0;i--){var target=propagationPath[i];if(!(target===this.rootTarget||Node.isNode(target)&&target.parentNode===currentTarget))break;currentTarget=propagationPath[i]}return currentTarget},EventService.prototype.getCursor=function(target){for(var tmp=target;tmp;){var cursor=isElement(tmp)&&tmp.getAttribute("cursor");if(cursor)return cursor;tmp=Node.isNode(tmp)&&tmp.parentNode}},EventService}(),OffscreenCanvasCreator=function(){function OffscreenCanvasCreator(){}return OffscreenCanvasCreator.prototype.getOrCreateCanvas=function(offscreenCanvas,contextAttributes){if(this.canvas)return this.canvas;if(offscreenCanvas||runtime.offscreenCanvas)this.canvas=offscreenCanvas||runtime.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,tslib_es6.Cl)({willReadFrequently:!0},contextAttributes));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,tslib_es6.Cl)({willReadFrequently:!0},contextAttributes)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(ex){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,tslib_es6.Cl)({willReadFrequently:!0},contextAttributes))}return this.canvas.width=10,this.canvas.height=10,this.canvas},OffscreenCanvasCreator.prototype.getOrCreateContext=function(offscreenCanvas,contextAttributes){return this.context||this.getOrCreateCanvas(offscreenCanvas,contextAttributes),this.context},OffscreenCanvasCreator}();!function(RenderReason){RenderReason[RenderReason.CAMERA_CHANGED=0]="CAMERA_CHANGED",RenderReason[RenderReason.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",RenderReason[RenderReason.NONE=2]="NONE"}(RenderReason||(RenderReason={}));var ElementEvent,RenderingService=function(){function RenderingService(globalRuntime,context){this.globalRuntime=globalRuntime,this.context=context,this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.hooks={init:new SyncHook,initAsync:new AsyncParallelHook,dirtycheck:new SyncWaterfallHook,cull:new SyncWaterfallHook,beginFrame:new SyncHook,beforeRender:new SyncHook,render:new SyncHook,afterRender:new SyncHook,endFrame:new SyncHook,destroy:new SyncHook,pick:new AsyncSeriesWaterfallHook,pickSync:new SyncWaterfallHook,pointerDown:new SyncHook,pointerUp:new SyncHook,pointerMove:new SyncHook,pointerOut:new SyncHook,pointerOver:new SyncHook,pointerWheel:new SyncHook,pointerCancel:new SyncHook,click:new SyncHook}}return RenderingService.prototype.init=function(callback){var _this=this,context=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.globalRuntime),this.context);this.context.renderingPlugins.forEach((function(plugin){plugin.apply(context,_this.globalRuntime)})),this.hooks.init.call(),0===this.hooks.initAsync.getCallbacksNum()?(this.inited=!0,callback()):this.hooks.initAsync.promise().then((function(){_this.inited=!0,callback()}))},RenderingService.prototype.getStats=function(){return this.stats},RenderingService.prototype.disableDirtyRectangleRendering=function(){return!this.context.config.renderer.getConfig().enableDirtyRectangleRendering||this.context.renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED)},RenderingService.prototype.render=function(canvasConfig,rerenderCallback){var _this=this;this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0;var renderingContext=this.context.renderingContext;if(this.globalRuntime.sceneGraphService.syncHierarchy(renderingContext.root),this.globalRuntime.sceneGraphService.triggerPendingEvents(),renderingContext.renderReasons.size&&this.inited){renderingContext.dirtyRectangleRenderingDisabled=this.disableDirtyRectangleRendering();var onlyCameraChanged=1===renderingContext.renderReasons.size&&renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED),shouldTriggerRenderHooks=!canvasConfig.disableRenderHooks||!(canvasConfig.disableRenderHooks&&onlyCameraChanged);shouldTriggerRenderHooks&&this.renderDisplayObject(renderingContext.root,canvasConfig,renderingContext),this.hooks.beginFrame.call(),shouldTriggerRenderHooks&&renderingContext.renderListCurrentFrame.forEach((function(object){_this.hooks.beforeRender.call(object),_this.hooks.render.call(object),_this.hooks.afterRender.call(object)})),this.hooks.endFrame.call(),renderingContext.renderListCurrentFrame=[],renderingContext.renderReasons.clear(),rerenderCallback()}},RenderingService.prototype.renderDisplayObject=function(displayObject,canvasConfig,renderingContext){var _this=this,_a=canvasConfig.renderer.getConfig(),enableDirtyCheck=_a.enableDirtyCheck,enableCulling=_a.enableCulling;this.globalRuntime.enableCSSParsing&&this.globalRuntime.styleValueRegistry.recalc(displayObject);var renderable=displayObject.renderable,objectChanged=enableDirtyCheck?renderable.dirty||renderingContext.dirtyRectangleRenderingDisabled?displayObject:null:displayObject;if(objectChanged){var objectToRender=enableCulling?this.hooks.cull.call(objectChanged,this.context.camera):objectChanged;objectToRender&&(this.stats.rendered++,renderingContext.renderListCurrentFrame.push(objectToRender))}displayObject.renderable.dirty=!1,displayObject.sortable.renderOrder=this.zIndexCounter++,this.stats.total++;var sortable=displayObject.sortable;sortable.dirty&&(this.sort(displayObject,sortable),sortable.dirty=!1,sortable.dirtyChildren=[],sortable.dirtyReason=void 0),(sortable.sorted||displayObject.childNodes).forEach((function(child){_this.renderDisplayObject(child,canvasConfig,renderingContext)}))},RenderingService.prototype.sort=function(displayObject,sortable){sortable.sorted&&sortable.dirtyReason!==SortReason.Z_INDEX_CHANGED?sortable.dirtyChildren.forEach((function(child){if(-1===displayObject.childNodes.indexOf(child)){var index_1=sortable.sorted.indexOf(child);index_1>=0&&sortable.sorted.splice(index_1,1)}else if(0===sortable.sorted.length)sortable.sorted.push(child);else{var index_2=function sortedIndex(array,value){for(var low=0,high=array.length;low<high;){var mid=low+high>>>1;sortByZIndex(array[mid],value)<0?low=mid+1:high=mid}return low}(sortable.sorted,child);sortable.sorted.splice(index_2,0,child)}})):sortable.sorted=displayObject.childNodes.slice().sort(sortByZIndex)},RenderingService.prototype.destroy=function(){this.inited=!1,this.hooks.destroy.call(),this.globalRuntime.sceneGraphService.clearPendingEvents()},RenderingService.prototype.dirtify=function(){this.context.renderingContext.renderReasons.add(RenderReason.DISPLAY_OBJECT_CHANGED)},RenderingService}(),ATTRIBUTE_REGEXP=/\[\s*(.*)=(.*)\s*\]/,DefaultSceneGraphSelector=function(){function DefaultSceneGraphSelector(){}return DefaultSceneGraphSelector.prototype.selectOne=function(query,root){var _this=this;if(query.startsWith("."))return root.find((function(node){return((null==node?void 0:node.classList)||[]).indexOf(_this.getIdOrClassname(query))>-1}));if(query.startsWith("#"))return root.find((function(node){return node.id===_this.getIdOrClassname(query)}));if(query.startsWith("[")){var _a=this.getAttribute(query),name_1=_a.name,value_1=_a.value;return name_1?root.find((function(node){return root!==node&&("name"===name_1?node.name===value_1:_this.attributeToString(node,name_1)===value_1)})):null}return root.find((function(node){return root!==node&&node.nodeName===query}))},DefaultSceneGraphSelector.prototype.selectAll=function(query,root){var _this=this;if(query.startsWith("."))return root.findAll((function(node){return root!==node&&((null==node?void 0:node.classList)||[]).indexOf(_this.getIdOrClassname(query))>-1}));if(query.startsWith("#"))return root.findAll((function(node){return root!==node&&node.id===_this.getIdOrClassname(query)}));if(query.startsWith("[")){var _a=this.getAttribute(query),name_2=_a.name,value_2=_a.value;return name_2?root.findAll((function(node){return root!==node&&("name"===name_2?node.name===value_2:_this.attributeToString(node,name_2)===value_2)})):[]}return root.findAll((function(node){return root!==node&&node.nodeName===query}))},DefaultSceneGraphSelector.prototype.is=function(query,node){if(query.startsWith("."))return node.className===this.getIdOrClassname(query);if(query.startsWith("#"))return node.id===this.getIdOrClassname(query);if(query.startsWith("[")){var _a=this.getAttribute(query),name_3=_a.name,value=_a.value;return"name"===name_3?node.name===value:this.attributeToString(node,name_3)===value}return node.nodeName===query},DefaultSceneGraphSelector.prototype.getIdOrClassname=function(query){return query.substring(1)},DefaultSceneGraphSelector.prototype.getAttribute=function(query){var matches=query.match(ATTRIBUTE_REGEXP),name="",value="";return matches&&matches.length>2&&(name=matches[1].replace(/"/g,""),value=matches[2].replace(/"/g,"")),{name,value}},DefaultSceneGraphSelector.prototype.attributeToString=function(node,name){if(!node.getAttribute)return"";var value=node.getAttribute(name);return(0,is_nil.A)(value)?"":value.toString?value.toString():""},DefaultSceneGraphSelector}(),MutationEvent=function(_super){function MutationEvent(typeArg,relatedNode,prevValue,newValue,attrName,attrChange,prevParsedValue,newParsedValue){var _this=_super.call(this,null)||this;return _this.relatedNode=relatedNode,_this.prevValue=prevValue,_this.newValue=newValue,_this.attrName=attrName,_this.attrChange=attrChange,_this.prevParsedValue=prevParsedValue,_this.newParsedValue=newParsedValue,_this.type=typeArg,_this}return(0,tslib_es6.C6)(MutationEvent,_super),MutationEvent.ADDITION=2,MutationEvent.MODIFICATION=1,MutationEvent.REMOVAL=3,MutationEvent}(FederatedEvent);function markRenderableDirty(e){var renderable=e.renderable;renderable&&(renderable.renderBoundsDirty=!0,renderable.boundsDirty=!0)}!function(ElementEvent){ElementEvent.REPARENT="reparent",ElementEvent.DESTROY="destroy",ElementEvent.ATTR_MODIFIED="DOMAttrModified",ElementEvent.INSERTED="DOMNodeInserted",ElementEvent.REMOVED="removed",ElementEvent.MOUNTED="DOMNodeInsertedIntoDocument",ElementEvent.UNMOUNTED="DOMNodeRemovedFromDocument",ElementEvent.BOUNDS_CHANGED="bounds-changed",ElementEvent.CULLED="culled"}(ElementEvent||(ElementEvent={}));var reparentEvent=new MutationEvent(ElementEvent.REPARENT,null,"","","",0,"",""),DefaultSceneGraphService=function(){function DefaultSceneGraphService(runtime){var parentInvertRotation,rotation,invParentRot,parentInvertMatrix,tmpPosition,zeroVec3,tmpVec3,tr,_this=this;this.runtime=runtime,this.pendingEvents=[],this.boundsChangedEvent=new CustomEvent(ElementEvent.BOUNDS_CHANGED),this.rotate=(parentInvertRotation=quat_create(),function(element,degrees,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof degrees&&(degrees=fromValues(degrees,y,z));var transform=element.transformable;if(null!==element.parentNode&&element.parentNode.transformable){var rotation=quat_create();fromEuler(rotation,degrees[0],degrees[1],degrees[2]);var rot=_this.getRotation(element),parentRot=_this.getRotation(element.parentNode);quat_copy(parentInvertRotation,parentRot),quat_invert(parentInvertRotation,parentInvertRotation),quat_multiply(rotation,parentInvertRotation,rotation),quat_multiply(transform.localRotation,rotation,rot),quat_normalize(transform.localRotation,transform.localRotation),_this.dirtifyLocal(element,transform)}else _this.rotateLocal(element,degrees)}),this.rotateLocal=(rotation=quat_create(),function(element,degrees,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof degrees&&(degrees=fromValues(degrees,y,z));var transform=element.transformable;fromEuler(rotation,degrees[0],degrees[1],degrees[2]),quat_mul(transform.localRotation,transform.localRotation,rotation),_this.dirtifyLocal(element,transform)}),this.setEulerAngles=(invParentRot=quat_create(),function(element,degrees,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof degrees&&(degrees=fromValues(degrees,y,z));var transform=element.transformable;if(null!==element.parentNode&&element.parentNode.transformable){fromEuler(transform.localRotation,degrees[0],degrees[1],degrees[2]);var parentRotation=_this.getRotation(element.parentNode);quat_copy(invParentRot,quat_invert(quat_create(),parentRotation)),quat_mul(transform.localRotation,transform.localRotation,invParentRot),_this.dirtifyLocal(element,transform)}else _this.setLocalEulerAngles(element,degrees)}),this.translateLocal=function(element,translation,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof translation&&(translation=fromValues(translation,y,z));var transform=element.transformable;vec3_equals(translation,create())||(function transformQuat(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],x=a[0],y=a[1],z=a[2],uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x,uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx,w2=2*qw;return uvx*=w2,uvy*=w2,uvz*=w2,uuvx*=2,uuvy*=2,uuvz*=2,out[0]=x+uvx+uuvx,out[1]=y+uvy+uuvy,out[2]=z+uvz+uuvz,out}(translation,translation,transform.localRotation),add(transform.localPosition,transform.localPosition,translation),_this.dirtifyLocal(element,transform))},this.setPosition=(parentInvertMatrix=mat4_create(),tmpPosition=create(),function(element,position){var transform=element.transformable;if(tmpPosition[0]=position[0],tmpPosition[1]=position[1],tmpPosition[2]=position[2]||0,!vec3_equals(_this.getPosition(element),tmpPosition)){if(copy(transform.position,tmpPosition),null!==element.parentNode&&element.parentNode.transformable){var parentTransform=element.parentNode.transformable;mat4_copy(parentInvertMatrix,parentTransform.worldTransform),invert(parentInvertMatrix,parentInvertMatrix),transformMat4(transform.localPosition,tmpPosition,parentInvertMatrix)}else copy(transform.localPosition,tmpPosition);_this.dirtifyLocal(element,transform)}}),this.setLocalPosition=function(){var tmpPosition=create();return function(element,position){var transform=element.transformable;tmpPosition[0]=position[0],tmpPosition[1]=position[1],tmpPosition[2]=position[2]||0,vec3_equals(transform.localPosition,tmpPosition)||(copy(transform.localPosition,tmpPosition),_this.dirtifyLocal(element,transform))}}(),this.translate=(zeroVec3=create(),tmpVec3=create(),tr=create(),function(element,translation,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof translation&&(translation=set(tmpVec3,translation,y,z)),vec3_equals(translation,zeroVec3)||(add(tr,_this.getPosition(element),translation),_this.setPosition(element,tr))}),this.setRotation=function(){var parentInvertRotation=quat_create();return function(element,rotation,y,z,w){var transform=element.transformable;if("number"==typeof rotation&&(rotation=quat_fromValues(rotation,y,z,w)),null!==element.parentNode&&element.parentNode.transformable){var parentRot=_this.getRotation(element.parentNode);quat_copy(parentInvertRotation,parentRot),quat_invert(parentInvertRotation,parentInvertRotation),quat_multiply(transform.localRotation,parentInvertRotation,rotation),quat_normalize(transform.localRotation,transform.localRotation),_this.dirtifyLocal(element,transform)}else _this.setLocalRotation(element,rotation)}},this.displayObjectDependencyMap=new WeakMap,this.calcLocalTransform=function(){var tmpMat=mat4_create(),tmpPosition=create(),tmpQuat=quat_fromValues(0,0,0,1);return function(transform){if(0!==transform.localSkew[0]||0!==transform.localSkew[1]){if(fromRotationTranslationScaleOrigin(transform.localTransform,transform.localRotation,transform.localPosition,fromValues(1,1,1),transform.origin),0!==transform.localSkew[0]||0!==transform.localSkew[1]){var tmpMat4=identity(tmpMat);tmpMat4[4]=Math.tan(transform.localSkew[0]),tmpMat4[1]=Math.tan(transform.localSkew[1]),mat4_multiply(transform.localTransform,transform.localTransform,tmpMat4)}var scaling=fromRotationTranslationScaleOrigin(tmpMat,tmpQuat,tmpPosition,transform.localScale,transform.origin);mat4_multiply(transform.localTransform,transform.localTransform,scaling)}else fromRotationTranslationScaleOrigin(transform.localTransform,transform.localRotation,transform.localPosition,transform.localScale,transform.origin)}}()}return DefaultSceneGraphService.prototype.matches=function(query,root){return this.runtime.sceneGraphSelector.is(query,root)},DefaultSceneGraphService.prototype.querySelector=function(query,root){return this.runtime.sceneGraphSelector.selectOne(query,root)},DefaultSceneGraphService.prototype.querySelectorAll=function(query,root){return this.runtime.sceneGraphSelector.selectAll(query,root)},DefaultSceneGraphService.prototype.attach=function(child,parent,index){var _a,_b,detached=!1;child.parentNode&&(detached=child.parentNode!==parent,this.detach(child)),child.parentNode=parent,(0,is_nil.A)(index)?child.parentNode.childNodes.push(child):child.parentNode.childNodes.splice(index,0,child);var sortable=parent.sortable;((null===(_a=null==sortable?void 0:sortable.sorted)||void 0===_a?void 0:_a.length)||(null===(_b=child.style)||void 0===_b?void 0:_b.zIndex))&&(-1===sortable.dirtyChildren.indexOf(child)&&sortable.dirtyChildren.push(child),sortable.dirty=!0,sortable.dirtyReason=SortReason.ADDED);var transform=child.transformable;transform&&this.dirtifyWorld(child,transform),transform.frozen&&this.unfreezeParentToRoot(child),detached&&child.dispatchEvent(reparentEvent)},DefaultSceneGraphService.prototype.detach=function(child){var _a,_b;if(child.parentNode){var transform=child.transformable,sortable=child.parentNode.sortable;((null===(_a=null==sortable?void 0:sortable.sorted)||void 0===_a?void 0:_a.length)||(null===(_b=child.style)||void 0===_b?void 0:_b.zIndex))&&(-1===sortable.dirtyChildren.indexOf(child)&&sortable.dirtyChildren.push(child),sortable.dirty=!0,sortable.dirtyReason=SortReason.REMOVED);var index=child.parentNode.childNodes.indexOf(child);index>-1&&child.parentNode.childNodes.splice(index,1),transform&&this.dirtifyWorld(child,transform),child.parentNode=null}},DefaultSceneGraphService.prototype.getOrigin=function(element){return element.transformable.origin},DefaultSceneGraphService.prototype.setOrigin=function(element,origin,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof origin&&(origin=[origin,y,z]);var transform=element.transformable;if(origin[0]!==transform.origin[0]||origin[1]!==transform.origin[1]||origin[2]!==transform.origin[2]){var originVec=transform.origin;originVec[0]=origin[0],originVec[1]=origin[1],originVec[2]=origin[2]||0,this.dirtifyLocal(element,transform)}},DefaultSceneGraphService.prototype.setLocalEulerAngles=function(element,degrees,y,z){void 0===y&&(y=0),void 0===z&&(z=0),"number"==typeof degrees&&(degrees=fromValues(degrees,y,z));var transform=element.transformable;fromEuler(transform.localRotation,degrees[0],degrees[1],degrees[2]),this.dirtifyLocal(element,transform)},DefaultSceneGraphService.prototype.scaleLocal=function(element,scaling){var transform=element.transformable;multiply(transform.localScale,transform.localScale,fromValues(scaling[0],scaling[1],scaling[2]||1)),this.dirtifyLocal(element,transform)},DefaultSceneGraphService.prototype.setLocalScale=function(element,scaling){var transform=element.transformable,updatedScaling=fromValues(scaling[0],scaling[1],scaling[2]||transform.localScale[2]);vec3_equals(updatedScaling,transform.localScale)||(copy(transform.localScale,updatedScaling),this.dirtifyLocal(element,transform))},DefaultSceneGraphService.prototype.setLocalRotation=function(element,rotation,y,z,w){"number"==typeof rotation&&(rotation=quat_fromValues(rotation,y,z,w));var transform=element.transformable;quat_copy(transform.localRotation,rotation),this.dirtifyLocal(element,transform)},DefaultSceneGraphService.prototype.setLocalSkew=function(element,skew,y){"number"==typeof skew&&(skew=function vec2_fromValues(x,y){var out=new ARRAY_TYPE(2);return out[0]=x,out[1]=y,out}(skew,y));var transform=element.transformable;!function vec2_copy(out,a){return out[0]=a[0],out[1]=a[1],out}(transform.localSkew,skew),this.dirtifyLocal(element,transform)},DefaultSceneGraphService.prototype.dirtifyLocal=function(element,transform){transform.localDirtyFlag||(transform.localDirtyFlag=!0,transform.dirtyFlag||this.dirtifyWorld(element,transform))},DefaultSceneGraphService.prototype.dirtifyWorld=function(element,transform){transform.dirtyFlag||this.unfreezeParentToRoot(element),this.dirtifyWorldInternal(element,transform),this.dirtifyToRoot(element,!0)},DefaultSceneGraphService.prototype.triggerPendingEvents=function(){var _this=this,set=new Set,trigger=function(element,detail){element.isConnected&&!set.has(element.entity)&&(_this.boundsChangedEvent.detail=detail,_this.boundsChangedEvent.target=element,element.isMutationObserved?element.dispatchEvent(_this.boundsChangedEvent):element.ownerDocument.defaultView.dispatchEvent(_this.boundsChangedEvent,!0),set.add(element.entity))};this.pendingEvents.forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),element=_b[0],detail=_b[1];detail.affectChildren?element.forEach((function(e){trigger(e,detail)})):trigger(element,detail)})),this.clearPendingEvents(),set.clear()},DefaultSceneGraphService.prototype.clearPendingEvents=function(){this.pendingEvents=[]},DefaultSceneGraphService.prototype.dirtifyToRoot=function(element,affectChildren){void 0===affectChildren&&(affectChildren=!1);var p=element;for(p.renderable&&(p.renderable.dirty=!0);p;)markRenderableDirty(p),p=p.parentNode;affectChildren&&element.forEach((function(e){markRenderableDirty(e)})),this.informDependentDisplayObjects(element),this.pendingEvents.push([element,{affectChildren}])},DefaultSceneGraphService.prototype.updateDisplayObjectDependency=function(name,oldPath,newPath,object){if(oldPath&&oldPath!==newPath){var oldDependencyMap=this.displayObjectDependencyMap.get(oldPath);if(oldDependencyMap&&oldDependencyMap[name]){var index=oldDependencyMap[name].indexOf(object);oldDependencyMap[name].splice(index,1)}}if(newPath){var newDependencyMap=this.displayObjectDependencyMap.get(newPath);newDependencyMap||(this.displayObjectDependencyMap.set(newPath,{}),newDependencyMap=this.displayObjectDependencyMap.get(newPath)),newDependencyMap[name]||(newDependencyMap[name]=[]),newDependencyMap[name].push(object)}},DefaultSceneGraphService.prototype.informDependentDisplayObjects=function(object){var _this=this,dependencyMap=this.displayObjectDependencyMap.get(object);dependencyMap&&Object.keys(dependencyMap).forEach((function(name){dependencyMap[name].forEach((function(target){_this.dirtifyToRoot(target,!0),target.dispatchEvent(new MutationEvent(ElementEvent.ATTR_MODIFIED,target,_this,_this,name,MutationEvent.MODIFICATION,_this,_this)),target.isCustomElement&&target.isConnected&&target.attributeChangedCallback&&target.attributeChangedCallback(name,_this,_this)}))}))},DefaultSceneGraphService.prototype.getPosition=function(element){var transform=element.transformable;return getTranslation(transform.position,this.getWorldTransform(element,transform))},DefaultSceneGraphService.prototype.getRotation=function(element){var transform=element.transformable;return getRotation(transform.rotation,this.getWorldTransform(element,transform))},DefaultSceneGraphService.prototype.getScale=function(element){var transform=element.transformable;return getScaling(transform.scaling,this.getWorldTransform(element,transform))},DefaultSceneGraphService.prototype.getWorldTransform=function(element,transform){return void 0===transform&&(transform=element.transformable),transform.localDirtyFlag||transform.dirtyFlag?(element.parentNode&&element.parentNode.transformable&&this.getWorldTransform(element.parentNode),this.sync(element,transform),transform.worldTransform):transform.worldTransform},DefaultSceneGraphService.prototype.getLocalPosition=function(element){return element.transformable.localPosition},DefaultSceneGraphService.prototype.getLocalRotation=function(element){return element.transformable.localRotation},DefaultSceneGraphService.prototype.getLocalScale=function(element){return element.transformable.localScale},DefaultSceneGraphService.prototype.getLocalSkew=function(element){return element.transformable.localSkew},DefaultSceneGraphService.prototype.getLocalTransform=function(element){var transform=element.transformable;return transform.localDirtyFlag&&(this.calcLocalTransform(transform),transform.localDirtyFlag=!1),transform.localTransform},DefaultSceneGraphService.prototype.setLocalTransform=function(element,transform){var t=getTranslation(create(),transform),r=getRotation(quat_create(),transform),s=getScaling(create(),transform);this.setLocalScale(element,s),this.setLocalPosition(element,t),this.setLocalRotation(element,r)},DefaultSceneGraphService.prototype.resetLocalTransform=function(element){this.setLocalScale(element,[1,1,1]),this.setLocalPosition(element,[0,0,0]),this.setLocalEulerAngles(element,[0,0,0]),this.setLocalSkew(element,[0,0])},DefaultSceneGraphService.prototype.getTransformedGeometryBounds=function(element,render,existedAABB){void 0===render&&(render=!1);var bounds=this.getGeometryBounds(element,render);if(AABB.isEmpty(bounds))return null;var aabb=existedAABB||new AABB;return aabb.setFromTransformedAABB(bounds,this.getWorldTransform(element)),aabb},DefaultSceneGraphService.prototype.getGeometryBounds=function(element,render){void 0===render&&(render=!1);var geometry=element.geometry;return(render?geometry.renderBounds:geometry.contentBounds||null)||new AABB},DefaultSceneGraphService.prototype.getBounds=function(element,render){var _this=this;void 0===render&&(render=!1);var renderable=element.renderable;if(!renderable.boundsDirty&&!render&&renderable.bounds)return renderable.bounds;if(!renderable.renderBoundsDirty&&render&&renderable.renderBounds)return renderable.renderBounds;var existedAABB=render?renderable.renderBounds:renderable.bounds,aabb=this.getTransformedGeometryBounds(element,render,existedAABB);if(element.childNodes.forEach((function(child){var childBounds=_this.getBounds(child,render);childBounds&&(aabb?aabb.add(childBounds):(aabb=existedAABB||new AABB).update(childBounds.center,childBounds.halfExtents))})),render){var clipped=findClosestClipPathTarget(element);if(clipped){var clipPathBounds=clipped.parsedStyle.clipPath.getBounds(render);aabb?clipPathBounds&&(aabb=clipPathBounds.intersection(aabb)):aabb=clipPathBounds}}return aabb||(aabb=new AABB),aabb&&(render?renderable.renderBounds=aabb:renderable.bounds=aabb),render?renderable.renderBoundsDirty=!1:renderable.boundsDirty=!1,aabb},DefaultSceneGraphService.prototype.getLocalBounds=function(element){if(element.parentNode){var parentInvert=mat4_create();element.parentNode.transformable&&(parentInvert=invert(mat4_create(),this.getWorldTransform(element.parentNode)));var bounds=this.getBounds(element);if(!AABB.isEmpty(bounds)){var localBounds=new AABB;return localBounds.setFromTransformedAABB(bounds,parentInvert),localBounds}}return this.getBounds(element)},DefaultSceneGraphService.prototype.getBoundingClientRect=function(element){var _a,_b,aabb,bounds=this.getGeometryBounds(element);AABB.isEmpty(bounds)||(aabb=new AABB).setFromTransformedAABB(bounds,this.getWorldTransform(element));var bbox=null===(_b=null===(_a=element.ownerDocument)||void 0===_a?void 0:_a.defaultView)||void 0===_b?void 0:_b.getContextService().getBoundingClientRect();if(aabb){var _c=(0,tslib_es6.zs)(aabb.getMin(),2),left=_c[0],top_1=_c[1],_d=(0,tslib_es6.zs)(aabb.getMax(),2),right=_d[0],bottom=_d[1];return new Rectangle(left+((null==bbox?void 0:bbox.left)||0),top_1+((null==bbox?void 0:bbox.top)||0),right-left,bottom-top_1)}return new Rectangle((null==bbox?void 0:bbox.left)||0,(null==bbox?void 0:bbox.top)||0,0,0)},DefaultSceneGraphService.prototype.dirtifyWorldInternal=function(element,transform){var _this=this;if(!transform.dirtyFlag){transform.dirtyFlag=!0,transform.frozen=!1,element.childNodes.forEach((function(child){var childTransform=child.transformable;childTransform.dirtyFlag||_this.dirtifyWorldInternal(child,childTransform)}));var renderable=element.renderable;renderable&&(renderable.renderBoundsDirty=!0,renderable.boundsDirty=!0,renderable.dirty=!0)}},DefaultSceneGraphService.prototype.syncHierarchy=function(element){var transform=element.transformable;if(!transform.frozen){transform.frozen=!0,(transform.localDirtyFlag||transform.dirtyFlag)&&this.sync(element,transform);for(var children=element.childNodes,i=0;i<children.length;i++)this.syncHierarchy(children[i])}},DefaultSceneGraphService.prototype.sync=function(element,transform){if(transform.localDirtyFlag&&(this.calcLocalTransform(transform),transform.localDirtyFlag=!1),transform.dirtyFlag){var parent_1=element.parentNode,parentTransform=parent_1&&parent_1.transformable;null!==parent_1&&parentTransform?mat4_multiply(transform.worldTransform,parentTransform.worldTransform,transform.localTransform):mat4_copy(transform.worldTransform,transform.localTransform),transform.dirtyFlag=!1}},DefaultSceneGraphService.prototype.unfreezeParentToRoot=function(child){for(var p=child.parentNode;p;){var transform=p.transformable;transform&&(transform.frozen=!1),p=p.parentNode}},DefaultSceneGraphService}(),TEXT_METRICS={MetricsString:"|ÉqÅ",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},LATIN_REGEX=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,regexCannotStart=new RegExp("".concat(/[!%),.:;?\]}¢°·'""†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/.source,"|").concat(/[!),.:;?\]}¢·–—'"•"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/.source,"|").concat(/[)\]｝〕〉》」』】〙〗〟'"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/.source,"|").concat(/[!%),.:;?\]}¢°'"†‡℃〆〈《「『〕！％），．：；？］｝]/.source)),regexCannotEnd=new RegExp("".concat(/[$(£¥·'"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/.source,"|").concat(/[([{£¥'"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/.source,"|").concat(/[([｛〔〈《「『【〘〖〝'"｟«—...‥〳〴〵]/.source,"|").concat(/[$([{£¥'"々〇〉》」〔＄（［｛｠￥￦#]/.source)),TextService=function(){function TextService(runtime){var _this=this;this.runtime=runtime,this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(char,nextChar){return!_this.isBreakingSpace(nextChar)&&!(!char||!regexCannotEnd.exec(nextChar)&&!regexCannotStart.exec(char))},this.trimByKinsokuShorui=function(prev){var next=(0,tslib_es6.fX)([],(0,tslib_es6.zs)(prev),!1),prevLine=next[next.length-2];if(!prevLine)return prev;var lastChar=prevLine[prevLine.length-1];return next[next.length-2]=prevLine.slice(0,-1),next[next.length-1]=lastChar+next[next.length-1],next}}return TextService.prototype.measureFont=function(font,offscreenCanvas){if(this.fontMetricsCache[font])return this.fontMetricsCache[font];var properties={ascent:0,descent:0,fontSize:0},canvas=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas),context=this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas,{willReadFrequently:!0});context.font=font;var metricsString=TEXT_METRICS.MetricsString+TEXT_METRICS.BaselineSymbol,width=Math.ceil(context.measureText(metricsString).width),baseline=Math.ceil(context.measureText(TEXT_METRICS.BaselineSymbol).width),height=TEXT_METRICS.HeightMultiplier*baseline;baseline=baseline*TEXT_METRICS.BaselineMultiplier|0,canvas.width=width,canvas.height=height,context.fillStyle="#f00",context.fillRect(0,0,width,height),context.font=font,context.textBaseline="alphabetic",context.fillStyle="#000",context.fillText(metricsString,0,baseline);var imagedata=context.getImageData(0,0,width||1,height||1).data,pixels=imagedata.length,line=4*width,i=0,idx=0,stop=!1;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx+=line}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;--i){for(j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx-=line}return properties.descent=i-baseline,properties.fontSize=properties.ascent+properties.descent,this.fontMetricsCache[font]=properties,properties},TextService.prototype.measureText=function(text,parsedStyle,offscreenCanvas){var fontSize=parsedStyle.fontSize,wordWrap=parsedStyle.wordWrap,strokeHeight=parsedStyle.lineHeight,lineWidth=parsedStyle.lineWidth,textBaseline=parsedStyle.textBaseline,textAlign=parsedStyle.textAlign,letterSpacing=parsedStyle.letterSpacing,textPath=parsedStyle.textPath;parsedStyle.textPathSide,parsedStyle.textPathStartOffset;var _a=parsedStyle.leading,leading=void 0===_a?0:_a,font=function toFontString(attributes){for(var fontSize=attributes.fontSize,fontFamily=attributes.fontFamily,fontStyle=attributes.fontStyle,fontVariant=attributes.fontVariant,fontWeight=attributes.fontWeight,fontSizeString=(0,is_number.A)(fontSize)&&"".concat(fontSize,"px")||"16px",fontFamilies=fontFamily.split(","),i=fontFamilies.length-1;i>=0;i--){var fontFamily_1=fontFamilies[i].trim();!stringRegExp.test(fontFamily_1)&&genericFontFamilies.indexOf(fontFamily_1)<0&&(fontFamily_1='"'.concat(fontFamily_1,'"')),fontFamilies[i]=fontFamily_1}return"".concat(fontStyle," ").concat(fontVariant," ").concat(fontWeight," ").concat(fontSizeString," ").concat(fontFamilies.join(","))}(parsedStyle),fontProperties=this.measureFont(font,offscreenCanvas);0===fontProperties.fontSize&&(fontProperties.fontSize=fontSize,fontProperties.ascent=fontSize);var context=this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);context.font=font,parsedStyle.isOverflowing=!1;var lines=(wordWrap?this.wordWrap(text,parsedStyle,offscreenCanvas):text).split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length),maxLineWidth=0;if(!textPath){for(i=0;i<lines.length;i++){var lineWidth_1=context.measureText(lines[i]).width+(lines[i].length-1)*letterSpacing;lineWidths[i]=lineWidth_1,maxLineWidth=Math.max(maxLineWidth,lineWidth_1)}width=maxLineWidth+lineWidth;var lineHeight_1=strokeHeight||fontProperties.fontSize+lineWidth,height=Math.max(lineHeight_1,fontProperties.fontSize+lineWidth)+(lines.length-1)*(lineHeight_1+leading),offsetY_1=0;return"middle"===textBaseline?offsetY_1=-height/2:"bottom"===textBaseline||"alphabetic"===textBaseline||"ideographic"===textBaseline?offsetY_1=-height:"top"!==textBaseline&&"hanging"!==textBaseline||(offsetY_1=0),{font,width,height,lines,lineWidths,lineHeight:lineHeight_1+=leading,maxLineWidth,fontProperties,lineMetrics:lineWidths.map((function(width,i){var offsetX=0;return"center"===textAlign||"middle"===textAlign?offsetX-=width/2:"right"!==textAlign&&"end"!==textAlign||(offsetX-=width),new Rectangle(offsetX-lineWidth/2,offsetY_1+i*lineHeight_1,width+lineWidth,lineHeight_1)}))}}textPath.getTotalLength();for(var i=0;i<lines.length;i++)var width=context.measureText(lines[i]).width+(lines[i].length-1)*letterSpacing},TextService.prototype.setGraphemeOnPath=function(){},TextService.prototype.wordWrap=function(text,parsedStyle,offscreenCanvas){var _this=this,_a=parsedStyle.wordWrapWidth,wordWrapWidth=void 0===_a?0:_a,letterSpacing=parsedStyle.letterSpacing,_b=parsedStyle.maxLines,maxLines=void 0===_b?1/0:_b,textOverflow=parsedStyle.textOverflow,context=this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas),maxWidth=wordWrapWidth+letterSpacing,ellipsis="";"ellipsis"===textOverflow?ellipsis="...":textOverflow&&"clip"!==textOverflow&&(ellipsis=textOverflow);for(var lines=[],currentIndex=0,currentWidth=0,cache={},calcWidth=function(char){return _this.getFromCache(char,letterSpacing,cache,context)},ellipsisWidth=Array.from(ellipsis).reduce((function(prev,cur){return prev+calcWidth(cur)}),0),chars=Array.from(text),i=0;i<chars.length;i++){var char=chars[i],prevChar=text[i-1],nextChar=text[i+1],charWidth=calcWidth(char);if(this.isNewline(char)){if(++currentIndex>=maxLines){parsedStyle.isOverflowing=!0;break}currentWidth=0,lines[currentIndex]=""}else{if(currentWidth>0&&currentWidth+charWidth>maxWidth){if(currentIndex+1>=maxLines){if(parsedStyle.isOverflowing=!0,ellipsisWidth>0&&ellipsisWidth<=maxWidth){for(var currentLineLength=lines[currentIndex].length,lastLineWidth=0,lastLineIndex=currentLineLength,i_1=0;i_1<currentLineLength;i_1++){var width=calcWidth(lines[currentIndex][i_1]);if(lastLineWidth+width+ellipsisWidth>maxWidth){lastLineIndex=i_1;break}lastLineWidth+=width}lines[currentIndex]=(lines[currentIndex]||"").slice(0,lastLineIndex)+ellipsis}break}if(currentWidth=0,lines[++currentIndex]="",this.isBreakingSpace(char))continue;this.canBreakInLastChar(char)||(lines=this.trimToBreakable(lines),currentWidth=this.sumTextWidthByCache(lines[currentIndex]||"",cache)),this.shouldBreakByKinsokuShorui(char,nextChar)&&(lines=this.trimByKinsokuShorui(lines),currentWidth+=calcWidth(prevChar||""))}currentWidth+=charWidth,lines[currentIndex]=(lines[currentIndex]||"")+char}}return lines.join("\n")},TextService.prototype.isBreakingSpace=function(char){return"string"==typeof char&&TEXT_METRICS.BreakingSpaces.indexOf(char.charCodeAt(0))>=0},TextService.prototype.isNewline=function(char){return"string"==typeof char&&TEXT_METRICS.Newlines.indexOf(char.charCodeAt(0))>=0},TextService.prototype.trimToBreakable=function(prev){var next=(0,tslib_es6.fX)([],(0,tslib_es6.zs)(prev),!1),prevLine=next[next.length-2],index=this.findBreakableIndex(prevLine);if(-1===index||!prevLine)return next;var trimmedChar=prevLine.slice(index,index+1),trimFrom=index+1,trimTo=index+(this.isBreakingSpace(trimmedChar)?0:1);return next[next.length-1]+=prevLine.slice(trimFrom,prevLine.length),next[next.length-2]=prevLine.slice(0,trimTo),next},TextService.prototype.canBreakInLastChar=function(char){return!char||!LATIN_REGEX.test(char)},TextService.prototype.sumTextWidthByCache=function(text,cache){return text.split("").reduce((function(sum,c){if(!cache[c])throw Error("cannot count the word without cache");return sum+cache[c]}),0)},TextService.prototype.findBreakableIndex=function(line){for(var i=line.length-1;i>=0;i--)if(!LATIN_REGEX.test(line[i]))return i;return-1},TextService.prototype.getFromCache=function(key,letterSpacing,cache,context){var width=cache[key];if("number"!=typeof width){var spacing=key.length*letterSpacing;width=context.measureText(key).width+spacing,cache[key]=width}return width},TextService}(),runtime={},geometryUpdaterFactory=function(){var _a,rectUpdater=new RectUpdater,polylineUpdater=new PolylineUpdater;return(_a={})[Shape.CIRCLE]=new CircleUpdater,_a[Shape.ELLIPSE]=new EllipseUpdater,_a[Shape.RECT]=rectUpdater,_a[Shape.IMAGE]=rectUpdater,_a[Shape.GROUP]=rectUpdater,_a[Shape.LINE]=new LineUpdater,_a[Shape.TEXT]=new TextUpdater(runtime),_a[Shape.POLYLINE]=polylineUpdater,_a[Shape.POLYGON]=polylineUpdater,_a[Shape.PATH]=new PathUpdater,_a[Shape.HTML]=null,_a[Shape.MESH]=null,_a}(),CSSPropertySyntaxFactory=function(){var _a,color=new CSSPropertyColor,length=new CSSPropertyLengthOrPercentage;return(_a={})[PropertySyntax.PERCENTAGE]=null,_a[PropertySyntax.NUMBER]=new CSSPropertyNumber,_a[PropertySyntax.ANGLE]=new CSSPropertyAngle,_a[PropertySyntax.DEFINED_PATH]=new CSSPropertyClipPath,_a[PropertySyntax.PAINT]=color,_a[PropertySyntax.COLOR]=color,_a[PropertySyntax.FILTER]=new CSSPropertyFilter,_a[PropertySyntax.LENGTH]=length,_a[PropertySyntax.LENGTH_PERCENTAGE]=length,_a[PropertySyntax.LENGTH_PERCENTAGE_12]=new CSSPropertyLengthOrPercentage12,_a[PropertySyntax.LENGTH_PERCENTAGE_14]=new CSSPropertyLengthOrPercentage14,_a[PropertySyntax.COORDINATE]=new CSSPropertyLocalPosition,_a[PropertySyntax.OFFSET_DISTANCE]=new CSSPropertyOffsetDistance,_a[PropertySyntax.OPACITY_VALUE]=new CSSPropertyOpacity,_a[PropertySyntax.PATH]=new CSSPropertyPath,_a[PropertySyntax.LIST_OF_POINTS]=new CSSPropertyPoints,_a[PropertySyntax.SHADOW_BLUR]=new CSSPropertyShadowBlur,_a[PropertySyntax.TEXT]=new CSSPropertyText,_a[PropertySyntax.TEXT_TRANSFORM]=new CSSPropertyTextTransform,_a[PropertySyntax.TRANSFORM]=new CSSPropertyTransform,_a[PropertySyntax.TRANSFORM_ORIGIN]=new CSSPropertyTransformOrigin,_a[PropertySyntax.Z_INDEX]=new CSSPropertyZIndex,_a[PropertySyntax.MARKER]=new CSSPropertyMarker,_a}();runtime.CameraContribution=Camera,runtime.AnimationTimeline=null,runtime.EasingFunction=null,runtime.offscreenCanvasCreator=new OffscreenCanvasCreator,runtime.sceneGraphSelector=new DefaultSceneGraphSelector,runtime.sceneGraphService=new DefaultSceneGraphService(runtime),runtime.textService=new TextService(runtime),runtime.geometryUpdaterFactory=geometryUpdaterFactory,runtime.CSSPropertySyntaxFactory=CSSPropertySyntaxFactory,runtime.styleValueRegistry=new DefaultStyleValueRegistry(runtime),runtime.layoutRegistry=null,runtime.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:{},runtime.enableCSSParsing=!0,runtime.enableDataset=!1,runtime.enableStyleSyntax=!0;var entityCounter=0;var insertedEvent=new MutationEvent(ElementEvent.INSERTED,null,"","","",0,"",""),removedEvent=new MutationEvent(ElementEvent.REMOVED,null,"","","",0,"",""),destroyEvent=new CustomEvent(ElementEvent.DESTROY),Element=function(_super){function Element(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.entity=entityCounter++,_this.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},_this.cullable={strategy:Strategy.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},_this.transformable={dirtyFlag:!1,localDirtyFlag:!1,frozen:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},_this.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},_this.geometry={contentBounds:void 0,renderBounds:void 0},_this.rBushNode={aabb:void 0},_this.namespaceURI="g",_this.scrollLeft=0,_this.scrollTop=0,_this.clientTop=0,_this.clientLeft=0,_this.destroyed=!1,_this.style={},_this.computedStyle=runtime.enableCSSParsing?{anchor:unsetKeywordValue,opacity:unsetKeywordValue,fillOpacity:unsetKeywordValue,strokeOpacity:unsetKeywordValue,fill:unsetKeywordValue,stroke:unsetKeywordValue,transform:unsetKeywordValue,transformOrigin:unsetKeywordValue,visibility:unsetKeywordValue,pointerEvents:unsetKeywordValue,lineWidth:unsetKeywordValue,lineCap:unsetKeywordValue,lineJoin:unsetKeywordValue,increasedLineWidthForHitTesting:unsetKeywordValue,fontSize:unsetKeywordValue,fontFamily:unsetKeywordValue,fontStyle:unsetKeywordValue,fontWeight:unsetKeywordValue,fontVariant:unsetKeywordValue,textAlign:unsetKeywordValue,textBaseline:unsetKeywordValue,textTransform:unsetKeywordValue,zIndex:unsetKeywordValue,filter:unsetKeywordValue,shadowType:unsetKeywordValue}:null,_this.parsedStyle={},_this.attributes={},_this}return(0,tslib_es6.C6)(Element,_super),Object.defineProperty(Element.prototype,"className",{get:function(){return this.getAttribute("class")||""},set:function(className){this.setAttribute("class",className)},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"classList",{get:function(){return this.className.split(" ").filter((function(c){return""!==c}))},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"tagName",{get:function(){return this.nodeName},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"parentElement",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"nextSibling",{get:function(){if(this.parentNode){var index=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[index+1]||null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"previousSibling",{get:function(){if(this.parentNode){var index=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[index-1]||null}return null},enumerable:!1,configurable:!0}),Element.prototype.cloneNode=function(deep){throw new Error("Method not implemented.")},Element.prototype.appendChild=function(child,index){var _a;if(child.destroyed)throw new Error("Cannot append a destroyed element.");return runtime.sceneGraphService.attach(child,this,index),(null===(_a=this.ownerDocument)||void 0===_a?void 0:_a.defaultView)&&this.ownerDocument.defaultView.mountChildren(child),insertedEvent.relatedNode=this,child.dispatchEvent(insertedEvent),child},Element.prototype.insertBefore=function(newChild,refChild){if(refChild){newChild.parentElement&&newChild.parentElement.removeChild(newChild);var index=this.childNodes.indexOf(refChild);-1===index?this.appendChild(newChild):this.appendChild(newChild,index)}else this.appendChild(newChild);return newChild},Element.prototype.replaceChild=function(newChild,oldChild){var index=this.childNodes.indexOf(oldChild);return this.removeChild(oldChild),this.appendChild(newChild,index),oldChild},Element.prototype.removeChild=function(child){var _a;return removedEvent.relatedNode=this,child.dispatchEvent(removedEvent),(null===(_a=child.ownerDocument)||void 0===_a?void 0:_a.defaultView)&&child.ownerDocument.defaultView.unmountChildren(child),runtime.sceneGraphService.detach(child),child},Element.prototype.removeChildren=function(){for(var i=this.childNodes.length-1;i>=0;i--){var child=this.childNodes[i];this.removeChild(child)}},Element.prototype.destroyChildren=function(){for(var i=this.childNodes.length-1;i>=0;i--){var child=this.childNodes[i];child.childNodes.length&&child.destroyChildren(),child.destroy()}},Element.prototype.matches=function(selector){return runtime.sceneGraphService.matches(selector,this)},Element.prototype.getElementById=function(id){return runtime.sceneGraphService.querySelector("#".concat(id),this)},Element.prototype.getElementsByName=function(name){return runtime.sceneGraphService.querySelectorAll('[name="'.concat(name,'"]'),this)},Element.prototype.getElementsByClassName=function(className){return runtime.sceneGraphService.querySelectorAll(".".concat(className),this)},Element.prototype.getElementsByTagName=function(tagName){return runtime.sceneGraphService.querySelectorAll(tagName,this)},Element.prototype.querySelector=function(selectors){return runtime.sceneGraphService.querySelector(selectors,this)},Element.prototype.querySelectorAll=function(selectors){return runtime.sceneGraphService.querySelectorAll(selectors,this)},Element.prototype.closest=function(selectors){var el=this;do{if(runtime.sceneGraphService.matches(selectors,el))return el;el=el.parentElement}while(null!==el);return null},Element.prototype.find=function(filter){var _this=this,target=null;return this.forEach((function(object){return!(object===_this||!filter(object))&&(target=object,!0)})),target},Element.prototype.findAll=function(filter){var _this=this,objects=[];return this.forEach((function(object){object!==_this&&filter(object)&&objects.push(object)})),objects},Element.prototype.after=function(){for(var _this=this,nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];if(this.parentNode){var index_1=this.parentNode.childNodes.indexOf(this);nodes.forEach((function(node,i){var _a;return null===(_a=_this.parentNode)||void 0===_a?void 0:_a.appendChild(node,index_1+i+1)}))}},Element.prototype.before=function(){for(var _a,nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];if(this.parentNode){var index=this.parentNode.childNodes.indexOf(this),_b=(0,tslib_es6.zs)(nodes),first=_b[0],rest=_b.slice(1);this.parentNode.appendChild(first,index),(_a=first).after.apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(rest),!1))}},Element.prototype.replaceWith=function(){for(var nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];this.after.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(nodes),!1)),this.remove()},Element.prototype.append=function(){for(var _this=this,nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];nodes.forEach((function(node){return _this.appendChild(node)}))},Element.prototype.prepend=function(){for(var _this=this,nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];nodes.forEach((function(node,i){return _this.appendChild(node,i)}))},Element.prototype.replaceChildren=function(){for(var nodes=[],_i=0;_i<arguments.length;_i++)nodes[_i]=arguments[_i];for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(nodes),!1))},Element.prototype.remove=function(){return this.parentNode?this.parentNode.removeChild(this):this},Element.prototype.destroy=function(){this.dispatchEvent(destroyEvent),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0},Element.prototype.getGeometryBounds=function(){return runtime.sceneGraphService.getGeometryBounds(this)},Element.prototype.getRenderBounds=function(){return runtime.sceneGraphService.getBounds(this,!0)},Element.prototype.getBounds=function(){return runtime.sceneGraphService.getBounds(this)},Element.prototype.getLocalBounds=function(){return runtime.sceneGraphService.getLocalBounds(this)},Element.prototype.getBoundingClientRect=function(){return runtime.sceneGraphService.getBoundingClientRect(this)},Element.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},Element.prototype.computedStyleMap=function(){return new Map(Object.entries(this.computedStyle))},Element.prototype.getAttributeNames=function(){return Object.keys(this.attributes)},Element.prototype.getAttribute=function(name){if(function isSymbol(value){return"symbol"==typeof value}(name))return runtime.enableCSSParsing?null:void 0;var value=this.attributes[name];if(void 0===value){var attributeName=formatAttributeName(name);return value=this.attributes[attributeName],runtime.enableCSSParsing&&(0,is_nil.A)(value)?null:value}return value},Element.prototype.hasAttribute=function(qualifiedName){return this.getAttributeNames().includes(qualifiedName)},Element.prototype.hasAttributes=function(){return!!this.getAttributeNames().length},Element.prototype.removeAttribute=function(attributeName){this.setAttribute(attributeName,null),delete this.attributes[attributeName]},Element.prototype.setAttribute=function(attributeName,value,force){this.attributes[attributeName]=value},Element.prototype.getAttributeNS=function(namespace,localName){throw new Error("Method not implemented.")},Element.prototype.getAttributeNode=function(qualifiedName){throw new Error("Method not implemented.")},Element.prototype.getAttributeNodeNS=function(namespace,localName){throw new Error("Method not implemented.")},Element.prototype.hasAttributeNS=function(namespace,localName){throw new Error("Method not implemented.")},Element.prototype.removeAttributeNS=function(namespace,localName){throw new Error("Method not implemented.")},Element.prototype.removeAttributeNode=function(attr){throw new Error("Method not implemented.")},Element.prototype.setAttributeNS=function(namespace,qualifiedName,value){throw new Error("Method not implemented.")},Element.prototype.setAttributeNode=function(attr){throw new Error("Method not implemented.")},Element.prototype.setAttributeNodeNS=function(attr){throw new Error("Method not implemented.")},Element.prototype.toggleAttribute=function(qualifiedName,force){throw new Error("Method not implemented.")},Element}(Node);function isDisplayObject(value){return!!(null==value?void 0:value.nodeName)}var CanvasEvent,mutationEvent=new MutationEvent(ElementEvent.ATTR_MODIFIED,null,null,null,null,MutationEvent.MODIFICATION,null,null),DEFAULT_STYLE_PROPS={anchor:"",opacity:"",fillOpacity:"",strokeOpacity:"",fill:"",stroke:"",transform:"",transformOrigin:"",visibility:"",pointerEvents:"",lineWidth:"",lineCap:"",lineJoin:"",increasedLineWidthForHitTesting:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",zIndex:"",filter:"",shadowType:""},DEFAULT_PARSED_STYLE_PROPS={anchor:[0,0],fill:noneColor,stroke:noneColor,transform:[],zIndex:0,filter:[],shadowType:"outer",miterLimit:10},DEFAULT_PARSED_STYLE_PROPS_CSS_DISABLED=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},DEFAULT_PARSED_STYLE_PROPS),{opacity:1,fillOpacity:1,strokeOpacity:1,visibility:"visible",pointerEvents:"auto",lineWidth:1,lineCap:"butt",lineJoin:"miter",increasedLineWidthForHitTesting:0,fillRule:"nonzero"}),INHERITABLE_STYLE_PROPS=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(["opacity","fillOpacity","strokeOpacity","transformOrigin","visibility","pointerEvents","lineWidth","lineCap","lineJoin","increasedLineWidthForHitTesting"]),!1),["fontSize","fontFamily","fontStyle","fontWeight","fontVariant","textAlign","textBaseline","textTransform"],!1),DisplayObject=function(_super){function DisplayObject(config){var _a,_this=_super.call(this)||this;_this.isCustomElement=!1,_this.isMutationObserved=!1,_this.activeAnimations=[],_this.getClip=function(){return this.style.clipPath||null},_this.config=config,_this.config.interactive=null!==(_a=_this.config.capture)&&void 0!==_a?_a:_this.config.interactive,_this.id=_this.config.id||"",_this.name=_this.config.name||"",(_this.config.className||_this.config.class)&&(_this.className=_this.config.className||_this.config.class),_this.nodeName=_this.config.type||Shape.GROUP,_this.config.style=_this.config.style||_this.config.attrs||{},Object.assign(_this.config.style,_this.config.attrs),null!=_this.config.visible&&(_this.config.style.visibility=!1===_this.config.visible?"hidden":"visible"),null!=_this.config.interactive&&(_this.config.style.pointerEvents=!1===_this.config.interactive?"none":"auto"),Object.assign(_this.parsedStyle,runtime.enableCSSParsing?DEFAULT_PARSED_STYLE_PROPS:DEFAULT_PARSED_STYLE_PROPS_CSS_DISABLED,_this.config.initialParsedStyle),runtime.enableCSSParsing&&Object.assign(_this.attributes,DEFAULT_STYLE_PROPS),_this.initAttributes(_this.config.style);var Proxy=runtime.globalThis.Proxy?runtime.globalThis.Proxy:function(){};return runtime.enableDataset&&(_this.dataset=new Proxy({},{get:function(target,name){var formattedName="".concat("data-").concat(kebabize(name));return void 0!==target[formattedName]?target[formattedName]:_this.getAttribute(formattedName)},set:function(_,prop,value){return _this.setAttribute("".concat("data-").concat(kebabize(prop)),value),!0}})),runtime.enableStyleSyntax&&(_this.style=new Proxy({setProperty:function(propertyName,value){_this.setAttribute(propertyName,value)},getPropertyValue:function(propertyName){return _this.getAttribute(propertyName)},removeProperty:function(propertyName){_this.removeAttribute(propertyName)},item:function(){return""}},{get:function(target,name){return void 0!==target[name]?target[name]:_this.getAttribute(name)},set:function(_,prop,value){return _this.setAttribute(prop,value),!0}})),_this}return(0,tslib_es6.C6)(DisplayObject,_super),DisplayObject.prototype.destroy=function(){_super.prototype.destroy.call(this),this.getAnimations().forEach((function(animation){animation.cancel()}))},DisplayObject.prototype.cloneNode=function(deep,customCloneFunc){var clonedStyle=(0,tslib_es6.Cl)({},this.attributes);for(var attributeName in clonedStyle){var attribute=clonedStyle[attributeName];isDisplayObject(attribute)&&"clipPath"!==attributeName&&"offsetPath"!==attributeName&&"textPath"!==attributeName&&(clonedStyle[attributeName]=attribute.cloneNode(deep)),customCloneFunc&&(clonedStyle[attributeName]=customCloneFunc(attributeName,attribute))}var cloned=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:clonedStyle});return cloned.setLocalTransform(this.getLocalTransform()),deep&&this.children.forEach((function(child){if(!child.style.isMarker){var clonedChild=child.cloneNode(deep);cloned.appendChild(clonedChild)}})),cloned},DisplayObject.prototype.initAttributes=function(attributes){void 0===attributes&&(attributes={});var renderable=this.renderable,options={forceUpdateGeometry:!0};runtime.enableCSSParsing&&(options.usedAttributes=INHERITABLE_STYLE_PROPS);var formattedAttributes={};for(var name_1 in attributes){formattedAttributes[formatAttributeName(name_1)]=attributes[name_1]}runtime.styleValueRegistry.processProperties(this,formattedAttributes,options),renderable.dirty=!0},DisplayObject.prototype.setAttribute=function(name,value,force,memoize){void 0===force&&(force=!1),void 0===memoize&&(memoize=!0);var attributeName=formatAttributeName(name);is_undefined(value)||(force||value!==this.attributes[attributeName])&&(this.internalSetAttribute(attributeName,value,{memoize}),_super.prototype.setAttribute.call(this,attributeName,value))},DisplayObject.prototype.internalSetAttribute=function(name,value,parseOptions){var _a;void 0===parseOptions&&(parseOptions={});var renderable=this.renderable,oldValue=this.attributes[name],oldParsedValue=this.parsedStyle[name];runtime.styleValueRegistry.processProperties(this,((_a={})[name]=value,_a),parseOptions),renderable.dirty=!0;var newParsedValue=this.parsedStyle[name];this.isConnected&&(mutationEvent.relatedNode=this,mutationEvent.prevValue=oldValue,mutationEvent.newValue=value,mutationEvent.attrName=name,mutationEvent.prevParsedValue=oldParsedValue,mutationEvent.newParsedValue=newParsedValue,this.isMutationObserved?this.dispatchEvent(mutationEvent):(mutationEvent.target=this,this.ownerDocument.defaultView.dispatchEvent(mutationEvent,!0))),(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&this.attributeChangedCallback&&this.attributeChangedCallback(name,oldValue,value,oldParsedValue,newParsedValue)},DisplayObject.prototype.getBBox=function(){var aabb=this.getBounds(),_a=(0,tslib_es6.zs)(aabb.getMin(),2),left=_a[0],top=_a[1],_b=(0,tslib_es6.zs)(aabb.getMax(),2),right=_b[0],bottom=_b[1];return new Rectangle(left,top,right-left,bottom-top)},DisplayObject.prototype.setOrigin=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),runtime.sceneGraphService.setOrigin(this,createVec3(position,y,z)),this},DisplayObject.prototype.getOrigin=function(){return runtime.sceneGraphService.getOrigin(this)},DisplayObject.prototype.setPosition=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),runtime.sceneGraphService.setPosition(this,createVec3(position,y,z)),this},DisplayObject.prototype.setLocalPosition=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),runtime.sceneGraphService.setLocalPosition(this,createVec3(position,y,z)),this},DisplayObject.prototype.translate=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),runtime.sceneGraphService.translate(this,createVec3(position,y,z)),this},DisplayObject.prototype.translateLocal=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),runtime.sceneGraphService.translateLocal(this,createVec3(position,y,z)),this},DisplayObject.prototype.getPosition=function(){return runtime.sceneGraphService.getPosition(this)},DisplayObject.prototype.getLocalPosition=function(){return runtime.sceneGraphService.getLocalPosition(this)},DisplayObject.prototype.scale=function(scaling,y,z){return this.scaleLocal(scaling,y,z)},DisplayObject.prototype.scaleLocal=function(scaling,y,z){return"number"==typeof scaling&&(scaling=createVec3(scaling,y=y||scaling,z=z||scaling)),runtime.sceneGraphService.scaleLocal(this,scaling),this},DisplayObject.prototype.setLocalScale=function(scaling,y,z){return"number"==typeof scaling&&(scaling=createVec3(scaling,y=y||scaling,z=z||scaling)),runtime.sceneGraphService.setLocalScale(this,scaling),this},DisplayObject.prototype.getLocalScale=function(){return runtime.sceneGraphService.getLocalScale(this)},DisplayObject.prototype.getScale=function(){return runtime.sceneGraphService.getScale(this)},DisplayObject.prototype.getEulerAngles=function(){return rad2deg((0,tslib_es6.zs)(getEuler(create(),runtime.sceneGraphService.getWorldTransform(this)),3)[2])},DisplayObject.prototype.getLocalEulerAngles=function(){return rad2deg((0,tslib_es6.zs)(getEuler(create(),runtime.sceneGraphService.getLocalRotation(this)),3)[2])},DisplayObject.prototype.setEulerAngles=function(z){return runtime.sceneGraphService.setEulerAngles(this,0,0,z),this},DisplayObject.prototype.setLocalEulerAngles=function(z){return runtime.sceneGraphService.setLocalEulerAngles(this,0,0,z),this},DisplayObject.prototype.rotateLocal=function(x,y,z){return(0,is_nil.A)(y)&&(0,is_nil.A)(z)?runtime.sceneGraphService.rotateLocal(this,0,0,x):runtime.sceneGraphService.rotateLocal(this,x,y,z),this},DisplayObject.prototype.rotate=function(x,y,z){return(0,is_nil.A)(y)&&(0,is_nil.A)(z)?runtime.sceneGraphService.rotate(this,0,0,x):runtime.sceneGraphService.rotate(this,x,y,z),this},DisplayObject.prototype.setRotation=function(rotation,y,z,w){return runtime.sceneGraphService.setRotation(this,rotation,y,z,w),this},DisplayObject.prototype.setLocalRotation=function(rotation,y,z,w){return runtime.sceneGraphService.setLocalRotation(this,rotation,y,z,w),this},DisplayObject.prototype.setLocalSkew=function(skew,y){return runtime.sceneGraphService.setLocalSkew(this,skew,y),this},DisplayObject.prototype.getRotation=function(){return runtime.sceneGraphService.getRotation(this)},DisplayObject.prototype.getLocalRotation=function(){return runtime.sceneGraphService.getLocalRotation(this)},DisplayObject.prototype.getLocalSkew=function(){return runtime.sceneGraphService.getLocalSkew(this)},DisplayObject.prototype.getLocalTransform=function(){return runtime.sceneGraphService.getLocalTransform(this)},DisplayObject.prototype.getWorldTransform=function(){return runtime.sceneGraphService.getWorldTransform(this)},DisplayObject.prototype.setLocalTransform=function(transform){return runtime.sceneGraphService.setLocalTransform(this,transform),this},DisplayObject.prototype.resetLocalTransform=function(){runtime.sceneGraphService.resetLocalTransform(this)},DisplayObject.prototype.getAnimations=function(){return this.activeAnimations},DisplayObject.prototype.animate=function(keyframes,options){var _a,timeline=null===(_a=this.ownerDocument)||void 0===_a?void 0:_a.timeline;return timeline?timeline.play(this,keyframes,options):null},DisplayObject.prototype.isVisible=function(){var _a;return"visible"===(null===(_a=this.parsedStyle)||void 0===_a?void 0:_a.visibility)},Object.defineProperty(DisplayObject.prototype,"interactive",{get:function(){return this.isInteractive()},set:function(b){this.style.pointerEvents=b?"auto":"none"},enumerable:!1,configurable:!0}),DisplayObject.prototype.isInteractive=function(){var _a;return"none"!==(null===(_a=this.parsedStyle)||void 0===_a?void 0:_a.pointerEvents)},DisplayObject.prototype.isCulled=function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)},DisplayObject.prototype.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(this.parentNode.children.map((function(child){return Number(child.style.zIndex)}))),!1))+1),this},DisplayObject.prototype.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(this.parentNode.children.map((function(child){return Number(child.style.zIndex)}))),!1))-1),this},DisplayObject.prototype.getConfig=function(){return this.config},DisplayObject.prototype.attr=function(){for(var _this=this,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var _a=(0,tslib_es6.zs)(args,2),name=_a[0],value=_a[1];return name?(0,is_object.A)(name)?(Object.keys(name).forEach((function(key){_this.setAttribute(key,name[key])})),this):2===args.length?(this.setAttribute(name,value),this):this.attributes[name]:this.attributes},DisplayObject.prototype.getMatrix=function(transformMat4){var transform=transformMat4||this.getWorldTransform(),_a=(0,tslib_es6.zs)(getTranslation(create(),transform),2),tx=_a[0],ty=_a[1],_b=(0,tslib_es6.zs)(getScaling(create(),transform),2),sx=_b[0],sy=_b[1],rotation=getRotation(quat_create(),transform),_c=(0,tslib_es6.zs)(getEuler(create(),rotation),3),eux=_c[0],euz=_c[2];return index_esm_fromRotationTranslationScale(eux||euz,tx,ty,sx,sy)},DisplayObject.prototype.getLocalMatrix=function(){return this.getMatrix(this.getLocalTransform())},DisplayObject.prototype.setMatrix=function(mat){var _a=(0,tslib_es6.zs)(decompose(mat),5),tx=_a[0],ty=_a[1],scalingX=_a[2],scalingY=_a[3],angle=_a[4];this.setEulerAngles(angle).setPosition(tx,ty).setLocalScale(scalingX,scalingY)},DisplayObject.prototype.setLocalMatrix=function(mat){var _a=(0,tslib_es6.zs)(decompose(mat),5),tx=_a[0],ty=_a[1],scalingX=_a[2],scalingY=_a[3],angle=_a[4];this.setLocalEulerAngles(angle).setLocalPosition(tx,ty).setLocalScale(scalingX,scalingY)},DisplayObject.prototype.show=function(){runtime.enableCSSParsing?this.style.visibility="visible":this.forEach((function(object){object.style.visibility="visible"}))},DisplayObject.prototype.hide=function(){runtime.enableCSSParsing?this.style.visibility="hidden":this.forEach((function(object){object.style.visibility="hidden"}))},DisplayObject.prototype.getCount=function(){return this.childElementCount},DisplayObject.prototype.getParent=function(){return this.parentElement},DisplayObject.prototype.getChildren=function(){return this.children},DisplayObject.prototype.getFirst=function(){return this.firstElementChild},DisplayObject.prototype.getLast=function(){return this.lastElementChild},DisplayObject.prototype.getChildByIndex=function(index){return this.children[index]||null},DisplayObject.prototype.add=function(child,index){return this.appendChild(child,index)},DisplayObject.prototype.setClip=function(clipPath){this.style.clipPath=clipPath},DisplayObject.prototype.set=function(name,value){this.config[name]=value},DisplayObject.prototype.get=function(name){return this.config[name]},DisplayObject.prototype.moveTo=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),this.setPosition(position,y,z),this},DisplayObject.prototype.move=function(position,y,z){return void 0===y&&(y=0),void 0===z&&(z=0),this.setPosition(position,y,z),this},DisplayObject.prototype.setZIndex=function(zIndex){return this.style.zIndex=zIndex,this},DisplayObject}(Element),Circle=function(_super){function Circle(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.CIRCLE,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({cx:"",cy:"",r:""},style):(0,tslib_es6.Cl)({},style),initialParsedStyle:{anchor:[.5,.5],transformOrigin:runtime.enableCSSParsing?null:[PECENTAGE_50,PECENTAGE_50]}},rest))||this}return(0,tslib_es6.C6)(Circle,_super),Circle}(DisplayObject),CustomElement=function(_super){function CustomElement(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,(0,tslib_es6.Cl)({style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:""},style):(0,tslib_es6.Cl)({},style)},rest))||this).isCustomElement=!0,_this}return(0,tslib_es6.C6)(CustomElement,_super),CustomElement}(DisplayObject),Ellipse=function(_super){function Ellipse(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.ELLIPSE,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({cx:"",cy:"",rx:"",ry:""},style):(0,tslib_es6.Cl)({},style),initialParsedStyle:{anchor:[.5,.5],transformOrigin:runtime.enableCSSParsing?null:[PECENTAGE_50,PECENTAGE_50]}},rest))||this}return(0,tslib_es6.C6)(Ellipse,_super),Ellipse}(DisplayObject),Group=function(_super){function Group(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.GROUP,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:"",width:"",height:""},style):(0,tslib_es6.Cl)({},style)},rest))||this}return(0,tslib_es6.C6)(Group,_super),Group}(DisplayObject),HTML=function(_super){function HTML(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,(0,tslib_es6.Cl)({type:Shape.HTML,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:"",width:"auto",height:"auto",innerHTML:""},style):(0,tslib_es6.Cl)({},style)},rest))||this).cullable.enable=!1,_this}return(0,tslib_es6.C6)(HTML,_super),HTML.prototype.getDomElement=function(){return this.parsedStyle.$el},HTML.prototype.getBoundingClientRect=function(){if(this.parsedStyle.$el)return this.parsedStyle.$el.getBoundingClientRect();var _a=this.parsedStyle,x=_a.x,y=_a.y,width=_a.width,height=_a.height;return new Rectangle(x,y,width,height)},HTML.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},HTML.prototype.getBounds=function(){var _a,_b,clientRect=this.getBoundingClientRect(),canvasRect=null===(_b=null===(_a=this.ownerDocument)||void 0===_a?void 0:_a.defaultView)||void 0===_b?void 0:_b.getContextService().getBoundingClientRect(),aabb=new AABB,minX=clientRect.left-((null==canvasRect?void 0:canvasRect.left)||0),minY=clientRect.top-((null==canvasRect?void 0:canvasRect.top)||0);return aabb.setMinMax([minX,minY,0],[minX+clientRect.width,minY+clientRect.height,0]),aabb},HTML.prototype.getLocalBounds=function(){if(this.parentNode){var parentInvert=invert(mat4_create(),this.parentNode.getWorldTransform()),bounds=this.getBounds();if(!AABB.isEmpty(bounds)){var localBounds=new AABB;return localBounds.setFromTransformedAABB(bounds,parentInvert),localBounds}}return this.getBounds()},HTML}(DisplayObject),index_esm_Image=function(_super){function Image(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.IMAGE,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:"",img:"",width:"",height:""},style):(0,tslib_es6.Cl)({},style)},rest))||this}return(0,tslib_es6.C6)(Image,_super),Image}(DisplayObject),Line=function(_super){function Line(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);(_this=_super.call(this,(0,tslib_es6.Cl)({type:Shape.LINE,style:(0,tslib_es6.Cl)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},style)},rest))||this).markerStartAngle=0,_this.markerEndAngle=0;var _b=_this.parsedStyle,markerStart=_b.markerStart,markerEnd=_b.markerEnd;return markerStart&&isDisplayObject(markerStart)&&(_this.markerStartAngle=markerStart.getLocalEulerAngles(),_this.appendChild(markerStart)),markerEnd&&isDisplayObject(markerEnd)&&(_this.markerEndAngle=markerEnd.getLocalEulerAngles(),_this.appendChild(markerEnd)),_this.transformMarker(!0),_this.transformMarker(!1),_this}return(0,tslib_es6.C6)(Line,_super),Line.prototype.attributeChangedCallback=function(attrName,oldValue,newValue,prevParsedValue,newParsedValue){"x1"===attrName||"y1"===attrName||"x2"===attrName||"y2"===attrName||"markerStartOffset"===attrName||"markerEndOffset"===attrName?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===attrName?(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerStartAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerStartAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!0))):"markerEnd"===attrName&&(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerEndAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerEndAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!1)))},Line.prototype.transformMarker=function(isStart){var _a=this.parsedStyle,markerStart=_a.markerStart,markerEnd=_a.markerEnd,markerStartOffset=_a.markerStartOffset,markerEndOffset=_a.markerEndOffset,x1=_a.x1,x2=_a.x2,y1=_a.y1,y2=_a.y2,defX=_a.defX,defY=_a.defY,marker=isStart?markerStart:markerEnd;if(marker&&isDisplayObject(marker)){var rad,x,y,ox,oy,offset,originalAngle;isStart?(ox=x1-defX,oy=y1-defY,x=x2-x1,y=y2-y1,offset=markerStartOffset||0,originalAngle=this.markerStartAngle):(ox=x2-defX,oy=y2-defY,x=x1-x2,y=y1-y2,offset=markerEndOffset||0,originalAngle=this.markerEndAngle),rad=Math.atan2(y,x),marker.setLocalEulerAngles(180*rad/Math.PI+originalAngle),marker.setLocalPosition(ox+Math.cos(rad)*offset,oy+Math.sin(rad)*offset)}},Line.prototype.getPoint=function(ratio,inWorldSpace){void 0===inWorldSpace&&(inWorldSpace=!1);var _a=this.parsedStyle,x1=_a.x1,y1=_a.y1,x2=_a.x2,y2=_a.y2,defX=_a.defX,defY=_a.defY,_b=pointAt$3(x1,y1,x2,y2,ratio),x=_b.x,y=_b.y,transformed=transformMat4(create(),fromValues(x-defX,y-defY,0),inWorldSpace?this.getWorldTransform():this.getLocalTransform());return new Point(transformed[0],transformed[1])},Line.prototype.getPointAtLength=function(distance,inWorldSpace){return void 0===inWorldSpace&&(inWorldSpace=!1),this.getPoint(distance/this.getTotalLength(),inWorldSpace)},Line.prototype.getTotalLength=function(){var _a=this.parsedStyle;return length$4(_a.x1,_a.y1,_a.x2,_a.y2)},Line}(DisplayObject),Path=function(_super){function Path(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);(_this=_super.call(this,(0,tslib_es6.Cl)({type:Shape.PATH,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({path:"",miterLimit:""},style):(0,tslib_es6.Cl)({},style),initialParsedStyle:runtime.enableCSSParsing?null:{miterLimit:4,path:(0,tslib_es6.Cl)({},EMPTY_PARSED_PATH)}},rest))||this).markerStartAngle=0,_this.markerEndAngle=0,_this.markerMidList=[];var _b=_this.parsedStyle,markerStart=_b.markerStart,markerEnd=_b.markerEnd,markerMid=_b.markerMid;return markerStart&&isDisplayObject(markerStart)&&(_this.markerStartAngle=markerStart.getLocalEulerAngles(),_this.appendChild(markerStart)),markerMid&&isDisplayObject(markerMid)&&_this.placeMarkerMid(markerMid),markerEnd&&isDisplayObject(markerEnd)&&(_this.markerEndAngle=markerEnd.getLocalEulerAngles(),_this.appendChild(markerEnd)),_this.transformMarker(!0),_this.transformMarker(!1),_this}return(0,tslib_es6.C6)(Path,_super),Path.prototype.attributeChangedCallback=function(attrName,oldValue,newValue,prevParsedValue,newParsedValue){"path"===attrName?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===attrName||"markerEndOffset"===attrName?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===attrName?(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerStartAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerStartAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!0))):"markerEnd"===attrName?(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerEndAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerEndAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!1))):"markerMid"===attrName&&this.placeMarkerMid(newParsedValue)},Path.prototype.transformMarker=function(isStart){var _a=this.parsedStyle,markerStart=_a.markerStart,markerEnd=_a.markerEnd,markerStartOffset=_a.markerStartOffset,markerEndOffset=_a.markerEndOffset,defX=_a.defX,defY=_a.defY,marker=isStart?markerStart:markerEnd;if(marker&&isDisplayObject(marker)){var rad,x,y,ox,oy,offset,originalAngle;if(isStart){var _b=(0,tslib_es6.zs)(this.getStartTangent(),2),p1=_b[0];ox=(p2=_b[1])[0]-defX,oy=p2[1]-defY,x=p1[0]-p2[0],y=p1[1]-p2[1],offset=markerStartOffset||0,originalAngle=this.markerStartAngle}else{var p2,_c=(0,tslib_es6.zs)(this.getEndTangent(),2);p1=_c[0];ox=(p2=_c[1])[0]-defX,oy=p2[1]-defY,x=p1[0]-p2[0],y=p1[1]-p2[1],offset=markerEndOffset||0,originalAngle=this.markerEndAngle}rad=Math.atan2(y,x),marker.setLocalEulerAngles(180*rad/Math.PI+originalAngle),marker.setLocalPosition(ox+Math.cos(rad)*offset,oy+Math.sin(rad)*offset)}},Path.prototype.placeMarkerMid=function(marker){var _a=this.parsedStyle,segments=_a.path.segments,defX=_a.defX,defY=_a.defY;if(this.markerMidList.forEach((function(marker){marker.remove()})),marker&&isDisplayObject(marker))for(var i=1;i<segments.length-1;i++){var _b=(0,tslib_es6.zs)(segments[i].currentPoint,2),ox=_b[0],oy=_b[1],cloned=1===i?marker:marker.cloneNode(!0);this.markerMidList.push(cloned),this.appendChild(cloned),cloned.setLocalPosition(ox-defX,oy-defY)}},Path.prototype.getTotalLength=function(){return getOrCalculatePathTotalLength(this)},Path.prototype.getPointAtLength=function(distance,inWorldSpace){void 0===inWorldSpace&&(inWorldSpace=!1);var _a=this.parsedStyle,defX=_a.defX,defY=_a.defY,_b=function getPointAtLength(pathInput,distance,options){return pathLengthFactory(pathInput,distance,(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},options),{bbox:!1,length:!0})).point}(_a.path.absolutePath,distance),x=_b.x,y=_b.y,transformed=transformMat4(create(),fromValues(x-defX,y-defY,0),inWorldSpace?this.getWorldTransform():this.getLocalTransform());return new Point(transformed[0],transformed[1])},Path.prototype.getPoint=function(ratio,inWorldSpace){return void 0===inWorldSpace&&(inWorldSpace=!1),this.getPointAtLength(ratio*getOrCalculatePathTotalLength(this),inWorldSpace)},Path.prototype.getStartTangent=function(){var segments=this.parsedStyle.path.segments,result=[];if(segments.length>1){var startPoint=segments[0].currentPoint,endPoint=segments[1].currentPoint,tangent=segments[1].startTangent;result=[],tangent?(result.push([startPoint[0]-tangent[0],startPoint[1]-tangent[1]]),result.push([startPoint[0],startPoint[1]])):(result.push([endPoint[0],endPoint[1]]),result.push([startPoint[0],startPoint[1]]))}return result},Path.prototype.getEndTangent=function(){var segments=this.parsedStyle.path.segments,length=segments.length,result=[];if(length>1){var startPoint=segments[length-2].currentPoint,endPoint=segments[length-1].currentPoint,tangent=segments[length-1].endTangent;result=[],tangent?(result.push([endPoint[0]-tangent[0],endPoint[1]-tangent[1]]),result.push([endPoint[0],endPoint[1]])):(result.push([startPoint[0],startPoint[1]]),result.push([endPoint[0],endPoint[1]]))}return result},Path}(DisplayObject),Polygon=function(_super){function Polygon(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);(_this=_super.call(this,(0,tslib_es6.Cl)({type:Shape.POLYGON,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({points:"",miterLimit:"",isClosed:!0},style):(0,tslib_es6.Cl)({},style),initialParsedStyle:runtime.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},rest))||this).markerStartAngle=0,_this.markerEndAngle=0,_this.markerMidList=[];var _b=_this.parsedStyle,markerStart=_b.markerStart,markerEnd=_b.markerEnd,markerMid=_b.markerMid;return markerStart&&isDisplayObject(markerStart)&&(_this.markerStartAngle=markerStart.getLocalEulerAngles(),_this.appendChild(markerStart)),markerMid&&isDisplayObject(markerMid)&&_this.placeMarkerMid(markerMid),markerEnd&&isDisplayObject(markerEnd)&&(_this.markerEndAngle=markerEnd.getLocalEulerAngles(),_this.appendChild(markerEnd)),_this.transformMarker(!0),_this.transformMarker(!1),_this}return(0,tslib_es6.C6)(Polygon,_super),Polygon.prototype.attributeChangedCallback=function(attrName,oldValue,newValue,prevParsedValue,newParsedValue){"points"===attrName?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===attrName||"markerEndOffset"===attrName?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===attrName?(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerStartAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerStartAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!0))):"markerEnd"===attrName?(prevParsedValue&&isDisplayObject(prevParsedValue)&&(this.markerEndAngle=0,prevParsedValue.remove()),newParsedValue&&isDisplayObject(newParsedValue)&&(this.markerEndAngle=newParsedValue.getLocalEulerAngles(),this.appendChild(newParsedValue),this.transformMarker(!1))):"markerMid"===attrName&&this.placeMarkerMid(newParsedValue)},Polygon.prototype.transformMarker=function(isStart){var _a=this.parsedStyle,markerStart=_a.markerStart,markerEnd=_a.markerEnd,markerStartOffset=_a.markerStartOffset,markerEndOffset=_a.markerEndOffset,P=_a.points,defX=_a.defX,defY=_a.defY,points=(P||{}).points,marker=isStart?markerStart:markerEnd;if(marker&&isDisplayObject(marker)&&points){var rad,x,y,ox,oy,offset,originalAngle;if(ox=points[0][0]-defX,oy=points[0][1]-defY,isStart)x=points[1][0]-points[0][0],y=points[1][1]-points[0][1],offset=markerStartOffset||0,originalAngle=this.markerStartAngle;else{var length_1=points.length;this.parsedStyle.isClosed?(x=points[length_1-1][0]-points[0][0],y=points[length_1-1][1]-points[0][1]):(ox=points[length_1-1][0]-defX,oy=points[length_1-1][1]-defY,x=points[length_1-2][0]-points[length_1-1][0],y=points[length_1-2][1]-points[length_1-1][1]),offset=markerEndOffset||0,originalAngle=this.markerEndAngle}rad=Math.atan2(y,x),marker.setLocalEulerAngles(180*rad/Math.PI+originalAngle),marker.setLocalPosition(ox+Math.cos(rad)*offset,oy+Math.sin(rad)*offset)}},Polygon.prototype.placeMarkerMid=function(marker){var _a=this.parsedStyle,P=_a.points,defX=_a.defX,defY=_a.defY,points=(P||{}).points;if(this.markerMidList.forEach((function(marker){marker.remove()})),this.markerMidList=[],marker&&isDisplayObject(marker)&&points)for(var i=1;i<(this.parsedStyle.isClosed?points.length:points.length-1);i++){var ox=points[i][0]-defX,oy=points[i][1]-defY,cloned=1===i?marker:marker.cloneNode(!0);this.markerMidList.push(cloned),this.appendChild(cloned),cloned.setLocalPosition(ox,oy)}},Polygon}(DisplayObject),Polyline=function(_super){function Polyline(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.POLYLINE,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({points:"",miterLimit:"",isClosed:!1},style):(0,tslib_es6.Cl)({},style),initialParsedStyle:runtime.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},rest))||this}return(0,tslib_es6.C6)(Polyline,_super),Polyline.prototype.getTotalLength=function(){return this.parsedStyle.points.totalLength},Polyline.prototype.getPointAtLength=function(distance,inWorldSpace){return void 0===inWorldSpace&&(inWorldSpace=!1),this.getPoint(distance/this.getTotalLength(),inWorldSpace)},Polyline.prototype.getPoint=function(ratio,inWorldSpace){void 0===inWorldSpace&&(inWorldSpace=!1);var _a=this.parsedStyle,defX=_a.defX,defY=_a.defY,_b=_a.points,points=_b.points,segments=_b.segments,subt=0,index=0;segments.forEach((function(v,i){ratio>=v[0]&&ratio<=v[1]&&(subt=(ratio-v[0])/(v[1]-v[0]),index=i)}));var _c=pointAt$3(points[index][0],points[index][1],points[index+1][0],points[index+1][1],subt),x=_c.x,y=_c.y,transformed=transformMat4(create(),fromValues(x-defX,y-defY,0),inWorldSpace?this.getWorldTransform():this.getLocalTransform());return new Point(transformed[0],transformed[1])},Polyline.prototype.getStartTangent=function(){var points=this.parsedStyle.points.points,result=[];return result.push([points[1][0],points[1][1]]),result.push([points[0][0],points[0][1]]),result},Polyline.prototype.getEndTangent=function(){var points=this.parsedStyle.points.points,l=points.length-1,result=[];return result.push([points[l-1][0],points[l-1][1]]),result.push([points[l][0],points[l][1]]),result},Polyline}(Polygon),Rect=function(_super){function Rect(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.RECT,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:"",width:"",height:"",radius:""},style):(0,tslib_es6.Cl)({},style)},rest))||this}return(0,tslib_es6.C6)(Rect,_super),Rect}(DisplayObject),Text=function(_super){function Text(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Shape.TEXT,style:runtime.enableCSSParsing?(0,tslib_es6.Cl)({x:"",y:"",text:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",fill:"black",letterSpacing:"",lineHeight:"",miterLimit:"",wordWrap:!1,wordWrapWidth:0,leading:0,dx:"",dy:""},style):(0,tslib_es6.Cl)({fill:"black"},style),initialParsedStyle:runtime.enableCSSParsing?{}:{x:0,y:0,fontSize:16,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",lineHeight:0,letterSpacing:0,textBaseline:"alphabetic",textAlign:"start",wordWrap:!1,wordWrapWidth:0,leading:0,dx:0,dy:0}},rest))||this}return(0,tslib_es6.C6)(Text,_super),Text.prototype.getComputedTextLength=function(){var _a;return(null===(_a=this.parsedStyle.metrics)||void 0===_a?void 0:_a.maxLineWidth)||0},Text.prototype.getLineBoundingRects=function(){var _a;return(null===(_a=this.parsedStyle.metrics)||void 0===_a?void 0:_a.lineMetrics)||[]},Text.prototype.isOverflowing=function(){return!!this.parsedStyle.isOverflowing},Text}(DisplayObject),CustomElementRegistry=function(){function CustomElementRegistry(){this.registry={},this.define(Shape.CIRCLE,Circle),this.define(Shape.ELLIPSE,Ellipse),this.define(Shape.RECT,Rect),this.define(Shape.IMAGE,index_esm_Image),this.define(Shape.LINE,Line),this.define(Shape.GROUP,Group),this.define(Shape.PATH,Path),this.define(Shape.POLYGON,Polygon),this.define(Shape.POLYLINE,Polyline),this.define(Shape.TEXT,Text),this.define(Shape.HTML,HTML)}return CustomElementRegistry.prototype.define=function(name,constructor){this.registry[name]=constructor},CustomElementRegistry.prototype.get=function(name){return this.registry[name]},CustomElementRegistry}(),Document=function(_super){function Document(){var _this=_super.call(this)||this;_this.defaultView=null,_this.ownerDocument=null,_this.nodeName="document";try{_this.timeline=new runtime.AnimationTimeline(_this)}catch(e){}var initialStyle={};return BUILT_IN_PROPERTIES.forEach((function(_a){var n=_a.n,inh=_a.inh,d=_a.d;inh&&d&&(initialStyle[n]=index_esm_isFunction(d)?d(Shape.GROUP):d)})),_this.documentElement=new Group({id:"g-root",style:initialStyle}),_this.documentElement.ownerDocument=_this,_this.documentElement.parentNode=_this,_this.childNodes=[_this.documentElement],_this}return(0,tslib_es6.C6)(Document,_super),Object.defineProperty(Document.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(Document.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(Document.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(Document.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Document.prototype.createElement=function(tagName,options){if("svg"===tagName)return this.documentElement;var clazz=this.defaultView.customElements.get(tagName);clazz||(console.warn("Unsupported tagName: ",tagName),clazz="tspan"===tagName?Text:Group);var shape=new clazz(options);return shape.ownerDocument=this,shape},Document.prototype.createElementNS=function(namespaceURI,tagName,options){return this.createElement(tagName,options)},Document.prototype.cloneNode=function(deep){throw new Error("Method not implemented.")},Document.prototype.destroy=function(){try{this.documentElement.destroyChildren(),this.timeline.destroy()}catch(e){}},Document.prototype.elementsFromBBox=function(minX,minY,maxX,maxY){var rBushNodes=this.defaultView.context.rBushRoot.search({minX,minY,maxX,maxY}),hitTestList=[];return rBushNodes.forEach((function(_a){var displayObject=_a.displayObject,pointerEvents=displayObject.parsedStyle.pointerEvents,isVisibilityAffected=["auto","visiblepainted","visiblefill","visiblestroke","visible"].includes(pointerEvents);(!isVisibilityAffected||isVisibilityAffected&&displayObject.isVisible())&&!displayObject.isCulled()&&displayObject.isInteractive()&&hitTestList.push(displayObject)})),hitTestList.sort((function(a,b){return b.sortable.renderOrder-a.sortable.renderOrder})),hitTestList},Document.prototype.elementFromPointSync=function(x,y){var _a=this.defaultView.canvas2Viewport({x,y}),viewportX=_a.x,viewportY=_a.y,_b=this.defaultView.getConfig(),width=_b.width,height=_b.height;if(viewportX<0||viewportY<0||viewportX>width||viewportY>height)return null;var _c=this.defaultView.viewport2Client({x:viewportX,y:viewportY}),clientX=_c.x,clientY=_c.y,picked=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!0,position:{x,y,viewportX,viewportY,clientX,clientY},picked:[]}).picked;return picked&&picked[0]||this.documentElement},Document.prototype.elementFromPoint=function(x,y){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var _a,viewportX,viewportY,_b,width,height,_c,clientX,clientY,picked;return(0,tslib_es6.YH)(this,(function(_d){switch(_d.label){case 0:return _a=this.defaultView.canvas2Viewport({x,y}),viewportX=_a.x,viewportY=_a.y,_b=this.defaultView.getConfig(),width=_b.width,height=_b.height,viewportX<0||viewportY<0||viewportX>width||viewportY>height?[2,null]:(_c=this.defaultView.viewport2Client({x:viewportX,y:viewportY}),clientX=_c.x,clientY=_c.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!0,position:{x,y,viewportX,viewportY,clientX,clientY},picked:[]})]);case 1:return[2,(picked=_d.sent().picked)&&picked[0]||this.documentElement]}}))}))},Document.prototype.elementsFromPointSync=function(x,y){var _a=this.defaultView.canvas2Viewport({x,y}),viewportX=_a.x,viewportY=_a.y,_b=this.defaultView.getConfig(),width=_b.width,height=_b.height;if(viewportX<0||viewportY<0||viewportX>width||viewportY>height)return[];var _c=this.defaultView.viewport2Client({x:viewportX,y:viewportY}),clientX=_c.x,clientY=_c.y,picked=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!1,position:{x,y,viewportX,viewportY,clientX,clientY},picked:[]}).picked;return picked[picked.length-1]!==this.documentElement&&picked.push(this.documentElement),picked},Document.prototype.elementsFromPoint=function(x,y){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var _a,viewportX,viewportY,_b,width,height,_c,clientX,clientY,picked;return(0,tslib_es6.YH)(this,(function(_d){switch(_d.label){case 0:return _a=this.defaultView.canvas2Viewport({x,y}),viewportX=_a.x,viewportY=_a.y,_b=this.defaultView.getConfig(),width=_b.width,height=_b.height,viewportX<0||viewportY<0||viewportX>width||viewportY>height?[2,[]]:(_c=this.defaultView.viewport2Client({x:viewportX,y:viewportY}),clientX=_c.x,clientY=_c.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!1,position:{x,y,viewportX,viewportY,clientX,clientY},picked:[]})]);case 1:return(picked=_d.sent().picked)[picked.length-1]!==this.documentElement&&picked.push(this.documentElement),[2,picked]}}))}))},Document.prototype.appendChild=function(newChild,index){throw new Error("Use document.documentElement instead.")},Document.prototype.insertBefore=function(newChild,refChild){throw new Error("Use document.documentElement instead.")},Document.prototype.removeChild=function(oldChild,destroy){throw new Error("Use document.documentElement instead.")},Document.prototype.replaceChild=function(newChild,oldChild,destroy){throw new Error("Use document.documentElement instead.")},Document.prototype.append=function(){throw new Error("Use document.documentElement instead.")},Document.prototype.prepend=function(){throw new Error("Use document.documentElement instead.")},Document.prototype.getElementById=function(id){return this.documentElement.getElementById(id)},Document.prototype.getElementsByName=function(name){return this.documentElement.getElementsByName(name)},Document.prototype.getElementsByTagName=function(tagName){return this.documentElement.getElementsByTagName(tagName)},Document.prototype.getElementsByClassName=function(className){return this.documentElement.getElementsByClassName(className)},Document.prototype.querySelector=function(selectors){return this.documentElement.querySelector(selectors)},Document.prototype.querySelectorAll=function(selectors){return this.documentElement.querySelectorAll(selectors)},Document.prototype.find=function(filter){return this.documentElement.find(filter)},Document.prototype.findAll=function(filter){return this.documentElement.findAll(filter)},Document}(Node),CullingPlugin=function(){function CullingPlugin(strategies){this.strategies=strategies}return CullingPlugin.prototype.apply=function(context){var camera=context.camera,renderingService=context.renderingService,renderingContext=context.renderingContext,strategies=this.strategies;renderingService.hooks.cull.tap(CullingPlugin.tag,(function(object){if(object){var cullable=object.cullable;return 0===strategies.length?cullable.visible=renderingContext.unculledEntities.indexOf(object.entity)>-1:cullable.visible=strategies.every((function(strategy){return strategy.isVisible(camera,object)})),!object.isCulled()&&object.isVisible()?object:(object.dispatchEvent(new CustomEvent(ElementEvent.CULLED)),null)}return object})),renderingService.hooks.afterRender.tap(CullingPlugin.tag,(function(object){object.cullable.visibilityPlaneMask=-1}))},CullingPlugin.tag="Culling",CullingPlugin}(),EventPlugin=function(){function EventPlugin(){var _this=this;this.autoPreventDefault=!1,this.rootPointerEvent=new FederatedPointerEvent(null),this.rootWheelEvent=new FederatedWheelEvent(null),this.onPointerMove=function(nativeEvent){var e_1,_a,_b,_c,canvas=null===(_c=null===(_b=_this.context.renderingContext.root)||void 0===_b?void 0:_b.ownerDocument)||void 0===_c?void 0:_c.defaultView;if(!canvas.supportsTouchEvents||"touch"!==nativeEvent.pointerType){var normalizedEvents=_this.normalizeToPointerEvent(nativeEvent,canvas);try{for(var normalizedEvents_1=(0,tslib_es6.Ju)(normalizedEvents),normalizedEvents_1_1=normalizedEvents_1.next();!normalizedEvents_1_1.done;normalizedEvents_1_1=normalizedEvents_1.next()){var normalizedEvent=normalizedEvents_1_1.value,event_1=_this.bootstrapEvent(_this.rootPointerEvent,normalizedEvent,canvas,nativeEvent);_this.context.eventService.mapEvent(event_1)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{normalizedEvents_1_1&&!normalizedEvents_1_1.done&&(_a=normalizedEvents_1.return)&&_a.call(normalizedEvents_1)}finally{if(e_1)throw e_1.error}}_this.setCursor(_this.context.eventService.cursor)}},this.onClick=function(nativeEvent){var e_2,_a,_b,_c,canvas=null===(_c=null===(_b=_this.context.renderingContext.root)||void 0===_b?void 0:_b.ownerDocument)||void 0===_c?void 0:_c.defaultView,normalizedEvents=_this.normalizeToPointerEvent(nativeEvent,canvas);try{for(var normalizedEvents_2=(0,tslib_es6.Ju)(normalizedEvents),normalizedEvents_2_1=normalizedEvents_2.next();!normalizedEvents_2_1.done;normalizedEvents_2_1=normalizedEvents_2.next()){var normalizedEvent=normalizedEvents_2_1.value,event_2=_this.bootstrapEvent(_this.rootPointerEvent,normalizedEvent,canvas,nativeEvent);_this.context.eventService.mapEvent(event_2)}}catch(e_2_1){e_2={error:e_2_1}}finally{try{normalizedEvents_2_1&&!normalizedEvents_2_1.done&&(_a=normalizedEvents_2.return)&&_a.call(normalizedEvents_2)}finally{if(e_2)throw e_2.error}}_this.setCursor(_this.context.eventService.cursor)}}return EventPlugin.prototype.apply=function(context){var _this=this;this.context=context;var renderingService=context.renderingService,canvas=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(position){return _this.context.renderingService.hooks.pickSync.call({position,picked:[],topmost:!0}).picked[0]||null})),renderingService.hooks.pointerWheel.tap(EventPlugin.tag,(function(nativeEvent){var wheelEvent=_this.normalizeWheelEvent(nativeEvent);_this.context.eventService.mapEvent(wheelEvent)})),renderingService.hooks.pointerDown.tap(EventPlugin.tag,(function(nativeEvent){var e_3,_a;if(!canvas.supportsTouchEvents||"touch"!==nativeEvent.pointerType){var events=_this.normalizeToPointerEvent(nativeEvent,canvas);if(_this.autoPreventDefault&&events[0].isNormalized)(nativeEvent.cancelable||!("cancelable"in nativeEvent))&&nativeEvent.preventDefault();try{for(var events_1=(0,tslib_es6.Ju)(events),events_1_1=events_1.next();!events_1_1.done;events_1_1=events_1.next()){var event_3=events_1_1.value,federatedEvent=_this.bootstrapEvent(_this.rootPointerEvent,event_3,canvas,nativeEvent);_this.context.eventService.mapEvent(federatedEvent)}}catch(e_3_1){e_3={error:e_3_1}}finally{try{events_1_1&&!events_1_1.done&&(_a=events_1.return)&&_a.call(events_1)}finally{if(e_3)throw e_3.error}}_this.setCursor(_this.context.eventService.cursor)}})),renderingService.hooks.pointerUp.tap(EventPlugin.tag,(function(nativeEvent){var e_4,_a;if(!canvas.supportsTouchEvents||"touch"!==nativeEvent.pointerType){var $element=_this.context.contextService.getDomElement(),outside="outside";try{outside=$element&&nativeEvent.target&&nativeEvent.target!==$element&&$element.contains&&!$element.contains(nativeEvent.target)?"outside":""}catch(e){}var normalizedEvents=_this.normalizeToPointerEvent(nativeEvent,canvas);try{for(var normalizedEvents_3=(0,tslib_es6.Ju)(normalizedEvents),normalizedEvents_3_1=normalizedEvents_3.next();!normalizedEvents_3_1.done;normalizedEvents_3_1=normalizedEvents_3.next()){var normalizedEvent=normalizedEvents_3_1.value,event_4=_this.bootstrapEvent(_this.rootPointerEvent,normalizedEvent,canvas,nativeEvent);event_4.type+=outside,_this.context.eventService.mapEvent(event_4)}}catch(e_4_1){e_4={error:e_4_1}}finally{try{normalizedEvents_3_1&&!normalizedEvents_3_1.done&&(_a=normalizedEvents_3.return)&&_a.call(normalizedEvents_3)}finally{if(e_4)throw e_4.error}}_this.setCursor(_this.context.eventService.cursor)}})),renderingService.hooks.pointerMove.tap(EventPlugin.tag,this.onPointerMove),renderingService.hooks.pointerOver.tap(EventPlugin.tag,this.onPointerMove),renderingService.hooks.pointerOut.tap(EventPlugin.tag,this.onPointerMove),renderingService.hooks.click.tap(EventPlugin.tag,this.onClick),renderingService.hooks.pointerCancel.tap(EventPlugin.tag,(function(nativeEvent){var e_5,_a,normalizedEvents=_this.normalizeToPointerEvent(nativeEvent,canvas);try{for(var normalizedEvents_4=(0,tslib_es6.Ju)(normalizedEvents),normalizedEvents_4_1=normalizedEvents_4.next();!normalizedEvents_4_1.done;normalizedEvents_4_1=normalizedEvents_4.next()){var normalizedEvent=normalizedEvents_4_1.value,event_5=_this.bootstrapEvent(_this.rootPointerEvent,normalizedEvent,canvas,nativeEvent);_this.context.eventService.mapEvent(event_5)}}catch(e_5_1){e_5={error:e_5_1}}finally{try{normalizedEvents_4_1&&!normalizedEvents_4_1.done&&(_a=normalizedEvents_4.return)&&_a.call(normalizedEvents_4)}finally{if(e_5)throw e_5.error}}_this.setCursor(_this.context.eventService.cursor)}))},EventPlugin.prototype.getViewportXY=function(nativeEvent){var x,y,offsetX=nativeEvent.offsetX,offsetY=nativeEvent.offsetY,clientX=nativeEvent.clientX,clientY=nativeEvent.clientY;if(!this.context.config.supportsCSSTransform||(0,is_nil.A)(offsetX)||(0,is_nil.A)(offsetY)){var point=this.context.eventService.client2Viewport(new Point(clientX,clientY));x=point.x,y=point.y}else x=offsetX,y=offsetY;return{x,y}},EventPlugin.prototype.bootstrapEvent=function(event,normalizedEvent,view,nativeEvent){event.view=view,event.originalEvent=null,event.nativeEvent=nativeEvent,event.pointerId=normalizedEvent.pointerId,event.width=normalizedEvent.width,event.height=normalizedEvent.height,event.isPrimary=normalizedEvent.isPrimary,event.pointerType=normalizedEvent.pointerType,event.pressure=normalizedEvent.pressure,event.tangentialPressure=normalizedEvent.tangentialPressure,event.tiltX=normalizedEvent.tiltX,event.tiltY=normalizedEvent.tiltY,event.twist=normalizedEvent.twist,this.transferMouseData(event,normalizedEvent);var _a=this.getViewportXY(normalizedEvent),x=_a.x,y=_a.y;event.viewport.x=x,event.viewport.y=y;var _b=this.context.eventService.viewport2Canvas(event.viewport),canvasX=_b.x,canvasY=_b.y;return event.canvas.x=canvasX,event.canvas.y=canvasY,event.global.copyFrom(event.canvas),event.offset.copyFrom(event.canvas),event.isTrusted=nativeEvent.isTrusted,"pointerleave"===event.type&&(event.type="pointerout"),event.type.startsWith("mouse")&&(event.type=event.type.replace("mouse","pointer")),event.type.startsWith("touch")&&(event.type=TOUCH_TO_POINTER[event.type]||event.type),event},EventPlugin.prototype.normalizeWheelEvent=function(nativeEvent){var event=this.rootWheelEvent;this.transferMouseData(event,nativeEvent),event.deltaMode=nativeEvent.deltaMode,event.deltaX=nativeEvent.deltaX,event.deltaY=nativeEvent.deltaY,event.deltaZ=nativeEvent.deltaZ;var _a=this.getViewportXY(nativeEvent),x=_a.x,y=_a.y;event.viewport.x=x,event.viewport.y=y;var _b=this.context.eventService.viewport2Canvas(event.viewport),canvasX=_b.x,canvasY=_b.y;return event.canvas.x=canvasX,event.canvas.y=canvasY,event.global.copyFrom(event.canvas),event.offset.copyFrom(event.canvas),event.nativeEvent=nativeEvent,event.type=nativeEvent.type,event},EventPlugin.prototype.transferMouseData=function(event,nativeEvent){event.isTrusted=nativeEvent.isTrusted,event.srcElement=nativeEvent.srcElement,event.timeStamp=clock.now(),event.type=nativeEvent.type,event.altKey=nativeEvent.altKey,event.metaKey=nativeEvent.metaKey,event.shiftKey=nativeEvent.shiftKey,event.ctrlKey=nativeEvent.ctrlKey,event.button=nativeEvent.button,event.buttons=nativeEvent.buttons,event.client.x=nativeEvent.clientX,event.client.y=nativeEvent.clientY,event.movement.x=nativeEvent.movementX,event.movement.y=nativeEvent.movementY,event.page.x=nativeEvent.pageX,event.page.y=nativeEvent.pageY,event.screen.x=nativeEvent.screenX,event.screen.y=nativeEvent.screenY,event.relatedTarget=null},EventPlugin.prototype.setCursor=function(cursor){this.context.contextService.applyCursorStyle(cursor||this.context.config.cursor||"default")},EventPlugin.prototype.normalizeToPointerEvent=function(event,canvas){var normalizedEvents=[];if(canvas.isTouchEvent(event))for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];is_undefined(touch.button)&&(touch.button=0),is_undefined(touch.buttons)&&(touch.buttons=1),is_undefined(touch.isPrimary)&&(touch.isPrimary=1===event.touches.length&&"touchstart"===event.type),is_undefined(touch.width)&&(touch.width=touch.radiusX||1),is_undefined(touch.height)&&(touch.height=touch.radiusY||1),is_undefined(touch.tiltX)&&(touch.tiltX=0),is_undefined(touch.tiltY)&&(touch.tiltY=0),is_undefined(touch.pointerType)&&(touch.pointerType="touch"),is_undefined(touch.pointerId)&&(touch.pointerId=touch.identifier||0),is_undefined(touch.pressure)&&(touch.pressure=touch.force||.5),is_undefined(touch.twist)&&(touch.twist=0),is_undefined(touch.tangentialPressure)&&(touch.tangentialPressure=0),touch.isNormalized=!0,touch.type=event.type,normalizedEvents.push(touch)}else if(canvas.isMouseEvent(event)){var tempEvent=event;is_undefined(tempEvent.isPrimary)&&(tempEvent.isPrimary=!0),is_undefined(tempEvent.width)&&(tempEvent.width=1),is_undefined(tempEvent.height)&&(tempEvent.height=1),is_undefined(tempEvent.tiltX)&&(tempEvent.tiltX=0),is_undefined(tempEvent.tiltY)&&(tempEvent.tiltY=0),is_undefined(tempEvent.pointerType)&&(tempEvent.pointerType="mouse"),is_undefined(tempEvent.pointerId)&&(tempEvent.pointerId=1),is_undefined(tempEvent.pressure)&&(tempEvent.pressure=.5),is_undefined(tempEvent.twist)&&(tempEvent.twist=0),is_undefined(tempEvent.tangentialPressure)&&(tempEvent.tangentialPressure=0),tempEvent.isNormalized=!0,normalizedEvents.push(tempEvent)}else normalizedEvents.push(event);return normalizedEvents},EventPlugin.tag="Event",EventPlugin}(),shape2D=[Shape.CIRCLE,Shape.ELLIPSE,Shape.IMAGE,Shape.RECT,Shape.LINE,Shape.POLYLINE,Shape.POLYGON,Shape.TEXT,Shape.PATH,Shape.HTML],FrustumCullingStrategy=function(){function FrustumCullingStrategy(){}return FrustumCullingStrategy.prototype.isVisible=function(camera,object){var _a,_b,cullable=object.cullable;if(!cullable.enable)return!0;var renderBounds=object.getRenderBounds();if(AABB.isEmpty(renderBounds))return!1;var frustum=camera.getFrustum(),parentVisibilityPlaneMask=null===(_b=null===(_a=object.parentNode)||void 0===_a?void 0:_a.cullable)||void 0===_b?void 0:_b.visibilityPlaneMask;return cullable.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(object,renderBounds,parentVisibilityPlaneMask||Mask.INDETERMINATE,frustum.planes),cullable.visible=cullable.visibilityPlaneMask!==Mask.OUTSIDE,cullable.visible},FrustumCullingStrategy.prototype.computeVisibilityWithPlaneMask=function(object,aabb,parentPlaneMask,planes){if(parentPlaneMask===Mask.OUTSIDE||parentPlaneMask===Mask.INSIDE)return parentPlaneMask;for(var mask=Mask.INSIDE,isShape2D=shape2D.indexOf(object.nodeName)>-1,k=0,len=planes.length;k<len;++k){var flag=1<<k;if(0!=(parentPlaneMask&flag)&&(!isShape2D||4!==k&&5!==k)){var _a=planes[k],normal=_a.normal,distance=_a.distance;if(vec3_dot(normal,aabb.getPositiveFarPoint(planes[k]))+distance<0)return Mask.OUTSIDE;vec3_dot(normal,aabb.getNegativeFarPoint(planes[k]))+distance<0&&(mask|=flag)}}return mask},FrustumCullingStrategy}(),PrepareRendererPlugin=function(){function PrepareRendererPlugin(){this.toSync=new Set}return PrepareRendererPlugin.prototype.apply=function(context){var _this=this,renderingService=context.renderingService,renderingContext=context.renderingContext,rBushRoot=context.rBushRoot,canvas=renderingContext.root.ownerDocument.defaultView;this.rBush=rBushRoot;var handleAttributeChanged=function(e){e.target.renderable.dirty=!0,renderingService.dirtify()},handleBoundsChanged=function(e){var affectChildren=e.detail.affectChildren,object=e.target;affectChildren&&object.forEach((function(node){_this.toSync.add(node)}));for(var p=object;p;)p.renderable&&_this.toSync.add(p),p=p.parentElement;renderingService.dirtify()},handleMounted=function(e){var object=e.target;runtime.enableCSSParsing&&runtime.styleValueRegistry.recalc(object),runtime.sceneGraphService.dirtifyToRoot(object),renderingService.dirtify()},handleUnmounted=function(e){var object=e.target,rBushNode=object.rBushNode;rBushNode.aabb&&_this.rBush.remove(rBushNode.aabb),_this.toSync.delete(object),runtime.sceneGraphService.dirtifyToRoot(object),renderingService.dirtify()};renderingService.hooks.init.tap(PrepareRendererPlugin.tag,(function(){canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.addEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.addEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged)})),renderingService.hooks.destroy.tap(PrepareRendererPlugin.tag,(function(){canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.removeEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.removeEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged),_this.toSync.clear()})),renderingService.hooks.endFrame.tap(PrepareRendererPlugin.tag,(function(){_this.syncRTree()}))},PrepareRendererPlugin.prototype.syncRTree=function(){var _this=this,bulk=[];Array.from(this.toSync).filter((function(object){return object.isConnected})).forEach((function(node){var rBushNode=node.rBushNode;rBushNode&&rBushNode.aabb&&_this.rBush.remove(rBushNode.aabb);var renderBounds=node.getRenderBounds();if(renderBounds){var _a=(0,tslib_es6.zs)(renderBounds.getMin(),2),minX=_a[0],minY=_a[1],_b=(0,tslib_es6.zs)(renderBounds.getMax(),2),maxX=_b[0],maxY=_b[1];rBushNode.aabb||(rBushNode.aabb={}),rBushNode.aabb.displayObject=node,rBushNode.aabb.minX=minX,rBushNode.aabb.minY=minY,rBushNode.aabb.maxX=maxX,rBushNode.aabb.maxY=maxY}rBushNode.aabb&&(isNaN(rBushNode.aabb.maxX)||isNaN(rBushNode.aabb.maxX)||isNaN(rBushNode.aabb.minX)||isNaN(rBushNode.aabb.minY)||bulk.push(rBushNode.aabb))})),this.rBush.load(bulk),bulk.length=0,this.toSync.clear()},PrepareRendererPlugin.tag="Prepare",PrepareRendererPlugin}();!function(CanvasEvent){CanvasEvent.READY="ready",CanvasEvent.BEFORE_RENDER="beforerender",CanvasEvent.RERENDER="rerender",CanvasEvent.AFTER_RENDER="afterrender",CanvasEvent.BEFORE_DESTROY="beforedestroy",CanvasEvent.AFTER_DESTROY="afterdestroy",CanvasEvent.RESIZE="resize",CanvasEvent.DIRTY_RECTANGLE="dirtyrectangle",CanvasEvent.RENDERER_CHANGED="rendererchanged"}(CanvasEvent||(CanvasEvent={}));var mountedEvent=new CustomEvent(ElementEvent.MOUNTED),unmountedEvent=new CustomEvent(ElementEvent.UNMOUNTED),beforeRenderEvent=new CustomEvent(CanvasEvent.BEFORE_RENDER),rerenderEvent=new CustomEvent(CanvasEvent.RERENDER),afterRenderEvent=new CustomEvent(CanvasEvent.AFTER_RENDER),Canvas=function(_super){function Canvas(config){var _this=_super.call(this)||this;_this.Element=DisplayObject,_this.inited=!1,_this.context={},_this.document=new Document,_this.document.defaultView=_this,_this.customElements=new CustomElementRegistry;var container=config.container,canvas=config.canvas,offscreenCanvas=config.offscreenCanvas,width=config.width,height=config.height,devicePixelRatio=config.devicePixelRatio,renderer=config.renderer,background=config.background,cursor=config.cursor,document=config.document,requestAnimationFrame=config.requestAnimationFrame,cancelAnimationFrame=config.cancelAnimationFrame,createImage=config.createImage,supportsPointerEvents=config.supportsPointerEvents,supportsTouchEvents=config.supportsTouchEvents,supportsCSSTransform=config.supportsCSSTransform,supportsMutipleCanvasesInOneContainer=config.supportsMutipleCanvasesInOneContainer,useNativeClickEvent=config.useNativeClickEvent,alwaysTriggerPointerEventOnCanvas=config.alwaysTriggerPointerEventOnCanvas,isTouchEvent=config.isTouchEvent,isMouseEvent=config.isMouseEvent;supportsMutipleCanvasesInOneContainer||function cleanExistedCanvas(container,canvas){if(container){var id="string"==typeof container?container:container.id||defaultCanvasIdCounter++;canvasMap[id]&&canvasMap[id].destroy(),canvasMap[id]=canvas}}(container,_this);var canvasWidth=width,canvasHeight=height,dpr=devicePixelRatio;return canvas&&(dpr=(dpr=devicePixelRatio||isBrowser&&window.devicePixelRatio||1)>=1?Math.ceil(dpr):1,canvasWidth=width||function getWidth($el){var width=getStyle($el,"width");return"auto"===width?$el.offsetWidth:parseFloat(width)}(canvas)||canvas.width/dpr,canvasHeight=height||function getHeight($el){var height=getStyle($el,"height");return"auto"===height?$el.offsetHeight:parseFloat(height)}(canvas)||canvas.height/dpr),offscreenCanvas&&(runtime.offscreenCanvas=offscreenCanvas),_this.devicePixelRatio=dpr,_this.requestAnimationFrame=null!=requestAnimationFrame?requestAnimationFrame:raf.bind(runtime.globalThis),_this.cancelAnimationFrame=null!=cancelAnimationFrame?cancelAnimationFrame:caf.bind(runtime.globalThis),_this.supportsTouchEvents=null!=supportsTouchEvents?supportsTouchEvents:"ontouchstart"in runtime.globalThis,_this.supportsPointerEvents=null!=supportsPointerEvents?supportsPointerEvents:!!runtime.globalThis.PointerEvent,_this.isTouchEvent=null!=isTouchEvent?isTouchEvent:function(event){return _this.supportsTouchEvents&&event instanceof runtime.globalThis.TouchEvent},_this.isMouseEvent=null!=isMouseEvent?isMouseEvent:function(event){return!runtime.globalThis.MouseEvent||event instanceof runtime.globalThis.MouseEvent&&(!_this.supportsPointerEvents||!(event instanceof runtime.globalThis.PointerEvent))},_this.initRenderingContext({container,canvas,width:canvasWidth,height:canvasHeight,renderer,offscreenCanvas,devicePixelRatio:dpr,cursor:cursor||"default",background:background||"transparent",createImage,document,supportsCSSTransform,useNativeClickEvent,alwaysTriggerPointerEventOnCanvas}),_this.initDefaultCamera(canvasWidth,canvasHeight,renderer.clipSpaceNearZ),_this.initRenderer(renderer,!0),_this}return(0,tslib_es6.C6)(Canvas,_super),Canvas.prototype.initRenderingContext=function(mergedConfig){this.context.config=mergedConfig,this.context.renderingContext={root:this.document.documentElement,renderListCurrentFrame:[],unculledEntities:[],renderReasons:new Set,force:!1,dirty:!1}},Canvas.prototype.initDefaultCamera=function(width,height,clipSpaceNearZ){var _this=this,camera=new runtime.CameraContribution;camera.clipSpaceNearZ=clipSpaceNearZ,camera.setType(CameraType.EXPLORING,CameraTrackingMode.DEFAULT).setPosition(width/2,height/2,500).setFocalPoint(width/2,height/2,0).setOrthographic(width/-2,width/2,height/2,height/-2,.1,1e3),camera.canvas=this,camera.eventEmitter.on(CameraEvent_UPDATED,(function(){_this.context.renderingContext.renderReasons.add(RenderReason.CAMERA_CHANGED)})),this.context.camera=camera},Canvas.prototype.getConfig=function(){return this.context.config},Canvas.prototype.getRoot=function(){return this.document.documentElement},Canvas.prototype.getCamera=function(){return this.context.camera},Canvas.prototype.getContextService=function(){return this.context.contextService},Canvas.prototype.getEventService=function(){return this.context.eventService},Canvas.prototype.getRenderingService=function(){return this.context.renderingService},Canvas.prototype.getRenderingContext=function(){return this.context.renderingContext},Canvas.prototype.getStats=function(){return this.getRenderingService().getStats()},Object.defineProperty(Canvas.prototype,"ready",{get:function(){var _this=this;return this.readyPromise||(this.readyPromise=new Promise((function(resolve){_this.resolveReadyPromise=function(){resolve(_this)}})),this.inited&&this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Canvas.prototype.destroy=function(cleanUp,skipTriggerEvent){(void 0===cleanUp&&(cleanUp=!0),void 0===skipTriggerEvent&&(skipTriggerEvent=!1),skipTriggerEvent||this.dispatchEvent(new CustomEvent(CanvasEvent.BEFORE_DESTROY)),this.frameId)&&(this.getConfig().cancelAnimationFrame||cancelAnimationFrame)(this.frameId);var root=this.getRoot();this.unmountChildren(root),cleanUp&&(this.document.destroy(),this.getEventService().destroy()),this.getRenderingService().destroy(),this.getContextService().destroy(),cleanUp&&this.context.rBushRoot&&(this.context.rBushRoot.clear(),this.context.rBushRoot=null,this.context.renderingContext.root=null),skipTriggerEvent||this.dispatchEvent(new CustomEvent(CanvasEvent.AFTER_DESTROY))},Canvas.prototype.changeSize=function(width,height){this.resize(width,height)},Canvas.prototype.resize=function(width,height){var canvasConfig=this.context.config;canvasConfig.width=width,canvasConfig.height=height,this.getContextService().resize(width,height);var camera=this.context.camera,projectionMode=camera.getProjectionMode();camera.setPosition(width/2,height/2,500).setFocalPoint(width/2,height/2,0),projectionMode===CameraProjectionMode.ORTHOGRAPHIC?camera.setOrthographic(width/-2,width/2,height/2,height/-2,camera.getNear(),camera.getFar()):camera.setAspect(width/height),this.dispatchEvent(new CustomEvent(CanvasEvent.RESIZE,{width,height}))},Canvas.prototype.appendChild=function(child,index){return this.document.documentElement.appendChild(child,index)},Canvas.prototype.insertBefore=function(newChild,refChild){return this.document.documentElement.insertBefore(newChild,refChild)},Canvas.prototype.removeChild=function(child){return this.document.documentElement.removeChild(child)},Canvas.prototype.removeChildren=function(){this.document.documentElement.removeChildren()},Canvas.prototype.destroyChildren=function(){this.document.documentElement.destroyChildren()},Canvas.prototype.render=function(){var _this=this;this.dispatchEvent(beforeRenderEvent),this.getRenderingService().render(this.getConfig(),(function(){_this.dispatchEvent(rerenderEvent)})),this.dispatchEvent(afterRenderEvent)},Canvas.prototype.run=function(){var _this=this,tick=function(){_this.render(),_this.frameId=_this.requestAnimationFrame(tick)};tick()},Canvas.prototype.initRenderer=function(renderer,firstContentfullPaint){var _this=this;if(void 0===firstContentfullPaint&&(firstContentfullPaint=!1),!renderer)throw new Error("Renderer is required.");this.inited=!1,this.readyPromise=void 0,this.context.rBushRoot=new RBush,this.context.renderingPlugins=[],this.context.renderingPlugins.push(new EventPlugin,new PrepareRendererPlugin,new CullingPlugin([new FrustumCullingStrategy])),this.loadRendererContainerModule(renderer),this.context.contextService=new this.context.ContextService((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},runtime),this.context)),this.context.renderingService=new RenderingService(runtime,this.context),this.context.eventService=new EventService(runtime,this.context),this.context.eventService.init(),this.context.contextService.init?(this.context.contextService.init(),this.initRenderingService(renderer,firstContentfullPaint,!0)):this.context.contextService.initAsync().then((function(){_this.initRenderingService(renderer,firstContentfullPaint)}))},Canvas.prototype.initRenderingService=function(renderer,firstContentfullPaint,async){var _this=this;void 0===firstContentfullPaint&&(firstContentfullPaint=!1),void 0===async&&(async=!1),this.context.renderingService.init((function(){_this.inited=!0,firstContentfullPaint?(async?_this.requestAnimationFrame((function(){_this.dispatchEvent(new CustomEvent(CanvasEvent.READY))})):_this.dispatchEvent(new CustomEvent(CanvasEvent.READY)),_this.readyPromise&&_this.resolveReadyPromise()):_this.dispatchEvent(new CustomEvent(CanvasEvent.RENDERER_CHANGED)),firstContentfullPaint||_this.getRoot().forEach((function(node){var renderable=node.renderable;renderable&&(renderable.renderBoundsDirty=!0,renderable.boundsDirty=!0,renderable.dirty=!0)})),_this.mountChildren(_this.getRoot()),renderer.getConfig().enableAutoRendering&&_this.run()}))},Canvas.prototype.loadRendererContainerModule=function(renderer){var _this=this;renderer.getPlugins().forEach((function(plugin){plugin.context=_this.context,plugin.init(runtime)}))},Canvas.prototype.setRenderer=function(renderer){var canvasConfig=this.getConfig();if(canvasConfig.renderer!==renderer){var oldRenderer=canvasConfig.renderer;canvasConfig.renderer=renderer,this.destroy(!1,!0),(0,tslib_es6.fX)([],(0,tslib_es6.zs)(null==oldRenderer?void 0:oldRenderer.getPlugins()),!1).reverse().forEach((function(plugin){plugin.destroy(runtime)})),this.initRenderer(renderer)}},Canvas.prototype.setCursor=function(cursor){this.getConfig().cursor=cursor,this.getContextService().applyCursorStyle(cursor)},Canvas.prototype.unmountChildren=function(parent){var _this=this;parent.childNodes.forEach((function(child){_this.unmountChildren(child)})),this.inited&&(parent.isMutationObserved?parent.dispatchEvent(unmountedEvent):(unmountedEvent.target=parent,this.dispatchEvent(unmountedEvent,!0)),parent!==this.document.documentElement&&(parent.ownerDocument=null),parent.isConnected=!1),parent.isCustomElement&&parent.disconnectedCallback&&parent.disconnectedCallback()},Canvas.prototype.mountChildren=function(parent){var _this=this;this.inited?parent.isConnected||(parent.ownerDocument=this.document,parent.isConnected=!0,parent.isMutationObserved?parent.dispatchEvent(mountedEvent):(mountedEvent.target=parent,this.dispatchEvent(mountedEvent,!0))):console.warn("[g]: You are trying to call `canvas.appendChild` before canvas' initialization finished. You can either await `canvas.ready` or listen to `CanvasEvent.READY` manually.","appended child: ",parent.nodeName),parent.childNodes.forEach((function(child){_this.mountChildren(child)})),parent.isCustomElement&&parent.connectedCallback&&parent.connectedCallback()},Canvas.prototype.client2Viewport=function(client){return this.getEventService().client2Viewport(client)},Canvas.prototype.viewport2Client=function(canvas){return this.getEventService().viewport2Client(canvas)},Canvas.prototype.viewport2Canvas=function(viewport){return this.getEventService().viewport2Canvas(viewport)},Canvas.prototype.canvas2Viewport=function(canvas){return this.getEventService().canvas2Viewport(canvas)},Canvas.prototype.getPointByClient=function(clientX,clientY){return this.client2Viewport({x:clientX,y:clientY})},Canvas.prototype.getClientByPoint=function(x,y){return this.viewport2Client({x,y})},Canvas}(EventTarget),AdvancedCamera=function(_super){function AdvancedCamera(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.landmarks=[],_this}return(0,tslib_es6.C6)(AdvancedCamera,_super),AdvancedCamera.prototype.rotate=function(azimuth,elevation,roll){if(this.relElevation=dist_index_esm_getAngle(elevation),this.relAzimuth=dist_index_esm_getAngle(azimuth),this.relRoll=dist_index_esm_getAngle(roll),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===CameraType.EXPLORING){var rotX=setAxisAngle(quat_create(),[1,0,0],deg2rad((this.rotateWorld?1:-1)*this.relElevation)),rotY=setAxisAngle(quat_create(),[0,1,0],deg2rad((this.rotateWorld?1:-1)*this.relAzimuth)),rotZ=setAxisAngle(quat_create(),[0,0,1],deg2rad(this.relRoll)),rotQ=quat_multiply(quat_create(),rotY,rotX);rotQ=quat_multiply(quat_create(),rotQ,rotZ);var rotMatrix=fromQuat(mat4_create(),rotQ);translate(this.matrix,this.matrix,[0,0,-this.distance]),mat4_multiply(this.matrix,this.matrix,rotMatrix),translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?this._getPosition():this.type===CameraType.TRACKING&&this._getFocalPoint(),this._update(),this},AdvancedCamera.prototype.pan=function(tx,ty){var coords=createVec3(tx,ty,0),pos=clone(this.position);return add(pos,pos,scale(create(),this.right,coords[0])),add(pos,pos,scale(create(),this.up,coords[1])),this._setPosition(pos),this.triggerUpdate(),this},AdvancedCamera.prototype.dolly=function(value){var n=this.forward,pos=clone(this.position),step=this.dollyingStep,updatedDistance=this.distance+value*this.dollyingStep;return step=Math.max(Math.min(updatedDistance,this.maxDistance),this.minDistance)-this.distance,pos[0]+=step*n[0],pos[1]+=step*n[1],pos[2]+=step*n[2],this._setPosition(pos),this.type===CameraType.ORBITING||this.type===CameraType.EXPLORING?this._getDistance():this.type===CameraType.TRACKING&&add(this.focalPoint,pos,this.distanceVector),this.triggerUpdate(),this},AdvancedCamera.prototype.cancelLandmarkAnimation=function(){void 0!==this.landmarkAnimationID&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},AdvancedCamera.prototype.createLandmark=function(name,params){var _a,_b,_c,_d;void 0===params&&(params={});var _e=params.position,position=void 0===_e?this.position:_e,_f=params.focalPoint,focalPoint=void 0===_f?this.focalPoint:_f,roll=params.roll,zoom=params.zoom,camera=new runtime.CameraContribution;camera.setType(this.type,void 0),camera.setPosition(position[0],null!==(_a=position[1])&&void 0!==_a?_a:this.position[1],null!==(_b=position[2])&&void 0!==_b?_b:this.position[2]),camera.setFocalPoint(focalPoint[0],null!==(_c=focalPoint[1])&&void 0!==_c?_c:this.focalPoint[1],null!==(_d=focalPoint[2])&&void 0!==_d?_d:this.focalPoint[2]),camera.setRoll(null!=roll?roll:this.roll),camera.setZoom(null!=zoom?zoom:this.zoom);var landmark={name,matrix:mat4_clone(camera.getWorldTransform()),right:clone(camera.right),up:clone(camera.up),forward:clone(camera.forward),position:clone(camera.getPosition()),focalPoint:clone(camera.getFocalPoint()),distanceVector:clone(camera.getDistanceVector()),distance:camera.getDistance(),dollyingStep:camera.getDollyingStep(),azimuth:camera.getAzimuth(),elevation:camera.getElevation(),roll:camera.getRoll(),relAzimuth:camera.relAzimuth,relElevation:camera.relElevation,relRoll:camera.relRoll,zoom:camera.getZoom()};return this.landmarks.push(landmark),landmark},AdvancedCamera.prototype.gotoLandmark=function(name,options){var _this=this;void 0===options&&(options={});var landmark=(0,is_string.A)(name)?this.landmarks.find((function(l){return l.name===name})):name;if(landmark){var _a=(0,is_number.A)(options)?{duration:options}:options,_b=_a.easing,easing=void 0===_b?"linear":_b,_c=_a.duration,duration_1=void 0===_c?100:_c,_d=_a.easingFunction,easingFunction=void 0===_d?void 0:_d,_e=_a.onfinish,onfinish_1=void 0===_e?void 0:_e,_f=_a.onframe,onframe_1=void 0===_f?void 0:_f;if(0===duration_1)return this.syncFromLandmark(landmark),void(onfinish_1&&onfinish_1());this.cancelLandmarkAnimation();var timeStart_1,destPosition_1=landmark.position,destFocalPoint_1=landmark.focalPoint,destZoom_1=landmark.zoom,destRoll_1=landmark.roll,easingFunc_1=easingFunction||runtime.EasingFunction(easing),endAnimation_1=function(){_this.setFocalPoint(destFocalPoint_1),_this.setPosition(destPosition_1),_this.setRoll(destRoll_1),_this.setZoom(destZoom_1),_this.computeMatrix(),_this.triggerUpdate(),onfinish_1&&onfinish_1()},animate_1=function(timestamp){void 0===timeStart_1&&(timeStart_1=timestamp);var elapsed=timestamp-timeStart_1;if(elapsed>duration_1)endAnimation_1();else{var interZoom,interRoll,t=easingFunc_1(elapsed/duration_1),interFocalPoint=create(),interPosition=create();lerp(interFocalPoint,_this.focalPoint,destFocalPoint_1,t),lerp(interPosition,_this.position,destPosition_1,t),interRoll=_this.roll*(1-t)+destRoll_1*t,interZoom=_this.zoom*(1-t)+destZoom_1*t,_this.setFocalPoint(interFocalPoint),_this.setPosition(interPosition),_this.setRoll(interRoll),_this.setZoom(interZoom),vec3_dist(interFocalPoint,destFocalPoint_1)+vec3_dist(interPosition,destPosition_1)<=.01&&null==destZoom_1&&null==destRoll_1?endAnimation_1():(_this.computeMatrix(),_this.triggerUpdate(),elapsed<duration_1&&(onframe_1&&onframe_1(t),_this.landmarkAnimationID=_this.canvas.requestAnimationFrame(animate_1)))}};this.canvas.requestAnimationFrame(animate_1)}},AdvancedCamera.prototype.syncFromLandmark=function(landmark){this.matrix=mat4_copy(this.matrix,landmark.matrix),this.right=copy(this.right,landmark.right),this.up=copy(this.up,landmark.up),this.forward=copy(this.forward,landmark.forward),this.position=copy(this.position,landmark.position),this.focalPoint=copy(this.focalPoint,landmark.focalPoint),this.distanceVector=copy(this.distanceVector,landmark.distanceVector),this.azimuth=landmark.azimuth,this.elevation=landmark.elevation,this.roll=landmark.roll,this.relAzimuth=landmark.relAzimuth,this.relElevation=landmark.relElevation,this.relRoll=landmark.relRoll,this.dollyingStep=landmark.dollyingStep,this.distance=landmark.distance,this.zoom=landmark.zoom},AdvancedCamera}(Camera);runtime.CameraContribution=AdvancedCamera;var currentRecord,recordWithOldValue,MutationRecord=function(){function MutationRecord(type,target){this.type=type,this.target=target,this.addedNodes=[],this.attributeName=null,this.attributeNamespace=null,this.nextSibling=null,this.oldValue=null,this.previousSibling=null,this.removedNodes=[]}return MutationRecord.copy=function(original){var record=new MutationRecord(original.type,original.target);return record.addedNodes=original.addedNodes.slice(),record.removedNodes=original.removedNodes.slice(),record.previousSibling=original.previousSibling,record.nextSibling=original.nextSibling,record.attributeName=original.attributeName,record.attributeNamespace=original.attributeNamespace,record.oldValue=original.oldValue,record},MutationRecord}(),uidCounter=0,registrationsTable=new WeakMap,Registration=function(){function Registration(observer,target,options){this.observer=observer,this.target=target,this.options=options,this.transientObservedNodes=[]}return Registration.prototype.enqueue=function(record){var records=this.observer.records,length=records.length;if(records.length>0){var recordToReplaceLast=function selectRecord(lastRecord,newRecord){return lastRecord===newRecord?lastRecord:recordWithOldValue&&function recordRepresentsCurrentMutation(record){return record===recordWithOldValue||record===currentRecord}(lastRecord)?recordWithOldValue:null}(records[length-1],record);if(recordToReplaceLast)return void(records[length-1]=recordToReplaceLast)}else!function scheduleCallback(observer){scheduledObservers.push(observer),isScheduled||(isScheduled=!0,void 0!==runtime.globalThis?runtime.globalThis.setTimeout(dispatchCallbacks):dispatchCallbacks())}(this.observer);records[length]=record},Registration.prototype.addListeners=function(){this.addListeners_(this.target)},Registration.prototype.addListeners_=function(node){var options=this.options;options.attributes&&node.addEventListener(ElementEvent.ATTR_MODIFIED,this,!0),options.childList&&node.addEventListener(ElementEvent.INSERTED,this,!0),(options.childList||options.subtree)&&node.addEventListener(ElementEvent.REMOVED,this,!0)},Registration.prototype.removeListeners=function(){this.removeListeners_(this.target)},Registration.prototype.removeListeners_=function(node){var options=this.options;options.attributes&&node.removeEventListener(ElementEvent.ATTR_MODIFIED,this,!0),options.childList&&node.removeEventListener(ElementEvent.INSERTED,this,!0),(options.childList||options.subtree)&&node.removeEventListener(ElementEvent.REMOVED,this,!0)},Registration.prototype.removeTransientObservers=function(){var transientObservedNodes=this.transientObservedNodes;this.transientObservedNodes=[],transientObservedNodes.forEach((function(node){this.removeListeners_(node);for(var registrations=registrationsTable.get(node),i=0;i<registrations.length;i++)if(registrations[i]===this){registrations.splice(i,1);break}}),this)},Registration.prototype.handleEvent=function(e){var record,target;switch(e.stopImmediatePropagation(),e.type){case ElementEvent.ATTR_MODIFIED:var name_1=e.attrName,namespace_1=e.relatedNode.namespaceURI;target=e.target,(record=getRecord("attributes",target)).attributeName=name_1,record.attributeNamespace=namespace_1;var oldValue_1=e.attrChange===MutationEvent.ADDITION?null:e.prevValue;forEachAncestorAndObserverEnqueueRecord(target,(function(options){if(options.attributes&&(!options.attributeFilter||!options.attributeFilter.length||-1!==options.attributeFilter.indexOf(name_1)||-1!==options.attributeFilter.indexOf(namespace_1)))return options.attributeOldValue?function getRecordWithOldValue(oldValue){return recordWithOldValue||((recordWithOldValue=MutationRecord.copy(currentRecord)).oldValue=oldValue,recordWithOldValue)}(oldValue_1):record}));break;case ElementEvent.REMOVED:case ElementEvent.INSERTED:target=e.relatedNode;var changedNode=e.target,addedNodes=void 0,removedNodes=void 0;e.type===ElementEvent.INSERTED?(addedNodes=[changedNode],removedNodes=[]):(addedNodes=[],removedNodes=[changedNode]);var previousSibling=changedNode.previousSibling,nextSibling=changedNode.nextSibling;(record=getRecord("childList",target)).addedNodes=addedNodes,record.removedNodes=removedNodes,record.previousSibling=previousSibling,record.nextSibling=nextSibling,forEachAncestorAndObserverEnqueueRecord(target,(function(options){if(options.childList)return record}))}!function clearRecords(){currentRecord=recordWithOldValue=void 0}()},Registration}();!function(){function MutationObserver(callback){this.callback=callback,this.nodes=[],this.records=[],this.uid=uidCounter++}MutationObserver.prototype.observe=function(target,options){if(!options.childList&&!options.attributes&&!options.characterData||options.attributeOldValue&&!options.attributes||options.attributeFilter&&options.attributeFilter.length&&!options.attributes||options.characterDataOldValue&&!options.characterData)throw new SyntaxError;var registration,registrations=registrationsTable.get(target);registrations||registrationsTable.set(target,registrations=[]);for(var i=0;i<registrations.length;i++)if(registrations[i].observer===this){(registration=registrations[i]).removeListeners(),registration.options=options;break}registration||(registration=new Registration(this,target,options),registrations.push(registration),this.nodes.push(target)),registration.addListeners()},MutationObserver.prototype.disconnect=function(){var _this=this;this.nodes.forEach((function(node){for(var registrations=registrationsTable.get(node),i=0;i<registrations.length;i++){var registration=registrations[i];if(registration.observer===_this){registration.removeListeners(),registrations.splice(i,1);break}}}),this),this.records=[]},MutationObserver.prototype.takeRecords=function(){var copyOfRecords=this.records;return this.records=[],copyOfRecords}}();function getRecord(type,target){return currentRecord=new MutationRecord(type,target)}function forEachAncestorAndObserverEnqueueRecord(target,callback){for(var node=target;node;node=node.parentNode){var registrations=registrationsTable.get(node);if(registrations)for(var j=0;j<registrations.length;j++){var registration=registrations[j],options=registration.options;if(node===target||options.subtree){var record=callback(options);record&&registration.enqueue(record)}}}}var isScheduled=!1,scheduledObservers=[];function dispatchCallbacks(){isScheduled=!1;var observers=scheduledObservers;scheduledObservers=[],observers.sort((function(o1,o2){return o1.uid-o2.uid}));var anyNonEmpty=!1;observers.forEach((function(observer){var queue=observer.takeRecords();!function removeTransientObserversFor(observer){observer.nodes.forEach((function(node){var registrations=registrationsTable.get(node);registrations&&registrations.forEach((function(registration){registration.observer===observer&&registration.removeTransientObservers()}))}))}(observer),queue.length&&(observer.callback(queue,observer),anyNonEmpty=!0)})),anyNonEmpty&&dispatchCallbacks()}var AnimationEvent=function(_super){function AnimationEvent(manager,target,currentTime,timelineTime){var _this=_super.call(this,manager)||this;return _this.currentTime=currentTime,_this.timelineTime=timelineTime,_this.target=target,_this.type="finish",_this.bubbles=!1,_this.currentTarget=target,_this.defaultPrevented=!1,_this.eventPhase=_this.AT_TARGET,_this.timeStamp=Date.now(),_this.currentTime=currentTime,_this.timelineTime=timelineTime,_this}return(0,tslib_es6.C6)(AnimationEvent,_super),AnimationEvent}(FederatedEvent),sequenceNumber=0,Animation=function(){function Animation(effect,timeline){var _a;this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._playbackRate=1,this._inTimeline=!0,this.effect=effect,effect.animation=this,this.timeline=timeline,this.id="".concat(sequenceNumber++),this._inEffect=!!this.effect.update(0),this._totalDuration=Number(null===(_a=this.effect)||void 0===_a?void 0:_a.getComputedTiming().endTime),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}return Object.defineProperty(Animation.prototype,"pending",{get:function(){return null===this._startTime&&!this._paused&&0!==this.playbackRate||this.currentTimePending},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"playState",{get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"ready",{get:function(){var _this=this;return this.readyPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise((function(resolve,reject){_this.resolveReadyPromise=function(){resolve(_this)},_this.rejectReadyPromise=function(){reject(new Error)}})),this.pending||this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"finished",{get:function(){var _this=this;return this.finishedPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise((function(resolve,reject){_this.resolveFinishedPromise=function(){resolve(_this)},_this.rejectFinishedPromise=function(){reject(new Error)}})),"finished"===this.playState&&this.resolveFinishedPromise()),this.finishedPromise},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"currentTime",{get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(newTime){var _a;newTime=Number(newTime),isNaN(newTime)||(this.timeline.restart(),this._paused||null===this._startTime||(this._startTime=Number(null===(_a=this.timeline)||void 0===_a?void 0:_a.currentTime)-newTime/this.playbackRate),this.currentTimePending=!1,this._currentTime!==newTime&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(newTime,!0),this.timeline.applyDirtiedAnimation(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"startTime",{get:function(){return this._startTime},set:function(newTime){if(null!==newTime){if(this.updatePromises(),newTime=Number(newTime),isNaN(newTime))return;if(this._paused||this._idle)return;this._startTime=newTime,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(value){if(value!==this._playbackRate){this.updatePromises();var oldCurrentTime=this.currentTime;this._playbackRate=value,this.startTime=null,"paused"!==this.playState&&"idle"!==this.playState&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),null!==oldCurrentTime&&(this.currentTime=oldCurrentTime),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"_isFinished",{get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this._totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"totalDuration",{get:function(){return this._totalDuration},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"_needsTick",{get:function(){return this.pending||"running"===this.playState||!this._finishedFlag},enumerable:!1,configurable:!0}),Animation.prototype.updatePromises=function(){var oldPlayState=this.oldPlayState,newPlayState=this.pending?"pending":this.playState;return this.readyPromise&&newPlayState!==oldPlayState&&("idle"===newPlayState?(this.rejectReadyPromise(),this.readyPromise=void 0):"pending"===oldPlayState?this.resolveReadyPromise():"pending"===newPlayState&&(this.readyPromise=void 0)),this.finishedPromise&&newPlayState!==oldPlayState&&("idle"===newPlayState?(this.rejectFinishedPromise(),this.finishedPromise=void 0):"finished"===newPlayState?this.resolveFinishedPromise():"finished"===oldPlayState&&(this.finishedPromise=void 0)),this.oldPlayState=newPlayState,this.readyPromise||this.finishedPromise},Animation.prototype.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),-1===this.timeline.animations.indexOf(this)&&this.timeline.animations.push(this),this.updatePromises()},Animation.prototype.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._isFinished||this._paused||this._idle?this._idle&&(this.rewind(),this._idle=!1):this.currentTimePending=!0,this._startTime=null,this._paused=!0,this.updatePromises()},Animation.prototype.finish=function(){this.updatePromises(),this._idle||(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},Animation.prototype.cancel=function(){var _this=this;if(this.updatePromises(),this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises(),this.oncancel)){var event_1=new AnimationEvent(null,this,this.currentTime,null);setTimeout((function(){_this.oncancel(event_1)}))}},Animation.prototype.reverse=function(){this.updatePromises();var oldCurrentTime=this.currentTime;this.playbackRate*=-1,this.play(),null!==oldCurrentTime&&(this.currentTime=oldCurrentTime),this.updatePromises()},Animation.prototype.updatePlaybackRate=function(playbackRate){this.playbackRate=playbackRate},Animation.prototype.targetAnimations=function(){var _a;return(null===(_a=this.effect)||void 0===_a?void 0:_a.target).getAnimations()},Animation.prototype.markTarget=function(){var animations=this.targetAnimations();-1===animations.indexOf(this)&&animations.push(this)},Animation.prototype.unmarkTarget=function(){var animations=this.targetAnimations(),index=animations.indexOf(this);-1!==index&&animations.splice(index,1)},Animation.prototype.tick=function(timelineTime,isAnimationFrame){this._idle||this._paused||(null===this._startTime?isAnimationFrame&&(this.startTime=timelineTime-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((timelineTime-this._startTime)*this.playbackRate)),isAnimationFrame&&(this.currentTimePending=!1,this.fireEvents(timelineTime))},Animation.prototype.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else{if(!(this._totalDuration<1/0))throw new Error("Unable to rewind negative playback rate animation with infinite duration");this.currentTime=this._totalDuration}},Animation.prototype.persist=function(){throw new Error("Method not implemented.")},Animation.prototype.addEventListener=function(type,listener,options){throw new Error("Method not implemented.")},Animation.prototype.removeEventListener=function(type,listener,options){throw new Error("Method not implemented.")},Animation.prototype.dispatchEvent=function(event){throw new Error("Method not implemented.")},Animation.prototype.commitStyles=function(){throw new Error("Method not implemented.")},Animation.prototype.ensureAlive=function(){var _a,_b;this.playbackRate<0&&0===this.currentTime?this._inEffect=!!(null===(_a=this.effect)||void 0===_a?void 0:_a.update(-1)):this._inEffect=!!(null===(_b=this.effect)||void 0===_b?void 0:_b.update(this.currentTime)),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,this.timeline.animations.push(this))},Animation.prototype.tickCurrentTime=function(newTime,ignoreLimit){newTime!==this._currentTime&&(this._currentTime=newTime,this._isFinished&&!ignoreLimit&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this.ensureAlive())},Animation.prototype.fireEvents=function(baseTime){var _this=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var event_2=new AnimationEvent(null,this,this.currentTime,baseTime);setTimeout((function(){_this.onfinish&&_this.onfinish(event_2)}))}this._finishedFlag=!0}}else{if(this.onframe&&"running"===this.playState){var event_3=new AnimationEvent(null,this,this.currentTime,baseTime);this.onframe(event_3)}this._finishedFlag=!1}},Animation}(),float32ArraySupported="function"==typeof Float32Array,A=function(aA1,aA2){return 1-3*aA2+3*aA1},B=function(aA1,aA2){return 3*aA2-6*aA1},C=function(aA1){return 3*aA1},calcBezier=function(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT},getSlope=function(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)},index_esm_bezier=function(mX1,mY1,mX2,mY2){if(!(0<=mX1&&mX1<=1&&0<=mX2&&mX2<=1))throw new Error("bezier x values must be in [0, 1] range");if(mX1===mY1&&mX2===mY2)return function(t){return t};for(var sampleValues=float32ArraySupported?new Float32Array(11):new Array(11),i=0;i<11;++i)sampleValues[i]=calcBezier(.1*i,mX1,mX2);var getTForX=function(aX){for(var intervalStart=0,currentSample=1;10!==currentSample&&sampleValues[currentSample]<=aX;++currentSample)intervalStart+=.1;--currentSample;var guessForT=intervalStart+.1*((aX-sampleValues[currentSample])/(sampleValues[currentSample+1]-sampleValues[currentSample])),initialSlope=getSlope(guessForT,mX1,mX2);return initialSlope>=.001?function(aX,aGuessT,mX1,mX2){for(var i=0;i<4;++i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(0===currentSlope)return aGuessT;aGuessT-=(calcBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}(aX,guessForT,mX1,mX2):0===initialSlope?guessForT:function(aX,aA,aB,mX1,mX2){var currentX,currentT,i=0;do{(currentX=calcBezier(currentT=aA+(aB-aA)/2,mX1,mX2)-aX)>0?aB=currentT:aA=currentT}while(Math.abs(currentX)>1e-7&&++i<10);return currentT}(aX,intervalStart,intervalStart+.1,mX1,mX2)};return function(t){return 0===t||1===t?t:calcBezier(getTForX(t),mY1,mY2)}},Quad=function(t){return Math.pow(t,2)},Cubic=function(t){return Math.pow(t,3)},Quart=function(t){return Math.pow(t,4)},Quint=function(t){return Math.pow(t,5)},Expo=function(t){return Math.pow(t,6)},Sine=function(t){return 1-Math.cos(t*Math.PI/2)},Circ=function(t){return 1-Math.sqrt(1-t*t)},Back=function(t){return t*t*(3*t-2)},Bounce=function(t){for(var pow2,b=4;t<((pow2=Math.pow(2,--b))-1)/11;);return 1/Math.pow(4,3-b)-7.5625*Math.pow((3*pow2-2)/22-t,2)},Elastic=function(t,params){void 0===params&&(params=[]);var _a=(0,tslib_es6.zs)(params,2),_b=_a[0],amplitude=void 0===_b?1:_b,_c=_a[1],period=void 0===_c?.5:_c,a=lodash_clamp(Number(amplitude),1,10),p=lodash_clamp(Number(period),.1,2);return 0===t||1===t?t:-a*Math.pow(2,10*(t-1))*Math.sin((t-1-p/(2*Math.PI)*Math.asin(1/a))*(2*Math.PI)/p)},Spring=function(t,params,duration){void 0===params&&(params=[]);var _a=(0,tslib_es6.zs)(params,4),_b=_a[0],mass=void 0===_b?1:_b,_c=_a[1],stiffness=void 0===_c?100:_c,_d=_a[2],damping=void 0===_d?10:_d,_e=_a[3],velocity=void 0===_e?0:_e;mass=lodash_clamp(mass,.1,1e3),stiffness=lodash_clamp(stiffness,.1,1e3),damping=lodash_clamp(damping,.1,1e3),velocity=lodash_clamp(velocity,.1,1e3);var w0=Math.sqrt(stiffness/mass),zeta=damping/(2*Math.sqrt(stiffness*mass)),wd=zeta<1?w0*Math.sqrt(1-zeta*zeta):0,b=zeta<1?(zeta*w0-velocity)/wd:-velocity+w0,progress=duration?duration*t/1e3:t;return progress=zeta<1?Math.exp(-progress*zeta*w0)*(1*Math.cos(wd*progress)+b*Math.sin(wd*progress)):(1+b*progress)*Math.exp(-progress*w0),0===t||1===t?t:1-progress},Steps=function(t,params){void 0===params&&(params=[]);var _a=(0,tslib_es6.zs)(params,2),_b=_a[0],steps=void 0===_b?10:_b;return("start"==_a[1]?Math.ceil:Math.floor)(lodash_clamp(t,0,1)*steps)/steps},Bezier=function(t,params){void 0===params&&(params=[]);var _a=(0,tslib_es6.zs)(params,4),mX1=_a[0],mY1=_a[1],mX2=_a[2],mY2=_a[3];return index_esm_bezier(mX1,mY1,mX2,mY2)(t)},easein=index_esm_bezier(.42,0,1,1),EaseOut=function(ease){return function(t,params,duration){return void 0===params&&(params=[]),1-ease(1-t,params,duration)}},EaseInOut=function(ease){return function(t,params,duration){return void 0===params&&(params=[]),t<.5?ease(2*t,params,duration)/2:1-ease(-2*t+2,params,duration)/2}},EaseOutIn=function(ease){return function(t,params,duration){return void 0===params&&(params=[]),t<.5?(1-ease(1-2*t,params,duration))/2:(ease(2*t-1,params,duration)+1)/2}},EasingFunctions={steps:Steps,"step-start":function(t){return Steps(t,[1,"start"])},"step-end":function(t){return Steps(t,[1,"end"])},linear:function(t){return t},"cubic-bezier":Bezier,ease:function(t){return Bezier(t,[.25,.1,.25,1])},in:easein,out:EaseOut(easein),"in-out":EaseInOut(easein),"out-in":EaseOutIn(easein),"in-quad":Quad,"out-quad":EaseOut(Quad),"in-out-quad":EaseInOut(Quad),"out-in-quad":EaseOutIn(Quad),"in-cubic":Cubic,"out-cubic":EaseOut(Cubic),"in-out-cubic":EaseInOut(Cubic),"out-in-cubic":EaseOutIn(Cubic),"in-quart":Quart,"out-quart":EaseOut(Quart),"in-out-quart":EaseInOut(Quart),"out-in-quart":EaseOutIn(Quart),"in-quint":Quint,"out-quint":EaseOut(Quint),"in-out-quint":EaseInOut(Quint),"out-in-quint":EaseOutIn(Quint),"in-expo":Expo,"out-expo":EaseOut(Expo),"in-out-expo":EaseInOut(Expo),"out-in-expo":EaseOutIn(Expo),"in-sine":Sine,"out-sine":EaseOut(Sine),"in-out-sine":EaseInOut(Sine),"out-in-sine":EaseOutIn(Sine),"in-circ":Circ,"out-circ":EaseOut(Circ),"in-out-circ":EaseInOut(Circ),"out-in-circ":EaseOutIn(Circ),"in-back":Back,"out-back":EaseOut(Back),"in-out-back":EaseInOut(Back),"out-in-back":EaseOutIn(Back),"in-bounce":Bounce,"out-bounce":EaseOut(Bounce),"in-out-bounce":EaseInOut(Bounce),"out-in-bounce":EaseOutIn(Bounce),"in-elastic":Elastic,"out-elastic":EaseOut(Elastic),"in-out-elastic":EaseInOut(Elastic),"out-in-elastic":EaseOutIn(Elastic),spring:Spring,"spring-in":Spring,"spring-out":EaseOut(Spring),"spring-in-out":EaseInOut(Spring),"spring-out-in":EaseOutIn(Spring)},getEasingFunction=function(ease){return EasingFunctions[function(ease){return function(str){return"-"===(str=str.replace(/([A-Z])/g,(function(letter){return"-".concat(letter.toLowerCase())}))).charAt(0)?str.substring(1):str}(ease).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim()}(ease)]||EasingFunctions.linear},linear=function(x){return x},Start=1,Middle=.5,End=0;function step(count,pos){return function(x){if(x>=1)return 1;var stepSize=1/count;return(x+=pos*stepSize)-x%stepSize}}var numberString="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",cubicBezierRe=new RegExp("cubic-bezier\\("+numberString+","+numberString+","+numberString+","+numberString+"\\)"),step1Re=/steps\(\s*(\d+)\s*\)/,step2Re=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function parseEasingFunction(normalizedEasing){var cubicData=cubicBezierRe.exec(normalizedEasing);if(cubicData)return index_esm_bezier.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(cubicData.slice(1).map(Number)),!1));var step1Data=step1Re.exec(normalizedEasing);if(step1Data)return step(Number(step1Data[1]),End);var step2Data=step2Re.exec(normalizedEasing);return step2Data?step(Number(step2Data[1]),{start:Start,middle:Middle,end:End}[step2Data[2]]):getEasingFunction(normalizedEasing)}function calculateActiveDuration(timing){return Math.abs(function repeatedDuration(timing){var _a;if(0===timing.duration||0===timing.iterations)return 0;return("auto"===timing.duration?0:Number(timing.duration))*(null!==(_a=timing.iterations)&&void 0!==_a?_a:1)}(timing)/(timing.playbackRate||1))}var PhaseNone=0,PhaseBefore=1,PhaseAfter=2,PhaseActive=3;function calculateIterationProgress(activeDuration,localTime,timing){var phase=function calculatePhase(activeDuration,localTime,timing){if(null===localTime)return PhaseNone;var endTime=timing.endTime;return localTime<Math.min(timing.delay,endTime)?PhaseBefore:localTime>=Math.min(timing.delay+activeDuration+timing.endDelay,endTime)?PhaseAfter:PhaseActive}(activeDuration,localTime,timing),activeTime=function calculateActiveTime(activeDuration,fillMode,localTime,phase,delay){switch(phase){case PhaseBefore:return"backwards"===fillMode||"both"===fillMode?0:null;case PhaseActive:return localTime-delay;case PhaseAfter:return"forwards"===fillMode||"both"===fillMode?activeDuration:null;case PhaseNone:return null}}(activeDuration,timing.fill,localTime,phase,timing.delay);if(null===activeTime)return null;var duration="auto"===timing.duration?0:timing.duration,overallProgress=function calculateOverallProgress(iterationDuration,phase,iterations,activeTime,iterationStart){var overallProgress=iterationStart;return 0===iterationDuration?phase!==PhaseBefore&&(overallProgress+=iterations):overallProgress+=activeTime/iterationDuration,overallProgress}(duration,phase,timing.iterations,activeTime,timing.iterationStart),simpleIterationProgress=function calculateSimpleIterationProgress(overallProgress,iterationStart,phase,iterations,activeTime,iterationDuration){var simpleIterationProgress=overallProgress===1/0?iterationStart%1:overallProgress%1;return 0!==simpleIterationProgress||phase!==PhaseAfter||0===iterations||0===activeTime&&0!==iterationDuration||(simpleIterationProgress=1),simpleIterationProgress}(overallProgress,timing.iterationStart,phase,timing.iterations,activeTime,duration),currentIteration=function calculateCurrentIteration(phase,iterations,simpleIterationProgress,overallProgress){return phase===PhaseAfter&&iterations===1/0?1/0:1===simpleIterationProgress?Math.floor(overallProgress)-1:Math.floor(overallProgress)}(phase,timing.iterations,simpleIterationProgress,overallProgress),directedProgress=function calculateDirectedProgress(playbackDirection,currentIteration,simpleIterationProgress){var currentDirection=playbackDirection;if("normal"!==playbackDirection&&"reverse"!==playbackDirection){var d=currentIteration;"alternate-reverse"===playbackDirection&&(d+=1),currentDirection="normal",d!==1/0&&d%2!=0&&(currentDirection="reverse")}return"normal"===currentDirection?simpleIterationProgress:1-simpleIterationProgress}(timing.direction,currentIteration,simpleIterationProgress);return timing.currentIteration=currentIteration,timing.progress=directedProgress,timing.easingFunction(directedProgress)}function convertEffectInput(keyframes,timing,target){var propertySpecificKeyframeGroups=function makePropertySpecificKeyframeGroups(keyframes,timing){for(var propertySpecificKeyframeGroups={},i=0;i<keyframes.length;i++)for(var member in keyframes[i])if(isNotReservedWord(member)){var propertySpecificKeyframe={offset:keyframes[i].offset,computedOffset:keyframes[i].computedOffset,easing:keyframes[i].easing,easingFunction:parseEasingFunction(keyframes[i].easing)||timing.easingFunction,value:keyframes[i][member]};propertySpecificKeyframeGroups[member]=propertySpecificKeyframeGroups[member]||[],propertySpecificKeyframeGroups[member].push(propertySpecificKeyframe)}return propertySpecificKeyframeGroups}(keyframes,timing),interpolations=function makeInterpolations(propertySpecificKeyframeGroups,target){var interpolations=[];for(var groupName in propertySpecificKeyframeGroups)for(var keyframes=propertySpecificKeyframeGroups[groupName],i=0;i<keyframes.length-1;i++){var startIndex=i,endIndex=i+1,startOffset=keyframes[startIndex].computedOffset,endOffset=keyframes[endIndex].computedOffset,applyFrom=startOffset,applyTo=endOffset;0===i&&(applyFrom=-1/0,0===endOffset&&(endIndex=startIndex)),i===keyframes.length-2&&(applyTo=1/0,1===startOffset&&(startIndex=endIndex)),interpolations.push({applyFrom,applyTo,startOffset:keyframes[startIndex].computedOffset,endOffset:keyframes[endIndex].computedOffset,easingFunction:keyframes[startIndex].easingFunction,property:groupName,interpolation:propertyInterpolation(groupName,keyframes[startIndex].value,keyframes[endIndex].value,target)})}return interpolations.sort((function(leftInterpolation,rightInterpolation){return leftInterpolation.startOffset-rightInterpolation.startOffset})),interpolations}(propertySpecificKeyframeGroups,target);return function(target,fraction){if(null!==fraction)interpolations.filter((function(interpolation){return fraction>=interpolation.applyFrom&&fraction<interpolation.applyTo})).forEach((function(interpolation){var offsetFraction=fraction-interpolation.startOffset,localDuration=interpolation.endOffset-interpolation.startOffset,scaledLocalTime=0===localDuration?0:interpolation.easingFunction(offsetFraction/localDuration);target.setAttribute(interpolation.property,interpolation.interpolation(scaledLocalTime),!1,!1)}));else for(var property in propertySpecificKeyframeGroups)isNotReservedWord(property)&&target.setAttribute(property,null)}}function isNotReservedWord(member){return"offset"!==member&&"easing"!==member&&"composite"!==member&&"computedOffset"!==member}var InterpolationFactory=function(from,to,convertToString){return function(f){var interpolated=interpolate(from,to,f);return!runtime.enableCSSParsing&&(0,is_number.A)(interpolated)?interpolated:convertToString(interpolated)}};function propertyInterpolation(property,left,right,target){var metadata=propertyMetadataCache[property];if(metadata&&metadata.syntax&&metadata.int){var propertyHandler=runtime.styleValueRegistry.getPropertySyntax(metadata.syntax);if(propertyHandler){var usedLeft=void 0,usedRight=void 0;if(runtime.enableCSSParsing){var computedLeft=runtime.styleValueRegistry.parseProperty(property,left,target,!1),computedRight=runtime.styleValueRegistry.parseProperty(property,right,target,!1);usedLeft=runtime.styleValueRegistry.computeProperty(property,computedLeft,target,!1),usedRight=runtime.styleValueRegistry.computeProperty(property,computedRight,target,!1)}else{var parser=propertyHandler.parserWithCSSDisabled;usedLeft=parser?parser(left,target):left,usedRight=parser?parser(right,target):right}var interpolationArgs=propertyHandler.mixer(usedLeft,usedRight,target);if(interpolationArgs){var interp_1=InterpolationFactory.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(interpolationArgs),!1));return function(t){return 0===t?left:1===t?right:interp_1(t)}}}}return InterpolationFactory(!1,!0,(function(bool){return bool?right:left}))}function interpolate(from,to,f){if("number"==typeof from&&"number"==typeof to)return from*(1-f)+to*f;if("boolean"==typeof from&&"boolean"==typeof to||"string"==typeof from&&"string"==typeof to)return f<.5?from:to;if(Array.isArray(from)&&Array.isArray(to)){for(var fromLength=from.length,toLength=to.length,length_1=Math.max(fromLength,toLength),r=[],i=0;i<length_1;i++)r.push(interpolate(from[i<fromLength?i:fromLength-1],to[i<toLength?i:toLength-1],f));return r}throw new Error("Mismatched interpolation arguments "+from+":"+to)}var AnimationEffectTiming=function(){function AnimationEffectTiming(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=linear,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.currentIteration=null,this.progress=null}return Object.defineProperty(AnimationEffectTiming.prototype,"easing",{get:function(){return this._easing},set:function(value){this.easingFunction=parseEasingFunction(value),this._easing=value},enumerable:!1,configurable:!0}),AnimationEffectTiming}();function normalizeKeyframes(effectInput,timing){if(null===effectInput)return[];Array.isArray(effectInput)||(effectInput=function convertToArrayForm(effectInput){var normalizedEffectInput=[];for(var property in effectInput)if(!(property in["easing","offset","composite"])){var values=effectInput[property];Array.isArray(values)||(values=[values]);for(var numKeyframes=values.length,i=0;i<numKeyframes;i++){if(!normalizedEffectInput[i]){var keyframe={};"offset"in effectInput&&(keyframe.offset=Number(effectInput.offset)),"easing"in effectInput&&(keyframe.easing=effectInput.easing),"composite"in effectInput&&(keyframe.composite=effectInput.composite),normalizedEffectInput[i]=keyframe}void 0!==values[i]&&null!==values[i]&&(normalizedEffectInput[i][property]=values[i])}}return normalizedEffectInput.sort((function(a,b){return(a.computedOffset||0)-(b.computedOffset||0)})),normalizedEffectInput}(effectInput));for(var keyframes=effectInput.map((function(originalKeyframe){var keyframe={};for(var member in(null==timing?void 0:timing.composite)&&(keyframe.composite="auto"),originalKeyframe){var memberValue=originalKeyframe[member];if("offset"===member){if(null!==memberValue){if(memberValue=Number(memberValue),!isFinite(memberValue))throw new Error("Keyframe offsets must be numbers.");if(memberValue<0||memberValue>1)throw new Error("Keyframe offsets must be between 0 and 1.");keyframe.computedOffset=memberValue}}else if("composite"===member&&-1===["replace","add","accumulate","auto"].indexOf(memberValue))throw new Error("".concat(memberValue," compositing is not supported"));keyframe[member]=memberValue}return void 0===keyframe.offset&&(keyframe.offset=null),void 0===keyframe.easing&&(keyframe.easing=(null==timing?void 0:timing.easing)||"linear"),void 0===keyframe.composite&&(keyframe.composite="auto"),keyframe})),everyFrameHasOffset=!0,previousOffset=-1/0,i=0;i<keyframes.length;i++){var offset=keyframes[i].offset;if((0,is_nil.A)(offset))everyFrameHasOffset=!1;else{if(offset<previousOffset)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");previousOffset=offset}}return keyframes=keyframes.filter((function(keyframe){return Number(keyframe.offset)>=0&&Number(keyframe.offset)<=1})),everyFrameHasOffset||function spaceKeyframes(){var _a,_b,length=keyframes.length;keyframes[length-1].computedOffset=Number(null!==(_a=keyframes[length-1].offset)&&void 0!==_a?_a:1),length>1&&(keyframes[0].computedOffset=Number(null!==(_b=keyframes[0].offset)&&void 0!==_b?_b:0));for(var previousIndex=0,previousOffset=Number(keyframes[0].computedOffset),i=1;i<length;i++){var offset=keyframes[i].computedOffset;if(!(0,is_nil.A)(offset)&&!(0,is_nil.A)(previousOffset)){for(var j=1;j<i-previousIndex;j++)keyframes[previousIndex+j].computedOffset=previousOffset+(Number(offset)-previousOffset)*j/(i-previousIndex);previousIndex=i,previousOffset=Number(offset)}}}(),keyframes}var fills="backwards|forwards|both|none".split("|"),directions="reverse|alternate|alternate-reverse".split("|");function normalizeTimingInput(timingInput,forGroup){return function makeTiming(timingInput,forGroup){var timing=new AnimationEffectTiming;return forGroup&&(timing.fill="both",timing.duration="auto"),"number"!=typeof timingInput||isNaN(timingInput)?void 0!==timingInput&&Object.keys(timingInput).forEach((function(property){if(void 0!==timingInput[property]&&null!==timingInput[property]&&"auto"!==timingInput[property]){if(("number"==typeof timing[property]||"duration"===property)&&("number"!=typeof timingInput[property]||isNaN(timingInput[property])))return;if("fill"===property&&-1===fills.indexOf(timingInput[property]))return;if("direction"===property&&-1===directions.indexOf(timingInput[property]))return;timing[property]=timingInput[property]}})):timing.duration=timingInput,timing}(timingInput=function numericTimingToObject(timingInput){"number"==typeof timingInput&&(timingInput=isNaN(timingInput)?{duration:"auto"}:{duration:timingInput});return timingInput}(null!=timingInput?timingInput:{duration:"auto"}),forGroup)}var KeyframeEffect=function(){function KeyframeEffect(target,effectInput,timingInput){var _this=this;this.composite="replace",this.iterationComposite="replace",this.target=target,this.timing=normalizeTimingInput(timingInput,!1),this.timing.effect=this,this.timing.activeDuration=calculateActiveDuration(this.timing),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=normalizeKeyframes(effectInput,this.timing),this.interpolations=convertEffectInput(this.normalizedKeyframes,this.timing,this.target);var Proxy=runtime.globalThis.Proxy;this.computedTiming=Proxy?new Proxy(this.timing,{get:function(target,prop){return"duration"===prop?"auto"===target.duration?0:target.duration:"fill"===prop?"auto"===target.fill?"none":target.fill:"localTime"===prop?_this.animation&&_this.animation.currentTime||null:"currentIteration"===prop?_this.animation&&"running"===_this.animation.playState?target.currentIteration||0:null:"progress"===prop?_this.animation&&"running"===_this.animation.playState?target.progress||0:null:target[prop]},set:function(){return!0}}):this.timing}return KeyframeEffect.prototype.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},KeyframeEffect.prototype.update=function(localTime){return null!==localTime&&(this.timeFraction=calculateIterationProgress(this.timing.activeDuration,localTime,this.timing),null!==this.timeFraction)},KeyframeEffect.prototype.getKeyframes=function(){return this.normalizedKeyframes},KeyframeEffect.prototype.setKeyframes=function(keyframes){this.normalizedKeyframes=normalizeKeyframes(keyframes)},KeyframeEffect.prototype.getComputedTiming=function(){return this.computedTiming},KeyframeEffect.prototype.getTiming=function(){return this.timing},KeyframeEffect.prototype.updateTiming=function(timing){var _this=this;Object.keys(timing||{}).forEach((function(name){_this.timing[name]=timing[name]}))},KeyframeEffect}();function compareAnimations(leftAnimation,rightAnimation){return Number(leftAnimation.id)-Number(rightAnimation.id)}var AnimationTimeline=function(){function AnimationTimeline(document){var _this=this;this.document=document,this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.webAnimationsNextTick=function(t){_this.currentTime=t,_this.discardAnimations(),0===_this.animations.length?_this.timelineTicking=!1:_this.requestAnimationFrame(_this.webAnimationsNextTick)},this.processRafCallbacks=function(t){var processing=_this.rafCallbacks;_this.rafCallbacks=[],t<Number(_this.currentTime)&&(t=Number(_this.currentTime)),_this.animations.sort(compareAnimations),_this.animations=_this.tick(t,!0,_this.animations)[0],processing.forEach((function(entry){entry[1](t)})),_this.applyPendingEffects()}}return AnimationTimeline.prototype.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},AnimationTimeline.prototype.isTicking=function(){return this.inTick},AnimationTimeline.prototype.play=function(target,keyframes,options){var effect=new KeyframeEffect(target,keyframes,options),animation=new Animation(effect,this);return this.animations.push(animation),this.restartWebAnimationsNextTick(),animation.updatePromises(),animation.play(),animation.updatePromises(),animation},AnimationTimeline.prototype.applyDirtiedAnimation=function(animation){var _this=this;if(!this.inTick){animation.markTarget();var animations=animation.targetAnimations();animations.sort(compareAnimations),this.tick(Number(this.currentTime),!1,animations.slice())[1].forEach((function(animation){var index=_this.animations.indexOf(animation);-1!==index&&_this.animations.splice(index,1)})),this.applyPendingEffects()}},AnimationTimeline.prototype.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame((function(){})),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},AnimationTimeline.prototype.destroy=function(){this.document.defaultView.cancelAnimationFrame(this.frameId)},AnimationTimeline.prototype.applyPendingEffects=function(){this.pendingEffects.forEach((function(effect){null==effect||effect.applyInterpolations()})),this.pendingEffects=[]},AnimationTimeline.prototype.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter((function(animation){return animation.updatePromises()}))},AnimationTimeline.prototype.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter((function(animation){return"finished"!==animation.playState&&"idle"!==animation.playState}))},AnimationTimeline.prototype.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},AnimationTimeline.prototype.rAF=function(f){var id=this.rafId++;return 0===this.rafCallbacks.length&&(this.frameId=this.document.defaultView.requestAnimationFrame(this.processRafCallbacks)),this.rafCallbacks.push([id,f]),id},AnimationTimeline.prototype.requestAnimationFrame=function(f){var _this=this;return this.rAF((function(x){_this.updateAnimationsPromises(),f(x),_this.updateAnimationsPromises()}))},AnimationTimeline.prototype.tick=function(t,isAnimationFrame,updatingAnimations){var _a,_b,_this=this;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=t,this.ticking=!1;var newPendingClears=[],newPendingEffects=[],activeAnimations=[],inactiveAnimations=[];return updatingAnimations.forEach((function(animation){animation.tick(t,isAnimationFrame),animation._inEffect?(newPendingEffects.push(animation.effect),animation.markTarget()):(newPendingClears.push(animation.effect),animation.unmarkTarget()),animation._needsTick&&(_this.ticking=!0);var alive=animation._inEffect||animation._needsTick;animation._inTimeline=alive,alive?activeAnimations.push(animation):inactiveAnimations.push(animation)})),(_a=this.pendingEffects).push.apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(newPendingClears),!1)),(_b=this.pendingEffects).push.apply(_b,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(newPendingEffects),!1)),this.ticking&&this.requestAnimationFrame((function(){})),this.inTick=!1,[activeAnimations,inactiveAnimations]},AnimationTimeline}();runtime.EasingFunction=parseEasingFunction,runtime.AnimationTimeline=AnimationTimeline;var esm=__webpack_require__("./node_modules/@antv/event-emitter/esm/index.js");const is_array_like=function(value){return null!==value&&"function"!=typeof value&&isFinite(value.length)};var get_type_toString={}.toString;const get_type=function(value){return get_type_toString.call(value).replace(/^\[object /,"").replace(/]$/,"")};var objectProto=Object.prototype;const is_prototype=function(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)};var is_empty_hasOwnProperty=Object.prototype.hasOwnProperty;const is_empty=function isEmpty(value){if((0,is_nil.A)(value))return!0;if(is_array_like(value))return!value.length;var type=get_type(value);if("Map"===type||"Set"===type)return!value.size;if(is_prototype(value))return!Object.keys(value).length;for(var key in value)if(is_empty_hasOwnProperty.call(value,key))return!1;return!0};const is_object_like=function(value){return"object"==typeof value&&null!==value};var is_equal_isEqual=function(value,other){if(value===other)return!0;if(!value||!other)return!1;if((0,is_string.A)(value)||(0,is_string.A)(other))return!1;if(is_array_like(value)||is_array_like(other)){if(value.length!==other.length)return!1;for(var rst=!0,i=0;i<value.length&&(rst=is_equal_isEqual(value[i],other[i]));i++);return rst}if(is_object_like(value)||is_object_like(other)){var valueKeys=Object.keys(value),otherKeys=Object.keys(other);if(valueKeys.length!==otherKeys.length)return!1;for(rst=!0,i=0;i<valueKeys.length&&(rst=is_equal_isEqual(value[valueKeys[i]],other[valueKeys[i]]));i++);return rst}return!1};const is_equal=is_equal_isEqual;var is_function=__webpack_require__("./node_modules/@antv/util/esm/lodash/is-function.js"),group_by_hasOwnProperty=Object.prototype.hasOwnProperty;const group_by=function group_by_groupBy(data,condition){if(!condition||!(0,is_array.A)(data))return{};for(var key,result={},predicate=(0,is_function.A)(condition)?condition:function(item){return item[condition]},i=0;i<data.length;i++){var item=data[i];key=predicate(item),group_by_hasOwnProperty.call(result,key)?result[key].push(item):result[key]=[item]}return result};const lodash_map=function(arr,func){if(!is_array_like(arr))return arr;for(var result=[],index=0;index<arr.length;index++){var value=arr[index];result.push(func(value,index))}return result};var lodash_clone=__webpack_require__("./node_modules/@antv/util/esm/lodash/clone.js");function generatePath$6(context,parsedStyle){var r=parsedStyle.r;context.arc(r,r,r,0,2*Math.PI,!1)}function generatePath$5(context,parsedStyle){var rx=parsedStyle.rx,ry=parsedStyle.ry;if(context.ellipse)context.ellipse(rx,ry,rx,ry,0,0,2*Math.PI,!1);else{var r=rx>ry?rx:ry,scaleX=rx>ry?1:rx/ry,scaleY=rx>ry?ry/rx:1;context.save(),context.scale(scaleX,scaleY),context.arc(r,r,r,0,2*Math.PI)}}function generatePath$4(context,parsedStyle){var x,y,x1=parsedStyle.x1,y1=parsedStyle.y1,x2=parsedStyle.x2,y2=parsedStyle.y2,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=x2-x1,y=y2-y1,rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=x1-x2,y=y1-y2,rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)),context.moveTo(x1-defX+startOffsetX,y1-defY+startOffsetY),context.lineTo(x2-defX+endOffsetX,y2-defY+endOffsetY)}function generatePath$3(context,parsedStyle){var x,y,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,_c=parsedStyle.path,absolutePath=_c.absolutePath,segments=_c.segments,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;if(markerStart&&isDisplayObject(markerStart)&&markerStartOffset){var _d=(0,tslib_es6.zs)(markerStart.parentNode.getStartTangent(),2),p1=_d[0],p2=_d[1];x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)}if(markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset){var _e=(0,tslib_es6.zs)(markerEnd.parentNode.getEndTangent(),2);p1=_e[0],p2=_e[1];x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)}for(var i=0;i<absolutePath.length;i++){var params=absolutePath[i],command=params[0],nextSegment=absolutePath[i+1],useStartOffset=0===i&&(0!==startOffsetX||0!==startOffsetY),useEndOffset=(i===absolutePath.length-1||nextSegment&&("M"===nextSegment[0]||"Z"===nextSegment[0]))&&0!==endOffsetX&&0!==endOffsetY;switch(command){case"M":useStartOffset?(context.moveTo(params[1]-defX+startOffsetX,params[2]-defY+startOffsetY),context.lineTo(params[1]-defX,params[2]-defY)):context.moveTo(params[1]-defX,params[2]-defY);break;case"L":useEndOffset?context.lineTo(params[1]-defX+endOffsetX,params[2]-defY+endOffsetY):context.lineTo(params[1]-defX,params[2]-defY);break;case"Q":context.quadraticCurveTo(params[1]-defX,params[2]-defY,params[3]-defX,params[4]-defY),useEndOffset&&context.lineTo(params[3]-defX+endOffsetX,params[4]-defY+endOffsetY);break;case"C":context.bezierCurveTo(params[1]-defX,params[2]-defY,params[3]-defX,params[4]-defY,params[5]-defX,params[6]-defY),useEndOffset&&context.lineTo(params[5]-defX+endOffsetX,params[6]-defY+endOffsetY);break;case"A":var arcParams=segments[i].arcParams,cx=arcParams.cx,cy=arcParams.cy,rx=arcParams.rx,ry=arcParams.ry,startAngle=arcParams.startAngle,endAngle=arcParams.endAngle,xRotation=arcParams.xRotation,sweepFlag=arcParams.sweepFlag;if(context.ellipse)context.ellipse(cx-defX,cy-defY,rx,ry,xRotation,startAngle,endAngle,!!(1-sweepFlag));else{var r=rx>ry?rx:ry,scaleX=rx>ry?1:rx/ry,scaleY=rx>ry?ry/rx:1;context.translate(cx-defX,cy-defY),context.rotate(xRotation),context.scale(scaleX,scaleY),context.arc(0,0,r,startAngle,endAngle,!!(1-sweepFlag)),context.scale(1/scaleX,1/scaleY),context.rotate(-xRotation),context.translate(-(cx-defX),-(cy-defY))}useEndOffset&&context.lineTo(params[6]-defX+endOffsetX,params[7]-defY+endOffsetY);break;case"Z":context.closePath()}}}function generatePath$2(context,parsedStyle){var x,y,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,points=parsedStyle.points.points,length=points.length,x1=points[0][0]-defX,y1=points[0][1]-defY,x2=points[length-1][0]-defX,y2=points[length-1][1]-defY,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=points[1][0]-points[0][0],y=points[1][1]-points[0][1],rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=points[length-1][0]-points[0][0],y=points[length-1][1]-points[0][1],rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)),context.moveTo(x1+(startOffsetX||endOffsetX),y1+(startOffsetY||endOffsetY));for(var i=1;i<length-1;i++){var point=points[i];context.lineTo(point[0]-defX,point[1]-defY)}context.lineTo(x2,y2)}function generatePath$1(context,parsedStyle){var x,y,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,points=parsedStyle.points.points,length=points.length,x1=points[0][0]-defX,y1=points[0][1]-defY,x2=points[length-1][0]-defX,y2=points[length-1][1]-defY,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=points[1][0]-points[0][0],y=points[1][1]-points[0][1],rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=points[length-2][0]-points[length-1][0],y=points[length-2][1]-points[length-1][1],rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)),context.moveTo(x1+startOffsetX,y1+startOffsetY);for(var i=1;i<length-1;i++){var point=points[i];context.lineTo(point[0]-defX,point[1]-defY)}context.lineTo(x2+endOffsetX,y2+endOffsetY)}function generatePath(context,parsedStyle){var radius=parsedStyle.radius,width=parsedStyle.width,height=parsedStyle.height,w=width,h=height;if(radius&&radius.some((function(r){return 0!==r}))){var signX=width>0?1:-1,signY=height>0?1:-1,sweepFlag=signX+signY===0,_a=(0,tslib_es6.zs)(radius.map((function(r){return lodash_clamp(r,0,Math.min(Math.abs(w)/2,Math.abs(h)/2))})),4),tlr=_a[0],trr=_a[1],brr=_a[2],blr=_a[3];context.moveTo(signX*tlr,0),context.lineTo(w-signX*trr,0),0!==trr&&context.arc(w-signX*trr,signY*trr,trr,-signY*Math.PI/2,signX>0?0:Math.PI,sweepFlag),context.lineTo(w,h-signY*brr),0!==brr&&context.arc(w-signX*brr,h-signY*brr,brr,signX>0?0:Math.PI,signY>0?Math.PI/2:1.5*Math.PI,sweepFlag),context.lineTo(signX*blr,h),0!==blr&&context.arc(signX*blr,h-signY*blr,blr,signY>0?Math.PI/2:-Math.PI/2,signX>0?Math.PI:0,sweepFlag),context.lineTo(0,signY*tlr),0!==tlr&&context.arc(signX*tlr,signY*tlr,tlr,signX>0?Math.PI:0,signY>0?1.5*Math.PI:Math.PI/2,sweepFlag)}else context.rect(0,0,w,h)}var Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="canvas-path-generator",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){var _a,pathGeneratorFactory=((_a={})[Shape.CIRCLE]=generatePath$6,_a[Shape.ELLIPSE]=generatePath$5,_a[Shape.RECT]=generatePath,_a[Shape.LINE]=generatePath$4,_a[Shape.POLYLINE]=generatePath$1,_a[Shape.POLYGON]=generatePath$2,_a[Shape.PATH]=generatePath$3,_a[Shape.TEXT]=void 0,_a[Shape.GROUP]=void 0,_a[Shape.IMAGE]=void 0,_a[Shape.HTML]=void 0,_a[Shape.MESH]=void 0,_a);this.context.pathGeneratorFactory=pathGeneratorFactory},Plugin.prototype.destroy=function(){delete this.context.pathGeneratorFactory},Plugin}(AbstractRendererPlugin),tmpVec3a=create(),tmpVec3b=create(),tmpVec3c=create(),index_esm_tmpMat4=mat4_create(),CanvasPickerPlugin=function(){function CanvasPickerPlugin(){var _this=this;this.isHit=function(displayObject,position,worldTransform,isClipPath){var pick=_this.context.pointInPathPickerFactory[displayObject.nodeName];if(pick){var invertWorldMat=invert(index_esm_tmpMat4,worldTransform),localPosition=transformMat4(tmpVec3b,set(tmpVec3c,position[0],position[1],0),invertWorldMat),halfExtents=displayObject.getGeometryBounds().halfExtents,anchor=displayObject.parsedStyle.anchor;if(localPosition[0]+=(anchor&&anchor[0]||0)*halfExtents[0]*2,localPosition[1]+=(anchor&&anchor[1]||0)*halfExtents[1]*2,pick(displayObject,new Point(localPosition[0],localPosition[1]),isClipPath,_this.isPointInPath,_this.context,_this.runtime))return!0}return!1},this.isPointInPath=function(displayObject,position){var context=_this.runtime.offscreenCanvasCreator.getOrCreateContext(_this.context.config.offscreenCanvas),generatePath=_this.context.pathGeneratorFactory[displayObject.nodeName];return generatePath&&(context.beginPath(),generatePath(context,displayObject.parsedStyle),context.closePath()),context.isPointInPath(position.x,position.y)}}return CanvasPickerPlugin.prototype.apply=function(context,runtime){var _a,_this=this,renderingService=context.renderingService,renderingContext=context.renderingContext;this.context=context,this.runtime=runtime;var document=null===(_a=renderingContext.root)||void 0===_a?void 0:_a.ownerDocument;renderingService.hooks.pick.tapPromise(CanvasPickerPlugin.tag,(function(result){return(0,tslib_es6.sH)(_this,void 0,void 0,(function(){return(0,tslib_es6.YH)(this,(function(_a){return[2,this.pick(document,result)]}))}))})),renderingService.hooks.pickSync.tap(CanvasPickerPlugin.tag,(function(result){return _this.pick(document,result)}))},CanvasPickerPlugin.prototype.pick=function(document,result){var e_1,_a,topmost=result.topmost,_b=result.position,x=_b.x,y=_b.y,position=set(tmpVec3a,x,y,0),hitTestList=document.elementsFromBBox(position[0],position[1],position[0],position[1]),pickedDisplayObjects=[];try{for(var hitTestList_1=(0,tslib_es6.Ju)(hitTestList),hitTestList_1_1=hitTestList_1.next();!hitTestList_1_1.done;hitTestList_1_1=hitTestList_1.next()){var displayObject=hitTestList_1_1.value,worldTransform=displayObject.getWorldTransform();if(this.isHit(displayObject,position,worldTransform,!1)){var clipped=findClosestClipPathTarget(displayObject);if(clipped){var clipPath=clipped.parsedStyle.clipPath;if(this.isHit(clipPath,position,clipPath.getWorldTransform(),!0)){if(topmost)return result.picked=[displayObject],result;pickedDisplayObjects.push(displayObject)}}else{if(topmost)return result.picked=[displayObject],result;pickedDisplayObjects.push(displayObject)}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{hitTestList_1_1&&!hitTestList_1_1.done&&(_a=hitTestList_1.return)&&_a.call(hitTestList_1)}finally{if(e_1)throw e_1.error}}return result.picked=pickedDisplayObjects,result},CanvasPickerPlugin.tag="CanvasPicker",CanvasPickerPlugin}();function isPointInPath$7(displayObject,position,isClipPath){var _a=displayObject.parsedStyle,r=_a.r,fill=_a.fill,stroke=_a.stroke,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,pointerEvents=_a.pointerEvents,halfLineWidth=((lineWidth||0)+(increasedLineWidthForHitTesting||0))/2,absDistance=index_esm_distance(r,r,position.x,position.y),_b=(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2),hasFill=_b[0],hasStroke=_b[1];return hasFill&&hasStroke||isClipPath?absDistance<=r+halfLineWidth:hasFill?absDistance<=r:!!hasStroke&&(absDistance>=r-halfLineWidth&&absDistance<=r+halfLineWidth)}function ellipseDistance(squareX,squareY,rx,ry){return squareX/(rx*rx)+squareY/(ry*ry)}function isPointInPath$6(displayObject,position,isClipPath){var _a=displayObject.parsedStyle,rx=_a.rx,ry=_a.ry,fill=_a.fill,stroke=_a.stroke,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,pointerEvents=_a.pointerEvents,x=position.x,y=position.y,_b=(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2),hasFill=_b[0],hasStroke=_b[1],halfLineWith=((lineWidth||0)+(increasedLineWidthForHitTesting||0))/2,squareX=(x-rx)*(x-rx),squareY=(y-ry)*(y-ry);return hasFill&&hasStroke||isClipPath?ellipseDistance(squareX,squareY,rx+halfLineWith,ry+halfLineWith)<=1:hasFill?ellipseDistance(squareX,squareY,rx,ry)<=1:!!hasStroke&&(ellipseDistance(squareX,squareY,rx-halfLineWith,ry-halfLineWith)>=1&&ellipseDistance(squareX,squareY,rx+halfLineWith,ry+halfLineWith)<=1)}function inBox(minX,minY,width,height,x,y){return x>=minX&&x<=minX+width&&y>=minY&&y<=minY+height}function inArc(cx,cy,r,startAngle,endAngle,lineWidth,x,y){var angle=(Math.atan2(y-cy,x-cx)+2*Math.PI)%(2*Math.PI),point={x:cx+r*Math.cos(angle),y:cy+r*Math.sin(angle)};return index_esm_distance(point.x,point.y,x,y)<=lineWidth/2}function inLine(x1,y1,x2,y2,lineWidth,x,y){var minX=Math.min(x1,x2),maxX=Math.max(x1,x2),minY=Math.min(y1,y2),maxY=Math.max(y1,y2),halfWidth=lineWidth/2;return x>=minX-halfWidth&&x<=maxX+halfWidth&&y>=minY-halfWidth&&y<=maxY+halfWidth&&pointToLine(x1,y1,x2,y2,x,y)<=lineWidth/2}function inPolyline(points,lineWidth,x,y,isClose){var count=points.length;if(count<2)return!1;for(var i=0;i<count-1;i++){if(inLine(points[i][0],points[i][1],points[i+1][0],points[i+1][1],lineWidth,x,y))return!0}if(isClose){var first=points[0],last=points[count-1];if(inLine(first[0],first[1],last[0],last[1],lineWidth,x,y))return!0}return!1}var tolerance=1e-6;function dcmp(x){return Math.abs(x)<tolerance?0:x<0?-1:1}function onSegment(p1,p2,q){return(q[0]-p1[0])*(p2[1]-p1[1])==(p2[0]-p1[0])*(q[1]-p1[1])&&Math.min(p1[0],p2[0])<=q[0]&&q[0]<=Math.max(p1[0],p2[0])&&Math.min(p1[1],p2[1])<=q[1]&&q[1]<=Math.max(p1[1],p2[1])}function inPolygon(points,x,y){var isHit=!1,n=points.length;if(n<=2)return!1;for(var i=0;i<n;i++){var p1=points[i],p2=points[(i+1)%n];if(onSegment(p1,p2,[x,y]))return!0;dcmp(p1[1]-y)>0!=dcmp(p2[1]-y)>0&&dcmp(x-(y-p1[1])*(p1[0]-p2[0])/(p1[1]-p2[1])-p1[0])<0&&(isHit=!isHit)}return isHit}function inPolygons(polygons,x,y){for(var isHit=!1,i=0;i<polygons.length;i++){if(isHit=inPolygon(polygons[i],x,y))break}return isHit}function isPointInPath$5(displayObject,position,isClipPath){var _a=displayObject.parsedStyle,x1=_a.x1,y1=_a.y1,x2=_a.x2,y2=_a.y2,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,_b=_a.defX,x=void 0===_b?0:_b,_c=_a.defY,y=void 0===_c?0:_c,pointerEvents=_a.pointerEvents,fill=_a.fill,stroke=_a.stroke;return!(!(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2)[1]&&!isClipPath||!lineWidth)&&inLine(x1,y1,x2,y2,(lineWidth||0)+(increasedLineWidthForHitTesting||0),position.x+x,position.y+y)}function isPointInPath$4(displayObject,position,isClipPath,isPointInPath,renderingPluginContext,runtime){var _a=displayObject.parsedStyle,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,stroke=_a.stroke,fill=_a.fill,_b=_a.defX,x=void 0===_b?0:_b,_c=_a.defY,y=void 0===_c?0:_c,path=_a.path,pointerEvents=_a.pointerEvents,segments=path.segments,hasArc=path.hasArc,polylines=path.polylines,polygons=path.polygons,_d=(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,(null==polygons?void 0:polygons.length)&&fill,stroke),2),hasFill=_d[0],hasStroke=_d[1],totalLength=getOrCalculatePathTotalLength(displayObject),isHit=!1;return hasFill||isClipPath?isHit=hasArc?isPointInPath(displayObject,position):inPolygons(polygons,position.x+x,position.y+y)||inPolygons(polylines,position.x+x,position.y+y):((hasStroke||isClipPath)&&(isHit=function isPointInStroke(segments,lineWidth,px,py,length){for(var isHit=!1,halfWidth=lineWidth/2,i=0;i<segments.length;i++){var segment=segments[i],currentPoint=segment.currentPoint,params=segment.params,prePoint=segment.prePoint,box=segment.box;if(!box||inBox(box.x-halfWidth,box.y-halfWidth,box.width+lineWidth,box.height+lineWidth,px,py))switch(segment.command){case"L":case"Z":if(isHit=inLine(prePoint[0],prePoint[1],currentPoint[0],currentPoint[1],lineWidth,px,py))return!0;break;case"Q":if(isHit=pointDistance(prePoint[0],prePoint[1],params[1],params[2],params[3],params[4],px,py)<=lineWidth/2)return!0;break;case"C":if(isHit=pointDistance$3(prePoint[0],prePoint[1],params[1],params[2],params[3],params[4],params[5],params[6],px,py,length)<=lineWidth/2)return!0;break;case"A":segment.cubicParams||(segment.cubicParams=arcToCubic(prePoint[0],prePoint[1],params[1],params[2],params[3],params[4],params[5],params[6],params[7],void 0));for(var args=segment.cubicParams,prePointInCubic=prePoint,i_1=0;i_1<args.length;i_1+=6){var cDistance_1=pointDistance$3(prePointInCubic[0],prePointInCubic[1],args[i_1],args[i_1+1],args[i_1+2],args[i_1+3],args[i_1+4],args[i_1+5],px,py,length);if(prePointInCubic=[args[i_1+4],args[i_1+5]],isHit=cDistance_1<=lineWidth/2)return!0}}}return isHit}(segments,(lineWidth||0)+(increasedLineWidthForHitTesting||0),position.x+x,position.y+y,totalLength)),isHit)}function isPointInPath$3(displayObject,position,isClipPath){var _a=displayObject.parsedStyle,stroke=_a.stroke,fill=_a.fill,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,points=_a.points,_b=_a.defX,x=void 0===_b?0:_b,_c=_a.defY,y=void 0===_c?0:_c,pointerEvents=_a.pointerEvents,_d=(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2),hasFill=_d[0],isHit=!1;return(_d[1]||isClipPath)&&(isHit=inPolyline(points.points,(lineWidth||0)+(increasedLineWidthForHitTesting||0),position.x+x,position.y+y,!0)),isHit||!hasFill&&!isClipPath||(isHit=inPolygon(points.points,position.x+x,position.y+y)),isHit}function isPointInPath$2(displayObject,position,isClipPath){var _a=displayObject.parsedStyle,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,points=_a.points,_b=_a.defX,x=void 0===_b?0:_b,_c=_a.defY,y=void 0===_c?0:_c,pointerEvents=_a.pointerEvents,fill=_a.fill,stroke=_a.stroke;return!(!(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2)[1]&&!isClipPath||!lineWidth)&&inPolyline(points.points,(lineWidth||0)+(increasedLineWidthForHitTesting||0),position.x+x,position.y+y,!1)}function isPointInPath$1(displayObject,position,isClipPath,isPointInPath,runtime){var _a=displayObject.parsedStyle,radius=_a.radius,fill=_a.fill,stroke=_a.stroke,lineWidth=_a.lineWidth,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting,width=_a.width,height=_a.height,pointerEvents=_a.pointerEvents,_b=(0,tslib_es6.zs)(isFillOrStrokeAffected(pointerEvents,fill,stroke),2),hasFill=_b[0],hasStroke=_b[1],lineWidthForHitTesting=(lineWidth||0)+(increasedLineWidthForHitTesting||0);if(radius&&radius.some((function(r){return 0!==r}))){var isHit=!1;return(hasStroke||isClipPath)&&(isHit=function inRectWithRadius(minX,minY,width,height,radiusArray,lineWidth,x,y){var _a=(0,tslib_es6.zs)(radiusArray,4),tlr=_a[0],trr=_a[1],brr=_a[2],blr=_a[3];return inLine(minX+tlr,minY,minX+width-trr,minY,lineWidth,x,y)||inLine(minX+width,minY+trr,minX+width,minY+height-brr,lineWidth,x,y)||inLine(minX+width-brr,minY+height,minX+blr,minY+height,lineWidth,x,y)||inLine(minX,minY+height-blr,minX,minY+tlr,lineWidth,x,y)||inArc(minX+width-trr,minY+trr,trr,Math.PI,Math.PI,lineWidth,x,y)||inArc(minX+width-brr,minY+height-brr,brr,0,Math.PI,lineWidth,x,y)||inArc(minX+blr,minY+height-blr,blr,Math.PI,Math.PI,lineWidth,x,y)||inArc(minX+tlr,minY+tlr,tlr,Math.PI,Math.PI,lineWidth,x,y)}(0,0,width,height,radius.map((function(r){return lodash_clamp(r,0,Math.min(Math.abs(width)/2,Math.abs(height)/2))})),lineWidthForHitTesting,position.x,position.y)),isHit||!hasFill&&!isClipPath||(isHit=isPointInPath(displayObject,position)),isHit}var halfWidth=lineWidthForHitTesting/2;return hasFill&&hasStroke||isClipPath?inBox(0-halfWidth,0-halfWidth,width+halfWidth,height+halfWidth,position.x,position.y):hasFill?inBox(0,0,width,height,position.x,position.y):!!hasStroke&&function inRect(minX,minY,width,height,lineWidth,x,y){var halfWidth=lineWidth/2;return inBox(minX-halfWidth,minY-halfWidth,width,lineWidth,x,y)||inBox(minX+width-halfWidth,minY-halfWidth,lineWidth,height,x,y)||inBox(minX+halfWidth,minY+height-halfWidth,width,lineWidth,x,y)||inBox(minX-halfWidth,minY+halfWidth,lineWidth,height,x,y)}(0,0,width,height,lineWidthForHitTesting,position.x,position.y)}function isPointInPath(displayObject,position,isClipPath,isPointInPath,renderingPluginContext,runtime){var _a=displayObject.parsedStyle,pointerEvents=_a.pointerEvents,width=_a.width,height=_a.height;if("non-transparent-pixel"===pointerEvents){var offscreenCanvas=renderingPluginContext.config.offscreenCanvas,canvas=runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas),context=runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas,{willReadFrequently:!0});return canvas.width=width,canvas.height=height,renderingPluginContext.defaultStyleRendererFactory[Shape.IMAGE].render(context,displayObject.parsedStyle,displayObject,void 0,void 0,void 0),context.getImageData(position.x,position.y,1,1).data.every((function(component){return 0!==component}))}return!0}var index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="canvas-picker",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){var _a,pointInPathPickerFactory=((_a={})[Shape.CIRCLE]=isPointInPath$7,_a[Shape.ELLIPSE]=isPointInPath$6,_a[Shape.RECT]=isPointInPath$1,_a[Shape.LINE]=isPointInPath$5,_a[Shape.POLYLINE]=isPointInPath$2,_a[Shape.POLYGON]=isPointInPath$3,_a[Shape.PATH]=isPointInPath$4,_a[Shape.TEXT]=function(){return!0},_a[Shape.GROUP]=null,_a[Shape.IMAGE]=isPointInPath,_a[Shape.HTML]=null,_a[Shape.MESH]=null,_a);this.context.pointInPathPickerFactory=pointInPathPickerFactory,this.addRenderingPlugin(new CanvasPickerPlugin)},Plugin.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},Plugin}(AbstractRendererPlugin),CanvasRendererPlugin=function(){function CanvasRendererPlugin(canvasRendererPluginOptions){this.canvasRendererPluginOptions=canvasRendererPluginOptions,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreen=!1,this.vpMatrix=mat4_create(),this.dprMatrix=mat4_create(),this.tmpMat4=mat4_create(),this.vec3a=create(),this.vec3b=create(),this.vec3c=create(),this.vec3d=create()}return CanvasRendererPlugin.prototype.apply=function(context,runtime){var _this=this;this.context=context;var config=context.config,camera=context.camera,renderingService=context.renderingService,renderingContext=context.renderingContext,rBushRoot=context.rBushRoot,pathGeneratorFactory=context.pathGeneratorFactory;this.rBush=rBushRoot,this.pathGeneratorFactory=pathGeneratorFactory;var contextService=context.contextService,canvas=renderingContext.root.ownerDocument.defaultView,handleUnmounted=function(e){var rBushNode=e.target.rBushNode;rBushNode.aabb&&_this.removedRBushNodeAABBs.push(rBushNode.aabb)},handleCulled=function(e){var rBushNode=e.target.rBushNode;rBushNode.aabb&&_this.removedRBushNodeAABBs.push(rBushNode.aabb)};renderingService.hooks.init.tap(CanvasRendererPlugin.tag,(function(){canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.addEventListener(ElementEvent.CULLED,handleCulled);var dpr=contextService.getDPR(),width=config.width,height=config.height,context=contextService.getContext();_this.clearRect(context,0,0,width*dpr,height*dpr,config.background)})),renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag,(function(){canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.removeEventListener(ElementEvent.CULLED,handleCulled),_this.renderQueue=[],_this.removedRBushNodeAABBs=[],_this.restoreStack=[]})),renderingService.hooks.beginFrame.tap(CanvasRendererPlugin.tag,(function(){var context=contextService.getContext(),dpr=contextService.getDPR(),width=config.width,height=config.height,_a=_this.canvasRendererPluginOptions,dirtyObjectNumThreshold=_a.dirtyObjectNumThreshold,dirtyObjectRatioThreshold=_a.dirtyObjectRatioThreshold,_b=renderingService.getStats(),total=_b.total,rendered=_b.rendered,ratio=rendered/total;_this.clearFullScreen=renderingService.disableDirtyRectangleRendering()||rendered>dirtyObjectNumThreshold&&ratio>dirtyObjectRatioThreshold,context&&(context.resetTransform?context.resetTransform():context.setTransform(1,0,0,1,0,0),_this.clearFullScreen&&_this.clearRect(context,0,0,width*dpr,height*dpr,config.background))}));var renderByZIndex=function(object,context){object.isVisible()&&!object.isCulled()&&(_this.renderDisplayObject(object,context,_this.context,_this.restoreStack,runtime),_this.saveDirtyAABB(object)),(object.sortable.sorted||object.childNodes).forEach((function(child){renderByZIndex(child,context)}))};renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag,(function(){var context=contextService.getContext(),dpr=contextService.getDPR();if(fromScaling(_this.dprMatrix,[dpr,dpr,1]),mat4_multiply(_this.vpMatrix,_this.dprMatrix,camera.getOrthoMatrix()),_this.clearFullScreen)renderByZIndex(renderingContext.root,context);else{var dirtyRenderBounds=_this.safeMergeAABB.apply(_this,(0,tslib_es6.fX)([_this.mergeDirtyAABBs(_this.renderQueue)],(0,tslib_es6.zs)(_this.removedRBushNodeAABBs.map((function(_a){var minX=_a.minX,minY=_a.minY,maxX=_a.maxX,maxY=_a.maxY,aabb=new AABB;return aabb.setMinMax([minX,minY,0],[maxX,maxY,0]),aabb}))),!1));if(_this.removedRBushNodeAABBs=[],AABB.isEmpty(dirtyRenderBounds))return void(_this.renderQueue=[]);var dirtyRect=_this.convertAABB2Rect(dirtyRenderBounds),x=dirtyRect.x,y=dirtyRect.y,width=dirtyRect.width,height=dirtyRect.height,tl=transformMat4(_this.vec3a,[x,y,0],_this.vpMatrix),tr=transformMat4(_this.vec3b,[x+width,y,0],_this.vpMatrix),bl=transformMat4(_this.vec3c,[x,y+height,0],_this.vpMatrix),br=transformMat4(_this.vec3d,[x+width,y+height,0],_this.vpMatrix),minx=Math.min(tl[0],tr[0],br[0],bl[0]),miny=Math.min(tl[1],tr[1],br[1],bl[1]),maxx=Math.max(tl[0],tr[0],br[0],bl[0]),maxy=Math.max(tl[1],tr[1],br[1],bl[1]),ix=Math.floor(minx),iy=Math.floor(miny),iwidth=Math.ceil(maxx-minx),iheight=Math.ceil(maxy-miny);context.save(),_this.clearRect(context,ix,iy,iwidth,iheight,config.background),context.beginPath(),context.rect(ix,iy,iwidth,iheight),context.clip(),context.setTransform(_this.vpMatrix[0],_this.vpMatrix[1],_this.vpMatrix[4],_this.vpMatrix[5],_this.vpMatrix[12],_this.vpMatrix[13]),config.renderer.getConfig().enableDirtyRectangleRenderingDebug&&canvas.dispatchEvent(new CustomEvent(CanvasEvent.DIRTY_RECTANGLE,{dirtyRect:{x:ix,y:iy,width:iwidth,height:iheight}})),_this.searchDirtyObjects(dirtyRenderBounds).sort((function(a,b){return a.sortable.renderOrder-b.sortable.renderOrder})).forEach((function(object){object&&object.isVisible()&&!object.isCulled()&&_this.renderDisplayObject(object,context,_this.context,_this.restoreStack,runtime)})),context.restore(),_this.renderQueue.forEach((function(object){_this.saveDirtyAABB(object)})),_this.renderQueue=[]}_this.restoreStack.forEach((function(){context.restore()})),_this.restoreStack=[]})),renderingService.hooks.render.tap(CanvasRendererPlugin.tag,(function(object){_this.clearFullScreen||_this.renderQueue.push(object)}))},CanvasRendererPlugin.prototype.clearRect=function(context,x,y,width,height,background){context.clearRect(x,y,width,height),background&&(context.fillStyle=background,context.fillRect(x,y,width,height))},CanvasRendererPlugin.prototype.renderDisplayObject=function(object,context,canvasContext,restoreStack,runtime){var nodeName=object.nodeName,parent=restoreStack[restoreStack.length-1];!parent||object.compareDocumentPosition(parent)&Node.DOCUMENT_POSITION_CONTAINS||(context.restore(),restoreStack.pop());var styleRenderer=this.context.styleRendererFactory[nodeName],generatePath=this.pathGeneratorFactory[nodeName],clipPath=object.parsedStyle.clipPath;if(clipPath){this.applyWorldTransform(context,clipPath);var generatePath_1=this.pathGeneratorFactory[clipPath.nodeName];generatePath_1&&(context.save(),restoreStack.push(object),context.beginPath(),generatePath_1(context,clipPath.parsedStyle),context.closePath(),context.clip())}styleRenderer&&(this.applyWorldTransform(context,object),context.save(),this.applyAttributesToContext(context,object)),generatePath&&(context.beginPath(),generatePath(context,object.parsedStyle),object.nodeName!==Shape.LINE&&object.nodeName!==Shape.PATH&&object.nodeName!==Shape.POLYLINE&&context.closePath()),styleRenderer&&(styleRenderer.render(context,object.parsedStyle,object,canvasContext,this,runtime),context.restore()),object.renderable.dirty=!1},CanvasRendererPlugin.prototype.convertAABB2Rect=function(aabb){var min=aabb.getMin(),max=aabb.getMax(),minX=Math.floor(min[0]),minY=Math.floor(min[1]);return{x:minX,y:minY,width:Math.ceil(max[0])-minX,height:Math.ceil(max[1])-minY}},CanvasRendererPlugin.prototype.mergeDirtyAABBs=function(dirtyObjects){var aabb=new AABB;return dirtyObjects.forEach((function(object){var renderBounds=object.getRenderBounds();aabb.add(renderBounds);var dirtyRenderBounds=object.renderable.dirtyRenderBounds;dirtyRenderBounds&&aabb.add(dirtyRenderBounds)})),aabb},CanvasRendererPlugin.prototype.searchDirtyObjects=function(dirtyRectangle){var _a=(0,tslib_es6.zs)(dirtyRectangle.getMin(),2),minX=_a[0],minY=_a[1],_b=(0,tslib_es6.zs)(dirtyRectangle.getMax(),2),maxX=_b[0],maxY=_b[1];return this.rBush.search({minX,minY,maxX,maxY}).map((function(_a){return _a.displayObject}))},CanvasRendererPlugin.prototype.saveDirtyAABB=function(object){var renderable=object.renderable;renderable.dirtyRenderBounds||(renderable.dirtyRenderBounds=new AABB);var renderBounds=object.getRenderBounds();renderBounds&&renderable.dirtyRenderBounds.update(renderBounds.center,renderBounds.halfExtents)},CanvasRendererPlugin.prototype.applyAttributesToContext=function(context,object){var _a=object.parsedStyle,stroke=_a.stroke,fill=_a.fill,opacity=_a.opacity,lineDash=_a.lineDash,lineDashOffset=_a.lineDashOffset;lineDash&&context.setLineDash(lineDash),(0,is_nil.A)(lineDashOffset)||(context.lineDashOffset=lineDashOffset),(0,is_nil.A)(opacity)||(context.globalAlpha*=opacity),(0,is_nil.A)(stroke)||Array.isArray(stroke)||stroke.isNone||(context.strokeStyle=object.attributes.stroke),(0,is_nil.A)(fill)||Array.isArray(fill)||fill.isNone||(context.fillStyle=object.attributes.fill)},CanvasRendererPlugin.prototype.applyWorldTransform=function(context,object,matrix){var tx=0,ty=0,anchor=(object.parsedStyle||{}).anchor,anchorX=anchor&&anchor[0]||0,anchorY=anchor&&anchor[1]||0;if(0!==anchorX||0!==anchorY){var bounds=object.geometry.contentBounds;tx=-anchorX*(bounds&&2*bounds.halfExtents[0]||0),ty=-anchorY*(bounds&&2*bounds.halfExtents[1]||0)}matrix?(mat4_copy(this.tmpMat4,object.getLocalTransform()),this.vec3a[0]=tx,this.vec3a[1]=ty,this.vec3a[2]=0,translate(this.tmpMat4,this.tmpMat4,this.vec3a),mat4_multiply(this.tmpMat4,matrix,this.tmpMat4),mat4_multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(mat4_copy(this.tmpMat4,object.getWorldTransform()),this.vec3a[0]=tx,this.vec3a[1]=ty,this.vec3a[2]=0,translate(this.tmpMat4,this.tmpMat4,this.vec3a),mat4_multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)),context.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},CanvasRendererPlugin.prototype.safeMergeAABB=function(){for(var aabbs=[],_i=0;_i<arguments.length;_i++)aabbs[_i]=arguments[_i];var merged=new AABB;return aabbs.forEach((function(aabb){merged.add(aabb)})),merged},CanvasRendererPlugin.tag="CanvasRenderer",CanvasRendererPlugin}(),DefaultRenderer=function(){function DefaultRenderer(imagePool){this.imagePool=imagePool}return DefaultRenderer.prototype.render=function(context,parsedStyle,object,canvasContext,plugin,runtime){var fill=parsedStyle.fill,fillRule=parsedStyle.fillRule,opacity=parsedStyle.opacity,fillOpacity=parsedStyle.fillOpacity,stroke=parsedStyle.stroke,strokeOpacity=parsedStyle.strokeOpacity,lineWidth=parsedStyle.lineWidth,lineCap=parsedStyle.lineCap,lineJoin=parsedStyle.lineJoin,shadowType=parsedStyle.shadowType,shadowColor=parsedStyle.shadowColor,shadowBlur=parsedStyle.shadowBlur,filter=parsedStyle.filter,miterLimit=parsedStyle.miterLimit,hasFill=!(0,is_nil.A)(fill)&&!fill.isNone,hasStroke=!(0,is_nil.A)(stroke)&&!stroke.isNone&&lineWidth>0,isFillTransparent=0===fill.alpha,hasFilter=!(!filter||!filter.length),hasShadow=!(0,is_nil.A)(shadowColor)&&shadowBlur>0,nodeName=object.nodeName,isInnerShadow="inner"===shadowType,shouldDrawShadowWithStroke=hasStroke&&hasShadow&&(nodeName===Shape.PATH||nodeName===Shape.LINE||nodeName===Shape.POLYLINE||isFillTransparent||isInnerShadow);hasFill&&(context.globalAlpha=opacity*fillOpacity,shouldDrawShadowWithStroke||setShadowAndFilter(object,context,hasShadow),this.fill(context,object,fill,fillRule,canvasContext,plugin,runtime),shouldDrawShadowWithStroke||this.clearShadowAndFilter(context,hasFilter,hasShadow)),hasStroke&&(context.globalAlpha=opacity*strokeOpacity,context.lineWidth=lineWidth,(0,is_nil.A)(miterLimit)||(context.miterLimit=miterLimit),(0,is_nil.A)(lineCap)||(context.lineCap=lineCap),(0,is_nil.A)(lineJoin)||(context.lineJoin=lineJoin),shouldDrawShadowWithStroke&&(isInnerShadow&&(context.globalCompositeOperation="source-atop"),setShadowAndFilter(object,context,!0),isInnerShadow&&(this.stroke(context,object,stroke,canvasContext,plugin,runtime),context.globalCompositeOperation="source-over",this.clearShadowAndFilter(context,hasFilter,!0))),this.stroke(context,object,stroke,canvasContext,plugin,runtime))},DefaultRenderer.prototype.clearShadowAndFilter=function(context,hasFilter,hasShadow){if(hasShadow&&(context.shadowColor="transparent",context.shadowBlur=0),hasFilter){var oldFilter=context.filter;!(0,is_nil.A)(oldFilter)&&oldFilter.indexOf("drop-shadow")>-1&&(context.filter=oldFilter.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},DefaultRenderer.prototype.fill=function(context,object,fill,fillRule,canvasContext,plugin,runtime){var _this=this;Array.isArray(fill)?fill.forEach((function(gradient){context.fillStyle=_this.getColor(gradient,object,context),fillRule?context.fill(fillRule):context.fill()})):(isPattern(fill)&&(context.fillStyle=this.getPattern(fill,object,context,canvasContext,plugin,runtime)),fillRule?context.fill(fillRule):context.fill())},DefaultRenderer.prototype.stroke=function(context,object,stroke,canvasContext,plugin,runtime){var _this=this;Array.isArray(stroke)?stroke.forEach((function(gradient){context.strokeStyle=_this.getColor(gradient,object,context),context.stroke()})):(isPattern(stroke)&&(context.strokeStyle=this.getPattern(stroke,object,context,canvasContext,plugin,runtime)),context.stroke())},DefaultRenderer.prototype.getPattern=function(pattern,object,context,canvasContext,plugin,runtime){var $offscreenCanvas,dpr;if("rect"===pattern.image.nodeName){var _a=pattern.image.parsedStyle,width=_a.width,height=_a.height;dpr=canvasContext.contextService.getDPR();var offscreenCanvas=canvasContext.config.offscreenCanvas;($offscreenCanvas=runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas)).width=width*dpr,$offscreenCanvas.height=height*dpr;var offscreenCanvasContext_1=runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas),restoreStack_1=[];pattern.image.forEach((function(object){plugin.renderDisplayObject(object,offscreenCanvasContext_1,canvasContext,restoreStack_1,runtime)})),restoreStack_1.forEach((function(){offscreenCanvasContext_1.restore()}))}return this.imagePool.getOrCreatePatternSync(pattern,context,$offscreenCanvas,dpr,(function(){object.renderable.dirty=!0,canvasContext.renderingService.dirtify()}))},DefaultRenderer.prototype.getColor=function(parsedColor,object,context){var color;if(parsedColor.type===GradientType.LinearGradient||parsedColor.type===GradientType.RadialGradient){var bounds=object.getGeometryBounds(),width=bounds&&2*bounds.halfExtents[0]||1,height=bounds&&2*bounds.halfExtents[1]||1;color=this.imagePool.getOrCreateGradient((0,tslib_es6.Cl)((0,tslib_es6.Cl)({type:parsedColor.type},parsedColor.value),{width,height}),context)}return color},DefaultRenderer}();function setShadowAndFilter(object,context,hasShadow){var _a=object.parsedStyle,filter=_a.filter,shadowColor=_a.shadowColor,shadowBlur=_a.shadowBlur,shadowOffsetX=_a.shadowOffsetX,shadowOffsetY=_a.shadowOffsetY;filter&&filter.length&&(context.filter=object.style.filter),hasShadow&&(context.shadowColor=shadowColor.toString(),context.shadowBlur=shadowBlur||0,context.shadowOffsetX=shadowOffsetX||0,context.shadowOffsetY=shadowOffsetY||0)}var ImageRenderer=function(){function ImageRenderer(imagePool){this.imagePool=imagePool}return ImageRenderer.prototype.render=function(context,parsedStyle,object){var image,width=parsedStyle.width,height=parsedStyle.height,img=parsedStyle.img,shadowColor=parsedStyle.shadowColor,shadowBlur=parsedStyle.shadowBlur,iw=width,ih=height;if((0,is_string.A)(img)?image=this.imagePool.getImageSync(img):(iw||(iw=img.width),ih||(ih=img.height),image=img),image){setShadowAndFilter(object,context,!(0,is_nil.A)(shadowColor)&&shadowBlur>0);try{context.drawImage(image,0,0,iw,ih)}catch(e){}}},ImageRenderer}(),TextRenderer=function(){function TextRenderer(){}return TextRenderer.prototype.render=function(context,parsedStyle,object,canvasContext,plugin,runtime){var _a=parsedStyle,lineWidth=_a.lineWidth,textAlign=_a.textAlign,textBaseline=_a.textBaseline,lineJoin=_a.lineJoin,miterLimit=_a.miterLimit,letterSpacing=_a.letterSpacing,stroke=_a.stroke,fill=_a.fill,fillOpacity=_a.fillOpacity,strokeOpacity=_a.strokeOpacity,opacity=_a.opacity,metrics=_a.metrics,dx=_a.dx,dy=_a.dy,shadowColor=_a.shadowColor,shadowBlur=_a.shadowBlur,font=metrics.font,lines=metrics.lines,height=metrics.height,lineHeight=metrics.lineHeight,lineMetrics=metrics.lineMetrics;context.font=font,context.lineWidth=lineWidth,context.textAlign="middle"===textAlign?"center":textAlign;var formattedTextBaseline=textBaseline;runtime.enableCSSParsing||"alphabetic"!==formattedTextBaseline||(formattedTextBaseline="bottom"),context.lineJoin=lineJoin,(0,is_nil.A)(miterLimit)||(context.miterLimit=miterLimit);var linePositionY=0;"middle"===textBaseline?linePositionY=-height/2-lineHeight/2:"bottom"===textBaseline||"alphabetic"===textBaseline||"ideographic"===textBaseline?linePositionY=-height:"top"!==textBaseline&&"hanging"!==textBaseline||(linePositionY=-lineHeight);var offsetX=dx||0;linePositionY+=dy||0,1===lines.length&&("bottom"===formattedTextBaseline?(formattedTextBaseline="middle",linePositionY-=.5*height):"top"===formattedTextBaseline&&(formattedTextBaseline="middle",linePositionY+=.5*height)),context.textBaseline=formattedTextBaseline,setShadowAndFilter(object,context,!(0,is_nil.A)(shadowColor)&&shadowBlur>0);for(var i=0;i<lines.length;i++){var linePositionX=lineWidth/2+offsetX;linePositionY+=lineHeight,(0,is_nil.A)(stroke)||stroke.isNone||!lineWidth||this.drawLetterSpacing(context,lines[i],lineMetrics[i],textAlign,linePositionX,linePositionY,letterSpacing,fillOpacity,strokeOpacity,opacity,!0),(0,is_nil.A)(fill)||this.drawLetterSpacing(context,lines[i],lineMetrics[i],textAlign,linePositionX,linePositionY,letterSpacing,fillOpacity,strokeOpacity,opacity)}},TextRenderer.prototype.drawLetterSpacing=function(context,text,lineMetrics,textAlign,x,y,letterSpacing,fillOpacity,strokeOpacity,opacity,isStroke){if(void 0===isStroke&&(isStroke=!1),0!==letterSpacing){var currentTextAlign=context.textAlign;context.textAlign="left";var currentPosition=x;"center"===textAlign||"middle"===textAlign?currentPosition=x-lineMetrics.width/2:"right"!==textAlign&&"end"!==textAlign||(currentPosition=x-lineMetrics.width);for(var stringArray=Array.from(text),previousWidth=context.measureText(text).width,currentWidth=0,i=0;i<stringArray.length;++i){var currentChar=stringArray[i];isStroke?this.strokeText(context,currentChar,currentPosition,y,strokeOpacity):this.fillText(context,currentChar,currentPosition,y,fillOpacity,opacity),currentPosition+=previousWidth-(currentWidth=context.measureText(text.substring(i+1)).width)+letterSpacing,previousWidth=currentWidth}context.textAlign=currentTextAlign}else isStroke?this.strokeText(context,text,x,y,strokeOpacity):this.fillText(context,text,x,y,fillOpacity,opacity)},TextRenderer.prototype.fillText=function(context,text,x,y,fillOpacity,opacity){var currentGlobalAlpha,applyOpacity=!(0,is_nil.A)(fillOpacity)&&1!==fillOpacity;applyOpacity&&(currentGlobalAlpha=context.globalAlpha,context.globalAlpha=fillOpacity*opacity),context.fillText(text,x,y),applyOpacity&&(context.globalAlpha=currentGlobalAlpha)},TextRenderer.prototype.strokeText=function(context,text,x,y,strokeOpacity){var currentGlobalAlpha,applyOpacity=!(0,is_nil.A)(strokeOpacity)&&1!==strokeOpacity;applyOpacity&&(currentGlobalAlpha=context.globalAlpha,context.globalAlpha=strokeOpacity),context.strokeText(text,x,y),applyOpacity&&(context.globalAlpha=currentGlobalAlpha)},TextRenderer}(),dist_index_esm_Plugin=(function(_super){function RectRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(RectRenderer,_super)}(DefaultRenderer),function(_super){function CircleRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(CircleRenderer,_super)}(DefaultRenderer),function(_super){function EllipseRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(EllipseRenderer,_super)}(DefaultRenderer),function(_super){function LineRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(LineRenderer,_super)}(DefaultRenderer),function(_super){function PolylineRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(PolylineRenderer,_super)}(DefaultRenderer),function(_super){function PolygonRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(PolygonRenderer,_super)}(DefaultRenderer),function(_super){function PathRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(PathRenderer,_super)}(DefaultRenderer),function(_super){function Plugin(options){void 0===options&&(options={});var _this=_super.call(this)||this;return _this.options=options,_this.name="canvas-renderer",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){var _a,canvasRendererPluginOptions=(0,tslib_es6.Cl)({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),imagePool=this.context.imagePool,defaultRenderer=new DefaultRenderer(imagePool),defaultStyleRendererFactory=((_a={})[Shape.CIRCLE]=defaultRenderer,_a[Shape.ELLIPSE]=defaultRenderer,_a[Shape.RECT]=defaultRenderer,_a[Shape.IMAGE]=new ImageRenderer(imagePool),_a[Shape.TEXT]=new TextRenderer,_a[Shape.LINE]=defaultRenderer,_a[Shape.POLYLINE]=defaultRenderer,_a[Shape.POLYGON]=defaultRenderer,_a[Shape.PATH]=defaultRenderer,_a[Shape.GROUP]=void 0,_a[Shape.HTML]=void 0,_a[Shape.MESH]=void 0,_a);this.context.defaultStyleRendererFactory=defaultStyleRendererFactory,this.context.styleRendererFactory=defaultStyleRendererFactory,this.addRenderingPlugin(new CanvasRendererPlugin(canvasRendererPluginOptions))},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},Plugin}(AbstractRendererPlugin)),DOMInteractionPlugin=function(){function DOMInteractionPlugin(){}return DOMInteractionPlugin.prototype.apply=function(context,runtime){var _this=this,renderingService=context.renderingService,renderingContext=context.renderingContext,config=context.config;this.context=context;var canvas=renderingContext.root.ownerDocument.defaultView,onPointerMove=function(ev){renderingService.hooks.pointerMove.call(ev)},onPointerUp=function(ev){renderingService.hooks.pointerUp.call(ev)},onPointerDown=function(ev){renderingService.hooks.pointerDown.call(ev)},onPointerOver=function(ev){renderingService.hooks.pointerOver.call(ev)},onPointerOut=function(ev){renderingService.hooks.pointerOut.call(ev)},onPointerCancel=function(ev){renderingService.hooks.pointerCancel.call(ev)},onPointerWheel=function(ev){renderingService.hooks.pointerWheel.call(ev)},onClick=function(ev){renderingService.hooks.click.call(ev)};renderingService.hooks.init.tap(DOMInteractionPlugin.tag,(function(){var $el=_this.context.contextService.getDomElement();runtime.globalThis.navigator.msPointerEnabled?($el.style.msContentZooming="none",$el.style.msTouchAction="none"):canvas.supportsPointerEvents&&($el.style.touchAction="none"),canvas.supportsPointerEvents?function($el){runtime.globalThis.document.addEventListener("pointermove",onPointerMove,!0),$el.addEventListener("pointerdown",onPointerDown,!0),$el.addEventListener("pointerleave",onPointerOut,!0),$el.addEventListener("pointerover",onPointerOver,!0),runtime.globalThis.addEventListener("pointerup",onPointerUp,!0),runtime.globalThis.addEventListener("pointercancel",onPointerCancel,!0)}($el):function($el){runtime.globalThis.document.addEventListener("mousemove",onPointerMove,!0),$el.addEventListener("mousedown",onPointerDown,!0),$el.addEventListener("mouseout",onPointerOut,!0),$el.addEventListener("mouseover",onPointerOver,!0),runtime.globalThis.addEventListener("mouseup",onPointerUp,!0)}($el),canvas.supportsTouchEvents&&function($el){$el.addEventListener("touchstart",onPointerDown,!0),$el.addEventListener("touchend",onPointerUp,!0),$el.addEventListener("touchmove",onPointerMove,!0),$el.addEventListener("touchcancel",onPointerCancel,!0)}($el),config.useNativeClickEvent&&$el.addEventListener("click",onClick,!0),$el.addEventListener("wheel",onPointerWheel,{passive:!0,capture:!0})})),renderingService.hooks.destroy.tap(DOMInteractionPlugin.tag,(function(){var $el=_this.context.contextService.getDomElement();runtime.globalThis.navigator.msPointerEnabled?($el.style.msContentZooming="",$el.style.msTouchAction=""):canvas.supportsPointerEvents&&($el.style.touchAction=""),canvas.supportsPointerEvents?function($el){runtime.globalThis.document.removeEventListener("pointermove",onPointerMove,!0),$el.removeEventListener("pointerdown",onPointerDown,!0),$el.removeEventListener("pointerleave",onPointerOut,!0),$el.removeEventListener("pointerover",onPointerOver,!0),runtime.globalThis.removeEventListener("pointerup",onPointerUp,!0)}($el):function($el){runtime.globalThis.document.removeEventListener("mousemove",onPointerMove,!0),$el.removeEventListener("mousedown",onPointerDown,!0),$el.removeEventListener("mouseout",onPointerOut,!0),$el.removeEventListener("mouseover",onPointerOver,!0),runtime.globalThis.removeEventListener("mouseup",onPointerUp,!0)}($el),canvas.supportsTouchEvents&&function($el){$el.removeEventListener("touchstart",onPointerDown,!0),$el.removeEventListener("touchend",onPointerUp,!0),$el.removeEventListener("touchmove",onPointerMove,!0),$el.removeEventListener("touchcancel",onPointerCancel,!0)}($el),config.useNativeClickEvent&&$el.removeEventListener("click",onClick,!0),$el.removeEventListener("wheel",onPointerWheel,!0)}))},DOMInteractionPlugin.tag="DOMInteraction",DOMInteractionPlugin}(),g_plugin_dom_interaction_dist_index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="dom-interaction",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){this.addRenderingPlugin(new DOMInteractionPlugin)},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins()},Plugin}(AbstractRendererPlugin),HTMLRenderingPlugin=function(){function HTMLRenderingPlugin(){this.displayObjectHTMLElementMap=new WeakMap}return HTMLRenderingPlugin.prototype.joinTransformMatrix=function(matrix){return"matrix(".concat([matrix[0],matrix[1],matrix[4],matrix[5],matrix[12],matrix[13]].join(","),")")},HTMLRenderingPlugin.prototype.apply=function(context,runtime){var _this=this,camera=context.camera,renderingContext=context.renderingContext,renderingService=context.renderingService;this.context=context;var canvas=renderingContext.root.ownerDocument.defaultView,nativeHTMLMap=canvas.context.eventService.nativeHTMLMap,setTransform=function(object,$el){$el.style.transform=_this.joinTransformMatrix(object.getWorldTransform())},handleMounted=function(e){var object=e.target;if(object.nodeName===Shape.HTML){_this.$camera||(_this.$camera=_this.createCamera(camera));var $el_1=_this.getOrCreateEl(object);if(_this.$camera.appendChild($el_1),runtime.enableCSSParsing){var attributes_1=object.ownerDocument.documentElement.attributes;Object.keys(attributes_1).forEach((function(name){$el_1.style[name]=attributes_1[name]}))}Object.keys(object.attributes).forEach((function(name){_this.updateAttribute(name,object)})),setTransform(object,$el_1),nativeHTMLMap.set($el_1,object)}},handleUnmounted=function(e){var object=e.target;if(object.nodeName===Shape.HTML&&_this.$camera){var $el=_this.getOrCreateEl(object);$el&&($el.remove(),nativeHTMLMap.delete($el))}},handleAttributeChanged=function(e){var object=e.target;if(object.nodeName===Shape.HTML){var attrName=e.attrName;_this.updateAttribute(attrName,object)}},handleBoundsChanged=function(e){var object=e.target;if(object.nodeName===Shape.HTML){var $el=_this.getOrCreateEl(object);setTransform(object,$el)}},handleCanvasResize=function(){if(_this.$camera){var _a=_this.context.config,width=_a.width,height=_a.height;_this.$camera.style.width="".concat(width||0,"px"),_this.$camera.style.height="".concat(height||0,"px")}};renderingService.hooks.init.tap(HTMLRenderingPlugin.tag,(function(){canvas.addEventListener(CanvasEvent.RESIZE,handleCanvasResize),canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.addEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.addEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged)})),renderingService.hooks.endFrame.tap(HTMLRenderingPlugin.tag,(function(){_this.$camera&&renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED)&&(_this.$camera.style.transform=_this.joinTransformMatrix(camera.getOrthoMatrix()))})),renderingService.hooks.destroy.tap(HTMLRenderingPlugin.tag,(function(){_this.$camera&&_this.$camera.remove(),canvas.removeEventListener(CanvasEvent.RESIZE,handleCanvasResize),canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.removeEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.removeEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged)}))},HTMLRenderingPlugin.prototype.createCamera=function(camera){var _a=this.context.config,doc=_a.document,width=_a.width,height=_a.height,$canvas=this.context.contextService.getDomElement(),$container=$canvas.parentNode;if($container){var $existedCamera=$container.querySelector("#g-canvas-camera");if(!$existedCamera){var $camera=(doc||document).createElement("div");$existedCamera=$camera,$camera.id="g-canvas-camera",$camera.style.position="absolute",$camera.style.left="".concat($canvas.offsetLeft||0,"px"),$camera.style.top="".concat($canvas.offsetTop||0,"px"),$camera.style.transformOrigin="left top",$camera.style.transform=this.joinTransformMatrix(camera.getOrthoMatrix()),$camera.style.overflow="hidden",$camera.style.pointerEvents="none",$camera.style.width="".concat(width||0,"px"),$camera.style.height="".concat(height||0,"px"),$container.appendChild($camera)}return $existedCamera}return null},HTMLRenderingPlugin.prototype.getOrCreateEl=function(object){var doc=this.context.config.document,$existedElement=this.displayObjectHTMLElementMap.get(object);return $existedElement||($existedElement=(doc||document).createElement("div"),object.parsedStyle.$el=$existedElement,this.displayObjectHTMLElementMap.set(object,$existedElement),object.id&&($existedElement.id=object.id),object.name&&$existedElement.setAttribute("name",object.name),object.className&&($existedElement.className=object.className),$existedElement.style.position="absolute",$existedElement.style.left="0px",$existedElement.style.top="0px",$existedElement.style["will-change"]="transform",$existedElement.style.transform=this.joinTransformMatrix(object.getWorldTransform())),$existedElement},HTMLRenderingPlugin.prototype.updateAttribute=function(name,object){var $el=this.getOrCreateEl(object);switch(name){case"innerHTML":var innerHTML=object.parsedStyle.innerHTML;(0,is_string.A)(innerHTML)?$el.innerHTML=innerHTML:($el.innerHTML="",$el.appendChild(innerHTML));break;case"transformOrigin":var transformOrigin=object.parsedStyle.transformOrigin;$el.style["transform-origin"]="".concat(transformOrigin[0].value," ").concat(transformOrigin[1].value);break;case"width":if(this.context.enableCSSParsing){var width=object.computedStyleMap().get("width");$el.style.width=width.toString()}else{width=object.parsedStyle.width;$el.style.width=(0,is_number.A)(width)?"".concat(width,"px"):width.toString()}break;case"height":if(this.context.enableCSSParsing){var height=object.computedStyleMap().get("height");$el.style.height=height.toString()}else{height=object.parsedStyle.height;$el.style.height=(0,is_number.A)(height)?"".concat(height,"px"):height.toString()}break;case"zIndex":var zIndex=object.parsedStyle.zIndex;$el.style["z-index"]="".concat(zIndex);break;case"visibility":var visibility=object.parsedStyle.visibility;$el.style.visibility=visibility;break;case"pointerEvents":var pointerEvents=object.parsedStyle.pointerEvents;$el.style.pointerEvents=pointerEvents;break;case"opacity":var opacity=object.parsedStyle.opacity;$el.style.opacity="".concat(opacity);break;case"fill":var fill=object.parsedStyle.fill,color="";isCSSRGB(fill)?color=fill.isNone?"transparent":object.getAttribute("fill"):Array.isArray(fill)?color=object.getAttribute("fill"):isPattern(fill),$el.style.background=color;break;case"stroke":var stroke=object.parsedStyle.stroke,borderColor="";isCSSRGB(stroke)?borderColor=stroke.isNone?"transparent":object.getAttribute("stroke"):Array.isArray(stroke)?borderColor=object.getAttribute("stroke"):isPattern(stroke),$el.style["border-color"]=borderColor,$el.style["border-style"]="solid";break;case"lineWidth":var lineWidth=object.parsedStyle.lineWidth;$el.style["border-width"]="".concat(lineWidth||0,"px");break;case"lineDash":$el.style["border-style"]="dashed";break;case"filter":var filter=object.style.filter;$el.style.filter=filter;break;default:"x"!==name&&"y"!==name&&((0,is_nil.A)(object.style[name])||""===object.style[name]||($el.style[name]=object.style[name]))}},HTMLRenderingPlugin.tag="HTMLRendering",HTMLRenderingPlugin}(),g_plugin_html_renderer_dist_index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="html-renderer",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){this.addRenderingPlugin(new HTMLRenderingPlugin)},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins()},Plugin}(AbstractRendererPlugin),ImagePool=function(){function ImagePool(canvasConfig){this.canvasConfig=canvasConfig,this.imageCache={},this.gradientCache={},this.patternCache={}}return ImagePool.prototype.getImageSync=function(src,callback){return this.imageCache[src]?callback&&callback(this.imageCache[src]):this.getOrCreateImage(src).then((function(img){callback&&callback(img)})),this.imageCache[src]},ImagePool.prototype.getOrCreateImage=function(src){var _this=this;if(this.imageCache[src])return Promise.resolve(this.imageCache[src]);var createImage=this.canvasConfig.createImage;return new Promise((function(resolve,reject){var image;createImage?image=createImage(src):isBrowser&&(image=new window.Image),image&&(image.onload=function(){_this.imageCache[src]=image,resolve(image)},image.onerror=function(ev){reject(ev)},image.crossOrigin="Anonymous",image.src=src)}))},ImagePool.prototype.getOrCreatePatternSync=function(pattern,context,$offscreenCanvas,dpr,callback){var patternKey=this.generatePatternKey(pattern);if(patternKey&&this.patternCache[patternKey])return this.patternCache[patternKey];var src,image=pattern.image,repetition=pattern.repetition,transform=pattern.transform,needScaleWithDPR=!1;(0,is_string.A)(image)?src=this.getImageSync(image,callback):$offscreenCanvas?(src=$offscreenCanvas,needScaleWithDPR=!0):src=image;var canvasPattern=src&&context.createPattern(src,repetition);if(canvasPattern){var mat=void 0;mat=transform?parsedTransformToMat4(parseTransform(transform),new DisplayObject({})):identity(mat4_create()),needScaleWithDPR&&mat4_scale(mat,mat,[1/dpr,1/dpr,1]),canvasPattern.setTransform({a:mat[0],b:mat[1],c:mat[4],d:mat[5],e:mat[12],f:mat[13]})}return patternKey&&canvasPattern&&(this.patternCache[patternKey]=canvasPattern),canvasPattern},ImagePool.prototype.getOrCreateGradient=function(params,context){var key=this.generateGradientKey(params),type=params.type,steps=params.steps,width=params.width,height=params.height,angle=params.angle,cx=params.cx,cy=params.cy,size=params.size;if(this.gradientCache[key])return this.gradientCache[key];var gradient=null;if(type===GradientType.LinearGradient){var _a=computeLinearGradient(width,height,angle),x1=_a.x1,y1=_a.y1,x2=_a.x2,y2=_a.y2;gradient=context.createLinearGradient(x1,y1,x2,y2)}else if(type===GradientType.RadialGradient){var _b=computeRadialGradient(width,height,cx,cy,size),x=_b.x,y=_b.y,r=_b.r;gradient=context.createRadialGradient(x,y,0,x,y,r)}return gradient&&(steps.forEach((function(_a){var offset=_a.offset,color=_a.color;offset.unit===UnitType.kPercentage&&(null==gradient||gradient.addColorStop(offset.value/100,color.toString()))})),this.gradientCache[key]=gradient),this.gradientCache[key]},ImagePool.prototype.generateGradientKey=function(params){var type=params.type,width=params.width,height=params.height,steps=params.steps,angle=params.angle,cx=params.cx,cy=params.cy,size=params.size;return"gradient-".concat(type,"-").concat((null==angle?void 0:angle.toString())||0,"-").concat((null==cx?void 0:cx.toString())||0,"-").concat((null==cy?void 0:cy.toString())||0,"-").concat((null==size?void 0:size.toString())||0,"-").concat(width,"-").concat(height,"-").concat(steps.map((function(_a){var offset=_a.offset,color=_a.color;return"".concat(offset).concat(color)})).join("-"))},ImagePool.prototype.generatePatternKey=function(pattern){var image=pattern.image,repetition=pattern.repetition;return(0,is_string.A)(image)?"pattern-".concat(image,"-").concat(repetition):"rect"===image.nodeName?"pattern-".concat(image.entity,"-").concat(repetition):void 0},ImagePool}(),LoadImagePlugin=function(){function LoadImagePlugin(){}return LoadImagePlugin.prototype.apply=function(context){var renderingService=context.renderingService,renderingContext=context.renderingContext,imagePool=context.imagePool,canvas=renderingContext.root.ownerDocument.defaultView,calculateWithAspectRatio=function(object,imageWidth,imageHeight){var _a=object.parsedStyle,width=_a.width,height=_a.height;width&&!height?object.setAttribute("height",imageHeight/imageWidth*width):!width&&height&&object.setAttribute("width",imageWidth/imageHeight*height)},handleMounted=function(e){var object=e.target,nodeName=object.nodeName,attributes=object.attributes;if(nodeName===Shape.IMAGE){var img=attributes.img,keepAspectRatio_1=attributes.keepAspectRatio;(0,is_string.A)(img)&&imagePool.getImageSync(img,(function(_a){var width=_a.width,height=_a.height;keepAspectRatio_1&&calculateWithAspectRatio(object,width,height),object.renderable.dirty=!0,renderingService.dirtify()}))}},handleAttributeChanged=function(e){var object=e.target,attrName=e.attrName,newValue=e.newValue;object.nodeName===Shape.IMAGE&&"img"===attrName&&(0,is_string.A)(newValue)&&imagePool.getOrCreateImage(newValue).then((function(_a){var width=_a.width,height=_a.height;object.attributes.keepAspectRatio&&calculateWithAspectRatio(object,width,height),object.renderable.dirty=!0,renderingService.dirtify()}))};renderingService.hooks.init.tap(LoadImagePlugin.tag,(function(){canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged)})),renderingService.hooks.destroy.tap(LoadImagePlugin.tag,(function(){canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged)}))},LoadImagePlugin.tag="LoadImage",LoadImagePlugin}(),g_plugin_image_loader_dist_index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="image-loader",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){this.context.imagePool=new ImagePool(this.context.config),this.addRenderingPlugin(new LoadImagePlugin)},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins()},Plugin}(AbstractRendererPlugin),Canvas2DContextService=function(){function Canvas2DContextService(context){this.renderingContext=context.renderingContext,this.canvasConfig=context.config}return Canvas2DContextService.prototype.init=function(){var _a=this.canvasConfig,container=_a.container,canvas=_a.canvas;if(canvas)this.$canvas=canvas,container&&canvas.parentElement!==container&&container.appendChild(canvas),this.$container=canvas.parentElement,this.canvasConfig.container=this.$container;else if(container&&(this.$container=(0,is_string.A)(container)?document.getElementById(container):container,this.$container)){var $canvas=document.createElement("canvas");this.$container.appendChild($canvas),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=$canvas}this.context=this.$canvas.getContext("2d"),this.resize(this.canvasConfig.width,this.canvasConfig.height)},Canvas2DContextService.prototype.getContext=function(){return this.context},Canvas2DContextService.prototype.getDomElement=function(){return this.$canvas},Canvas2DContextService.prototype.getDPR=function(){return this.dpr},Canvas2DContextService.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},Canvas2DContextService.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},Canvas2DContextService.prototype.resize=function(width,height){var dpr=this.canvasConfig.devicePixelRatio||isBrowser&&window.devicePixelRatio||1;dpr=dpr>=1?Math.ceil(dpr):1,this.dpr=dpr,this.$canvas&&(this.$canvas.width=this.dpr*width,this.$canvas.height=this.dpr*height,setDOMSize(this.$canvas,width,height)),this.renderingContext.renderReasons.add(RenderReason.CAMERA_CHANGED)},Canvas2DContextService.prototype.applyCursorStyle=function(cursor){this.$container&&this.$container.style&&(this.$container.style.cursor=cursor)},Canvas2DContextService.prototype.toDataURL=function(options){return void 0===options&&(options={}),(0,tslib_es6.sH)(this,void 0,void 0,(function(){var type,encoderOptions;return(0,tslib_es6.YH)(this,(function(_a){return type=options.type,encoderOptions=options.encoderOptions,[2,this.context.canvas.toDataURL(type,encoderOptions)]}))}))},Canvas2DContextService}(),ContextRegisterPlugin=function(_super){function ContextRegisterPlugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="canvas-context-register",_this}return(0,tslib_es6.C6)(ContextRegisterPlugin,_super),ContextRegisterPlugin.prototype.init=function(){this.context.ContextService=Canvas2DContextService},ContextRegisterPlugin.prototype.destroy=function(){delete this.context.ContextService},ContextRegisterPlugin}(AbstractRendererPlugin),Renderer=function(_super){function Renderer(config){var _this=_super.call(this,config)||this;return _this.registerPlugin(new ContextRegisterPlugin),_this.registerPlugin(new g_plugin_image_loader_dist_index_esm_Plugin),_this.registerPlugin(new Plugin),_this.registerPlugin(new dist_index_esm_Plugin),_this.registerPlugin(new g_plugin_dom_interaction_dist_index_esm_Plugin),_this.registerPlugin(new index_esm_Plugin),_this.registerPlugin(new g_plugin_html_renderer_dist_index_esm_Plugin),_this}return(0,tslib_es6.C6)(Renderer,_super),Renderer}(AbstractRenderer),g_device_api_node_modules_eventemitter3=__webpack_require__("./node_modules/@antv/g-device-api/node_modules/eventemitter3/index.js");const _antv_g_device_api_node_modules_eventemitter3=__webpack_require__.n(g_device_api_node_modules_eventemitter3)();var GL,ResourceType,CompareFunction,FrontFace,CullMode,BlendFactor,BlendMode,AddressMode,FilterMode,MipmapFilterMode,PrimitiveTopology,BufferUsage,BufferFrequencyHint,VertexStepMode,TextureEvent,TextureDimension,TextureUsage,ChannelWriteMask,StencilOp,SamplerFormatKind,ViewportOrigin,es_ClipSpaceNearZ,QueryPoolType,FormatTypeFlags,FormatCompFlags,FormatFlags,Format;function makeTextureDescriptor2D(format,width,height,mipLevelCount){return{dimension:TextureDimension.TEXTURE_2D,format,width,height,depthOrArrayLayers:1,mipLevelCount,usage:TextureUsage.SAMPLED}}function makeFormat(type,comp,flags){return type<<16|comp<<8|flags}function getFormatCompFlags(fmt){return fmt>>>8&255}function getFormatTypeFlags(fmt){return fmt>>>16&255}function getFormatFlags(fmt){return 255&fmt}function getFormatTypeFlagsByteSize(typeFlags){switch(typeFlags){case FormatTypeFlags.F32:case FormatTypeFlags.U32:case FormatTypeFlags.S32:return 4;case FormatTypeFlags.U16:case FormatTypeFlags.S16:case FormatTypeFlags.F16:return 2;case FormatTypeFlags.U8:case FormatTypeFlags.S8:return 1;default:throw new Error("whoops")}}function getFormatCompByteSize(fmt){return getFormatTypeFlagsByteSize(getFormatTypeFlags(fmt))}function getFormatSamplerKind(fmt){var flags=getFormatFlags(fmt);if(flags&FormatFlags.Depth)return SamplerFormatKind.Depth;if(flags&FormatFlags.Normalized)return SamplerFormatKind.Float;var typeFlags=getFormatTypeFlags(fmt);if(typeFlags===FormatTypeFlags.F16||typeFlags===FormatTypeFlags.F32)return SamplerFormatKind.Float;if(typeFlags===FormatTypeFlags.U8||typeFlags===FormatTypeFlags.U16||typeFlags===FormatTypeFlags.U32)return SamplerFormatKind.Uint;if(typeFlags===FormatTypeFlags.S8||typeFlags===FormatTypeFlags.S16||typeFlags===FormatTypeFlags.S32)return SamplerFormatKind.Sint;throw new Error("whoops")}function es_assert(b,message){if(void 0===message&&(message=""),!b)throw new Error("Assert fail: ".concat(message))}function assertExists(v){if(null!=v)return v;throw new Error("Missing object")}function colorEqual(c0,c1){return c0.r===c1.r&&c0.g===c1.g&&c0.b===c1.b&&c0.a===c1.a}function colorCopy(dst,src){dst.r=src.r,dst.g=src.g,dst.b=src.b,dst.a=src.a}function colorNewCopy(src){return{r:src.r,g:src.g,b:src.b,a:src.a}}function colorNewFromRGBA(r,g,b,a){return void 0===a&&(a=1),{r,g,b,a}}!function(GL){GL[GL.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",GL[GL.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",GL[GL.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",GL[GL.POINTS=0]="POINTS",GL[GL.LINES=1]="LINES",GL[GL.LINE_LOOP=2]="LINE_LOOP",GL[GL.LINE_STRIP=3]="LINE_STRIP",GL[GL.TRIANGLES=4]="TRIANGLES",GL[GL.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",GL[GL.TRIANGLE_FAN=6]="TRIANGLE_FAN",GL[GL.ZERO=0]="ZERO",GL[GL.ONE=1]="ONE",GL[GL.SRC_COLOR=768]="SRC_COLOR",GL[GL.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",GL[GL.SRC_ALPHA=770]="SRC_ALPHA",GL[GL.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",GL[GL.DST_ALPHA=772]="DST_ALPHA",GL[GL.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",GL[GL.DST_COLOR=774]="DST_COLOR",GL[GL.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",GL[GL.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",GL[GL.CONSTANT_COLOR=32769]="CONSTANT_COLOR",GL[GL.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",GL[GL.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",GL[GL.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",GL[GL.FUNC_ADD=32774]="FUNC_ADD",GL[GL.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",GL[GL.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",GL[GL.BLEND_EQUATION=32777]="BLEND_EQUATION",GL[GL.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",GL[GL.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",GL[GL.BLEND_DST_RGB=32968]="BLEND_DST_RGB",GL[GL.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",GL[GL.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",GL[GL.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",GL[GL.BLEND_COLOR=32773]="BLEND_COLOR",GL[GL.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",GL[GL.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",GL[GL.LINE_WIDTH=2849]="LINE_WIDTH",GL[GL.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",GL[GL.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",GL[GL.CULL_FACE_MODE=2885]="CULL_FACE_MODE",GL[GL.FRONT_FACE=2886]="FRONT_FACE",GL[GL.DEPTH_RANGE=2928]="DEPTH_RANGE",GL[GL.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",GL[GL.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",GL[GL.DEPTH_FUNC=2932]="DEPTH_FUNC",GL[GL.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",GL[GL.STENCIL_FUNC=2962]="STENCIL_FUNC",GL[GL.STENCIL_FAIL=2964]="STENCIL_FAIL",GL[GL.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",GL[GL.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",GL[GL.STENCIL_REF=2967]="STENCIL_REF",GL[GL.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",GL[GL.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",GL[GL.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",GL[GL.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",GL[GL.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",GL[GL.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",GL[GL.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",GL[GL.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",GL[GL.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",GL[GL.VIEWPORT=2978]="VIEWPORT",GL[GL.SCISSOR_BOX=3088]="SCISSOR_BOX",GL[GL.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",GL[GL.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",GL[GL.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",GL[GL.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",GL[GL.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",GL[GL.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",GL[GL.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",GL[GL.RED_BITS=3410]="RED_BITS",GL[GL.GREEN_BITS=3411]="GREEN_BITS",GL[GL.BLUE_BITS=3412]="BLUE_BITS",GL[GL.ALPHA_BITS=3413]="ALPHA_BITS",GL[GL.DEPTH_BITS=3414]="DEPTH_BITS",GL[GL.STENCIL_BITS=3415]="STENCIL_BITS",GL[GL.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",GL[GL.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",GL[GL.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",GL[GL.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",GL[GL.SAMPLES=32937]="SAMPLES",GL[GL.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",GL[GL.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",GL[GL.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",GL[GL.VENDOR=7936]="VENDOR",GL[GL.RENDERER=7937]="RENDERER",GL[GL.VERSION=7938]="VERSION",GL[GL.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",GL[GL.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",GL[GL.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",GL[GL.STATIC_DRAW=35044]="STATIC_DRAW",GL[GL.STREAM_DRAW=35040]="STREAM_DRAW",GL[GL.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",GL[GL.ARRAY_BUFFER=34962]="ARRAY_BUFFER",GL[GL.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",GL[GL.BUFFER_SIZE=34660]="BUFFER_SIZE",GL[GL.BUFFER_USAGE=34661]="BUFFER_USAGE",GL[GL.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",GL[GL.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",GL[GL.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",GL[GL.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",GL[GL.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",GL[GL.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",GL[GL.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",GL[GL.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",GL[GL.CULL_FACE=2884]="CULL_FACE",GL[GL.FRONT=1028]="FRONT",GL[GL.BACK=1029]="BACK",GL[GL.FRONT_AND_BACK=1032]="FRONT_AND_BACK",GL[GL.BLEND=3042]="BLEND",GL[GL.DEPTH_TEST=2929]="DEPTH_TEST",GL[GL.DITHER=3024]="DITHER",GL[GL.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",GL[GL.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",GL[GL.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",GL[GL.SCISSOR_TEST=3089]="SCISSOR_TEST",GL[GL.STENCIL_TEST=2960]="STENCIL_TEST",GL[GL.NO_ERROR=0]="NO_ERROR",GL[GL.INVALID_ENUM=1280]="INVALID_ENUM",GL[GL.INVALID_VALUE=1281]="INVALID_VALUE",GL[GL.INVALID_OPERATION=1282]="INVALID_OPERATION",GL[GL.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",GL[GL.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",GL[GL.CW=2304]="CW",GL[GL.CCW=2305]="CCW",GL[GL.DONT_CARE=4352]="DONT_CARE",GL[GL.FASTEST=4353]="FASTEST",GL[GL.NICEST=4354]="NICEST",GL[GL.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",GL[GL.BYTE=5120]="BYTE",GL[GL.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",GL[GL.SHORT=5122]="SHORT",GL[GL.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",GL[GL.INT=5124]="INT",GL[GL.UNSIGNED_INT=5125]="UNSIGNED_INT",GL[GL.FLOAT=5126]="FLOAT",GL[GL.DOUBLE=5130]="DOUBLE",GL[GL.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",GL[GL.ALPHA=6406]="ALPHA",GL[GL.RGB=6407]="RGB",GL[GL.RGBA=6408]="RGBA",GL[GL.LUMINANCE=6409]="LUMINANCE",GL[GL.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",GL[GL.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",GL[GL.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",GL[GL.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",GL[GL.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",GL[GL.VERTEX_SHADER=35633]="VERTEX_SHADER",GL[GL.COMPILE_STATUS=35713]="COMPILE_STATUS",GL[GL.DELETE_STATUS=35712]="DELETE_STATUS",GL[GL.LINK_STATUS=35714]="LINK_STATUS",GL[GL.VALIDATE_STATUS=35715]="VALIDATE_STATUS",GL[GL.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",GL[GL.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",GL[GL.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",GL[GL.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",GL[GL.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",GL[GL.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",GL[GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",GL[GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",GL[GL.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",GL[GL.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",GL[GL.SHADER_TYPE=35663]="SHADER_TYPE",GL[GL.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",GL[GL.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",GL[GL.NEVER=512]="NEVER",GL[GL.ALWAYS=519]="ALWAYS",GL[GL.LESS=513]="LESS",GL[GL.EQUAL=514]="EQUAL",GL[GL.LEQUAL=515]="LEQUAL",GL[GL.GREATER=516]="GREATER",GL[GL.GEQUAL=518]="GEQUAL",GL[GL.NOTEQUAL=517]="NOTEQUAL",GL[GL.KEEP=7680]="KEEP",GL[GL.REPLACE=7681]="REPLACE",GL[GL.INCR=7682]="INCR",GL[GL.DECR=7683]="DECR",GL[GL.INVERT=5386]="INVERT",GL[GL.INCR_WRAP=34055]="INCR_WRAP",GL[GL.DECR_WRAP=34056]="DECR_WRAP",GL[GL.NEAREST=9728]="NEAREST",GL[GL.LINEAR=9729]="LINEAR",GL[GL.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",GL[GL.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",GL[GL.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",GL[GL.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",GL[GL.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",GL[GL.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",GL[GL.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",GL[GL.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",GL[GL.TEXTURE_2D=3553]="TEXTURE_2D",GL[GL.TEXTURE=5890]="TEXTURE",GL[GL.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",GL[GL.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",GL[GL.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",GL[GL.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",GL[GL.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",GL[GL.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",GL[GL.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",GL[GL.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",GL[GL.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",GL[GL.TEXTURE0=33984]="TEXTURE0",GL[GL.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",GL[GL.REPEAT=10497]="REPEAT",GL[GL.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",GL[GL.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",GL[GL.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",GL[GL.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",GL[GL.FLOAT_VEC2=35664]="FLOAT_VEC2",GL[GL.FLOAT_VEC3=35665]="FLOAT_VEC3",GL[GL.FLOAT_VEC4=35666]="FLOAT_VEC4",GL[GL.INT_VEC2=35667]="INT_VEC2",GL[GL.INT_VEC3=35668]="INT_VEC3",GL[GL.INT_VEC4=35669]="INT_VEC4",GL[GL.BOOL=35670]="BOOL",GL[GL.BOOL_VEC2=35671]="BOOL_VEC2",GL[GL.BOOL_VEC3=35672]="BOOL_VEC3",GL[GL.BOOL_VEC4=35673]="BOOL_VEC4",GL[GL.FLOAT_MAT2=35674]="FLOAT_MAT2",GL[GL.FLOAT_MAT3=35675]="FLOAT_MAT3",GL[GL.FLOAT_MAT4=35676]="FLOAT_MAT4",GL[GL.SAMPLER_2D=35678]="SAMPLER_2D",GL[GL.SAMPLER_CUBE=35680]="SAMPLER_CUBE",GL[GL.LOW_FLOAT=36336]="LOW_FLOAT",GL[GL.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",GL[GL.HIGH_FLOAT=36338]="HIGH_FLOAT",GL[GL.LOW_INT=36339]="LOW_INT",GL[GL.MEDIUM_INT=36340]="MEDIUM_INT",GL[GL.HIGH_INT=36341]="HIGH_INT",GL[GL.FRAMEBUFFER=36160]="FRAMEBUFFER",GL[GL.RENDERBUFFER=36161]="RENDERBUFFER",GL[GL.RGBA4=32854]="RGBA4",GL[GL.RGB5_A1=32855]="RGB5_A1",GL[GL.RGB565=36194]="RGB565",GL[GL.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",GL[GL.STENCIL_INDEX=6401]="STENCIL_INDEX",GL[GL.STENCIL_INDEX8=36168]="STENCIL_INDEX8",GL[GL.DEPTH_STENCIL=34041]="DEPTH_STENCIL",GL[GL.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",GL[GL.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",GL[GL.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",GL[GL.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",GL[GL.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",GL[GL.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",GL[GL.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",GL[GL.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",GL[GL.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",GL[GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",GL[GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",GL[GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",GL[GL.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",GL[GL.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",GL[GL.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",GL[GL.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",GL[GL.NONE=0]="NONE",GL[GL.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",GL[GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",GL[GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",GL[GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",GL[GL.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",GL[GL.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",GL[GL.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",GL[GL.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",GL[GL.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",GL[GL.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",GL[GL.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",GL[GL.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",GL[GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",GL[GL.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",GL[GL.READ_BUFFER=3074]="READ_BUFFER",GL[GL.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",GL[GL.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",GL[GL.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",GL[GL.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",GL[GL.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",GL[GL.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",GL[GL.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",GL[GL.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",GL[GL.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",GL[GL.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",GL[GL.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",GL[GL.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",GL[GL.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",GL[GL.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",GL[GL.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",GL[GL.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",GL[GL.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",GL[GL.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",GL[GL.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",GL[GL.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",GL[GL.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",GL[GL.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",GL[GL.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",GL[GL.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",GL[GL.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",GL[GL.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",GL[GL.RED=6403]="RED",GL[GL.RGB8=32849]="RGB8",GL[GL.RGBA8=32856]="RGBA8",GL[GL.RGB10_A2=32857]="RGB10_A2",GL[GL.TEXTURE_3D=32879]="TEXTURE_3D",GL[GL.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",GL[GL.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",GL[GL.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",GL[GL.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",GL[GL.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",GL[GL.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",GL[GL.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",GL[GL.SRGB=35904]="SRGB",GL[GL.SRGB8=35905]="SRGB8",GL[GL.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",GL[GL.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",GL[GL.RGBA32F=34836]="RGBA32F",GL[GL.RGB32F=34837]="RGB32F",GL[GL.RGBA16F=34842]="RGBA16F",GL[GL.RGB16F=34843]="RGB16F",GL[GL.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",GL[GL.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",GL[GL.R11F_G11F_B10F=35898]="R11F_G11F_B10F",GL[GL.RGB9_E5=35901]="RGB9_E5",GL[GL.RGBA32UI=36208]="RGBA32UI",GL[GL.RGB32UI=36209]="RGB32UI",GL[GL.RGBA16UI=36214]="RGBA16UI",GL[GL.RGB16UI=36215]="RGB16UI",GL[GL.RGBA8UI=36220]="RGBA8UI",GL[GL.RGB8UI=36221]="RGB8UI",GL[GL.RGBA32I=36226]="RGBA32I",GL[GL.RGB32I=36227]="RGB32I",GL[GL.RGBA16I=36232]="RGBA16I",GL[GL.RGB16I=36233]="RGB16I",GL[GL.RGBA8I=36238]="RGBA8I",GL[GL.RGB8I=36239]="RGB8I",GL[GL.RED_INTEGER=36244]="RED_INTEGER",GL[GL.RGB_INTEGER=36248]="RGB_INTEGER",GL[GL.RGBA_INTEGER=36249]="RGBA_INTEGER",GL[GL.R8=33321]="R8",GL[GL.RG8=33323]="RG8",GL[GL.R16F=33325]="R16F",GL[GL.R32F=33326]="R32F",GL[GL.RG16F=33327]="RG16F",GL[GL.RG32F=33328]="RG32F",GL[GL.R8I=33329]="R8I",GL[GL.R8UI=33330]="R8UI",GL[GL.R16I=33331]="R16I",GL[GL.R16UI=33332]="R16UI",GL[GL.R32I=33333]="R32I",GL[GL.R32UI=33334]="R32UI",GL[GL.RG8I=33335]="RG8I",GL[GL.RG8UI=33336]="RG8UI",GL[GL.RG16I=33337]="RG16I",GL[GL.RG16UI=33338]="RG16UI",GL[GL.RG32I=33339]="RG32I",GL[GL.RG32UI=33340]="RG32UI",GL[GL.R8_SNORM=36756]="R8_SNORM",GL[GL.RG8_SNORM=36757]="RG8_SNORM",GL[GL.RGB8_SNORM=36758]="RGB8_SNORM",GL[GL.RGBA8_SNORM=36759]="RGBA8_SNORM",GL[GL.RGB10_A2UI=36975]="RGB10_A2UI",GL[GL.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",GL[GL.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",GL[GL.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",GL[GL.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",GL[GL.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",GL[GL.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",GL[GL.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",GL[GL.HALF_FLOAT=5131]="HALF_FLOAT",GL[GL.RG=33319]="RG",GL[GL.RG_INTEGER=33320]="RG_INTEGER",GL[GL.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",GL[GL.CURRENT_QUERY=34917]="CURRENT_QUERY",GL[GL.QUERY_RESULT=34918]="QUERY_RESULT",GL[GL.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",GL[GL.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",GL[GL.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",GL[GL.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",GL[GL.DRAW_BUFFER0=34853]="DRAW_BUFFER0",GL[GL.DRAW_BUFFER1=34854]="DRAW_BUFFER1",GL[GL.DRAW_BUFFER2=34855]="DRAW_BUFFER2",GL[GL.DRAW_BUFFER3=34856]="DRAW_BUFFER3",GL[GL.DRAW_BUFFER4=34857]="DRAW_BUFFER4",GL[GL.DRAW_BUFFER5=34858]="DRAW_BUFFER5",GL[GL.DRAW_BUFFER6=34859]="DRAW_BUFFER6",GL[GL.DRAW_BUFFER7=34860]="DRAW_BUFFER7",GL[GL.DRAW_BUFFER8=34861]="DRAW_BUFFER8",GL[GL.DRAW_BUFFER9=34862]="DRAW_BUFFER9",GL[GL.DRAW_BUFFER10=34863]="DRAW_BUFFER10",GL[GL.DRAW_BUFFER11=34864]="DRAW_BUFFER11",GL[GL.DRAW_BUFFER12=34865]="DRAW_BUFFER12",GL[GL.DRAW_BUFFER13=34866]="DRAW_BUFFER13",GL[GL.DRAW_BUFFER14=34867]="DRAW_BUFFER14",GL[GL.DRAW_BUFFER15=34868]="DRAW_BUFFER15",GL[GL.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",GL[GL.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",GL[GL.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",GL[GL.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",GL[GL.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",GL[GL.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",GL[GL.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",GL[GL.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",GL[GL.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",GL[GL.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",GL[GL.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",GL[GL.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",GL[GL.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",GL[GL.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",GL[GL.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",GL[GL.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",GL[GL.SAMPLER_3D=35679]="SAMPLER_3D",GL[GL.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",GL[GL.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",GL[GL.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",GL[GL.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",GL[GL.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",GL[GL.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",GL[GL.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",GL[GL.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",GL[GL.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",GL[GL.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",GL[GL.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",GL[GL.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",GL[GL.MAX_SAMPLES=36183]="MAX_SAMPLES",GL[GL.SAMPLER_BINDING=35097]="SAMPLER_BINDING",GL[GL.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",GL[GL.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",GL[GL.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",GL[GL.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",GL[GL.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",GL[GL.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",GL[GL.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",GL[GL.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",GL[GL.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",GL[GL.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",GL[GL.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",GL[GL.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",GL[GL.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",GL[GL.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",GL[GL.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",GL[GL.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",GL[GL.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",GL[GL.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",GL[GL.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",GL[GL.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",GL[GL.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",GL[GL.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",GL[GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",GL[GL.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",GL[GL.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",GL[GL.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",GL[GL.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",GL[GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",GL[GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",GL[GL.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",GL[GL.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",GL[GL.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",GL[GL.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",GL[GL.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",GL[GL.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",GL[GL.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",GL[GL.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",GL[GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",GL[GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",GL[GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",GL[GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",GL[GL.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",GL[GL.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",GL[GL.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",GL[GL.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",GL[GL.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",GL[GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",GL[GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",GL[GL.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",GL[GL.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",GL[GL.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",GL[GL.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",GL[GL.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",GL[GL.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",GL[GL.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",GL[GL.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",GL[GL.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",GL[GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",GL[GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",GL[GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",GL[GL.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",GL[GL.UNIFORM_TYPE=35383]="UNIFORM_TYPE",GL[GL.UNIFORM_SIZE=35384]="UNIFORM_SIZE",GL[GL.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",GL[GL.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",GL[GL.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",GL[GL.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",GL[GL.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",GL[GL.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",GL[GL.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",GL[GL.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",GL[GL.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",GL[GL.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",GL[GL.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",GL[GL.OBJECT_TYPE=37138]="OBJECT_TYPE",GL[GL.SYNC_CONDITION=37139]="SYNC_CONDITION",GL[GL.SYNC_STATUS=37140]="SYNC_STATUS",GL[GL.SYNC_FLAGS=37141]="SYNC_FLAGS",GL[GL.SYNC_FENCE=37142]="SYNC_FENCE",GL[GL.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",GL[GL.UNSIGNALED=37144]="UNSIGNALED",GL[GL.SIGNALED=37145]="SIGNALED",GL[GL.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",GL[GL.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",GL[GL.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",GL[GL.WAIT_FAILED=37149]="WAIT_FAILED",GL[GL.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",GL[GL.COLOR=6144]="COLOR",GL[GL.DEPTH=6145]="DEPTH",GL[GL.STENCIL=6146]="STENCIL",GL[GL.MIN=32775]="MIN",GL[GL.MAX=32776]="MAX",GL[GL.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",GL[GL.STREAM_READ=35041]="STREAM_READ",GL[GL.STREAM_COPY=35042]="STREAM_COPY",GL[GL.STATIC_READ=35045]="STATIC_READ",GL[GL.STATIC_COPY=35046]="STATIC_COPY",GL[GL.DYNAMIC_READ=35049]="DYNAMIC_READ",GL[GL.DYNAMIC_COPY=35050]="DYNAMIC_COPY",GL[GL.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",GL[GL.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",GL[GL.INVALID_INDEX=4294967295]="INVALID_INDEX",GL[GL.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",GL[GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",GL[GL.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",GL[GL.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",GL[GL.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",GL[GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",GL[GL.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",GL[GL.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",GL[GL.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",GL[GL.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",GL[GL.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",GL[GL.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",GL[GL.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",GL[GL.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",GL[GL.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",GL[GL.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",GL[GL.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",GL[GL.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",GL[GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",GL[GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",GL[GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",GL[GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",GL[GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",GL[GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",GL[GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",GL[GL.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",GL[GL.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",GL[GL.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",GL[GL.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",GL[GL.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",GL[GL.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",GL[GL.RGBA32F_EXT=34836]="RGBA32F_EXT",GL[GL.RGB32F_EXT=34837]="RGB32F_EXT",GL[GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",GL[GL.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",GL[GL.MIN_EXT=32775]="MIN_EXT",GL[GL.MAX_EXT=32776]="MAX_EXT",GL[GL.SRGB_EXT=35904]="SRGB_EXT",GL[GL.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",GL[GL.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",GL[GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",GL[GL.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",GL[GL.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",GL[GL.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",GL[GL.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",GL[GL.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",GL[GL.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",GL[GL.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",GL[GL.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",GL[GL.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",GL[GL.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",GL[GL.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",GL[GL.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",GL[GL.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",GL[GL.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",GL[GL.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",GL[GL.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",GL[GL.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",GL[GL.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",GL[GL.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",GL[GL.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",GL[GL.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",GL[GL.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",GL[GL.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",GL[GL.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",GL[GL.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",GL[GL.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",GL[GL.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",GL[GL.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",GL[GL.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",GL[GL.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",GL[GL.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",GL[GL.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",GL[GL.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",GL[GL.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",GL[GL.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",GL[GL.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",GL[GL.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",GL[GL.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",GL[GL.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",GL[GL.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",GL[GL.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",GL[GL.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",GL[GL.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(GL||(GL={})),function(ResourceType){ResourceType[ResourceType.Buffer=0]="Buffer",ResourceType[ResourceType.Texture=1]="Texture",ResourceType[ResourceType.RenderTarget=2]="RenderTarget",ResourceType[ResourceType.Sampler=3]="Sampler",ResourceType[ResourceType.Program=4]="Program",ResourceType[ResourceType.Bindings=5]="Bindings",ResourceType[ResourceType.InputLayout=6]="InputLayout",ResourceType[ResourceType.RenderPipeline=7]="RenderPipeline",ResourceType[ResourceType.ComputePipeline=8]="ComputePipeline",ResourceType[ResourceType.Readback=9]="Readback",ResourceType[ResourceType.QueryPool=10]="QueryPool",ResourceType[ResourceType.RenderBundle=11]="RenderBundle"}(ResourceType||(ResourceType={})),function(CompareFunction){CompareFunction[CompareFunction.NEVER=512]="NEVER",CompareFunction[CompareFunction.LESS=513]="LESS",CompareFunction[CompareFunction.EQUAL=514]="EQUAL",CompareFunction[CompareFunction.LEQUAL=515]="LEQUAL",CompareFunction[CompareFunction.GREATER=516]="GREATER",CompareFunction[CompareFunction.NOTEQUAL=517]="NOTEQUAL",CompareFunction[CompareFunction.GEQUAL=518]="GEQUAL",CompareFunction[CompareFunction.ALWAYS=519]="ALWAYS"}(CompareFunction||(CompareFunction={})),function(FrontFace){FrontFace[FrontFace.CCW=2305]="CCW",FrontFace[FrontFace.CW=2304]="CW"}(FrontFace||(FrontFace={})),function(CullMode){CullMode[CullMode.NONE=0]="NONE",CullMode[CullMode.FRONT=1]="FRONT",CullMode[CullMode.BACK=2]="BACK",CullMode[CullMode.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(CullMode||(CullMode={})),function(BlendFactor){BlendFactor[BlendFactor.ZERO=0]="ZERO",BlendFactor[BlendFactor.ONE=1]="ONE",BlendFactor[BlendFactor.SRC=768]="SRC",BlendFactor[BlendFactor.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",BlendFactor[BlendFactor.DST=774]="DST",BlendFactor[BlendFactor.ONE_MINUS_DST=775]="ONE_MINUS_DST",BlendFactor[BlendFactor.SRC_ALPHA=770]="SRC_ALPHA",BlendFactor[BlendFactor.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",BlendFactor[BlendFactor.DST_ALPHA=772]="DST_ALPHA",BlendFactor[BlendFactor.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",BlendFactor[BlendFactor.CONST=32769]="CONST",BlendFactor[BlendFactor.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",BlendFactor[BlendFactor.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(BlendFactor||(BlendFactor={})),function(BlendMode){BlendMode[BlendMode.ADD=32774]="ADD",BlendMode[BlendMode.SUBSTRACT=32778]="SUBSTRACT",BlendMode[BlendMode.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",BlendMode[BlendMode.MIN=32775]="MIN",BlendMode[BlendMode.MAX=32776]="MAX"}(BlendMode||(BlendMode={})),function(AddressMode){AddressMode[AddressMode.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",AddressMode[AddressMode.REPEAT=1]="REPEAT",AddressMode[AddressMode.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(AddressMode||(AddressMode={})),function(FilterMode){FilterMode[FilterMode.POINT=0]="POINT",FilterMode[FilterMode.BILINEAR=1]="BILINEAR"}(FilterMode||(FilterMode={})),function(MipmapFilterMode){MipmapFilterMode[MipmapFilterMode.NO_MIP=0]="NO_MIP",MipmapFilterMode[MipmapFilterMode.NEAREST=1]="NEAREST",MipmapFilterMode[MipmapFilterMode.LINEAR=2]="LINEAR"}(MipmapFilterMode||(MipmapFilterMode={})),function(PrimitiveTopology){PrimitiveTopology[PrimitiveTopology.POINTS=0]="POINTS",PrimitiveTopology[PrimitiveTopology.TRIANGLES=1]="TRIANGLES",PrimitiveTopology[PrimitiveTopology.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",PrimitiveTopology[PrimitiveTopology.LINES=3]="LINES",PrimitiveTopology[PrimitiveTopology.LINE_STRIP=4]="LINE_STRIP"}(PrimitiveTopology||(PrimitiveTopology={})),function(BufferUsage){BufferUsage[BufferUsage.MAP_READ=1]="MAP_READ",BufferUsage[BufferUsage.MAP_WRITE=2]="MAP_WRITE",BufferUsage[BufferUsage.COPY_SRC=4]="COPY_SRC",BufferUsage[BufferUsage.COPY_DST=8]="COPY_DST",BufferUsage[BufferUsage.INDEX=16]="INDEX",BufferUsage[BufferUsage.VERTEX=32]="VERTEX",BufferUsage[BufferUsage.UNIFORM=64]="UNIFORM",BufferUsage[BufferUsage.STORAGE=128]="STORAGE",BufferUsage[BufferUsage.INDIRECT=256]="INDIRECT",BufferUsage[BufferUsage.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(BufferUsage||(BufferUsage={})),function(BufferFrequencyHint){BufferFrequencyHint[BufferFrequencyHint.STATIC=1]="STATIC",BufferFrequencyHint[BufferFrequencyHint.DYNAMIC=2]="DYNAMIC"}(BufferFrequencyHint||(BufferFrequencyHint={})),function(VertexStepMode){VertexStepMode[VertexStepMode.VERTEX=1]="VERTEX",VertexStepMode[VertexStepMode.INSTANCE=2]="INSTANCE"}(VertexStepMode||(VertexStepMode={})),function(TextureEvent){TextureEvent.LOADED="loaded"}(TextureEvent||(TextureEvent={})),function(TextureDimension){TextureDimension[TextureDimension.TEXTURE_2D=0]="TEXTURE_2D",TextureDimension[TextureDimension.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",TextureDimension[TextureDimension.TEXTURE_3D=2]="TEXTURE_3D",TextureDimension[TextureDimension.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(TextureDimension||(TextureDimension={})),function(TextureUsage){TextureUsage[TextureUsage.SAMPLED=1]="SAMPLED",TextureUsage[TextureUsage.RENDER_TARGET=2]="RENDER_TARGET",TextureUsage[TextureUsage.STORAGE=4]="STORAGE"}(TextureUsage||(TextureUsage={})),function(ChannelWriteMask){ChannelWriteMask[ChannelWriteMask.NONE=0]="NONE",ChannelWriteMask[ChannelWriteMask.RED=1]="RED",ChannelWriteMask[ChannelWriteMask.GREEN=2]="GREEN",ChannelWriteMask[ChannelWriteMask.BLUE=4]="BLUE",ChannelWriteMask[ChannelWriteMask.ALPHA=8]="ALPHA",ChannelWriteMask[ChannelWriteMask.RGB=7]="RGB",ChannelWriteMask[ChannelWriteMask.ALL=15]="ALL"}(ChannelWriteMask||(ChannelWriteMask={})),function(StencilOp){StencilOp[StencilOp.KEEP=7680]="KEEP",StencilOp[StencilOp.ZERO=0]="ZERO",StencilOp[StencilOp.REPLACE=7681]="REPLACE",StencilOp[StencilOp.INVERT=5386]="INVERT",StencilOp[StencilOp.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",StencilOp[StencilOp.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",StencilOp[StencilOp.INCREMENT_WRAP=34055]="INCREMENT_WRAP",StencilOp[StencilOp.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(StencilOp||(StencilOp={})),function(SamplerFormatKind){SamplerFormatKind[SamplerFormatKind.Float=0]="Float",SamplerFormatKind[SamplerFormatKind.UnfilterableFloat=1]="UnfilterableFloat",SamplerFormatKind[SamplerFormatKind.Uint=2]="Uint",SamplerFormatKind[SamplerFormatKind.Sint=3]="Sint",SamplerFormatKind[SamplerFormatKind.Depth=4]="Depth"}(SamplerFormatKind||(SamplerFormatKind={})),function(ViewportOrigin){ViewportOrigin[ViewportOrigin.LOWER_LEFT=0]="LOWER_LEFT",ViewportOrigin[ViewportOrigin.UPPER_LEFT=1]="UPPER_LEFT"}(ViewportOrigin||(ViewportOrigin={})),function(ClipSpaceNearZ){ClipSpaceNearZ[ClipSpaceNearZ.NEGATIVE_ONE=0]="NEGATIVE_ONE",ClipSpaceNearZ[ClipSpaceNearZ.ZERO=1]="ZERO"}(es_ClipSpaceNearZ||(es_ClipSpaceNearZ={})),function(QueryPoolType){QueryPoolType[QueryPoolType.OcclusionConservative=0]="OcclusionConservative"}(QueryPoolType||(QueryPoolType={})),function(FormatTypeFlags){FormatTypeFlags[FormatTypeFlags.U8=1]="U8",FormatTypeFlags[FormatTypeFlags.U16=2]="U16",FormatTypeFlags[FormatTypeFlags.U32=3]="U32",FormatTypeFlags[FormatTypeFlags.S8=4]="S8",FormatTypeFlags[FormatTypeFlags.S16=5]="S16",FormatTypeFlags[FormatTypeFlags.S32=6]="S32",FormatTypeFlags[FormatTypeFlags.F16=7]="F16",FormatTypeFlags[FormatTypeFlags.F32=8]="F32",FormatTypeFlags[FormatTypeFlags.BC1=65]="BC1",FormatTypeFlags[FormatTypeFlags.BC2=66]="BC2",FormatTypeFlags[FormatTypeFlags.BC3=67]="BC3",FormatTypeFlags[FormatTypeFlags.BC4_UNORM=68]="BC4_UNORM",FormatTypeFlags[FormatTypeFlags.BC4_SNORM=69]="BC4_SNORM",FormatTypeFlags[FormatTypeFlags.BC5_UNORM=70]="BC5_UNORM",FormatTypeFlags[FormatTypeFlags.BC5_SNORM=71]="BC5_SNORM",FormatTypeFlags[FormatTypeFlags.U16_PACKED_5551=97]="U16_PACKED_5551",FormatTypeFlags[FormatTypeFlags.U16_PACKED_565=98]="U16_PACKED_565",FormatTypeFlags[FormatTypeFlags.D24=129]="D24",FormatTypeFlags[FormatTypeFlags.D32F=130]="D32F",FormatTypeFlags[FormatTypeFlags.D24S8=131]="D24S8",FormatTypeFlags[FormatTypeFlags.D32FS8=132]="D32FS8"}(FormatTypeFlags||(FormatTypeFlags={})),function(FormatCompFlags){FormatCompFlags[FormatCompFlags.R=1]="R",FormatCompFlags[FormatCompFlags.RG=2]="RG",FormatCompFlags[FormatCompFlags.RGB=3]="RGB",FormatCompFlags[FormatCompFlags.RGBA=4]="RGBA",FormatCompFlags[FormatCompFlags.A=5]="A"}(FormatCompFlags||(FormatCompFlags={})),function(FormatFlags){FormatFlags[FormatFlags.None=0]="None",FormatFlags[FormatFlags.Normalized=1]="Normalized",FormatFlags[FormatFlags.sRGB=2]="sRGB",FormatFlags[FormatFlags.Depth=4]="Depth",FormatFlags[FormatFlags.Stencil=8]="Stencil",FormatFlags[FormatFlags.RenderTarget=16]="RenderTarget",FormatFlags[FormatFlags.Luminance=32]="Luminance"}(FormatFlags||(FormatFlags={})),function(Format){Format[Format.ALPHA=makeFormat(FormatTypeFlags.U8,FormatCompFlags.A,FormatFlags.None)]="ALPHA",Format[Format.U8_LUMINANCE=makeFormat(FormatTypeFlags.U8,FormatCompFlags.A,FormatFlags.Luminance)]="U8_LUMINANCE",Format[Format.F16_LUMINANCE=makeFormat(FormatTypeFlags.F16,FormatCompFlags.A,FormatFlags.Luminance)]="F16_LUMINANCE",Format[Format.F32_LUMINANCE=makeFormat(FormatTypeFlags.F32,FormatCompFlags.A,FormatFlags.Luminance)]="F32_LUMINANCE",Format[Format.F16_R=makeFormat(FormatTypeFlags.F16,FormatCompFlags.R,FormatFlags.None)]="F16_R",Format[Format.F16_RG=makeFormat(FormatTypeFlags.F16,FormatCompFlags.RG,FormatFlags.None)]="F16_RG",Format[Format.F16_RGB=makeFormat(FormatTypeFlags.F16,FormatCompFlags.RGB,FormatFlags.None)]="F16_RGB",Format[Format.F16_RGBA=makeFormat(FormatTypeFlags.F16,FormatCompFlags.RGBA,FormatFlags.None)]="F16_RGBA",Format[Format.F32_R=makeFormat(FormatTypeFlags.F32,FormatCompFlags.R,FormatFlags.None)]="F32_R",Format[Format.F32_RG=makeFormat(FormatTypeFlags.F32,FormatCompFlags.RG,FormatFlags.None)]="F32_RG",Format[Format.F32_RGB=makeFormat(FormatTypeFlags.F32,FormatCompFlags.RGB,FormatFlags.None)]="F32_RGB",Format[Format.F32_RGBA=makeFormat(FormatTypeFlags.F32,FormatCompFlags.RGBA,FormatFlags.None)]="F32_RGBA",Format[Format.U8_R=makeFormat(FormatTypeFlags.U8,FormatCompFlags.R,FormatFlags.None)]="U8_R",Format[Format.U8_R_NORM=makeFormat(FormatTypeFlags.U8,FormatCompFlags.R,FormatFlags.Normalized)]="U8_R_NORM",Format[Format.U8_RG=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RG,FormatFlags.None)]="U8_RG",Format[Format.U8_RG_NORM=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RG,FormatFlags.Normalized)]="U8_RG_NORM",Format[Format.U8_RGB=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGB,FormatFlags.None)]="U8_RGB",Format[Format.U8_RGB_NORM=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGB,FormatFlags.Normalized)]="U8_RGB_NORM",Format[Format.U8_RGB_SRGB=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGB,FormatFlags.sRGB|FormatFlags.Normalized)]="U8_RGB_SRGB",Format[Format.U8_RGBA=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGBA,FormatFlags.None)]="U8_RGBA",Format[Format.U8_RGBA_NORM=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGBA,FormatFlags.Normalized)]="U8_RGBA_NORM",Format[Format.U8_RGBA_SRGB=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGBA,FormatFlags.sRGB|FormatFlags.Normalized)]="U8_RGBA_SRGB",Format[Format.U16_R=makeFormat(FormatTypeFlags.U16,FormatCompFlags.R,FormatFlags.None)]="U16_R",Format[Format.U16_R_NORM=makeFormat(FormatTypeFlags.U16,FormatCompFlags.R,FormatFlags.Normalized)]="U16_R_NORM",Format[Format.U16_RG_NORM=makeFormat(FormatTypeFlags.U16,FormatCompFlags.RG,FormatFlags.Normalized)]="U16_RG_NORM",Format[Format.U16_RGBA_NORM=makeFormat(FormatTypeFlags.U16,FormatCompFlags.RGBA,FormatFlags.Normalized)]="U16_RGBA_NORM",Format[Format.U16_RGBA=makeFormat(FormatTypeFlags.U16,FormatCompFlags.RGBA,FormatFlags.None)]="U16_RGBA",Format[Format.U16_RGB=makeFormat(FormatTypeFlags.U16,FormatCompFlags.RGB,FormatFlags.None)]="U16_RGB",Format[Format.U16_RG=makeFormat(FormatTypeFlags.U16,FormatCompFlags.RG,FormatFlags.None)]="U16_RG",Format[Format.U32_R=makeFormat(FormatTypeFlags.U32,FormatCompFlags.R,FormatFlags.None)]="U32_R",Format[Format.U32_RG=makeFormat(FormatTypeFlags.U32,FormatCompFlags.RG,FormatFlags.None)]="U32_RG",Format[Format.U32_RGB=makeFormat(FormatTypeFlags.U32,FormatCompFlags.RGB,FormatFlags.None)]="U32_RGB",Format[Format.U32_RGBA=makeFormat(FormatTypeFlags.U32,FormatCompFlags.RGBA,FormatFlags.None)]="U32_RGBA",Format[Format.S8_R=makeFormat(FormatTypeFlags.S8,FormatCompFlags.R,FormatFlags.None)]="S8_R",Format[Format.S8_R_NORM=makeFormat(FormatTypeFlags.S8,FormatCompFlags.R,FormatFlags.Normalized)]="S8_R_NORM",Format[Format.S8_RG_NORM=makeFormat(FormatTypeFlags.S8,FormatCompFlags.RG,FormatFlags.Normalized)]="S8_RG_NORM",Format[Format.S8_RGB_NORM=makeFormat(FormatTypeFlags.S8,FormatCompFlags.RGB,FormatFlags.Normalized)]="S8_RGB_NORM",Format[Format.S8_RGBA_NORM=makeFormat(FormatTypeFlags.S8,FormatCompFlags.RGBA,FormatFlags.Normalized)]="S8_RGBA_NORM",Format[Format.S16_R=makeFormat(FormatTypeFlags.S16,FormatCompFlags.R,FormatFlags.None)]="S16_R",Format[Format.S16_RG=makeFormat(FormatTypeFlags.S16,FormatCompFlags.RG,FormatFlags.None)]="S16_RG",Format[Format.S16_RG_NORM=makeFormat(FormatTypeFlags.S16,FormatCompFlags.RG,FormatFlags.Normalized)]="S16_RG_NORM",Format[Format.S16_RGB_NORM=makeFormat(FormatTypeFlags.S16,FormatCompFlags.RGB,FormatFlags.Normalized)]="S16_RGB_NORM",Format[Format.S16_RGBA=makeFormat(FormatTypeFlags.S16,FormatCompFlags.RGBA,FormatFlags.None)]="S16_RGBA",Format[Format.S16_RGBA_NORM=makeFormat(FormatTypeFlags.S16,FormatCompFlags.RGBA,FormatFlags.Normalized)]="S16_RGBA_NORM",Format[Format.S32_R=makeFormat(FormatTypeFlags.S32,FormatCompFlags.R,FormatFlags.None)]="S32_R",Format[Format.S32_RG=makeFormat(FormatTypeFlags.S32,FormatCompFlags.RG,FormatFlags.None)]="S32_RG",Format[Format.S32_RGB=makeFormat(FormatTypeFlags.S32,FormatCompFlags.RGB,FormatFlags.None)]="S32_RGB",Format[Format.S32_RGBA=makeFormat(FormatTypeFlags.S32,FormatCompFlags.RGBA,FormatFlags.None)]="S32_RGBA",Format[Format.U16_RGBA_5551=makeFormat(FormatTypeFlags.U16_PACKED_5551,FormatCompFlags.RGBA,FormatFlags.Normalized)]="U16_RGBA_5551",Format[Format.U16_RGB_565=makeFormat(FormatTypeFlags.U16_PACKED_565,FormatCompFlags.RGB,FormatFlags.Normalized)]="U16_RGB_565",Format[Format.BC1=makeFormat(FormatTypeFlags.BC1,FormatCompFlags.RGBA,FormatFlags.Normalized)]="BC1",Format[Format.BC1_SRGB=makeFormat(FormatTypeFlags.BC1,FormatCompFlags.RGBA,FormatFlags.Normalized|FormatFlags.sRGB)]="BC1_SRGB",Format[Format.BC2=makeFormat(FormatTypeFlags.BC2,FormatCompFlags.RGBA,FormatFlags.Normalized)]="BC2",Format[Format.BC2_SRGB=makeFormat(FormatTypeFlags.BC2,FormatCompFlags.RGBA,FormatFlags.Normalized|FormatFlags.sRGB)]="BC2_SRGB",Format[Format.BC3=makeFormat(FormatTypeFlags.BC3,FormatCompFlags.RGBA,FormatFlags.Normalized)]="BC3",Format[Format.BC3_SRGB=makeFormat(FormatTypeFlags.BC3,FormatCompFlags.RGBA,FormatFlags.Normalized|FormatFlags.sRGB)]="BC3_SRGB",Format[Format.BC4_UNORM=makeFormat(FormatTypeFlags.BC4_UNORM,FormatCompFlags.R,FormatFlags.Normalized)]="BC4_UNORM",Format[Format.BC4_SNORM=makeFormat(FormatTypeFlags.BC4_SNORM,FormatCompFlags.R,FormatFlags.Normalized)]="BC4_SNORM",Format[Format.BC5_UNORM=makeFormat(FormatTypeFlags.BC5_UNORM,FormatCompFlags.RG,FormatFlags.Normalized)]="BC5_UNORM",Format[Format.BC5_SNORM=makeFormat(FormatTypeFlags.BC5_SNORM,FormatCompFlags.RG,FormatFlags.Normalized)]="BC5_SNORM",Format[Format.D24=makeFormat(FormatTypeFlags.D24,FormatCompFlags.R,FormatFlags.Depth)]="D24",Format[Format.D24_S8=makeFormat(FormatTypeFlags.D24S8,FormatCompFlags.RG,FormatFlags.Depth|FormatFlags.Stencil)]="D24_S8",Format[Format.D32F=makeFormat(FormatTypeFlags.D32F,FormatCompFlags.R,FormatFlags.Depth)]="D32F",Format[Format.D32F_S8=makeFormat(FormatTypeFlags.D32FS8,FormatCompFlags.RG,FormatFlags.Depth|FormatFlags.Stencil)]="D32F_S8",Format[Format.U8_RGB_RT=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGB,FormatFlags.RenderTarget|FormatFlags.Normalized)]="U8_RGB_RT",Format[Format.U8_RGBA_RT=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGBA,FormatFlags.RenderTarget|FormatFlags.Normalized)]="U8_RGBA_RT",Format[Format.U8_RGBA_RT_SRGB=makeFormat(FormatTypeFlags.U8,FormatCompFlags.RGBA,FormatFlags.RenderTarget|FormatFlags.Normalized|FormatFlags.sRGB)]="U8_RGBA_RT_SRGB"}(Format||(Format={}));var TransparentBlack=colorNewFromRGBA(0,0,0,0),OpaqueBlack=colorNewFromRGBA(0,0,0,1),TransparentWhite=colorNewFromRGBA(1,1,1,0),OpaqueWhite=colorNewFromRGBA(1,1,1,1);function isPowerOfTwo(n){return!(!n||0!=(n&n-1))}function fallbackUndefined(v,fallback){return null!=v?v:fallback}function nullify(v){return void 0===v?null:v}function fillArray(L,n,v){L.length=n,L.fill(v)}function align(n,multiple){var mask=multiple-1;return n+mask&~mask}function alignNonPowerOfTwo(n,multiple){return((n+multiple-1)/multiple|0)*multiple}function setBitFlagEnabled(v,mask,enabled){return enabled?v|=mask:v&=~mask,v}function nArray(n,c){for(var d=new Array(n),i=0;i<n;i++)d[i]=c();return d}function copyChannelBlendState(dst,src){dst.blendDstFactor=src.blendDstFactor,dst.blendSrcFactor=src.blendSrcFactor,dst.blendMode=src.blendMode}function copyStencilFaceState(dst,src){return void 0===dst&&(dst={}),dst.compare=src.compare,dst.depthFailOp=src.depthFailOp,dst.passOp=src.passOp,dst.failOp=src.failOp,dst.mask=src.mask,dst}function copyAttachmentState(dst,src){return void 0===dst&&(dst={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),copyChannelBlendState(dst.rgbBlendState,src.rgbBlendState),copyChannelBlendState(dst.alphaBlendState,src.alphaBlendState),dst.channelWriteMask=src.channelWriteMask,dst}function copyAttachmentsState(dst,src){dst.length!==src.length&&(dst.length=src.length);for(var i=0;i<src.length;i++)dst[i]=copyAttachmentState(dst[i],src[i])}function setMegaStateFlags(dst,src){void 0!==src.attachmentsState&&copyAttachmentsState(dst.attachmentsState,src.attachmentsState),dst.blendConstant&&src.blendConstant&&colorCopy(dst.blendConstant,src.blendConstant),dst.depthCompare=fallbackUndefined(src.depthCompare,dst.depthCompare),dst.depthWrite=fallbackUndefined(src.depthWrite,dst.depthWrite),dst.stencilWrite=fallbackUndefined(src.stencilWrite,dst.stencilWrite),dst.stencilFront&&src.stencilFront&&copyStencilFaceState(dst.stencilFront,src.stencilFront),dst.stencilBack&&src.stencilBack&&copyStencilFaceState(dst.stencilBack,src.stencilBack),dst.cullMode=fallbackUndefined(src.cullMode,dst.cullMode),dst.frontFace=fallbackUndefined(src.frontFace,dst.frontFace),dst.polygonOffset=fallbackUndefined(src.polygonOffset,dst.polygonOffset)}function copyMegaState(src){var dst=Object.assign({},src);return dst.attachmentsState=[],copyAttachmentsState(dst.attachmentsState,src.attachmentsState),dst.blendConstant=dst.blendConstant&&colorNewCopy(dst.blendConstant),dst.stencilFront=copyStencilFaceState(void 0,src.stencilFront),dst.stencilBack=copyStencilFaceState(void 0,src.stencilBack),dst}var defaultBlendState={blendMode:BlendMode.ADD,blendSrcFactor:BlendFactor.ONE,blendDstFactor:BlendFactor.ZERO},defaultMegaState={attachmentsState:[{channelWriteMask:ChannelWriteMask.ALL,rgbBlendState:defaultBlendState,alphaBlendState:defaultBlendState}],blendConstant:colorNewCopy(TransparentBlack),depthWrite:!0,depthCompare:CompareFunction.LEQUAL,stencilWrite:!1,stencilFront:{compare:CompareFunction.ALWAYS,passOp:StencilOp.KEEP,depthFailOp:StencilOp.KEEP,failOp:StencilOp.KEEP},stencilBack:{compare:CompareFunction.ALWAYS,passOp:StencilOp.KEEP,depthFailOp:StencilOp.KEEP,failOp:StencilOp.KEEP},cullMode:CullMode.NONE,frontFace:FrontFace.CCW,polygonOffset:!1};var fullscreenMegaState=function makeMegaState(other,src){void 0===other&&(other=null),void 0===src&&(src=defaultMegaState);var dst=copyMegaState(src);return null!==other&&setMegaStateFlags(dst,other),dst}({depthCompare:CompareFunction.ALWAYS,depthWrite:!1},defaultMegaState);function setAttachmentStateSimple(dst,simple){return void 0===dst.attachmentsState&&(dst.attachmentsState=[],copyAttachmentsState(dst.attachmentsState,defaultMegaState.attachmentsState)),function copyAttachmentStateFromSimple(dst,src){void 0!==src.channelWriteMask&&(dst.channelWriteMask=src.channelWriteMask),void 0!==src.rgbBlendMode&&(dst.rgbBlendState.blendMode=src.rgbBlendMode),void 0!==src.alphaBlendMode&&(dst.alphaBlendState.blendMode=src.alphaBlendMode),void 0!==src.rgbBlendSrcFactor&&(dst.rgbBlendState.blendSrcFactor=src.rgbBlendSrcFactor),void 0!==src.alphaBlendSrcFactor&&(dst.alphaBlendState.blendSrcFactor=src.alphaBlendSrcFactor),void 0!==src.rgbBlendDstFactor&&(dst.rgbBlendState.blendDstFactor=src.rgbBlendDstFactor),void 0!==src.alphaBlendDstFactor&&(dst.alphaBlendState.blendDstFactor=src.alphaBlendDstFactor)}(dst.attachmentsState[0],simple),dst}var _a,defaultBindingLayoutSamplerDescriptor={texture:null,sampler:null,formatKind:SamplerFormatKind.Float,dimension:TextureDimension.TEXTURE_2D};function arrayEqual(a,b,e){if(a.length!==b.length)return!1;for(var i=0;i<a.length;i++)if(!e(a[i],b[i]))return!1;return!0}function arrayCopy(a,copyFunc){for(var b=Array(a.length),i=0;i<a.length;i++)b[i]=copyFunc(a[i]);return b}function textureBindingEquals(a,b){return a.texture===b.texture&&a.binding===b.binding}function bufferBindingEquals(a,b){return a.buffer===b.buffer&&a.size===b.size&&a.binding===b.binding&&a.offset===b.offset}function samplerBindingEquals(a,b){return null===a?null===b:null!==b&&(a.sampler===b.sampler&&a.texture===b.texture&&a.dimension===b.dimension&&a.formatKind===b.formatKind&&a.comparison===b.comparison)}function bindingsDescriptorEquals(a,b){return a.samplerBindings=a.samplerBindings||[],a.uniformBufferBindings=a.uniformBufferBindings||[],a.storageBufferBindings=a.storageBufferBindings||[],a.storageTextureBindings=a.storageTextureBindings||[],b.samplerBindings=b.samplerBindings||[],b.uniformBufferBindings=b.uniformBufferBindings||[],b.storageBufferBindings=b.storageBufferBindings||[],b.storageTextureBindings=b.storageTextureBindings||[],a.samplerBindings.length===b.samplerBindings.length&&(!!arrayEqual(a.samplerBindings,b.samplerBindings,samplerBindingEquals)&&(!!arrayEqual(a.uniformBufferBindings,b.uniformBufferBindings,bufferBindingEquals)&&(!!arrayEqual(a.storageBufferBindings,b.storageBufferBindings,bufferBindingEquals)&&!!arrayEqual(a.storageTextureBindings,b.storageTextureBindings,textureBindingEquals))))}function channelBlendStateEquals(a,b){return a.blendMode==b.blendMode&&a.blendSrcFactor===b.blendSrcFactor&&a.blendDstFactor===b.blendDstFactor}function attachmentStateEquals(a,b){return!!channelBlendStateEquals(a.rgbBlendState,b.rgbBlendState)&&(!!channelBlendStateEquals(a.alphaBlendState,b.alphaBlendState)&&a.channelWriteMask===b.channelWriteMask)}function stencilFaceStateEquals(a,b){return a.compare==b.compare&&a.depthFailOp===b.depthFailOp&&a.failOp===b.failOp&&a.passOp===b.passOp&&a.mask===b.mask}function programEquals(a,b){return a.id===b.id}function formatEquals(a,b){return a===b}function renderPipelineDescriptorEquals(a,b){return a.topology===b.topology&&(a.inputLayout===b.inputLayout&&(a.sampleCount===b.sampleCount&&(!(a.megaStateDescriptor&&b.megaStateDescriptor&&!function megaStateDescriptorEquals(a,b){return!(!arrayEqual(a.attachmentsState,b.attachmentsState,attachmentStateEquals)||a.blendConstant&&b.blendConstant&&!colorEqual(a.blendConstant,b.blendConstant)||a.stencilFront&&b.stencilFront&&!stencilFaceStateEquals(a.stencilFront,b.stencilFront)||a.stencilBack&&b.stencilBack&&!stencilFaceStateEquals(a.stencilBack,b.stencilBack)||a.depthCompare!==b.depthCompare||a.depthWrite!==b.depthWrite||a.stencilWrite!==b.stencilWrite||a.cullMode!==b.cullMode||a.frontFace!==b.frontFace||a.polygonOffset!==b.polygonOffset)}(a.megaStateDescriptor,b.megaStateDescriptor))&&(!!programEquals(a.program,b.program)&&(!!arrayEqual(a.colorAttachmentFormats,b.colorAttachmentFormats,formatEquals)&&a.depthStencilAttachmentFormat===b.depthStencilAttachmentFormat)))))}function vertexAttributeDescriptorEquals(a,b){return a.offset===b.offset&&a.shaderLocation===b.shaderLocation&&a.format===b.format&&a.divisor===b.divisor}function inputLayoutBufferDescriptorEquals(a,b){return(0,is_nil.A)(a)?(0,is_nil.A)(b):!(0,is_nil.A)(b)&&(a.arrayStride===b.arrayStride&&a.stepMode===b.stepMode&&arrayEqual(a.attributes,b.attributes,vertexAttributeDescriptorEquals))}function inputLayoutDescriptorEquals(a,b){return a.indexBufferFormat===b.indexBufferFormat&&(!!arrayEqual(a.vertexBufferDescriptors,b.vertexBufferDescriptors,inputLayoutBufferDescriptorEquals)&&!!programEquals(a.program,b.program))}function samplerDescriptorEquals(a,b){return a.addressModeU===b.addressModeU&&a.addressModeV===b.addressModeV&&a.minFilter===b.minFilter&&a.magFilter===b.magFilter&&a.mipmapFilter===b.mipmapFilter&&a.lodMinClamp===b.lodMinClamp&&a.lodMaxClamp===b.lodMaxClamp&&a.maxAnisotropy===b.maxAnisotropy&&a.compareFunction===b.compareFunction}function samplerBindingCopy(a){return{sampler:a.sampler,texture:a.texture,dimension:a.dimension,formatKind:a.formatKind,comparison:a.comparison}}function bufferBindingCopy(a){var buffer=a.buffer,size=a.size;return{binding:a.binding,buffer,offset:a.offset,size}}function textureBindingCopy(a){return{binding:a.binding,texture:a.texture}}function vertexAttributeDescriptorCopy(a){return{shaderLocation:a.shaderLocation,format:a.format,offset:a.offset,divisor:a.divisor}}function inputLayoutBufferDescriptorCopy(a){return(0,is_nil.A)(a)?a:{arrayStride:a.arrayStride,stepMode:a.stepMode,attributes:arrayCopy(a.attributes,vertexAttributeDescriptorCopy)}}var UNIFORM_NAME_REGEXP=/([^[]*)(\[[0-9]+\])?/;function parseUniformName(name){if("]"!==name[name.length-1])return{name,length:1,isArray:!1};var matches=name.match(UNIFORM_NAME_REGEXP);if(!matches||matches.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(name));return{name:matches[1],length:Number(matches[2])||1,isArray:Boolean(matches[2])}}function getSamplerSetter(){var cache=null;return function(gl,location,value){var update=cache!==value;return update&&(gl.uniform1i(location,value),cache=value),update}}function getArraySetter(functionName,toArray,size,uniformSetter){var cache=null,cacheLength=null;return function(gl,location,value){var arrayValue=toArray(value,size),length=arrayValue.length,update=!1;if(null===cache)cache=new Float32Array(length),cacheLength=length,update=!0;else{es_assert(cacheLength===length,"Uniform length cannot change.");for(var i=0;i<length;++i)if(arrayValue[i]!==cache[i]){update=!0;break}}return update&&(uniformSetter(gl,functionName,location,arrayValue),cache.set(arrayValue)),update}}function setVectorUniform(gl,functionName,location,value){gl[functionName](location,value)}function setMatrixUniform(gl,functionName,location,value){gl[functionName](location,!1,value)}var FLOAT_ARRAY={},INT_ARRAY={},UINT_ARRAY={},array1=[0];function toTypedArray(value,uniformLength,Type,cache){1===uniformLength&&"boolean"==typeof value&&(value=value?1:0),Number.isFinite(value)&&(array1[0]=value,value=array1);var length=value.length;if(value instanceof Type)return value;var result=cache[length];result||(result=new Type(length),cache[length]=result);for(var i=0;i<length;i++)result[i]=value[i];return result}function toFloatArray(value,uniformLength){return toTypedArray(value,uniformLength,Float32Array,FLOAT_ARRAY)}function toIntArray(value,uniformLength){return toTypedArray(value,uniformLength,Int32Array,INT_ARRAY)}function toUIntArray(value,uniformLength){return toTypedArray(value,uniformLength,Uint32Array,UINT_ARRAY)}var UNIFORM_SETTERS=((_a={})[GL.FLOAT]=getArraySetter.bind(null,"uniform1fv",toFloatArray,1,setVectorUniform),_a[GL.FLOAT_VEC2]=getArraySetter.bind(null,"uniform2fv",toFloatArray,2,setVectorUniform),_a[GL.FLOAT_VEC3]=getArraySetter.bind(null,"uniform3fv",toFloatArray,3,setVectorUniform),_a[GL.FLOAT_VEC4]=getArraySetter.bind(null,"uniform4fv",toFloatArray,4,setVectorUniform),_a[GL.INT]=getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),_a[GL.INT_VEC2]=getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),_a[GL.INT_VEC3]=getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),_a[GL.INT_VEC4]=getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),_a[GL.BOOL]=getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),_a[GL.BOOL_VEC2]=getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),_a[GL.BOOL_VEC3]=getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),_a[GL.BOOL_VEC4]=getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),_a[GL.FLOAT_MAT2]=getArraySetter.bind(null,"uniformMatrix2fv",toFloatArray,4,setMatrixUniform),_a[GL.FLOAT_MAT3]=getArraySetter.bind(null,"uniformMatrix3fv",toFloatArray,9,setMatrixUniform),_a[GL.FLOAT_MAT4]=getArraySetter.bind(null,"uniformMatrix4fv",toFloatArray,16,setMatrixUniform),_a[GL.UNSIGNED_INT]=getArraySetter.bind(null,"uniform1uiv",toUIntArray,1,setVectorUniform),_a[GL.UNSIGNED_INT_VEC2]=getArraySetter.bind(null,"uniform2uiv",toUIntArray,2,setVectorUniform),_a[GL.UNSIGNED_INT_VEC3]=getArraySetter.bind(null,"uniform3uiv",toUIntArray,3,setVectorUniform),_a[GL.UNSIGNED_INT_VEC4]=getArraySetter.bind(null,"uniform4uiv",toUIntArray,4,setVectorUniform),_a[GL.FLOAT_MAT2x3]=getArraySetter.bind(null,"uniformMatrix2x3fv",toFloatArray,6,setMatrixUniform),_a[GL.FLOAT_MAT2x4]=getArraySetter.bind(null,"uniformMatrix2x4fv",toFloatArray,8,setMatrixUniform),_a[GL.FLOAT_MAT3x2]=getArraySetter.bind(null,"uniformMatrix3x2fv",toFloatArray,6,setMatrixUniform),_a[GL.FLOAT_MAT3x4]=getArraySetter.bind(null,"uniformMatrix3x4fv",toFloatArray,12,setMatrixUniform),_a[GL.FLOAT_MAT4x2]=getArraySetter.bind(null,"uniformMatrix4x2fv",toFloatArray,8,setMatrixUniform),_a[GL.FLOAT_MAT4x3]=getArraySetter.bind(null,"uniformMatrix4x3fv",toFloatArray,12,setMatrixUniform),_a[GL.SAMPLER_2D]=getSamplerSetter,_a[GL.SAMPLER_CUBE]=getSamplerSetter,_a[GL.SAMPLER_3D]=getSamplerSetter,_a[GL.SAMPLER_2D_SHADOW]=getSamplerSetter,_a[GL.SAMPLER_2D_ARRAY]=getSamplerSetter,_a[GL.SAMPLER_2D_ARRAY_SHADOW]=getSamplerSetter,_a[GL.SAMPLER_CUBE_SHADOW]=getSamplerSetter,_a[GL.INT_SAMPLER_2D]=getSamplerSetter,_a[GL.INT_SAMPLER_3D]=getSamplerSetter,_a[GL.INT_SAMPLER_CUBE]=getSamplerSetter,_a[GL.INT_SAMPLER_2D_ARRAY]=getSamplerSetter,_a[GL.UNSIGNED_INT_SAMPLER_2D]=getSamplerSetter,_a[GL.UNSIGNED_INT_SAMPLER_3D]=getSamplerSetter,_a[GL.UNSIGNED_INT_SAMPLER_CUBE]=getSamplerSetter,_a[GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]=getSamplerSetter,_a);function getUniformSetter(gl,location,info){var setter=UNIFORM_SETTERS[info.type];if(!setter)throw new Error("Unknown GLSL uniform type ".concat(info.type));return setter().bind(null,gl,location)}var dtypes={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function defineStr(k,v){return"#define ".concat(k," ").concat(v)}function parseBinding(layout){if(void 0===layout)return null;var g=/binding\s*=\s*(\d+)/.exec(layout);if(null!==g){var bindingNum=parseInt(g[1],10);if(!Number.isNaN(bindingNum))return bindingNum}return null}function preprocessShader_GLSL(vendorInfo,type,source,defines,usePrecision){var _a;void 0===defines&&(defines=null),void 0===usePrecision&&(usePrecision=!0);var isGLSL100="#version 100"===vendorInfo.glslVersion,useMRT="frag"===type&&(null===(_a=source.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===_a?void 0:_a.length)>1,lines=source.replace("\r\n","\n").split("\n").map((function(n){return n.replace(/[/][/].*$/,"")})).filter((function(n){return!(!n||/^\s+$/.test(n))})),definesString="";null!==defines&&(definesString=Object.keys(defines).map((function(key){return defineStr(key,defines[key])})).join("\n"));var precision=lines.find((function(line){return line.startsWith("precision")}))||"precision mediump float;",rest=usePrecision?lines.filter((function(line){return!line.startsWith("precision")})).join("\n"):lines.join("\n"),extraDefines="";if(vendorInfo.viewportOrigin===ViewportOrigin.UPPER_LEFT&&(extraDefines+="".concat(defineStr("VIEWPORT_ORIGIN_TL","1"),"\n")),vendorInfo.clipSpaceNearZ===es_ClipSpaceNearZ.ZERO&&(extraDefines+="".concat(defineStr("CLIPSPACE_NEAR_ZERO","1"),"\n")),vendorInfo.explicitBindingLocations){var set_1=0,implicitBinding_1=0,location_1=0;rest=rest.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(substr,cap,layout,rest){var layout2=layout?"".concat(layout,", "):"";return"layout(".concat(layout2,"set = ").concat(set_1,", binding = ").concat(implicitBinding_1++,") uniform ").concat(rest)})),set_1++,implicitBinding_1=0,es_assert(vendorInfo.separateSamplerTextures),rest=rest.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(substr,cap,layout,combinedSamplerType,samplerName){var binding=parseBinding(layout);null===binding&&(binding=implicitBinding_1++);var _a=(0,tslib_es6.zs)(function getSeparateSamplerTypes(combinedSamplerType){return[combinedSamplerType,""]}(combinedSamplerType),2),textureType=_a[0],samplerType=_a[1];return"frag"===type?"\nlayout(set = ".concat(set_1,", binding = ").concat(2*binding+0,") uniform texture").concat(textureType," T_").concat(samplerName,";\nlayout(set = ").concat(set_1,", binding = ").concat(2*binding+1,") uniform sampler").concat(samplerType," S_").concat(samplerName,";").trim():""})),rest=rest.replace("frag"===type?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(substr,tok){return"layout(location = ".concat(location_1++,") ").concat(tok)})),extraDefines+="".concat(defineStr("gl_VertexID","gl_VertexIndex"),"\n"),extraDefines+="".concat(defineStr("gl_InstanceID","gl_InstanceIndex"),"\n"),precision=precision.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var implicitBinding_2=0;rest=rest.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(substr,cap,layout,combinedSamplerType,samplerName){var binding=parseBinding(layout);return null===binding&&(binding=implicitBinding_2++),"uniform sampler".concat(combinedSamplerType," ").concat(samplerName,"; // BINDING=").concat(binding)}))}if(vendorInfo.separateSamplerTextures)rest=(rest=rest.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(substr,combinedSamplerType,samplerName){return"sampler".concat(combinedSamplerType,"(T_").concat(samplerName,", S_").concat(samplerName,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(substr,samplerName){return"T_".concat(samplerName)}));else{var samplerNames_1=[];rest=rest.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(substr,combinedSamplerType,samplerName){return samplerNames_1.push([samplerName,combinedSamplerType]),samplerName})),isGLSL100&&samplerNames_1.forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),samplerName=_b[0],combinedSamplerType=_b[1];rest=rest.replace(new RegExp("texture\\(".concat(samplerName),"g"),(function(){return"texture".concat(combinedSamplerType,"(").concat(samplerName)}))})),rest=rest.replace(/\bTEXTURE\((.*?)\)/g,(function(substr,samplerName){return samplerName}))}var concat="".concat(isGLSL100?"":vendorInfo.glslVersion,"\n").concat(isGLSL100&&useMRT?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(isGLSL100&&"frag"===type?"#extension GL_OES_standard_derivatives : enable\n":"").concat(usePrecision?precision:"","\n").concat(extraDefines||"").concat(definesString?definesString+"\n":"","\n").concat(rest,"\n").trim();if(vendorInfo.explicitBindingLocations&&"frag"===type&&(concat=concat.replace(/^\b(out)\b/g,(function(substr,tok){return"layout(location = 0) ".concat(tok)}))),isGLSL100){if("frag"===type&&(concat=concat.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(_,dataType,name){return"varying ".concat(dataType," ").concat(name,";\n")}))),"vert"===type&&(concat=(concat=concat.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(_,dataType,name){return"varying ".concat(dataType," ").concat(name,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(_,dataType,name){return"attribute ".concat(dataType," ").concat(name,";\n")}))),concat=concat.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(substr,uniforms){return uniforms.trim().replace(/^.*$/gm,(function(uniform){var trimmed=uniform.trim();return trimmed.startsWith("#")?trimmed:uniform?"uniform ".concat(trimmed):""}))})),"frag"===type)if(useMRT){var gBuffers_1=[];concat=concat.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(_,buffer){return gBuffers_1.push(buffer),"vec4 ".concat(buffer,";\n")}));var lastIndexOfMain=concat.lastIndexOf("}");concat=concat.substring(0,lastIndexOfMain)+"\n    ".concat(gBuffers_1.map((function(gBuffer,i){return"gl_FragData[".concat(i,"] = ").concat(gBuffer,";\n    ")})).join("\n"))+concat.substring(lastIndexOfMain)}else{var glFragColor_1;if(concat=concat.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(_,dataType,name){return glFragColor_1=name,"".concat(dataType," ").concat(name,";\n")})),glFragColor_1){lastIndexOfMain=concat.lastIndexOf("}");concat=concat.substring(0,lastIndexOfMain)+"\n  gl_FragColor = vec4(".concat(glFragColor_1,");\n")+concat.substring(lastIndexOfMain)}}concat=concat.replace(/^\s*layout\((.*)\)/gm,"")}return concat}var ResourceBase_GL=function(_super){function ResourceBase_GL(_a){var id=_a.id,device=_a.device,_this=_super.call(this)||this;return _this.id=id,_this.device=device,null!==_this.device.resourceCreationTracker&&_this.device.resourceCreationTracker.trackResourceCreated(_this),_this}return(0,tslib_es6.C6)(ResourceBase_GL,_super),ResourceBase_GL.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},ResourceBase_GL}(_antv_g_device_api_node_modules_eventemitter3),Bindings_GL=function(_super){function Bindings_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Bindings;var uniformBufferBindings=descriptor.uniformBufferBindings,samplerBindings=descriptor.samplerBindings;return _this.uniformBufferBindings=uniformBufferBindings||[],_this.samplerBindings=samplerBindings||[],_this.bindingLayouts=_this.createBindingLayouts(),_this}return(0,tslib_es6.C6)(Bindings_GL,_super),Bindings_GL.prototype.createBindingLayouts=function(){var firstUniformBuffer=0,firstSampler=0,bindingLayoutTables=[],numUniformBuffers=this.uniformBufferBindings.length,numSamplers=this.samplerBindings.length;return bindingLayoutTables.push({firstUniformBuffer,numUniformBuffers,firstSampler,numSamplers}),{numUniformBuffers:firstUniformBuffer+=numUniformBuffers,numSamplers:firstSampler+=numSamplers,bindingLayoutTables}},Bindings_GL}(ResourceBase_GL);function isWebGL2(gl){return"undefined"!=typeof WebGL2RenderingContext&&gl instanceof WebGL2RenderingContext||Boolean(gl&&2===gl._version)}function isTextureFormatCompressed(fmt){switch(getFormatTypeFlags(fmt)){case FormatTypeFlags.BC1:case FormatTypeFlags.BC2:case FormatTypeFlags.BC3:case FormatTypeFlags.BC4_UNORM:case FormatTypeFlags.BC4_SNORM:case FormatTypeFlags.BC5_UNORM:case FormatTypeFlags.BC5_SNORM:return!0;default:return!1}}function isFormatSizedInteger(fmt){if(getFormatFlags(fmt)&FormatFlags.Normalized)return!1;var typeFlags=getFormatTypeFlags(fmt);return typeFlags===FormatTypeFlags.S8||typeFlags===FormatTypeFlags.S16||typeFlags===FormatTypeFlags.S32||(typeFlags===FormatTypeFlags.U8||typeFlags===FormatTypeFlags.U16||typeFlags===FormatTypeFlags.U32)}function translateBufferUsageToTarget(usage){return usage&BufferUsage.INDEX?GL.ELEMENT_ARRAY_BUFFER:usage&BufferUsage.VERTEX?GL.ARRAY_BUFFER:usage&BufferUsage.UNIFORM?GL.UNIFORM_BUFFER:void 0}function translateVertexFormat$1(fmt){var typeFlags=getFormatTypeFlags(fmt),compFlags=getFormatCompFlags(fmt),flags=getFormatFlags(fmt),type=function translateType(flags){switch(flags){case FormatTypeFlags.U8:return GL.UNSIGNED_BYTE;case FormatTypeFlags.U16:return GL.UNSIGNED_SHORT;case FormatTypeFlags.U32:return GL.UNSIGNED_INT;case FormatTypeFlags.S8:return GL.BYTE;case FormatTypeFlags.S16:return GL.SHORT;case FormatTypeFlags.S32:return GL.INT;case FormatTypeFlags.F16:return GL.HALF_FLOAT;case FormatTypeFlags.F32:return GL.FLOAT;default:throw new Error("whoops")}}(typeFlags),size=function translateSize(flags){switch(flags){case FormatCompFlags.R:return 1;case FormatCompFlags.RG:return 2;case FormatCompFlags.RGB:return 3;case FormatCompFlags.RGBA:return 4;default:return 1}}(compFlags);return{size,type,normalized:!!(flags&FormatFlags.Normalized)}}function translateAddressMode$1(wrapMode){switch(wrapMode){case AddressMode.CLAMP_TO_EDGE:return GL.CLAMP_TO_EDGE;case AddressMode.REPEAT:return GL.REPEAT;case AddressMode.MIRRORED_REPEAT:return GL.MIRRORED_REPEAT;default:throw new Error("whoops")}}function translateFilterMode(filter,mipmapFilter){if(mipmapFilter===MipmapFilterMode.LINEAR&&filter===FilterMode.BILINEAR)return GL.LINEAR_MIPMAP_LINEAR;if(mipmapFilter===MipmapFilterMode.LINEAR&&filter===FilterMode.POINT)return GL.NEAREST_MIPMAP_LINEAR;if(mipmapFilter===MipmapFilterMode.NEAREST&&filter===FilterMode.BILINEAR)return GL.LINEAR_MIPMAP_NEAREST;if(mipmapFilter===MipmapFilterMode.NEAREST&&filter===FilterMode.POINT)return GL.NEAREST_MIPMAP_NEAREST;if(mipmapFilter===MipmapFilterMode.NO_MIP&&filter===FilterMode.BILINEAR)return GL.LINEAR;if(mipmapFilter===MipmapFilterMode.NO_MIP&&filter===FilterMode.POINT)return GL.NEAREST;throw new Error("Unknown texture filter mode")}function getPlatformBuffer$1(buffer_,byteOffset){void 0===byteOffset&&(byteOffset=0);var buffer=buffer_;return buffer.gl_buffer_pages[byteOffset/buffer.pageByteSize|0]}function getPlatformTexture(texture_){return texture_.gl_texture}function getPlatformSampler$1(sampler_){return sampler_.gl_sampler}function assignPlatformName(o,name){o.name=name,o.__SPECTOR_Metadata={name}}function findall(haystack,needle){for(var results=[];;){var result=needle.exec(haystack);if(!result)break;results.push(result)}return results}function isBlendStateNone(blendState){return blendState.blendMode==BlendMode.ADD&&blendState.blendSrcFactor==BlendFactor.ONE&&blendState.blendDstFactor===BlendFactor.ZERO}function translateTextureDimension$1(dimension){if(dimension===TextureDimension.TEXTURE_2D)return GL.TEXTURE_2D;if(dimension===TextureDimension.TEXTURE_2D_ARRAY)return GL.TEXTURE_2D_ARRAY;if(dimension===TextureDimension.TEXTURE_CUBE_MAP)return GL.TEXTURE_CUBE_MAP;if(dimension===TextureDimension.TEXTURE_3D)return GL.TEXTURE_3D;throw new Error("whoops")}function isBlockCompressSized(w,h,bw,bh){return w%bw==0&&h%bh==0}var ProgramCompileState_GL,Buffer_GL=function(_super){function Buffer_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Buffer;var viewOrSize=descriptor.viewOrSize,usage=descriptor.usage,_b=descriptor.hint,hint=void 0===_b?BufferFrequencyHint.STATIC:_b,uniformBufferMaxPageByteSize=device.uniformBufferMaxPageByteSize,gl=device.gl,isUBO=usage&BufferUsage.UNIFORM;isUBO||(isWebGL2(gl)?gl.bindVertexArray(null):device.OES_vertex_array_object.bindVertexArrayOES(null));var pageByteSize,byteSize=(0,is_number.A)(viewOrSize)?align(viewOrSize,4):align(viewOrSize.byteLength,4);if(_this.gl_buffer_pages=[],isUBO){for(var byteSizeLeft=byteSize;byteSizeLeft>0;)_this.gl_buffer_pages.push(_this.createBufferPage(Math.min(byteSizeLeft,uniformBufferMaxPageByteSize),usage,hint)),byteSizeLeft-=uniformBufferMaxPageByteSize;pageByteSize=uniformBufferMaxPageByteSize}else _this.gl_buffer_pages.push(_this.createBufferPage(byteSize,usage,hint)),pageByteSize=byteSize;return _this.pageByteSize=pageByteSize,_this.byteSize=byteSize,_this.usage=usage,_this.gl_target=translateBufferUsageToTarget(usage),(0,is_number.A)(viewOrSize)||_this.setSubData(0,new Uint8Array(viewOrSize.buffer)),isUBO||(isWebGL2(gl)?gl.bindVertexArray(_this.device.currentBoundVAO):device.OES_vertex_array_object.bindVertexArrayOES(_this.device.currentBoundVAO)),_this}return(0,tslib_es6.C6)(Buffer_GL,_super),Buffer_GL.prototype.setSubData=function(dstByteOffset,data,srcByteOffset,byteSize){void 0===srcByteOffset&&(srcByteOffset=0),void 0===byteSize&&(byteSize=data.byteLength-srcByteOffset);for(var gl=this.device.gl,dstPageByteSize=this.pageByteSize,virtBufferByteOffsetEnd=dstByteOffset+byteSize,virtBufferByteOffset=dstByteOffset,physBufferByteOffset=dstByteOffset%dstPageByteSize;virtBufferByteOffset<virtBufferByteOffsetEnd;){var target=isWebGL2(gl)?gl.COPY_WRITE_BUFFER:this.gl_target,buffer=getPlatformBuffer$1(this,virtBufferByteOffset);if(buffer.ubo)return;gl.bindBuffer(target,buffer),isWebGL2(gl)?gl.bufferSubData(target,physBufferByteOffset,data,srcByteOffset,Math.min(virtBufferByteOffsetEnd-virtBufferByteOffset,dstPageByteSize)):gl.bufferSubData(target,physBufferByteOffset,data),virtBufferByteOffset+=dstPageByteSize,physBufferByteOffset=0,srcByteOffset+=dstPageByteSize,this.device.debugGroupStatisticsBufferUpload()}},Buffer_GL.prototype.destroy=function(){_super.prototype.destroy.call(this);for(var i=0;i<this.gl_buffer_pages.length;i++)this.gl_buffer_pages[i].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[i]);this.gl_buffer_pages=[]},Buffer_GL.prototype.createBufferPage=function(byteSize,usage,hint){var gl=this.device.gl,isUBO=usage&BufferUsage.UNIFORM;if(!isWebGL2(gl)&&isUBO)return{ubo:!0};var gl_buffer=this.device.ensureResourceExists(gl.createBuffer()),gl_target=translateBufferUsageToTarget(usage),gl_hint=function translateBufferHint(hint){switch(hint){case BufferFrequencyHint.STATIC:return GL.STATIC_DRAW;case BufferFrequencyHint.DYNAMIC:return GL.DYNAMIC_DRAW}}(hint);return gl.bindBuffer(gl_target,gl_buffer),gl.bufferData(gl_target,byteSize,gl_hint),gl_buffer},Buffer_GL}(ResourceBase_GL),InputLayout_GL=function(_super){function InputLayout_GL(_a){var e_1,_b,e_2,_c,_d,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.InputLayout;var vertexBufferDescriptors=descriptor.vertexBufferDescriptors,indexBufferFormat=descriptor.indexBufferFormat,program=descriptor.program;es_assert(indexBufferFormat===Format.U16_R||indexBufferFormat===Format.U32_R||null===indexBufferFormat);var indexBufferType=null!==indexBufferFormat?function translateIndexFormat$1(format){switch(format){case Format.U8_R:return GL.UNSIGNED_BYTE;case Format.U16_R:return GL.UNSIGNED_SHORT;case Format.U32_R:return GL.UNSIGNED_INT;default:throw new Error("whoops")}}(indexBufferFormat):null,indexBufferCompByteSize=null!==indexBufferFormat?getFormatCompByteSize(indexBufferFormat):null,gl=_this.device.gl,vao=_this.device.ensureResourceExists(isWebGL2(gl)?gl.createVertexArray():device.OES_vertex_array_object.createVertexArrayOES());isWebGL2(gl)?gl.bindVertexArray(vao):device.OES_vertex_array_object.bindVertexArrayOES(vao),gl.bindBuffer(gl.ARRAY_BUFFER,getPlatformBuffer$1(_this.device.fallbackVertexBuffer));try{for(var _e=(0,tslib_es6.Ju)(descriptor.vertexBufferDescriptors),_f=_e.next();!_f.done;_f=_e.next()){var vertexBufferDescriptor=_f.value,stepMode=vertexBufferDescriptor.stepMode,attributes=vertexBufferDescriptor.attributes;try{for(var attributes_1=(e_2=void 0,(0,tslib_es6.Ju)(attributes)),attributes_1_1=attributes_1.next();!attributes_1_1.done;attributes_1_1=attributes_1.next()){var attribute=attributes_1_1.value,shaderLocation=attribute.shaderLocation,format=attribute.format,_g=attribute.divisor,divisor=void 0===_g?1:_g,location_1=isWebGL2(gl)?shaderLocation:null===(_d=program.attributes[shaderLocation])||void 0===_d?void 0:_d.location,vertexFormat=translateVertexFormat$1(format);if(attribute.vertexFormat=vertexFormat,!(0,is_nil.A)(location_1)){isFormatSizedInteger(format);var size=vertexFormat.size,type=vertexFormat.type,normalized=vertexFormat.normalized;gl.vertexAttribPointer(location_1,size,type,normalized,0,0),stepMode===VertexStepMode.INSTANCE&&(isWebGL2(gl)?gl.vertexAttribDivisor(location_1,divisor):device.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(location_1,divisor)),gl.enableVertexAttribArray(location_1)}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{attributes_1_1&&!attributes_1_1.done&&(_c=attributes_1.return)&&_c.call(attributes_1)}finally{if(e_2)throw e_2.error}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_f&&!_f.done&&(_b=_e.return)&&_b.call(_e)}finally{if(e_1)throw e_1.error}}return isWebGL2(gl)?gl.bindVertexArray(null):device.OES_vertex_array_object.bindVertexArrayOES(null),_this.vertexBufferDescriptors=vertexBufferDescriptors,_this.vao=vao,_this.indexBufferFormat=indexBufferFormat,_this.indexBufferType=indexBufferType,_this.indexBufferCompByteSize=indexBufferCompByteSize,_this.program=program,_this}return(0,tslib_es6.C6)(InputLayout_GL,_super),InputLayout_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(isWebGL2(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},InputLayout_GL}(ResourceBase_GL),Texture_GL=function(_super){function Texture_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,fake=_a.fake,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Texture,descriptor=(0,tslib_es6.Cl)({dimension:TextureDimension.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},descriptor);var gl_target,gl_texture,gl=_this.device.gl,mipLevelCount=_this.clampmipLevelCount(descriptor);if(_this.immutable=descriptor.usage===TextureUsage.RENDER_TARGET,_this.pixelStore=descriptor.pixelStore,_this.format=descriptor.format,_this.dimension=descriptor.dimension,_this.formatKind=getFormatSamplerKind(descriptor.format),_this.width=descriptor.width,_this.height=descriptor.height,_this.depthOrArrayLayers=descriptor.depthOrArrayLayers,_this.mipmaps=mipLevelCount>=1,!fake){gl_texture=_this.device.ensureResourceExists(gl.createTexture());var gl_type=_this.device.translateTextureType(descriptor.format),internalformat=_this.device.translateTextureInternalFormat(descriptor.format);if(_this.device.setActiveTexture(gl.TEXTURE0),_this.device.currentTextures[0]=null,_this.preprocessImage(),descriptor.dimension===TextureDimension.TEXTURE_2D){if(gl_target=GL.TEXTURE_2D,gl.bindTexture(gl_target,gl_texture),_this.immutable)if(isWebGL2(gl))gl.texStorage2D(gl_target,mipLevelCount,internalformat,descriptor.width,descriptor.height);else{var level=(internalformat===GL.DEPTH_COMPONENT||_this.isNPOT(),0);(_this.format!==Format.D32F&&_this.format!==Format.D24_S8||isWebGL2(gl)||device.WEBGL_depth_texture)&&(gl.texImage2D(gl_target,level,internalformat,descriptor.width,descriptor.height,0,internalformat,gl_type,null),_this.mipmaps&&(_this.mipmaps=!1,gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR),gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE)))}es_assert(1===descriptor.depthOrArrayLayers)}else if(descriptor.dimension===TextureDimension.TEXTURE_2D_ARRAY)gl_target=GL.TEXTURE_2D_ARRAY,gl.bindTexture(gl_target,gl_texture),_this.immutable&&isWebGL2(gl)&&gl.texStorage3D(gl_target,mipLevelCount,internalformat,descriptor.width,descriptor.height,descriptor.depthOrArrayLayers);else if(descriptor.dimension===TextureDimension.TEXTURE_3D)gl_target=GL.TEXTURE_3D,gl.bindTexture(gl_target,gl_texture),_this.immutable&&isWebGL2(gl)&&gl.texStorage3D(gl_target,mipLevelCount,internalformat,descriptor.width,descriptor.height,descriptor.depthOrArrayLayers);else{if(descriptor.dimension!==TextureDimension.TEXTURE_CUBE_MAP)throw new Error("whoops");gl_target=GL.TEXTURE_CUBE_MAP,gl.bindTexture(gl_target,gl_texture),_this.immutable&&isWebGL2(gl)&&gl.texStorage2D(gl_target,mipLevelCount,internalformat,descriptor.width,descriptor.height),es_assert(6===descriptor.depthOrArrayLayers)}}return _this.gl_texture=gl_texture,_this.gl_target=gl_target,_this.mipLevelCount=mipLevelCount,_this}return(0,tslib_es6.C6)(Texture_GL,_super),Texture_GL.prototype.setImageData=function(levelDatas,lod){void 0===lod&&(lod=0);var gl=this.device.gl;isTextureFormatCompressed(this.format);var is3D=this.gl_target===GL.TEXTURE_3D||this.gl_target===GL.TEXTURE_2D_ARRAY,isCube=this.gl_target===GL.TEXTURE_CUBE_MAP,isTA=function isTypedArray(x){return Object.prototype.toString.call(x)in dtypes}(levelDatas[0]);this.device.setActiveTexture(gl.TEXTURE0),this.device.currentTextures[0]=null;var width,height,data=levelDatas[0];isTA?(width=this.width,height=this.height):(width=data.width,height=data.height,this.width=width,this.height=height),gl.bindTexture(this.gl_target,this.gl_texture);var gl_format=this.device.translateTextureFormat(this.format),gl_internal_format=isWebGL2(gl)?this.device.translateInternalTextureFormat(this.format):gl_format,gl_type=this.device.translateTextureType(this.format);this.preprocessImage();for(var z=0;z<this.depthOrArrayLayers;z++){var levelData=levelDatas[z],gl_target=this.gl_target;isCube&&(gl_target=GL.TEXTURE_CUBE_MAP_POSITIVE_X+z%6),this.immutable?gl.texSubImage2D(gl_target,lod,0,0,width,height,gl_format,gl_type,levelData):isWebGL2(gl)?is3D?gl.texImage3D(gl_target,lod,gl_internal_format,width,height,this.depthOrArrayLayers,0,gl_format,gl_type,levelData):gl.texImage2D(gl_target,lod,gl_internal_format,width,height,0,gl_format,gl_type,levelData):isTA?gl.texImage2D(gl_target,lod,gl_format,width,height,0,gl_format,gl_type,levelData):gl.texImage2D(gl_target,lod,gl_format,gl_format,gl_type,levelData)}this.mipmaps&&this.generateMipmap(is3D)},Texture_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),this.device.gl.deleteTexture(getPlatformTexture(this))},Texture_GL.prototype.clampmipLevelCount=function(descriptor){if(descriptor.dimension===TextureDimension.TEXTURE_2D_ARRAY&&descriptor.depthOrArrayLayers>1&&getFormatTypeFlags(descriptor.format)===FormatTypeFlags.BC1)for(var w=descriptor.width,h=descriptor.height,i=0;i<descriptor.mipLevelCount;i++){if(w<=2||h<=2)return i-1;w=Math.max(w/2|0,1),h=Math.max(h/2|0,1)}return descriptor.mipLevelCount},Texture_GL.prototype.preprocessImage=function(){var gl=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&gl.pixelStorei(GL.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&gl.pixelStorei(GL.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&gl.pixelStorei(GL.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},Texture_GL.prototype.generateMipmap=function(is3D){void 0===is3D&&(is3D=!1);var gl=this.device.gl;return!isWebGL2(gl)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(gl.bindTexture(this.gl_target,this.gl_texture),is3D?(gl.texParameteri(this.gl_target,GL.TEXTURE_BASE_LEVEL,0),gl.texParameteri(this.gl_target,GL.TEXTURE_MAX_LEVEL,Math.log2(this.width)),gl.texParameteri(this.gl_target,GL.TEXTURE_MIN_FILTER,GL.LINEAR_MIPMAP_LINEAR),gl.texParameteri(this.gl_target,GL.TEXTURE_MAG_FILTER,GL.LINEAR)):gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.NEAREST_MIPMAP_LINEAR),gl.generateMipmap(this.gl_target),gl.bindTexture(this.gl_target,null)),this},Texture_GL.prototype.isNPOT=function(){return!isWebGL2(this.device.gl)&&(!isPowerOfTwo(this.width)||!isPowerOfTwo(this.height))},Texture_GL}(ResourceBase_GL),RenderTarget_GL=function(_super){function RenderTarget_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.RenderTarget,_this.gl_renderbuffer=null,_this.texture=null;var gl=_this.device.gl,format=descriptor.format,width=descriptor.width,height=descriptor.height,_b=descriptor.sampleCount,sampleCount=void 0===_b?1:_b,texture=descriptor.texture,useRenderbuffer=!1;if(format!==Format.D32F&&format!==Format.D24_S8||!texture||isWebGL2(gl)||device.WEBGL_depth_texture||(texture.destroy(),_this.texture=null,useRenderbuffer=!0),!useRenderbuffer&&texture)_this.texture=texture;else{_this.gl_renderbuffer=_this.device.ensureResourceExists(gl.createRenderbuffer()),gl.bindRenderbuffer(gl.RENDERBUFFER,_this.gl_renderbuffer);var gl_format=_this.device.translateTextureInternalFormat(format,!0);isWebGL2(gl)&&sampleCount>1?gl.renderbufferStorageMultisample(GL.RENDERBUFFER,sampleCount,gl_format,width,height):gl.renderbufferStorage(GL.RENDERBUFFER,gl_format,width,height)}return _this.format=format,_this.width=width,_this.height=height,_this.sampleCount=sampleCount,_this}return(0,tslib_es6.C6)(RenderTarget_GL,_super),RenderTarget_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},RenderTarget_GL}(ResourceBase_GL);!function(ProgramCompileState_GL){ProgramCompileState_GL[ProgramCompileState_GL.NeedsCompile=0]="NeedsCompile",ProgramCompileState_GL[ProgramCompileState_GL.Compiling=1]="Compiling",ProgramCompileState_GL[ProgramCompileState_GL.NeedsBind=2]="NeedsBind",ProgramCompileState_GL[ProgramCompileState_GL.ReadyToUse=3]="ReadyToUse"}(ProgramCompileState_GL||(ProgramCompileState_GL={}));var Program_GL=function(_super){function Program_GL(_a,rawVertexGLSL){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.rawVertexGLSL=rawVertexGLSL,_this.type=ResourceType.Program,_this.uniformSetters={},_this.attributes=[];var gl=_this.device.gl;return _this.descriptor=descriptor,_this.gl_program=_this.device.ensureResourceExists(gl.createProgram()),_this.gl_shader_vert=null,_this.gl_shader_frag=null,_this.compileState=ProgramCompileState_GL.NeedsCompile,_this.tryCompileProgram(),_this}return(0,tslib_es6.C6)(Program_GL,_super),Program_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},Program_GL.prototype.tryCompileProgram=function(){es_assert(this.compileState===ProgramCompileState_GL.NeedsCompile);var _a=this.descriptor,vertex=_a.vertex,fragment=_a.fragment,gl=this.device.gl;(null==vertex?void 0:vertex.glsl)&&(null==fragment?void 0:fragment.glsl)&&(this.gl_shader_vert=this.compileShader(vertex.postprocess?vertex.postprocess(vertex.glsl):vertex.glsl,gl.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(fragment.postprocess?fragment.postprocess(fragment.glsl):fragment.glsl,gl.FRAGMENT_SHADER),gl.attachShader(this.gl_program,this.gl_shader_vert),gl.attachShader(this.gl_program,this.gl_shader_frag),gl.linkProgram(this.gl_program),this.compileState=ProgramCompileState_GL.Compiling,isWebGL2(gl)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},Program_GL.prototype.readAttributesFromLinkedProgram=function(){for(var _a,gl=this.device.gl,count=gl.getProgramParameter(this.gl_program,gl.ACTIVE_ATTRIBUTES),defines=function getDefines(shader){var defines={};return shader.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(_,name,value){var v=Number(value);return defines[name]=isNaN(v)?value:v,""})),defines}(this.descriptor.vertex.glsl),locations=function getAttributeLocations(vert,defines){var locations=[];return vert.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(_,location,name){var l=Number(location);return locations.push({location:isNaN(l)?defines[location]:l,name}),""})),locations}(this.rawVertexGLSL,defines),_loop_1=function(index){var _b=gl.getActiveAttrib(this_1.gl_program,index),name_1=_b.name,type=_b.type,size=_b.size,location_1=gl.getAttribLocation(this_1.gl_program,name_1),definedLocation=null===(_a=locations.find((function(l){return l.name===name_1})))||void 0===_a?void 0:_a.location;location_1>=0&&!(0,is_nil.A)(definedLocation)&&(this_1.attributes[definedLocation]={name:name_1,location:location_1,type,size})},this_1=this,index=0;index<count;index++)_loop_1(index)},Program_GL.prototype.readUniformLocationsFromLinkedProgram=function(){for(var gl=this.device.gl,numUniforms=gl.getProgramParameter(this.gl_program,gl.ACTIVE_UNIFORMS),i=0;i<numUniforms;i++){var info=gl.getActiveUniform(this.gl_program,i),name_2=parseUniformName(info.name).name,location_2=gl.getUniformLocation(this.gl_program,name_2);if(this.uniformSetters[name_2]=getUniformSetter(gl,location_2,info),info&&info.size>1)for(var l=0;l<info.size;l++)location_2=gl.getUniformLocation(this.gl_program,"".concat(name_2,"[").concat(l,"]")),this.uniformSetters["".concat(name_2,"[").concat(l,"]")]=getUniformSetter(gl,location_2,info)}},Program_GL.prototype.compileShader=function(contents,type){var gl=this.device.gl,shader=this.device.ensureResourceExists(gl.createShader(type));return gl.shaderSource(shader,contents),gl.compileShader(shader),shader},Program_GL.prototype.setUniformsLegacy=function(uniforms){void 0===uniforms&&(uniforms={});var gl=this.device.gl;if(!isWebGL2(gl)){var programUsed=!1;for(var uniformName in uniforms){programUsed||(gl.useProgram(this.gl_program),programUsed=!0);var uniform=uniforms[uniformName],uniformSetter=this.uniformSetters[uniformName];if(uniformSetter){var value=uniform;value instanceof Texture_GL&&(value=value.textureIndex),uniformSetter(value)}}}return this},Program_GL}(ResourceBase_GL),QueryPool_GL=function(_super){function QueryPool_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.QueryPool;var gl=_this.device.gl;if(isWebGL2(gl)){var elemCount=descriptor.elemCount,type=descriptor.type;_this.gl_query=nArray(elemCount,(function(){return _this.device.ensureResourceExists(gl.createQuery())})),_this.gl_query_type=function translateQueryPoolType$1(type){if(type===QueryPoolType.OcclusionConservative)return GL.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(type)}return _this}return(0,tslib_es6.C6)(QueryPool_GL,_super),QueryPool_GL.prototype.queryResultOcclusion=function(dstOffs){var gl=this.device.gl;if(isWebGL2(gl)){var gl_query=this.gl_query[dstOffs];return gl.getQueryParameter(gl_query,gl.QUERY_RESULT_AVAILABLE)?!!gl.getQueryParameter(gl_query,gl.QUERY_RESULT):null}return null},QueryPool_GL.prototype.destroy=function(){_super.prototype.destroy.call(this);var gl=this.device.gl;if(isWebGL2(gl))for(var i=0;i<this.gl_query.length;i++)gl.deleteQuery(this.gl_query[i])},QueryPool_GL}(ResourceBase_GL),Readback_GL=function(_super){function Readback_GL(_a){var id=_a.id,device=_a.device,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.Readback,_this.gl_pbo=null,_this.gl_sync=null,_this}return(0,tslib_es6.C6)(Readback_GL,_super),Readback_GL.prototype.clientWaitAsync=function(sync,flags,interval_ms){void 0===flags&&(flags=0),void 0===interval_ms&&(interval_ms=10);var gl=this.device.gl;return new Promise((function(resolve,reject){!function test(){var res=gl.clientWaitSync(sync,flags,0);res!=gl.WAIT_FAILED?res!=gl.TIMEOUT_EXPIRED?resolve():setTimeout(test,lodash_clamp(interval_ms,0,gl.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):reject()}()}))},Readback_GL.prototype.getBufferSubDataAsync=function(target,buffer,srcByteOffset,dstBuffer,dstOffset,length){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var gl;return(0,tslib_es6.YH)(this,(function(_a){switch(_a.label){case 0:return isWebGL2(gl=this.device.gl)?(this.gl_sync=gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE,0),gl.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return _a.sent(),gl.bindBuffer(target,buffer),gl.getBufferSubData(target,srcByteOffset,dstBuffer,dstOffset,length),gl.bindBuffer(target,null),[2,dstBuffer];case 2:return[2]}}))}))},Readback_GL.prototype.readTexture=function(t,x,y,width,height,dstBuffer,dstOffset,length){return void 0===dstOffset&&(dstOffset=0),void 0===length&&(length=dstBuffer.byteLength||0),(0,tslib_es6.sH)(this,void 0,void 0,(function(){var gl,texture,gl_format,gl_type,formatByteSize;return(0,tslib_es6.YH)(this,(function(_a){return gl=this.device.gl,texture=t,gl_format=this.device.translateTextureFormat(texture.format),gl_type=this.device.translateTextureType(texture.format),formatByteSize=function getFormatByteSize(fmt){return getFormatTypeFlagsByteSize(getFormatTypeFlags(fmt))*getFormatCompFlags(fmt)}(texture.format),isWebGL2(gl)?(this.gl_pbo=this.device.ensureResourceExists(gl.createBuffer()),gl.bindBuffer(gl.PIXEL_PACK_BUFFER,this.gl_pbo),gl.bufferData(gl.PIXEL_PACK_BUFFER,length,gl.STREAM_READ),gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null),gl.bindFramebuffer(GL.READ_FRAMEBUFFER,this.device.readbackFramebuffer),gl.framebufferTexture2D(GL.READ_FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,texture.gl_texture,0),gl.bindBuffer(gl.PIXEL_PACK_BUFFER,this.gl_pbo),gl.readPixels(x,y,width,height,gl_format,gl_type,dstOffset*formatByteSize),gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(gl.PIXEL_PACK_BUFFER,this.gl_pbo,0,dstBuffer,dstOffset,0)]):[2,this.readTextureSync(t,x,y,width,height,dstBuffer,dstOffset,length)]}))}))},Readback_GL.prototype.readTextureSync=function(t,x,y,width,height,dstBuffer,dstOffset,length){void 0===length&&(length=dstBuffer.byteLength||0);var gl=this.device.gl,texture=t,gl_type=this.device.translateTextureType(texture.format);return gl.bindFramebuffer(GL.FRAMEBUFFER,this.device.readbackFramebuffer),gl.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,texture.gl_texture,0),gl.pixelStorei(gl.PACK_ALIGNMENT,4),gl.readPixels(x,y,width,height,gl.RGBA,gl_type,dstBuffer),dstBuffer},Readback_GL.prototype.readBuffer=function(b,srcByteOffset,dstBuffer,dstOffset,length){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var gl;return(0,tslib_es6.YH)(this,(function(_a){return isWebGL2(gl=this.device.gl)?[2,this.getBufferSubDataAsync(gl.ARRAY_BUFFER,getPlatformBuffer$1(b,srcByteOffset),srcByteOffset,dstBuffer,dstOffset,length)]:[2,Promise.reject()]}))}))},Readback_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),isWebGL2(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},Readback_GL}(ResourceBase_GL),RenderPipeline_GL=function(_super){function RenderPipeline_GL(_a){var _b,_c,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.RenderPipeline,_this.drawMode=function translatePrimitiveTopology(topology){switch(topology){case PrimitiveTopology.TRIANGLES:return GL.TRIANGLES;case PrimitiveTopology.POINTS:return GL.POINTS;case PrimitiveTopology.TRIANGLE_STRIP:return GL.TRIANGLE_STRIP;case PrimitiveTopology.LINES:return GL.LINES;case PrimitiveTopology.LINE_STRIP:return GL.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(_b=descriptor.topology)&&void 0!==_b?_b:PrimitiveTopology.TRIANGLES),_this.program=descriptor.program,_this.inputLayout=descriptor.inputLayout,_this.megaState=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},copyMegaState(defaultMegaState)),descriptor.megaStateDescriptor),_this.colorAttachmentFormats=descriptor.colorAttachmentFormats.slice(),_this.depthStencilAttachmentFormat=descriptor.depthStencilAttachmentFormat,_this.sampleCount=null!==(_c=descriptor.sampleCount)&&void 0!==_c?_c:1,_this}return(0,tslib_es6.C6)(RenderPipeline_GL,_super),RenderPipeline_GL}(ResourceBase_GL),ComputePipeline_GL=function(_super){function ComputePipeline_GL(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.ComputePipeline,_this.descriptor=descriptor,_this}return(0,tslib_es6.C6)(ComputePipeline_GL,_super),ComputePipeline_GL}(ResourceBase_GL),ResourceCreationTracker=function(){function ResourceCreationTracker(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return ResourceCreationTracker.prototype.trackResourceCreated=function(o){this.creationStacks.set(o,(new Error).stack),this.liveObjects.add(o)},ResourceCreationTracker.prototype.trackResourceDestroyed=function(o){this.deletionStacks.has(o)&&console.warn("Object double freed:",o,"\n\nCreation stack: ",this.creationStacks.get(o),"\n\nDeletion stack: ",this.deletionStacks.get(o),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(o,(new Error).stack),this.liveObjects.delete(o)},ResourceCreationTracker.prototype.checkForLeaks=function(){var e_1,_a;try{for(var _b=(0,tslib_es6.Ju)(this.liveObjects.values()),_c=_b.next();!_c.done;_c=_b.next()){var o=_c.value;console.warn("Object leaked:",o,"Creation stack:",this.creationStacks.get(o))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}},ResourceCreationTracker.prototype.setResourceLeakCheck=function(o,v){v?this.liveObjects.add(o):this.liveObjects.delete(o)},ResourceCreationTracker}(),Sampler_GL=function(_super){function Sampler_GL(_a){var _b,_c,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Sampler;var gl=_this.device.gl;if(isWebGL2(gl)){var gl_sampler=_this.device.ensureResourceExists(gl.createSampler());gl.samplerParameteri(gl_sampler,GL.TEXTURE_WRAP_S,translateAddressMode$1(descriptor.addressModeU)),gl.samplerParameteri(gl_sampler,GL.TEXTURE_WRAP_T,translateAddressMode$1(descriptor.addressModeV)),gl.samplerParameteri(gl_sampler,GL.TEXTURE_WRAP_R,translateAddressMode$1(null!==(_b=descriptor.addressModeW)&&void 0!==_b?_b:descriptor.addressModeU)),gl.samplerParameteri(gl_sampler,GL.TEXTURE_MIN_FILTER,translateFilterMode(descriptor.minFilter,descriptor.mipmapFilter)),gl.samplerParameteri(gl_sampler,GL.TEXTURE_MAG_FILTER,translateFilterMode(descriptor.magFilter,MipmapFilterMode.NO_MIP)),void 0!==descriptor.lodMinClamp&&gl.samplerParameterf(gl_sampler,GL.TEXTURE_MIN_LOD,descriptor.lodMinClamp),void 0!==descriptor.lodMaxClamp&&gl.samplerParameterf(gl_sampler,GL.TEXTURE_MAX_LOD,descriptor.lodMaxClamp),void 0!==descriptor.compareFunction&&(gl.samplerParameteri(gl_sampler,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE),gl.samplerParameteri(gl_sampler,gl.TEXTURE_COMPARE_FUNC,descriptor.compareFunction));var maxAnisotropy=null!==(_c=descriptor.maxAnisotropy)&&void 0!==_c?_c:1;maxAnisotropy>1&&null!==_this.device.EXT_texture_filter_anisotropic&&(es_assert(descriptor.minFilter===FilterMode.BILINEAR&&descriptor.magFilter===FilterMode.BILINEAR&&descriptor.mipmapFilter===MipmapFilterMode.LINEAR),gl.samplerParameterf(gl_sampler,_this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,maxAnisotropy)),_this.gl_sampler=gl_sampler}else _this.descriptor=descriptor;return _this}return(0,tslib_es6.C6)(Sampler_GL,_super),Sampler_GL.prototype.setTextureParameters=function(gl_target,width,height){var _a,gl=this.device.gl,descriptor=this.descriptor;this.isNPOT(width,height)?gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR):gl.texParameteri(gl_target,GL.TEXTURE_MIN_FILTER,translateFilterMode(descriptor.minFilter,descriptor.mipmapFilter)),gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,translateAddressMode$1(descriptor.addressModeU)),gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,translateAddressMode$1(descriptor.addressModeV)),gl.texParameteri(gl_target,GL.TEXTURE_MAG_FILTER,translateFilterMode(descriptor.magFilter,MipmapFilterMode.NO_MIP));var maxAnisotropy=null!==(_a=descriptor.maxAnisotropy)&&void 0!==_a?_a:1;maxAnisotropy>1&&null!==this.device.EXT_texture_filter_anisotropic&&(es_assert(descriptor.minFilter===FilterMode.BILINEAR&&descriptor.magFilter===FilterMode.BILINEAR&&descriptor.mipmapFilter===MipmapFilterMode.LINEAR),gl.texParameteri(gl_target,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,maxAnisotropy))},Sampler_GL.prototype.destroy=function(){_super.prototype.destroy.call(this),isWebGL2(this.device.gl)&&this.device.gl.deleteSampler(getPlatformSampler$1(this))},Sampler_GL.prototype.isNPOT=function(width,height){return!isPowerOfTwo(width)||!isPowerOfTwo(height)},Sampler_GL}(ResourceBase_GL),ComputePass_GL=function(){function ComputePass_GL(){}return ComputePass_GL.prototype.dispatchWorkgroups=function(workgroupCountX,workgroupCountY,workgroupCountZ){},ComputePass_GL.prototype.dispatchWorkgroupsIndirect=function(indirectBuffer,indirectOffset){},ComputePass_GL.prototype.setPipeline=function(pipeline_){},ComputePass_GL.prototype.setBindings=function(bindings_){},ComputePass_GL.prototype.pushDebugGroup=function(name){},ComputePass_GL.prototype.popDebugGroup=function(){},ComputePass_GL.prototype.insertDebugMarker=function(markerLabel){},ComputePass_GL}(),RenderBundle_GL=function(_super){function RenderBundle_GL(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.type=ResourceType.RenderBundle,_this.commands=[],_this}return(0,tslib_es6.C6)(RenderBundle_GL,_super),RenderBundle_GL.prototype.push=function(f){this.commands.push(f)},RenderBundle_GL.prototype.replay=function(){this.commands.forEach((function(f){return f()}))},RenderBundle_GL}(ResourceBase_GL),UNIFROM_BLOCK_REGEXP=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,Device_GL=function(){function Device_GL(gl,configuration){void 0===configuration&&(configuration={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=copyMegaState(defaultMegaState),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=ViewportOrigin.LOWER_LEFT,this.clipSpaceNearZ=es_ClipSpaceNearZ.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=gl,this.contextAttributes=assertExists(gl.getContextAttributes()),isWebGL2(gl)?(this.EXT_texture_norm16=gl.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=gl.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=gl.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=gl.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=gl.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=gl.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=gl.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=gl.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=gl.getExtension("EXT_color_buffer_half_float"),gl.getExtension("EXT_frag_depth"),gl.getExtension("OES_element_index_uint"),gl.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=gl.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=gl.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=gl.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=gl.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=gl.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=gl.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=gl.getExtension("KHR_parallel_shader_compile"),isWebGL2(gl)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Texture_GL({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:TextureDimension.TEXTURE_2D,mipLevelCount:1,usage:TextureUsage.RENDER_TARGET,format:!1===this.contextAttributes.alpha?Format.U8_RGB_RT:Format.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=SamplerFormatKind.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(gl.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(TextureDimension.TEXTURE_2D,SamplerFormatKind.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(TextureDimension.TEXTURE_2D,SamplerFormatKind.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:BufferUsage.VERTEX,hint:BufferFrequencyHint.STATIC}),isWebGL2(gl)&&(this.fallbackTexture2DArray=this.createFallbackTexture(TextureDimension.TEXTURE_2D_ARRAY,SamplerFormatKind.Float),this.fallbackTexture3D=this.createFallbackTexture(TextureDimension.TEXTURE_3D,SamplerFormatKind.Float),this.fallbackTextureCube=this.createFallbackTexture(TextureDimension.TEXTURE_CUBE_MAP,SamplerFormatKind.Float)),this.currentMegaState.depthCompare=CompareFunction.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=ChannelWriteMask.ALL,gl.enable(gl.DEPTH_TEST),gl.enable(gl.STENCIL_TEST),this.checkLimits(),configuration.shaderDebug&&(this.shaderDebug=!0),configuration.trackResources&&(this.resourceCreationTracker=new ResourceCreationTracker)}return Device_GL.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},Device_GL.prototype.createFallbackTexture=function(dimension,formatKind){var depthOrArrayLayers=dimension===TextureDimension.TEXTURE_CUBE_MAP?6:1,format=formatKind===SamplerFormatKind.Depth?Format.D32F:Format.U8_RGBA_NORM,texture=this.createTexture({dimension,format,usage:TextureUsage.SAMPLED,width:1,height:1,depthOrArrayLayers,mipLevelCount:1});return formatKind===SamplerFormatKind.Float&&texture.setImageData([new Uint8Array(4*depthOrArrayLayers)]),getPlatformTexture(texture)},Device_GL.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},Device_GL.prototype.checkLimits=function(){var gl=this.gl;if(this.maxVertexAttribs=gl.getParameter(GL.MAX_VERTEX_ATTRIBS),isWebGL2(gl)){this.uniformBufferMaxPageByteSize=Math.min(gl.getParameter(GL.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=gl.getParameter(gl.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var supportedSampleCounts=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.DEPTH32F_STENCIL8,gl.SAMPLES);this.supportedSampleCounts=supportedSampleCounts?(0,tslib_es6.fX)([],(0,tslib_es6.zs)(supportedSampleCounts),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(a,b){return a-b}))},Device_GL.prototype.configureSwapChain=function(width,height,platformFramebuffer){var texture=this.scTexture;texture.width=width,texture.height=height,this.scPlatformFramebuffer=nullify(platformFramebuffer)},Device_GL.prototype.getDevice=function(){return this},Device_GL.prototype.getCanvas=function(){return this.gl.canvas},Device_GL.prototype.getOnscreenTexture=function(){return this.scTexture},Device_GL.prototype.beginFrame=function(){},Device_GL.prototype.endFrame=function(){},Device_GL.prototype.translateTextureInternalFormat=function(fmt,isRenderbufferStorage){switch(void 0===isRenderbufferStorage&&(isRenderbufferStorage=!1),fmt){case Format.ALPHA:return GL.ALPHA;case Format.U8_LUMINANCE:case Format.F16_LUMINANCE:case Format.F32_LUMINANCE:return GL.LUMINANCE;case Format.F16_R:return GL.R16F;case Format.F16_RG:return GL.RG16F;case Format.F16_RGB:return GL.RGB16F;case Format.F16_RGBA:return GL.RGBA16F;case Format.F32_R:return GL.R32F;case Format.F32_RG:return GL.RG32F;case Format.F32_RGB:return GL.RGB32F;case Format.F32_RGBA:return isWebGL2(this.gl)?GL.RGBA32F:isRenderbufferStorage?this.WEBGL_color_buffer_float.RGBA32F_EXT:GL.RGBA;case Format.U8_R_NORM:return GL.R8;case Format.U8_RG_NORM:return GL.RG8;case Format.U8_RGB_NORM:case Format.U8_RGB_RT:return GL.RGB8;case Format.U8_RGB_SRGB:return GL.SRGB8;case Format.U8_RGBA_NORM:case Format.U8_RGBA_RT:return isWebGL2(this.gl)?GL.RGBA8:isRenderbufferStorage?GL.RGBA4:GL.RGBA;case Format.U8_RGBA:return GL.RGBA;case Format.U8_RGBA_SRGB:case Format.U8_RGBA_RT_SRGB:return GL.SRGB8_ALPHA8;case Format.U16_R:return GL.R16UI;case Format.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Format.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Format.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Format.U16_RGBA_5551:return GL.RGB5_A1;case Format.U16_RGB_565:return GL.RGB565;case Format.U32_R:return GL.R32UI;case Format.S8_RGBA_NORM:return GL.RGBA8_SNORM;case Format.S8_RG_NORM:return GL.RG8_SNORM;case Format.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Format.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Format.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Format.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Format.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Format.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Format.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Format.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Format.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Format.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Format.D32F_S8:return isWebGL2(this.gl)?GL.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?GL.DEPTH_STENCIL:GL.DEPTH_COMPONENT16;case Format.D24_S8:return isWebGL2(this.gl)?GL.DEPTH24_STENCIL8:this.WEBGL_depth_texture?GL.DEPTH_STENCIL:GL.DEPTH_COMPONENT16;case Format.D32F:return isWebGL2(this.gl)?GL.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?GL.DEPTH_COMPONENT:GL.DEPTH_COMPONENT16;case Format.D24:return isWebGL2(this.gl)?GL.DEPTH_COMPONENT24:this.WEBGL_depth_texture?GL.DEPTH_COMPONENT:GL.DEPTH_COMPONENT16;default:throw new Error("whoops")}},Device_GL.prototype.translateTextureType=function(fmt){switch(getFormatTypeFlags(fmt)){case FormatTypeFlags.U8:return GL.UNSIGNED_BYTE;case FormatTypeFlags.U16:return GL.UNSIGNED_SHORT;case FormatTypeFlags.U32:return GL.UNSIGNED_INT;case FormatTypeFlags.S8:return GL.BYTE;case FormatTypeFlags.F16:return GL.HALF_FLOAT;case FormatTypeFlags.F32:return GL.FLOAT;case FormatTypeFlags.U16_PACKED_5551:return GL.UNSIGNED_SHORT_5_5_5_1;case FormatTypeFlags.D32F:return isWebGL2(this.gl)?GL.FLOAT:this.WEBGL_depth_texture?GL.UNSIGNED_INT:GL.UNSIGNED_BYTE;case FormatTypeFlags.D24:return isWebGL2(this.gl)?GL.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?GL.UNSIGNED_SHORT:GL.UNSIGNED_BYTE;case FormatTypeFlags.D24S8:return isWebGL2(this.gl)?GL.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?GL.UNSIGNED_INT_24_8_WEBGL:GL.UNSIGNED_BYTE;case FormatTypeFlags.D32FS8:return GL.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},Device_GL.prototype.translateInternalTextureFormat=function(fmt){switch(fmt){case Format.F32_R:return GL.R32F;case Format.F32_RG:return GL.RG32F;case Format.F32_RGB:return GL.RGB32F;case Format.F32_RGBA:return GL.RGBA32F;case Format.F16_R:return GL.R16F;case Format.F16_RG:return GL.RG16F;case Format.F16_RGB:return GL.RGB16F;case Format.F16_RGBA:return GL.RGBA16F}return this.translateTextureFormat(fmt)},Device_GL.prototype.translateTextureFormat=function(fmt){if(isTextureFormatCompressed(fmt)||fmt===Format.F32_LUMINANCE||fmt===Format.U8_LUMINANCE)return this.translateTextureInternalFormat(fmt);var supportDepthTexture=isWebGL2(this.gl)||!isWebGL2(this.gl)&&!!this.WEBGL_depth_texture;switch(fmt){case Format.D24_S8:case Format.D32F_S8:return supportDepthTexture?GL.DEPTH_STENCIL:GL.RGBA;case Format.D24:case Format.D32F:return supportDepthTexture?GL.DEPTH_COMPONENT:GL.RGBA}var isInteger=isFormatSizedInteger(fmt);switch(getFormatCompFlags(fmt)){case FormatCompFlags.A:return GL.ALPHA;case FormatCompFlags.R:return isInteger?GL.RED_INTEGER:GL.RED;case FormatCompFlags.RG:return isInteger?GL.RG_INTEGER:GL.RG;case FormatCompFlags.RGB:return isInteger?GL.RGB_INTEGER:GL.RGB;case FormatCompFlags.RGBA:return GL.RGBA}},Device_GL.prototype.setActiveTexture=function(texture){this.currentActiveTexture!==texture&&(this.gl.activeTexture(texture),this.currentActiveTexture=texture)},Device_GL.prototype.bindVAO=function(vao){this.currentBoundVAO!==vao&&(isWebGL2(this.gl)?this.gl.bindVertexArray(vao):this.OES_vertex_array_object.bindVertexArrayOES(vao),this.currentBoundVAO=vao)},Device_GL.prototype.programCompiled=function(program){es_assert(program.compileState!==ProgramCompileState_GL.NeedsCompile),program.compileState===ProgramCompileState_GL.Compiling&&(program.compileState=ProgramCompileState_GL.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(program))},Device_GL.prototype.useProgram=function(program){this.currentProgram!==program&&(this.programCompiled(program),this.gl.useProgram(program.gl_program),this.currentProgram=program)},Device_GL.prototype.ensureResourceExists=function(resource){if(null===resource){var error=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(error))}return resource},Device_GL.prototype.createBuffer=function(descriptor){return new Buffer_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createTexture=function(descriptor){return new Texture_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createSampler=function(descriptor){return new Sampler_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createRenderTarget=function(descriptor){return new RenderTarget_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createRenderTargetFromTexture=function(texture){var _a=texture,format=_a.format,width=_a.width,height=_a.height;return es_assert(1===_a.mipLevelCount),this.createRenderTarget({format,width,height,sampleCount:1,texture})},Device_GL.prototype.createProgram=function(descriptor){var _a,_b,_c,rawVertexGLSL=null===(_a=descriptor.vertex)||void 0===_a?void 0:_a.glsl;return(null===(_b=descriptor.vertex)||void 0===_b?void 0:_b.glsl)&&(descriptor.vertex.glsl=preprocessShader_GLSL(this.queryVendorInfo(),"vert",descriptor.vertex.glsl)),(null===(_c=descriptor.fragment)||void 0===_c?void 0:_c.glsl)&&(descriptor.fragment.glsl=preprocessShader_GLSL(this.queryVendorInfo(),"frag",descriptor.fragment.glsl)),this.createProgramSimple(descriptor,rawVertexGLSL)},Device_GL.prototype.createProgramSimple=function(descriptor,rawVertexGLSL){return new Program_GL({id:this.getNextUniqueId(),device:this,descriptor},rawVertexGLSL)},Device_GL.prototype.createBindings=function(descriptor){return new Bindings_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createInputLayout=function(descriptor){return new InputLayout_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createRenderPipeline=function(descriptor){return new RenderPipeline_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createComputePass=function(){return new ComputePass_GL},Device_GL.prototype.createComputePipeline=function(descriptor){return new ComputePipeline_GL({id:this.getNextUniqueId(),device:this,descriptor})},Device_GL.prototype.createReadback=function(){return new Readback_GL({id:this.getNextUniqueId(),device:this})},Device_GL.prototype.createQueryPool=function(type,elemCount){return new QueryPool_GL({id:this.getNextUniqueId(),device:this,descriptor:{type,elemCount}})},Device_GL.prototype.formatRenderPassDescriptor=function(descriptor){var _a,_b,_c,_d,_e,_f,colorAttachment=descriptor.colorAttachment;descriptor.depthClearValue=null!==(_a=descriptor.depthClearValue)&&void 0!==_a?_a:"load",descriptor.stencilClearValue=null!==(_b=descriptor.stencilClearValue)&&void 0!==_b?_b:"load";for(var i=0;i<colorAttachment.length;i++)descriptor.colorAttachmentLevel||(descriptor.colorAttachmentLevel=[]),descriptor.colorAttachmentLevel[i]=null!==(_c=descriptor.colorAttachmentLevel[i])&&void 0!==_c?_c:0,descriptor.colorResolveToLevel||(descriptor.colorResolveToLevel=[]),descriptor.colorResolveToLevel[i]=null!==(_d=descriptor.colorResolveToLevel[i])&&void 0!==_d?_d:0,descriptor.colorClearColor||(descriptor.colorClearColor=[]),descriptor.colorClearColor[i]=null!==(_e=descriptor.colorClearColor[i])&&void 0!==_e?_e:"load",descriptor.colorStore||(descriptor.colorStore=[]),descriptor.colorStore[i]=null!==(_f=descriptor.colorStore[i])&&void 0!==_f&&_f},Device_GL.prototype.createRenderBundle=function(){return new RenderBundle_GL({id:this.getNextUniqueId(),device:this})},Device_GL.prototype.beginBundle=function(bundle){this.renderBundle=bundle},Device_GL.prototype.endBundle=function(){this.renderBundle=void 0},Device_GL.prototype.executeBundles=function(renderBundles){renderBundles.forEach((function(renderBundle){renderBundle.replay()}))},Device_GL.prototype.createRenderPass=function(descriptor){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=descriptor,this.formatRenderPassDescriptor(descriptor);var colorAttachment=descriptor.colorAttachment,colorAttachmentLevel=descriptor.colorAttachmentLevel,colorClearColor=descriptor.colorClearColor,colorResolveTo=descriptor.colorResolveTo,colorResolveToLevel=descriptor.colorResolveToLevel,depthStencilAttachment=descriptor.depthStencilAttachment,depthClearValue=descriptor.depthClearValue,stencilClearValue=descriptor.stencilClearValue,depthStencilResolveTo=descriptor.depthStencilResolveTo;this.setRenderPassParametersBegin(colorAttachment.length);for(var i=0;i<colorAttachment.length;i++)this.setRenderPassParametersColor(i,colorAttachment[i],colorAttachmentLevel[i],colorResolveTo[i],colorResolveToLevel[i]);this.setRenderPassParametersDepthStencil(depthStencilAttachment,depthStencilResolveTo),this.validateCurrentAttachments();for(i=0;i<colorAttachment.length;i++){var clearColor=colorClearColor[i];"load"!==clearColor&&this.setRenderPassParametersClearColor(i,clearColor.r,clearColor.g,clearColor.b,clearColor.a)}return this.setRenderPassParametersClearDepthStencil(depthClearValue,stencilClearValue),this},Device_GL.prototype.submitPass=function(pass){es_assert(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},Device_GL.prototype.copySubTexture2D=function(dst_,dstX,dstY,src_,srcX,srcY){var gl=this.gl,dst=dst_,src=src_;if(es_assert(1===src.mipLevelCount),es_assert(1===dst.mipLevelCount),isWebGL2(gl))dst===this.scTexture?gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(gl.DRAW_FRAMEBUFFER,gl.COLOR_ATTACHMENT0,dst,0)),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(gl.READ_FRAMEBUFFER,gl.COLOR_ATTACHMENT0,src,0),gl.blitFramebuffer(srcX,srcY,srcX+src.width,srcY+src.height,dstX,dstY,dstX+src.width,dstY+src.height,gl.COLOR_BUFFER_BIT,gl.LINEAR),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null);else if(dst===this.scTexture){var rt=this.createRenderTargetFromTexture(src_);this.submitBlitRenderPass(rt,dst)}},Device_GL.prototype.queryLimits=function(){return this},Device_GL.prototype.queryTextureFormatSupported=function(format,width,height){switch(format){case Format.BC1_SRGB:case Format.BC2_SRGB:case Format.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&isBlockCompressSized(width,height,4,4);case Format.BC1:case Format.BC2:case Format.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&isBlockCompressSized(width,height,4,4);case Format.BC4_UNORM:case Format.BC4_SNORM:case Format.BC5_UNORM:case Format.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&isBlockCompressSized(width,height,4,4);case Format.U16_R_NORM:case Format.U16_RG_NORM:case Format.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case Format.F32_R:case Format.F32_RG:case Format.F32_RGB:case Format.F32_RGBA:return null!==this.OES_texture_float_linear;case Format.F16_R:case Format.F16_RG:case Format.F16_RGB:case Format.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},Device_GL.prototype.queryProgramReady=function(program){var gl=this.gl;if(program.compileState===ProgramCompileState_GL.NeedsCompile)throw new Error("whoops");if(program.compileState===ProgramCompileState_GL.Compiling){var complete=void 0;return(complete=null===this.KHR_parallel_shader_compile||gl.getProgramParameter(program.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(program),complete}return program.compileState===ProgramCompileState_GL.NeedsBind||program.compileState===ProgramCompileState_GL.ReadyToUse},Device_GL.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},Device_GL.prototype.queryVendorInfo=function(){return this},Device_GL.prototype.queryRenderPass=function(o){return this.currentRenderPassDescriptor},Device_GL.prototype.queryRenderTarget=function(o){return o},Device_GL.prototype.setResourceName=function(o,name){if(o.name=name,o.type===ResourceType.Buffer)for(var gl_buffer_pages=o.gl_buffer_pages,i=0;i<gl_buffer_pages.length;i++)assignPlatformName(gl_buffer_pages[i],"".concat(name," Page ").concat(i));else if(o.type===ResourceType.Texture)assignPlatformName(getPlatformTexture(o),name);else if(o.type===ResourceType.Sampler)assignPlatformName(getPlatformSampler$1(o),name);else if(o.type===ResourceType.RenderTarget){var gl_renderbuffer=o.gl_renderbuffer;null!==gl_renderbuffer&&assignPlatformName(gl_renderbuffer,name)}else o.type===ResourceType.InputLayout&&assignPlatformName(o.vao,name)},Device_GL.prototype.setResourceLeakCheck=function(o,v){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(o,v)},Device_GL.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},Device_GL.prototype.pushDebugGroup=function(name){},Device_GL.prototype.popDebugGroup=function(){},Device_GL.prototype.insertDebugMarker=function(markerLabel){},Device_GL.prototype.programPatched=function(o,descriptor){es_assert(this.shaderDebug)},Device_GL.prototype.getBufferData=function(buffer,dstBuffer,wordOffset){void 0===wordOffset&&(wordOffset=0);var gl=this.gl;isWebGL2(gl)&&(gl.bindBuffer(gl.COPY_READ_BUFFER,getPlatformBuffer$1(buffer,4*wordOffset)),gl.getBufferSubData(gl.COPY_READ_BUFFER,4*wordOffset,dstBuffer))},Device_GL.prototype.debugGroupStatisticsDrawCall=function(count){void 0===count&&(count=1);for(var i=this.debugGroupStack.length-1;i>=0;i--)this.debugGroupStack[i].drawCallCount+=count},Device_GL.prototype.debugGroupStatisticsBufferUpload=function(count){void 0===count&&(count=1);for(var i=this.debugGroupStack.length-1;i>=0;i--)this.debugGroupStack[i].bufferUploadCount+=count},Device_GL.prototype.debugGroupStatisticsTextureBind=function(count){void 0===count&&(count=1);for(var i=this.debugGroupStack.length-1;i>=0;i--)this.debugGroupStack[i].textureBindCount+=count},Device_GL.prototype.debugGroupStatisticsTriangles=function(count){for(var i=this.debugGroupStack.length-1;i>=0;i--)this.debugGroupStack[i].triangleCount+=count},Device_GL.prototype.reportShaderError=function(shader,str){var gl=this.gl,status=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!status){console.error(function prependLineNo(str,lineStart){return void 0===lineStart&&(lineStart=1),str.split("\n").map((function(s,i){return"".concat(function leftPad(S,spaces,ch){for(void 0===ch&&(ch="0");S.length<spaces;)S="".concat(ch).concat(S);return S}(""+(lineStart+i),4," "),"  ").concat(s)})).join("\n")}(str));var debug_shaders=gl.getExtension("WEBGL_debug_shaders");debug_shaders&&console.error(debug_shaders.getTranslatedShaderSource(shader)),console.error(gl.getShaderInfoLog(shader))}return status},Device_GL.prototype.checkProgramCompilationForErrors=function(program){var gl=this.gl,prog=program.gl_program;if(!gl.getProgramParameter(prog,gl.LINK_STATUS)){var descriptor=program.descriptor;if(!this.reportShaderError(program.gl_shader_vert,descriptor.vertex.glsl))return;if(!this.reportShaderError(program.gl_shader_frag,descriptor.fragment.glsl))return;console.error(gl.getProgramInfoLog(program.gl_program))}},Device_GL.prototype.bindFramebufferAttachment=function(framebuffer,binding,attachment,level){var gl=this.gl;if((0,is_nil.A)(attachment))gl.framebufferRenderbuffer(framebuffer,binding,gl.RENDERBUFFER,null);else if(attachment.type===ResourceType.RenderTarget)null!==attachment.gl_renderbuffer?gl.framebufferRenderbuffer(framebuffer,binding,gl.RENDERBUFFER,attachment.gl_renderbuffer):null!==attachment.texture&&gl.framebufferTexture2D(framebuffer,binding,GL.TEXTURE_2D,getPlatformTexture(attachment.texture),level);else if(attachment.type===ResourceType.Texture){var texture=getPlatformTexture(attachment);attachment.dimension===TextureDimension.TEXTURE_2D?gl.framebufferTexture2D(framebuffer,binding,GL.TEXTURE_2D,texture,level):isWebGL2(gl)&&(attachment.dimension,TextureDimension.TEXTURE_2D_ARRAY)}},Device_GL.prototype.bindFramebufferDepthStencilAttachment=function(framebuffer,attachment){var gl=this.gl,flags=(0,is_nil.A)(attachment)?FormatFlags.Depth|FormatFlags.Stencil:getFormatFlags(attachment.format),depth=!!(flags&FormatFlags.Depth),stencil=!!(flags&FormatFlags.Stencil);depth&&stencil?isWebGL2(this.gl)||!isWebGL2(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(framebuffer,gl.DEPTH_STENCIL_ATTACHMENT,attachment,0):this.bindFramebufferAttachment(framebuffer,gl.DEPTH_ATTACHMENT,attachment,0):depth?(this.bindFramebufferAttachment(framebuffer,gl.DEPTH_ATTACHMENT,attachment,0),this.bindFramebufferAttachment(framebuffer,gl.STENCIL_ATTACHMENT,null,0)):stencil&&(this.bindFramebufferAttachment(framebuffer,gl.STENCIL_ATTACHMENT,attachment,0),this.bindFramebufferAttachment(framebuffer,gl.DEPTH_ATTACHMENT,null,0))},Device_GL.prototype.validateCurrentAttachments=function(){for(var sampleCount=-1,width=-1,height=-1,i=0;i<this.currentColorAttachments.length;i++){var attachment=this.currentColorAttachments[i];null!==attachment&&(-1===sampleCount?(sampleCount=attachment.sampleCount,width=attachment.width,height=attachment.height):(es_assert(sampleCount===attachment.sampleCount),es_assert(width===attachment.width),es_assert(height===attachment.height)))}this.currentDepthStencilAttachment&&(-1===sampleCount?sampleCount=this.currentDepthStencilAttachment.sampleCount:(es_assert(sampleCount===this.currentDepthStencilAttachment.sampleCount),es_assert(width===this.currentDepthStencilAttachment.width),es_assert(height===this.currentDepthStencilAttachment.height))),this.currentSampleCount=sampleCount},Device_GL.prototype.setRenderPassParametersBegin=function(numColorAttachments){var gl=this.gl;if(isWebGL2(gl)?gl.bindFramebuffer(GL.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||gl.bindFramebuffer(GL.FRAMEBUFFER,this.renderPassDrawFramebuffer),isWebGL2(gl)?gl.drawBuffers([GL.COLOR_ATTACHMENT0,GL.COLOR_ATTACHMENT1,GL.COLOR_ATTACHMENT2,GL.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([GL.COLOR_ATTACHMENT0_WEBGL,GL.COLOR_ATTACHMENT1_WEBGL,GL.COLOR_ATTACHMENT2_WEBGL,GL.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var i=numColorAttachments;i<this.currentColorAttachments.length;i++){var target=isWebGL2(gl)?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,attachment=isWebGL2(gl)?GL.COLOR_ATTACHMENT0:GL.COLOR_ATTACHMENT0_WEBGL;gl.framebufferRenderbuffer(target,attachment+i,GL.RENDERBUFFER,null),gl.framebufferTexture2D(target,attachment+i,GL.TEXTURE_2D,null,0)}this.currentColorAttachments.length=numColorAttachments},Device_GL.prototype.setRenderPassParametersColor=function(i,colorAttachment,attachmentLevel,colorResolveTo,resolveToLevel){var gl2=isWebGL2(this.gl);this.currentColorAttachments[i]===colorAttachment&&this.currentColorAttachmentLevels[i]===attachmentLevel||(this.currentColorAttachments[i]=colorAttachment,this.currentColorAttachmentLevels[i]=attachmentLevel,(gl2||!gl2&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,(gl2?GL.COLOR_ATTACHMENT0:GL.COLOR_ATTACHMENT0_WEBGL)+i,colorAttachment,attachmentLevel),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[i]===colorResolveTo&&this.currentColorResolveToLevels[i]===resolveToLevel||(this.currentColorResolveTos[i]=colorResolveTo,this.currentColorResolveToLevels[i]=resolveToLevel,null!==colorResolveTo&&(this.resolveColorAttachmentsChanged=!0))},Device_GL.prototype.setRenderPassParametersDepthStencil=function(depthStencilAttachment,depthStencilResolveTo){var gl=this.gl;this.currentDepthStencilAttachment!==depthStencilAttachment&&(this.currentDepthStencilAttachment=depthStencilAttachment,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(isWebGL2(gl)?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==depthStencilResolveTo&&(this.currentDepthStencilResolveTo=depthStencilResolveTo,depthStencilResolveTo&&(this.resolveDepthStencilAttachmentsChanged=!0))},Device_GL.prototype.setRenderPassParametersClearColor=function(slot,r,g,b,a){var attachment,gl=this.gl;null!==this.OES_draw_buffers_indexed?(attachment=this.currentMegaState.attachmentsState[slot])&&attachment.channelWriteMask!==ChannelWriteMask.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(slot,!0,!0,!0,!0),attachment.channelWriteMask=ChannelWriteMask.ALL):(attachment=this.currentMegaState.attachmentsState[0])&&attachment.channelWriteMask!==ChannelWriteMask.ALL&&(gl.colorMask(!0,!0,!0,!0),attachment.channelWriteMask=ChannelWriteMask.ALL);this.setScissorRectEnabled(!1),isWebGL2(gl)?gl.clearBufferfv(gl.COLOR,slot,[r,g,b,a]):(gl.clearColor(r,g,b,a),gl.clear(gl.COLOR_BUFFER_BIT))},Device_GL.prototype.setRenderPassParametersClearDepthStencil=function(depthClearValue,stencilClearValue){void 0===depthClearValue&&(depthClearValue="load"),void 0===stencilClearValue&&(stencilClearValue="load");var gl=this.gl;"load"!==depthClearValue&&(es_assert(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(gl.depthMask(!0),this.currentMegaState.depthWrite=!0),isWebGL2(gl)?gl.clearBufferfv(gl.DEPTH,0,[depthClearValue]):(gl.clearDepth(depthClearValue),gl.clear(gl.DEPTH_BUFFER_BIT))),"load"!==stencilClearValue&&(es_assert(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(gl.enable(gl.STENCIL_TEST),gl.stencilMask(255),this.currentMegaState.stencilWrite=!0),isWebGL2(gl)?gl.clearBufferiv(gl.STENCIL,0,[stencilClearValue]):(gl.clearStencil(stencilClearValue),gl.clear(gl.STENCIL_BUFFER_BIT)))},Device_GL.prototype.setBindings=function(bindings_){var _a,_this=this;if(this.renderBundle)this.renderBundle.push((function(){return _this.setBindings(bindings_)}));else{var gl=this.gl,_b=bindings_,uniformBufferBindings=_b.uniformBufferBindings,samplerBindings=_b.samplerBindings,bindingLayouts=_b.bindingLayouts;es_assert(0<bindingLayouts.bindingLayoutTables.length);var bindingLayoutTable=bindingLayouts.bindingLayoutTables[0];es_assert(uniformBufferBindings.length>=bindingLayoutTable.numUniformBuffers),es_assert(samplerBindings.length>=bindingLayoutTable.numSamplers);for(var i=0;i<uniformBufferBindings.length;i++){if(0!==(binding=uniformBufferBindings[i]).size){var index=bindingLayoutTable.firstUniformBuffer+i,buffer=binding.buffer,byteOffset=binding.offset||0,byteSize=binding.size||buffer.byteSize;if(buffer!==this.currentUniformBuffers[index]||byteOffset!==this.currentUniformBufferByteOffsets[index]||byteSize!==this.currentUniformBufferByteSizes[index]){var platformBufferByteOffset=byteOffset%buffer.pageByteSize,platformBuffer=buffer.gl_buffer_pages[byteOffset/buffer.pageByteSize|0];es_assert(platformBufferByteOffset+byteSize<=buffer.pageByteSize),isWebGL2(gl)&&gl.bindBufferRange(gl.UNIFORM_BUFFER,index,platformBuffer,platformBufferByteOffset,byteSize),this.currentUniformBuffers[index]=buffer,this.currentUniformBufferByteOffsets[index]=byteOffset,this.currentUniformBufferByteSizes[index]=byteSize}}}for(i=0;i<bindingLayoutTable.numSamplers;i++){var binding=samplerBindings[i],samplerIndex=bindingLayoutTable.firstSampler+i,gl_sampler=null!==binding&&null!==binding.sampler?getPlatformSampler$1(binding.sampler):null,gl_texture=null!==binding&&null!==binding.texture?getPlatformTexture(binding.texture):null;if(this.currentSamplers[samplerIndex]!==gl_sampler&&(isWebGL2(gl)&&gl.bindSampler(samplerIndex,gl_sampler),this.currentSamplers[samplerIndex]=gl_sampler),this.currentTextures[samplerIndex]!==gl_texture){if(this.setActiveTexture(gl.TEXTURE0+samplerIndex),null!==gl_texture){var _c=assertExists(binding).texture,gl_target=_c.gl_target,width=_c.width,height=_c.height;binding.texture.textureIndex=samplerIndex,gl.bindTexture(gl_target,gl_texture),isWebGL2(gl)||null===(_a=binding.sampler)||void 0===_a||_a.setTextureParameters(gl_target,width,height),this.debugGroupStatisticsTextureBind()}else{var samplerEntry=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},binding),defaultBindingLayoutSamplerDescriptor),dimension=samplerEntry.dimension,formatKind=samplerEntry.formatKind;gl_target=translateTextureDimension$1(dimension);gl.bindTexture(gl_target,this.getFallbackTexture((0,tslib_es6.Cl)({gl_target,formatKind},samplerEntry)))}this.currentTextures[samplerIndex]=gl_texture}}}},Device_GL.prototype.setViewport=function(x,y,w,h){this.gl.viewport(x,y,w,h)},Device_GL.prototype.setScissorRect=function(x,y,w,h){var gl=this.gl;this.setScissorRectEnabled(!0),gl.scissor(x,y,w,h)},Device_GL.prototype.applyAttachmentStateIndexed=function(i,currentAttachmentState,newAttachmentState){var gl=this.gl,dbi=this.OES_draw_buffers_indexed;currentAttachmentState.channelWriteMask!==newAttachmentState.channelWriteMask&&(dbi.colorMaskiOES(i,!!(newAttachmentState.channelWriteMask&ChannelWriteMask.RED),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.GREEN),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.BLUE),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.ALPHA)),currentAttachmentState.channelWriteMask=newAttachmentState.channelWriteMask);var blendModeChanged=currentAttachmentState.rgbBlendState.blendMode!==newAttachmentState.rgbBlendState.blendMode||currentAttachmentState.alphaBlendState.blendMode!==newAttachmentState.alphaBlendState.blendMode,blendFuncChanged=currentAttachmentState.rgbBlendState.blendSrcFactor!==newAttachmentState.rgbBlendState.blendSrcFactor||currentAttachmentState.alphaBlendState.blendSrcFactor!==newAttachmentState.alphaBlendState.blendSrcFactor||currentAttachmentState.rgbBlendState.blendDstFactor!==newAttachmentState.rgbBlendState.blendDstFactor||currentAttachmentState.alphaBlendState.blendDstFactor!==newAttachmentState.alphaBlendState.blendDstFactor;(blendFuncChanged||blendModeChanged)&&(isBlendStateNone(currentAttachmentState.rgbBlendState)&&isBlendStateNone(currentAttachmentState.alphaBlendState)?dbi.enableiOES(i,gl.BLEND):isBlendStateNone(newAttachmentState.rgbBlendState)&&isBlendStateNone(newAttachmentState.alphaBlendState)&&dbi.disableiOES(i,gl.BLEND)),blendModeChanged&&(dbi.blendEquationSeparateiOES(i,newAttachmentState.rgbBlendState.blendMode,newAttachmentState.alphaBlendState.blendMode),currentAttachmentState.rgbBlendState.blendMode=newAttachmentState.rgbBlendState.blendMode,currentAttachmentState.alphaBlendState.blendMode=newAttachmentState.alphaBlendState.blendMode),blendFuncChanged&&(dbi.blendFuncSeparateiOES(i,newAttachmentState.rgbBlendState.blendSrcFactor,newAttachmentState.rgbBlendState.blendDstFactor,newAttachmentState.alphaBlendState.blendSrcFactor,newAttachmentState.alphaBlendState.blendDstFactor),currentAttachmentState.rgbBlendState.blendSrcFactor=newAttachmentState.rgbBlendState.blendSrcFactor,currentAttachmentState.alphaBlendState.blendSrcFactor=newAttachmentState.alphaBlendState.blendSrcFactor,currentAttachmentState.rgbBlendState.blendDstFactor=newAttachmentState.rgbBlendState.blendDstFactor,currentAttachmentState.alphaBlendState.blendDstFactor=newAttachmentState.alphaBlendState.blendDstFactor)},Device_GL.prototype.applyAttachmentState=function(currentAttachmentState,newAttachmentState){var gl=this.gl;currentAttachmentState.channelWriteMask!==newAttachmentState.channelWriteMask&&(gl.colorMask(!!(newAttachmentState.channelWriteMask&ChannelWriteMask.RED),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.GREEN),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.BLUE),!!(newAttachmentState.channelWriteMask&ChannelWriteMask.ALPHA)),currentAttachmentState.channelWriteMask=newAttachmentState.channelWriteMask);var blendModeChanged=currentAttachmentState.rgbBlendState.blendMode!==newAttachmentState.rgbBlendState.blendMode||currentAttachmentState.alphaBlendState.blendMode!==newAttachmentState.alphaBlendState.blendMode,blendFuncChanged=currentAttachmentState.rgbBlendState.blendSrcFactor!==newAttachmentState.rgbBlendState.blendSrcFactor||currentAttachmentState.alphaBlendState.blendSrcFactor!==newAttachmentState.alphaBlendState.blendSrcFactor||currentAttachmentState.rgbBlendState.blendDstFactor!==newAttachmentState.rgbBlendState.blendDstFactor||currentAttachmentState.alphaBlendState.blendDstFactor!==newAttachmentState.alphaBlendState.blendDstFactor;(blendFuncChanged||blendModeChanged)&&(isBlendStateNone(currentAttachmentState.rgbBlendState)&&isBlendStateNone(currentAttachmentState.alphaBlendState)?gl.enable(gl.BLEND):isBlendStateNone(newAttachmentState.rgbBlendState)&&isBlendStateNone(newAttachmentState.alphaBlendState)&&gl.disable(gl.BLEND)),blendModeChanged&&(gl.blendEquationSeparate(newAttachmentState.rgbBlendState.blendMode,newAttachmentState.alphaBlendState.blendMode),currentAttachmentState.rgbBlendState.blendMode=newAttachmentState.rgbBlendState.blendMode,currentAttachmentState.alphaBlendState.blendMode=newAttachmentState.alphaBlendState.blendMode),blendFuncChanged&&(gl.blendFuncSeparate(newAttachmentState.rgbBlendState.blendSrcFactor,newAttachmentState.rgbBlendState.blendDstFactor,newAttachmentState.alphaBlendState.blendSrcFactor,newAttachmentState.alphaBlendState.blendDstFactor),currentAttachmentState.rgbBlendState.blendSrcFactor=newAttachmentState.rgbBlendState.blendSrcFactor,currentAttachmentState.alphaBlendState.blendSrcFactor=newAttachmentState.alphaBlendState.blendSrcFactor,currentAttachmentState.rgbBlendState.blendDstFactor=newAttachmentState.rgbBlendState.blendDstFactor,currentAttachmentState.alphaBlendState.blendDstFactor=newAttachmentState.alphaBlendState.blendDstFactor)},Device_GL.prototype.setMegaState=function(newMegaState){var gl=this.gl,currentMegaState=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var i=0;i<newMegaState.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,currentMegaState.attachmentsState[0],newMegaState.attachmentsState[0]);else es_assert(1===newMegaState.attachmentsState.length),this.applyAttachmentState(currentMegaState.attachmentsState[0],newMegaState.attachmentsState[0]);if(colorEqual(currentMegaState.blendConstant,newMegaState.blendConstant)||(gl.blendColor(newMegaState.blendConstant.r,newMegaState.blendConstant.g,newMegaState.blendConstant.b,newMegaState.blendConstant.a),colorCopy(currentMegaState.blendConstant,newMegaState.blendConstant)),currentMegaState.depthCompare!==newMegaState.depthCompare&&(gl.depthFunc(newMegaState.depthCompare),currentMegaState.depthCompare=newMegaState.depthCompare),!!currentMegaState.depthWrite!=!!newMegaState.depthWrite&&(gl.depthMask(newMegaState.depthWrite),currentMegaState.depthWrite=newMegaState.depthWrite),!!currentMegaState.stencilWrite!=!!newMegaState.stencilWrite&&(gl.stencilMask(newMegaState.stencilWrite?255:0),currentMegaState.stencilWrite=newMegaState.stencilWrite),!stencilFaceStateEquals(currentMegaState.stencilFront,newMegaState.stencilFront)){var _a=newMegaState.stencilFront,passOp=_a.passOp,failOp=_a.failOp,depthFailOp=_a.depthFailOp,compare=_a.compare;currentMegaState.stencilFront.passOp===passOp&&currentMegaState.stencilFront.failOp===failOp&&currentMegaState.stencilFront.depthFailOp===depthFailOp||(gl.stencilOpSeparate(gl.FRONT,failOp,depthFailOp,passOp),currentMegaState.stencilFront.passOp=passOp,currentMegaState.stencilFront.failOp=failOp,currentMegaState.stencilFront.depthFailOp=depthFailOp),currentMegaState.stencilFront.compare!==compare&&(this.setStencilReference(0),currentMegaState.stencilFront.compare=compare)}if(!stencilFaceStateEquals(currentMegaState.stencilBack,newMegaState.stencilBack)){var _b=newMegaState.stencilBack;passOp=_b.passOp,failOp=_b.failOp,depthFailOp=_b.depthFailOp,compare=_b.compare;currentMegaState.stencilBack.passOp===passOp&&currentMegaState.stencilBack.failOp===failOp&&currentMegaState.stencilBack.depthFailOp===depthFailOp||(gl.stencilOpSeparate(gl.BACK,failOp,depthFailOp,passOp),currentMegaState.stencilBack.passOp=passOp,currentMegaState.stencilBack.failOp=failOp,currentMegaState.stencilBack.depthFailOp=depthFailOp),currentMegaState.stencilBack.compare!==compare&&(this.setStencilReference(0),currentMegaState.stencilBack.compare=compare)}currentMegaState.stencilFront.mask===newMegaState.stencilFront.mask&&currentMegaState.stencilBack.mask===newMegaState.stencilBack.mask||(currentMegaState.stencilFront.mask=newMegaState.stencilFront.mask,currentMegaState.stencilBack.mask=newMegaState.stencilBack.mask,this.applyStencil()),currentMegaState.cullMode!==newMegaState.cullMode&&(currentMegaState.cullMode===CullMode.NONE?gl.enable(gl.CULL_FACE):newMegaState.cullMode===CullMode.NONE&&gl.disable(gl.CULL_FACE),newMegaState.cullMode===CullMode.BACK?gl.cullFace(gl.BACK):newMegaState.cullMode===CullMode.FRONT?gl.cullFace(gl.FRONT):newMegaState.cullMode===CullMode.FRONT_AND_BACK&&gl.cullFace(gl.FRONT_AND_BACK),currentMegaState.cullMode=newMegaState.cullMode),currentMegaState.frontFace!==newMegaState.frontFace&&(gl.frontFace(newMegaState.frontFace),currentMegaState.frontFace=newMegaState.frontFace),currentMegaState.polygonOffset!==newMegaState.polygonOffset&&(newMegaState.polygonOffset?(gl.polygonOffset(1,1),gl.enable(gl.POLYGON_OFFSET_FILL)):gl.disable(gl.POLYGON_OFFSET_FILL),currentMegaState.polygonOffset=newMegaState.polygonOffset)},Device_GL.prototype.validatePipelineFormats=function(pipeline){for(var i=0;i<this.currentColorAttachments.length;i++)this.currentColorAttachments[i];this.currentDepthStencilAttachment&&es_assert(this.currentDepthStencilAttachment.format===pipeline.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&es_assert(this.currentSampleCount===pipeline.sampleCount)},Device_GL.prototype.setPipeline=function(o){var _this=this;if(this.renderBundle)this.renderBundle.push((function(){return _this.setPipeline(o)}));else{this.currentPipeline=o,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var program=this.currentPipeline.program;if(this.useProgram(program),program.compileState===ProgramCompileState_GL.NeedsBind){var gl=this.gl,prog=program.gl_program,deviceProgram=program.descriptor,uniformBlocks=findall(deviceProgram.vertex.glsl,UNIFROM_BLOCK_REGEXP);if(isWebGL2(gl))for(var i=0;i<uniformBlocks.length;i++){var blockName=(0,tslib_es6.zs)(uniformBlocks[i],2)[1],blockIdx=gl.getUniformBlockIndex(prog,blockName);-1!==blockIdx&&4294967295!==blockIdx&&gl.uniformBlockBinding(prog,blockIdx,i)}var samplers=findall(deviceProgram.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(i=0;i<samplers.length;i++){var _b=(0,tslib_es6.zs)(samplers[i],3),name_1=_b[1],location_1=_b[2],samplerUniformLocation=gl.getUniformLocation(prog,name_1);gl.uniform1i(samplerUniformLocation,parseInt(location_1))}program.compileState=ProgramCompileState_GL.ReadyToUse}}},Device_GL.prototype.setVertexInput=function(inputLayout_,vertexBuffers,indexBuffer){var e_1,_a,_b,_this=this;if(this.renderBundle)this.renderBundle.push((function(){return _this.setVertexInput(inputLayout_,vertexBuffers,indexBuffer)}));else if(null!==inputLayout_){es_assert(this.currentPipeline.inputLayout===inputLayout_);var inputLayout=inputLayout_;this.bindVAO(inputLayout.vao);for(var gl=this.gl,i=0;i<inputLayout.vertexBufferDescriptors.length;i++){var vertexBufferDescriptor=inputLayout.vertexBufferDescriptors[i],arrayStride=vertexBufferDescriptor.arrayStride,attributes=vertexBufferDescriptor.attributes;try{for(var attributes_1=(e_1=void 0,(0,tslib_es6.Ju)(attributes)),attributes_1_1=attributes_1.next();!attributes_1_1.done;attributes_1_1=attributes_1.next()){var attribute=attributes_1_1.value,shaderLocation=attribute.shaderLocation,offset=attribute.offset,location_2=isWebGL2(gl)?shaderLocation:null===(_b=inputLayout.program.attributes[shaderLocation])||void 0===_b?void 0:_b.location;if(!(0,is_nil.A)(location_2)){var vertexBuffer=vertexBuffers[i];if(null===vertexBuffer)continue;var format=attribute.vertexFormat;gl.bindBuffer(gl.ARRAY_BUFFER,getPlatformBuffer$1(vertexBuffer.buffer));var bufferOffset=(vertexBuffer.offset||0)+offset;gl.vertexAttribPointer(location_2,format.size,format.type,format.normalized,arrayStride,bufferOffset)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{attributes_1_1&&!attributes_1_1.done&&(_a=attributes_1.return)&&_a.call(attributes_1)}finally{if(e_1)throw e_1.error}}}if(es_assert(null!==indexBuffer==(null!==inputLayout.indexBufferFormat)),null!==indexBuffer){var buffer=indexBuffer.buffer;es_assert(buffer.usage===BufferUsage.INDEX),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,getPlatformBuffer$1(buffer)),this.currentIndexBufferByteOffset=indexBuffer.offset||0}else this.currentIndexBufferByteOffset=null}else es_assert(null===this.currentPipeline.inputLayout),es_assert(null===indexBuffer),this.bindVAO(null),this.currentIndexBufferByteOffset=0},Device_GL.prototype.setStencilReference=function(value){this.currentStencilRef!==value&&(this.currentStencilRef=value,this.applyStencil())},Device_GL.prototype.draw=function(vertexCount,instanceCount,firstVertex,firstInstance){var _a,_this=this;if(this.renderBundle)this.renderBundle.push((function(){return _this.draw(vertexCount,instanceCount,firstVertex,firstInstance)}));else{var gl=this.gl,pipeline=this.currentPipeline;if(instanceCount){var params=[pipeline.drawMode,firstVertex||0,vertexCount,instanceCount];isWebGL2(gl)?gl.drawArraysInstanced.apply(gl,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(params),!1)):(_a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(params),!1))}else gl.drawArrays(pipeline.drawMode,firstVertex,vertexCount);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(vertexCount/3*Math.max(instanceCount,1))}},Device_GL.prototype.drawIndexed=function(indexCount,instanceCount,firstIndex,baseVertex,firstInstance){var _a,_this=this;if(this.renderBundle)this.renderBundle.push((function(){return _this.drawIndexed(indexCount,instanceCount,firstIndex,baseVertex,firstInstance)}));else{var gl=this.gl,pipeline=this.currentPipeline,inputLayout=assertExists(pipeline.inputLayout),byteOffset=assertExists(this.currentIndexBufferByteOffset)+firstIndex*inputLayout.indexBufferCompByteSize;if(instanceCount){var params=[pipeline.drawMode,indexCount,inputLayout.indexBufferType,byteOffset,instanceCount];isWebGL2(gl)?gl.drawElementsInstanced.apply(gl,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(params),!1)):(_a=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(params),!1))}else gl.drawElements(pipeline.drawMode,indexCount,inputLayout.indexBufferType,byteOffset);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(indexCount/3*Math.max(instanceCount,1))}},Device_GL.prototype.drawIndirect=function(indirectBuffer,indirectOffset){},Device_GL.prototype.drawIndexedIndirect=function(indirectBuffer,indirectOffset){},Device_GL.prototype.beginOcclusionQuery=function(queryIndex){var gl=this.gl;if(isWebGL2(gl)){var queryPool=this.currentRenderPassDescriptor.occlusionQueryPool;gl.beginQuery(queryPool.gl_query_type,queryPool.gl_query[queryIndex])}},Device_GL.prototype.endOcclusionQuery=function(){var gl=this.gl;if(isWebGL2(gl)){var queryPool=this.currentRenderPassDescriptor.occlusionQueryPool;gl.endQuery(queryPool.gl_query_type)}},Device_GL.prototype.pipelineQueryReady=function(o){var pipeline=o;return this.queryProgramReady(pipeline.program)},Device_GL.prototype.pipelineForceReady=function(o){},Device_GL.prototype.endPass=function(){for(var gl=this.gl,gl2=isWebGL2(gl),didUnbindDraw=!1,i=0;i<this.currentColorAttachments.length;i++){var colorResolveFrom=this.currentColorAttachments[i];if(null!==colorResolveFrom){var colorResolveTo=this.currentColorResolveTos[i],didBindRead=!1;null!==colorResolveTo&&(es_assert(colorResolveFrom.width===colorResolveTo.width&&colorResolveFrom.height===colorResolveTo.height),this.setScissorRectEnabled(!1),gl2&&gl.bindFramebuffer(gl.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&gl2&&this.bindFramebufferAttachment(gl.READ_FRAMEBUFFER,gl.COLOR_ATTACHMENT0,colorResolveFrom,this.currentColorAttachmentLevels[i]),didBindRead=!0,colorResolveTo===this.scTexture?gl.bindFramebuffer(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,this.scPlatformFramebuffer):(gl.bindFramebuffer(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&gl.framebufferTexture2D(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,colorResolveTo.gl_texture,this.currentColorResolveToLevels[i])),gl2?(gl.blitFramebuffer(0,0,colorResolveFrom.width,colorResolveFrom.height,0,0,colorResolveTo.width,colorResolveTo.height,gl.COLOR_BUFFER_BIT,gl.LINEAR),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(colorResolveFrom,colorResolveTo),didUnbindDraw=!0),this.currentRenderPassDescriptor.colorStore[i]||didBindRead||(gl.bindFramebuffer(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,colorResolveFrom,this.currentColorAttachmentLevels[i])),gl.bindFramebuffer(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var depthStencilResolveFrom=this.currentDepthStencilAttachment;if(depthStencilResolveFrom){var depthStencilResolveTo=this.currentDepthStencilResolveTo;didBindRead=!1;depthStencilResolveTo&&(es_assert(depthStencilResolveFrom.width===depthStencilResolveTo.width&&depthStencilResolveFrom.height===depthStencilResolveTo.height),this.setScissorRectEnabled(!1),gl.bindFramebuffer(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),gl.bindFramebuffer(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,depthStencilResolveFrom),this.bindFramebufferDepthStencilAttachment(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,depthStencilResolveTo)),didBindRead=!0,gl2&&gl.blitFramebuffer(0,0,depthStencilResolveFrom.width,depthStencilResolveFrom.height,0,0,depthStencilResolveTo.width,depthStencilResolveTo.height,gl.DEPTH_BUFFER_BIT,gl.NEAREST),gl.bindFramebuffer(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,null),didUnbindDraw=!0),this.currentRenderPassDescriptor.depthStencilStore||(didBindRead||(gl.bindFramebuffer(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,depthStencilResolveFrom),didBindRead=!0),gl2&&gl.invalidateFramebuffer(gl.READ_FRAMEBUFFER,[gl.DEPTH_STENCIL_ATTACHMENT])),didBindRead&&gl.bindFramebuffer(gl2?GL.READ_FRAMEBUFFER:GL.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}didUnbindDraw||gl.bindFramebuffer(gl2?GL.DRAW_FRAMEBUFFER:GL.FRAMEBUFFER,null)},Device_GL.prototype.setScissorRectEnabled=function(v){if(this.currentScissorEnabled!==v){var gl=this.gl;v?gl.enable(gl.SCISSOR_TEST):gl.disable(gl.SCISSOR_TEST),this.currentScissorEnabled=v}},Device_GL.prototype.applyStencil=function(){(0,is_nil.A)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(GL.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(GL.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},Device_GL.prototype.getFallbackTexture=function(samplerEntry){var gl_target=samplerEntry.gl_target,formatKind=samplerEntry.formatKind;if(gl_target===GL.TEXTURE_2D)return formatKind===SamplerFormatKind.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(gl_target===GL.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(gl_target===GL.TEXTURE_3D)return this.fallbackTexture3D;if(gl_target===GL.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},Device_GL.prototype.submitBlitRenderPass=function(resolveFrom,resolveTo){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:BufferUsage.VERTEX|BufferUsage.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:PrimitiveTopology.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Format.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:copyMegaState(defaultMegaState)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:resolveFrom.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:resolveFrom}));var currentRenderPassDescriptor=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var blitRenderPass=this.createRenderPass({colorAttachment:[resolveFrom],colorResolveTo:[resolveTo],colorClearColor:[TransparentWhite]}),_a=this.getCanvas(),width=_a.width,height=_a.height;blitRenderPass.setPipeline(this.blitRenderPipeline),blitRenderPass.setBindings(this.blitBindings),blitRenderPass.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),blitRenderPass.setViewport(0,0,width,height),this.gl.disable(this.gl.BLEND),blitRenderPass.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=currentRenderPassDescriptor,this.inBlitRenderPass=!1},Device_GL}(),WebGLDeviceContribution=function(){function WebGLDeviceContribution(pluginOptions){this.pluginOptions=pluginOptions}return WebGLDeviceContribution.prototype.createSwapChain=function($canvas){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var _a,targets,xrCompatible,_b,antialias,_c,preserveDrawingBuffer,_d,premultipliedAlpha,shaderDebug,trackResources,options,gl;return(0,tslib_es6.YH)(this,(function(_e){return _a=this.pluginOptions,targets=_a.targets,xrCompatible=_a.xrCompatible,_b=_a.antialias,antialias=void 0!==_b&&_b,_c=_a.preserveDrawingBuffer,preserveDrawingBuffer=void 0!==_c&&_c,_d=_a.premultipliedAlpha,premultipliedAlpha=void 0===_d||_d,shaderDebug=_a.shaderDebug,trackResources=_a.trackResources,options={antialias,preserveDrawingBuffer,stencil:!0,premultipliedAlpha,xrCompatible},this.handleContextEvents($canvas),targets.includes("webgl2")&&(gl=$canvas.getContext("webgl2",options)||$canvas.getContext("experimental-webgl2",options)),!gl&&targets.includes("webgl1")&&(gl=$canvas.getContext("webgl",options)||$canvas.getContext("experimental-webgl",options)),[2,new Device_GL(gl,{shaderDebug,trackResources})]}))}))},WebGLDeviceContribution.prototype.handleContextEvents=function($canvas){var _a=this.pluginOptions,onContextLost=_a.onContextLost,onContextRestored=_a.onContextRestored,onContextCreationError=_a.onContextCreationError;onContextCreationError&&$canvas.addEventListener("webglcontextcreationerror",onContextCreationError,!1),onContextLost&&$canvas.addEventListener("webglcontextlost",onContextLost,!1),onContextRestored&&$canvas.addEventListener("webglcontextrestored",onContextRestored,!1)},WebGLDeviceContribution}();let wasm;const cachedTextDecoder="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&cachedTextDecoder.decode();let cachedUint8Memory0=null;function getUint8Memory0(){return null!==cachedUint8Memory0&&0!==cachedUint8Memory0.byteLength||(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(ptr,len){return ptr>>>=0,cachedTextDecoder.decode(getUint8Memory0().subarray(ptr,ptr+len))}const heap=new Array(128).fill(void 0);heap.push(void 0,null,!0,!1);let heap_next=heap.length;function getObject(idx){return heap[idx]}function takeObject(idx){const ret=getObject(idx);return function dropObject(idx){idx<132||(heap[idx]=heap_next,heap_next=idx)}(idx),ret}let WASM_VECTOR_LEN=0;const cachedTextEncoder="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},encodeString="function"==typeof cachedTextEncoder.encodeInto?function(arg,view){return cachedTextEncoder.encodeInto(arg,view)}:function(arg,view){const buf=cachedTextEncoder.encode(arg);return view.set(buf),{read:arg.length,written:buf.length}};function passStringToWasm0(arg,malloc,realloc){if(void 0===realloc){const buf=cachedTextEncoder.encode(arg),ptr=malloc(buf.length,1)>>>0;return getUint8Memory0().subarray(ptr,ptr+buf.length).set(buf),WASM_VECTOR_LEN=buf.length,ptr}let len=arg.length,ptr=malloc(len,1)>>>0;const mem=getUint8Memory0();let offset=0;for(;offset<len;offset++){const code=arg.charCodeAt(offset);if(code>127)break;mem[ptr+offset]=code}if(offset!==len){0!==offset&&(arg=arg.slice(offset)),ptr=realloc(ptr,len,len=offset+3*arg.length,1)>>>0;const view=getUint8Memory0().subarray(ptr+offset,ptr+len);offset+=encodeString(arg,view).written}return WASM_VECTOR_LEN=offset,ptr}let cachedInt32Memory0=null;function getInt32Memory0(){return null!==cachedInt32Memory0&&0!==cachedInt32Memory0.byteLength||(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}function glsl_compile(source,stage,validation_enabled){let deferred3_0,deferred3_1;try{const retptr=wasm.__wbindgen_add_to_stack_pointer(-16),ptr0=passStringToWasm0(source,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),len0=WASM_VECTOR_LEN,ptr1=passStringToWasm0(stage,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),len1=WASM_VECTOR_LEN;wasm.glsl_compile(retptr,ptr0,len0,ptr1,len1,validation_enabled);var r0=getInt32Memory0()[retptr/4+0],r1=getInt32Memory0()[retptr/4+1];return deferred3_0=r0,deferred3_1=r1,getStringFromWasm0(r0,r1)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(deferred3_0,deferred3_1,1)}}class WGSLComposer{static __wrap(ptr){ptr>>>=0;const obj=Object.create(WGSLComposer.prototype);return obj.__wbg_ptr=ptr,obj}__destroy_into_raw(){const ptr=this.__wbg_ptr;return this.__wbg_ptr=0,ptr}free(){const ptr=this.__destroy_into_raw();wasm.__wbg_wgslcomposer_free(ptr)}constructor(){const ret=wasm.wgslcomposer_new();return WGSLComposer.__wrap(ret)}wgsl_compile(source){let deferred2_0,deferred2_1;try{const retptr=wasm.__wbindgen_add_to_stack_pointer(-16),ptr0=passStringToWasm0(source,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),len0=WASM_VECTOR_LEN;wasm.wgslcomposer_wgsl_compile(retptr,this.__wbg_ptr,ptr0,len0);var r0=getInt32Memory0()[retptr/4+0],r1=getInt32Memory0()[retptr/4+1];return deferred2_0=r0,deferred2_1=r1,getStringFromWasm0(r0,r1)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(deferred2_0,deferred2_1,1)}}}function __wbg_get_imports(){const imports={wbg:{}};return imports.wbg.__wbindgen_string_new=function(arg0,arg1){return function addHeapObject(obj){heap_next===heap.length&&heap.push(heap.length+1);const idx=heap_next;return heap_next=heap[idx],heap[idx]=obj,idx}(getStringFromWasm0(arg0,arg1))},imports.wbg.__wbindgen_object_drop_ref=function(arg0){takeObject(arg0)},imports.wbg.__wbg_log_1d3ae0273d8f4f8a=function(arg0){console.log(getObject(arg0))},imports.wbg.__wbg_log_576ca876af0d4a77=function(arg0,arg1){console.log(getObject(arg0),getObject(arg1))},imports.wbg.__wbindgen_throw=function(arg0,arg1){throw new Error(getStringFromWasm0(arg0,arg1))},imports}async function __wbg_init(input){if(void 0!==wasm)return wasm;const imports=__wbg_get_imports();("string"==typeof input||"function"==typeof Request&&input instanceof Request||"function"==typeof URL&&input instanceof URL)&&(input=fetch(input));const{instance,module}=await async function __wbg_load(module,imports){if("function"==typeof Response&&module instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(module,imports)}catch(e){if("application/wasm"==module.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const bytes=await module.arrayBuffer();return await WebAssembly.instantiate(bytes,imports)}{const instance=await WebAssembly.instantiate(module,imports);return instance instanceof WebAssembly.Instance?{instance,module}:instance}}(await input,imports);return function __wbg_finalize_init(instance,module){return wasm=instance.exports,__wbg_init.__wbindgen_wasm_module=module,cachedInt32Memory0=null,cachedUint8Memory0=null,wasm}(instance,module)}var GPUTextureUsage$1,GPUMapMode;function translateTextureFormat(format){if(format===Format.U8_R_NORM)return"r8unorm";if(format===Format.S8_R_NORM)return"r8snorm";if(format===Format.U8_RG_NORM)return"rg8unorm";if(format===Format.S8_RG_NORM)return"rg8snorm";if(format===Format.U32_R)return"r32uint";if(format===Format.S32_R)return"r32sint";if(format===Format.F32_R)return"r32float";if(format===Format.U16_RG)return"rg16uint";if(format===Format.S16_RG)return"rg16sint";if(format===Format.F16_RG)return"rg16float";if(format===Format.U8_RGBA_RT)return"bgra8unorm";if(format===Format.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(format===Format.U8_RGBA_NORM)return"rgba8unorm";if(format===Format.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(format===Format.S8_RGBA_NORM)return"rgba8snorm";if(format===Format.F32_RGB)return"rgb9e5ufloat";if(format===Format.U32_RG)return"rg32uint";if(format===Format.S32_RG)return"rg32sint";if(format===Format.F32_RG)return"rg32float";if(format===Format.U16_RGBA)return"rgba16uint";if(format===Format.S16_RGBA)return"rgba16sint";if(format===Format.F16_RGBA)return"rgba16float";if(format===Format.F32_RGBA)return"rgba32float";if(format===Format.U32_RGBA)return"rgba32uint";if(format===Format.S32_RGBA)return"rgba32sint";if(format===Format.D24)return"depth24plus";if(format===Format.D24_S8)return"depth24plus-stencil8";if(format===Format.D32F)return"depth32float";if(format===Format.D32F_S8)return"depth32float-stencil8";if(format===Format.BC1)return"bc1-rgba-unorm";if(format===Format.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(format===Format.BC2)return"bc2-rgba-unorm";if(format===Format.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(format===Format.BC3)return"bc3-rgba-unorm";if(format===Format.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(format===Format.BC4_SNORM)return"bc4-r-snorm";if(format===Format.BC4_UNORM)return"bc4-r-unorm";if(format===Format.BC5_SNORM)return"bc5-rg-snorm";if(format===Format.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function translateTextureViewDimension(dimension){if(dimension===TextureDimension.TEXTURE_2D)return"2d";if(dimension===TextureDimension.TEXTURE_CUBE_MAP)return"cube";if(dimension===TextureDimension.TEXTURE_2D_ARRAY)return"2d-array";if(dimension===TextureDimension.TEXTURE_3D)return"3d";throw new Error("whoops")}function translateAddressMode(wrapMode){if(wrapMode===AddressMode.CLAMP_TO_EDGE)return"clamp-to-edge";if(wrapMode===AddressMode.REPEAT)return"repeat";if(wrapMode===AddressMode.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function translateMinMagFilter(texFilter){if(texFilter===FilterMode.BILINEAR)return"linear";if(texFilter===FilterMode.POINT)return"nearest";throw new Error("whoops")}function translateMipFilter(mipmapFilter){if(mipmapFilter===MipmapFilterMode.LINEAR)return"linear";if(mipmapFilter===MipmapFilterMode.NEAREST)return"nearest";if(mipmapFilter===MipmapFilterMode.NO_MIP)return"nearest";throw new Error("whoops")}function getPlatformBuffer(buffer_){return buffer_.gpuBuffer}function translateQueryPoolType(type){if(type===QueryPoolType.OcclusionConservative)return"occlusion";throw new Error("whoops")}function translateTopology(topology){switch(topology){case PrimitiveTopology.TRIANGLES:return"triangle-list";case PrimitiveTopology.POINTS:return"point-list";case PrimitiveTopology.TRIANGLE_STRIP:return"triangle-strip";case PrimitiveTopology.LINES:return"line-list";case PrimitiveTopology.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function translateCullMode(cullMode){if(cullMode===CullMode.NONE)return"none";if(cullMode===CullMode.FRONT)return"front";if(cullMode===CullMode.BACK)return"back";throw new Error("whoops")}function translateFrontFace(frontFaceMode){if(frontFaceMode===FrontFace.CCW)return"ccw";if(frontFaceMode===FrontFace.CW)return"cw";throw new Error("whoops")}function translateBlendFactor(factor){if(factor===BlendFactor.ZERO)return"zero";if(factor===BlendFactor.ONE)return"one";if(factor===BlendFactor.SRC)return"src";if(factor===BlendFactor.ONE_MINUS_SRC)return"one-minus-src";if(factor===BlendFactor.DST)return"dst";if(factor===BlendFactor.ONE_MINUS_DST)return"one-minus-dst";if(factor===BlendFactor.SRC_ALPHA)return"src-alpha";if(factor===BlendFactor.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(factor===BlendFactor.DST_ALPHA)return"dst-alpha";if(factor===BlendFactor.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(factor===BlendFactor.CONST)return"constant";if(factor===BlendFactor.ONE_MINUS_CONSTANT)return"one-minus-constant";if(factor===BlendFactor.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function translateBlendMode(mode){if(mode===BlendMode.ADD)return"add";if(mode===BlendMode.SUBSTRACT)return"subtract";if(mode===BlendMode.REVERSE_SUBSTRACT)return"reverse-subtract";if(mode===BlendMode.MIN)return"min";if(mode===BlendMode.MAX)return"max";throw new Error("whoops")}function translateBlendComponent(ch){return{operation:translateBlendMode(ch.blendMode),srcFactor:translateBlendFactor(ch.blendSrcFactor),dstFactor:translateBlendFactor(ch.blendDstFactor)}}function blendComponentIsNil(ch){return ch.blendMode===BlendMode.ADD&&ch.blendSrcFactor===BlendFactor.ONE&&ch.blendDstFactor===BlendFactor.ZERO}function translateBlendState(attachmentState){return blendComponentIsNil(attachmentState.rgbBlendState)&&blendComponentIsNil(attachmentState.alphaBlendState)?void 0:{color:translateBlendComponent(attachmentState.rgbBlendState),alpha:translateBlendComponent(attachmentState.alphaBlendState)}}function translateTargets(colorAttachmentFormats,megaStateDescriptor){return megaStateDescriptor.attachmentsState.map((function(attachmentState,i){return function translateColorState(attachmentState,format){return{format:translateTextureFormat(format),blend:translateBlendState(attachmentState),writeMask:attachmentState.channelWriteMask}}(attachmentState,colorAttachmentFormats[i])}))}function translateCompareFunction(compareFunction){if(compareFunction===CompareFunction.NEVER)return"never";if(compareFunction===CompareFunction.LESS)return"less";if(compareFunction===CompareFunction.EQUAL)return"equal";if(compareFunction===CompareFunction.LEQUAL)return"less-equal";if(compareFunction===CompareFunction.GREATER)return"greater";if(compareFunction===CompareFunction.NOTEQUAL)return"not-equal";if(compareFunction===CompareFunction.GEQUAL)return"greater-equal";if(compareFunction===CompareFunction.ALWAYS)return"always";throw new Error("whoops")}function translateStencilOperation(stencilOp){if(stencilOp===StencilOp.KEEP)return"keep";if(stencilOp===StencilOp.REPLACE)return"replace";if(stencilOp===StencilOp.ZERO)return"zero";if(stencilOp===StencilOp.DECREMENT_CLAMP)return"decrement-clamp";if(stencilOp===StencilOp.DECREMENT_WRAP)return"decrement-wrap";if(stencilOp===StencilOp.INCREMENT_CLAMP)return"increment-clamp";if(stencilOp===StencilOp.INCREMENT_WRAP)return"increment-wrap";if(stencilOp===StencilOp.INVERT)return"invert";throw new Error("whoops")}function translateVertexStepMode(stepMode){if(stepMode===VertexStepMode.VERTEX)return"vertex";if(stepMode===VertexStepMode.INSTANCE)return"instance";throw new Error("whoops")}function translateVertexFormat(format){if(format===Format.U8_R)return"uint8x2";if(format===Format.U8_RG)return"uint8x2";if(format===Format.U8_RGB)return"uint8x4";if(format===Format.U8_RGBA)return"uint8x4";if(format===Format.U8_RG_NORM)return"unorm8x2";if(format===Format.U8_RGBA_NORM)return"unorm8x4";if(format===Format.S8_RGB_NORM)return"snorm8x4";if(format===Format.S8_RGBA_NORM)return"snorm8x4";if(format===Format.U16_RG_NORM)return"unorm16x2";if(format===Format.U16_RGBA_NORM)return"unorm16x4";if(format===Format.S16_RG_NORM)return"snorm16x2";if(format===Format.S16_RGBA_NORM)return"snorm16x4";if(format===Format.S16_RG)return"uint16x2";if(format===Format.F16_RG)return"float16x2";if(format===Format.F16_RGBA)return"float16x4";if(format===Format.F32_R)return"float32";if(format===Format.F32_RG)return"float32x2";if(format===Format.F32_RGB)return"float32x3";if(format===Format.F32_RGBA)return"float32x4";throw"whoops"}function allocateAndCopyTypedBuffer(type,sizeOrDstBuffer,sizeInBytes,copyBuffer){switch(void 0===sizeInBytes&&(sizeInBytes=!1),type){case Format.S8_R:case Format.S8_R_NORM:case Format.S8_RG_NORM:case Format.S8_RGB_NORM:case Format.S8_RGBA_NORM:var buffer_1=(ArrayBuffer,new Int8Array(sizeOrDstBuffer));return copyBuffer&&buffer_1.set(new Int8Array(copyBuffer)),buffer_1;case Format.U8_R:case Format.U8_R_NORM:case Format.U8_RG:case Format.U8_RG_NORM:case Format.U8_RGB:case Format.U8_RGB_NORM:case Format.U8_RGB_SRGB:case Format.U8_RGBA:case Format.U8_RGBA_NORM:case Format.U8_RGBA_SRGB:var buffer_2=(ArrayBuffer,new Uint8Array(sizeOrDstBuffer));return copyBuffer&&buffer_2.set(new Uint8Array(copyBuffer)),buffer_2;case Format.S16_R:case Format.S16_RG:case Format.S16_RG_NORM:case Format.S16_RGB_NORM:case Format.S16_RGBA:case Format.S16_RGBA_NORM:var buffer_3=sizeOrDstBuffer instanceof ArrayBuffer?new Int16Array(sizeOrDstBuffer):new Int16Array(sizeInBytes?sizeOrDstBuffer/2:sizeOrDstBuffer);return copyBuffer&&buffer_3.set(new Int16Array(copyBuffer)),buffer_3;case Format.U16_R:case Format.U16_RGB:case Format.U16_RGBA_5551:case Format.U16_RGBA_NORM:case Format.U16_RG_NORM:case Format.U16_R_NORM:var buffer_4=sizeOrDstBuffer instanceof ArrayBuffer?new Uint16Array(sizeOrDstBuffer):new Uint16Array(sizeInBytes?sizeOrDstBuffer/2:sizeOrDstBuffer);return copyBuffer&&buffer_4.set(new Uint16Array(copyBuffer)),buffer_4;case Format.S32_R:var buffer_5=sizeOrDstBuffer instanceof ArrayBuffer?new Int32Array(sizeOrDstBuffer):new Int32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);return copyBuffer&&buffer_5.set(new Int32Array(copyBuffer)),buffer_5;case Format.U32_R:case Format.U32_RG:var buffer_6=sizeOrDstBuffer instanceof ArrayBuffer?new Uint32Array(sizeOrDstBuffer):new Uint32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);return copyBuffer&&buffer_6.set(new Uint32Array(copyBuffer)),buffer_6;case Format.F32_R:case Format.F32_RG:case Format.F32_RGB:case Format.F32_RGBA:var buffer_7=sizeOrDstBuffer instanceof ArrayBuffer?new Float32Array(sizeOrDstBuffer):new Float32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);return copyBuffer&&buffer_7.set(new Float32Array(copyBuffer)),buffer_7}var buffer=(ArrayBuffer,new Uint8Array(sizeOrDstBuffer));return copyBuffer&&buffer.set(new Uint8Array(copyBuffer)),buffer}function getBlockInformationFromFormat(format){switch(format){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(GPUTextureUsage){GPUTextureUsage[GPUTextureUsage.COPY_SRC=1]="COPY_SRC",GPUTextureUsage[GPUTextureUsage.COPY_DST=2]="COPY_DST",GPUTextureUsage[GPUTextureUsage.TEXTURE_BINDING=4]="TEXTURE_BINDING",GPUTextureUsage[GPUTextureUsage.STORAGE_BINDING=8]="STORAGE_BINDING",GPUTextureUsage[GPUTextureUsage.STORAGE=8]="STORAGE",GPUTextureUsage[GPUTextureUsage.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(GPUTextureUsage$1||(GPUTextureUsage$1={})),function(GPUMapMode){GPUMapMode[GPUMapMode.READ=1]="READ",GPUMapMode[GPUMapMode.WRITE=2]="WRITE"}(GPUMapMode||(GPUMapMode={}));var ResourceBase_WebGPU=function(_super){function ResourceBase_WebGPU(_a){var id=_a.id,device=_a.device,_this=_super.call(this)||this;return _this.id=id,_this.device=device,_this}return(0,tslib_es6.C6)(ResourceBase_WebGPU,_super),ResourceBase_WebGPU.prototype.destroy=function(){},ResourceBase_WebGPU}(_antv_g_device_api_node_modules_eventemitter3),Bindings_WebGPU=function(_super){function Bindings_WebGPU(_a){var _b,_c,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Bindings;var pipeline=descriptor.pipeline;es_assert(!!pipeline);var uniformBufferBindings=descriptor.uniformBufferBindings,storageBufferBindings=descriptor.storageBufferBindings,samplerBindings=descriptor.samplerBindings,storageTextureBindings=descriptor.storageTextureBindings;_this.numUniformBuffers=(null==uniformBufferBindings?void 0:uniformBufferBindings.length)||0;var gpuBindGroupEntries=[[],[],[],[]],numBindings=0;if(uniformBufferBindings&&uniformBufferBindings.length)for(var i=0;i<uniformBufferBindings.length;i++){var _d=descriptor.uniformBufferBindings[i],binding=_d.binding,size=_d.size,offset=_d.offset,gpuBufferBinding={buffer:getPlatformBuffer(_d.buffer),offset:null!=offset?offset:0,size};gpuBindGroupEntries[0].push({binding:null!=binding?binding:numBindings++,resource:gpuBufferBinding})}if(samplerBindings&&samplerBindings.length){numBindings=0;for(i=0;i<samplerBindings.length;i++){var samplerEntry=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},samplerBindings[i]),defaultBindingLayoutSamplerDescriptor),texture=null!==(binding=descriptor.samplerBindings[i]).texture?binding.texture:_this.device.getFallbackTexture(samplerEntry);samplerEntry.dimension=texture.dimension,samplerEntry.formatKind=getFormatSamplerKind(texture.format);var gpuTextureView=texture.gpuTextureView;if(gpuBindGroupEntries[1].push({binding:null!==(_b=binding.textureBinding)&&void 0!==_b?_b:numBindings++,resource:gpuTextureView}),-1!==binding.samplerBinding){var sampler=null!==binding.sampler?binding.sampler:_this.device.getFallbackSampler(samplerEntry),gpuSampler=sampler.gpuSampler;gpuBindGroupEntries[1].push({binding:null!==(_c=binding.samplerBinding)&&void 0!==_c?_c:numBindings++,resource:gpuSampler})}}}if(storageBufferBindings&&storageBufferBindings.length){numBindings=0;for(i=0;i<storageBufferBindings.length;i++){var _e=descriptor.storageBufferBindings[i];binding=_e.binding,size=_e.size,offset=_e.offset,gpuBufferBinding={buffer:getPlatformBuffer(_e.buffer),offset:null!=offset?offset:0,size};gpuBindGroupEntries[2].push({binding:null!=binding?binding:numBindings++,resource:gpuBufferBinding})}}if(storageTextureBindings&&storageTextureBindings.length){numBindings=0;for(i=0;i<storageTextureBindings.length;i++){var _f=descriptor.storageTextureBindings[i];binding=_f.binding,gpuTextureView=(texture=_f.texture).gpuTextureView;gpuBindGroupEntries[3].push({binding:null!=binding?binding:numBindings++,resource:gpuTextureView})}}var lastGroupIndex=gpuBindGroupEntries.findLastIndex((function(group){return!!group.length}));return _this.gpuBindGroup=gpuBindGroupEntries.map((function(gpuBindGroupEntries,i){return i<=lastGroupIndex&&_this.device.device.createBindGroup({layout:pipeline.getBindGroupLayout(i),entries:gpuBindGroupEntries})})),_this}return(0,tslib_es6.C6)(Bindings_WebGPU,_super),Bindings_WebGPU}(ResourceBase_WebGPU),Buffer_WebGPU=function(_super){function Buffer_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Buffer;var usage=descriptor.usage,viewOrSize=descriptor.viewOrSize,useMapRead=!!(usage&BufferUsage.MAP_READ);_this.usage=function translateBufferUsage(usage_){var usage=0;return usage_&BufferUsage.INDEX&&(usage|=GPUBufferUsage.INDEX),usage_&BufferUsage.VERTEX&&(usage|=GPUBufferUsage.VERTEX),usage_&BufferUsage.UNIFORM&&(usage|=GPUBufferUsage.UNIFORM),usage_&BufferUsage.STORAGE&&(usage|=GPUBufferUsage.STORAGE),usage_&BufferUsage.COPY_SRC&&(usage|=GPUBufferUsage.COPY_SRC),usage_&BufferUsage.INDIRECT&&(usage|=GPUBufferUsage.INDIRECT),usage|GPUBufferUsage.COPY_DST}(usage),useMapRead&&(_this.usage=BufferUsage.MAP_READ|BufferUsage.COPY_DST);var mapBuffer=!(0,is_number.A)(viewOrSize);(_this.view=(0,is_number.A)(viewOrSize)?null:viewOrSize,_this.size=(0,is_number.A)(viewOrSize)?align(viewOrSize,4):align(viewOrSize.byteLength,4),(0,is_number.A)(viewOrSize))?_this.gpuBuffer=_this.device.device.createBuffer({usage:_this.usage,size:_this.size,mappedAtCreation:!!useMapRead&&mapBuffer}):(_this.gpuBuffer=_this.device.device.createBuffer({usage:_this.usage,size:_this.size,mappedAtCreation:!0}),new(viewOrSize&&viewOrSize.constructor||Float32Array)(_this.gpuBuffer.getMappedRange()).set(viewOrSize),_this.gpuBuffer.unmap());return _this}return(0,tslib_es6.C6)(Buffer_WebGPU,_super),Buffer_WebGPU.prototype.setSubData=function(dstByteOffset,src,srcByteOffset,byteLength){void 0===srcByteOffset&&(srcByteOffset=0),void 0===byteLength&&(byteLength=0);var buffer=this.gpuBuffer;byteLength=byteLength||src.byteLength,byteLength=Math.min(byteLength,this.size-dstByteOffset);var chunkStart=src.byteOffset+srcByteOffset,chunkEnd=chunkStart+byteLength,alignedLength=byteLength+3&-4;if(alignedLength!==byteLength){var tempView=new Uint8Array(src.buffer.slice(chunkStart,chunkEnd));(src=new Uint8Array(alignedLength)).set(tempView),srcByteOffset=0,chunkStart=0,chunkEnd=alignedLength,byteLength=alignedLength}for(var offset=0;chunkEnd-(chunkStart+offset)>15728640;)this.device.device.queue.writeBuffer(buffer,dstByteOffset+offset,src.buffer,chunkStart+offset,15728640),offset+=15728640;this.device.device.queue.writeBuffer(buffer,dstByteOffset+offset,src.buffer,chunkStart+offset,byteLength-offset)},Buffer_WebGPU.prototype.destroy=function(){_super.prototype.destroy.call(this),this.gpuBuffer.destroy()},Buffer_WebGPU}(ResourceBase_WebGPU),ComputePass_WebGPU=function(){function ComputePass_WebGPU(){this.gpuComputePassEncoder=null}return ComputePass_WebGPU.prototype.dispatchWorkgroups=function(workgroupCountX,workgroupCountY,workgroupCountZ){this.gpuComputePassEncoder.dispatchWorkgroups(workgroupCountX,workgroupCountY,workgroupCountZ)},ComputePass_WebGPU.prototype.dispatchWorkgroupsIndirect=function(indirectBuffer,indirectOffset){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(indirectBuffer.gpuBuffer,indirectOffset)},ComputePass_WebGPU.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},ComputePass_WebGPU.prototype.beginComputePass=function(commandEncoder){es_assert(null===this.gpuComputePassEncoder),this.frameCommandEncoder=commandEncoder,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},ComputePass_WebGPU.prototype.setPipeline=function(pipeline_){var gpuComputePipeline=assertExists(pipeline_.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(gpuComputePipeline)},ComputePass_WebGPU.prototype.setBindings=function(bindings_){var _this=this,bindings=bindings_;bindings.gpuBindGroup.forEach((function(gpuBindGroup,i){gpuBindGroup&&_this.gpuComputePassEncoder.setBindGroup(i,bindings.gpuBindGroup[i])}))},ComputePass_WebGPU.prototype.pushDebugGroup=function(name){this.gpuComputePassEncoder.pushDebugGroup(name)},ComputePass_WebGPU.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},ComputePass_WebGPU.prototype.insertDebugMarker=function(markerLabel){this.gpuComputePassEncoder.insertDebugMarker(markerLabel)},ComputePass_WebGPU}(),ComputePipeline_WebGPU=function(_super){function ComputePipeline_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.ComputePipeline,_this.gpuComputePipeline=null,_this.descriptor=descriptor;var computeStage=descriptor.program.computeStage;if(null===computeStage)return _this;var gpuComputePipeline={layout:"auto",compute:(0,tslib_es6.Cl)({},computeStage)};return _this.gpuComputePipeline=_this.device.device.createComputePipeline(gpuComputePipeline),void 0!==_this.name&&(_this.gpuComputePipeline.label=_this.name),_this}return(0,tslib_es6.C6)(ComputePipeline_WebGPU,_super),ComputePipeline_WebGPU.prototype.getBindGroupLayout=function(index){return this.gpuComputePipeline.getBindGroupLayout(index)},ComputePipeline_WebGPU}(ResourceBase_WebGPU),InputLayout_WebGPU=function(_super){function InputLayout_WebGPU(_a){var e_1,_b,e_2,_c,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.InputLayout;var buffers=[];try{for(var _d=(0,tslib_es6.Ju)(descriptor.vertexBufferDescriptors),_e=_d.next();!_e.done;_e=_d.next()){var vertexBufferDescriptor=_e.value,arrayStride=vertexBufferDescriptor.arrayStride,stepMode=vertexBufferDescriptor.stepMode,attributes=vertexBufferDescriptor.attributes;buffers.push({arrayStride,stepMode:translateVertexStepMode(stepMode),attributes:[]});try{for(var attributes_1=(e_2=void 0,(0,tslib_es6.Ju)(attributes)),attributes_1_1=attributes_1.next();!attributes_1_1.done;attributes_1_1=attributes_1.next()){var attribute=attributes_1_1.value,shaderLocation=attribute.shaderLocation,format=attribute.format,offset=attribute.offset;buffers[buffers.length-1].attributes.push({shaderLocation,format:translateVertexFormat(format),offset})}}catch(e_2_1){e_2={error:e_2_1}}finally{try{attributes_1_1&&!attributes_1_1.done&&(_c=attributes_1.return)&&_c.call(attributes_1)}finally{if(e_2)throw e_2.error}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_e&&!_e.done&&(_b=_d.return)&&_b.call(_d)}finally{if(e_1)throw e_1.error}}return _this.indexFormat=function translateIndexFormat(format){if(null!==format){if(format===Format.U16_R)return"uint16";if(format===Format.U32_R)return"uint32";throw new Error("whoops")}}(descriptor.indexBufferFormat),_this.buffers=buffers,_this}return(0,tslib_es6.C6)(InputLayout_WebGPU,_super),InputLayout_WebGPU}(ResourceBase_WebGPU),Program_WebGPU=function(_super){function Program_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.Program,_this.vertexStage=null,_this.fragmentStage=null,_this.computeStage=null,_this.descriptor=descriptor,descriptor.vertex&&(_this.vertexStage=_this.createShaderStage(descriptor.vertex,"vertex")),descriptor.fragment&&(_this.fragmentStage=_this.createShaderStage(descriptor.fragment,"fragment")),descriptor.compute&&(_this.computeStage=_this.createShaderStage(descriptor.compute,"compute")),_this}return(0,tslib_es6.C6)(Program_WebGPU,_super),Program_WebGPU.prototype.setUniformsLegacy=function(uniforms){},Program_WebGPU.prototype.createShaderStage=function(_a,shaderStage){var e_1,_b,glsl=_a.glsl,wgsl=_a.wgsl,entryPoint=_a.entryPoint,postprocess=_a.postprocess,code=wgsl;if(!code)try{code=this.device.glsl_compile(glsl,shaderStage,!1)}catch(e){throw console.error(e,glsl),new Error("whoops")}var _loop_1=function(depthTextureName){if(!code.includes(depthTextureName))return"continue";code=(code=code.replace("var T_".concat(depthTextureName,": texture_2d<f32>;"),"var T_".concat(depthTextureName,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(depthTextureName,"(.*)\\);$"),"gm"),(function(sub,cap){return"vec4<f32>(textureSample(T_".concat(depthTextureName).concat(cap,"), 0.0, 0.0, 0.0);")}))};try{for(var _c=(0,tslib_es6.Ju)(["u_TextureFramebufferDepth"]),_d=_c.next();!_d.done;_d=_c.next()){_loop_1(_d.value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_b=_c.return)&&_b.call(_c)}finally{if(e_1)throw e_1.error}}return postprocess&&(code=postprocess(code)),{module:this.device.device.createShaderModule({code}),entryPoint:entryPoint||"main"}},Program_WebGPU}(ResourceBase_WebGPU),QueryPool_WebGPU=function(_super){function QueryPool_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.QueryPool;var elemCount=descriptor.elemCount,type=descriptor.type;return _this.querySet=_this.device.device.createQuerySet({type:translateQueryPoolType(type),count:elemCount}),_this.resolveBuffer=_this.device.device.createBuffer({size:8*elemCount,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),_this.cpuBuffer=_this.device.device.createBuffer({size:8*elemCount,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),_this.results=null,_this}return(0,tslib_es6.C6)(QueryPool_WebGPU,_super),QueryPool_WebGPU.prototype.queryResultOcclusion=function(dstOffs){return null===this.results?null:this.results[dstOffs]!==BigInt(0)},QueryPool_WebGPU.prototype.destroy=function(){_super.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},QueryPool_WebGPU}(ResourceBase_WebGPU),Readback_WebGPU=function(_super){function Readback_WebGPU(_a){var id=_a.id,device=_a.device,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.Readback,_this}return(0,tslib_es6.C6)(Readback_WebGPU,_super),Readback_WebGPU.prototype.readTexture=function(t,x,y,width,height,dst,dstOffset,length){return void 0===dstOffset&&(dstOffset=0),(0,tslib_es6.sH)(this,void 0,void 0,(function(){var texture,blockInformation,bytesPerRow,bytesPerRowAligned,size,buffer,commandEncoder;return(0,tslib_es6.YH)(this,(function(_a){return 0,blockInformation=getBlockInformationFromFormat((texture=t).gpuTextureformat),bytesPerRow=Math.ceil(width/blockInformation.width)*blockInformation.length,bytesPerRowAligned=256*Math.ceil(bytesPerRow/256),size=bytesPerRowAligned*height,buffer=this.device.createBuffer({usage:BufferUsage.STORAGE|BufferUsage.MAP_READ|BufferUsage.COPY_DST,hint:BufferFrequencyHint.STATIC,viewOrSize:size}),(commandEncoder=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:texture.gpuTexture,mipLevel:0,origin:{x,y,z:Math.max(0,0)}},{buffer:buffer.gpuBuffer,offset:0,bytesPerRow:bytesPerRowAligned},{width,height,depthOrArrayLayers:1}),this.device.device.queue.submit([commandEncoder.finish()]),[2,this.readBuffer(buffer,0,dst.byteLength===size?dst:null,dstOffset,size,texture.format,!0,!1,bytesPerRow,bytesPerRowAligned,height)]}))}))},Readback_WebGPU.prototype.readTextureSync=function(t,x,y,width,height,dst,dstOffset,length){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},Readback_WebGPU.prototype.readBuffer=function(b,srcByteOffset,dstArrayBufferView,dstOffset,_size,type,noDataConversion,destroy,bytesPerRow,bytesPerRowAligned,height){var _this=this;void 0===srcByteOffset&&(srcByteOffset=0),void 0===dstArrayBufferView&&(dstArrayBufferView=null),void 0===_size&&(_size=0),void 0===type&&(type=Format.U8_RGB),void 0===noDataConversion&&(noDataConversion=!1),void 0===bytesPerRow&&(bytesPerRow=0),void 0===bytesPerRowAligned&&(bytesPerRowAligned=0),void 0===height&&(height=0);var buffer=b,size=_size||buffer.size,dst=dstArrayBufferView||buffer.view,floatFormat=dst&&dst.constructor&&dst.constructor.BYTES_PER_ELEMENT||getFormatCompByteSize(type),gpuReadBuffer=buffer;if(!(buffer.usage&BufferUsage.MAP_READ&&buffer.usage&BufferUsage.COPY_DST)){var commandEncoder=this.device.device.createCommandEncoder();gpuReadBuffer=this.device.createBuffer({usage:BufferUsage.STORAGE|BufferUsage.MAP_READ|BufferUsage.COPY_DST,hint:BufferFrequencyHint.STATIC,viewOrSize:size}),commandEncoder.copyBufferToBuffer(buffer.gpuBuffer,srcByteOffset,gpuReadBuffer.gpuBuffer,0,size),this.device.device.queue.submit([commandEncoder.finish()])}return new Promise((function(resolve,reject){gpuReadBuffer.gpuBuffer.mapAsync(GPUMapMode.READ,srcByteOffset,size).then((function(){var copyArrayBuffer=gpuReadBuffer.gpuBuffer.getMappedRange(srcByteOffset,size),data=dst;if(noDataConversion)data=null===data?allocateAndCopyTypedBuffer(type,size,!0,copyArrayBuffer):allocateAndCopyTypedBuffer(type,data.buffer,void 0,copyArrayBuffer);else if(null===data)switch(floatFormat){case 1:(data=new Uint8Array(size)).set(new Uint8Array(copyArrayBuffer));break;case 2:data=_this.getHalfFloatAsFloatRGBAArrayBuffer(size/2,copyArrayBuffer);break;case 4:(data=new Float32Array(size/4)).set(new Float32Array(copyArrayBuffer))}else switch(floatFormat){case 1:(data=new Uint8Array(data.buffer)).set(new Uint8Array(copyArrayBuffer));break;case 2:data=_this.getHalfFloatAsFloatRGBAArrayBuffer(size/2,copyArrayBuffer,dst);break;case 4:var ctor=dst&&dst.constructor||Float32Array;(data=new ctor(data.buffer)).set(new ctor(copyArrayBuffer))}if(bytesPerRow!==bytesPerRowAligned){1!==floatFormat||noDataConversion||(bytesPerRow*=2,bytesPerRowAligned*=2);for(var data2=new Uint8Array(data.buffer),offset=bytesPerRow,offset2=0,y=1;y<height;++y){offset2=y*bytesPerRowAligned;for(var x=0;x<bytesPerRow;++x)data2[offset++]=data2[offset2++]}data=0===floatFormat||noDataConversion?new Uint8Array(data2.buffer,0,offset):new Float32Array(data2.buffer,0,offset/4)}gpuReadBuffer.gpuBuffer.unmap(),resolve(data)}),(function(reason){return reject(reason)}))}))},Readback_WebGPU.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(dataLength,arrayBuffer,destArray){destArray||(destArray=new Float32Array(dataLength));for(var value,s,e,f,srcData=new Uint16Array(arrayBuffer);dataLength--;)destArray[dataLength]=(value=srcData[dataLength],s=void 0,e=void 0,f=void 0,s=(32768&value)>>15,f=1023&value,0===(e=(31744&value)>>10)?(s?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):31==e?f?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,e-15)*(1+f/Math.pow(2,10)));return destArray},Readback_WebGPU}(ResourceBase_WebGPU),RenderPass_WebGPU=function(){function RenderPass_WebGPU(device){this.device=device,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return RenderPass_WebGPU.prototype.getEncoder=function(){var _a;return(null===(_a=this.renderBundle)||void 0===_a?void 0:_a.renderBundleEncoder)||this.gpuRenderPassEncoder},RenderPass_WebGPU.prototype.getTextureView=function(target,level){return es_assert(level<target.mipLevelCount),1===target.mipLevelCount?target.gpuTextureView:target.gpuTexture.createView({baseMipLevel:level,mipLevelCount:1})},RenderPass_WebGPU.prototype.setRenderPassDescriptor=function(descriptor){var _a,_b,_c,_d,_e,_f;this.descriptor=descriptor,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var numColorAttachments=descriptor.colorAttachment.length;this.gfxColorAttachment.length=numColorAttachments,this.gfxColorResolveTo.length=numColorAttachments;for(var i=0;i<descriptor.colorAttachment.length;i++){var colorAttachment=descriptor.colorAttachment[i],colorResolveTo=descriptor.colorResolveTo[i];if(null===colorAttachment&&null!==colorResolveTo&&(colorAttachment=colorResolveTo,colorResolveTo=null),this.gfxColorAttachment[i]=colorAttachment,this.gfxColorResolveTo[i]=colorResolveTo,this.gfxColorAttachmentLevel[i]=(null===(_a=descriptor.colorAttachmentLevel)||void 0===_a?void 0:_a[i])||0,this.gfxColorResolveToLevel[i]=(null===(_b=descriptor.colorResolveToLevel)||void 0===_b?void 0:_b[i])||0,null===colorAttachment){this.gpuColorAttachments.length=i,this.gfxColorAttachment.length=i,this.gfxColorResolveTo.length=i;break}void 0===this.gpuColorAttachments[i]&&(this.gpuColorAttachments[i]={}),(dstAttachment=this.gpuColorAttachments[i]).view=this.getTextureView(colorAttachment,(null===(_c=this.gfxColorAttachmentLevel)||void 0===_c?void 0:_c[i])||0);var clearColor=null!==(_e=null===(_d=descriptor.colorClearColor)||void 0===_d?void 0:_d[i])&&void 0!==_e?_e:"load";"load"===clearColor?dstAttachment.loadOp="load":(dstAttachment.loadOp="clear",dstAttachment.clearValue=clearColor),dstAttachment.storeOp=(null===(_f=descriptor.colorStore)||void 0===_f?void 0:_f[i])?"store":"discard",dstAttachment.resolveTarget=void 0,null!==colorResolveTo&&(colorAttachment.sampleCount>1?dstAttachment.resolveTarget=this.getTextureView(colorResolveTo,this.gfxColorResolveToLevel[i]):dstAttachment.storeOp="store")}if(this.gfxDepthStencilAttachment=descriptor.depthStencilAttachment,this.gfxDepthStencilResolveTo=descriptor.depthStencilResolveTo,descriptor.depthStencilAttachment){var dstAttachment,dsAttachment=descriptor.depthStencilAttachment;(dstAttachment=this.gpuDepthStencilAttachment).view=dsAttachment.gpuTextureView,!!(getFormatFlags(dsAttachment.format)&FormatFlags.Depth)?("load"===descriptor.depthClearValue?dstAttachment.depthLoadOp="load":(dstAttachment.depthLoadOp="clear",dstAttachment.depthClearValue=descriptor.depthClearValue),descriptor.depthStencilStore||null!==this.gfxDepthStencilResolveTo?dstAttachment.depthStoreOp="store":dstAttachment.depthStoreOp="discard"):(dstAttachment.depthLoadOp=void 0,dstAttachment.depthStoreOp=void 0),!!(getFormatFlags(dsAttachment.format)&FormatFlags.Stencil)?("load"===descriptor.stencilClearValue?dstAttachment.stencilLoadOp="load":(dstAttachment.stencilLoadOp="clear",dstAttachment.stencilClearValue=descriptor.stencilClearValue),descriptor.depthStencilStore||null!==this.gfxDepthStencilResolveTo?dstAttachment.stencilStoreOp="store":dstAttachment.stencilStoreOp="discard"):(dstAttachment.stencilLoadOp=void 0,dstAttachment.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,is_nil.A)(descriptor.occlusionQueryPool)?void 0:function getPlatformQuerySet(queryPool_){return queryPool_.querySet}(descriptor.occlusionQueryPool)},RenderPass_WebGPU.prototype.beginRenderPass=function(commandEncoder,renderPassDescriptor){es_assert(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(renderPassDescriptor),this.frameCommandEncoder=commandEncoder,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},RenderPass_WebGPU.prototype.flipY=function(y,h){return this.device.swapChainHeight-y-h},RenderPass_WebGPU.prototype.setViewport=function(x,y,w,h,minDepth,maxDepth){void 0===minDepth&&(minDepth=0),void 0===maxDepth&&(maxDepth=1),this.gpuRenderPassEncoder.setViewport(x,this.flipY(y,h),w,h,minDepth,maxDepth)},RenderPass_WebGPU.prototype.setScissorRect=function(x,y,w,h){this.gpuRenderPassEncoder.setScissorRect(x,this.flipY(y,h),w,h)},RenderPass_WebGPU.prototype.setPipeline=function(pipeline_){var gpuRenderPipeline=assertExists(pipeline_.gpuRenderPipeline);this.getEncoder().setPipeline(gpuRenderPipeline)},RenderPass_WebGPU.prototype.setVertexInput=function(inputLayout_,vertexBuffers,indexBuffer){if(null!==inputLayout_){var encoder=this.getEncoder(),inputLayout=inputLayout_;null!==indexBuffer&&encoder.setIndexBuffer(getPlatformBuffer(indexBuffer.buffer),assertExists(inputLayout.indexFormat),indexBuffer.offset);for(var i=0;i<vertexBuffers.length;i++){var b=vertexBuffers[i];null!==b&&encoder.setVertexBuffer(i,getPlatformBuffer(b.buffer),b.offset)}}},RenderPass_WebGPU.prototype.setBindings=function(bindings_){var bindings=bindings_,encoder=this.getEncoder();bindings.gpuBindGroup.forEach((function(gpuBindGroup,i){gpuBindGroup&&encoder.setBindGroup(i,bindings.gpuBindGroup[i])}))},RenderPass_WebGPU.prototype.setStencilReference=function(ref){this.gpuRenderPassEncoder.setStencilReference(ref)},RenderPass_WebGPU.prototype.draw=function(vertexCount,instanceCount,firstVertex,firstInstance){this.getEncoder().draw(vertexCount,instanceCount,firstVertex,firstInstance)},RenderPass_WebGPU.prototype.drawIndexed=function(indexCount,instanceCount,firstIndex,baseVertex,firstInstance){this.getEncoder().drawIndexed(indexCount,instanceCount,firstIndex,baseVertex,firstInstance)},RenderPass_WebGPU.prototype.drawIndirect=function(indirectBuffer,indirectOffset){this.getEncoder().drawIndirect(getPlatformBuffer(indirectBuffer),indirectOffset)},RenderPass_WebGPU.prototype.drawIndexedIndirect=function(indirectBuffer,indirectOffset){this.getEncoder().drawIndexedIndirect(getPlatformBuffer(indirectBuffer),indirectOffset)},RenderPass_WebGPU.prototype.beginOcclusionQuery=function(queryIndex){this.gpuRenderPassEncoder.beginOcclusionQuery(queryIndex)},RenderPass_WebGPU.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},RenderPass_WebGPU.prototype.pushDebugGroup=function(name){this.gpuRenderPassEncoder.pushDebugGroup(name)},RenderPass_WebGPU.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},RenderPass_WebGPU.prototype.insertDebugMarker=function(markerLabel){this.gpuRenderPassEncoder.insertDebugMarker(markerLabel)},RenderPass_WebGPU.prototype.beginBundle=function(renderBundle){this.renderBundle=renderBundle},RenderPass_WebGPU.prototype.endBundle=function(){this.renderBundle.finish()},RenderPass_WebGPU.prototype.executeBundles=function(renderBundles){this.gpuRenderPassEncoder.executeBundles(renderBundles.map((function(bundle){return bundle.renderBundle})))},RenderPass_WebGPU.prototype.finish=function(){var _a;null===(_a=this.gpuRenderPassEncoder)||void 0===_a||_a.end(),this.gpuRenderPassEncoder=null;for(var i=0;i<this.gfxColorAttachment.length;i++){var colorAttachment=this.gfxColorAttachment[i],colorResolveTo=this.gfxColorResolveTo[i];null!==colorAttachment&&null!==colorResolveTo&&1===colorAttachment.sampleCount&&this.copyAttachment(colorResolveTo,this.gfxColorAttachmentLevel[i],colorAttachment,this.gfxColorResolveToLevel[i])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},RenderPass_WebGPU.prototype.copyAttachment=function(dst,dstLevel,src,srcLevel){es_assert(1===src.sampleCount);var srcCopy={texture:src.gpuTexture,mipLevel:srcLevel},dstCopy={texture:dst.gpuTexture,mipLevel:dstLevel};es_assert(src.width>>>srcLevel==dst.width>>>dstLevel),es_assert(src.height>>>srcLevel==dst.height>>>dstLevel),es_assert(!!(src.usage&GPUTextureUsage$1.COPY_SRC)),es_assert(!!(dst.usage&GPUTextureUsage$1.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(srcCopy,dstCopy,[dst.width,dst.height,1])},RenderPass_WebGPU}(),RenderPipeline_WebGPU=function(_super){function RenderPipeline_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.RenderPipeline,_this.isCreatingAsync=!1,_this.gpuRenderPipeline=null,_this.descriptor=descriptor,_this.device.createRenderPipelineInternal(_this,!1),_this}return(0,tslib_es6.C6)(RenderPipeline_WebGPU,_super),RenderPipeline_WebGPU.prototype.getBindGroupLayout=function(index){return this.gpuRenderPipeline.getBindGroupLayout(index)},RenderPipeline_WebGPU}(ResourceBase_WebGPU),Sampler_WebGPU=function(_super){function Sampler_WebGPU(_a){var _b,_c,id=_a.id,device=_a.device,descriptor=_a.descriptor,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Sampler;var lodMinClamp=descriptor.lodMinClamp,lodMaxClamp=descriptor.mipmapFilter===MipmapFilterMode.NO_MIP?descriptor.lodMinClamp:descriptor.lodMaxClamp,maxAnisotropy=null!==(_b=descriptor.maxAnisotropy)&&void 0!==_b?_b:1;return maxAnisotropy>1&&es_assert(descriptor.minFilter===FilterMode.BILINEAR&&descriptor.magFilter===FilterMode.BILINEAR&&descriptor.mipmapFilter===MipmapFilterMode.LINEAR),_this.gpuSampler=_this.device.device.createSampler({addressModeU:translateAddressMode(descriptor.addressModeU),addressModeV:translateAddressMode(descriptor.addressModeV),addressModeW:translateAddressMode(null!==(_c=descriptor.addressModeW)&&void 0!==_c?_c:descriptor.addressModeU),lodMinClamp,lodMaxClamp,minFilter:translateMinMagFilter(descriptor.minFilter),magFilter:translateMinMagFilter(descriptor.magFilter),mipmapFilter:translateMipFilter(descriptor.mipmapFilter),compare:void 0!==descriptor.compareFunction?translateCompareFunction(descriptor.compareFunction):void 0,maxAnisotropy}),_this}return(0,tslib_es6.C6)(Sampler_WebGPU,_super),Sampler_WebGPU}(ResourceBase_WebGPU),Texture_WebGPU=function(_super){function Texture_WebGPU(_a){var id=_a.id,device=_a.device,descriptor=_a.descriptor,skipCreate=_a.skipCreate,sampleCount=_a.sampleCount,_this=_super.call(this,{id,device})||this;_this.type=ResourceType.Texture,_this.flipY=!1;var format=descriptor.format,dimension=descriptor.dimension,width=descriptor.width,height=descriptor.height,depthOrArrayLayers=descriptor.depthOrArrayLayers,mipLevelCount=descriptor.mipLevelCount,usage=descriptor.usage,pixelStore=descriptor.pixelStore;return _this.flipY=!!(null==pixelStore?void 0:pixelStore.unpackFlipY),_this.device.createTextureShared({format,dimension:null!=dimension?dimension:TextureDimension.TEXTURE_2D,width,height,depthOrArrayLayers:null!=depthOrArrayLayers?depthOrArrayLayers:1,mipLevelCount:null!=mipLevelCount?mipLevelCount:1,usage,sampleCount:null!=sampleCount?sampleCount:1},_this,skipCreate),_this}return(0,tslib_es6.C6)(Texture_WebGPU,_super),Texture_WebGPU.prototype.textureFromImageBitmapOrCanvas=function(device,sources,depthOrArrayLayers){for(var width=sources[0].width,height=sources[0].height,textureDescriptor={size:{width,height,depthOrArrayLayers},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},texture=device.createTexture(textureDescriptor),i=0;i<sources.length;i++)device.queue.copyExternalImageToTexture({source:sources[i],flipY:this.flipY},{texture,origin:[0,0,i]},[width,height]);return[texture,width,height]},Texture_WebGPU.prototype.isImageBitmapOrCanvases=function(datas){var data=datas[0];return data instanceof ImageBitmap||data instanceof HTMLCanvasElement||data instanceof OffscreenCanvas},Texture_WebGPU.prototype.isVideo=function(datas){return datas[0]instanceof HTMLVideoElement},Texture_WebGPU.prototype.setImageData=function(datas,lod){var _a,texture,width,height,_this=this,device=this.device.device;if(this.isImageBitmapOrCanvases(datas))texture=(_a=(0,tslib_es6.zs)(this.textureFromImageBitmapOrCanvas(device,datas,this.depthOrArrayLayers),3))[0],width=_a[1],height=_a[2];else if(this.isVideo(datas))texture=device.importExternalTexture({source:datas[0]});else{var blockInformation=getBlockInformationFromFormat(this.gpuTextureformat),bytesPerRow_1=Math.ceil(this.width/blockInformation.width)*blockInformation.length;datas.forEach((function(data){device.queue.writeTexture({texture:_this.gpuTexture},data,{bytesPerRow:bytesPerRow_1},{width:_this.width,height:_this.height})}))}this.width=width,this.height=height,texture&&(this.gpuTexture=texture),this.gpuTextureView=this.gpuTexture.createView({dimension:translateTextureViewDimension(this.dimension)})},Texture_WebGPU.prototype.destroy=function(){_super.prototype.destroy.call(this),this.gpuTexture.destroy()},Texture_WebGPU}(ResourceBase_WebGPU),RenderBundle_WebGPU=function(_super){function RenderBundle_WebGPU(_a){var id=_a.id,device=_a.device,_this=_super.call(this,{id,device})||this;return _this.type=ResourceType.RenderBundle,_this.renderBundleEncoder=_this.device.device.createRenderBundleEncoder({colorFormats:[_this.device.swapChainFormat]}),_this}return(0,tslib_es6.C6)(RenderBundle_WebGPU,_super),RenderBundle_WebGPU.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},RenderBundle_WebGPU}(ResourceBase_WebGPU),Device_WebGPU=function(){function Device_WebGPU(adapter,device,canvas,canvasContext,glsl_compile,wGSLComposer){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=GPUTextureUsage$1.RENDER_ATTACHMENT|GPUTextureUsage$1.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=ViewportOrigin.UPPER_LEFT,this.clipSpaceNearZ=es_ClipSpaceNearZ.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=device,this.canvas=canvas,this.canvasContext=canvasContext,this.glsl_compile=glsl_compile,this.WGSLComposer=wGSLComposer,this.fallbackTexture2D=this.createFallbackTexture(TextureDimension.TEXTURE_2D,SamplerFormatKind.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(TextureDimension.TEXTURE_2D,SamplerFormatKind.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(TextureDimension.TEXTURE_2D_ARRAY,SamplerFormatKind.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(TextureDimension.TEXTURE_3D,SamplerFormatKind.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(TextureDimension.TEXTURE_CUBE_MAP,SamplerFormatKind.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:AddressMode.REPEAT,addressModeV:AddressMode.REPEAT,minFilter:FilterMode.POINT,magFilter:FilterMode.POINT,mipmapFilter:MipmapFilterMode.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:AddressMode.REPEAT,addressModeV:AddressMode.REPEAT,minFilter:FilterMode.POINT,magFilter:FilterMode.POINT,mipmapFilter:MipmapFilterMode.NEAREST,compareFunction:CompareFunction.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(event){console.error(event.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return Device_WebGPU.prototype.destroy=function(){},Device_WebGPU.prototype.configureSwapChain=function(width,height){this.swapChainWidth===width&&this.swapChainHeight===height||(this.swapChainWidth=width,this.swapChainHeight=height)},Device_WebGPU.prototype.getOnscreenTexture=function(){var gpuTexture=this.canvasContext.getCurrentTexture(),gpuTextureView=gpuTexture.createView(),texture=new Texture_WebGPU({id:0,device:this,descriptor:{format:Format.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:TextureDimension.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return texture.depthOrArrayLayers=1,texture.sampleCount=1,texture.gpuTexture=gpuTexture,texture.gpuTextureView=gpuTextureView,texture.name="Onscreen",this.setResourceName(texture,"Onscreen Texture"),texture},Device_WebGPU.prototype.getDevice=function(){return this},Device_WebGPU.prototype.getCanvas=function(){return this.canvas},Device_WebGPU.prototype.beginFrame=function(){es_assert(0===this.frameCommandEncoderPool.length)},Device_WebGPU.prototype.endFrame=function(){es_assert(this.frameCommandEncoderPool.every((function(frameCommandEncoder){return null!==frameCommandEncoder}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(frameCommandEncoder){return frameCommandEncoder.finish()}))),this.frameCommandEncoderPool=[]},Device_WebGPU.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},Device_WebGPU.prototype.createBuffer=function(descriptor){return new Buffer_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createTexture=function(descriptor){return new Texture_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createSampler=function(descriptor){return new Sampler_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createRenderTarget=function(descriptor){var texture=new Texture_WebGPU({id:this.getNextUniqueId(),device:this,descriptor:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},descriptor),{dimension:TextureDimension.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:TextureUsage.RENDER_TARGET}),sampleCount:descriptor.sampleCount});return texture.depthOrArrayLayers=1,texture.type=ResourceType.RenderTarget,texture},Device_WebGPU.prototype.createRenderTargetFromTexture=function(texture){var _a=texture,format=_a.format,width=_a.width,height=_a.height,depthOrArrayLayers=_a.depthOrArrayLayers,sampleCount=_a.sampleCount,mipLevelCount=_a.mipLevelCount,gpuTexture=_a.gpuTexture,gpuTextureView=_a.gpuTextureView,usage=_a.usage;es_assert(!!(usage&GPUTextureUsage$1.RENDER_ATTACHMENT));var attachment=new Texture_WebGPU({id:this.getNextUniqueId(),device:this,descriptor:{format,width,height,depthOrArrayLayers,dimension:TextureDimension.TEXTURE_2D,mipLevelCount,usage},skipCreate:!0});return attachment.depthOrArrayLayers=depthOrArrayLayers,attachment.sampleCount=sampleCount,attachment.gpuTexture=gpuTexture,attachment.gpuTextureView=gpuTextureView,attachment},Device_WebGPU.prototype.createProgram=function(descriptor){var _a,_b;return(null===(_a=descriptor.vertex)||void 0===_a?void 0:_a.glsl)&&(descriptor.vertex.glsl=preprocessShader_GLSL(this.queryVendorInfo(),"vert",descriptor.vertex.glsl)),(null===(_b=descriptor.fragment)||void 0===_b?void 0:_b.glsl)&&(descriptor.fragment.glsl=preprocessShader_GLSL(this.queryVendorInfo(),"frag",descriptor.fragment.glsl)),new Program_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createProgramSimple=function(descriptor){return new Program_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createTextureShared=function(descriptor,texture,skipCreate){var size={width:descriptor.width,height:descriptor.height,depthOrArrayLayers:descriptor.depthOrArrayLayers},mipLevelCount=descriptor.mipLevelCount,format=translateTextureFormat(descriptor.format),dimension=function translateTextureDimension(dimension){if(dimension===TextureDimension.TEXTURE_2D)return"2d";if(dimension===TextureDimension.TEXTURE_CUBE_MAP)return"2d";if(dimension===TextureDimension.TEXTURE_2D_ARRAY)return"2d";if(dimension===TextureDimension.TEXTURE_3D)return"3d";throw new Error("whoops")}(descriptor.dimension),usage=function translateTextureUsage(usage){var gpuUsage=0;return usage&TextureUsage.SAMPLED&&(gpuUsage|=GPUTextureUsage$1.TEXTURE_BINDING|GPUTextureUsage$1.COPY_DST|GPUTextureUsage$1.COPY_SRC),usage&TextureUsage.STORAGE&&(gpuUsage|=GPUTextureUsage$1.TEXTURE_BINDING|GPUTextureUsage$1.STORAGE_BINDING|GPUTextureUsage$1.COPY_SRC|GPUTextureUsage$1.COPY_DST),usage&TextureUsage.RENDER_TARGET&&(gpuUsage|=GPUTextureUsage$1.RENDER_ATTACHMENT|GPUTextureUsage$1.TEXTURE_BINDING|GPUTextureUsage$1.COPY_SRC|GPUTextureUsage$1.COPY_DST),gpuUsage}(descriptor.usage);if(texture.gpuTextureformat=format,texture.dimension=descriptor.dimension,texture.format=descriptor.format,texture.width=descriptor.width,texture.height=descriptor.height,texture.depthOrArrayLayers=descriptor.depthOrArrayLayers,texture.mipLevelCount=mipLevelCount,texture.usage=usage,texture.sampleCount=descriptor.sampleCount,!skipCreate){var gpuTexture=this.device.createTexture({size,mipLevelCount,format,dimension,sampleCount:descriptor.sampleCount,usage}),gpuTextureView=gpuTexture.createView();texture.gpuTexture=gpuTexture,texture.gpuTextureView=gpuTextureView}},Device_WebGPU.prototype.getFallbackSampler=function(samplerEntry){return samplerEntry.formatKind===SamplerFormatKind.Depth&&samplerEntry.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},Device_WebGPU.prototype.getFallbackTexture=function(samplerEntry){var dimension=samplerEntry.dimension,formatKind=samplerEntry.formatKind;if(dimension===TextureDimension.TEXTURE_2D)return formatKind===SamplerFormatKind.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(dimension===TextureDimension.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(dimension===TextureDimension.TEXTURE_3D)return this.fallbackTexture3D;if(dimension===TextureDimension.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},Device_WebGPU.prototype.createFallbackTexture=function(dimension,formatKind){var depthOrArrayLayers=dimension===TextureDimension.TEXTURE_CUBE_MAP?6:1,format=formatKind===SamplerFormatKind.Float?Format.U8_RGBA_NORM:Format.D24;return this.createTexture({dimension,format,usage:TextureUsage.SAMPLED,width:1,height:1,depthOrArrayLayers,mipLevelCount:1})},Device_WebGPU.prototype.createBindings=function(descriptor){return new Bindings_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createInputLayout=function(descriptor){return new InputLayout_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createComputePipeline=function(descriptor){return new ComputePipeline_WebGPU({id:this.getNextUniqueId(),device:this,descriptor})},Device_WebGPU.prototype.createRenderPipeline=function(descriptor){return new RenderPipeline_WebGPU({id:this.getNextUniqueId(),device:this,descriptor:(0,tslib_es6.Cl)({},descriptor)})},Device_WebGPU.prototype.createQueryPool=function(type,elemCount){return new QueryPool_WebGPU({id:this.getNextUniqueId(),device:this,descriptor:{type,elemCount}})},Device_WebGPU.prototype.createRenderPipelineInternal=function(renderPipeline,async){var _a;if(null===renderPipeline.gpuRenderPipeline){var descriptor=renderPipeline.descriptor,program=descriptor.program,vertexStage=program.vertexStage,fragmentStage=program.fragmentStage;if(null!==vertexStage&&null!==fragmentStage){var _b=descriptor.megaStateDescriptor||{},stencilBack=_b.stencilBack,stencilFront=_b.stencilFront,rest=(0,tslib_es6.Tt)(_b,["stencilBack","stencilFront"]),copied=copyMegaState(defaultMegaState);descriptor.megaStateDescriptor=(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},copied),{stencilBack:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},copied.stencilBack),stencilBack),stencilFront:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},copied.stencilFront),stencilFront)}),rest);var defaultAttachmentState=descriptor.megaStateDescriptor.attachmentsState[0];descriptor.colorAttachmentFormats.forEach((function(format,i){descriptor.megaStateDescriptor.attachmentsState[i]||(descriptor.megaStateDescriptor.attachmentsState[i]=copyAttachmentState(void 0,defaultAttachmentState))}));var primitive=function translatePrimitiveState(topology,megaStateDescriptor){return{topology:translateTopology(topology),cullMode:translateCullMode(megaStateDescriptor.cullMode),frontFace:translateFrontFace(megaStateDescriptor.frontFace)}}(null!==(_a=descriptor.topology)&&void 0!==_a?_a:PrimitiveTopology.TRIANGLES,descriptor.megaStateDescriptor),targets=translateTargets(descriptor.colorAttachmentFormats,descriptor.megaStateDescriptor),depthStencil=function translateDepthStencilState(format,megaStateDescriptor){if(!(0,is_nil.A)(format))return{format:translateTextureFormat(format),depthWriteEnabled:!!megaStateDescriptor.depthWrite,depthCompare:translateCompareFunction(megaStateDescriptor.depthCompare),depthBias:megaStateDescriptor.polygonOffset?1:0,depthBiasSlopeScale:megaStateDescriptor.polygonOffset?1:0,stencilFront:{compare:translateCompareFunction(megaStateDescriptor.stencilFront.compare),passOp:translateStencilOperation(megaStateDescriptor.stencilFront.passOp),failOp:translateStencilOperation(megaStateDescriptor.stencilFront.failOp),depthFailOp:translateStencilOperation(megaStateDescriptor.stencilFront.depthFailOp)},stencilBack:{compare:translateCompareFunction(megaStateDescriptor.stencilBack.compare),passOp:translateStencilOperation(megaStateDescriptor.stencilBack.passOp),failOp:translateStencilOperation(megaStateDescriptor.stencilBack.failOp),depthFailOp:translateStencilOperation(megaStateDescriptor.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}(descriptor.depthStencilAttachmentFormat,descriptor.megaStateDescriptor),buffers=void 0;null!==descriptor.inputLayout&&(buffers=descriptor.inputLayout.buffers);var sampleCount=descriptor.sampleCount,gpuRenderPipelineDescriptor={layout:"auto",vertex:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},vertexStage),{buffers}),primitive,depthStencil,multisample:{count:sampleCount},fragment:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},fragmentStage),{targets})};renderPipeline.gpuRenderPipeline=this.device.createRenderPipeline(gpuRenderPipelineDescriptor)}}},Device_WebGPU.prototype.createReadback=function(){return new Readback_WebGPU({id:this.getNextUniqueId(),device:this})},Device_WebGPU.prototype.createRenderBundle=function(){return new RenderBundle_WebGPU({id:this.getNextUniqueId(),device:this})},Device_WebGPU.prototype.createRenderPass=function(renderPassDescriptor){var pass=this.renderPassPool.pop();void 0===pass&&(pass=new RenderPass_WebGPU(this));var frameCommandEncoder=this.frameCommandEncoderPool.pop();return void 0===frameCommandEncoder&&(frameCommandEncoder=this.device.createCommandEncoder()),pass.beginRenderPass(frameCommandEncoder,renderPassDescriptor),pass},Device_WebGPU.prototype.createComputePass=function(){var pass=this.computePassPool.pop();void 0===pass&&(pass=new ComputePass_WebGPU);var frameCommandEncoder=this.frameCommandEncoderPool.pop();return void 0===frameCommandEncoder&&(frameCommandEncoder=this.device.createCommandEncoder()),pass.beginComputePass(frameCommandEncoder),pass},Device_WebGPU.prototype.submitPass=function(_pass){var pass=_pass;pass instanceof RenderPass_WebGPU?(this.frameCommandEncoderPool.push(pass.frameCommandEncoder),pass.finish(),this.renderPassPool.push(pass)):pass instanceof ComputePass_WebGPU&&(this.frameCommandEncoderPool.push(pass.frameCommandEncoder),pass.finish(),this.computePassPool.push(pass))},Device_WebGPU.prototype.copySubTexture2D=function(dst_,dstX,dstY,src_,srcX,srcY,depthOrArrayLayers){var cmd=this.device.createCommandEncoder(),dst=dst_,src=src_,srcCopy={texture:src.gpuTexture,origin:[srcX,srcY,0],mipLevel:0,aspect:"all"},dstCopy={texture:dst.gpuTexture,origin:[dstX,dstY,0],mipLevel:0,aspect:"all"};es_assert(!!(src.usage&GPUTextureUsage$1.COPY_SRC)),es_assert(!!(dst.usage&GPUTextureUsage$1.COPY_DST)),cmd.copyTextureToTexture(srcCopy,dstCopy,[src.width,src.height,depthOrArrayLayers||1]),this.device.queue.submit([cmd.finish()])},Device_WebGPU.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},Device_WebGPU.prototype.queryTextureFormatSupported=function(format,width,height){if(function isFormatTextureCompressionBC(format){switch(getFormatTypeFlags(format)){case FormatTypeFlags.BC1:case FormatTypeFlags.BC2:case FormatTypeFlags.BC3:case FormatTypeFlags.BC4_SNORM:case FormatTypeFlags.BC4_UNORM:case FormatTypeFlags.BC5_SNORM:case FormatTypeFlags.BC5_UNORM:return!0;default:return!1}}(format)){if(!this.featureTextureCompressionBC)return!1;var bb=function getFormatBlockSize(format){switch(getFormatTypeFlags(format)){case FormatTypeFlags.BC1:case FormatTypeFlags.BC2:case FormatTypeFlags.BC3:case FormatTypeFlags.BC4_SNORM:case FormatTypeFlags.BC4_UNORM:case FormatTypeFlags.BC5_SNORM:case FormatTypeFlags.BC5_UNORM:return 4;default:return 1}}(format);return width%bb==0&&height%bb==0&&this.featureTextureCompressionBC}switch(format){case Format.U16_RGBA_NORM:case Format.F32_RGBA:return!1}return!0},Device_WebGPU.prototype.queryPlatformAvailable=function(){return!0},Device_WebGPU.prototype.queryVendorInfo=function(){return this},Device_WebGPU.prototype.queryRenderPass=function(o){return o.descriptor},Device_WebGPU.prototype.queryRenderTarget=function(o){return o},Device_WebGPU.prototype.setResourceName=function(o,s){if(o.name=s,o.type===ResourceType.Buffer)(r=o).gpuBuffer.label=s;else if(o.type===ResourceType.Texture){(r=o).gpuTexture.label=s,r.gpuTextureView.label=s}else if(o.type===ResourceType.RenderTarget){(r=o).gpuTexture.label=s,r.gpuTextureView.label=s}else if(o.type===ResourceType.Sampler){(r=o).gpuSampler.label=s}else if(o.type===ResourceType.RenderPipeline){var r;null!==(r=o).gpuRenderPipeline&&(r.gpuRenderPipeline.label=s)}},Device_WebGPU.prototype.setResourceLeakCheck=function(o,v){},Device_WebGPU.prototype.checkForLeaks=function(){},Device_WebGPU.prototype.programPatched=function(o){},Device_WebGPU.prototype.pipelineQueryReady=function(o){return null!==o.gpuRenderPipeline},Device_WebGPU.prototype.pipelineForceReady=function(o){var renderPipeline=o;this.createRenderPipelineInternal(renderPipeline,!1)},Device_WebGPU}(),g_plugin_device_renderer_node_modules_eventemitter3=(function(){function WebGPUDeviceContribution(pluginOptions){this.pluginOptions=pluginOptions}WebGPUDeviceContribution.prototype.createSwapChain=function($canvas){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var adapter,xrCompatible,e_1,requiredFeatures,device,onContextLost_1,context;return(0,tslib_es6.YH)(this,(function(_a){switch(_a.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];adapter=null,_a.label=1;case 1:return _a.trys.push([1,3,,4]),xrCompatible=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible})];case 2:return adapter=_a.sent(),[3,4];case 3:return e_1=_a.sent(),console.log(e_1),[3,4];case 4:return null===adapter?[2,null]:(requiredFeatures=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(feature){return adapter.features.has(feature)})),[4,adapter.requestDevice({requiredFeatures})]);case 5:if((device=_a.sent())&&(onContextLost_1=this.pluginOptions.onContextLost,device.lost.then((function(){onContextLost_1&&onContextLost_1()}))),null===device)return[2,null];if(!(context=$canvas.getContext("webgpu")))return[2,null];_a.label=6;case 6:return _a.trys.push([6,8,,9]),[4,__wbg_init(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return _a.sent(),[3,9];case 9:return[2,new Device_WebGPU(adapter,device,$canvas,context,glsl_compile,WGSLComposer&&new WGSLComposer)]}}))}))}}(),__webpack_require__("./node_modules/@antv/g-plugin-device-renderer/node_modules/eventemitter3/index.js"));const _antv_g_plugin_device_renderer_node_modules_eventemitter3=__webpack_require__.n(g_plugin_device_renderer_node_modules_eventemitter3)();var earcut=__webpack_require__("./node_modules/earcut/src/earcut.js"),earcut_default=__webpack_require__.n(earcut),Renderable3D=function(){function Renderable3D(){this.drawcalls=[]}return Renderable3D.tag="c-renderable-3d",Renderable3D}(),LightPool=function(){function LightPool(){this.lights=[]}return LightPool.prototype.addLight=function(light){this.lights.push(light),this.sortLights()},LightPool.prototype.removeLight=function(light){var i=this.lights.indexOf(light);this.lights.splice(i,1),this.sortLights()},LightPool.prototype.addFog=function(fog){this.fog=fog},LightPool.prototype.removeFog=function(fog){this.fog=null},LightPool.prototype.getFog=function(){return this.fog},LightPool.prototype.getAllLights=function(){return this.lights},LightPool.prototype.getDefines=function(){var defines={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(light){defines[light.define]||(defines[light.define]=0),defines[light.define]++})),defines},LightPool.prototype.sortLights=function(){this.lights.sort((function(a,b){return a.order-b.order}))},LightPool}(),Mesh=function(_super){function Mesh(_a){var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,(0,tslib_es6.Cl)({type:Shape.MESH,style:(0,tslib_es6.Cl)({x:"",y:"",z:"",lineWidth:0,anchor:[.5,.5,.5]},style)},rest))||this).cullable.enable=!1,_this.style.geometry.meshes.push(_this),_this.style.material.meshes.push(_this),_this}return(0,tslib_es6.C6)(Mesh,_super),Mesh.prototype.destroy=function(){_super.prototype.destroy.call(this);var meshes=this.style.geometry.meshes,index=meshes.indexOf(this);meshes.splice(index,1),index=(meshes=this.style.material.meshes).indexOf(this),meshes.splice(index,1)},Mesh}(DisplayObject),MeshUpdater=function(){function MeshUpdater(){}return MeshUpdater.prototype.update=function(parsedStyle){var aabb=parsedStyle.geometry.computeBoundingBox(),max=aabb.getMax(),min=aabb.getMin();return{width:max[0]-min[0],height:max[1]-min[1],depth:max[2]-min[2]}},MeshUpdater}(),PickingIdGenerator=function(){function PickingIdGenerator(){this.counter=0,this.id2DisplayObjectMap={}}return PickingIdGenerator.prototype.getId=function(displayObject){var id=this.counter++;return this.id2DisplayObjectMap[id]=displayObject,id},PickingIdGenerator.prototype.getById=function(id){return this.id2DisplayObjectMap[id]},PickingIdGenerator.prototype.deleteById=function(id){delete this.id2DisplayObjectMap[id]},PickingIdGenerator.prototype.reset=function(){this.counter=0,this.id2DisplayObjectMap={}},PickingIdGenerator.prototype.decodePickingColor=function(color){var _a=(0,tslib_es6.zs)(color,3);return _a[0]+256*_a[1]+65536*_a[2]-1},PickingIdGenerator.prototype.encodePickingColor=function(featureIdx){return[featureIdx+1&255,featureIdx+1>>8&255,featureIdx+1>>8>>8&255]},PickingIdGenerator}(),DeviceProgram=function(){function DeviceProgram(){this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={}}return DeviceProgram.prototype.definesChanged=function(){this.preprocessedVert="",this.preprocessedFrag=""},DeviceProgram.prototype.setDefineString=function(name,v){if(null!==v){if(this.defines[name]===v)return!1;this.defines[name]=v}else{if((0,is_nil.A)(this.defines[name]))return!1;delete this.defines[name]}return this.definesChanged(),!0},DeviceProgram.prototype.setDefineBool=function(name,v){return this.setDefineString(name,v?"1":null)},DeviceProgram.prototype.getDefineString=function(name){return nullify(this.defines[name])},DeviceProgram.prototype.getDefineBool=function(name){var str=this.getDefineString(name);return null!==str&&es_assert("1"===str),null!==str},DeviceProgram}(),DynamicUniformBuffer=function(){function DynamicUniformBuffer(device){this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=device;var limits=device.queryLimits();this.uniformBufferWordAlignment=limits.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=limits.uniformBufferMaxPageWordSize}return DynamicUniformBuffer.prototype.isSupportedUBO=function(){return"WebGL1"!==this.device.queryVendorInfo().platformString},DynamicUniformBuffer.prototype.findPageIndex=function(wordOffset){return wordOffset/this.uniformBufferMaxPageWordSize|0},DynamicUniformBuffer.prototype.allocateChunk=function(wordCount){es_assert((wordCount=alignNonPowerOfTwo(wordCount,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var wordOffset=this.currentWordOffset;return this.findPageIndex(wordOffset)!==this.findPageIndex(wordOffset+wordCount-1)&&(wordOffset=alignNonPowerOfTwo(wordOffset,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=wordOffset+wordCount,this.ensureShadowBuffer(wordOffset,wordCount),wordOffset},DynamicUniformBuffer.prototype.ensureShadowBuffer=function(wordOffset,wordCount){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var newWordCount=alignNonPowerOfTwo(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*newWordCount),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(wordOffset+wordCount>=this.shadowBufferF32.length){es_assert(wordOffset<this.currentWordOffset&&wordOffset+wordCount<=this.currentWordOffset);newWordCount=alignNonPowerOfTwo(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize);var newBuffer=new Uint8Array(4*newWordCount);if(newBuffer.set(this.shadowBufferU8,0),this.shadowBufferU8=newBuffer,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=newWordCount))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(newWordCount,"]"))}},DynamicUniformBuffer.prototype.mapBufferF32=function(){return assertExists(this.shadowBufferF32)},DynamicUniformBuffer.prototype.prepareToRender=function(){if(null!==this.shadowBufferF32){var shadowBufferF32=assertExists(this.shadowBufferF32);shadowBufferF32.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=shadowBufferF32.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:BufferUsage.UNIFORM,hint:BufferFrequencyHint.DYNAMIC}));var wordCount=alignNonPowerOfTwo(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(wordCount<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(wordCount,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())assertExists(this.buffer).setSubData(0,this.shadowBufferU8,0,4*wordCount);this.currentWordOffset=0}},DynamicUniformBuffer.prototype.destroy=function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null},DynamicUniformBuffer}();function hashCodeNumberUpdate(hash,v){return hash+=v,hash+=hash<<10,(hash+=hash>>>6)>>>0}function hashCodeNumberFinish(hash){return hash+=hash<<3,hash^=hash>>>11,(hash+=hash<<15)>>>0}function nullHashFunc(k){return 0}var HashBucket=function HashBucket(){this.keys=[],this.values=[]},HashMap=function(){function HashMap(keyEqualFunc,keyHashFunc){this.keyEqualFunc=keyEqualFunc,this.keyHashFunc=keyHashFunc,this.buckets=new Map}return HashMap.prototype.findBucketIndex=function(bucket,k){for(var i=0;i<bucket.keys.length;i++)if(this.keyEqualFunc(k,bucket.keys[i]))return i;return-1},HashMap.prototype.findBucket=function(k){var bw=this.keyHashFunc(k);return this.buckets.get(bw)},HashMap.prototype.get=function(k){var bucket=this.findBucket(k);if(void 0===bucket)return null;var bi=this.findBucketIndex(bucket,k);return bi<0?null:bucket.values[bi]},HashMap.prototype.add=function(k,v){var bw=this.keyHashFunc(k);void 0===this.buckets.get(bw)&&this.buckets.set(bw,new HashBucket);var bucket=this.buckets.get(bw);bucket.keys.push(k),bucket.values.push(v)},HashMap.prototype.delete=function(k){var bucket=this.findBucket(k);if(void 0!==bucket){var bi=this.findBucketIndex(bucket,k);-1!==bi&&(bucket.keys.splice(bi,1),bucket.values.splice(bi,1))}},HashMap.prototype.clear=function(){this.buckets.clear()},HashMap.prototype.size=function(){var e_1,_a,acc=0;try{for(var _b=(0,tslib_es6.Ju)(this.buckets.values()),_c=_b.next();!_c.done;_c=_b.next()){acc+=_c.value.values.length}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return acc},HashMap.prototype.values=function(){var _a,_b,bucket,j,e_2_1,e_2,_c;return(0,tslib_es6.YH)(this,(function(_d){switch(_d.label){case 0:_d.trys.push([0,7,8,9]),_a=(0,tslib_es6.Ju)(this.buckets.values()),_b=_a.next(),_d.label=1;case 1:if(_b.done)return[3,6];bucket=_b.value,j=bucket.values.length-1,_d.label=2;case 2:return j>=0?[4,bucket.values[j]]:[3,5];case 3:_d.sent(),_d.label=4;case 4:return j--,[3,2];case 5:return _b=_a.next(),[3,1];case 6:return[3,9];case 7:return e_2_1=_d.sent(),e_2={error:e_2_1},[3,9];case 8:try{_b&&!_b.done&&(_c=_a.return)&&_c.call(_a)}finally{if(e_2)throw e_2.error}return[7];case 9:return[2]}}))},HashMap}();function preprocessProgramObj_GLSL(device,obj){var defines=void 0!==obj.defines?obj.defines:null,vert=void 0!==obj.both?obj.both+obj.vert:obj.vert,frag=void 0!==obj.both?obj.both+obj.frag:obj.frag;return function preprocessProgram_GLSL(vendorInfo,vert,frag,defines){return void 0===defines&&(defines=null),{vert,frag,preprocessedVert:preprocessShader_GLSL(vendorInfo,"vert",vert,defines),preprocessedFrag:preprocessShader_GLSL(vendorInfo,"frag",frag,defines)}}(device.queryVendorInfo(),vert,frag,defines)}function programDescriptorSimpleEquals(a,b){return es_assert(""!==a.preprocessedVert&&""!==b.preprocessedVert),es_assert(""!==a.preprocessedFrag&&""!==b.preprocessedFrag),a.preprocessedVert===b.preprocessedVert&&a.preprocessedFrag===b.preprocessedFrag}function blendStateHash(hash,a){return hash=hashCodeNumberUpdate(hash,a.blendMode),hash=hashCodeNumberUpdate(hash,a.blendSrcFactor),hash=hashCodeNumberUpdate(hash,a.blendDstFactor)}function attachmentStateHash(hash,a){return hash=blendStateHash(hash,a.rgbBlendState),hash=hashCodeNumberUpdate(hash=blendStateHash(hash,a.alphaBlendState),a.channelWriteMask)}function megaStateDescriptorHash(hash,a){for(var _a,_b,_c,_d,_e,_f,_g,_h,i=0;i<a.attachmentsState.length;i++)hash=attachmentStateHash(hash,a.attachmentsState[i]);return hash=function colorHash(hash,a){return hashCodeNumberUpdate(hash,a.r<<24|a.g<<16|a.b<<8|a.a)}(hash,a.blendConstant),hash=hashCodeNumberUpdate(hash,a.depthCompare),hash=hashCodeNumberUpdate(hash,a.depthWrite?1:0),hash=hashCodeNumberUpdate(hash,null===(_a=a.stencilFront)||void 0===_a?void 0:_a.compare),hash=hashCodeNumberUpdate(hash,null===(_b=a.stencilFront)||void 0===_b?void 0:_b.passOp),hash=hashCodeNumberUpdate(hash,null===(_c=a.stencilFront)||void 0===_c?void 0:_c.failOp),hash=hashCodeNumberUpdate(hash,null===(_d=a.stencilFront)||void 0===_d?void 0:_d.depthFailOp),hash=hashCodeNumberUpdate(hash,null===(_e=a.stencilBack)||void 0===_e?void 0:_e.compare),hash=hashCodeNumberUpdate(hash,null===(_f=a.stencilBack)||void 0===_f?void 0:_f.passOp),hash=hashCodeNumberUpdate(hash,null===(_g=a.stencilBack)||void 0===_g?void 0:_g.failOp),hash=hashCodeNumberUpdate(hash,null===(_h=a.stencilBack)||void 0===_h?void 0:_h.depthFailOp),hash=hashCodeNumberUpdate(hash,a.stencilWrite?1:0),hash=hashCodeNumberUpdate(hash,a.cullMode),hash=hashCodeNumberUpdate(hash,a.frontFace?1:0),hash=hashCodeNumberUpdate(hash,a.polygonOffset?1:0)}function renderPipelineDescriptorHash(a){var hash=0;hash=hashCodeNumberUpdate(hash,a.program.id),null!==a.inputLayout&&(hash=hashCodeNumberUpdate(hash,a.inputLayout.id)),hash=megaStateDescriptorHash(hash,a.megaStateDescriptor);for(var i=0;i<a.colorAttachmentFormats.length;i++)hash=hashCodeNumberUpdate(hash,a.colorAttachmentFormats[i]||0);return hashCodeNumberFinish(hash=hashCodeNumberUpdate(hash,a.depthStencilAttachmentFormat||0))}function bindingsDescriptorHash(a){for(var hash=0,i=0;i<a.samplerBindings.length;i++){null!==(binding=a.samplerBindings[i])&&null!==binding.texture&&(hash=hashCodeNumberUpdate(hash,binding.texture.id))}for(i=0;i<a.uniformBufferBindings.length;i++){var binding;null!==(binding=a.uniformBufferBindings[i])&&null!==binding.buffer&&(hash=hashCodeNumberUpdate(hash,binding.buffer.id),hash=hashCodeNumberUpdate(hash,binding.binding),hash=hashCodeNumberUpdate(hash,binding.offset),hash=hashCodeNumberUpdate(hash,binding.size))}return hashCodeNumberFinish(hash)}var ToneMapping,RGAttachmentSlot,RenderCache=function(){function RenderCache(device){this.bindingsCache=new HashMap(bindingsDescriptorEquals,bindingsDescriptorHash),this.renderPipelinesCache=new HashMap(renderPipelineDescriptorEquals,renderPipelineDescriptorHash),this.inputLayoutsCache=new HashMap(inputLayoutDescriptorEquals,nullHashFunc),this.programCache=new HashMap(programDescriptorSimpleEquals,nullHashFunc),this.samplerCache=new HashMap(samplerDescriptorEquals,nullHashFunc),this.device=device}return RenderCache.prototype.createBindings=function(descriptor){var bindings=this.bindingsCache.get(descriptor);if(null===bindings){var descriptorCopy=function bindingsDescriptorCopy(a){return{samplerBindings:a.samplerBindings&&arrayCopy(a.samplerBindings,samplerBindingCopy),uniformBufferBindings:a.uniformBufferBindings&&arrayCopy(a.uniformBufferBindings,bufferBindingCopy),storageBufferBindings:a.storageBufferBindings&&arrayCopy(a.storageBufferBindings,bufferBindingCopy),storageTextureBindings:a.storageTextureBindings&&arrayCopy(a.storageTextureBindings,textureBindingCopy),pipeline:a.pipeline}}(descriptor);descriptorCopy.uniformBufferBindings=descriptorCopy.uniformBufferBindings.filter((function(_a){return _a.size>0})),bindings=this.device.createBindings(descriptorCopy),this.bindingsCache.add(descriptorCopy,bindings)}return bindings},RenderCache.prototype.createRenderPipeline=function(descriptor){var renderPipeline=this.renderPipelinesCache.get(descriptor);if(null===renderPipeline){var descriptorCopy=function renderPipelineDescriptorCopy(a){var inputLayout=a.inputLayout,program=a.program,topology=a.topology;return{inputLayout,megaStateDescriptor:a.megaStateDescriptor&&copyMegaState(a.megaStateDescriptor),program,topology,colorAttachmentFormats:a.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:a.depthStencilAttachmentFormat,sampleCount:a.sampleCount}}(descriptor);descriptorCopy.colorAttachmentFormats=descriptorCopy.colorAttachmentFormats.filter((function(f){return f})),renderPipeline=this.device.createRenderPipeline(descriptorCopy),this.renderPipelinesCache.add(descriptorCopy,renderPipeline)}return renderPipeline},RenderCache.prototype.createInputLayout=function(descriptor){descriptor.vertexBufferDescriptors=descriptor.vertexBufferDescriptors.filter((function(d){return!!d}));var inputLayout=this.inputLayoutsCache.get(descriptor);if(null===inputLayout){var descriptorCopy=function inputLayoutDescriptorCopy(a){return{vertexBufferDescriptors:arrayCopy(a.vertexBufferDescriptors,inputLayoutBufferDescriptorCopy),indexBufferFormat:a.indexBufferFormat,program:a.program}}(descriptor);inputLayout=this.device.createInputLayout(descriptorCopy),this.inputLayoutsCache.add(descriptorCopy,inputLayout)}return inputLayout},RenderCache.prototype.createProgramSimple=function(deviceProgram){var vert=deviceProgram.vert,frag=deviceProgram.frag,preprocessedFrag=deviceProgram.preprocessedFrag,preprocessedVert=deviceProgram.preprocessedVert,program=null;if(preprocessedVert&&preprocessedFrag&&(program=this.programCache.get({vert,frag,preprocessedFrag,preprocessedVert})),null===program){var _a=preprocessProgramObj_GLSL(this.device,deviceProgram),preprocessedVert_1=_a.preprocessedVert,preprocessedFrag_1=_a.preprocessedFrag;deviceProgram.preprocessedVert=preprocessedVert_1,deviceProgram.preprocessedFrag=preprocessedFrag_1;var descriptorCopy=function programDescriptorSimpleCopy(a){return{preprocessedVert:a.preprocessedVert,preprocessedFrag:a.preprocessedFrag,vert:a.vert,frag:a.frag}}(deviceProgram);program=this.device.createProgramSimple({vertex:{glsl:preprocessedVert_1},fragment:{glsl:preprocessedFrag_1}},vert),this.programCache.add(descriptorCopy,program)}return program},RenderCache.prototype.createSampler=function(descriptor){var sampler=this.samplerCache.get(descriptor);return null===sampler&&(sampler=this.device.createSampler(descriptor),this.samplerCache.add(descriptor,sampler)),sampler},RenderCache.prototype.destroy=function(){var e_1,_a,e_2,_b,e_3,_c,e_4,_d,e_5,_e;try{for(var _f=(0,tslib_es6.Ju)(this.bindingsCache.values()),_g=_f.next();!_g.done;_g=_f.next()){_g.value.destroy()}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_g&&!_g.done&&(_a=_f.return)&&_a.call(_f)}finally{if(e_1)throw e_1.error}}try{for(var _h=(0,tslib_es6.Ju)(this.renderPipelinesCache.values()),_j=_h.next();!_j.done;_j=_h.next()){_j.value.destroy()}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_j&&!_j.done&&(_b=_h.return)&&_b.call(_h)}finally{if(e_2)throw e_2.error}}try{for(var _k=(0,tslib_es6.Ju)(this.inputLayoutsCache.values()),_l=_k.next();!_l.done;_l=_k.next()){_l.value.destroy()}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_l&&!_l.done&&(_c=_k.return)&&_c.call(_k)}finally{if(e_3)throw e_3.error}}try{for(var _m=(0,tslib_es6.Ju)(this.programCache.values()),_o=_m.next();!_o.done;_o=_m.next()){_o.value.destroy()}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_o&&!_o.done&&(_d=_m.return)&&_d.call(_m)}finally{if(e_4)throw e_4.error}}try{for(var _p=(0,tslib_es6.Ju)(this.samplerCache.values()),_q=_p.next();!_q.done;_q=_p.next()){_q.value.destroy()}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_q&&!_q.done&&(_e=_p.return)&&_e.call(_p)}finally{if(e_5)throw e_5.error}}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()},RenderCache}();!function(ToneMapping){ToneMapping.NONE="none",ToneMapping.LINEAR="LinearToneMapping",ToneMapping.REINHARD="ReinhardToneMapping",ToneMapping.CINEON="OptimizedCineonToneMapping",ToneMapping.ACES_FILMIC="ACESFilmicToneMapping",ToneMapping.CUSTOM="CustomToneMapping"}(ToneMapping||(ToneMapping={})),function(RGAttachmentSlot){RGAttachmentSlot[RGAttachmentSlot.Color0=0]="Color0",RGAttachmentSlot[RGAttachmentSlot.Color1=1]="Color1",RGAttachmentSlot[RGAttachmentSlot.Color2=2]="Color2",RGAttachmentSlot[RGAttachmentSlot.Color3=3]="Color3",RGAttachmentSlot[RGAttachmentSlot.ColorMax=3]="ColorMax",RGAttachmentSlot[RGAttachmentSlot.DepthStencil=4]="DepthStencil"}(RGAttachmentSlot||(RGAttachmentSlot={}));var RendererLayer,RenderGraphPass=function(){function RenderGraphPass(){this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}return RenderGraphPass.prototype.setDebugName=function(debugName){this.debugName=debugName},RenderGraphPass.prototype.pushDebugThumbnail=function(attachmentSlot){this.debugThumbnails[attachmentSlot]=!0},RenderGraphPass.prototype.setViewport=function(x,y,w,h){this.viewportX=x,this.viewportY=y,this.viewportW=w,this.viewportH=h},RenderGraphPass.prototype.attachRenderTargetID=function(attachmentSlot,renderTargetID,level){void 0===level&&(level=0),es_assert(void 0===this.renderTargetIDs[attachmentSlot]),this.renderTargetIDs[attachmentSlot]=renderTargetID,this.renderTargetLevels[attachmentSlot]=level},RenderGraphPass.prototype.attachResolveTexture=function(resolveTextureID){this.resolveTextureInputIDs.push(resolveTextureID)},RenderGraphPass.prototype.attachOcclusionQueryPool=function(queryPool){this.descriptor.occlusionQueryPool=queryPool},RenderGraphPass.prototype.exec=function(func){es_assert(null===this.execFunc),this.execFunc=func},RenderGraphPass.prototype.post=function(func){es_assert(null===this.postFunc),this.postFunc=func},RenderGraphPass.prototype.addExtraRef=function(slot){this.renderTargetExtraRefs[slot]=!0},RenderGraphPass}(),RGRenderTarget=function(){function RGRenderTarget(device,desc){this.dimension=TextureDimension.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=TextureUsage.RENDER_TARGET,this.needsClear=!0,this.texture=null,this.age=0,this.format=desc.format,this.width=desc.width,this.height=desc.height,this.sampleCount=desc.sampleCount,es_assert(this.sampleCount>=1),this.sampleCount>1?this.attachment=device.createRenderTarget(this):(this.texture=device.createTexture(this),this.attachment=device.createRenderTargetFromTexture(this.texture))}return RGRenderTarget.prototype.setDebugName=function(device,debugName){this.debugName=debugName,null!==this.texture&&device.setResourceName(this.texture,this.debugName),device.setResourceName(this.attachment,this.debugName)},RGRenderTarget.prototype.matchesDescription=function(desc){return this.format===desc.format&&this.width===desc.width&&this.height===desc.height&&this.sampleCount===desc.sampleCount},RGRenderTarget.prototype.reset=function(desc){es_assert(this.matchesDescription(desc)),this.age=0},RGRenderTarget.prototype.destroy=function(){this.attachment.destroy()},RGRenderTarget}(),SingleSampledTexture=function(){function SingleSampledTexture(device,desc){this.dimension=TextureDimension.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.usage=TextureUsage.RENDER_TARGET,this.width=0,this.height=0,this.age=0,this.format=desc.format,this.width=desc.width,this.height=desc.height,this.texture=device.createTexture(this)}return SingleSampledTexture.prototype.matchesDescription=function(desc){return this.format===desc.format&&this.width===desc.width&&this.height===desc.height},SingleSampledTexture.prototype.reset=function(desc){es_assert(this.matchesDescription(desc)),this.age=0},SingleSampledTexture.prototype.destroy=function(){this.texture.destroy()},SingleSampledTexture}(),GraphImpl=function GraphImpl(){this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},RenderGraph=function(){function RenderGraph(device){this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=device}return RenderGraph.prototype.acquireRenderTargetForDescription=function(desc){for(var i=0;i<this.renderTargetDeadPool.length;i++){var freeRenderTarget=this.renderTargetDeadPool[i];if(freeRenderTarget.matchesDescription(desc))return freeRenderTarget.reset(desc),this.renderTargetDeadPool.splice(i--,1),freeRenderTarget}return new RGRenderTarget(this.device,desc)},RenderGraph.prototype.acquireSingleSampledTextureForDescription=function(desc){for(var i=0;i<this.singleSampledTextureDeadPool.length;i++){var freeSingleSampledTexture=this.singleSampledTextureDeadPool[i];if(freeSingleSampledTexture.matchesDescription(desc))return freeSingleSampledTexture.reset(desc),this.singleSampledTextureDeadPool.splice(i--,1),freeSingleSampledTexture}return new SingleSampledTexture(this.device,desc)},RenderGraph.prototype.beginGraphBuilder=function(){es_assert(null===this.currentGraph),this.currentGraph=new GraphImpl},RenderGraph.prototype.pushPass=function(setupFunc){var pass=new RenderGraphPass;setupFunc(pass),this.currentGraph.passes.push(pass)},RenderGraph.prototype.createRenderTargetID=function(desc,debugName){return this.currentGraph.renderTargetDebugNames.push(debugName),this.currentGraph.renderTargetDescriptions.push(desc)-1},RenderGraph.prototype.createResolveTextureID=function(renderTargetID){return this.currentGraph.resolveTextureRenderTargetIDs.push(renderTargetID)-1},RenderGraph.prototype.findMostRecentPassThatAttachedRenderTarget=function(renderTargetID){for(var i=this.currentGraph.passes.length-1;i>=0;i--){var pass=this.currentGraph.passes[i];if(pass.renderTargetIDs.includes(renderTargetID))return pass}return null},RenderGraph.prototype.resolveRenderTargetPassAttachmentSlot=function(pass,attachmentSlot){var renderPass=pass;if(void 0===renderPass.resolveTextureOutputIDs[attachmentSlot]){var renderTargetID=renderPass.renderTargetIDs[attachmentSlot],resolveTextureID=this.createResolveTextureID(renderTargetID);renderPass.resolveTextureOutputIDs[attachmentSlot]=resolveTextureID}return renderPass.resolveTextureOutputIDs[attachmentSlot]},RenderGraph.prototype.findPassForResolveRenderTarget=function(renderTargetID){var renderPass=assertExists(this.findMostRecentPassThatAttachedRenderTarget(renderTargetID)),attachmentSlot=renderPass.renderTargetIDs.indexOf(renderTargetID);return es_assert(void 0===renderPass.resolveTextureOutputExternalTextures[attachmentSlot]),renderPass},RenderGraph.prototype.resolveRenderTarget=function(renderTargetID){var renderPass=this.findPassForResolveRenderTarget(renderTargetID),attachmentSlot=renderPass.renderTargetIDs.indexOf(renderTargetID);return this.resolveRenderTargetPassAttachmentSlot(renderPass,attachmentSlot)},RenderGraph.prototype.resolveRenderTargetToExternalTexture=function(renderTargetID,texture,level){void 0===level&&(level=0);var renderPass=this.findPassForResolveRenderTarget(renderTargetID),attachmentSlot=renderPass.renderTargetIDs.indexOf(renderTargetID);es_assert(void 0===renderPass.resolveTextureOutputIDs[attachmentSlot]),renderPass.resolveTextureOutputExternalTextures[attachmentSlot]=texture,renderPass.resolveTextureOutputExternalTextureLevel[attachmentSlot]=level},RenderGraph.prototype.getRenderTargetDescription=function(renderTargetID){return assertExists(this.currentGraph.renderTargetDescriptions[renderTargetID])},RenderGraph.prototype.scheduleAddUseCount=function(graph,pass){for(var slot=0;slot<pass.renderTargetIDs.length;slot++){void 0!==(renderTargetID=pass.renderTargetIDs[slot])&&(this.renderTargetOutputCount[renderTargetID]++,pass.renderTargetExtraRefs[slot]&&this.renderTargetOutputCount[renderTargetID]++)}for(var i=0;i<pass.resolveTextureInputIDs.length;i++){var resolveTextureID=pass.resolveTextureInputIDs[i];if(void 0!==resolveTextureID){this.resolveTextureUseCount[resolveTextureID]++;var renderTargetID=graph.resolveTextureRenderTargetIDs[resolveTextureID];this.renderTargetResolveCount[renderTargetID]++}}},RenderGraph.prototype.acquireRenderTargetForID=function(graph,renderTargetID){if(void 0===renderTargetID)return null;if(es_assert(this.renderTargetOutputCount[renderTargetID]>0),!this.renderTargetAliveForID[renderTargetID]){var desc=graph.renderTargetDescriptions[renderTargetID],newRenderTarget=this.acquireRenderTargetForDescription(desc);newRenderTarget.setDebugName(this.device,graph.renderTargetDebugNames[renderTargetID]),this.renderTargetAliveForID[renderTargetID]=newRenderTarget}return this.renderTargetAliveForID[renderTargetID]},RenderGraph.prototype.releaseRenderTargetForID=function(renderTargetID,forOutput){if(void 0===renderTargetID)return null;var renderTarget=assertExists(this.renderTargetAliveForID[renderTargetID]);return forOutput?(es_assert(this.renderTargetOutputCount[renderTargetID]>0),this.renderTargetOutputCount[renderTargetID]--):(es_assert(this.renderTargetResolveCount[renderTargetID]>0),this.renderTargetResolveCount[renderTargetID]--),0===this.renderTargetOutputCount[renderTargetID]&&0===this.renderTargetResolveCount[renderTargetID]&&(renderTarget.needsClear=!0,delete this.renderTargetAliveForID[renderTargetID],this.renderTargetDeadPool.push(renderTarget)),renderTarget},RenderGraph.prototype.acquireResolveTextureInputTextureForID=function(graph,resolveTextureID){var renderTargetID=graph.resolveTextureRenderTargetIDs[resolveTextureID];es_assert(this.resolveTextureUseCount[resolveTextureID]>0),this.resolveTextureUseCount[resolveTextureID]--;var renderTarget=assertExists(this.releaseRenderTargetForID(renderTargetID,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[resolveTextureID]){var singleSampledTexture=this.singleSampledTextureForResolveTextureID[resolveTextureID];return 0===this.resolveTextureUseCount[resolveTextureID]&&this.singleSampledTextureDeadPool.push(singleSampledTexture),singleSampledTexture.texture}return assertExists(renderTarget.texture)},RenderGraph.prototype.determineResolveParam=function(graph,pass,slot){var renderTargetID=pass.renderTargetIDs[slot],resolveTextureOutputID=pass.resolveTextureOutputIDs[slot],externalTexture=pass.resolveTextureOutputExternalTextures[slot],hasResolveTextureOutputID=void 0!==resolveTextureOutputID,hasExternalTexture=void 0!==externalTexture;es_assert(!(hasResolveTextureOutputID&&hasExternalTexture));var resolveTo=null,store=!1,level=0;if(this.renderTargetOutputCount[renderTargetID]>1&&(store=!0),hasResolveTextureOutputID){es_assert(graph.resolveTextureRenderTargetIDs[resolveTextureOutputID]===renderTargetID),es_assert(this.resolveTextureUseCount[resolveTextureOutputID]>0),es_assert(this.renderTargetOutputCount[renderTargetID]>0);var renderTarget=assertExists(this.renderTargetAliveForID[renderTargetID]);if(null!==renderTarget.texture&&1===this.renderTargetOutputCount[renderTargetID])resolveTo=null,store=!0;else{if(!this.singleSampledTextureForResolveTextureID[resolveTextureOutputID]){var desc=assertExists(graph.renderTargetDescriptions[renderTargetID]);this.singleSampledTextureForResolveTextureID[resolveTextureOutputID]=this.acquireSingleSampledTextureForDescription(desc),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[resolveTextureOutputID].texture,renderTarget.debugName+" (Resolve ".concat(resolveTextureOutputID,")"))}resolveTo=this.singleSampledTextureForResolveTextureID[resolveTextureOutputID].texture}}else hasExternalTexture?(resolveTo=externalTexture,level=pass.resolveTextureOutputExternalTextureLevel[slot]):resolveTo=null;return{resolveTo,store,level}},RenderGraph.prototype.schedulePass=function(graph,pass){for(var depthStencilRenderTargetID=pass.renderTargetIDs[RGAttachmentSlot.DepthStencil],slot=RGAttachmentSlot.Color0;slot<=RGAttachmentSlot.ColorMax;slot++){var colorRenderTargetID=pass.renderTargetIDs[slot],colorRenderTarget=this.acquireRenderTargetForID(graph,colorRenderTargetID);pass.renderTargets[slot]=colorRenderTarget,pass.descriptor.colorAttachment[slot]=null!==colorRenderTarget?colorRenderTarget.attachment:null,pass.descriptor.colorAttachmentLevel[slot]=pass.renderTargetLevels[slot];var _a=this.determineResolveParam(graph,pass,slot),resolveTo_1=_a.resolveTo,store_1=_a.store,level=_a.level;pass.descriptor.colorResolveTo[slot]=resolveTo_1,pass.descriptor.colorResolveToLevel[slot]=level,pass.descriptor.colorStore[slot]=store_1,pass.descriptor.colorClearColor[slot]=null!==colorRenderTarget&&colorRenderTarget.needsClear?graph.renderTargetDescriptions[colorRenderTargetID].colorClearColor:"load"}var depthStencilRenderTarget=this.acquireRenderTargetForID(graph,depthStencilRenderTargetID);pass.renderTargets[RGAttachmentSlot.DepthStencil]=depthStencilRenderTarget,pass.descriptor.depthStencilAttachment=null!==depthStencilRenderTarget?depthStencilRenderTarget.attachment:null;var _b=this.determineResolveParam(graph,pass,RGAttachmentSlot.DepthStencil),resolveTo=_b.resolveTo,store=_b.store;pass.descriptor.depthStencilResolveTo=resolveTo,pass.descriptor.depthStencilStore=store,pass.descriptor.depthClearValue=null!==depthStencilRenderTarget&&depthStencilRenderTarget.needsClear?graph.renderTargetDescriptions[depthStencilRenderTargetID].depthClearValue:"load",pass.descriptor.stencilClearValue=null!==depthStencilRenderTarget&&depthStencilRenderTarget.needsClear?graph.renderTargetDescriptions[depthStencilRenderTargetID].stencilClearValue:"load";for(var rtWidth=0,rtHeight=0,rtSampleCount=0,i=0;i<pass.renderTargets.length;i++){var renderTarget=pass.renderTargets[i];if(renderTarget){var width=renderTarget.width>>>pass.renderTargetLevels[i],height=renderTarget.height>>>pass.renderTargetLevels[i];0===rtWidth&&(rtWidth=width,rtHeight=height,rtSampleCount=renderTarget.sampleCount),es_assert(width===rtWidth),es_assert(height===rtHeight),es_assert(renderTarget.sampleCount===rtSampleCount),renderTarget.needsClear=!1}}rtWidth>0&&rtHeight>0&&(pass.viewportX*=rtWidth,pass.viewportY*=rtHeight,pass.viewportW*=rtWidth,pass.viewportH*=rtHeight);for(i=0;i<pass.resolveTextureInputIDs.length;i++){var resolveTextureID=pass.resolveTextureInputIDs[i];pass.resolveTextureInputTextures[i]=this.acquireResolveTextureInputTextureForID(graph,resolveTextureID)}for(i=0;i<pass.renderTargetIDs.length;i++)this.releaseRenderTargetForID(pass.renderTargetIDs[i],!0);for(slot=0;slot<pass.renderTargetExtraRefs.length;slot++)pass.renderTargetExtraRefs[slot]&&this.releaseRenderTargetForID(pass.renderTargetIDs[slot],!0)},RenderGraph.prototype.scheduleGraph=function(graph){es_assert(0===this.renderTargetOutputCount.length),es_assert(0===this.renderTargetResolveCount.length),es_assert(0===this.resolveTextureUseCount.length);for(var i=0;i<this.renderTargetDeadPool.length;i++)this.renderTargetDeadPool[i].age++;for(i=0;i<this.singleSampledTextureDeadPool.length;i++)this.singleSampledTextureDeadPool[i].age++;fillArray(this.renderTargetOutputCount,graph.renderTargetDescriptions.length,0),fillArray(this.renderTargetResolveCount,graph.renderTargetDescriptions.length,0),fillArray(this.resolveTextureUseCount,graph.resolveTextureRenderTargetIDs.length,0);for(i=0;i<graph.passes.length;i++)this.scheduleAddUseCount(graph,graph.passes[i]);for(i=0;i<graph.passes.length;i++)this.schedulePass(graph,graph.passes[i]);for(i=0;i<this.renderTargetOutputCount.length;i++)es_assert(0===this.renderTargetOutputCount[i]);for(i=0;i<this.renderTargetResolveCount.length;i++)es_assert(0===this.renderTargetResolveCount[i]);for(i=0;i<this.resolveTextureUseCount.length;i++)es_assert(0===this.resolveTextureUseCount[i]);for(i=0;i<this.renderTargetAliveForID.length;i++)es_assert(void 0===this.renderTargetAliveForID[i]);for(i=0;i<this.renderTargetDeadPool.length;i++)this.renderTargetDeadPool[i].age>=1&&(this.renderTargetDeadPool[i].destroy(),this.renderTargetDeadPool.splice(i--,1));for(i=0;i<this.singleSampledTextureDeadPool.length;i++)this.singleSampledTextureDeadPool[i].age>=1&&(this.singleSampledTextureDeadPool[i].destroy(),this.singleSampledTextureDeadPool.splice(i--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0},RenderGraph.prototype.execPass=function(pass){es_assert(null===this.currentPass),this.currentPass=pass;var renderPass=this.device.createRenderPass(pass.descriptor);renderPass.pushDebugGroup(pass.debugName),renderPass.setViewport(pass.viewportX,pass.viewportY,pass.viewportW,pass.viewportH),null!==pass.execFunc&&pass.execFunc(renderPass,this),renderPass.popDebugGroup(),this.device.submitPass(renderPass),null!==pass.postFunc&&pass.postFunc(this),this.currentPass=null},RenderGraph.prototype.execGraph=function(graph){var _this=this;this.scheduleGraph(graph),this.device.beginFrame(),graph.passes.forEach((function(pass){_this.execPass(pass)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0},RenderGraph.prototype.execute=function(){var graph=assertExists(this.currentGraph);this.execGraph(graph),this.currentGraph=null},RenderGraph.prototype.getDebug=function(){return this},RenderGraph.prototype.getPasses=function(){return this.currentGraph.passes},RenderGraph.prototype.getPassDebugThumbnails=function(pass){return pass.debugThumbnails},RenderGraph.prototype.getPassRenderTargetID=function(pass,slot){return pass.renderTargetIDs[slot]},RenderGraph.prototype.getRenderTargetIDDebugName=function(renderTargetID){return this.currentGraph.renderTargetDebugNames[renderTargetID]},RenderGraph.prototype.getResolveTextureForID=function(resolveTextureID){var currentGraphPass=this.currentPass,i=currentGraphPass.resolveTextureInputIDs.indexOf(resolveTextureID);return es_assert(i>=0),assertExists(currentGraphPass.resolveTextureInputTextures[i])},RenderGraph.prototype.getRenderTargetAttachment=function(slot){var renderTarget=this.currentPass.renderTargets[slot];return renderTarget?renderTarget.attachment:null},RenderGraph.prototype.getRenderTargetTexture=function(slot){var renderTarget=this.currentPass.renderTargets[slot];return renderTarget?renderTarget.texture:null},RenderGraph.prototype.newGraphBuilder=function(){return this.beginGraphBuilder(),this},RenderGraph.prototype.destroy=function(){for(var i=0;i<this.renderTargetAliveForID.length;i++)es_assert(void 0===this.renderTargetAliveForID[i]);for(i=0;i<this.singleSampledTextureForResolveTextureID.length;i++)es_assert(void 0===this.singleSampledTextureForResolveTextureID[i]);for(i=0;i<this.renderTargetDeadPool.length;i++)this.renderTargetDeadPool[i].destroy();for(i=0;i<this.singleSampledTextureDeadPool.length;i++)this.singleSampledTextureDeadPool[i].destroy()},RenderGraph}();!function(RendererLayer){RendererLayer[RendererLayer.BACKGROUND=0]="BACKGROUND",RendererLayer[RendererLayer.ALPHA_TEST=16]="ALPHA_TEST",RendererLayer[RendererLayer.OPAQUE=32]="OPAQUE",RendererLayer[RendererLayer.TRANSLUCENT=128]="TRANSLUCENT"}(RendererLayer||(RendererLayer={}));function setSortKeyLayer(sortKey,layer){return(16777215&sortKey|(255&layer)<<24)>>>0}function makeSortKeyOpaque(layer,programKey){return setSortKeyLayer(function setSortKeyProgramKey(sortKey,programKey){return sortKey>>>31&1?sortKey:(4278190335&sortKey|(65535&programKey)<<8)>>>0}(0,programKey),layer)}mat4_fromValues(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);var RenderInstFlags;mat4_fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function fillVec4(d,offs,v0,v1,v2,v3){return void 0===v1&&(v1=0),void 0===v2&&(v2=0),void 0===v3&&(v3=0),d[offs+0]=v0,d[offs+1]=v1,d[offs+2]=v2,d[offs+3]=v3,4}!function(RenderInstFlags){RenderInstFlags[RenderInstFlags.None=0]="None",RenderInstFlags[RenderInstFlags.Indexed=1]="Indexed",RenderInstFlags[RenderInstFlags.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",RenderInstFlags[RenderInstFlags.Template=4]="Template",RenderInstFlags[RenderInstFlags.Draw=8]="Draw",RenderInstFlags[RenderInstFlags.InheritedFlags=3]="InheritedFlags"}(RenderInstFlags||(RenderInstFlags={}));var RenderInstExecutionOrder,RenderInst=function(){function RenderInst(){this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=nArray(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=nArray(4,(function(){return 0})),this.flags=0,this.vertexBuffers=null,this.indexBuffer=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={inputLayout:null,megaStateDescriptor:copyMegaState(defaultMegaState),program:null,topology:PrimitiveTopology.TRIANGLES,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return RenderInst.prototype.reset=function(){this.sortKey=0,this.flags=RenderInstFlags.AllowSkippingIfPipelineNotReady,this.vertexBuffers=null,this.indexBuffer=null,this.renderPipelineDescriptor.inputLayout=null},RenderInst.prototype.setFromTemplate=function(o){var _a,_b;setMegaStateFlags(this.renderPipelineDescriptor.megaStateDescriptor,o.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=o.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=o.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=o.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,o.renderPipelineDescriptor.colorAttachmentFormats.length);for(var i=0;i<o.renderPipelineDescriptor.colorAttachmentFormats.length;i++)this.renderPipelineDescriptor.colorAttachmentFormats[i]=o.renderPipelineDescriptor.colorAttachmentFormats[i];this.renderPipelineDescriptor.depthStencilAttachmentFormat=o.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=o.renderPipelineDescriptor.sampleCount,this.uniformBuffer=o.uniformBuffer,this.uniforms=(0,tslib_es6.fX)([],(0,tslib_es6.zs)(o.uniforms),!1),this.drawCount=o.drawCount,this.drawStart=o.drawStart,this.drawInstanceCount=o.drawInstanceCount,this.vertexBuffers=o.vertexBuffers,this.indexBuffer=o.indexBuffer,this.flags=this.flags&~RenderInstFlags.InheritedFlags|o.flags&RenderInstFlags.InheritedFlags,this.sortKey=o.sortKey;var tbd=this.bindingDescriptors[0],obd=o.bindingDescriptors[0];this.setBindingLayout({numSamplers:null===(_a=obd.samplerBindings)||void 0===_a?void 0:_a.length,numUniformBuffers:null===(_b=obd.uniformBufferBindings)||void 0===_b?void 0:_b.length});for(i=0;i<Math.min(tbd.uniformBufferBindings.length,obd.uniformBufferBindings.length);i++)tbd.uniformBufferBindings[i].size=o.bindingDescriptors[0].uniformBufferBindings[i].size;this.setSamplerBindingsFromTextureMappings(obd.samplerBindings);for(i=0;i<o.dynamicUniformBufferByteOffsets.length;i++)this.dynamicUniformBufferByteOffsets[i]=o.dynamicUniformBufferByteOffsets[i]},RenderInst.prototype.validate=function(){for(var _a,i=0;i<this.bindingDescriptors.length;i++)for(var bd=this.bindingDescriptors[i],j=0;j<(null===(_a=bd.uniformBufferBindings)||void 0===_a?void 0:_a.length);j++)es_assert(bd.uniformBufferBindings[j].size>0);es_assert(this.drawCount>0)},RenderInst.prototype.setProgram=function(program){this.renderPipelineDescriptor.program=program},RenderInst.prototype.setMegaStateFlags=function(r){return setMegaStateFlags(this.renderPipelineDescriptor.megaStateDescriptor,r),this.renderPipelineDescriptor.megaStateDescriptor},RenderInst.prototype.getMegaStateFlags=function(){return this.renderPipelineDescriptor.megaStateDescriptor},RenderInst.prototype.setVertexInput=function(inputLayout,vertexBuffers,indexBuffer){this.vertexBuffers=vertexBuffers,this.indexBuffer=indexBuffer,this.renderPipelineDescriptor.inputLayout=inputLayout},RenderInst.prototype.setBindingLayout=function(bindingLayout){es_assert(bindingLayout.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length);for(var i=this.bindingDescriptors[0].uniformBufferBindings.length;i<bindingLayout.numUniformBuffers;i++)this.bindingDescriptors[0].uniformBufferBindings.push({binding:i,buffer:null,size:0});for(i=this.bindingDescriptors[0].samplerBindings.length;i<bindingLayout.numSamplers;i++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null})},RenderInst.prototype.drawIndexes=function(indexCount,indexStart){void 0===indexStart&&(indexStart=0),this.flags=setBitFlagEnabled(this.flags,RenderInstFlags.Indexed,!0),this.drawCount=indexCount,this.drawStart=indexStart,this.drawInstanceCount=1},RenderInst.prototype.drawIndexesInstanced=function(indexCount,instanceCount,indexStart){void 0===indexStart&&(indexStart=0),this.flags=setBitFlagEnabled(this.flags,RenderInstFlags.Indexed,!0),this.drawCount=indexCount,this.drawStart=indexStart,this.drawInstanceCount=instanceCount},RenderInst.prototype.drawPrimitives=function(primitiveCount,primitiveStart){void 0===primitiveStart&&(primitiveStart=0),this.flags=setBitFlagEnabled(this.flags,RenderInstFlags.Indexed,!1),this.drawCount=primitiveCount,this.drawStart=primitiveStart,this.drawInstanceCount=1},RenderInst.prototype.setUniforms=function(bufferIndex,uniforms){if(0!==uniforms.length){this.uniforms[bufferIndex]=uniforms;var offset=0,uboBuffer=[];uniforms.forEach((function(uniform){var value=uniform.value;if((0,is_number.A)(value)||Array.isArray(value)||value instanceof Float32Array){var array=(0,is_number.A)(value)?[value]:value,formatByteSize=array.length>4?4:array.length,emptySpace_1=4-offset%4;if(4!==emptySpace_1)if(emptySpace_1>=formatByteSize);else{offset+=emptySpace_1;for(var j=0;j<emptySpace_1;j++)uboBuffer.push(0)}offset+=array.length,uboBuffer.push.apply(uboBuffer,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(array),!1))}}));var emptySpace=4-uboBuffer.length%4;if(4!==emptySpace)for(var j=0;j<emptySpace;j++)uboBuffer.push(0);for(var offs=this.allocateUniformBuffer(bufferIndex,uboBuffer.length),d=this.mapUniformBufferF32(bufferIndex),i=0;i<uboBuffer.length;i+=4)offs+=fillVec4(d,offs,uboBuffer[i],uboBuffer[i+1],uboBuffer[i+2],uboBuffer[i+3])}},RenderInst.prototype.setUniformBuffer=function(uniformBuffer){this.uniformBuffer=uniformBuffer},RenderInst.prototype.allocateUniformBuffer=function(bufferIndex,wordCount){var _a;return es_assert((null===(_a=this.bindingDescriptors[0].uniformBufferBindings)||void 0===_a?void 0:_a.length)<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[bufferIndex]=this.uniformBuffer.allocateChunk(wordCount)<<2,this.bindingDescriptors[0].uniformBufferBindings[bufferIndex].size=wordCount<<2,this.getUniformBufferOffset(bufferIndex)},RenderInst.prototype.getUniformBufferOffset=function(bufferIndex){return this.dynamicUniformBufferByteOffsets[bufferIndex]>>>2},RenderInst.prototype.mapUniformBufferF32=function(bufferIndex){return this.uniformBuffer.mapBufferF32()},RenderInst.prototype.getUniformBuffer=function(){return this.uniformBuffer},RenderInst.prototype.setSamplerBindingsFromTextureMappings=function(mappings){mappings=mappings.filter((function(m){return m}));for(var i=0;i<this.bindingDescriptors[0].samplerBindings.length;i++){var dst=this.bindingDescriptors[0].samplerBindings[i],binding=mappings[i];null!=binding?(dst.texture=binding.texture,dst.sampler=binding.sampler):(dst.texture=null,dst.sampler=null)}},RenderInst.prototype.setAllowSkippingIfPipelineNotReady=function(v){this.flags=setBitFlagEnabled(this.flags,RenderInstFlags.AllowSkippingIfPipelineNotReady,v)},RenderInst.prototype.setAttachmentFormatsFromRenderPass=function(device,passRenderer){for(var passDescriptor=device.queryRenderPass(passRenderer),sampleCount=-1,i=0;i<passDescriptor.colorAttachment.length;i++){var colorAttachmentDescriptor=null!==passDescriptor.colorAttachment[i]?device.queryRenderTarget(passDescriptor.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==colorAttachmentDescriptor?colorAttachmentDescriptor.format:null,null!==colorAttachmentDescriptor&&(-1===sampleCount?sampleCount=colorAttachmentDescriptor.sampleCount:es_assert(sampleCount===colorAttachmentDescriptor.sampleCount))}var depthStencilAttachmentDescriptor=null!==passDescriptor.depthStencilAttachment?device.queryRenderTarget(passDescriptor.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==depthStencilAttachmentDescriptor?depthStencilAttachmentDescriptor.format:null,null!==depthStencilAttachmentDescriptor&&(-1===sampleCount?sampleCount=depthStencilAttachmentDescriptor.sampleCount:es_assert(sampleCount==depthStencilAttachmentDescriptor.sampleCount)),es_assert(sampleCount>0),this.renderPipelineDescriptor.sampleCount=sampleCount},RenderInst.prototype.drawOnPass=function(cache,passRenderer){var _this=this,device=cache.device;this.setAttachmentFormatsFromRenderPass(device,passRenderer);var gfxPipeline=cache.createRenderPipeline(this.renderPipelineDescriptor);if(!device.pipelineQueryReady(gfxPipeline)){if(this.flags&RenderInstFlags.AllowSkippingIfPipelineNotReady)return!1;device.pipelineForceReady(gfxPipeline)}passRenderer.setPipeline(gfxPipeline),passRenderer.setVertexInput(this.renderPipelineDescriptor.inputLayout,this.vertexBuffers,this.indexBuffer);for(var i=0;i<this.bindingDescriptors[0].uniformBufferBindings.length;i++)this.bindingDescriptors[0].uniformBufferBindings[i].buffer=assertExists(this.uniformBuffer.buffer),this.bindingDescriptors[0].uniformBufferBindings[i].offset=this.dynamicUniformBufferByteOffsets[i];this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(uniforms){var uniformsMap={};uniforms.forEach((function(_a){var name=_a.name,value=_a.value;uniformsMap[name]=value})),_this.renderPipelineDescriptor.program.setUniformsLegacy(uniformsMap)}));var gfxBindings=cache.createBindings((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.bindingDescriptors[0]),{pipeline:gfxPipeline}));return passRenderer.setBindings(gfxBindings),this.flags&RenderInstFlags.Indexed?passRenderer.drawIndexed(this.drawCount,this.drawInstanceCount,this.drawStart,0,0):passRenderer.draw(this.drawCount,this.drawInstanceCount,this.drawStart,0),!0},RenderInst}();function renderInstCompareSortKey(a,b){return a.sortKey-b.sortKey}!function(RenderInstExecutionOrder){RenderInstExecutionOrder[RenderInstExecutionOrder.Forwards=0]="Forwards",RenderInstExecutionOrder[RenderInstExecutionOrder.Backwards=1]="Backwards"}(RenderInstExecutionOrder||(RenderInstExecutionOrder={}));var RenderInstList=function(){function RenderInstList(compareFunction,executionOrder){void 0===compareFunction&&(compareFunction=renderInstCompareSortKey),void 0===executionOrder&&(executionOrder=RenderInstExecutionOrder.Forwards),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=compareFunction,this.executionOrder=executionOrder}return RenderInstList.prototype.checkUsePostSort=function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500},RenderInstList.prototype.insertSorted=function(renderInst){null===this.compareFunction||this.usePostSort?this.renderInsts.push(renderInst):function spliceBisectRight(L,e,compare){var idx=function bisectRight(L,e,compare){for(var lo=0,hi=L.length;lo<hi;){var mid=lo+(hi-lo>>>1);compare(e,L[mid])<0?hi=mid:lo=mid+1}return lo}(L,e,compare);L.splice(idx,0,e)}(this.renderInsts,renderInst,this.compareFunction),this.checkUsePostSort()},RenderInstList.prototype.submitRenderInst=function(renderInst){renderInst.flags|=RenderInstFlags.Draw,this.insertSorted(renderInst)},RenderInstList.prototype.ensureSorted=function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)},RenderInstList.prototype.drawOnPassRendererNoReset=function(cache,passRenderer){if(this.ensureSorted(),this.executionOrder===RenderInstExecutionOrder.Forwards)for(var i=0;i<this.renderInsts.length;i++)this.renderInsts[i].drawOnPass(cache,passRenderer);else for(i=this.renderInsts.length-1;i>=0;i--)this.renderInsts[i].drawOnPass(cache,passRenderer)},RenderInstList.prototype.reset=function(){this.renderInsts.length=0},RenderInstList.prototype.drawOnPassRenderer=function(cache,passRenderer){this.drawOnPassRendererNoReset(cache,passRenderer),this.reset()},RenderInstList}(),RenderInstPool=function(){function RenderInstPool(){this.pool=[],this.allocCount=0}return RenderInstPool.prototype.allocRenderInstIndex=function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new RenderInst),this.allocCount-1},RenderInstPool.prototype.popRenderInst=function(){this.allocCount--},RenderInstPool.prototype.reset=function(){for(var i=0;i<this.pool.length;i++)this.pool[i].reset();this.allocCount=0},RenderInstPool.prototype.destroy=function(){this.pool.length=0,this.allocCount=0},RenderInstPool}(),RenderInstManager=function(){function RenderInstManager(renderCache){this.renderCache=renderCache,this.instPool=new RenderInstPool,this.templatePool=new RenderInstPool,this.simpleRenderInstList=new RenderInstList,this.currentRenderInstList=this.simpleRenderInstList}return RenderInstManager.prototype.newRenderInst=function(){var templateIndex=this.templatePool.allocCount-1,renderInstIndex=this.instPool.allocRenderInstIndex(),renderInst=this.instPool.pool[renderInstIndex];return renderInst.debug=null,templateIndex>=0&&renderInst.setFromTemplate(this.templatePool.pool[templateIndex]),renderInst},RenderInstManager.prototype.submitRenderInst=function(renderInst,list){void 0===list&&(list=this.currentRenderInstList),list.submitRenderInst(renderInst)},RenderInstManager.prototype.setCurrentRenderInstList=function(list){es_assert(null===this.simpleRenderInstList),this.currentRenderInstList=list},RenderInstManager.prototype.pushTemplateRenderInst=function(){var templateIndex=this.templatePool.allocCount-1,newTemplateIndex=this.templatePool.allocRenderInstIndex(),newTemplate=this.templatePool.pool[newTemplateIndex];return templateIndex>=0&&newTemplate.setFromTemplate(this.templatePool.pool[templateIndex]),newTemplate.flags|=RenderInstFlags.Template,newTemplate},RenderInstManager.prototype.popTemplateRenderInst=function(){this.templatePool.popRenderInst()},RenderInstManager.prototype.getTemplateRenderInst=function(){var templateIndex=this.templatePool.allocCount-1;return this.templatePool.pool[templateIndex]},RenderInstManager.prototype.resetRenderInsts=function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),es_assert(0===this.templatePool.allocCount)},RenderInstManager.prototype.destroy=function(){this.instPool.destroy(),this.renderCache.destroy()},RenderInstManager.prototype.disableSimpleMode=function(){this.simpleRenderInstList=null},RenderInstManager.prototype.drawOnPassRenderer=function(passRenderer){assertExists(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,passRenderer)},RenderInstManager.prototype.drawOnPassRendererNoReset=function(passRenderer){assertExists(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,passRenderer)},RenderInstManager}(),RenderHelper=function(){function RenderHelper(parameters){this.parameters=parameters}return RenderHelper.prototype.getDevice=function(){return this.device},RenderHelper.prototype.setDevice=function(device){this.device=device,this.renderCache=new RenderCache(device),this.renderGraph=new RenderGraph(this.device),this.renderInstManager=new RenderInstManager(this.renderCache),this.uniformBuffer=new DynamicUniformBuffer(this.device)},RenderHelper.prototype.pushTemplateRenderInst=function(){var template=this.renderInstManager.pushTemplateRenderInst();return template.setUniformBuffer(this.uniformBuffer),template},RenderHelper.prototype.prepareToRender=function(){this.uniformBuffer.prepareToRender()},RenderHelper.prototype.destroy=function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()},RenderHelper.prototype.getCache=function(){return this.renderCache},RenderHelper.prototype.getDefines=function(){var _a,_b,_c;return{USE_TONEMAPPING:(null===(_a=this.parameters)||void 0===_a?void 0:_a.toneMapping)&&(null===(_b=this.parameters)||void 0===_b?void 0:_b.toneMapping)!==ToneMapping.NONE,toneMapping:null===(_c=this.parameters)||void 0===_c?void 0:_c.toneMapping}},RenderHelper}(),RGRenderTargetDescription=function(){function RGRenderTargetDescription(format){this.format=format,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load"}return RGRenderTargetDescription.prototype.setDimensions=function(width,height,sampleCount){this.width=width,this.height=height,this.sampleCount=sampleCount},RGRenderTargetDescription.prototype.copyDimensions=function(desc){this.width=desc.width,this.height=desc.height,this.sampleCount=desc.sampleCount},RGRenderTargetDescription}();function makeAttachmentClearDescriptor(clearColor){return{colorClearColor:clearColor,depthClearValue:1,stencilClearValue:0}}makeAttachmentClearDescriptor(colorNewFromRGBA(.88,.88,.88,1)),makeAttachmentClearDescriptor(OpaqueBlack);var AntialiasingMode,opaqueWhiteFullClearRenderPassDescriptor=makeAttachmentClearDescriptor(OpaqueWhite);function setBackbufferDescSimple(desc,renderInput){var sampleCount=function selectSampleCount(renderInput){return renderInput.antialiasingMode===AntialiasingMode.MSAAx4?4:1}(renderInput);desc.setDimensions(renderInput.backbufferWidth,renderInput.backbufferHeight,sampleCount)}function makeBackbufferDescSimple(slot,renderInput,clearDescriptor){var pixelFormat=function selectFormatSimple(slot){if(slot===RGAttachmentSlot.Color0)return Format.U8_RGBA_RT;if(slot===RGAttachmentSlot.DepthStencil)return Format.D24_S8;throw new Error("whoops")}(slot),desc=new RGRenderTargetDescription(pixelFormat);return setBackbufferDescSimple(desc,renderInput),null!==clearDescriptor&&(desc.colorClearColor=clearDescriptor.colorClearColor,desc.depthClearValue=clearDescriptor.depthClearValue,desc.stencilClearValue=clearDescriptor.stencilClearValue),desc}!function(AntialiasingMode){AntialiasingMode[AntialiasingMode.None=0]="None",AntialiasingMode[AntialiasingMode.FXAA=1]="FXAA",AntialiasingMode[AntialiasingMode.MSAAx4=2]="MSAAx4"}(AntialiasingMode||(AntialiasingMode={}));var FogType,TextureMapping=function(){function TextureMapping(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}return TextureMapping.prototype.reset=function(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0},TextureMapping.prototype.copy=function(other){this.texture=other.texture,this.sampler=other.sampler,this.width=other.width,this.height=other.height,this.lodBias=other.lodBias},TextureMapping}(),Light=(function(){function TemporalTexture(){this.inputTexture=null,this.outputTexture=null}TemporalTexture.prototype.setDescription=function(device,desc){this.inputTexture!==this.outputTexture&&(null!==this.inputTexture&&this.inputTexture.destroy(),this.inputTexture=this.outputTexture),es_assert(this.inputTexture===this.outputTexture),null!==this.outputTexture&&this.outputTexture.matchesDescription(desc)||(this.outputTexture=new SingleSampledTexture(device,desc),null===this.inputTexture&&(this.inputTexture=this.outputTexture))},TemporalTexture.prototype.getTextureForSampling=function(){return null!==this.inputTexture?this.inputTexture.texture:null},TemporalTexture.prototype.getTextureForResolving=function(){var _a;return null===(_a=this.outputTexture)||void 0===_a?void 0:_a.texture},TemporalTexture.prototype.destroy=function(){null!==this.outputTexture&&this.outputTexture!==this.inputTexture&&(this.outputTexture.destroy(),this.outputTexture=null),null!==this.inputTexture&&(this.inputTexture.destroy(),this.inputTexture=null)}}(),function(_super){function Light(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Light.tag,style:(0,tslib_es6.Cl)({intensity:Math.PI},style)},rest))||this}return(0,tslib_es6.C6)(Light,_super),Light.tag="light",Light}(DisplayObject));!function(FogType){FogType[FogType.NONE=0]="NONE",FogType[FogType.EXP=1]="EXP",FogType[FogType.EXP2=2]="EXP2",FogType[FogType.LINEAR=3]="LINEAR"}(FogType||(FogType={}));var GeometryEvent,Fog=function(_super){function Fog(_a){void 0===_a&&(_a={});var style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({type:Fog.tag,style:(0,tslib_es6.Cl)({type:FogType.NONE,fill:"black",start:1,end:1e3,density:0},style)},rest))||this}return(0,tslib_es6.C6)(Fog,_super),Fog.tag="fog",Fog}(DisplayObject);function makeDataBuffer(device,usage,data,hint){void 0===hint&&(hint=BufferFrequencyHint.STATIC);var buffer=device.createBuffer({viewOrSize:data.byteLength,usage,hint});return buffer.setSubData(0,new Uint8Array(data)),buffer}!function(GeometryEvent){GeometryEvent.CHANGED="changed"}(GeometryEvent||(GeometryEvent={}));var geometry,inputLayout,BufferGeometry=function(_super){function BufferGeometry(device,props){void 0===props&&(props={});var _this=_super.call(this)||this;return _this.device=device,_this.props=props,_this.drawMode=PrimitiveTopology.TRIANGLES,_this.vertexBuffers=[],_this.vertices=[],_this.inputLayoutDescriptor={vertexBufferDescriptors:[],indexBufferFormat:null,program:null},_this.vertexCount=0,_this.instancedCount=0,_this.indexStart=0,_this.primitiveStart=0,_this.dirty=!0,_this.meshes=[],_this}return(0,tslib_es6.C6)(BufferGeometry,_super),BufferGeometry.prototype.validate=function(mesh){return!0},BufferGeometry.prototype.build=function(meshes){},BufferGeometry.prototype.computeBoundingBox=function(){return new AABB},BufferGeometry.prototype.setIndexBuffer=function(indices){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=makeDataBuffer(this.device,BufferUsage.INDEX,new Uint32Array(ArrayBuffer.isView(indices)?indices.buffer:indices).buffer),this.indices=indices,this.inputLayoutDescriptor.indexBufferFormat=Format.U32_R,this},BufferGeometry.prototype.setVertexBuffer=function(descriptor){var _this=this,bufferIndex=descriptor.bufferIndex,byteStride=descriptor.byteStride,stepMode=descriptor.stepMode,attributes=descriptor.attributes,data=descriptor.data;this.inputLayoutDescriptor.vertexBufferDescriptors[bufferIndex]={arrayStride:byteStride,stepMode,attributes:[]},this.vertices[bufferIndex]=data,attributes.forEach((function(_a){var format=_a.format,bufferByteOffset=_a.bufferByteOffset,location=_a.location,divisor=_a.divisor;_a.byteStride;var existed=_this.inputLayoutDescriptor.vertexBufferDescriptors[bufferIndex].attributes.find((function(e){return e.shaderLocation===location}));existed?(existed.format=format,existed.offset=bufferByteOffset,existed.divisor=divisor):_this.inputLayoutDescriptor.vertexBufferDescriptors[bufferIndex].attributes.push({format,offset:bufferByteOffset,shaderLocation:location,divisor})})),this.vertexBuffers[bufferIndex]&&this.vertexBuffers[bufferIndex].destroy();var buffer=makeDataBuffer(this.device,BufferUsage.VERTEX,data.buffer,BufferFrequencyHint.DYNAMIC);return this.vertexBuffers[bufferIndex]=buffer,this},BufferGeometry.prototype.getVertexBuffer=function(bufferIndex){return this.vertexBuffers[bufferIndex]},BufferGeometry.prototype.updateVertexBuffer=function(bufferIndex,location,index,data){var bufferDescriptor=this.inputLayoutDescriptor.vertexBufferDescriptors[bufferIndex];if(bufferDescriptor){var arrayStride=bufferDescriptor.arrayStride,descriptor=this.inputLayoutDescriptor.vertexBufferDescriptors[bufferIndex].attributes.find((function(d){return d.shaderLocation===location}));if(descriptor){var offset=index*arrayStride;this.getVertexBuffer(bufferIndex).setSubData(descriptor.offset+offset,data)}this.emit(GeometryEvent.CHANGED)}},BufferGeometry.prototype.updateIndices=function(indices,offset){return void 0===offset&&(offset=0),this.indexBuffer&&this.indexBuffer.setSubData(offset,new Uint8Array(ArrayBuffer.isView(indices)?indices:new Uint32Array(indices))),this},BufferGeometry.prototype.destroy=function(){this.vertexBuffers.forEach((function(buffer){buffer&&buffer.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0},BufferGeometry}(_antv_g_plugin_device_renderer_node_modules_eventemitter3),FXAAProgram=function(_super){function FXAAProgram(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.features={},_this.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",_this.vert="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",_this.frag="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",_this}return(0,tslib_es6.C6)(FXAAProgram,_super),FXAAProgram}(DeviceProgram),textureMapping=nArray(1,(function(){return new TextureMapping}));var SceneUniform;!function(SceneUniform){SceneUniform.PROJECTION_MATRIX="u_ProjectionMatrix",SceneUniform.VIEW_MATRIX="u_ViewMatrix",SceneUniform.CAMERA_POSITION="u_CameraPosition",SceneUniform.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",SceneUniform.VIEWPORT="u_Viewport",SceneUniform.IS_ORTHO="u_IsOrtho",SceneUniform.IS_PICKING="u_IsPicking"}(SceneUniform||(SceneUniform={}));var MaterialEvent,RenderGraphPlugin=function(){function RenderGraphPlugin(renderHelper,lightPool,texturePool,batchManager,options){this.renderHelper=renderHelper,this.lightPool=lightPool,this.texturePool=texturePool,this.batchManager=batchManager,this.options=options,this.renderLists={world:new RenderInstList,picking:new RenderInstList}}return RenderGraphPlugin.prototype.getDevice=function(){return this.device},RenderGraphPlugin.prototype.getSwapChain=function(){return this.swapChain},RenderGraphPlugin.prototype.getRenderLists=function(){return this.renderLists},RenderGraphPlugin.prototype.apply=function(context){var _this=this;this.context=context;var renderingService=context.renderingService,renderingContext=context.renderingContext,config=context.config,canvas=renderingContext.root.ownerDocument.defaultView;config.disableRenderHooks=!0;var handleMounted=function(e){var object=e.target;object.nodeName!==Light.tag?object.nodeName!==Fog.tag?(object.renderable3D||(object.renderable3D=new Renderable3D),_this.batchManager.add(object)):_this.lightPool.addFog(object):_this.lightPool.addLight(object)},handleUnmounted=function(e){var _a,_b,object=e.target;if(object.nodeName!==Light.tag)if(object.nodeName!==Fog.tag){if(object.nodeName===Shape.MESH){var index;if(null===(_a=object.style.geometry)||void 0===_a?void 0:_a.meshes)(index=object.style.geometry.meshes.indexOf(object))>-1&&object.style.geometry.meshes.splice(index,1);if(null===(_b=object.style.material)||void 0===_b?void 0:_b.meshes)(index=object.style.material.meshes.indexOf(object))>-1&&object.style.material.meshes.splice(index,1)}_this.swapChain&&_this.batchManager.remove(object),delete object.renderable3D}else _this.lightPool.removeFog(object);else _this.lightPool.removeLight(object)},handleAttributeChanged=function(e){if(_this.swapChain){var object=e.target,attrName=e.attrName,newValue=e.newValue;"zIndex"===attrName?object.parentNode.forEach((function(child){_this.batchManager.changeRenderOrder(child,child.sortable.renderOrder)})):_this.batchManager.updateAttribute(object,attrName,newValue)}},handleBoundsChanged=function(e){if(_this.swapChain){var object=e.target;_this.batchManager.updateAttribute(object,"modelMatrix",null)}};renderingService.hooks.initAsync.tapPromise(RenderGraphPlugin.tag,(function(){return(0,tslib_es6.sH)(_this,void 0,void 0,(function(){var $canvas,_a,width,height,_b,_this=this;return(0,tslib_es6.YH)(this,(function(_c){switch(_c.label){case 0:return canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.addEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.addEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged),this.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,$canvas=this.context.contextService.getDomElement(),_a=this.context.config,width=_a.width,height=_a.height,this.context.contextService.resize(width,height),_b=this,[4,this.context.deviceContribution.createSwapChain($canvas)];case 1:return _b.swapChain=_c.sent(),this.device=this.swapChain.getDevice(),this.renderHelper.setDevice(this.device),this.renderHelper.renderInstManager.disableSimpleMode(),this.swapChain.configureSwapChain($canvas.width,$canvas.height),canvas.addEventListener(CanvasEvent.RESIZE,(function(){_this.swapChain.configureSwapChain($canvas.width,$canvas.height)})),this.batchManager.attach((0,tslib_es6.Cl)({device:this.device},context)),[2]}}))}))})),renderingService.hooks.destroy.tap(RenderGraphPlugin.tag,(function(){_this.renderHelper.destroy(),_this.batchManager.destroy(),_this.texturePool.destroy(),canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.removeEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.removeEventListener(ElementEvent.BOUNDS_CHANGED,handleBoundsChanged),_this.device.destroy(),_this.device.checkForLeaks(),config.disableRenderHooks=!1})),renderingService.hooks.beginFrame.tap(RenderGraphPlugin.tag,(function(){var _a,clearColor,canvas=_this.swapChain.getCanvas(),renderInstManager=_this.renderHelper.renderInstManager;if(_this.builder=_this.renderHelper.renderGraph.newGraphBuilder(),"transparent"===_this.context.config.background)clearColor=TransparentBlack;else{var backgroundColor=parseColor(_this.context.config.background);clearColor=_this.context.config.background?colorNewFromRGBA(Number(backgroundColor.r)/255*Number(backgroundColor.alpha),Number(backgroundColor.g)/255*Number(backgroundColor.alpha),Number(backgroundColor.b)/255*Number(backgroundColor.alpha),Number(backgroundColor.alpha)):TransparentWhite}var renderInput={backbufferWidth:canvas.width,backbufferHeight:canvas.height,antialiasingMode:AntialiasingMode.None},mainRenderDesc=makeBackbufferDescSimple(RGAttachmentSlot.Color0,renderInput,makeAttachmentClearDescriptor(clearColor)),mainDepthDesc=makeBackbufferDescSimple(RGAttachmentSlot.DepthStencil,renderInput,opaqueWhiteFullClearRenderPassDescriptor),mainColorTargetID=_this.builder.createRenderTargetID(mainRenderDesc,"Main Color"),mainDepthTargetID=_this.builder.createRenderTargetID(mainDepthDesc,"Main Depth");_this.builder.pushPass((function(pass){pass.setDebugName("Main Render Pass"),pass.attachRenderTargetID(RGAttachmentSlot.Color0,mainColorTargetID),pass.attachRenderTargetID(RGAttachmentSlot.DepthStencil,mainDepthTargetID),pass.exec((function(passRenderer){_this.renderLists.world.drawOnPassRenderer(renderInstManager.renderCache,passRenderer)}))})),(null===(_a=_this.options)||void 0===_a?void 0:_a.enableFXAA)&&function pushFXAAPass(builder,renderHelper,renderInput,mainColorTargetID){builder.pushPass((function(pass){pass.setDebugName("FXAA"),pass.attachRenderTargetID(RGAttachmentSlot.Color0,mainColorTargetID);var mainColorResolveTextureID=builder.resolveRenderTarget(mainColorTargetID);pass.attachResolveTexture(mainColorResolveTextureID);var renderInst=renderHelper.renderInstManager.newRenderInst();renderInst.setUniformBuffer(renderHelper.uniformBuffer),renderInst.setAllowSkippingIfPipelineNotReady(!1),renderInst.setMegaStateFlags(fullscreenMegaState),renderInst.setBindingLayout({numUniformBuffers:1,numSamplers:1}),renderInst.drawPrimitives(3);var offs=renderInst.allocateUniformBuffer(0,4);fillVec4(renderInst.mapUniformBufferF32(0),offs,1/renderInput.backbufferWidth,1/renderInput.backbufferHeight);var fxaaProgram=new FXAAProgram,program=renderHelper.renderCache.createProgramSimple(fxaaProgram);renderInst.setProgram(program),geometry||((geometry=new BufferGeometry(renderHelper.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([1,3,-3,-1,1,-1])}),geometry.vertexCount=3,inputLayout=renderHelper.getCache().createInputLayout(geometry.inputLayoutDescriptor)),pass.exec((function(passRenderer,scope){textureMapping[0].texture=scope.getResolveTextureForID(mainColorResolveTextureID),renderInst.setSamplerBindingsFromTextureMappings(textureMapping),renderInst.setVertexInput(inputLayout,geometry.vertexBuffers.map((function(buffer){return{buffer,byteOffset:0}})),null),renderInst.drawOnPass(renderHelper.renderCache,passRenderer)}))}))}(_this.builder,_this.renderHelper,renderInput,mainColorTargetID),_this.builder.resolveRenderTargetToExternalTexture(mainColorTargetID,_this.swapChain.getOnscreenTexture())})),renderingService.hooks.endFrame.tap(RenderGraphPlugin.tag,(function(){var renderInstManager=_this.renderHelper.renderInstManager,template=_this.renderHelper.pushTemplateRenderInst();template.setBindingLayout({numUniformBuffers:2,numSamplers:0}),template.setMegaStateFlags(setAttachmentStateSimple({depthWrite:!0,blendConstant:TransparentBlack},{rgbBlendMode:BlendMode.ADD,alphaBlendMode:BlendMode.ADD,rgbBlendSrcFactor:BlendFactor.SRC_ALPHA,alphaBlendSrcFactor:BlendFactor.ONE,rgbBlendDstFactor:BlendFactor.ONE_MINUS_SRC_ALPHA,alphaBlendDstFactor:BlendFactor.ONE_MINUS_SRC_ALPHA}));var _a=_this.context.config,width=_a.width,height=_a.height,camera=_this.context.camera;if(template.setUniforms(0,[{name:SceneUniform.PROJECTION_MATRIX,value:camera.getPerspective()},{name:SceneUniform.VIEW_MATRIX,value:camera.getViewTransform()},{name:SceneUniform.CAMERA_POSITION,value:camera.getPosition()},{name:SceneUniform.DEVICE_PIXEL_RATIO,value:_this.context.contextService.getDPR()},{name:SceneUniform.VIEWPORT,value:[width,height]},{name:SceneUniform.IS_ORTHO,value:camera.isOrtho()?1:0},{name:SceneUniform.IS_PICKING,value:0}]),_this.batchManager.render(_this.renderLists.world),renderInstManager.popTemplateRenderInst(),_this.renderHelper.prepareToRender(),_this.renderHelper.renderGraph.execute(),renderInstManager.resetRenderInsts(),_this.enableCapture&&_this.resolveCapturePromise){var _b=_this.captureOptions,type=_b.type,encoderOptions=_b.encoderOptions,dataURL=_this.context.contextService.getDomElement().toDataURL(type,encoderOptions);_this.resolveCapturePromise(dataURL),_this.enableCapture=!1,_this.captureOptions=void 0,_this.resolveCapturePromise=void 0}}))},RenderGraphPlugin.prototype.loadTexture=function(src,descriptor,successCallback){return this.texturePool.getOrCreateTexture(this.device,src,descriptor,(function(t){successCallback&&successCallback(t)}))},RenderGraphPlugin.prototype.toDataURL=function(options){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var _this=this;return(0,tslib_es6.YH)(this,(function(_a){return this.enableCapture=!0,this.captureOptions=options,this.capturePromise=new Promise((function(resolve){_this.resolveCapturePromise=function(dataURL){resolve(dataURL)}})),[2,this.capturePromise]}))}))},RenderGraphPlugin.tag="RenderGraph",RenderGraphPlugin}(),PickingPlugin=function(){function PickingPlugin(renderHelper,renderGraphPlugin,pickingIdGenerator,batchManager){this.renderHelper=renderHelper,this.renderGraphPlugin=renderGraphPlugin,this.pickingIdGenerator=pickingIdGenerator,this.batchManager=batchManager}return PickingPlugin.prototype.apply=function(context){var _this=this;this.context=context;var renderingService=context.renderingService,canvas=context.renderingContext.root.ownerDocument.defaultView,handleMounted=function(e){var object=e.target;object.renderable3D||(object.renderable3D=new Renderable3D);var renderable3D=object.renderable3D,pickingId=_this.pickingIdGenerator.getId(object);renderable3D.pickingId=pickingId,renderable3D.encodedPickingColor=_this.pickingIdGenerator.encodePickingColor(pickingId)},handleUnmounted=function(e){var renderable3D=e.target.renderable3D;renderable3D&&_this.pickingIdGenerator.deleteById(renderable3D.pickingId)};renderingService.hooks.init.tap(PickingPlugin.tag,(function(){canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted)})),renderingService.hooks.destroy.tap(PickingPlugin.tag,(function(){canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),_this.pickingIdGenerator.reset()})),renderingService.hooks.pickSync.tap(PickingPlugin.tag,(function(result){return _this.pick(result)})),renderingService.hooks.pick.tapPromise(PickingPlugin.tag,(function(result){return(0,tslib_es6.sH)(_this,void 0,void 0,(function(){return(0,tslib_es6.YH)(this,(function(_a){return[2,this.pick(result)]}))}))}))},PickingPlugin.prototype.pick=function(result){var topmost=result.topmost,position=result.position,x=position.viewportX,y=position.viewportY,dpr=this.context.contextService.getDPR(),width=this.context.config.width*dpr,height=this.context.config.height*dpr,xInDevicePixel=x*dpr,yInDevicePixel=y*dpr;if(!this.renderHelper.renderGraph||xInDevicePixel>width||xInDevicePixel<0||yInDevicePixel>height||yInDevicePixel<0)return result.picked=[],result;var pickedDisplayObjects=this.pickByRectangleInDepth(new Rectangle(lodash_clamp(Math.round(xInDevicePixel),0,width-1),lodash_clamp(Math.round(yInDevicePixel),0,height-1),1,1),topmost?1:100);return result.picked=pickedDisplayObjects,result},PickingPlugin.prototype.pickByRectangleInDepth=function(rect,depth){void 0===depth&&(depth=100);var picked=null,counter=1,targets=[];do{if(!(picked=this.pickByRectangle(rect,picked)))break;counter++,targets.push(picked)}while(picked&&counter<=depth);return depth>1&&this.restorePickingColor(targets),targets},PickingPlugin.prototype.restorePickingColor=function(displayObjects){var _this=this;displayObjects.forEach((function(picked){_this.batchManager.updateAttribute(picked,"pointerEvents",!0,!0)}))},PickingPlugin.prototype.pickByRectangle=function(rect,picked){var target,_this=this,device=this.renderGraphPlugin.getDevice(),renderLists=this.renderGraphPlugin.getRenderLists(),renderInstManager=this.renderHelper.renderInstManager,builder=this.renderHelper.renderGraph.newGraphBuilder(),clearColor=TransparentBlack,camera=this.context.camera,x=rect.x,y=rect.y,width=rect.width,height=rect.height,renderInput={backbufferWidth:width,backbufferHeight:height,antialiasingMode:AntialiasingMode.None},mainPickingDesc=makeBackbufferDescSimple(RGAttachmentSlot.Color0,renderInput,makeAttachmentClearDescriptor(clearColor)),pickingColorTargetID=builder.createRenderTargetID(mainPickingDesc,"Picking Color"),mainDepthDesc=makeBackbufferDescSimple(RGAttachmentSlot.DepthStencil,renderInput,opaqueWhiteFullClearRenderPassDescriptor),mainDepthTargetID=builder.createRenderTargetID(mainDepthDesc,"Picking Depth"),currentView=(0,tslib_es6.Cl)({},camera.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(rt){rt.age=-1})),builder.pushPass((function(pass){pass.setDebugName("Picking Pass"),pass.attachRenderTargetID(RGAttachmentSlot.Color0,pickingColorTargetID),pass.attachRenderTargetID(RGAttachmentSlot.DepthStencil,mainDepthTargetID),pass.exec((function(passRenderer){renderLists.picking.drawOnPassRenderer(renderInstManager.renderCache,passRenderer)})),pass.post((function(scope){var pickedColors,texture=scope.getRenderTargetTexture(RGAttachmentSlot.Color0),readback=device.createReadback();currentView&&currentView.enabled?camera.setViewOffset(currentView.fullWidth,currentView.fullHeight,currentView.offsetX,currentView.offsetY,currentView.width,currentView.height):camera.clearViewOffset(),camera.setEnableUpdate(!0);try{pickedColors=readback.readTextureSync(texture,0,0,width,height,new Uint8Array(width*height*4))}catch(e){}var pickedFeatureIdx=-1;if(!pickedColors||0===pickedColors[0]&&0===pickedColors[1]&&0===pickedColors[2]||(pickedFeatureIdx=_this.pickingIdGenerator.decodePickingColor(pickedColors)),pickedFeatureIdx>-1){var pickedDisplayObject=_this.pickingIdGenerator.getById(pickedFeatureIdx);pickedDisplayObject&&pickedDisplayObject.isVisible()&&pickedDisplayObject.isInteractive()&&(target=pickedDisplayObject)}readback.destroy()}))}));var template=this.renderHelper.pushTemplateRenderInst();template.setBindingLayout({numUniformBuffers:2,numSamplers:0}),template.setMegaStateFlags(setAttachmentStateSimple({depthWrite:!0},{rgbBlendMode:BlendMode.ADD,rgbBlendSrcFactor:BlendFactor.ONE,rgbBlendDstFactor:BlendFactor.ZERO,alphaBlendMode:BlendMode.ADD,alphaBlendSrcFactor:BlendFactor.ONE,alphaBlendDstFactor:BlendFactor.ZERO}));var _a=this.context.config,canvasWidth=_a.width,canvasHeight=_a.height,dpr=this.context.contextService.getDPR();return camera.setEnableUpdate(!1),camera.setViewOffset(canvasWidth*dpr,canvasHeight*dpr,x,y,width,height),template.setUniforms(0,[{name:SceneUniform.PROJECTION_MATRIX,value:camera.getPerspective()},{name:SceneUniform.VIEW_MATRIX,value:camera.getViewTransform()},{name:SceneUniform.CAMERA_POSITION,value:camera.getPosition()},{name:SceneUniform.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:SceneUniform.VIEWPORT,value:[width,height]},{name:SceneUniform.IS_ORTHO,value:camera.isOrtho()?1:0},{name:SceneUniform.IS_PICKING,value:1}]),picked&&this.batchManager.updateAttribute(picked,"pointerEvents",!1,!0),this.batchManager.render(renderLists.picking,!0),renderInstManager.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),renderInstManager.resetRenderInsts(),target},PickingPlugin.tag="WebGLPicker",PickingPlugin}(),Batch=function(){function Batch(){this.clipPathMeshCreated=!1}return Batch.prototype.beforeUploadUBO=function(renderInst,mesh){},Batch.prototype.beforeInitMesh=function(mesh){},Batch.prototype.afterInitMesh=function(mesh){},Batch}();!function(MaterialEvent){MaterialEvent.CHANGED="changed"}(MaterialEvent||(MaterialEvent={}));var Material=function(_super){function Material(device,props){var _this=_super.call(this)||this;_this.props={},_this.meshes=[],_this.defines={},_this.uniforms={},_this.uboBuffer=[],_this.textures={},_this.samplers=[],_this.programDirty=!0,_this.textureDirty=!0,_this.geometryDirty=!0;var _a=copyMegaState(defaultMegaState),cullMode=_a.cullMode,depthCompare=_a.depthCompare,depthWrite=_a.depthWrite,stencilFront=_a.stencilFront,stencilBack=_a.stencilBack,stencilWrite=_a.stencilWrite,frontFace=_a.frontFace,polygonOffset=_a.polygonOffset,attachmentsState=_a.attachmentsState;return _this.device=device,_this.props=(0,tslib_es6.Cl)({cullMode,depthTest:!0,depthCompare,depthWrite,stencilFront,stencilBack,stencilWrite,frontFace,polygonOffset,attachmentsState,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},props),_this.compile(),_this}return(0,tslib_es6.C6)(Material,_super),Object.defineProperty(Material.prototype,"cullMode",{get:function(){return this.props.cullMode},set:function(value){this.props.cullMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"frontFace",{get:function(){return this.props.frontFace},set:function(value){this.props.frontFace=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendConstant",{get:function(){return this.props.blendConstant},set:function(value){this.props.blendConstant=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendEquation",{get:function(){return this.props.blendEquation},set:function(value){this.props.blendEquation=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendEquationAlpha",{get:function(){return this.props.blendEquationAlpha},set:function(value){this.props.blendEquationAlpha=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendSrc",{get:function(){return this.props.blendSrc},set:function(value){this.props.blendSrc=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendDst",{get:function(){return this.props.blendDst},set:function(value){this.props.blendDst=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendSrcAlpha",{get:function(){return this.props.blendSrcAlpha},set:function(value){this.props.blendSrcAlpha=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blendDstAlpha",{get:function(){return this.props.blendDstAlpha},set:function(value){this.props.blendDstAlpha=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"depthCompare",{get:function(){return this.props.depthCompare},set:function(value){this.props.depthCompare=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"depthTest",{get:function(){return this.props.depthTest},set:function(value){this.props.depthTest=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"depthWrite",{get:function(){return this.props.depthWrite},set:function(value){this.props.depthWrite=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"stencilFront",{get:function(){return this.props.stencilFront},set:function(value){this.props.stencilFront=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"stencilBack",{get:function(){return this.props.stencilBack},set:function(value){this.props.stencilBack=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"stencilWrite",{get:function(){return this.props.stencilWrite},set:function(value){this.props.stencilWrite=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"stencilRef",{get:function(){return this.props.stencilRef},set:function(value){this.props.stencilRef=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"polygonOffset",{get:function(){return this.props.polygonOffset},set:function(value){this.props.polygonOffset=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"dithering",{get:function(){return this.props.dithering},set:function(value){this.props.dithering=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"wireframe",{get:function(){return this.props.wireframe},set:function(value){this.props.wireframe!==value&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=value,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"wireframeColor",{get:function(){return this.props.wireframeColor},set:function(value){this.props.wireframeColor=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"wireframeLineWidth",{get:function(){return this.props.wireframeLineWidth},set:function(value){this.props.wireframeLineWidth=value},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"vertexShader",{get:function(){return this.props.vertexShader},set:function(value){this.props.vertexShader!==value&&(this.programDirty=!0,this.props.vertexShader=value,this.compile())},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"fragmentShader",{get:function(){return this.props.fragmentShader},set:function(value){this.props.fragmentShader!==value&&(this.programDirty=!0,this.props.fragmentShader=value,this.compile())},enumerable:!1,configurable:!0}),Material.prototype.compile=function(){var _this=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(_,name){return _this.samplers.push(name),""})),this.uniformNames=function getUniforms(vert){var uniformNames=[],structs=[];return vert.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(_,type,uniformStr){var uniforms=[];return uniformStr.trim().replace("\r\n","\n").split("\n").forEach((function(line){var _a=(0,tslib_es6.zs)(line.trim().split(/\s+/),2),type=_a[0],name=_a[1];uniforms.push({type:type.trim(),name:name.replace(";","").trim()})})),structs.push({type:type.trim(),uniforms}),""})),vert.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,(function(_,uniforms){return uniforms.trim().replace("\r\n","\n").split("\n").forEach((function(line){var result=line.trim().split(" "),type=result[0]||"",name=result[1]||"",isArray=name.indexOf("[")>-1;if(name=name.replace(";","").replace("[","").trim(),!type.startsWith("#")){if(type){var struct=structs.find((function(struct){return type===struct.type}));if(struct)if(isArray)for(var _loop_1=function(i){struct.uniforms.forEach((function(uniform){uniformNames.push("".concat(name,"[").concat(i,"].").concat(uniform.name))}))},i=0;i<5;i++)_loop_1(i);else struct.uniforms.forEach((function(uniform){uniformNames.push("".concat(name,".").concat(uniform.name))}))}name&&uniformNames.push(name)}})),""})),uniformNames}(this.props.fragmentShader)},Material.prototype.setUniforms=function(uniforms){var _this=this,shoudDispatchMutationEvent=!1;Object.keys(uniforms).forEach((function(key){var value=uniforms[key],existedTexture=_this.textures[key];existedTexture&&existedTexture!==value&&(_this.textureDirty=!0),!function isTexture(t){return!(!t||!t.type)}(value)?(_this.uniforms[key]=value,shoudDispatchMutationEvent=!0):(_this.textures[key]=value,_this.textureDirty=!0,value.on(TextureEvent.LOADED,(function(){_this.dispatchMutationEvent()}))),(0,is_nil.A)(uniforms[key])&&(delete _this.textures[key],delete _this.uniforms[key])})),shoudDispatchMutationEvent&&this.dispatchMutationEvent()},Material.prototype.dispatchMutationEvent=function(){this.emit(MaterialEvent.CHANGED)},Material}(_antv_g_plugin_device_renderer_node_modules_eventemitter3),ShaderMaterial=function(_super){function ShaderMaterial(device,props){var _this=_super.call(this,device,(0,tslib_es6.Cl)({},props))||this;return _this.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},_this.defines),{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),_this}return(0,tslib_es6.C6)(ShaderMaterial,_super),ShaderMaterial}(Material);function enumToObject(enumObject){var result={};return Object.keys(enumObject).forEach((function(key){"number"==typeof enumObject[key]&&(result[key]=enumObject[key])})),result}var index_esm_definedProps=function(obj){return Object.fromEntries(Object.entries(obj).filter((function(_a){var _b=(0,tslib_es6.zs)(_a,2);return _b[0],void 0!==_b[1]})))};function packUint8ToFloat(a,b){return 256*(a=lodash_clamp(Math.floor(a),0,255))+(b=lodash_clamp(Math.floor(b),0,255))}var VertexAttributeBufferIndex,VertexAttributeLocation,counter=1;!function(VertexAttributeBufferIndex){VertexAttributeBufferIndex[VertexAttributeBufferIndex.MODEL_MATRIX=0]="MODEL_MATRIX",VertexAttributeBufferIndex[VertexAttributeBufferIndex.PACKED_COLOR=1]="PACKED_COLOR",VertexAttributeBufferIndex[VertexAttributeBufferIndex.PACKED_STYLE=2]="PACKED_STYLE",VertexAttributeBufferIndex[VertexAttributeBufferIndex.PICKING_COLOR=3]="PICKING_COLOR",VertexAttributeBufferIndex[VertexAttributeBufferIndex.POSITION=4]="POSITION",VertexAttributeBufferIndex[VertexAttributeBufferIndex.NORMAL=5]="NORMAL",VertexAttributeBufferIndex[VertexAttributeBufferIndex.UV=6]="UV",VertexAttributeBufferIndex[VertexAttributeBufferIndex.BARYCENTRIC=7]="BARYCENTRIC",VertexAttributeBufferIndex[VertexAttributeBufferIndex.MAX=8]="MAX"}(VertexAttributeBufferIndex||(VertexAttributeBufferIndex={})),function(VertexAttributeLocation){VertexAttributeLocation[VertexAttributeLocation.MODEL_MATRIX0=0]="MODEL_MATRIX0",VertexAttributeLocation[VertexAttributeLocation.MODEL_MATRIX1=1]="MODEL_MATRIX1",VertexAttributeLocation[VertexAttributeLocation.MODEL_MATRIX2=2]="MODEL_MATRIX2",VertexAttributeLocation[VertexAttributeLocation.MODEL_MATRIX3=3]="MODEL_MATRIX3",VertexAttributeLocation[VertexAttributeLocation.PACKED_COLOR=4]="PACKED_COLOR",VertexAttributeLocation[VertexAttributeLocation.PACKED_STYLE1=5]="PACKED_STYLE1",VertexAttributeLocation[VertexAttributeLocation.PACKED_STYLE2=6]="PACKED_STYLE2",VertexAttributeLocation[VertexAttributeLocation.PICKING_COLOR=7]="PICKING_COLOR",VertexAttributeLocation[VertexAttributeLocation.POSITION=8]="POSITION",VertexAttributeLocation[VertexAttributeLocation.NORMAL=9]="NORMAL",VertexAttributeLocation[VertexAttributeLocation.UV=10]="UV",VertexAttributeLocation[VertexAttributeLocation.BARYCENTRIC=11]="BARYCENTRIC",VertexAttributeLocation[VertexAttributeLocation.MAX=12]="MAX"}(VertexAttributeLocation||(VertexAttributeLocation={}));var SDFVertexAttributeBufferIndex,SDFVertexAttributeLocation,Instanced=function(){function Instanced(renderHelper,texturePool,lightPool,object,drawcallCtors,index,context){void 0===index&&(index=-1),this.renderHelper=renderHelper,this.texturePool=texturePool,this.lightPool=lightPool,this.drawcallCtors=drawcallCtors,this.index=index,this.context=context,this.id=counter++,this.gradientAttributeName="fill",this.objects=[],this.program=new DeviceProgram,this.geometryDirty=!0,this.materialDirty=!0,this.textureMappings=[],this.divisor=1,this.mergeAnchorIntoModelMatrix=!1,this.checkNodeName=!0,this.maxInstances=1/0,this.inited=!1}return Object.defineProperty(Instanced.prototype,"instance",{get:function(){return this.objects[0]},enumerable:!1,configurable:!0}),Instanced.prototype.init=function(){this.inited||(this.renderer.beforeInitMesh(this),this.material=new ShaderMaterial(this.context.device),this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},enumToObject(VertexAttributeLocation)),this.material.defines),this.geometry=new BufferGeometry(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))},Instanced.prototype.observeGeometryChanged=function(){var _this=this;this.geometry.on(GeometryEvent.CHANGED,(function(){_this.geometry.meshes.forEach((function(mesh){mesh.renderable.dirty=!0})),_this.context.renderingService.dirtify()}))},Instanced.prototype.observeMaterialChanged=function(){var _this=this;this.material.on(MaterialEvent.CHANGED,(function(){_this.material.meshes.forEach((function(mesh){mesh.renderable.dirty=!0})),_this.context.renderingService.dirtify()}))},Instanced.prototype.shouldMergeColor=function(o1,o2,name){var source=o1.parsedStyle[name],target=o2.parsedStyle[name];return!(!isCSSRGB(source)||!isCSSRGB(target))||(!(!isPattern(source)||!isPattern(target)||source.image!==target.image)||!(!Array.isArray(source)||!Array.isArray(target)||o1.style[name]!==o2.style[name]))},Instanced.prototype.shouldMerge=function(object,index){return!this.instance||(!this.checkNodeName||this.instance.nodeName===object.nodeName)&&(!object.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,object,"fill")||!this.shouldMergeColor(this.instance,object,"stroke")))},Instanced.prototype.createGeometry=function(objects){var _this=this,modelMatrix=mat4_create(),modelViewMatrix=mat4_create(),packedModelMatrix=[],packedFillStroke=[],packedStyle=[],packedPicking=[],divisor=this.divisor;objects.forEach((function(object){var _a,_b=object.parsedStyle,fill=_b.fill,stroke=_b.stroke,opacity=_b.opacity,fillOpacity=_b.fillOpacity,strokeOpacity=_b.strokeOpacity,lineWidth=_b.lineWidth,anchor=_b.anchor,visibility=_b.visibility,increasedLineWidthForHitTesting=_b.increasedLineWidthForHitTesting,fillColor=[0,0,0,0];isCSSRGB(fill)&&(fillColor=[Number(fill.r),Number(fill.g),Number(fill.b),255*Number(fill.alpha)]);var strokeColor=[0,0,0,0];isCSSRGB(stroke)&&(strokeColor=[Number(stroke.r),Number(stroke.g),Number(stroke.b),255*Number(stroke.alpha)]),mat4_mul(modelViewMatrix,_this.context.camera.getViewTransform(),modelMatrix);var encodedPickingColor=object.isInteractive()&&(null===(_a=object.renderable3D)||void 0===_a?void 0:_a.encodedPickingColor)||[0,0,0];if(_this.mergeAnchorIntoModelMatrix){var anchor_1=object.parsedStyle.anchor,translateX=0,translateY=0,translateZ=0,contentBounds=object.getGeometryBounds();if(contentBounds){var halfExtents=contentBounds.halfExtents;translateX=-halfExtents[0]*anchor_1[0]*2,translateY=-halfExtents[1]*anchor_1[1]*2,translateZ=-halfExtents[2]*(anchor_1[2]||0)*2}mat4_mul(modelMatrix,object.getWorldTransform(),fromTranslation(modelMatrix,fromValues(translateX,translateY,translateZ)))}else mat4_copy(modelMatrix,object.getWorldTransform());packedModelMatrix.push.apply(packedModelMatrix,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(modelMatrix),!1)),packedFillStroke.push(packUint8ToFloat(fillColor[0],fillColor[1]),packUint8ToFloat(fillColor[2],fillColor[3]),packUint8ToFloat(strokeColor[0],strokeColor[1]),packUint8ToFloat(strokeColor[2],strokeColor[3])),packedStyle.push(opacity,fillOpacity,strokeOpacity,lineWidth,"visible"===visibility?1:0,anchor[0],anchor[1],increasedLineWidthForHitTesting||0),packedPicking.push.apply(packedPicking,(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(encodedPickingColor),!1),[5e-4*object.sortable.renderOrder],!1))})),this.geometry.instancedCount=objects.length,this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.MODEL_MATRIX,byteStride:64,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:VertexAttributeLocation.MODEL_MATRIX0,divisor},{format:Format.F32_RGBA,bufferByteOffset:16,location:VertexAttributeLocation.MODEL_MATRIX1,divisor},{format:Format.F32_RGBA,bufferByteOffset:32,location:VertexAttributeLocation.MODEL_MATRIX2,divisor},{format:Format.F32_RGBA,bufferByteOffset:48,location:VertexAttributeLocation.MODEL_MATRIX3,divisor}],data:new Float32Array(packedModelMatrix)}),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.PACKED_COLOR,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:VertexAttributeLocation.PACKED_COLOR,divisor}],data:new Float32Array(packedFillStroke)}),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.PACKED_STYLE,byteStride:32,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:VertexAttributeLocation.PACKED_STYLE1,divisor},{format:Format.F32_RGBA,bufferByteOffset:16,location:VertexAttributeLocation.PACKED_STYLE2,divisor}],data:new Float32Array(packedStyle)}),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.PICKING_COLOR,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:VertexAttributeLocation.PICKING_COLOR,divisor}],data:new Float32Array(packedPicking)})},Instanced.prototype.destroy=function(){this.geometry&&this.geometry.destroy()},Instanced.prototype.applyRenderInst=function(renderInst,objects){var _this=this,useFog=!!this.lightPool.getFog();this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilFront={compare:CompareFunction.ALWAYS,passOp:StencilOp.REPLACE},this.material.stencilBack={compare:CompareFunction.ALWAYS,passOp:StencilOp.REPLACE}):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilFront={compare:CompareFunction.EQUAL,passOp:StencilOp.KEEP},this.material.stencilBack={compare:CompareFunction.EQUAL,passOp:StencilOp.KEEP}):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(objects);var oldDefines=(0,tslib_es6.Cl)({},this.material.defines);if(this.material.defines.USE_FOG=useFog,this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.lightPool.getDefines()),this.material.defines),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var fillTextureMapping=this.createFillGradientTextureMapping(objects);fillTextureMapping&&this.textureMappings.push(fillTextureMapping),Object.keys(this.material.textures).sort((function(a,b){return _this.material.samplers.indexOf(a)-_this.material.samplers.indexOf(b)})).forEach((function(key){var mapping=new TextureMapping;mapping.name=key,mapping.texture=_this.material.textures[key],_this.context.device.setResourceName(mapping.texture,"Material Texture "+key),mapping.sampler=_this.renderHelper.getCache().createSampler({addressModeU:AddressMode.CLAMP_TO_EDGE,addressModeV:AddressMode.CLAMP_TO_EDGE,minFilter:FilterMode.POINT,magFilter:FilterMode.BILINEAR,mipmapFilter:MipmapFilterMode.LINEAR,lodMinClamp:0,lodMaxClamp:0}),_this.textureMappings.push(mapping)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}(!function compareDefines(d1,d2){var d1Keys=Object.keys(d1),d2Keys=Object.keys(d2);return d1Keys.length===d2Keys.length&&d1Keys.every((function(key){return d1[key]===d2[key]}))}(oldDefines,this.material.defines)||this.material.programDirty||this.materialDirty)&&(this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(VertexAttributeLocation)),Object.keys(this.material.defines).forEach((function(key){var value=_this.material.defines[key];"boolean"==typeof value?_this.program.setDefineBool(key,value):_this.program.setDefineString(key,"".concat(value))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(objects),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1);var program=this.renderHelper.getCache().createProgramSimple(this.program),inputLayout=this.renderHelper.getCache().createInputLayout((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.geometry.inputLayoutDescriptor),{program})),useIndexes=!!this.geometry.indexBuffer;renderInst.renderPipelineDescriptor.topology=this.geometry.drawMode,renderInst.setProgram(program),renderInst.setVertexInput(inputLayout,this.geometry.vertexBuffers.filter((function(b){return!!b})).map((function(buffer){return{buffer,byteOffset:0}})),useIndexes?{buffer:this.geometry.indexBuffer,offset:0}:null),this.renderer.beforeUploadUBO(renderInst,this),this.uploadUBO(renderInst),useIndexes?renderInst.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):renderInst.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),renderInst.sortKey=makeSortKeyOpaque(RendererLayer.OPAQUE,objects[0].sortable.renderOrder)},Instanced.prototype.updateBatchedAttribute=function(objects,startIndex,name,value){var _this=this;if(0!==objects.length){if("fill"===name||"stroke"===name){var packedFillStroke_1=[];objects.forEach((function(object){var _a=object.parsedStyle,fill=_a.fill,stroke=_a.stroke,fillColor=[0,0,0,0];isCSSRGB(fill)&&(fillColor=[Number(fill.r),Number(fill.g),Number(fill.b),255*Number(fill.alpha)]);var strokeColor=[0,0,0,0];isCSSRGB(stroke)&&(strokeColor=[Number(stroke.r),Number(stroke.g),Number(stroke.b),255*Number(stroke.alpha)]),packedFillStroke_1.push(packUint8ToFloat(fillColor[0],fillColor[1]),packUint8ToFloat(fillColor[2],fillColor[3]),packUint8ToFloat(strokeColor[0],strokeColor[1]),packUint8ToFloat(strokeColor[2],strokeColor[3]))})),this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.PACKED_COLOR,VertexAttributeLocation.PACKED_COLOR,startIndex,new Uint8Array(new Float32Array(packedFillStroke_1).buffer));var fill=this.instance.parsedStyle.fill,i=this.textureMappings.findIndex((function(m){return"FillTextureMapping"===m.name}));if(isCSSRGB(fill))i>=0&&(this.textureMappings.splice(i,-1),this.material.textureDirty=!0);else{var fillTextureMapping=this.createFillGradientTextureMapping([this.instance]);i>=0&&this.textureMappings.splice(i,1,fillTextureMapping),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(name)>-1){var packed_1=[];objects.forEach((function(object){var _a=object.parsedStyle,opacity=_a.opacity,fillOpacity=_a.fillOpacity,strokeOpacity=_a.strokeOpacity,lineWidth=_a.lineWidth,visibility=_a.visibility,anchor=_a.anchor,increasedLineWidthForHitTesting=_a.increasedLineWidthForHitTesting;packed_1.push(opacity,fillOpacity,strokeOpacity,lineWidth,"visible"===visibility?1:0,anchor[0],anchor[1],increasedLineWidthForHitTesting||0)})),this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.PACKED_STYLE,VertexAttributeLocation.PACKED_STYLE1,startIndex,new Uint8Array(new Float32Array(packed_1).buffer))}else if("modelMatrix"===name){var packed_2=[],modelMatrix_1=mat4_create();objects.forEach((function(object){if(_this.mergeAnchorIntoModelMatrix){var anchor=object.parsedStyle.anchor,translateX=0,translateY=0,translateZ=0,contentBounds=object.getGeometryBounds();if(contentBounds){var halfExtents=contentBounds.halfExtents;translateX=-halfExtents[0]*anchor[0]*2,translateY=-halfExtents[1]*anchor[1]*2,translateZ=-halfExtents[2]*(anchor[2]||0)*2}mat4_mul(modelMatrix_1,object.getWorldTransform(),fromTranslation(modelMatrix_1,fromValues(translateX,translateY,translateZ)))}else mat4_copy(modelMatrix_1,object.getWorldTransform());packed_2.push.apply(packed_2,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(modelMatrix_1),!1))})),this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.MODEL_MATRIX,VertexAttributeLocation.MODEL_MATRIX0,startIndex,new Uint8Array(new Float32Array(packed_2).buffer))}else if("pointerEvents"===name){var packed_3=[];objects.forEach((function(object){var _a,encodedPickingColor=value&&object.isInteractive()&&(null===(_a=object.renderable3D)||void 0===_a?void 0:_a.encodedPickingColor)||[0,0,0];packed_3.push.apply(packed_3,(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(encodedPickingColor),!1),[5e-4*object.sortable.renderOrder],!1))})),this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.PICKING_COLOR,VertexAttributeLocation.PICKING_COLOR,startIndex,new Uint8Array(new Float32Array(packed_3).buffer))}}},Instanced.prototype.updateAttribute=function(objects,startIndex,name,value){"clipPath"===name&&this.clipPath&&(this.geometryDirty=!0)},Instanced.prototype.changeRenderOrder=function(object,renderOrder){var _a,index=this.objects.indexOf(object),encodedPickingColor=object.isInteractive()&&(null===(_a=object.renderable3D)||void 0===_a?void 0:_a.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.PICKING_COLOR,VertexAttributeLocation.PICKING_COLOR,index,new Uint8Array(new Float32Array((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(encodedPickingColor),!1),[5e-4*renderOrder],!1)).buffer))},Instanced.prototype.generateWireframe=function(geometry){for(var indices=geometry.indices,indiceNum=geometry.indices.length,originalVertexBuffers=geometry.vertices.map((function(buffer){return buffer.slice()})),i=VertexAttributeBufferIndex.PICKING_COLOR;i<geometry.vertexBuffers.length;i++){var arrayStride=geometry.inputLayoutDescriptor.vertexBufferDescriptors[i].arrayStride;geometry.vertices[i]=new Float32Array(arrayStride/4*indiceNum)}var cursor=0,uniqueIndices=new Uint32Array(indiceNum);for(i=0;i<indiceNum;i++){for(var ii=indices[i],j=1;j<geometry.vertices.length;j++)for(var size=(arrayStride=geometry.inputLayoutDescriptor.vertexBufferDescriptors[j].arrayStride)/4,k=0;k<size;k++)geometry.vertices[j][cursor*size+k]=originalVertexBuffers[j][ii*size+k];uniqueIndices[i]=cursor,cursor++}for(i=VertexAttributeBufferIndex.PICKING_COLOR+1;i<geometry.vertexBuffers.length;i++){var _a=geometry.inputLayoutDescriptor.vertexBufferDescriptors[i],stepMode=_a.stepMode,descriptor=(arrayStride=_a.arrayStride,geometry.inputLayoutDescriptor.vertexBufferDescriptors[i].attributes[0]);if(descriptor){var location_1=descriptor.shaderLocation,bufferByteOffset=descriptor.offset,format=descriptor.format,divisor=descriptor.divisor;geometry.setVertexBuffer({bufferIndex:i,byteStride:arrayStride,stepMode,attributes:[{format,bufferByteOffset,location:location_1,divisor}],data:geometry.vertices[i]})}}var barycentricBuffer=new Float32Array(3*indiceNum);for(i=0;i<indiceNum;)for(j=0;j<3;j++){barycentricBuffer[3*(ii=uniqueIndices[i++])+j]=1}geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.BARYCENTRIC,byteStride:12,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:Number(VertexAttributeLocation.BARYCENTRIC)}],data:barycentricBuffer}),geometry.setIndexBuffer(uniqueIndices)},Instanced.prototype.beforeUploadUBO=function(renderInst,objects){},Instanced.prototype.uploadUBO=function(renderInst){var _a,_this=this,material=this.material,lights=this.lightPool.getAllLights(),fog=this.lightPool.getFog(),useFog=!!fog,useLight=null!==(_a=material.defines.USE_LIGHT)&&void 0!==_a?_a:!!lights.length,useWireframe=material.defines.USE_WIREFRAME,uniforms=[];if(useWireframe){var wireframeColor=parseColor(material.wireframeColor);uniforms.push({name:"u_WireframeLineColor",value:[Number(wireframeColor.r)/255,Number(wireframeColor.g)/255,Number(wireframeColor.b)/255]}),uniforms.push({name:"u_WireframeLineWidth",value:material.wireframeLineWidth})}if(useFog&&this.uploadFog(uniforms,fog),this.uploadMaterial(uniforms,material),useLight){var counter_1={};lights.forEach((function(light){counter_1[light.define]||(counter_1[light.define]=-1),counter_1[light.define]++,light.uploadUBO(uniforms,counter_1[light.define])}))}uniforms.sort((function(a,b){return _this.material.uniformNames.indexOf(a.name)-_this.material.uniformNames.indexOf(b.name)})),renderInst.setUniforms(1,uniforms);var depthCompare=material.depthCompare,depthWrite=material.depthWrite,stencilFront=material.stencilFront,stencilBack=material.stencilBack,stencilWrite=material.stencilWrite,stencilRef=material.stencilRef,cullMode=material.cullMode,frontFace=material.frontFace,polygonOffset=material.polygonOffset,blendConstant=material.blendConstant,blendEquation=material.blendEquation,blendEquationAlpha=material.blendEquationAlpha,blendSrc=material.blendSrc,blendDst=material.blendDst,blendSrcAlpha=material.blendSrcAlpha,blendDstAlpha=material.blendDstAlpha,materialMegaState=index_esm_definedProps({blendConstant,depthCompare,depthWrite,stencilFront,stencilBack,stencilWrite,stencilRef,cullMode,frontFace,polygonOffset}),currentAttachmentsState=renderInst.getMegaStateFlags().attachmentsState[0];renderInst.setMegaStateFlags((0,tslib_es6.Cl)({attachmentsState:[{channelWriteMask:this.material.stencilWrite?ChannelWriteMask.NONE:ChannelWriteMask.ALL,rgbBlendState:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},currentAttachmentsState.rgbBlendState),index_esm_definedProps({blendMode:blendEquation,blendSrcFactor:blendSrc,blendDstFactor:blendDst})),alphaBlendState:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},currentAttachmentsState.alphaBlendState),index_esm_definedProps({blendMode:blendEquationAlpha,blendSrcFactor:blendSrcAlpha,blendDstFactor:blendDstAlpha}))}]},materialMegaState)),renderInst.setBindingLayout({numUniformBuffers:1,numSamplers:this.textureMappings.length}),renderInst.setSamplerBindingsFromTextureMappings(this.textureMappings)},Instanced.prototype.uploadFog=function(uniforms,fog){var _a=fog.parsedStyle,type=_a.type,fill=_a.fill,start=_a.start,end=_a.end,density=_a.density;if(isCSSRGB(fill)){var fillColor=[Number(fill.r)/255,Number(fill.g)/255,Number(fill.b)/255,Number(fill.alpha)];uniforms.push({name:"u_FogInfos",value:[type,start,end,density]}),uniforms.push({name:"u_FogColor",value:fillColor})}},Instanced.prototype.uploadMaterial=function(uniforms,material){var materialUniforms=Object.keys(material.uniforms).map((function(name){return{name,value:material.uniforms[name]}}));uniforms.push.apply(uniforms,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(materialUniforms),!1))},Instanced.prototype.createFillGradientTextureMapping=function(objects){var texImageSource,_this=this,instance=objects[0],fill=instance.parsedStyle[this.gradientAttributeName];if(fill&&(isPattern(fill)||Array.isArray(fill))){Array.isArray(fill)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:fill,width:128,height:128,instance})):isPattern(fill)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(fill,instance,(function(){objects.forEach((function(object){object.renderable.dirty=!0})),_this.material.textureDirty=!0}))),texImageSource=this.texturePool.getOrCreateCanvas();var texture=this.texturePool.getOrCreateTexture(this.context.device,texImageSource,makeTextureDescriptor2D(Format.U8_RGBA_NORM,1,1,1));if(texture){var fillMapping=new TextureMapping;return fillMapping.name="FillTextureMapping",fillMapping.texture=texture,fillMapping.texture.on("loaded",(function(){objects.forEach((function(object){object.renderable.dirty=!0})),_this.material.textureDirty=!0})),this.context.device.setResourceName(fillMapping.texture,"Fill Texture"+this.id),fillMapping.sampler=this.renderHelper.getCache().createSampler({addressModeU:AddressMode.CLAMP_TO_EDGE,addressModeV:AddressMode.CLAMP_TO_EDGE,minFilter:FilterMode.POINT,magFilter:FilterMode.BILINEAR,mipmapFilter:MipmapFilterMode.LINEAR,lodMinClamp:0,lodMaxClamp:0}),fillMapping}}return null},Instanced}();!function(SDFVertexAttributeBufferIndex){SDFVertexAttributeBufferIndex[SDFVertexAttributeBufferIndex.PACKED_STYLE=5]="PACKED_STYLE"}(SDFVertexAttributeBufferIndex||(SDFVertexAttributeBufferIndex={})),function(SDFVertexAttributeLocation){SDFVertexAttributeLocation[SDFVertexAttributeLocation.PACKED_STYLE3=12]="PACKED_STYLE3",SDFVertexAttributeLocation[SDFVertexAttributeLocation.SIZE=13]="SIZE"}(SDFVertexAttributeLocation||(SDFVertexAttributeLocation={}));var SDF_Shape=[Shape.CIRCLE,Shape.ELLIPSE,Shape.RECT],SDFDrawcall=function(_super){function SDFDrawcall(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(SDFDrawcall,_super),SDFDrawcall.prototype.shouldMerge=function(object,index){return!!_super.prototype.shouldMerge.call(this,object,index)},SDFDrawcall.prototype.createMaterial=function(objects){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm) {\n  vec4 mvPosition = vm * mm * vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec3 a_StylePacked3;\nlayout(location = SIZE) in vec4 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec2 v_Data;\nout vec2 v_Radius;\nout vec3 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size.xy + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size.xy + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n\n  bool isBillboard = a_Size.z > 0.5;\n  if (isBillboard) {\n    float rotation = 0.0;\n    bool isSizeAttenuation = a_Size.w > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else {\n    gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec2(a_Extrude * radius / radius.y);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec2 v_Data;\nin vec2 v_Radius;\nin vec3 v_StylePacked3;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float dist = length(v_Data);\n  float antialiased_blur = -fwidth(dist);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data, 1.0);\n    inner_df = sdCircle(v_Data, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(SDFVertexAttributeLocation))},SDFDrawcall.prototype.createGeometry=function(objects){var _this=this;_super.prototype.createGeometry.call(this,objects);var instanced=[];objects.forEach((function(object,i){var circle=object,radius=circle.parsedStyle.radius,omitStroke=_this.shouldOmitStroke(circle.parsedStyle),size=_this.getSize(object.parsedStyle,circle.nodeName);instanced.push.apply(instanced,(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(size),!1),[circle.parsedStyle.isBillboard?1:0,circle.parsedStyle.isSizeAttenuation?1:0,SDF_Shape.indexOf(circle.nodeName),radius&&radius[0]||0,omitStroke?1:0],!1))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.POSITION,byteStride:16,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:VertexAttributeLocation.POSITION},{format:Format.F32_RG,bufferByteOffset:8,location:VertexAttributeLocation.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:SDFVertexAttributeBufferIndex.PACKED_STYLE,byteStride:28,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:SDFVertexAttributeLocation.SIZE,divisor:1},{format:Format.F32_RGB,bufferByteOffset:16,location:SDFVertexAttributeLocation.PACKED_STYLE3,divisor:1}],data:new Float32Array(instanced)})},SDFDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){var _this=this;if(_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value),"r"===name||"rx"===name||"ry"===name||"width"===name||"height"===name||"lineWidth"===name||"stroke"===name||"lineDash"===name||"strokeOpacity"===name||"radius"===name||"isBillboard"===name||"isSizeAttenuation"===name){var packed_1=[];objects.forEach((function(object){var circle=object,omitStroke=_this.shouldOmitStroke(circle.parsedStyle),_a=(0,tslib_es6.zs)(_this.getSize(object.parsedStyle,object.nodeName),2),size=[_a[0],_a[1]];packed_1.push.apply(packed_1,(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(size),!1),[circle.parsedStyle.isBillboard?1:0,circle.parsedStyle.isSizeAttenuation?1:0,SDF_Shape.indexOf(object.nodeName),object.parsedStyle.radius&&object.parsedStyle.radius[0]||0,omitStroke?1:0],!1))})),this.geometry.updateVertexBuffer(SDFVertexAttributeBufferIndex.PACKED_STYLE,SDFVertexAttributeLocation.SIZE,startIndex,new Uint8Array(new Float32Array(packed_1).buffer))}},SDFDrawcall.prototype.getSize=function(parsed,tagName){var size=[0,0];if(tagName===Shape.CIRCLE){var r=parsed.r;size=[r,r]}else if(tagName===Shape.ELLIPSE){var _a=parsed;size=[_a.rx,_a.ry]}else if(tagName===Shape.RECT){var _b=parsed;size=[_b.width/2,_b.height/2]}return size},SDFDrawcall.prototype.shouldOmitStroke=function(parsedStyle){var lineDash=parsedStyle.lineDash,stroke=parsedStyle.stroke,strokeOpacity=parsedStyle.strokeOpacity,hasStroke=stroke&&!stroke.isNone,hasLineDash=lineDash&&lineDash.length&&lineDash.every((function(item){return 0!==item}));return!hasStroke||hasStroke&&(hasLineDash||strokeOpacity<1)},SDFDrawcall}(Instanced),SEGMENT_LENGTH=10,MIN_SEGMENT_NUM=8,MAX_SEGMENT_NUM=100;function quadCurveTo(cpX,cpY,toX,toY,points,segmentNum){for(var fromX=points[points.length-3],fromY=points[points.length-2],n=null!=segmentNum?segmentNum:lodash_clamp(function index_esm_length(x1,y1,x2,y2,x3,y3){return quadraticLength(x1,y1,x2,y2,x3,y3,3)}(fromX,fromY,cpX,cpY,toX,toY)/SEGMENT_LENGTH,MIN_SEGMENT_NUM,MAX_SEGMENT_NUM),xa=0,ya=0,i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j,0)}}function bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY,points,segmentNum){var fromX=points[points.length-3],fromY=points[points.length-2];points.length-=3;var n=null!=segmentNum?segmentNum:lodash_clamp(function length$3(x1,y1,x2,y2,x3,y3,x4,y4){return cubicLength(x1,y1,x2,y2,x3,y3,x4,y4,3)}(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY)/SEGMENT_LENGTH,MIN_SEGMENT_NUM,MAX_SEGMENT_NUM),dt=0,dt2=0,dt3=0,t2=0,t3=0;points.push(fromX,fromY,0);for(var i=1,j=0;i<=n;++i)dt3=(dt2=(dt=1-(j=i/n))*dt)*dt,t3=(t2=j*j)*j,points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY,0)}var LineVertexAttributeBufferIndex,LineVertexAttributeLocation,INF=1e20,TinySDF=function(){function TinySDF(options,runtime){var _a=options.fontSize,fontSize=void 0===_a?24:_a,_b=options.buffer,buffer=void 0===_b?3:_b,_c=options.radius,radius=void 0===_c?8:_c,_d=options.cutoff,cutoff=void 0===_d?.25:_d,_e=options.fontFamily,fontFamily=void 0===_e?"sans-serif":_e,_f=options.fontWeight,fontWeight=void 0===_f?"normal":_f,_g=options.fontStyle,fontStyle=void 0===_g?"normal":_g,canvas=options.canvas;this.buffer=buffer,this.cutoff=cutoff,this.radius=radius;var size=this.size=fontSize+4*buffer,$offscreenCanvas=runtime.offscreenCanvasCreator.getOrCreateCanvas(canvas);$offscreenCanvas.width=size,$offscreenCanvas.height=size;var ctx=runtime.offscreenCanvasCreator.getOrCreateContext(canvas,{willReadFrequently:!0});this.ctx=ctx,ctx.font="".concat(fontStyle," ").concat(fontWeight," ").concat(fontSize,"px ").concat(fontFamily),ctx.textBaseline="alphabetic",ctx.textAlign="left",ctx.fillStyle="black",this.gridOuter=new Float64Array(size*size),this.gridInner=new Float64Array(size*size),this.f=new Float64Array(size),this.z=new Float64Array(size+1),this.v=new Uint16Array(size)}return TinySDF.prototype.draw=function(char){var _a=this.ctx.measureText(char),glyphAdvance=_a.width,actualBoundingBoxAscent=_a.actualBoundingBoxAscent,actualBoundingBoxDescent=_a.actualBoundingBoxDescent,actualBoundingBoxLeft=_a.actualBoundingBoxLeft,actualBoundingBoxRight=_a.actualBoundingBoxRight,glyphTop=Math.ceil(actualBoundingBoxAscent),glyphWidth=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(actualBoundingBoxRight-actualBoundingBoxLeft))),glyphHeight=Math.min(this.size-this.buffer,glyphTop+Math.ceil(actualBoundingBoxDescent)),width=glyphWidth+2*this.buffer,height=glyphHeight+2*this.buffer,len=Math.max(width*height,0),data=new Uint8ClampedArray(len),glyph={data,width,height,glyphWidth,glyphHeight,glyphTop,glyphLeft:0,glyphAdvance};if(0===glyphWidth||0===glyphHeight)return glyph;var ctx=this.ctx,buffer=this.buffer,gridInner=this.gridInner,gridOuter=this.gridOuter;ctx.clearRect(buffer,buffer,glyphWidth,glyphHeight),ctx.fillText(char,buffer,buffer+glyphTop);var imgData=ctx.getImageData(buffer,buffer,glyphWidth,glyphHeight);gridOuter.fill(INF,0,len),gridInner.fill(0,0,len);for(var y=0;y<glyphHeight;y++)for(var x=0;x<glyphWidth;x++){var a=imgData.data[4*(y*glyphWidth+x)+3]/255;if(0!==a){var j=(y+buffer)*width+x+buffer;if(1===a)gridOuter[j]=0,gridInner[j]=INF;else{var d=.5-a;gridOuter[j]=d>0?d*d:0,gridInner[j]=d<0?d*d:0}}}edt(gridOuter,0,0,width,height,width,this.f,this.v,this.z),edt(gridInner,buffer,buffer,glyphWidth,glyphHeight,width,this.f,this.v,this.z);for(var i=0;i<len;i++){d=Math.sqrt(gridOuter[i])-Math.sqrt(gridInner[i]);data[i]=Math.round(255-255*(d/this.radius+this.cutoff))}return glyph},TinySDF}();function edt(data,x0,y0,width,height,gridSize,f,v,z){for(var x=x0;x<x0+width;x++)edt1d(data,y0*gridSize+x,gridSize,height,f,v,z);for(var y=y0;y<y0+height;y++)edt1d(data,y*gridSize+x0,1,width,f,v,z)}function edt1d(grid,offset,stride,length,f,v,z){v[0]=0,z[0]=-INF,z[1]=INF,f[0]=grid[offset];for(var q=1,k=0,s=0;q<length;q++){f[q]=grid[offset+q*stride];var q2=q*q;do{var r=v[k];s=(f[q]-f[r]+q2-r*r)/(q-r)/2}while(s<=z[k]&&--k>-1);v[++k]=q,z[k]=s,z[k+1]=INF}for(q=0,k=0;q<length;q++){for(;z[k+1]<q;)k++;var qr=q-(r=v[k]);grid[offset+q*stride]=f[r]+qr*qr}}!function(LineVertexAttributeBufferIndex){LineVertexAttributeBufferIndex[LineVertexAttributeBufferIndex.PACKED=5]="PACKED",LineVertexAttributeBufferIndex[LineVertexAttributeBufferIndex.VERTEX_NUM=6]="VERTEX_NUM",LineVertexAttributeBufferIndex[LineVertexAttributeBufferIndex.TRAVEL=7]="TRAVEL",LineVertexAttributeBufferIndex[LineVertexAttributeBufferIndex.DASH=8]="DASH"}(LineVertexAttributeBufferIndex||(LineVertexAttributeBufferIndex={})),function(LineVertexAttributeLocation){LineVertexAttributeLocation[LineVertexAttributeLocation.PREV=8]="PREV",LineVertexAttributeLocation[LineVertexAttributeLocation.POINT1=9]="POINT1",LineVertexAttributeLocation[LineVertexAttributeLocation.POINT2=10]="POINT2",LineVertexAttributeLocation[LineVertexAttributeLocation.NEXT=11]="NEXT",LineVertexAttributeLocation[LineVertexAttributeLocation.VERTEX_JOINT=12]="VERTEX_JOINT",LineVertexAttributeLocation[LineVertexAttributeLocation.VERTEX_NUM=13]="VERTEX_NUM",LineVertexAttributeLocation[LineVertexAttributeLocation.TRAVEL=14]="TRAVEL",LineVertexAttributeLocation[LineVertexAttributeLocation.DASH=15]="DASH"}(LineVertexAttributeLocation||(LineVertexAttributeLocation={}));function packBoolean(a,b,c){return 4*(a?1:0)+2*(b?1:0)+(c?1:0)}function is3DPolyline(object){if(!(object.nodeName===Shape.POLYLINE))return!1;var polylineControlPoints=object.parsedStyle.points.points;return polylineControlPoints.length&&!(0,is_nil.A)(polylineControlPoints[0][2])}var JOINT_TYPE,InstancedPathDrawcall=function(_super){function InstancedPathDrawcall(renderHelper,texturePool,lightPool,object,drawcallCtors,index,context){var _this=_super.call(this,renderHelper,texturePool,lightPool,object,drawcallCtors,index,context)||this;return _this.renderHelper=renderHelper,_this.texturePool=texturePool,_this.lightPool=lightPool,_this.mergeAnchorIntoModelMatrix=!0,_this.segmentNum=-1,_this.segmentNum=_this.calcSegmentNum(object),_this.gradientAttributeName="stroke",_this}return(0,tslib_es6.C6)(InstancedPathDrawcall,_super),InstancedPathDrawcall.calcSubpathNum=function(object){return object.nodeName===Shape.PATH?object.parsedStyle.path.absolutePath.filter((function(d){return"M"===d[0]})).length:1},InstancedPathDrawcall.prototype.calcSegmentNum=function(object){return updateBuffer(object,!1,12,this.calcSubpathIndex(object)).instancedCount},InstancedPathDrawcall.prototype.calcSubpathIndex=function(object){if(object.nodeName===Shape.PATH){var fillDrawcallCount=this.drawcallCtors.filter((function(ctor){return ctor===InstancedFillDrawcall})).length;return this.index-fillDrawcallCount}return 0},InstancedPathDrawcall.prototype.shouldMerge=function(object,index){if(!_super.prototype.shouldMerge.call(this,object,index))return!1;if(this.index!==index)return!1;var segmentNum=this.calcSegmentNum(object);return this.segmentNum===segmentNum},InstancedPathDrawcall.prototype.createMaterial=function(objects){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm) {\n  vec4 mvPosition = vm * mm * vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = PREV) in vec3 a_Prev;\nlayout(location = POINT1) in vec3 a_Point1;\nlayout(location = POINT2) in vec3 a_Point2;\nlayout(location = NEXT) in vec3 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\nout vec4 v_Dash;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float u_Expand = 1.0;\nconst float u_MiterLimit = 5.0;\nconst float u_ScaleMode = 1.0;\nconst float u_Alignment = 0.5;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvec2 clip2ScreenSpace(vec4 clip) {\n  return u_Viewport * (0.5 * clip.xy / clip.w + 0.5);\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  v_Dash = a_Dash;\n\n  vec2 pointA;\n  vec2 pointB;\n  vec4 clip0;\n  vec4 clip1;\n\n  float compressed = a_Dash.w;\n  float is_billboard = floor(compressed / 4.0);\n  compressed -= is_billboard * 4.0;\n  float is_size_attenuation = floor(compressed / 2.0);\n  compressed -= is_size_attenuation * 2.0;\n  float is_3d_polyline = compressed;\n\n  bool isBillboard = is_billboard > 0.5;\n  bool isSizeAttenuation = is_size_attenuation > 0.5;\n  bool is3DPolyline = is_3d_polyline > 0.5;\n  if (isBillboard) {\n    clip0 = billboard(a_Point1.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = billboard(a_Point2.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else if (is3DPolyline) {\n    clip0 = project(vec4(a_Point1, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = project(vec4(a_Point2, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  if (isBillboard || is3DPolyline) {\n    pointA = clip2ScreenSpace(clip0);\n    pointB = clip2ScreenSpace(clip1);\n  } else {\n    pointA = (u_ModelMatrix * vec4(a_Point1, 1.0)).xy;\n    pointB = (u_ModelMatrix * vec4(a_Point2, 1.0)).xy;\n  }\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Prev.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Prev, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Prev, 1.0)).xy;\n      }\n\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Next.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Next, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Next, 1.0)).xy;\n      }\n      \n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  if (isBillboard || is3DPolyline) {\n    vec4 clip = mix(clip0, clip1, 0.5);\n    gl_Position = vec4(clip.w * (2.0 * pos / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  float u_Dash = v_Dash.x;\n  float u_Gap = v_Dash.y;\n  float u_DashOffset = v_Dash.z;\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    vec3 pickingColor = u_PickingColor;\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(LineVertexAttributeLocation))},InstancedPathDrawcall.prototype.createGeometry=function(objects){var _this=this,indices=[],pointsBuffer=[],travelBuffer=[],packedDash=[],instancedCount=0,offset=0;objects.forEach((function(object){var _a=updateBuffer(object,!1,12,_this.calcSubpathIndex(object)),pBuffer=_a.pointsBuffer,tBuffer=_a.travelBuffer,count=_a.instancedCount,_b=object.parsedStyle,lineDash=_b.lineDash,lineDashOffset=_b.lineDashOffset,isBillboard=_b.isBillboard,isSizeAttenuation=_b.isSizeAttenuation;packedDash.push(lineDash&&lineDash[0]||0,lineDash&&lineDash[1]||0,lineDashOffset||0,packBoolean(isBillboard,isSizeAttenuation,is3DPolyline(object))),instancedCount+=count;for(var i=0;i<pBuffer.length-12;i+=4)pointsBuffer.push(pBuffer[i],pBuffer[i+1],pBuffer[i+2],pBuffer[i+3],pBuffer[i+4],pBuffer[i+5],pBuffer[i+6],pBuffer[i+7],pBuffer[i+8],pBuffer[i+9],pBuffer[i+10],pBuffer[i+11],pBuffer[i+12],pBuffer[i+13],pBuffer[i+14],pBuffer[i+15]);travelBuffer.push.apply(travelBuffer,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(tBuffer),!1)),indices.push(0+offset,2+offset,1+offset,0+offset,3+offset,2+offset,4+offset,6+offset,5+offset,4+offset,7+offset,6+offset,4+offset,7+offset,8+offset),offset+=9})),pointsBuffer.length&&(this.geometry.setVertexBuffer({bufferIndex:LineVertexAttributeBufferIndex.PACKED,byteStride:64,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:LineVertexAttributeLocation.PREV,divisor:1},{format:Format.F32_RGB,bufferByteOffset:16,location:LineVertexAttributeLocation.POINT1,divisor:1},{format:Format.F32_R,bufferByteOffset:28,location:LineVertexAttributeLocation.VERTEX_JOINT,divisor:1},{format:Format.F32_RGB,bufferByteOffset:32,location:LineVertexAttributeLocation.POINT2,divisor:1},{format:Format.F32_RGB,bufferByteOffset:48,location:LineVertexAttributeLocation.NEXT,divisor:1}],data:new Float32Array(pointsBuffer)}),this.geometry.setVertexBuffer({bufferIndex:LineVertexAttributeBufferIndex.VERTEX_NUM,byteStride:4,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_R,bufferByteOffset:0,byteStride:4,location:LineVertexAttributeLocation.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:LineVertexAttributeBufferIndex.TRAVEL,byteStride:4,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_R,bufferByteOffset:0,byteStride:4,location:LineVertexAttributeLocation.TRAVEL,divisor:1}],data:new Float32Array(travelBuffer)}),this.divisor=instancedCount/objects.length,this.geometry.setVertexBuffer({bufferIndex:LineVertexAttributeBufferIndex.DASH,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:LineVertexAttributeLocation.DASH,divisor:this.divisor}],data:new Float32Array(packedDash)}),_super.prototype.createGeometry.call(this,objects),this.geometry.vertexCount=15,this.geometry.instancedCount=instancedCount,this.geometry.setIndexBuffer(new Uint32Array(indices)))},InstancedPathDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){var _this=this;if(_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value),"r"===name||"rx"===name||"ry"===name||"width"===name||"height"===name||"radius"===name||"x1"===name||"y1"===name||"x2"===name||"y2"===name||"points"===name||"path"===name||"lineJoin"===name||"lineCap"===name||"markerStartOffset"===name||"markerEndOffset"===name||"markerStart"===name||"markerEnd"===name){var pointsBuffer_1=[],travelBuffer_1=[],instancedCount_1=0;objects.forEach((function(object){var _a=updateBuffer(object,!1,12,_this.calcSubpathIndex(object)),pBuffer=_a.pointsBuffer,tBuffer=_a.travelBuffer,iCount=_a.instancedCount;instancedCount_1=iCount;for(var i=0;i<pBuffer.length-12;i+=4)pointsBuffer_1.push(pBuffer[i],pBuffer[i+1],pBuffer[i+2],pBuffer[i+3],pBuffer[i+4],pBuffer[i+5],pBuffer[i+6],pBuffer[i+7],pBuffer[i+8],pBuffer[i+9],pBuffer[i+10],pBuffer[i+11],pBuffer[i+12],pBuffer[i+13],pBuffer[i+14],pBuffer[i+15]);travelBuffer_1.push.apply(travelBuffer_1,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(tBuffer),!1))})),this.geometry.updateVertexBuffer(LineVertexAttributeBufferIndex.PACKED,LineVertexAttributeLocation.PREV,startIndex*instancedCount_1,new Uint8Array(new Float32Array(pointsBuffer_1).buffer)),this.geometry.updateVertexBuffer(LineVertexAttributeBufferIndex.TRAVEL,LineVertexAttributeLocation.TRAVEL,startIndex,new Uint8Array(new Float32Array(travelBuffer_1).buffer))}else if("lineDashOffset"===name||"lineDash"===name||"isBillboard"===name||"isSizeAttenuation"===name){var packedDash_1=[];objects.forEach((function(object){var _a=object.parsedStyle,lineDash=_a.lineDash,lineDashOffset=_a.lineDashOffset,isBillboard=_a.isBillboard,isSizeAttenuation=_a.isSizeAttenuation;packedDash_1.push(lineDash&&lineDash[0]||0,lineDash&&lineDash[1]||0,lineDashOffset||0,packBoolean(isBillboard,isSizeAttenuation,is3DPolyline(object)))})),this.geometry.updateVertexBuffer(LineVertexAttributeBufferIndex.DASH,LineVertexAttributeLocation.DASH,startIndex,new Uint8Array(new Float32Array(packedDash_1).buffer))}},InstancedPathDrawcall}(Instanced);!function(JOINT_TYPE){JOINT_TYPE[JOINT_TYPE.NONE=0]="NONE",JOINT_TYPE[JOINT_TYPE.FILL=1]="FILL",JOINT_TYPE[JOINT_TYPE.JOINT_BEVEL=4]="JOINT_BEVEL",JOINT_TYPE[JOINT_TYPE.JOINT_MITER=8]="JOINT_MITER",JOINT_TYPE[JOINT_TYPE.JOINT_ROUND=12]="JOINT_ROUND",JOINT_TYPE[JOINT_TYPE.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",JOINT_TYPE[JOINT_TYPE.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",JOINT_TYPE[JOINT_TYPE.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",JOINT_TYPE[JOINT_TYPE.FILL_EXPAND=24]="FILL_EXPAND",JOINT_TYPE[JOINT_TYPE.CAP_BUTT=32]="CAP_BUTT",JOINT_TYPE[JOINT_TYPE.CAP_SQUARE=64]="CAP_SQUARE",JOINT_TYPE[JOINT_TYPE.CAP_ROUND=96]="CAP_ROUND",JOINT_TYPE[JOINT_TYPE.CAP_BUTT2=128]="CAP_BUTT2"}(JOINT_TYPE||(JOINT_TYPE={}));var stridePoints=3,strideFloats=4;function updateBuffer(object,needEarcut,segmentNum,subPathIndex){var _a;void 0===needEarcut&&(needEarcut=!1),void 0===subPathIndex&&(subPathIndex=0);var _b=object.parsedStyle,lineCap=_b.lineCap,lineJoin=_b.lineJoin,zIndex=5e-4*object.sortable.renderOrder,_c=object.parsedStyle,defX=_c.defX,defY=_c.defY,_d=object.parsedStyle,markerStart=_d.markerStart,markerEnd=_d.markerEnd,markerStartOffset=_d.markerStartOffset,markerEndOffset=_d.markerEndOffset,points=[],triangles=[];if(object.nodeName===Shape.POLYLINE||object.nodeName===Shape.POLYGON){var polylineControlPoints=object.parsedStyle.points.points,length_1=polylineControlPoints.length,startOffsetX_1=0,startOffsetY_1=0,endOffsetX_1=0,endOffsetY_1=0,rad=0,x=void 0,y=void 0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=polylineControlPoints[1][0]-polylineControlPoints[0][0],y=polylineControlPoints[1][1]-polylineControlPoints[0][1],rad=Math.atan2(y,x),startOffsetX_1=Math.cos(rad)*(markerStartOffset||0),startOffsetY_1=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=polylineControlPoints[length_1-2][0]-polylineControlPoints[length_1-1][0],y=polylineControlPoints[length_1-2][1]-polylineControlPoints[length_1-1][1],rad=Math.atan2(y,x),endOffsetX_1=Math.cos(rad)*(markerEndOffset||0),endOffsetY_1=Math.sin(rad)*(markerEndOffset||0));var isPolyline_1=object.nodeName===Shape.POLYLINE;if(points[0]=polylineControlPoints.reduce((function(prev,cur,i){var offsetX=0,offsetY=0;return 0===i?(offsetX=startOffsetX_1,offsetY=startOffsetY_1):i===length_1-1&&(offsetX=endOffsetX_1,offsetY=endOffsetY_1),prev.push(cur[0]-defX+offsetX,cur[1]-defY+offsetY,isPolyline_1?cur[2]||0:zIndex),prev}),[]),object.nodeName===Shape.POLYGON){if(needEarcut)return triangles=earcut_default()(points[0],[],3),{pointsBuffer:points[0],travelBuffer:[],triangles,instancedCount:Math.round(points[0].length/stridePoints)};points[0].push(points[0][0],points[0][1],points[0][2]||zIndex),(_a=points[0]).push.apply(_a,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(addTailSegment(points[0][0],points[0][1],points[0][2]||zIndex,points[0][3],points[0][4],points[0][5]||zIndex)),!1))}}else if(object.nodeName===Shape.PATH||object.nodeName===Shape.CIRCLE||object.nodeName===Shape.ELLIPSE||object.nodeName===Shape.RECT){var path=void 0;if(object.nodeName!==Shape.PATH){if(path=parsePath(convertToPath(object,identity(mat4_create()))),defX=path.rect.x,defY=path.rect.y,object.nodeName===Shape.RECT){var _e=object.parsedStyle,width=_e.width,height=_e.height;width<0&&(defX+=path.rect.width),height<0&&(defY+=path.rect.height)}}else path=object.parsedStyle.path;var absolutePath_1=path.absolutePath,segments_1=path.segments,startOffsetX_2=0,startOffsetY_2=0,endOffsetX_2=0,endOffsetY_2=0;rad=0,x=void 0,y=void 0;if(markerStart&&markerStart.parentNode&&isDisplayObject(markerStart)&&markerStartOffset){var _f=(0,tslib_es6.zs)(markerStart.parentNode.getStartTangent(),2),p1=_f[0],p2=_f[1];x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),startOffsetX_2=Math.cos(rad)*(markerStartOffset||0),startOffsetY_2=Math.sin(rad)*(markerStartOffset||0)}if(markerEnd&&markerEnd.parentNode&&isDisplayObject(markerEnd)&&markerEndOffset){var _g=(0,tslib_es6.zs)(markerEnd.parentNode.getEndTangent(),2);p1=_g[0],p2=_g[1];x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),endOffsetX_2=Math.cos(rad)*(markerEndOffset||0),endOffsetY_2=Math.sin(rad)*(markerEndOffset||0)}var startPointIndex_1=-1,mCommandsNum_1=-1;if(absolutePath_1.forEach((function(_a,i){var _b,_c=(0,tslib_es6.zs)(_a),command=_c[0],params=_c.slice(1),nextSegment=absolutePath_1[i+1],useStartOffset=0===i&&(0!==startOffsetX_2||0!==startOffsetY_2),useEndOffset=(i===absolutePath_1.length-1||nextSegment&&("M"===nextSegment[0]||"Z"===nextSegment[0]))&&0!==endOffsetX_2&&0!==endOffsetY_2;if("M"===command)mCommandsNum_1++,points[mCommandsNum_1]=[],startPointIndex_1=points[mCommandsNum_1].length,useStartOffset?points[mCommandsNum_1].push(params[0]-defX+startOffsetX_2,params[1]-defY+startOffsetY_2,zIndex,params[0]-defX,params[1]-defY,zIndex):points[mCommandsNum_1].push(params[0]-defX,params[1]-defY,zIndex);else if("L"===command)useEndOffset?points[mCommandsNum_1].push(params[0]-defX+endOffsetX_2,params[1]-defY+endOffsetY_2,zIndex):points[mCommandsNum_1].push(params[0]-defX,params[1]-defY,zIndex);else if("Q"===command)quadCurveTo(params[0]-defX,params[1]-defY,params[2]-defX,params[3]-defY,points[mCommandsNum_1],segmentNum),useEndOffset&&points[mCommandsNum_1].push(params[2]-defX+endOffsetX_2,params[3]-defY+endOffsetY_2,zIndex);else if("A"===command){for(var _d=(0,tslib_es6.zs)(segments_1[i].prePoint,2),args=arcToCubic(_d[0],_d[1],params[0],params[1],params[2],params[3],params[4],params[5],params[6],void 0),i_1=0;i_1<args.length;i_1+=6)bezierCurveTo(args[i_1]-defX,args[i_1+1]-defY,args[i_1+2]-defX,args[i_1+3]-defY,args[i_1+4]-defX,args[i_1+5]-defY,points[mCommandsNum_1],segmentNum);useEndOffset&&points[mCommandsNum_1].push(params[5]-defX+endOffsetX_2,params[6]-defY+endOffsetY_2,zIndex)}else if("C"===command)bezierCurveTo(params[0]-defX,params[1]-defY,params[2]-defX,params[3]-defY,params[4]-defX,params[5]-defY,points[mCommandsNum_1],segmentNum),useEndOffset&&points[mCommandsNum_1].push(params[4]-defX+endOffsetX_2,params[5]-defY+endOffsetY_2,zIndex);else if("Z"===command&&(object.nodeName===Shape.PATH||object.nodeName===Shape.RECT)){(Math.abs(points[mCommandsNum_1][points[mCommandsNum_1].length-2]-points[mCommandsNum_1][startPointIndex_1])>1e-4||Math.abs(points[mCommandsNum_1][points[mCommandsNum_1].length-1]-points[mCommandsNum_1][startPointIndex_1+1])>1e-4)&&points[mCommandsNum_1].push(points[mCommandsNum_1][startPointIndex_1],points[mCommandsNum_1][startPointIndex_1+1],zIndex),(_b=points[mCommandsNum_1]).push.apply(_b,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(addTailSegment(points[mCommandsNum_1][startPointIndex_1],points[mCommandsNum_1][startPointIndex_1+1],points[mCommandsNum_1][startPointIndex_1+2],points[mCommandsNum_1][startPointIndex_1+3],points[mCommandsNum_1][startPointIndex_1+4],points[mCommandsNum_1][startPointIndex_1+5])),!1))}})),needEarcut)return{pointsBuffer:pointsBuffer=points[subPathIndex],travelBuffer:[],triangles:triangles=earcut_default()(pointsBuffer,[],3),instancedCount:Math.round(pointsBuffer.length/stridePoints)}}var jointType=function getJointType(lineJoin){var joint;switch(lineJoin){case"bevel":joint=JOINT_TYPE.JOINT_BEVEL;break;case"round":joint=JOINT_TYPE.JOINT_ROUND;break;default:joint=JOINT_TYPE.JOINT_MITER}return joint}(lineJoin),capType=function getCapType(lineCap){var cap;switch(lineCap){case"square":cap=JOINT_TYPE.CAP_SQUARE;break;case"round":cap=JOINT_TYPE.CAP_ROUND;break;default:cap=JOINT_TYPE.CAP_BUTT}return cap}(lineCap),endJoint=capType;capType===JOINT_TYPE.CAP_ROUND&&(endJoint=JOINT_TYPE.JOINT_CAP_ROUND),capType===JOINT_TYPE.CAP_BUTT&&(endJoint=JOINT_TYPE.JOINT_CAP_BUTT),capType===JOINT_TYPE.CAP_SQUARE&&(endJoint=JOINT_TYPE.JOINT_CAP_SQUARE);for(var points_1=points[subPathIndex],j=(Math.round(0/stridePoints)+2)*strideFloats,dist=0,pointsBuffer=[],travelBuffer=[],i=0;i<points_1.length;i+=stridePoints)i>1&&(dist+=Math.sqrt(Math.pow(points_1[i]-points_1[i-stridePoints],2)+Math.pow(points_1[i+1]-points_1[i+1-stridePoints],2)+Math.pow(points_1[i+2]-points_1[i+2-stridePoints],2))),travelBuffer.push(dist),pointsBuffer[j++]=points_1[i],pointsBuffer[j++]=points_1[i+1],pointsBuffer[j++]=points_1[i+2]||0,pointsBuffer[j]=jointType,0==i&&capType!==JOINT_TYPE.CAP_ROUND&&(pointsBuffer[j]+=capType),i+2*stridePoints>=points_1.length?pointsBuffer[j]+=endJoint-jointType:i+stridePoints>=points_1.length&&(pointsBuffer[j]=0),j++;return pointsBuffer[j++]=points_1[points_1.length-6],pointsBuffer[j++]=points_1[points_1.length-5],pointsBuffer[j++]=points_1[points_1.length-4]||zIndex,pointsBuffer[j++]=0,pointsBuffer[0]=points_1[0],pointsBuffer[1]=points_1[1],pointsBuffer[2]=points_1[2]||zIndex,pointsBuffer[3]=0,pointsBuffer[4]=points_1[3],pointsBuffer[5]=points_1[4],pointsBuffer[6]=points_1[5]||zIndex,pointsBuffer[7]=capType===JOINT_TYPE.CAP_ROUND?capType:0,{pointsBuffer,travelBuffer,triangles,instancedCount:Math.round(points_1.length/stridePoints)}}function addTailSegment(x1,y1,z1,x2,y2,z2){void 0===x2&&(x2=x1),void 0===y2&&(y2=y1),void 0===z2&&(z2=z1);var vec=[x2-x1,y2-y1,z2-z1];return[x1+.01*vec[0],y1+.01*vec[1],z1+.01*vec[2]]}var FillVertexAttributeBufferIndex,FillVertexAttributeLocation;!function(FillVertexAttributeBufferIndex){FillVertexAttributeBufferIndex[FillVertexAttributeBufferIndex.PACKED_STYLE=5]="PACKED_STYLE"}(FillVertexAttributeBufferIndex||(FillVertexAttributeBufferIndex={})),function(FillVertexAttributeLocation){FillVertexAttributeLocation[FillVertexAttributeLocation.PACKED_STYLE3=12]="PACKED_STYLE3"}(FillVertexAttributeLocation||(FillVertexAttributeLocation={}));var InstancedLineVertexAttributeBufferIndex,InstancedLineVertexAttributeLocation,InstancedFillDrawcall=function(_super){function InstancedFillDrawcall(renderHelper,texturePool,lightPool,object,drawcallCtors,index,context){var _this=_super.call(this,renderHelper,texturePool,lightPool,object,drawcallCtors,index,context)||this;return _this.renderHelper=renderHelper,_this.texturePool=texturePool,_this.lightPool=lightPool,_this.mergeAnchorIntoModelMatrix=!0,_this.trianglesHash=[[],[]],_this.trianglesHash=_this.calcSegmentNum(object),_this}return(0,tslib_es6.C6)(InstancedFillDrawcall,_super),InstancedFillDrawcall.prototype.calcSegmentNum=function(object){var _a=updateBuffer(object,!0,12,this.calcSubpathIndex(object));return[_a.triangles,_a.pointsBuffer]},InstancedFillDrawcall.prototype.calcSubpathIndex=function(object){return object.nodeName===Shape.PATH?this.index:0},InstancedFillDrawcall.prototype.compareTrianglesHash=function(hash){var _a=(0,tslib_es6.zs)(this.trianglesHash,2),triangles=_a[0],points=_a[1],_b=(0,tslib_es6.zs)(hash,2),t=_b[0],p=_b[1];return triangles.length===t.length&&points.length===p.length&&(!triangles.some((function(n,i){return n!==t[i]}))&&!points.some((function(n,i){return n!==p[i]})))},InstancedFillDrawcall.prototype.shouldMerge=function(object,index){if(!_super.prototype.shouldMerge.call(this,object,index))return!1;if(this.index!==index)return!1;var trianglesHash=this.calcSegmentNum(object);return this.compareTrianglesHash(trianglesHash)},InstancedFillDrawcall.prototype.createGeometry=function(objects){var _this=this,indices=[],pointsBuffer=[],uvsBuffer=[],offset=0;if(objects.forEach((function(object,i){var _a=updateBuffer(object,!0,12,_this.calcSubpathIndex(object)),triangles=_a.triangles,pBuffer=_a.pointsBuffer;if(triangles.length){var halfExtents_1=object.getGeometryBounds().halfExtents,uvBuffer_1=[];pBuffer.forEach((function(x,i){i%3!=2&&uvBuffer_1.push(x/halfExtents_1[i%3]/2)})),offset+=pointsBuffer.length/3,pointsBuffer.push.apply(pointsBuffer,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(pBuffer),!1)),uvsBuffer.push.apply(uvsBuffer,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(uvBuffer_1),!1)),indices.push.apply(indices,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(triangles.map((function(n){return n+offset}))),!1))}})),pointsBuffer.length){_super.prototype.createGeometry.call(this,objects);var packedStyle_1=[];objects.forEach((function(object){var _a=object.parsedStyle,isBillboard=_a.isBillboard,billboardRotation=_a.billboardRotation,isSizeAttenuation=_a.isSizeAttenuation;packedStyle_1.push(isBillboard?1:0,null!=billboardRotation?billboardRotation:0,isSizeAttenuation?1:0,0)})),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.POSITION,byteStride:12,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:VertexAttributeLocation.POSITION}],data:new Float32Array(pointsBuffer)}),this.geometry.setVertexBuffer({bufferIndex:FillVertexAttributeBufferIndex.PACKED_STYLE,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:FillVertexAttributeLocation.PACKED_STYLE3,divisor:1}],data:new Float32Array(packedStyle_1)}),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.UV,byteStride:8,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:VertexAttributeLocation.UV}],data:new Float32Array(uvsBuffer)}),this.geometry.vertexCount=indices.length/objects.length,this.geometry.setIndexBuffer(new Uint32Array(indices))}},InstancedFillDrawcall.prototype.createMaterial=function(objects){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm) {\n  vec4 mvPosition = vm * mm * vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(a_Position.xy, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else {\n    gl_Position = project(vec4(a_Position.xy, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(FillVertexAttributeLocation)),{INSTANCED:!0})},InstancedFillDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){if(_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value),"isBillboard"===name||"billboardRotation"===name||"isSizeAttenuation"===name){var packed_1=[];objects.forEach((function(object){var _a=object.parsedStyle,isBillboard=_a.isBillboard,billboardRotation=_a.billboardRotation,isSizeAttenuation=_a.isSizeAttenuation;packed_1.push(isBillboard?1:0,null!=billboardRotation?billboardRotation:0,isSizeAttenuation?1:0,0)})),this.geometry.updateVertexBuffer(FillVertexAttributeBufferIndex.PACKED_STYLE,FillVertexAttributeLocation.PACKED_STYLE3,startIndex,new Uint8Array(new Float32Array(packed_1).buffer))}},InstancedFillDrawcall}(Instanced),segmentInstanceGeometry=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1];!function(InstancedLineVertexAttributeBufferIndex){InstancedLineVertexAttributeBufferIndex[InstancedLineVertexAttributeBufferIndex.POINT=5]="POINT",InstancedLineVertexAttributeBufferIndex[InstancedLineVertexAttributeBufferIndex.CAP=6]="CAP",InstancedLineVertexAttributeBufferIndex[InstancedLineVertexAttributeBufferIndex.DASH=7]="DASH"}(InstancedLineVertexAttributeBufferIndex||(InstancedLineVertexAttributeBufferIndex={})),function(InstancedLineVertexAttributeLocation){InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.POSITION=8]="POSITION",InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.UV=10]="UV",InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.POINTA=9]="POINTA",InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.POINTB=11]="POINTB",InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.CAP=12]="CAP",InstancedLineVertexAttributeLocation[InstancedLineVertexAttributeLocation.DASH=13]="DASH"}(InstancedLineVertexAttributeLocation||(InstancedLineVertexAttributeLocation={}));var ImageVertexAttributeBufferIndex,ImageVertexAttributeLocation,LineCap_MAP={butt:1,round:2,square:3},InstancedLineDrawcall=function(_super){function InstancedLineDrawcall(renderHelper,texturePool,lightPool,object,drawcallCtors,index,context){var _this=_super.call(this,renderHelper,texturePool,lightPool,object,drawcallCtors,index,context)||this;return _this.renderHelper=renderHelper,_this.texturePool=texturePool,_this.lightPool=lightPool,_this.gradientAttributeName="stroke",_this}return(0,tslib_es6.C6)(InstancedLineDrawcall,_super),InstancedLineDrawcall.isLine=function(object,subpathIndex){if(object.nodeName===Shape.PATH){for(var absolutePath=object.parsedStyle.path.absolutePath,mSegmentCount=0,mCommandIndex=0,i=0;i<absolutePath.length;i++){if("M"===absolutePath[i][0]){if(mSegmentCount===subpathIndex){mCommandIndex=i;break}mSegmentCount++}}if("M"===absolutePath[mCommandIndex][0]&&"L"===absolutePath[mCommandIndex+1][0]&&(void 0===absolutePath[mCommandIndex+2]||"M"===absolutePath[mCommandIndex+2][0]))return!0}else if(object.nodeName===Shape.POLYLINE){var points=object.parsedStyle.points.points,tangent=(points[1][0]-points[1][1])/(points[0][0]-points[0][1]);for(i=1;i<points.length-1;i++)if((points[i+1][0]-points[i+1][1])/(points[i][0]-points[i][1])!==tangent)return!1;return!0}return!1},InstancedLineDrawcall.prototype.shouldMerge=function(object,index){return!!_super.prototype.shouldMerge.call(this,object,index)},InstancedLineDrawcall.prototype.createMaterial=function(objects){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  bool isSizeAttenuation = a_Dash.w > 0.5;\n  if (isSizeAttenuation) {\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * blur\n      * u_Opacity * u_StrokeOpacity\n      * (u_dash_array < 1.0 ? (ceil((u_dash_array * u_dash_ratio) - mod(v_Dash.x + u_dash_offset, u_dash_array))) : 1.0);\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(InstancedLineVertexAttributeLocation))},InstancedLineDrawcall.prototype.calcSubpathIndex=function(object){if(object.nodeName===Shape.PATH){var fillDrawcallCount=this.drawcallCtors.filter((function(ctor){return ctor===InstancedFillDrawcall})).length;return this.index-fillDrawcallCount}return 0},InstancedLineDrawcall.prototype.createGeometry=function(objects){var _this=this;_super.prototype.createGeometry.call(this,objects);var interleaved=[],packedCap=[],packedDash=[],indices=[],offset=0;objects.forEach((function(object){var parsedLineStyleProps,totalLength;if(object.nodeName===Shape.LINE)parsedLineStyleProps=object.parsedStyle,totalLength=object.getTotalLength();else if(object.nodeName===Shape.POLYLINE){var _a=object.parsedStyle,points=_a.points.points,defX_1=_a.defX,defY_1=_a.defY,lineCap_1=_a.lineCap,lineDash=_a.lineDash,lineDashOffset=_a.lineDashOffset,markerStart=_a.markerStart,markerEnd=_a.markerEnd,markerStartOffset=_a.markerStartOffset,markerEndOffset=_a.markerEndOffset,isBillboard_1=_a.isBillboard,isSizeAttenuation_1=_a.isSizeAttenuation;parsedLineStyleProps={x1:points[0][0],y1:points[0][1],x2:points[points.length-1][0],y2:points[points.length-1][1],z1:0,z2:0,defX:defX_1,defY:defY_1,lineCap:lineCap_1,lineDash,lineDashOffset,isBillboard:isBillboard_1,isSizeAttenuation:isSizeAttenuation_1,markerStart,markerEnd,markerStartOffset,markerEndOffset},totalLength=object.getTotalLength()}else if(object.nodeName===Shape.PATH){for(var _b=object.parsedStyle,absolutePath=_b.path.absolutePath,defX_2=_b.defX,defY_2=_b.defY,lineCap_2=_b.lineCap,isBillboard_2=(lineDash=_b.lineDash,lineDashOffset=_b.lineDashOffset,markerStart=_b.markerStart,markerEnd=_b.markerEnd,markerStartOffset=_b.markerStartOffset,markerEndOffset=_b.markerEndOffset,_b.isBillboard),isSizeAttenuation_2=_b.isSizeAttenuation,mSegmentCount=0,mCommandIndex=0,index=_this.calcSubpathIndex(object),i=0;i<absolutePath.length;i++){if("M"===absolutePath[i][0]){if(mSegmentCount===index){mCommandIndex=i;break}mSegmentCount++}}parsedLineStyleProps={x1:absolutePath[mCommandIndex][1],y1:absolutePath[mCommandIndex][2],x2:absolutePath[mCommandIndex+1][1],y2:absolutePath[mCommandIndex+1][2],z1:0,z2:0,defX:defX_2,defY:defY_2,lineCap:lineCap_2,lineDash,lineDashOffset,isBillboard:isBillboard_2,isSizeAttenuation:isSizeAttenuation_2,markerStart,markerEnd,markerStartOffset,markerEndOffset},totalLength=object.getTotalLength()}var x1=parsedLineStyleProps.x1,y1=parsedLineStyleProps.y1,x2=parsedLineStyleProps.x2,y2=parsedLineStyleProps.y2,z1=parsedLineStyleProps.z1,z2=parsedLineStyleProps.z2,defX=parsedLineStyleProps.defX,defY=parsedLineStyleProps.defY,lineCap=parsedLineStyleProps.lineCap,isBillboard=parsedLineStyleProps.isBillboard,isSizeAttenuation=parsedLineStyleProps.isSizeAttenuation,_c=_this.calcOffset(parsedLineStyleProps),startOffsetX=_c.startOffsetX,startOffsetY=_c.startOffsetY,endOffsetX=_c.endOffsetX,endOffsetY=_c.endOffsetY,_d=_this.calcDash(parsedLineStyleProps,totalLength),dashOffset=_d.dashOffset,dashSegmentPercent=_d.dashSegmentPercent,dashRatioInEachSegment=_d.dashRatioInEachSegment;packedCap.push(LineCap_MAP[lineCap]),packedDash.push(dashOffset,dashSegmentPercent,dashRatioInEachSegment,isBillboard||isSizeAttenuation?1:0),interleaved.push(x1-defX+startOffsetX,y1-defY+startOffsetY,z1,x2-defX+endOffsetX,y2-defY+endOffsetY,z2),indices.push(0+offset,2+offset,1+offset,0+offset,3+offset,2+offset),offset+=4})),this.geometry.setIndexBuffer(new Uint32Array(indices)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.POSITION,byteStride:20,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:InstancedLineVertexAttributeLocation.POSITION,divisor:0},{format:Format.F32_RG,bufferByteOffset:12,location:InstancedLineVertexAttributeLocation.UV,divisor:0}],data:new Float32Array(segmentInstanceGeometry)}),this.geometry.setVertexBuffer({bufferIndex:InstancedLineVertexAttributeBufferIndex.POINT,byteStride:24,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:InstancedLineVertexAttributeLocation.POINTA,divisor:1},{format:Format.F32_RGB,bufferByteOffset:12,location:InstancedLineVertexAttributeLocation.POINTB,divisor:1}],data:new Float32Array(interleaved)}),this.geometry.setVertexBuffer({bufferIndex:InstancedLineVertexAttributeBufferIndex.CAP,byteStride:4,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_R,bufferByteOffset:0,location:InstancedLineVertexAttributeLocation.CAP,divisor:1}],data:new Float32Array(packedCap)}),this.geometry.setVertexBuffer({bufferIndex:InstancedLineVertexAttributeBufferIndex.DASH,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:InstancedLineVertexAttributeLocation.DASH,divisor:1}],data:new Float32Array(packedDash)})},InstancedLineDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){var _this=this;if(_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value),"x1"===name||"y1"===name||"x2"===name||"y2"===name||"z1"===name||"z2"===name||"markerStartOffset"===name||"markerEndOffset"===name||"markerStart"===name||"markerEnd"===name||"points"===name||"path"===name){var packed_1=[];objects.forEach((function(object){var parsedLineStyleProps;if(object.nodeName===Shape.LINE)parsedLineStyleProps=object.parsedStyle;else if(object.nodeName===Shape.POLYLINE){var _a=object.parsedStyle,points=_a.points.points,defX_3=_a.defX,defY_3=_a.defY,lineCap=_a.lineCap,markerStart=_a.markerStart,markerEnd=_a.markerEnd,markerStartOffset=_a.markerStartOffset,markerEndOffset=_a.markerEndOffset,isBillboard=_a.isBillboard,isSizeAttenuation=_a.isSizeAttenuation;parsedLineStyleProps={x1:points[0][0],y1:points[0][1],x2:points[points.length-1][0],y2:points[points.length-1][1],z1:0,z2:0,defX:defX_3,defY:defY_3,lineCap,isSizeAttenuation,isBillboard,markerStart,markerEnd,markerStartOffset,markerEndOffset}}else if(object.nodeName===Shape.PATH){var _b=object.parsedStyle,absolutePath=_b.path.absolutePath,defX_4=_b.defX,defY_4=_b.defY;lineCap=_b.lineCap,markerStart=_b.markerStart,markerEnd=_b.markerEnd,markerStartOffset=_b.markerStartOffset,markerEndOffset=_b.markerEndOffset,isBillboard=_b.isBillboard,isSizeAttenuation=_b.isSizeAttenuation;parsedLineStyleProps={x1:absolutePath[0][1],y1:absolutePath[0][2],x2:absolutePath[1][1],y2:absolutePath[1][2],z1:0,z2:0,defX:defX_4,defY:defY_4,lineCap,isBillboard,isSizeAttenuation,markerStart,markerEnd,markerStartOffset,markerEndOffset}}var x1=parsedLineStyleProps.x1,y1=parsedLineStyleProps.y1,x2=parsedLineStyleProps.x2,y2=parsedLineStyleProps.y2,z1=parsedLineStyleProps.z1,z2=parsedLineStyleProps.z2,defX=parsedLineStyleProps.defX,defY=parsedLineStyleProps.defY,_c=_this.calcOffset(parsedLineStyleProps),startOffsetX=_c.startOffsetX,startOffsetY=_c.startOffsetY,endOffsetX=_c.endOffsetX,endOffsetY=_c.endOffsetY;packed_1.push(x1-defX+startOffsetX,y1-defY+startOffsetY,z1,x2-defX+endOffsetX,y2-defY+endOffsetY,z2)})),this.geometry.updateVertexBuffer(InstancedLineVertexAttributeBufferIndex.POINT,InstancedLineVertexAttributeLocation.POINTA,startIndex,new Uint8Array(new Float32Array(packed_1).buffer))}else if("lineDashOffset"===name||"lineDash"===name||"isSizeAttenuation"===name||"isBillboard"===name){var packed_2=[];objects.forEach((function(object){var totalLength=object.getTotalLength(),_a=_this.calcDash(object.parsedStyle,totalLength),dashOffset=_a.dashOffset,dashSegmentPercent=_a.dashSegmentPercent,dashRatioInEachSegment=_a.dashRatioInEachSegment;packed_2.push(dashOffset,dashSegmentPercent,dashRatioInEachSegment,object.parsedStyle.isBillboard||object.parsedStyle.isSizeAttenuation?1:0)})),this.geometry.updateVertexBuffer(InstancedLineVertexAttributeBufferIndex.DASH,InstancedLineVertexAttributeLocation.DASH,startIndex,new Uint8Array(new Float32Array(packed_2).buffer))}else if("lineCap"===name){var packed_3=[];objects.forEach((function(object){var lineCap=object.parsedStyle.lineCap;packed_3.push(LineCap_MAP[lineCap])})),this.geometry.updateVertexBuffer(InstancedLineVertexAttributeBufferIndex.CAP,InstancedLineVertexAttributeLocation.CAP,startIndex,new Uint8Array(new Float32Array(packed_3).buffer))}},InstancedLineDrawcall.prototype.calcOffset=function(parsedStyle){var x,y,x1=parsedStyle.x1,y1=parsedStyle.y1,x2=parsedStyle.x2,y2=parsedStyle.y2,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;return markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=x2-x1,y=y2-y1,rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=x1-x2,y=y1-y2,rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)),{startOffsetX,startOffsetY,endOffsetX,endOffsetY}},InstancedLineDrawcall.prototype.calcDash=function(parsedLineStyle,totalLength){var lineDash=parsedLineStyle.lineDash,lineDashOffset=parsedLineStyle.lineDashOffset,dashOffset=0,dashSegmentPercent=1,dashRatioInEachSegment=0;if(lineDash&&lineDash.length){dashOffset=(lineDashOffset||0)/totalLength;var segmentsLength=lineDash.reduce((function(cur,prev){return cur+prev}),0);0===segmentsLength?(dashSegmentPercent=1,dashRatioInEachSegment=0):(dashSegmentPercent=segmentsLength/totalLength,dashRatioInEachSegment=lineDash[1]/segmentsLength)}return{dashOffset,dashSegmentPercent,dashRatioInEachSegment}},InstancedLineDrawcall}(Instanced);!function(ImageVertexAttributeBufferIndex){ImageVertexAttributeBufferIndex[ImageVertexAttributeBufferIndex.PACKED_STYLE=5]="PACKED_STYLE"}(ImageVertexAttributeBufferIndex||(ImageVertexAttributeBufferIndex={})),function(ImageVertexAttributeLocation){ImageVertexAttributeLocation[ImageVertexAttributeLocation.PACKED_STYLE3=12]="PACKED_STYLE3"}(ImageVertexAttributeLocation||(ImageVertexAttributeLocation={}));var ImageDrawcall=function(_super){function ImageDrawcall(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(ImageDrawcall,_super),ImageDrawcall.prototype.shouldMerge=function(object,index){return!!_super.prototype.shouldMerge.call(this,object,index)&&this.instance.parsedStyle.img===object.parsedStyle.img},ImageDrawcall.prototype.createMaterial=function(objects){var img=objects[0].parsedStyle.img;this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(ImageVertexAttributeLocation)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm) {\n  vec4 mvPosition = vm * mm * vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec2 a_Size;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size;\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else {\n    gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}";var map=this.texturePool.getOrCreateTexture(this.context.device,img);this.material.setUniforms({u_Map:map})},ImageDrawcall.prototype.createGeometry=function(objects){_super.prototype.createGeometry.call(this,objects);var instanced=[],packedStyle=[];objects.forEach((function(object,i){var _a=object.parsedStyle,width=_a.width,height=_a.height,isBillboard=_a.isBillboard,billboardRotation=_a.billboardRotation,isSizeAttenuation=_a.isSizeAttenuation;instanced.push(width,height),packedStyle.push(isBillboard?1:0,null!=billboardRotation?billboardRotation:0,isSizeAttenuation?1:0,0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.POSITION,byteStride:8,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:VertexAttributeLocation.POSITION}],data:new Float32Array(instanced)}),this.geometry.setVertexBuffer({bufferIndex:ImageVertexAttributeBufferIndex.PACKED_STYLE,byteStride:16,stepMode:VertexStepMode.INSTANCE,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:ImageVertexAttributeLocation.PACKED_STYLE3,divisor:1}],data:new Float32Array(packedStyle)}),this.geometry.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.UV,byteStride:8,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:VertexAttributeLocation.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})},ImageDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){if(_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value),"width"===name||"height"===name||"z"===name){var packed_1=[];objects.forEach((function(object){var _a=object.parsedStyle,width=_a.width,height=_a.height;packed_1.push(width,height)})),this.geometry.updateVertexBuffer(VertexAttributeBufferIndex.POSITION,VertexAttributeLocation.POSITION,startIndex,new Uint8Array(new Float32Array(packed_1).buffer))}else if("isBillboard"===name||"billboardRotation"===name||"isSizeAttenuation"===name){var packed_2=[];objects.forEach((function(object){var _a=object.parsedStyle,isBillboard=_a.isBillboard,billboardRotation=_a.billboardRotation,isSizeAttenuation=_a.isSizeAttenuation;packed_2.push(isBillboard?1:0,null!=billboardRotation?billboardRotation:0,isSizeAttenuation?1:0,0)})),this.geometry.updateVertexBuffer(ImageVertexAttributeBufferIndex.PACKED_STYLE,ImageVertexAttributeLocation.PACKED_STYLE3,startIndex,new Uint8Array(new Float32Array(packed_2).buffer))}else if("img"===name){var map=this.texturePool.getOrCreateTexture(this.context.device,value);this.material.setUniforms({u_Map:map})}},ImageDrawcall}(Instanced);function createImage(image,_a,channels,data){var width=_a.width,height=_a.height;if(data){if(data.length!==width*height*channels)throw new RangeError("mismatched image size")}else data=new Uint8Array(width*height*channels);return image.width=width,image.height=height,image.data=data,image}function copyImage(srcImg,dstImg,srcPt,dstPt,size,channels){if(0===size.width||0===size.height)return dstImg;if(size.width>srcImg.width||size.height>srcImg.height||srcPt.x>srcImg.width-size.width||srcPt.y>srcImg.height-size.height)throw new RangeError("out of range source coordinates for image copy");if(size.width>dstImg.width||size.height>dstImg.height||dstPt.x>dstImg.width-size.width||dstPt.y>dstImg.height-size.height)throw new RangeError("out of range destination coordinates for image copy");for(var srcData=srcImg.data,dstData=dstImg.data,y=0;y<size.height;y++)for(var srcOffset=((srcPt.y+y)*srcImg.width+srcPt.x)*channels,dstOffset=((dstPt.y+y)*dstImg.width+dstPt.x)*channels,i=0;i<size.width*channels;i++)dstData[dstOffset+i]=srcData[srcOffset+i];return dstImg}var AlphaImage=function(){function AlphaImage(size,data){createImage(this,size,1,data)}return AlphaImage.prototype.resize=function(size){!function resizeImage(image,_a,channels){var width=_a.width,height=_a.height;if(width!==image.width||height!==image.height){var newImage=createImage({},{width,height},channels);copyImage(image,newImage,{x:0,y:0},{x:0,y:0},{width:Math.min(image.width,width),height:Math.min(image.height,height)},channels),image.width=width,image.height=height,image.data=newImage.data}}(this,size,1)},AlphaImage.prototype.clone=function(){return new AlphaImage({width:this.width,height:this.height},new Uint8Array(this.data))},AlphaImage.copy=function(srcImg,dstImg,srcPt,dstPt,size){copyImage(srcImg,dstImg,srcPt,dstPt,size,1)},AlphaImage}();var GlyphAtlas=function GlyphAtlas(stacks){var positions={},bins=[];for(var stack in stacks){var glyphs=stacks[stack],stackPositions=positions[stack]={};for(var id in glyphs)if((src=glyphs[+id])&&0!==src.bitmap.width&&0!==src.bitmap.height){var bin={x:0,y:0,w:src.bitmap.width+2,h:src.bitmap.height+2};bins.push(bin),stackPositions[id]={rect:bin,metrics:src.metrics}}}var _a=function potpack(boxes){var e_1,_a,e_2,_b,area=0,maxWidth=0;try{for(var boxes_1=(0,tslib_es6.Ju)(boxes),boxes_1_1=boxes_1.next();!boxes_1_1.done;boxes_1_1=boxes_1.next())area+=(box=boxes_1_1.value).w*box.h,maxWidth=Math.max(maxWidth,box.w)}catch(e_1_1){e_1={error:e_1_1}}finally{try{boxes_1_1&&!boxes_1_1.done&&(_a=boxes_1.return)&&_a.call(boxes_1)}finally{if(e_1)throw e_1.error}}boxes.sort((function(a,b){return b.h-a.h}));var spaces=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(area/.95)),maxWidth),h:1/0}],width=0,height=0;try{for(var boxes_2=(0,tslib_es6.Ju)(boxes),boxes_2_1=boxes_2.next();!boxes_2_1.done;boxes_2_1=boxes_2.next())for(var box=boxes_2_1.value,i=spaces.length-1;i>=0;i--){var space=spaces[i];if(!(box.w>space.w||box.h>space.h)){if(box.x=space.x,box.y=space.y,height=Math.max(height,box.y+box.h),width=Math.max(width,box.x+box.w),box.w===space.w&&box.h===space.h){var last=spaces.pop();i<spaces.length&&(spaces[i]=last)}else box.h===space.h?(space.x+=box.w,space.w-=box.w):box.w===space.w?(space.y+=box.h,space.h-=box.h):(spaces.push({x:space.x+box.w,y:space.y,w:space.w-box.w,h:box.h}),space.y+=box.h,space.h-=box.h);break}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{boxes_2_1&&!boxes_2_1.done&&(_b=boxes_2.return)&&_b.call(boxes_2)}finally{if(e_2)throw e_2.error}}return{w:width,h:height,fill:area/(width*height)||0}}(bins),w=_a.w,h=_a.h,image=new AlphaImage({width:w||1,height:h||1});for(var stack in stacks)for(var id in glyphs=stacks[stack]){var src;(src=glyphs[+id])&&0!==src.bitmap.width&&0!==src.bitmap.height&&(bin=positions[stack][id].rect,AlphaImage.copy(src.bitmap,image,{x:0,y:0},{x:bin.x+1,y:bin.y+1},src.bitmap))}this.image=image,this.positions=positions};var TextVertexAttributeBufferIndex,TextVertexAttributeLocation,TextUniform,GlyphManager=function(){function GlyphManager(runtime){this.runtime=runtime,this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={}}return GlyphManager.prototype.getMap=function(){return this.glyphMap},GlyphManager.prototype.getAtlas=function(){return this.glyphAtlas},GlyphManager.prototype.getAtlasTexture=function(){return this.glyphAtlasTexture},GlyphManager.prototype.layout=function(lines,fontStack,lineHeight,textAlign,letterSpacing,offsetX,offsetY){var _this=this,positionedGlyphs=[],x=offsetX,y=offsetY,justify="right"===textAlign||"end"===textAlign?1:"left"===textAlign||"start"===textAlign?0:.5;return lines.forEach((function(line){var lineStartIndex=positionedGlyphs.length;Array.from(line).forEach((function(char){var positions=_this.glyphMap[fontStack],charCode=char.charCodeAt(0),glyph=positions&&positions[charCode];glyph&&(positionedGlyphs.push({glyph:charCode,x,y,scale:1,fontStack}),x+=glyph.metrics.advance+letterSpacing)}));for(var lineWidth=x-letterSpacing,i=lineStartIndex;i<positionedGlyphs.length;i++)positionedGlyphs[i].x=positionedGlyphs[i].x-justify*lineWidth;x=0,y+=lineHeight})),positionedGlyphs},GlyphManager.prototype.generateAtlas=function(canvas,fontStack,fontFamily,fontWeight,fontStyle,text,device){var _this=this;void 0===fontStack&&(fontStack=""),void 0===fontStyle&&(fontStyle="");var newChars=[];this.glyphMap[fontStack]||(newChars=function getDefaultCharacterSet(){for(var charSet=[],i=32;i<128;i++)charSet.push(String.fromCharCode(i));return charSet}());var existedChars=Object.keys(this.glyphMap[fontStack]||{});if(Array.from(new Set(text.split(""))).forEach((function(char){-1===existedChars.indexOf(char.charCodeAt(0).toString())&&newChars.push(char)})),newChars.length){var glyphMap=newChars.map((function(char){return _this.generateSDF(canvas,fontStack,fontFamily,fontWeight,fontStyle,char)})).reduce((function(prev,cur){return prev[cur.id]=cur,prev}),{});this.glyphMap[fontStack]=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.glyphMap[fontStack]),glyphMap),this.glyphAtlas=new GlyphAtlas(this.glyphMap);var _a=this.glyphAtlas.image,atlasWidth=_a.width,atlasHeight=_a.height,data=_a.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=device.createTexture((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},makeTextureDescriptor2D(Format.ALPHA,atlasWidth,atlasHeight,1)),{pixelStore:{unpackFlipY:!1,unpackAlignment:1}})),this.glyphAtlasTexture.setImageData([data])}},GlyphManager.prototype.generateSDF=function(canvas,fontStack,fontFamily,fontWeight,fontStyle,char){void 0===fontStack&&(fontStack="");var charCode=char.charCodeAt(0),sdfGenerator=this.sdfGeneratorCache[fontStack];sdfGenerator||(sdfGenerator=this.sdfGeneratorCache[fontStack]=new TinySDF({canvas,fontSize:24,fontFamily,fontWeight,fontStyle,buffer:3,radius:8,cutoff:.25},this.runtime)),this.textMetricsCache[fontStack]||(this.textMetricsCache[fontStack]={}),this.textMetricsCache[fontStack][char]||(this.textMetricsCache[fontStack][char]=sdfGenerator.ctx.measureText(char).width);var _a=sdfGenerator.draw(char),data=_a.data,width=_a.width,height=_a.height,glyphWidth=_a.glyphWidth,glyphHeight=_a.glyphHeight,glyphLeft=_a.glyphLeft,glyphTop=_a.glyphTop,glyphAdvance=_a.glyphAdvance;return{id:charCode,bitmap:new AlphaImage({width,height},data),metrics:{width:glyphWidth,height:glyphHeight,left:glyphLeft,top:glyphTop-24+3,advance:glyphAdvance}}},GlyphManager}();!function(TextVertexAttributeBufferIndex){TextVertexAttributeBufferIndex[TextVertexAttributeBufferIndex.INSTANCED=5]="INSTANCED",TextVertexAttributeBufferIndex[TextVertexAttributeBufferIndex.TEX=6]="TEX"}(TextVertexAttributeBufferIndex||(TextVertexAttributeBufferIndex={})),function(TextVertexAttributeLocation){TextVertexAttributeLocation[TextVertexAttributeLocation.TEX=12]="TEX",TextVertexAttributeLocation[TextVertexAttributeLocation.OFFSET=13]="OFFSET"}(TextVertexAttributeLocation||(TextVertexAttributeLocation={})),function(TextUniform){TextUniform.SDF_MAP="u_SDFMap",TextUniform.SDF_MAP_SIZE="u_SDFMapSize",TextUniform.FONT_SIZE="u_FontSize",TextUniform.GAMMA_SCALE="u_GammaScale",TextUniform.STROKE_BLUR="u_StrokeBlur",TextUniform.HAS_STROKE="u_HasStroke"}(TextUniform||(TextUniform={}));var TextDrawcall=function(_super){function TextDrawcall(renderHelper,texturePool,lightPool,object,drawcallCtors,index,context){var _this=_super.call(this,renderHelper,texturePool,lightPool,object,drawcallCtors,index,context)||this;return _this.renderHelper=renderHelper,_this.texturePool=texturePool,_this.lightPool=lightPool,_this.packedBufferObjectMap=new WeakMap,_this.tmpMat4=mat4_create(),_this.fontHash=_this.calcFontHash(object),_this.glyphManager=new GlyphManager(_this.context),_this}return(0,tslib_es6.C6)(TextDrawcall,_super),TextDrawcall.prototype.calcFontHash=function(object){return object.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(prev,cur){return prev+object.parsedStyle[cur]}),"")},TextDrawcall.prototype.shouldMerge=function(object,index){return!!_super.prototype.shouldMerge.call(this,object,index)&&(this.index===index&&this.fontHash===this.calcFontHash(object))},TextDrawcall.prototype.createGeometry=function(objects){var _this=this,_a=this.instance.parsedStyle,textBaseline=_a.textBaseline,fontSize=_a.fontSize,letterSpacing=_a.letterSpacing,fontScale=24/fontSize,indices=[],uvOffsets=[],packed=[],indicesOff=0;objects.forEach((function(object){var _a=object.parsedStyle,metrics=_a.metrics,dx=_a.dx,dy=_a.dy,font=metrics.font,lines=metrics.lines,height=metrics.height,lineHeight=metrics.lineHeight,offsetX=dx||0,offsetY=dy||0,linePositionY=0;"middle"===textBaseline?linePositionY=-height/2:"bottom"===textBaseline?linePositionY=-height:"top"===textBaseline||"hanging"===textBaseline?linePositionY=0:"alphabetic"===textBaseline?(linePositionY=.25*lineHeight-height,_this.context.enableCSSParsing||(linePositionY=-height)):"ideographic"===textBaseline&&(linePositionY=-height);var glyphAtlas=_this.glyphManager.getAtlas(),_b=_this.buildTextBuffers({object,lines,fontStack:font,lineHeight:fontScale*lineHeight,offsetX:fontScale*offsetX,offsetY:fontScale*(linePositionY+offsetY),letterSpacing:fontScale*letterSpacing,glyphAtlas,indicesOffset:indicesOff}),indicesOffset=_b.indicesOffset,indexBuffer=_b.indexBuffer,charUVOffsetBuffer=_b.charUVOffsetBuffer,charPackedBuffer=_b.charPackedBuffer;indicesOff=indicesOffset;var start=packed.length;packed.push.apply(packed,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(charPackedBuffer),!1));var end=packed.length;_this.packedBufferObjectMap.set(object,[start,end]),uvOffsets.push.apply(uvOffsets,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(charUVOffsetBuffer),!1)),indices.push.apply(indices,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(indexBuffer),!1))})),this.geometry.vertexCount=indices.length,this.geometry.setIndexBuffer(new Uint32Array(indices)),this.geometry.setVertexBuffer({bufferIndex:TextVertexAttributeBufferIndex.INSTANCED,byteStride:128,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RGBA,bufferByteOffset:0,location:VertexAttributeLocation.MODEL_MATRIX0},{format:Format.F32_RGBA,bufferByteOffset:16,location:VertexAttributeLocation.MODEL_MATRIX1},{format:Format.F32_RGBA,bufferByteOffset:32,location:VertexAttributeLocation.MODEL_MATRIX2},{format:Format.F32_RGBA,bufferByteOffset:48,location:VertexAttributeLocation.MODEL_MATRIX3},{format:Format.F32_RGBA,bufferByteOffset:64,location:VertexAttributeLocation.PACKED_COLOR},{format:Format.F32_RGBA,bufferByteOffset:80,location:VertexAttributeLocation.PACKED_STYLE1},{format:Format.F32_RGBA,bufferByteOffset:96,location:VertexAttributeLocation.PACKED_STYLE2},{format:Format.F32_RGBA,bufferByteOffset:112,location:VertexAttributeLocation.PICKING_COLOR}],data:new Float32Array(packed)}),this.geometry.setVertexBuffer({bufferIndex:TextVertexAttributeBufferIndex.TEX,byteStride:16,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:TextVertexAttributeLocation.TEX},{format:Format.F32_RG,bufferByteOffset:8,location:TextVertexAttributeLocation.OFFSET}],data:new Float32Array(uvOffsets)})},TextDrawcall.prototype.createMaterial=function(objects){var _a;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm) {\n  vec4 mvPosition = vm * mm * vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + bufferOffset;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  if (isBillboard) {\n    float rotation =  a_StylePacked2.w;\n    bool isSizeAttenuation = a_StylePacked2.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  } else {\n    gl_Position = project(vec4((a_Offset) * fontScale + bufferOffset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float fontScale = u_FontSize / 24.0;\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = fwidth(dist);\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < epsilon) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=CullMode.BACK,this.material.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.material.defines),enumToObject(TextVertexAttributeLocation));var _b=this.instance.parsedStyle,fontSize=_b.fontSize,_c=_b.fontFamily,fontFamily=void 0===_c?"":_c,_d=_b.fontWeight,fontWeight=void 0===_d?"":_d,fontStyle=_b.fontStyle,font=_b.metrics.font,allText=objects.map((function(object){return object.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,font,fontFamily,fontWeight.toString(),fontStyle,allText,this.context.device);var glyphAtlasTexture=this.glyphManager.getAtlasTexture(),glyphAtlas=this.glyphManager.getAtlas();this.context.device.setResourceName(glyphAtlasTexture,"TextSDF Texture");var _e=glyphAtlas.image,atlasWidth=_e.width,atlasHeight=_e.height;this.material.setUniforms(((_a={})[TextUniform.SDF_MAP]=glyphAtlasTexture,_a[TextUniform.SDF_MAP_SIZE]=[atlasWidth,atlasHeight],_a[TextUniform.FONT_SIZE]=fontSize,_a[TextUniform.GAMMA_SCALE]=1,_a[TextUniform.STROKE_BLUR]=.2,_a[TextUniform.HAS_STROKE]=this.index,_a))},TextDrawcall.prototype.changeRenderOrder=function(object,renderOrder){for(var vertice=this.geometry.vertices[TextVertexAttributeBufferIndex.INSTANCED],bytes=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[TextVertexAttributeBufferIndex.INSTANCED].arrayStride/4,_a=(0,tslib_es6.zs)(this.packedBufferObjectMap.get(object),2),start=_a[0],end=_a[1],sliced=vertice.slice(start,end),i=0;i<end-start;i+=bytes)sliced[i+bytes-1]=5e-4*renderOrder;this.geometry.updateVertexBuffer(TextVertexAttributeBufferIndex.INSTANCED,VertexAttributeLocation.MODEL_MATRIX0,start/bytes,new Uint8Array(sliced.buffer))},TextDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){var _this=this;if("text"===name||"fontFamily"===name||"fontSize"===name||"fontWeight"===name||"fontStyle"===name||"fontVariant"===name||"textBaseline"===name||"letterSpacing"===name||"wordWrapWidth"===name||"lineHeight"===name||"wordWrap"===name||"textAlign"===name||"dx"===name||"dy"===name)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===name||"fill"===name||"fillOpacity"===name||"stroke"===name||"strokeOpacity"===name||"opacity"===name||"lineWidth"===name||"visibility"===name||"pointerEvents"===name||"isBillboard"===name||"billboardRotation"===name||"isSizeAttenuation"===name){var vertice_1=this.geometry.vertices[TextVertexAttributeBufferIndex.INSTANCED],bytes_1=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[TextVertexAttributeBufferIndex.INSTANCED].arrayStride/4;objects.forEach((function(object){var _a,_b=object.parsedStyle,fill=_b.fill,stroke=_b.stroke,opacity=_b.opacity,fillOpacity=_b.fillOpacity,strokeOpacity=_b.strokeOpacity,lineWidth=_b.lineWidth,visibility=_b.visibility,isBillboard=_b.isBillboard,billboardRotation=_b.billboardRotation,isSizeAttenuation=_b.isSizeAttenuation,fillColor=[0,0,0,0];isCSSRGB(fill)&&(fillColor=[Number(fill.r),Number(fill.g),Number(fill.b),255*Number(fill.alpha)]);var strokeColor=[0,0,0,0];isCSSRGB(stroke)&&(strokeColor=[Number(stroke.r),Number(stroke.g),Number(stroke.b),255*Number(stroke.alpha)]);for(var encodedPickingColor=object.isInteractive()&&(null===(_a=object.renderable3D)||void 0===_a?void 0:_a.encodedPickingColor)||[0,0,0],modelMatrix=mat4_copy(_this.tmpMat4,object.getWorldTransform()),_c=(0,tslib_es6.zs)(_this.packedBufferObjectMap.get(object),2),start=_c[0],end=_c[1],sliced=vertice_1.slice(start,end),i=0;i<end-start;i+=bytes_1)sliced[i+0]=modelMatrix[0],sliced[i+1]=modelMatrix[1],sliced[i+2]=modelMatrix[2],sliced[i+3]=modelMatrix[3],sliced[i+4]=modelMatrix[4],sliced[i+5]=modelMatrix[5],sliced[i+6]=modelMatrix[6],sliced[i+7]=modelMatrix[7],sliced[i+8]=modelMatrix[8],sliced[i+9]=modelMatrix[9],sliced[i+10]=modelMatrix[10],sliced[i+11]=modelMatrix[11],sliced[i+12]=modelMatrix[12],sliced[i+13]=modelMatrix[13],sliced[i+14]=modelMatrix[14],sliced[i+15]=modelMatrix[15],sliced[i+16]=packUint8ToFloat(fillColor[0],fillColor[1]),sliced[i+17]=packUint8ToFloat(fillColor[2],fillColor[3]),sliced[i+18]=packUint8ToFloat(strokeColor[0],strokeColor[1]),sliced[i+19]=packUint8ToFloat(strokeColor[2],strokeColor[3]),sliced[i+20]=opacity,sliced[i+21]=fillOpacity,sliced[i+22]=strokeOpacity,sliced[i+23]=lineWidth,sliced[i+24]="visible"===visibility?1:0,sliced[i+25]=isBillboard?1:0,sliced[i+26]=isSizeAttenuation?1:0,sliced[i+27]=null!=billboardRotation?billboardRotation:0,sliced[i+28]=encodedPickingColor[0],sliced[i+29]=encodedPickingColor[1],sliced[i+30]=encodedPickingColor[2];_this.geometry.updateVertexBuffer(TextVertexAttributeBufferIndex.INSTANCED,VertexAttributeLocation.MODEL_MATRIX0,start/bytes_1,new Uint8Array(sliced.buffer))}))}},TextDrawcall.prototype.buildTextBuffers=function(_a){var _b,object=_a.object,lines=_a.lines,fontStack=_a.fontStack,lineHeight=_a.lineHeight,letterSpacing=_a.letterSpacing,offsetX=_a.offsetX,offsetY=_a.offsetY,glyphAtlas=_a.glyphAtlas,indicesOffset=_a.indicesOffset,_c=object.parsedStyle,textAlign=_c.textAlign,fill=_c.fill,stroke=_c.stroke,opacity=_c.opacity,fillOpacity=_c.fillOpacity,strokeOpacity=_c.strokeOpacity,lineWidth=_c.lineWidth,visibility=_c.visibility,isBillboard=_c.isBillboard,billboardRotation=_c.billboardRotation,isSizeAttenuation=_c.isSizeAttenuation,fillColor=[0,0,0,0];isCSSRGB(fill)&&(fillColor=[Number(fill.r),Number(fill.g),Number(fill.b),255*Number(fill.alpha)]);var strokeColor=[0,0,0,0];isCSSRGB(stroke)&&(strokeColor=[Number(stroke.r),Number(stroke.g),Number(stroke.b),255*Number(stroke.alpha)]);var encodedPickingColor=object.isInteractive()&&(null===(_b=object.renderable3D)||void 0===_b?void 0:_b.encodedPickingColor)||[0,0,0],modelMatrix=mat4_copy(this.tmpMat4,object.getWorldTransform()),charPackedBuffer=[],charUVOffsetBuffer=[],indexBuffer=[],i=indicesOffset,glyphQuads=function getGlyphQuads(positionedGlyphs,positions){for(var quads=[],k=0;k<positionedGlyphs.length;k++){var positionedGlyph=positionedGlyphs[k],glyphPositions=positions[positionedGlyph.fontStack],glyph=glyphPositions&&glyphPositions[positionedGlyph.glyph];if(glyph){var rect=glyph.rect;if(rect){var halfAdvance=glyph.metrics.advance*positionedGlyph.scale/2,builtInOffset=[positionedGlyph.x+halfAdvance,positionedGlyph.y],x1=(glyph.metrics.left-4)*positionedGlyph.scale-halfAdvance+builtInOffset[0],y1=(-glyph.metrics.top-4)*positionedGlyph.scale+builtInOffset[1],x2=x1+rect.w*positionedGlyph.scale,y2=y1+rect.h*positionedGlyph.scale,tl={x:x1,y:y1},tr={x:x2,y:y1},bl={x:x1,y:y2},br={x:x2,y:y2};quads.push({tl,tr,bl,br,tex:rect,glyphOffset:[0,0]})}}}return quads}(this.glyphManager.layout(lines,fontStack,lineHeight,textAlign,letterSpacing,offsetX,offsetY),glyphAtlas.positions);return glyphQuads.forEach((function(quad){var temp=[];temp.push.apply(temp,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(modelMatrix),!1));var packed=(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(temp),!1),[packUint8ToFloat(fillColor[0],fillColor[1]),packUint8ToFloat(fillColor[2],fillColor[3]),packUint8ToFloat(strokeColor[0],strokeColor[1]),packUint8ToFloat(strokeColor[2],strokeColor[3]),opacity,fillOpacity,strokeOpacity,lineWidth,"visible"===visibility?1:0,isBillboard?1:0,isSizeAttenuation?1:0,null!=billboardRotation?billboardRotation:0],!1),(0,tslib_es6.zs)(encodedPickingColor),!1),[5e-4*object.sortable.renderOrder],!1);charPackedBuffer.push.apply(charPackedBuffer,(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(packed),!1),(0,tslib_es6.zs)(packed),!1),(0,tslib_es6.zs)(packed),!1),(0,tslib_es6.zs)(packed),!1)),charUVOffsetBuffer.push(quad.tex.x,quad.tex.y,quad.tl.x,quad.tl.y),charUVOffsetBuffer.push(quad.tex.x+quad.tex.w,quad.tex.y,quad.tr.x,quad.tr.y),charUVOffsetBuffer.push(quad.tex.x+quad.tex.w,quad.tex.y+quad.tex.h,quad.br.x,quad.br.y),charUVOffsetBuffer.push(quad.tex.x,quad.tex.y+quad.tex.h,quad.bl.x,quad.bl.y),indexBuffer.push(0+i,2+i,1+i),indexBuffer.push(2+i,0+i,3+i),i+=4})),{indexBuffer,charUVOffsetBuffer,charPackedBuffer,indicesOffset:i}},TextDrawcall}(Instanced),MeshDrawcall=function(_super){function MeshDrawcall(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(MeshDrawcall,_super),MeshDrawcall.prototype.shouldMerge=function(object,index){return!!_super.prototype.shouldMerge.call(this,object,index)&&(this.instance.nodeName!==Shape.MESH||this.instance.parsedStyle.material===object.parsedStyle.material&&this.instance.parsedStyle.geometry===object.parsedStyle.geometry)},MeshDrawcall.prototype.updateAttribute=function(objects,startIndex,name,value){_super.prototype.updateAttribute.call(this,objects,startIndex,name,value),this.updateBatchedAttribute(objects,startIndex,name,value)},MeshDrawcall.prototype.createMaterial=function(objects){var material=this.instance.parsedStyle.material;this.material=material,this.observeMaterialChanged()},MeshDrawcall.prototype.createGeometry=function(objects){var geometry=this.instance.parsedStyle.geometry;this.geometry=geometry,_super.prototype.createGeometry.call(this,objects),this.geometry.build(objects),this.observeGeometryChanged()},MeshDrawcall}(Instanced),index_esm_CircleRenderer=function(_super){function CircleRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(CircleRenderer,_super),CircleRenderer.prototype.getDrawcallCtors=function(object){var drawcalls=[];return object.parsedStyle.fill.isNone||drawcalls.push(SDFDrawcall),this.needDrawStrokeSeparately(object)&&drawcalls.push(InstancedPathDrawcall),drawcalls},CircleRenderer.prototype.needDrawStrokeSeparately=function(object){var _a=object.parsedStyle,fill=_a.fill,stroke=_a.stroke,lineDash=_a.lineDash,lineWidth=_a.lineWidth,strokeOpacity=_a.strokeOpacity,hasFill=fill&&!fill.isNone,hasStroke=stroke&&!stroke.isNone,hasDash=lineDash&&lineDash.length&&lineDash.every((function(item){return 0!==item}));return!hasFill||hasStroke&&lineWidth>0&&(strokeOpacity<1||hasDash)},CircleRenderer}(Batch),index_esm_PathRenderer=function(_super){function PathRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(PathRenderer,_super),PathRenderer.prototype.getDrawcallCtors=function(object){var _a=object.parsedStyle,fill=_a.fill,stroke=_a.stroke,opacity=_a.opacity,strokeOpacity=_a.strokeOpacity,lineWidth=_a.lineWidth,hasStroke=stroke&&!stroke.isNone,subpathNum=InstancedPathDrawcall.calcSubpathNum(object),drawcalls=[];if(object.nodeName!==Shape.POLYLINE&&!fill.isNone)for(var i=0;i<subpathNum;i++)drawcalls.push(InstancedFillDrawcall);for(i=0;i<subpathNum;i++){if(0!==strokeOpacity&&0!==opacity&&0!==lineWidth&&hasStroke)InstancedLineDrawcall.isLine(object,i)?drawcalls.push(InstancedLineDrawcall):drawcalls.push(InstancedPathDrawcall)}return drawcalls},PathRenderer}(Batch);!function(_super){function GroupRenderer(){return null!==_super&&_super.apply(this,arguments)||this}(0,tslib_es6.C6)(GroupRenderer,_super),GroupRenderer.prototype.getDrawcallCtors=function(){return[]}}(Batch);var index_esm_ImageRenderer=function(_super){function ImageRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(ImageRenderer,_super),ImageRenderer.prototype.getDrawcallCtors=function(){return[ImageDrawcall]},ImageRenderer}(Batch),index_esm_TextRenderer=function(_super){function TextRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(TextRenderer,_super),TextRenderer.prototype.getDrawcallCtors=function(object){var drawcalls=[],_a=object.parsedStyle,stroke=_a.stroke,lineWidth=_a.lineWidth;return!(!stroke||stroke.isNone||!lineWidth)&&drawcalls.push(TextDrawcall),drawcalls.push(TextDrawcall),drawcalls},TextRenderer.prototype.beforeUploadUBO=function(renderInst,mesh){var _a,drawcallNum=mesh.instance.renderable3D.drawcalls.length;mesh.material.setUniforms(((_a={})[TextUniform.HAS_STROKE]=1===drawcallNum?0:1-mesh.index,_a))},TextRenderer}(Batch),index_esm_LineRenderer=function(_super){function LineRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(LineRenderer,_super),LineRenderer.prototype.getDrawcallCtors=function(){return[InstancedLineDrawcall]},LineRenderer}(Batch),MeshRenderer=function(_super){function MeshRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(MeshRenderer,_super),MeshRenderer.prototype.getDrawcallCtors=function(){return[MeshDrawcall]},MeshRenderer}(Batch),index_esm_RectRenderer=function(_super){function RectRenderer(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(RectRenderer,_super),RectRenderer.prototype.getDrawcallCtors=function(object){var drawcalls=[],_a=object.parsedStyle,fill=_a.fill,radius=_a.radius,hasDifferentRadius=radius&&radius.length&&radius.some((function(r){return r!==radius[0]}));return fill.isNone||hasDifferentRadius||drawcalls.push(SDFDrawcall),hasDifferentRadius&&drawcalls.push(InstancedFillDrawcall),(hasDifferentRadius||this.needDrawStrokeSeparately(object))&&drawcalls.push(InstancedPathDrawcall),drawcalls},RectRenderer.prototype.needDrawStrokeSeparately=function(object){var _a=object.parsedStyle,fill=_a.fill,stroke=_a.stroke,lineDash=_a.lineDash,lineWidth=_a.lineWidth,strokeOpacity=_a.strokeOpacity,hasFill=fill&&!fill.isNone,hasStroke=stroke&&!stroke.isNone,hasDash=lineDash&&lineDash.length&&lineDash.every((function(item){return 0!==item}));return!hasFill||hasStroke&&lineWidth>0&&(strokeOpacity<1||hasDash)},RectRenderer}(Batch),stencilRefCounter=1,BatchManager=function(){function BatchManager(renderHelper,rendererFactory,texturePool,lightPool){this.renderHelper=renderHelper,this.rendererFactory=rendererFactory,this.texturePool=texturePool,this.lightPool=lightPool,this.drawcalls=[],this.pendingUpdatePatches={},this.stencilRefCache={}}return BatchManager.prototype.destroy=function(){this.drawcalls.forEach((function(drawcall){drawcall.destroy()})),this.drawcalls=[],this.pendingUpdatePatches={}},BatchManager.prototype.render=function(list,isPicking){var _this=this;void 0===isPicking&&(isPicking=!1),isPicking||this.updatePendingPatches(),this.drawcalls.forEach((function(mesh){mesh.init();var objects=mesh.objects;mesh.clipPathTarget&&(objects=[mesh.clipPath]);var renderInst=_this.renderHelper.renderInstManager.newRenderInst();renderInst.setAllowSkippingIfPipelineNotReady(!1),mesh.applyRenderInst(renderInst,objects),_this.renderHelper.renderInstManager.submitRenderInst(renderInst,list),isPicking||mesh.objects.forEach((function(object){object.renderable.dirty=!1}))}))},BatchManager.prototype.attach=function(context){this.context=context},BatchManager.prototype.add=function(object){var _this=this,renderable3D=object.renderable3D;if(renderable3D&&!renderable3D.drawcalls.length){var renderer_1=this.rendererFactory[object.nodeName];renderer_1&&renderer_1.getDrawcallCtors(object).forEach((function(drawcallCtor,i,drawcallCtors){var existedDrawcall=_this.drawcalls.find((function(mesh){return drawcallCtor===mesh.constructor&&mesh.index===i&&mesh.objects.length<mesh.maxInstances&&mesh.shouldMerge(object,i)}));existedDrawcall&&existedDrawcall.key===object.parsedStyle.batchKey||((existedDrawcall=new drawcallCtor(_this.renderHelper,_this.texturePool,_this.lightPool,object,drawcallCtors,i,_this.context)).renderer=renderer_1,_this.drawcalls.push(existedDrawcall),object.parsedStyle.batchKey&&(existedDrawcall.key=object.parsedStyle.batchKey)),existedDrawcall&&(existedDrawcall.objects.push(object),renderable3D.drawcalls[i]=existedDrawcall,existedDrawcall.geometryDirty=!0)}))}},BatchManager.prototype.remove=function(object){var _this=this,renderable3D=object.renderable3D;renderable3D&&(renderable3D.drawcalls.forEach((function(mesh){if(mesh){var index=mesh.objects.indexOf(object);if(index>-1&&(mesh.objects.splice(index,1),mesh.geometryDirty=!0),0===mesh.objects.length)_this.drawcalls.splice(_this.drawcalls.indexOf(mesh),1).forEach((function(deletedDrawcall){deletedDrawcall.destroy()}))}})),renderable3D.drawcalls=[])},BatchManager.prototype.updateAttribute=function(object,attributeName,newValue,immediately){var _this=this;void 0===immediately&&(immediately=!1);var renderable3D=object.renderable3D,renderer=this.rendererFactory[object.nodeName];if(renderer){var drawcallCtors=renderer.getDrawcallCtors(object);if(drawcallCtors.forEach((function(drawcallCtor,i,drawcallCtors){var existedDrawcall=renderable3D.drawcalls.find((function(mesh){return mesh&&mesh.index===i&&mesh.constructor===drawcallCtor}));if(existedDrawcall||((existedDrawcall=renderable3D.drawcalls[i])&&(existedDrawcall.objects.splice(existedDrawcall.objects.indexOf(object),1),existedDrawcall.geometryDirty=!0,0===existedDrawcall.objects.length&&_this.drawcalls.splice(_this.drawcalls.indexOf(existedDrawcall),1),renderable3D.drawcalls[renderable3D.drawcalls.indexOf(existedDrawcall)]=void 0),(existedDrawcall=_this.drawcalls.find((function(mesh){return drawcallCtor===mesh.constructor&&mesh.index===i&&mesh.objects.length<mesh.maxInstances&&mesh.shouldMerge(object,i)})))?existedDrawcall.geometryDirty=!0:((existedDrawcall=new drawcallCtor(_this.renderHelper,_this.texturePool,_this.lightPool,object,drawcallCtors,i,_this.context)).renderer=renderer,existedDrawcall.init(),_this.drawcalls.push(existedDrawcall)),existedDrawcall.objects.push(object),renderable3D.drawcalls[i]=existedDrawcall),existedDrawcall.inited&&!existedDrawcall.geometryDirty)if(existedDrawcall.shouldMerge(object,i)){var objectIdx=existedDrawcall.objects.indexOf(object);if(immediately)object.parsedStyle[attributeName]=newValue,existedDrawcall.updateAttribute([object],objectIdx,attributeName,newValue);else{var patchKey=existedDrawcall.id+attributeName;_this.pendingUpdatePatches[patchKey]||(_this.pendingUpdatePatches[patchKey]={instance:existedDrawcall,objectIndices:[],name:attributeName,value:newValue}),-1===_this.pendingUpdatePatches[patchKey].objectIndices.indexOf(objectIdx)&&_this.pendingUpdatePatches[patchKey].objectIndices.push(objectIdx)}}else _this.remove(object),_this.add(object);else _this.remove(object),_this.add(object)})),renderable3D.drawcalls.length>drawcallCtors.length)for(var i=renderable3D.drawcalls.length-1;i>=drawcallCtors.length;i--){var existedDrawcall=renderable3D.drawcalls[i];existedDrawcall.objects.splice(existedDrawcall.objects.indexOf(object),1),existedDrawcall.geometryDirty=!0,0===existedDrawcall.objects.length&&this.drawcalls.splice(this.drawcalls.indexOf(existedDrawcall),1),renderable3D.drawcalls.pop()}}},BatchManager.prototype.changeRenderOrder=function(object,renderOrder){var renderable3D=object.renderable3D;renderable3D&&renderable3D.drawcalls.length&&renderable3D.drawcalls.forEach((function(mesh){mesh&&mesh.inited&&!mesh.geometryDirty&&mesh.inited&&mesh.changeRenderOrder(object,renderOrder)}))},BatchManager.prototype.getStencilRef=function(object){return this.stencilRefCache[object.entity]||(this.stencilRefCache[object.entity]=stencilRefCounter++),this.stencilRefCache[object.entity]},BatchManager.prototype.updatePendingPatches=function(){var _this=this;Object.keys(this.pendingUpdatePatches).forEach((function(patchKey){var _a=_this.pendingUpdatePatches[patchKey],instance=_a.instance,objectIndices=_a.objectIndices,name=_a.name,value=_a.value;objectIndices.sort((function(a,b){return a-b}));var updatePatches=[];objectIndices.forEach((function(i){var lastUpdateBatch=updatePatches[updatePatches.length-1];lastUpdateBatch&&i===lastUpdateBatch[lastUpdateBatch.length-1]+1?lastUpdateBatch.push(i):updatePatches.push([i])})),updatePatches.forEach((function(indices){instance.updateAttribute(instance.objects.slice(indices[0],indices[0]+indices.length),indices[0],name,value)}))})),this.pendingUpdatePatches={}},BatchManager}(),TexturePool=function(){function TexturePool(context,runtime){this.context=context,this.runtime=runtime,this.textureCache={}}return TexturePool.prototype.getOrCreateTexture=function(device,src,descriptor,successCallback){var texture,_this=this,id="string"==typeof src?src:src.src||"";if(id&&this.textureCache[id])(texture=this.textureCache[id]).emit(TextureEvent.LOADED);else if(texture=device.createTexture((0,tslib_es6.Cl)({format:Format.U8_RGBA_NORM,width:1,height:1,depthOrArrayLayers:1,mipLevelCount:1,dimension:TextureDimension.TEXTURE_2D,usage:TextureUsage.SAMPLED,pixelStore:{unpackFlipY:!1}},descriptor)),id&&(this.textureCache[id]=texture),(0,is_string.A)(src)){var image_1,createImage=this.context.config.createImage;createImage?image_1=createImage(src):isBrowser&&(image_1=new window.Image),image_1&&(image_1.onload=function(){var onSuccess=function(bitmap){_this.textureCache[id].setImageData([bitmap]),_this.textureCache[id].emit(TextureEvent.LOADED),_this.context.renderingService.dirtify(),successCallback&&successCallback(_this.textureCache[id])};_this.runtime.globalThis.createImageBitmap?_this.runtime.globalThis.createImageBitmap(image_1).then((function(bitmap){return onSuccess(bitmap)})).catch((function(){onSuccess(image_1)})):onSuccess(image_1)},image_1.onerror=function(){},image_1.crossOrigin="Anonymous",image_1.src=src)}else texture.setImageData([src]),texture.emit(TextureEvent.LOADED),this.context.renderingService.dirtify();return texture},TexturePool.prototype.getOrCreateCanvas=function(){return this.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)},TexturePool.prototype.getOrCreateGradient=function(params){var instance=params.instance,gradients=params.gradients,halfExtents=instance.getGeometryBounds().halfExtents,width=2*halfExtents[0]||1,height=2*halfExtents[1]||1,offscreenCanvas=this.context.config.offscreenCanvas,canvas=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas),context=this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);canvas.width=width,canvas.height=height;var imagePool=this.context.imagePool;gradients.forEach((function(g){var gradient=imagePool.getOrCreateGradient((0,tslib_es6.Cl)((0,tslib_es6.Cl)({type:g.type},g.value),{width,height}),context);context.fillStyle=gradient,context.fillRect(0,0,width,height)}))},TexturePool.prototype.getOrCreatePattern=function(pattern,instance,callback){var src,image=pattern.image,repetition=pattern.repetition,transform=pattern.transform,halfExtents=instance.getGeometryBounds().halfExtents,width=2*halfExtents[0]||1,height=2*halfExtents[1]||1,offscreenCanvas=this.context.config.offscreenCanvas,canvas=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas),context=this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);canvas.width=width,canvas.height=height;var canvasPattern=(src=(0,is_string.A)(image)?this.context.imagePool.getImageSync(image,callback):image)&&context.createPattern(src,repetition);if(transform){var mat=parsedTransformToMat4(parseTransform(transform),new DisplayObject({}));canvasPattern.setTransform({a:mat[0],b:mat[1],c:mat[4],d:mat[5],e:mat[12],f:mat[13]})}context.fillStyle=canvasPattern,context.fillRect(0,0,width,height)},TexturePool.prototype.destroy=function(){for(var key in this.textureCache)this.textureCache[key].destroy();this.textureCache={}},TexturePool}(),g_plugin_device_renderer_dist_index_esm_Plugin=function(_super){function Plugin(options){void 0===options&&(options={});var _this=_super.call(this)||this;return _this.options=options,_this.name="device-renderer",_this.parameters={toneMapping:ToneMapping.NONE,toneMappingExposure:1},_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(runtime){var _a;runtime.geometryUpdaterFactory[Shape.MESH]=new MeshUpdater;var renderHelper=new RenderHelper(this.parameters),lightPool=new LightPool,texturePool=new TexturePool(this.context,runtime),pickingIdGenerator=new PickingIdGenerator,circleRenderer=new index_esm_CircleRenderer,pathRenderer=new index_esm_PathRenderer,rendererFactory=((_a={})[Shape.CIRCLE]=circleRenderer,_a[Shape.ELLIPSE]=circleRenderer,_a[Shape.POLYLINE]=pathRenderer,_a[Shape.PATH]=pathRenderer,_a[Shape.POLYGON]=pathRenderer,_a[Shape.RECT]=new index_esm_RectRenderer,_a[Shape.IMAGE]=new index_esm_ImageRenderer,_a[Shape.LINE]=new index_esm_LineRenderer,_a[Shape.TEXT]=new index_esm_TextRenderer,_a[Shape.MESH]=new MeshRenderer,_a[Shape.GROUP]=void 0,_a[Shape.HTML]=void 0,_a),batchManager=new BatchManager(renderHelper,rendererFactory,texturePool,lightPool),renderGraphPlugin=new RenderGraphPlugin(renderHelper,lightPool,texturePool,batchManager,this.options);this.addRenderingPlugin(renderGraphPlugin),this.addRenderingPlugin(new PickingPlugin(renderHelper,renderGraphPlugin,pickingIdGenerator,batchManager))},Plugin.prototype.destroy=function(runtime){delete runtime.geometryUpdaterFactory[Shape.MESH]},Plugin.prototype.getRenderGraphPlugin=function(){return this.plugins[0]},Plugin.prototype.getDevice=function(){return this.getRenderGraphPlugin().getDevice()},Plugin.prototype.loadTexture=function(src,descriptor,successCallback){return this.getRenderGraphPlugin().loadTexture(src,descriptor,successCallback)},Plugin.prototype.toDataURL=function(options){return this.getRenderGraphPlugin().toDataURL(options)},Plugin.prototype.setParameters=function(parameters){this.parameters=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.parameters),parameters)},Plugin}(AbstractRendererPlugin),ProceduralGeometry=function(_super){function ProceduralGeometry(device,props){void 0===props&&(props={});var _this=_super.call(this,device,props)||this;return _this.flipYMatrix=fromScaling(mat4_create(),fromValues(1,-1,1)),_this.topology=_this.createTopology(),_this}return(0,tslib_es6.C6)(ProceduralGeometry,_super),ProceduralGeometry.prototype.applyMa4Position=function(mat,positions){for(var v=vec4_create(),i=0;i<positions.byteLength/4;i+=3)v[0]=positions[i],v[1]=positions[i+1],v[2]=positions[i+2],v[3]=1,vec4_transformMat4(v,v,mat),positions[i]=v[0],positions[i+1]=v[1],positions[i+2]=v[2];this.updateVertexBuffer(VertexAttributeBufferIndex.POSITION,VertexAttributeLocation.POSITION,0,new Uint8Array(positions.buffer))},ProceduralGeometry.prototype.applyMa4Normal=function(mat,normals){var v=vec4_create(),normalMatrix=mat4_copy(mat4_create(),mat);invert(normalMatrix,normalMatrix),transpose(normalMatrix,normalMatrix);for(var i=0;i<normals.byteLength/4;i+=3)v[0]=normals[i],v[1]=normals[i+1],v[2]=normals[i+2],v[3]=1,vec4_transformMat4(v,v,normalMatrix),normals[i]=v[0],normals[i+1]=v[1],normals[i+2]=v[2];this.updateVertexBuffer(VertexAttributeBufferIndex.NORMAL,VertexAttributeLocation.NORMAL,0,new Uint8Array(normals.buffer))},ProceduralGeometry.prototype.rebuildPosition=function(){this.topology=this.createTopology();var p=Float32Array.from(this.topology.positions);this.applyMa4Position(this.flipYMatrix,p),this.dirty=!0},ProceduralGeometry.prototype.applyMat4=function(mat){this.applyMa4Position(mat,this.vertices[VertexAttributeBufferIndex.POSITION]),this.applyMa4Normal(mat,this.vertices[VertexAttributeBufferIndex.NORMAL])},ProceduralGeometry.prototype.computeBoundingBox=function(){for(var positions=this.topology.positions,maxX=-1/0,maxY=-1/0,maxZ=-1/0,minX=1/0,minY=1/0,minZ=1/0,i=0;i<positions.length;i+=3){var x=positions[i],y=positions[i+1],z=positions[i+2];maxX=Math.max(maxX,x),maxY=Math.max(maxY,y),maxZ=Math.max(maxZ,z),minX=Math.min(minX,x),minY=Math.min(minY,y),minZ=Math.min(minZ,z)}var aabb=new AABB;return aabb.setMinMax([minX,minY,minZ],[maxX,maxY,maxZ]),aabb},ProceduralGeometry.prototype.build=function(){var _a=this.topology,indices=_a.indices,positions=_a.positions,normals=_a.normals,uvs=_a.uvs;this.setIndexBuffer(new Uint32Array(indices)),this.vertexCount=indices.length,this.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.POSITION,byteStride:12,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:VertexAttributeLocation.POSITION}],data:Float32Array.from(positions)}),this.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.NORMAL,byteStride:12,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RGB,bufferByteOffset:0,location:VertexAttributeLocation.NORMAL}],data:Float32Array.from(normals)}),this.setVertexBuffer({bufferIndex:VertexAttributeBufferIndex.UV,byteStride:8,stepMode:VertexStepMode.VERTEX,attributes:[{format:Format.F32_RG,bufferByteOffset:0,location:VertexAttributeLocation.UV}],data:Float32Array.from(uvs)}),this.applyMat4(this.flipYMatrix),this.dirty=!0},ProceduralGeometry}(BufferGeometry);function createConeData(baseRadius,peakRadius,height,heightSegments,capSegments,roundedCaps){var i,j,x,y,z,u,v,top,bottom,theta,cosTheta,sinTheta,phi,sinPhi,first,second,third,fourth,offset,pos=create(),bottomToTop=create(),norm=create(),positions=[],normals=[],uvs=[],uvs1=[],indices=[];if(height>0)for(i=0;i<=heightSegments;i++)for(j=0;j<=capSegments;j++){theta=j/capSegments*2*Math.PI-Math.PI,lerp(pos,bottom=fromValues((sinTheta=Math.sin(theta))*baseRadius,-height/2,(cosTheta=Math.cos(theta))*baseRadius),top=fromValues(sinTheta*peakRadius,height/2,cosTheta*peakRadius),i/heightSegments),normalize(bottomToTop,sub(bottomToTop,top,bottom)),normalize(norm,cross(norm,fromValues(cosTheta,0,-sinTheta),bottomToTop)),positions.push(pos[0],pos[1],pos[2]),normals.push(norm[0],norm[1],norm[2]),u=j/capSegments,v=i/heightSegments,uvs.push(u,1-v);var _v=v;v=u,u=_v,u=.875*(u/=3)+.0625,v=.875*v+.0625,uvs1.push(u,1-v),i<heightSegments&&j<capSegments&&(first=i*(capSegments+1)+j,second=i*(capSegments+1)+(j+1),third=(i+1)*(capSegments+1)+j,fourth=(i+1)*(capSegments+1)+(j+1),indices.push(first,second,third),indices.push(second,fourth,third))}if(roundedCaps){var lat=void 0,lon=void 0,latitudeBands=Math.floor(capSegments/2),longitudeBands=capSegments,capOffset=height/2;for(lat=0;lat<=latitudeBands;lat++)for(theta=lat*Math.PI*.5/latitudeBands,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta),lon=0;lon<=longitudeBands;lon++)phi=2*lon*Math.PI/longitudeBands-Math.PI/2,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-lon/longitudeBands,v=1-lat/latitudeBands,positions.push(x*peakRadius,y*peakRadius+capOffset,z*peakRadius),normals.push(x,y,z),uvs.push(u,1-v),u=.875*(u/=3)+.0625,v=.875*(v/=3)+.0625,u+=1/3,uvs1.push(u,1-v);for(offset=(heightSegments+1)*(capSegments+1),lat=0;lat<latitudeBands;++lat)for(lon=0;lon<longitudeBands;++lon)second=(first=lat*(longitudeBands+1)+lon)+longitudeBands+1,indices.push(offset+first+1,offset+second,offset+first),indices.push(offset+first+1,offset+second+1,offset+second);for(lat=0;lat<=latitudeBands;lat++)for(theta=.5*Math.PI+lat*Math.PI*.5/latitudeBands,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta),lon=0;lon<=longitudeBands;lon++)phi=2*lon*Math.PI/longitudeBands-Math.PI/2,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-lon/longitudeBands,v=1-lat/latitudeBands,positions.push(x*peakRadius,y*peakRadius-capOffset,z*peakRadius),normals.push(x,y,z),uvs.push(u,1-v),u=.875*(u/=3)+.0625,v=.875*(v/=3)+.0625,u+=2/3,uvs1.push(u,1-v);for(offset=(heightSegments+1)*(capSegments+1)+(longitudeBands+1)*(latitudeBands+1),lat=0;lat<latitudeBands;++lat)for(lon=0;lon<longitudeBands;++lon)second=(first=lat*(longitudeBands+1)+lon)+longitudeBands+1,indices.push(offset+first+1,offset+second,offset+first),indices.push(offset+first+1,offset+second+1,offset+second)}else{if(offset=(heightSegments+1)*(capSegments+1),baseRadius>0)for(i=0;i<capSegments;i++)theta=i/capSegments*2*Math.PI,y=-height/2,u=1-((x=Math.sin(theta))+1)/2,v=((z=Math.cos(theta))+1)/2,positions.push(x*baseRadius,y,z*baseRadius),normals.push(0,-1,0),uvs.push(u,1-v),u=.875*(u/=3)+.0625,v=.875*(v/=3)+.0625,u+=1/3,uvs1.push(u,1-v),i>1&&indices.push(offset,offset+i,offset+i-1);if(offset+=capSegments,peakRadius>0)for(i=0;i<capSegments;i++)theta=i/capSegments*2*Math.PI,y=height/2,u=1-((x=Math.sin(theta))+1)/2,v=((z=Math.cos(theta))+1)/2,positions.push(x*peakRadius,y,z*peakRadius),normals.push(0,1,0),uvs.push(u,1-v),u=.875*(u/=3)+.0625,v=.875*(v/=3)+.0625,u+=2/3,uvs1.push(u,1-v),i>1&&indices.push(offset,offset+i-1,offset+i)}return{positions,normals,uvs,uvs1,indices}}var Uniform$3,CubeGeometry=function(_super){function CubeGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1},props))||this}return(0,tslib_es6.C6)(CubeGeometry,_super),Object.defineProperty(CubeGeometry.prototype,"width",{get:function(){return this.props.width},set:function(v){this.props.width!==v&&(this.props.width=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CubeGeometry.prototype,"height",{get:function(){return this.props.height},set:function(v){this.props.height!==v&&(this.props.height=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CubeGeometry.prototype,"depth",{get:function(){return this.props.depth},set:function(v){this.props.depth!==v&&(this.props.depth=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CubeGeometry.prototype,"widthSegments",{get:function(){return this.props.widthSegments},set:function(v){this.props.widthSegments!==v&&(this.props.widthSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(CubeGeometry.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(v){this.props.heightSegments!==v&&(this.props.heightSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(CubeGeometry.prototype,"depthSegments",{get:function(){return this.props.depthSegments},set:function(v){this.props.depthSegments!==v&&(this.props.depthSegments=v,this.build())},enumerable:!1,configurable:!0}),CubeGeometry.prototype.createTopology=function(){var _a=this.props,_b=_a.widthSegments,widthSegments=void 0===_b?1:_b,_c=_a.heightSegments,heightSegments=void 0===_c?1:_c,_d=_a.depthSegments,depthSegments=void 0===_d?1:_d,_e=_a.height,height=void 0===_e?1:_e,_f=_a.width,width=void 0===_f?1:_f,_g=_a.depth,ws=widthSegments,hs=heightSegments,ds=depthSegments,hex=width/2,hey=height/2,hez=(void 0===_g?1:_g)/2,corners=[fromValues(-hex,-hey,hez),fromValues(hex,-hey,hez),fromValues(hex,hey,hez),fromValues(-hex,hey,hez),fromValues(hex,-hey,-hez),fromValues(-hex,-hey,-hez),fromValues(-hex,hey,-hez),fromValues(hex,hey,-hez)],faceAxes=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],faceNormals=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],sides_BACK=1,sides_TOP=2,sides_BOTTOM=3,sides_RIGHT=4,sides_LEFT=5,positions=[],normals=[],uvs=[],uvs1=[],indices=[],vcounter=0,generateFace=function(side,uSegments,vSegments){var u,v,i,j;for(i=0;i<=uSegments;i++)for(j=0;j<=vSegments;j++){var temp1=create(),temp2=create(),temp3=create(),r=create();lerp(temp1,corners[faceAxes[side][0]],corners[faceAxes[side][1]],i/uSegments),lerp(temp2,corners[faceAxes[side][0]],corners[faceAxes[side][2]],j/vSegments),sub(temp3,temp2,corners[faceAxes[side][0]]),add(r,temp1,temp3),u=i/uSegments,v=j/vSegments,positions.push(r[0],r[1],r[2]),normals.push(faceNormals[side][0],faceNormals[side][1],faceNormals[side][2]),uvs.push(u,1-v),u=.875*(u/=3)+.0625,v=.875*(v/=3)+.0625,u+=side%3/3,v+=Math.floor(side/3)/3,uvs1.push(u,1-v),i<uSegments&&j<vSegments&&(indices.push(vcounter+vSegments+1,vcounter+1,vcounter),indices.push(vcounter+vSegments+1,vcounter+vSegments+2,vcounter+1)),vcounter++}};return generateFace(0,ws,hs),generateFace(sides_BACK,ws,hs),generateFace(sides_TOP,ws,ds),generateFace(sides_BOTTOM,ws,ds),generateFace(sides_RIGHT,ds,hs),generateFace(sides_LEFT,ds,hs),{indices,positions,normals,uvs,uv1s:uvs1}},CubeGeometry}(ProceduralGeometry),SphereGeometry=function(_super){function SphereGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({radius:.5,latitudeBands:16,longitudeBands:16},props))||this}return(0,tslib_es6.C6)(SphereGeometry,_super),Object.defineProperty(SphereGeometry.prototype,"radius",{get:function(){return this.props.radius},set:function(v){this.props.radius!==v&&(this.props.radius=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(SphereGeometry.prototype,"latitudeBands",{get:function(){return this.props.latitudeBands},set:function(v){this.props.latitudeBands!==v&&(this.props.latitudeBands=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(SphereGeometry.prototype,"longitudeBands",{get:function(){return this.props.longitudeBands},set:function(v){this.props.longitudeBands!==v&&(this.props.longitudeBands=v,this.build())},enumerable:!1,configurable:!0}),SphereGeometry.prototype.createTopology=function(){var lon,lat,theta,sinTheta,cosTheta,phi,sinPhi,first,second,x,y,z,u,v,_a=this.props,_b=_a.radius,radius=void 0===_b?.5:_b,_c=_a.latitudeBands,latitudeBands=void 0===_c?16:_c,_d=_a.longitudeBands,longitudeBands=void 0===_d?16:_d,positions=[],normals=[],uvs=[],indices=[];for(lat=0;lat<=latitudeBands;lat++)for(theta=lat*Math.PI/latitudeBands,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta),lon=0;lon<=longitudeBands;lon++)phi=2*lon*Math.PI/longitudeBands-Math.PI/2,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-lon/longitudeBands,v=1-lat/latitudeBands,positions.push(x*radius,y*radius,z*radius),normals.push(x,y,z),uvs.push(u,1-v);for(lat=0;lat<latitudeBands;++lat)for(lon=0;lon<longitudeBands;++lon)second=(first=lat*(longitudeBands+1)+lon)+longitudeBands+1,indices.push(first+1,second,first),indices.push(first+1,second+1,second);return{indices,positions,normals,uvs,uv1s:uvs}},SphereGeometry}(ProceduralGeometry),PlaneGeometry=(function(_super){function TorusGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({tubeRadius:.2,ringRadius:.3,segments:30,sides:20},props))||this}(0,tslib_es6.C6)(TorusGeometry,_super),Object.defineProperty(TorusGeometry.prototype,"tubeRadius",{get:function(){return this.props.tubeRadius},set:function(v){this.props.tubeRadius!==v&&(this.props.tubeRadius=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(TorusGeometry.prototype,"ringRadius",{get:function(){return this.props.ringRadius},set:function(v){this.props.ringRadius!==v&&(this.props.ringRadius=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(TorusGeometry.prototype,"segments",{get:function(){return this.props.segments},set:function(v){this.props.segments!==v&&(this.props.segments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(TorusGeometry.prototype,"sides",{get:function(){return this.props.sides},set:function(v){this.props.sides!==v&&(this.props.sides=v,this.build())},enumerable:!1,configurable:!0}),TorusGeometry.prototype.createTopology=function(){var x,y,z,nx,ny,nz,u,v,i,j,_a=this.props,_b=_a.tubeRadius,tubeRadius=void 0===_b?.2:_b,_c=_a.ringRadius,ringRadius=void 0===_c?.3:_c,_d=_a.segments,segments=void 0===_d?30:_d,_e=_a.sides,sides=void 0===_e?20:_e,rc=tubeRadius,rt=ringRadius,positions=[],normals=[],uvs=[],indices=[];for(i=0;i<=sides;i++)for(j=0;j<=segments;j++)if(x=Math.cos(2*Math.PI*j/segments)*(rt+rc*Math.cos(2*Math.PI*i/sides)),y=Math.sin(2*Math.PI*i/sides)*rc,z=Math.sin(2*Math.PI*j/segments)*(rt+rc*Math.cos(2*Math.PI*i/sides)),nx=Math.cos(2*Math.PI*j/segments)*Math.cos(2*Math.PI*i/sides),ny=Math.sin(2*Math.PI*i/sides),nz=Math.sin(2*Math.PI*j/segments)*Math.cos(2*Math.PI*i/sides),u=i/sides,v=1-j/segments,positions.push(x,y,z),normals.push(nx,ny,nz),uvs.push(u,1-v),i<sides&&j<segments){var first=i*(segments+1)+j,second=(i+1)*(segments+1)+j,third=i*(segments+1)+(j+1),fourth=(i+1)*(segments+1)+(j+1);indices.push(first,second,third),indices.push(second,fourth,third)}return{indices,positions,normals,uvs,uv1s:uvs}}}(ProceduralGeometry),function(_super){function PlaneGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({width:1,depth:1,widthSegments:5,depthSegments:5},props))||this}return(0,tslib_es6.C6)(PlaneGeometry,_super),Object.defineProperty(PlaneGeometry.prototype,"width",{get:function(){return this.props.width},set:function(v){this.props.width!==v&&(this.props.width=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(PlaneGeometry.prototype,"depth",{get:function(){return this.props.depth},set:function(v){this.props.depth!==v&&(this.props.depth=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(PlaneGeometry.prototype,"widthSegments",{get:function(){return this.props.widthSegments},set:function(v){this.props.widthSegments!==v&&(this.props.widthSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(PlaneGeometry.prototype,"depthSegments",{get:function(){return this.props.depthSegments},set:function(v){this.props.depthSegments!==v&&(this.props.depthSegments=v,this.build())},enumerable:!1,configurable:!0}),PlaneGeometry.prototype.createTopology=function(){var i,j,x,z,u,v,positions=[],normals=[],uvs=[],indices=[],_a=this.props,_b=_a.widthSegments,widthSegments=void 0===_b?5:_b,_c=_a.depthSegments,depthSegments=void 0===_c?5:_c,_d=_a.width,width=void 0===_d?1:_d,_e=_a.depth,he_x=width/2,he_y=(void 0===_e?1:_e)/2,ws=widthSegments,ls=depthSegments,vcounter=0;for(i=0;i<=ws;i++)for(j=0;j<=ls;j++)x=2*he_x*i/ws-he_x,0,z=-(2*he_y*j/ls-he_y),u=i/ws,v=j/ls,positions.push(x,0,z),normals.push(0,1,0),uvs.push(u,1-v),i<ws&&j<ls&&(indices.push(vcounter+ls+1,vcounter+1,vcounter),indices.push(vcounter+ls+1,vcounter+ls+2,vcounter+1)),vcounter++;return{indices,positions,normals,uvs,uv1s:uvs}},PlaneGeometry}(ProceduralGeometry)),AmbientLight=(function(_super){function CylinderGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({radius:.5,height:1,heightSegments:5,capSegments:20},props))||this}(0,tslib_es6.C6)(CylinderGeometry,_super),Object.defineProperty(CylinderGeometry.prototype,"radius",{get:function(){return this.props.radius},set:function(v){this.props.radius!==v&&(this.props.radius=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CylinderGeometry.prototype,"height",{get:function(){return this.props.height},set:function(v){this.props.height!==v&&(this.props.height=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CylinderGeometry.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(v){this.props.heightSegments!==v&&(this.props.heightSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(CylinderGeometry.prototype,"capSegments",{get:function(){return this.props.capSegments},set:function(v){this.props.capSegments!==v&&(this.props.capSegments=v,this.build())},enumerable:!1,configurable:!0}),CylinderGeometry.prototype.createTopology=function(){var _a=this.props,radius=_a.radius,_b=createConeData(radius,radius,_a.height,_a.heightSegments,_a.capSegments,!1);return{indices:_b.indices,positions:_b.positions,normals:_b.normals,uvs:_b.uvs,uv1s:_b.uvs1}}}(ProceduralGeometry),function(_super){function ConeGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({baseRadius:.5,peakRadius:0,height:1,heightSegments:5,capSegments:18},props))||this}(0,tslib_es6.C6)(ConeGeometry,_super),Object.defineProperty(ConeGeometry.prototype,"baseRadius",{get:function(){return this.props.baseRadius},set:function(v){this.props.baseRadius!==v&&(this.props.baseRadius=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(ConeGeometry.prototype,"peakRadius",{get:function(){return this.props.peakRadius},set:function(v){this.props.peakRadius!==v&&(this.props.peakRadius=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(ConeGeometry.prototype,"height",{get:function(){return this.props.height},set:function(v){this.props.height!==v&&(this.props.height=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(ConeGeometry.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(v){this.props.heightSegments!==v&&(this.props.heightSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(ConeGeometry.prototype,"capSegments",{get:function(){return this.props.capSegments},set:function(v){this.props.capSegments!==v&&(this.props.capSegments=v,this.build())},enumerable:!1,configurable:!0}),ConeGeometry.prototype.createTopology=function(){var _a=this.props,_b=createConeData(_a.baseRadius,_a.peakRadius,_a.height,_a.heightSegments,_a.capSegments,!1);return{indices:_b.indices,positions:_b.positions,normals:_b.normals,uvs:_b.uvs,uv1s:_b.uvs1}}}(ProceduralGeometry),function(_super){function CapsuleGeometry(device,props){return void 0===props&&(props={}),_super.call(this,device,(0,tslib_es6.Cl)({radius:.5,height:1,heightSegments:1,sides:20},props))||this}(0,tslib_es6.C6)(CapsuleGeometry,_super),Object.defineProperty(CapsuleGeometry.prototype,"radius",{get:function(){return this.props.radius},set:function(v){this.props.radius!==v&&(this.props.radius=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CapsuleGeometry.prototype,"height",{get:function(){return this.props.height},set:function(v){this.props.height!==v&&(this.props.height=v,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(CapsuleGeometry.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(v){this.props.heightSegments!==v&&(this.props.heightSegments=v,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(CapsuleGeometry.prototype,"sides",{get:function(){return this.props.sides},set:function(v){this.props.sides!==v&&(this.props.sides=v,this.build())},enumerable:!1,configurable:!0}),CapsuleGeometry.prototype.createTopology=function(){var _a=this.props,radius=_a.radius,_b=createConeData(radius,radius,_a.height-2*radius,_a.heightSegments,_a.sides,!0);return{indices:_b.indices,positions:_b.positions,normals:_b.normals,uvs:_b.uvs,uv1s:_b.uvs1}}}(ProceduralGeometry),function(_super){function AmbientLight(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,(0,tslib_es6.Cl)({style:(0,tslib_es6.Cl)({fill:"black"},style)},rest))||this).define="NUM_AMBIENT_LIGHTS",_this.order=-1,_this}return(0,tslib_es6.C6)(AmbientLight,_super),AmbientLight.prototype.uploadUBO=function(uniforms,index){var fill=this.parsedStyle.fill;if(isCSSRGB(fill)){var fillColor=[Number(fill.r)/255,Number(fill.g)/255,Number(fill.b)/255];uniforms.push({name:"u_AmbientLightColor",value:fillColor})}},AmbientLight}(Light)),DirectionalLight=function(_super){function DirectionalLight(_a){void 0===_a&&(_a={});var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,(0,tslib_es6.Cl)({style:(0,tslib_es6.Cl)({direction:fromValues(0,-1,0)},style)},rest))||this).define="NUM_DIR_LIGHTS",_this.order=10,_this}return(0,tslib_es6.C6)(DirectionalLight,_super),DirectionalLight.prototype.getUniformWordCount=function(){return 8},DirectionalLight.prototype.uploadUBO=function(uniforms,index){var _a=this.parsedStyle,fill=_a.fill,direction=_a.direction,intensity=_a.intensity;if(isCSSRGB(fill)){var fillColor=[Number(fill.r)/255,Number(fill.g)/255,Number(fill.b)/255];uniforms.push({name:"directionalLights[".concat(index,"].direction"),value:direction}),uniforms.push({name:"directionalLights[".concat(index,"].intensity"),value:intensity}),uniforms.push({name:"directionalLights[".concat(index,"].color"),value:fillColor})}},DirectionalLight}(Light);!function(Uniform){Uniform.MAP="u_Map",Uniform.PLACE_HOLDER="u_Placeholder"}(Uniform$3||(Uniform$3={}));var Uniform$2,MeshBasicMaterial=function(_super){function MeshBasicMaterial(device,props){var _a,_this=_super.call(this,device,(0,tslib_es6.Cl)({vertexShader:"#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec4 u_Placeholder;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nvoid main() {\n  // WGSL will remove unused uniforms.\n  float a = u_Placeholder.x;\n\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  gl_Position = project(vec4(a_Position, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec4 u_Placeholder;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n    vec4 diffuseColor = outputColor;\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    reflectedLight.indirectDiffuse += vec3( 1.0 );\n    reflectedLight.indirectDiffuse *= outputColor.rgb;\n\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n    \n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",cullMode:CullMode.BACK},props))||this;_this.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},_this.defines),{USE_UV:!0,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1});var _b=props||{},map=_b.map,wireframe=_b.wireframe;return map&&(_this.map=map),_this.wireframe=wireframe,_this.setUniforms(((_a={})[Uniform$3.PLACE_HOLDER]=[0,0,0,0],_a)),_this}return(0,tslib_es6.C6)(MeshBasicMaterial,_super),Object.defineProperty(MeshBasicMaterial.prototype,"map",{get:function(){return this.props.map},set:function(v){var _a;this.props.map!==v&&(this.props.map=v,this.programDirty=!0),this.setUniforms(((_a={})[Uniform$3.MAP]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshBasicMaterial.prototype,"aoMap",{get:function(){return this.props.aoMap},set:function(v){this.props.aoMap=v},enumerable:!1,configurable:!0}),MeshBasicMaterial}(Material);!function(Uniform){Uniform.EMISSIVE="u_Emissive",Uniform.SHININESS="u_Shininess",Uniform.SPECULAR="u_Specular",Uniform.BUMP_SCALE="u_BumpScale",Uniform.SPECULAR_MAP="u_SpecularMap",Uniform.BUMP_MAP="u_BumpMap"}(Uniform$2||(Uniform$2={}));var Uniform$1,MeshPhongMaterial=function(_super){function MeshPhongMaterial(device,props){var _a,_this=_super.call(this,device,(0,tslib_es6.Cl)({vertexShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n  float u_Shininess;\n  vec3 u_Specular;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = NORMAL) in vec3 a_Normal;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nout vec3 v_ViewPosition;\nout vec3 v_Normal;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec4 position = vec4(a_Position, 1.0);\n\n  gl_Position = project(position, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * position;\n  v_ViewPosition = - mvPosition.xyz;\n\n  // v_ViewPosition = vec3(mvPosition) / mvPosition.w;\n\n  mat3 normalWorld = mat3(transposeMat3(inverseMat3(mat3(u_ViewMatrix * u_ModelMatrix))));\n  v_Normal = normalize(normalWorld * a_Normal);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n  float u_Shininess;\n  vec3 u_Specular;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#if defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  uniform sampler2D u_BumpMap;\n\n  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n  vec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( v_Uv );\n    vec2 dSTdy = dFdy( v_Uv );\n\n    float Hll = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv ).x;\n    float dBx = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdx ).x - Hll;\n    float dBy = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdy ).x - Hll;\n\n    return vec2( dBx, dBy );\n  }\n\n  vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n  }\n#endif\n#ifdef USE_SPECULARMAP\n  uniform sampler2D u_SpecularMap;\n#endif\nvec3 BRDF_Lambert(vec3 diffuseColor) {\n  return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(\n  vec3 f0,\n  float f90,\n  float dotVH\n) {\n  // Original approximation by Christophe Schlick '94\n  // float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n  // Optimized variant (presented by Epic at SIGGRAPH '13)\n  // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n  float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n  return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\n\nfloat G_BlinnPhong_Implicit( /* float dotNL, float dotNV */ ) {\n  // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n  return 0.25;\n}\n\nfloat D_BlinnPhong(\n  float shininess,\n  float dotNH\n) {\n  return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\n\nvec3 BRDF_BlinnPhong(\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 normal,\n  vec3 specularColor,\n  float shininess\n) {\n  vec3 halfDir = normalize( lightDir + viewDir );\n\n  float dotNH = saturate( dot( normal, halfDir ) );\n  float dotVH = saturate( dot( viewDir, halfDir ) );\n\n  vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n  float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n  float D = D_BlinnPhong( shininess, dotNH );\n\n  return F * ( G * D );\n}\n\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\n#ifdef USE_LIGHT\n  void getDirectionalLightInfo(\n    DirectionalLight directionalLight, \n    GeometricContext geometry,\n    out IncidentLight light\n  ) {\n    light.color = directionalLight.color * directionalLight.intensity;\n    light.direction = normalize(directionalLight.direction);\n    light.visible = true;\n  }\n\n  vec3 getAmbientLightIrradiance( vec3 ambientLightColor ) {\n    vec3 irradiance = ambientLightColor;\n    return irradiance;\n  }\n#endif\nstruct BlinnPhongMaterial {\n  vec3 diffuseColor;\n  vec3 specularColor;\n  float specularShininess;\n  float specularStrength;\n};\n\nvoid RE_Direct_BlinnPhong(\n  IncidentLight directLight,\n  GeometricContext geometry,\n  BlinnPhongMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  float dotNL = saturate(dot(geometry.normal, directLight.direction));\n  vec3 irradiance = dotNL * directLight.color;\n\n  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong(\n  vec3 irradiance,\n  GeometricContext geometry,\n  BlinnPhongMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\n#define RE_Direct           RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse  RE_IndirectDiffuse_BlinnPhong\n\nin vec3 v_ViewPosition;\nin vec3 v_Normal;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  // diffusemap\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n  // specularmap\n  float specularStrength = 1.0;\n\n#ifdef USE_SPECULARMAP\n  vec4 texelSpecular = texture(SAMPLER_2D(u_SpecularMap), v_Uv);\n  specularStrength = texelSpecular.r;\n#endif\n  // bumpmap & normalmap\n  float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\nvec3 normal = normalize(v_Normal);\n#ifdef USE_DOUBLESIDE\n  normal = normal * faceDirection;\n#endif\n\n// #ifdef USE_TANGENT\n//   vec3 tangent = normalize( vTangent );\n//   vec3 bitangent = normalize( vBitangent );\n\n//   #ifdef DOUBLE_SIDED\n//     tangent = tangent * faceDirection;\n//     bitangent = bitangent * faceDirection;\n//   #endif\n\n// #if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n// mat3 vTBN = mat3( tangent, bitangent, normal );\n\n// #endif\n// #endif\n  #ifdef OBJECTSPACE_NORMALMAP\n  // normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n  // #ifdef FLIP_SIDED\n  //   normal = - normal;\n  // #endif\n\n  // #ifdef DOUBLE_SIDED\n  //   normal = normal * faceDirection;\n  // #endif\n\n  // normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n  // vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n  // mapN.xy *= normalScale;\n\n  // #ifdef USE_TANGENT\n  //   normal = normalize( vTBN * mapN );\n  // #else\n  //   normal = perturbNormal2Arb( - v_ViewPosition, normal, mapN, faceDirection );\n  // #endif\n\n#elif defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  normal = perturbNormalArb( - v_ViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    vec4 diffuseColor = outputColor;\n    ReflectedLight reflectedLight = ReflectedLight(vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\n    vec3 totalEmissiveRadiance = u_Emissive;\n\n    // calculate lighting accumulation\n    BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = u_Specular;\nmaterial.specularShininess = u_Shininess;\nmaterial.specularStrength = specularStrength;\n    GeometricContext geometry;\ngeometry.position = - v_ViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = u_IsOrtho == 1.0 ? vec3(0, 0, 1) : normalize(v_ViewPosition);\n\nIncidentLight directLight;\n#if defined( NUM_DIR_LIGHTS ) && ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n    DirectionalLightShadow directionalLightShadow;\n  #endif\n\n  #pragma unroll_loop_start\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n    directionalLight = directionalLights[ i ];\n\n    getDirectionalLightInfo( directionalLight, geometry, directLight );\n\n    #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n      directionalLightShadow = directionalLightShadows[ i ];\n      directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n  #pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n  vec3 iblIrradiance = vec3(0.0);\n  vec3 ambient = vec3(0.0);\n  #ifdef NUM_AMBIENT_LIGHTS\n    ambient = u_AmbientLightColor;\n  #endif\n  vec3 irradiance = getAmbientLightIrradiance(ambient);\n\n  // irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n  // #if ( NUM_HEMI_LIGHTS > 0 )\n  //   #pragma unroll_loop_start\n  //   for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n  //     irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n  //   }\n  //   #pragma unroll_loop_end\n  // #endif\n#endif\n\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearcoatRadiance = vec3( 0.0 );\n#endif\n\n    #if defined( RE_IndirectDiffuse )\n  RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n\n#if defined( RE_IndirectSpecular )\n  RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif\n\n    vec3 outgoingLight = reflectedLight.directDiffuse +\n      reflectedLight.indirectDiffuse + \n      reflectedLight.directSpecular + \n      reflectedLight.indirectSpecular + \n      totalEmissiveRadiance;\n\n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",emissive:"black",shininess:30,specular:"#111111",bumpScale:1,doubleSide:!1},props))||this,_b=_this,specularMap=_b.specularMap,bumpMap=_b.bumpMap,doubleSide=_b.doubleSide,emissive=_b.emissive,shininess=_b.shininess,specular=_b.specular,emissiveColor=parseColor(emissive),specularColor=parseColor(specular);return _this.setUniforms(((_a={u_Placeholder:null})[Uniform$2.EMISSIVE]=[Number(emissiveColor.r)/255,Number(emissiveColor.g)/255,Number(emissiveColor.b)/255],_a[Uniform$2.SHININESS]=shininess,_a[Uniform$2.SPECULAR]=[Number(specularColor.r)/255,Number(specularColor.g)/255,Number(specularColor.b)/255],_a)),specularMap&&(_this.specularMap=specularMap),bumpMap&&(_this.bumpMap=bumpMap),_this.doubleSide=doubleSide,_this.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},_this.defines),{USE_LIGHT:!0}),_this}return(0,tslib_es6.C6)(MeshPhongMaterial,_super),Object.defineProperty(MeshPhongMaterial.prototype,"emissive",{get:function(){return this.props.emissive},set:function(v){var _a;this.props.emissive=v;var emissiveColor=parseColor(v);this.setUniforms(((_a={})[Uniform$2.EMISSIVE]=[Number(emissiveColor.r)/255,Number(emissiveColor.g)/255,Number(emissiveColor.b)/255],_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"shininess",{get:function(){return this.props.shininess},set:function(v){var _a;this.props.shininess=v,this.setUniforms(((_a={})[Uniform$2.SHININESS]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"specular",{get:function(){return this.props.specular},set:function(v){var _a;this.props.specular=v;var specularColor=parseColor(v);this.setUniforms(((_a={})[Uniform$2.SPECULAR]=[Number(specularColor.r)/255,Number(specularColor.g)/255,Number(specularColor.b)/255],_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"specularMap",{get:function(){return this.props.specularMap},set:function(v){var _a;this.props.map!==v&&(this.props.specularMap=v,this.programDirty=!0),this.defines.USE_SPECULARMAP=!!v,this.setUniforms(((_a={})[Uniform$2.SPECULAR_MAP]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"bumpMap",{get:function(){return this.props.bumpMap},set:function(v){var _a;this.props.map!==v&&(this.props.bumpMap=v,this.programDirty=!0),this.defines.USE_BUMPMAP=!!v,this.setUniforms(((_a={})[Uniform$2.BUMP_MAP]=v,_a[Uniform$2.BUMP_SCALE]=this.bumpScale,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"bumpScale",{get:function(){return this.props.bumpScale},set:function(v){var _a;this.props.bumpScale=v,this.setUniforms(((_a={})[Uniform$2.BUMP_SCALE]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshPhongMaterial.prototype,"doubleSide",{get:function(){return this.props.doubleSide},set:function(v){this.props.doubleSide=v,this.defines.USE_DOUBLESIDE=v},enumerable:!1,configurable:!0}),MeshPhongMaterial}(MeshBasicMaterial);!function(Uniform){Uniform.EMISSIVE="u_Emissive",Uniform.BUMP_SCALE="u_BumpScale",Uniform.BUMP_MAP="u_BumpMap"}(Uniform$1||(Uniform$1={}));var Uniform,MeshLambertMaterial=function(_super){function MeshLambertMaterial(device,props){var _a,_this=_super.call(this,device,(0,tslib_es6.Cl)({vertexShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = NORMAL) in vec3 a_Normal;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nout vec3 v_ViewPosition;\nout vec3 v_Normal;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec4 position = vec4(a_Position, 1.0);\n\n  gl_Position = project(position, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * position;\n  v_ViewPosition = - mvPosition.xyz;\n\n  // v_ViewPosition = vec3(mvPosition) / mvPosition.w;\n\n  mat3 normalWorld = mat3(transposeMat3(inverseMat3(mat3(u_ViewMatrix * u_ModelMatrix))));\n  v_Normal = normalize(normalWorld * a_Normal);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#if defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  uniform sampler2D u_BumpMap;\n\n  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n  vec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( v_Uv );\n    vec2 dSTdy = dFdy( v_Uv );\n\n    float Hll = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv ).x;\n    float dBx = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdx ).x - Hll;\n    float dBy = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdy ).x - Hll;\n\n    return vec2( dBx, dBy );\n  }\n\n  vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n  }\n#endif\n#ifdef USE_SPECULARMAP\n  uniform sampler2D u_SpecularMap;\n#endif\nvec3 BRDF_Lambert(vec3 diffuseColor) {\n  return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(\n  vec3 f0,\n  float f90,\n  float dotVH\n) {\n  // Original approximation by Christophe Schlick '94\n  // float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n  // Optimized variant (presented by Epic at SIGGRAPH '13)\n  // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n  float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n  return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\n\nfloat G_BlinnPhong_Implicit( /* float dotNL, float dotNV */ ) {\n  // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n  return 0.25;\n}\n\nfloat D_BlinnPhong(\n  float shininess,\n  float dotNH\n) {\n  return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\n\nvec3 BRDF_BlinnPhong(\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 normal,\n  vec3 specularColor,\n  float shininess\n) {\n  vec3 halfDir = normalize( lightDir + viewDir );\n\n  float dotNH = saturate( dot( normal, halfDir ) );\n  float dotVH = saturate( dot( viewDir, halfDir ) );\n\n  vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n  float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n  float D = D_BlinnPhong( shininess, dotNH );\n\n  return F * ( G * D );\n}\n\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\n#ifdef USE_LIGHT\n  void getDirectionalLightInfo(\n    DirectionalLight directionalLight, \n    GeometricContext geometry,\n    out IncidentLight light\n  ) {\n    light.color = directionalLight.color * directionalLight.intensity;\n    light.direction = normalize(directionalLight.direction);\n    light.visible = true;\n  }\n\n  vec3 getAmbientLightIrradiance( vec3 ambientLightColor ) {\n    vec3 irradiance = ambientLightColor;\n    return irradiance;\n  }\n#endif\nstruct LambertMaterial {\n  vec3 diffuseColor;\n  float specularStrength;\n};\n\nvoid RE_Direct_Lambert(\n  IncidentLight directLight,\n  GeometricContext geometry,\n  LambertMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  float dotNL = saturate(dot(geometry.normal, directLight.direction));\n  vec3 irradiance = dotNL * directLight.color;\n\n  reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Lambert(\n  vec3 irradiance,\n  GeometricContext geometry,\n  LambertMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n\nin vec3 v_ViewPosition;\nin vec3 v_Normal;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  // diffusemap\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n  // specularmap\n  float specularStrength = 1.0;\n\n#ifdef USE_SPECULARMAP\n  vec4 texelSpecular = texture(SAMPLER_2D(u_SpecularMap), v_Uv);\n  specularStrength = texelSpecular.r;\n#endif\n  // bumpmap & normalmap\n  float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\nvec3 normal = normalize(v_Normal);\n#ifdef USE_DOUBLESIDE\n  normal = normal * faceDirection;\n#endif\n\n// #ifdef USE_TANGENT\n//   vec3 tangent = normalize( vTangent );\n//   vec3 bitangent = normalize( vBitangent );\n\n//   #ifdef DOUBLE_SIDED\n//     tangent = tangent * faceDirection;\n//     bitangent = bitangent * faceDirection;\n//   #endif\n\n// #if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n// mat3 vTBN = mat3( tangent, bitangent, normal );\n\n// #endif\n// #endif\n  #ifdef OBJECTSPACE_NORMALMAP\n  // normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n  // #ifdef FLIP_SIDED\n  //   normal = - normal;\n  // #endif\n\n  // #ifdef DOUBLE_SIDED\n  //   normal = normal * faceDirection;\n  // #endif\n\n  // normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n  // vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n  // mapN.xy *= normalScale;\n\n  // #ifdef USE_TANGENT\n  //   normal = normalize( vTBN * mapN );\n  // #else\n  //   normal = perturbNormal2Arb( - v_ViewPosition, normal, mapN, faceDirection );\n  // #endif\n\n#elif defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  normal = perturbNormalArb( - v_ViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    vec4 diffuseColor = outputColor;\n    ReflectedLight reflectedLight = ReflectedLight(vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\n    vec3 totalEmissiveRadiance = u_Emissive;\n\n    // calculate lighting accumulation\n    LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;\n    GeometricContext geometry;\ngeometry.position = - v_ViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = u_IsOrtho == 1.0 ? vec3(0, 0, 1) : normalize(v_ViewPosition);\n\nIncidentLight directLight;\n#if defined( NUM_DIR_LIGHTS ) && ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n    DirectionalLightShadow directionalLightShadow;\n  #endif\n\n  #pragma unroll_loop_start\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n    directionalLight = directionalLights[ i ];\n\n    getDirectionalLightInfo( directionalLight, geometry, directLight );\n\n    #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n      directionalLightShadow = directionalLightShadows[ i ];\n      directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n  #pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n  vec3 iblIrradiance = vec3(0.0);\n  vec3 ambient = vec3(0.0);\n  #ifdef NUM_AMBIENT_LIGHTS\n    ambient = u_AmbientLightColor;\n  #endif\n  vec3 irradiance = getAmbientLightIrradiance(ambient);\n\n  // irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n  // #if ( NUM_HEMI_LIGHTS > 0 )\n  //   #pragma unroll_loop_start\n  //   for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n  //     irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n  //   }\n  //   #pragma unroll_loop_end\n  // #endif\n#endif\n\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearcoatRadiance = vec3( 0.0 );\n#endif\n\n    #if defined( RE_IndirectDiffuse )\n  RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n\n#if defined( RE_IndirectSpecular )\n  RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif\n\n    vec3 outgoingLight = reflectedLight.directDiffuse +\n      reflectedLight.indirectDiffuse + \n      totalEmissiveRadiance;\n\n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",emissive:"black",bumpScale:1,doubleSide:!1},props))||this,_b=_this,bumpMap=_b.bumpMap,doubleSide=_b.doubleSide,emissive=_b.emissive,emissiveColor=parseColor(emissive);return _this.setUniforms(((_a={u_Placeholder:null})[Uniform$1.EMISSIVE]=[Number(emissiveColor.r)/255,Number(emissiveColor.g)/255,Number(emissiveColor.b)/255],_a)),bumpMap&&(_this.bumpMap=bumpMap),_this.doubleSide=doubleSide,_this.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},_this.defines),{USE_LIGHT:!0}),_this}return(0,tslib_es6.C6)(MeshLambertMaterial,_super),Object.defineProperty(MeshLambertMaterial.prototype,"emissive",{get:function(){return this.props.emissive},set:function(v){var _a;this.props.emissive=v;var emissiveColor=parseColor(v);this.setUniforms(((_a={})[Uniform$1.EMISSIVE]=[Number(emissiveColor.r)/255,Number(emissiveColor.g)/255,Number(emissiveColor.b)/255],_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshLambertMaterial.prototype,"bumpMap",{get:function(){return this.props.bumpMap},set:function(v){var _a;this.props.map!==v&&(this.props.bumpMap=v,this.programDirty=!0),this.defines.USE_BUMPMAP=!!v,this.setUniforms(((_a={})[Uniform$1.BUMP_MAP]=v,_a[Uniform$1.BUMP_SCALE]=this.bumpScale,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshLambertMaterial.prototype,"bumpScale",{get:function(){return this.props.bumpScale},set:function(v){var _a;this.props.bumpScale=v,this.setUniforms(((_a={})[Uniform$1.BUMP_SCALE]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(MeshLambertMaterial.prototype,"doubleSide",{get:function(){return this.props.doubleSide},set:function(v){this.props.doubleSide=v,this.defines.USE_DOUBLESIDE=v},enumerable:!1,configurable:!0}),MeshLambertMaterial}(MeshBasicMaterial);!function(Uniform){Uniform.MAP="u_Map",Uniform.PLACE_HOLDER="u_Placeholder",Uniform.SIZE="u_Size"}(Uniform||(Uniform={}));!function(_super){function PointMaterial(device,props){var _a,_this=_super.call(this,device,(0,tslib_es6.Cl)({vertexShader:"#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  float u_Size;\n  vec4 u_Placeholder;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  gl_PointSize = u_Size;\n  gl_Position = project(vec4(a_Position, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  float u_Size;\n  vec4 u_Placeholder;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec2 uv = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);\n\tvec4 mapTexel = texture(SAMPLER_2D(u_Map), uv);\n  u_Color *= mapTexel;\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n    vec4 diffuseColor = outputColor;\n\n    vec3 outgoingLight = diffuseColor.rgb;\n    \n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",cullMode:CullMode.BACK},props))||this;_this.defines=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},_this.defines),{USE_UV:!0,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1});var _b=props||{},map=_b.map,size=_b.size;return map&&(_this.map=map),_this.setUniforms(((_a={})[Uniform.PLACE_HOLDER]=[0,0,0,0],_a[Uniform.SIZE]=size||1,_a)),_this}(0,tslib_es6.C6)(PointMaterial,_super),Object.defineProperty(PointMaterial.prototype,"map",{get:function(){return this.props.map},set:function(v){var _a;this.props.map!==v&&(this.props.map=v,this.programDirty=!0),this.setUniforms(((_a={})[Uniform.MAP]=v,_a))},enumerable:!1,configurable:!0}),Object.defineProperty(PointMaterial.prototype,"size",{get:function(){return this.props.size},set:function(v){var _a;this.props.size=v,this.setUniforms(((_a={})[Uniform.SIZE]=v,_a))},enumerable:!1,configurable:!0})}(Material);var g_plugin_3d_dist_index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="3d",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){},Plugin.prototype.destroy=function(){},Plugin}(AbstractRendererPlugin),DragndropPlugin=function(){function DragndropPlugin(dragndropPluginOptions){this.dragndropPluginOptions=dragndropPluginOptions}return DragndropPlugin.prototype.apply=function(context){var _this=this,renderingService=context.renderingService,document=context.renderingContext.root.ownerDocument,canvas=document.defaultView,handlePointerdown=function(event){var target=event.target,isDocument=target===document,draggableEventTarget=isDocument&&_this.dragndropPluginOptions.isDocumentDraggable?document:target.closest&&target.closest("[draggable=true]");if(draggableEventTarget){var dragstartTriggered_1=!1,dragstartTimeStamp_1=event.timeStamp,dragstartClientCoordinates_1=[event.clientX,event.clientY],currentDroppable_1=null,lastDragClientCoordinates_1=[event.clientX,event.clientY],handlePointermove_1=function(event){return(0,tslib_es6.sH)(_this,void 0,void 0,(function(){var timeElapsed,distanceMoved,point,elementsBelow,elementBelow,droppableBelow;return(0,tslib_es6.YH)(this,(function(_a){switch(_a.label){case 0:if(!dragstartTriggered_1){if(timeElapsed=event.timeStamp-dragstartTimeStamp_1,distanceMoved=distanceSquareRoot([event.clientX,event.clientY],dragstartClientCoordinates_1),timeElapsed<=this.dragndropPluginOptions.dragstartTimeThreshold||distanceMoved<=this.dragndropPluginOptions.dragstartDistanceThreshold)return[2];event.type="dragstart",draggableEventTarget.dispatchEvent(event),dragstartTriggered_1=!0}return event.type="drag",event.dx=event.clientX-lastDragClientCoordinates_1[0],event.dy=event.clientY-lastDragClientCoordinates_1[1],draggableEventTarget.dispatchEvent(event),lastDragClientCoordinates_1=[event.clientX,event.clientY],isDocument?[3,2]:(point="pointer"===this.dragndropPluginOptions.overlap?[event.canvasX,event.canvasY]:target.getBounds().center,[4,document.elementsFromPoint(point[0],point[1])]);case 1:elementsBelow=_a.sent(),elementBelow=elementsBelow[elementsBelow.indexOf(target)+1],droppableBelow=(null==elementBelow?void 0:elementBelow.closest("[droppable=true]"))||(this.dragndropPluginOptions.isDocumentDroppable?document:null),currentDroppable_1!==droppableBelow&&(currentDroppable_1&&(event.type="dragleave",event.target=currentDroppable_1,currentDroppable_1.dispatchEvent(event)),droppableBelow&&(event.type="dragenter",event.target=droppableBelow,droppableBelow.dispatchEvent(event)),(currentDroppable_1=droppableBelow)&&(event.type="dragover",event.target=currentDroppable_1,currentDroppable_1.dispatchEvent(event))),_a.label=2;case 2:return[2]}}))}))};canvas.addEventListener("pointermove",handlePointermove_1);var stopDragging=function(originalPointerUpEvent){if(dragstartTriggered_1){originalPointerUpEvent.detail={preventClick:!0};var event_1=originalPointerUpEvent.clone();currentDroppable_1&&(event_1.type="drop",event_1.target=currentDroppable_1,currentDroppable_1.dispatchEvent(event_1)),event_1.type="dragend",draggableEventTarget.dispatchEvent(event_1),dragstartTriggered_1=!1}canvas.removeEventListener("pointermove",handlePointermove_1)};target.addEventListener("pointerup",stopDragging,{once:!0}),target.addEventListener("pointerupoutside",stopDragging,{once:!0})}};renderingService.hooks.init.tap(DragndropPlugin.tag,(function(){canvas.addEventListener("pointerdown",handlePointerdown)})),renderingService.hooks.destroy.tap(DragndropPlugin.tag,(function(){canvas.removeEventListener("pointerdown",handlePointerdown)}))},DragndropPlugin.tag="Dragndrop",DragndropPlugin}(),g_plugin_dragndrop_dist_index_esm_Plugin=function(_super){function Plugin(options){void 0===options&&(options={});var _this=_super.call(this)||this;return _this.options=options,_this.name="dragndrop",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){this.addRenderingPlugin(new DragndropPlugin((0,tslib_es6.Cl)({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins()},Plugin.prototype.setOptions=function(options){Object.assign(this.plugins[0].dragndropPluginOptions,options)},Plugin}(AbstractRendererPlugin),SVGPickerPlugin=function(){function SVGPickerPlugin(){}return SVGPickerPlugin.prototype.apply=function(context,runtime){var _this=this,doc=context.config.document,renderingService=context.renderingService,svgElementMap=context.svgElementMap;renderingService.hooks.pick.tapPromise(SVGPickerPlugin.tag,(function(result){return(0,tslib_es6.sH)(_this,void 0,void 0,(function(){return(0,tslib_es6.YH)(this,(function(_a){return[2,this.pick(svgElementMap,doc,result)]}))}))})),renderingService.hooks.pickSync.tap(SVGPickerPlugin.tag,(function(result){return _this.pick(svgElementMap,doc,result)}))},SVGPickerPlugin.prototype.pick=function(svgElementMap,doc,result){var e_1,_a,topmost=result.topmost,_b=result.position,clientX=_b.clientX,clientY=_b.clientY;try{var targets=[];try{for(var _c=(0,tslib_es6.Ju)((doc||document).elementsFromPoint(clientX,clientY)),_d=_c.next();!_d.done;_d=_c.next()){var element=_d.value,target=svgElementMap.get(element);if(target&&target.isInteractive()&&(targets.push(target),topmost))return result.picked=targets,result}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_1)throw e_1.error}}result.picked=targets}catch(e){result.picked=[]}return result},SVGPickerPlugin.tag="SVGPicker",SVGPickerPlugin}(),g_plugin_svg_picker_dist_index_esm_Plugin=function(_super){function Plugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="svg-picker",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(){this.addRenderingPlugin(new SVGPickerPlugin)},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins()},Plugin}(AbstractRendererPlugin),ElementSVG=function(){function ElementSVG(){}return ElementSVG.tag="c-svg-element",ElementSVG}();function createSVGElement(type,doc){return(doc||document).createElementNS("http://www.w3.org/2000/svg",type)}var FILTER_PREFIX="g-filter-";function createOrUpdateFilter(document,$def,object,$el,filters){var filterName=FILTER_PREFIX+object.entity,$existedFilters=$def.querySelectorAll("[name=".concat(filterName,"]"));if($existedFilters.length&&$existedFilters.forEach((function($filter){$def.removeChild($filter)})),0===filters.length)null==$el||$el.removeAttribute("filter");else{var filterIds_1=filters.map((function(_a,i){var name=_a.name,params=_a.params,$filter=createSVGElement("filter",document);return $filter.setAttribute("filterUnits","userSpaceOnUse"),"blur"===name?function createBlur(document,$filter,params){var $feGaussianBlur=createSVGElement("feGaussianBlur",document);$feGaussianBlur.setAttribute("in","SourceGraphic"),$feGaussianBlur.setAttribute("stdDeviation","".concat(params[0].value)),$filter.appendChild($feGaussianBlur)}(document,$filter,params):"brightness"===name?function createBrightness(document,$filter,params){var slope=convertToAbsoluteValue(params[0]);createFeComponentTransfer(document,$filter,{type:"linear",slope,intercept:0})}(document,$filter,params):"drop-shadow"===name?function createDropShadow(document,$filter,params){var shadowOffsetX=params[0].value,shadowOffsetY=params[1].value,shadowBlur=params[2].value,shadowColor=params[3].formatted,$feGaussianBlur=createSVGElement("feGaussianBlur",document);$feGaussianBlur.setAttribute("in","SourceAlpha"),$feGaussianBlur.setAttribute("stdDeviation","".concat(shadowBlur)),$filter.appendChild($feGaussianBlur);var $feOffset=createSVGElement("feOffset",document);$feOffset.setAttribute("dx","".concat(shadowOffsetX)),$feOffset.setAttribute("dy","".concat(shadowOffsetY)),$feOffset.setAttribute("result","offsetblur"),$filter.appendChild($feOffset);var $feFlood=createSVGElement("feFlood",document);$feFlood.setAttribute("flood-color",shadowColor),$filter.appendChild($feFlood);var $feComposite=createSVGElement("feComposite",document);$feComposite.setAttribute("in2","offsetblur"),$feComposite.setAttribute("operator","in"),$filter.appendChild($feComposite);var $feMerge=createSVGElement("feMerge",document);$filter.appendChild($feMerge);var $feMergeNode1=createSVGElement("feMergeNode",document),$feMergeNode2=createSVGElement("feMergeNode",document);$feMergeNode2.setAttribute("in","SourceGraphic"),$feMerge.appendChild($feMergeNode1),$feMerge.appendChild($feMergeNode2)}(document,$filter,params):"contrast"===name?function createContrast(document,$filter,params){var slope=convertToAbsoluteValue(params[0]);createFeComponentTransfer(document,$filter,{type:"linear",slope,intercept:-.5*slope+.5})}(document,$filter,params):"grayscale"===name?function createGrayscale(document,$filter,params){var amount=convertToAbsoluteValue(params[0]);createFeColorMatrix(document,$filter,[.2126+.7874*(1-amount),.7152-.7152*(1-amount),.0722-.0722*(1-amount),0,0,.2126-.2126*(1-amount),.7152+.2848*(1-amount),.0722-.0722*(1-amount),0,0,.2126-.2126*(1-amount),.7152-.7152*(1-amount),.0722+.9278*(1-amount),0,0,0,0,0,1,0])}(document,$filter,params):"sepia"===name?function createSepia(document,$filter,params){var amount=convertToAbsoluteValue(params[0]);createFeColorMatrix(document,$filter,[.393+.607*(1-amount),.769-.769*(1-amount),.189-.189*(1-amount),0,0,.349-.349*(1-amount),.686+.314*(1-amount),.168-.168*(1-amount),0,0,.272-.272*(1-amount),.534-.534*(1-amount),.131+.869*(1-amount),0,0,0,0,0,1,0])}(document,$filter,params):"saturate"===name?function createSaturate(document,$filter,params){var amount=convertToAbsoluteValue(params[0]),$feColorMatrix=createSVGElement("feColorMatrix",document);$feColorMatrix.setAttribute("type","saturate"),$feColorMatrix.setAttribute("values","".concat(amount)),$filter.appendChild($feColorMatrix)}(document,$filter,params):"hue-rotate"===name?function createHueRotate(document,$filter,params){var $feColorMatrix=createSVGElement("feColorMatrix",document);$feColorMatrix.setAttribute("type","hueRotate"),$feColorMatrix.setAttribute("values","".concat(params[0].value)),$filter.appendChild($feColorMatrix)}(document,$filter,params):"invert"===name&&function createInvert(document,$filter,params){var amount=convertToAbsoluteValue(params[0]);createFeComponentTransfer(document,$filter,{type:"table",tableValues:"".concat(amount," ").concat(1-amount)})}(document,$filter,params),$filter.id="".concat(filterName,"-").concat(i),$filter.setAttribute("name",filterName),$def.appendChild($filter),$filter.id}));setTimeout((function(){null==$el||$el.setAttribute("filter",filterIds_1.map((function(filterId){return"url(#".concat(filterId,")")})).join(" "))}))}}function convertToAbsoluteValue(param){return param.unit===UnitType.kPercentage?param.value/100:param.value}function createFeComponentTransfer(document,$filter,_a){var type=_a.type,slope=_a.slope,intercept=_a.intercept,tableValues=_a.tableValues,$feComponentTransfer=createSVGElement("feComponentTransfer",document);[createSVGElement("feFuncR",document),createSVGElement("feFuncG",document),createSVGElement("feFuncB",document)].forEach((function($feFunc){$feFunc.setAttribute("type",type),"table"===type?$feFunc.setAttribute("tableValues","".concat(tableValues)):($feFunc.setAttribute("slope","".concat(slope)),$feFunc.setAttribute("intercept","".concat(intercept))),$feComponentTransfer.appendChild($feFunc)})),$filter.appendChild($feComponentTransfer)}function createFeColorMatrix(document,$filter,matrix){var $feColorMatrix=createSVGElement("feColorMatrix",document);$feColorMatrix.setAttribute("type","matrix"),$feColorMatrix.setAttribute("values",matrix.join(" ")),$filter.appendChild($feColorMatrix)}var PATTERN_PREFIX="g-pattern-",cacheKey2IDMap={},index_esm_counter=0;function createOrUpdateGradientAndPattern(document,$def,object,$el,parsedColor,name,createImage,plugin){if(!parsedColor)return"";if(!isCSSRGB(parsedColor)){if(isPattern(parsedColor)){var patternId=function createOrUpdatePattern(document,$def,object,pattern,createImage,plugin){var patternId=generateCacheKey(pattern),$existed=$def.querySelector("#".concat(patternId));if(!$existed){var image=pattern.image,imageURL="";if((0,is_string.A)(image)?imageURL=image:isBrowser&&(image instanceof HTMLImageElement?imageURL=image.src:image instanceof HTMLCanvasElement&&(imageURL=image.toDataURL())),imageURL){var img_1,$image_1=createSVGElement("image",document);$image_1.setAttribute("href",imageURL),createImage?img_1=createImage(imageURL):isBrowser&&(img_1=new window.Image),imageURL.match(/^data:/i)||(img_1.crossOrigin="Anonymous",$image_1.setAttribute("crossorigin","anonymous")),img_1.src=imageURL;var onload_1=function(){var $pattern=create$Pattern(document,$def,object,pattern,patternId,img_1.width,img_1.height);$def.appendChild($pattern),$pattern.appendChild($image_1),$image_1.setAttribute("x","0"),$image_1.setAttribute("y","0"),$image_1.setAttribute("width","".concat(img_1.width)),$image_1.setAttribute("height","".concat(img_1.height))};img_1.complete?onload_1():img_1.onload=onload_1}if("rect"===image.nodeName){var _a=image.parsedStyle,width=_a.width,height=_a.height,$pattern=create$Pattern(document,$def,image,pattern,patternId,width,height);image.forEach((function(object){plugin.createSVGDom(document,object,null);var svgElement=object.elementSVG,localTransform=object.getLocalTransform();plugin.applyTransform(svgElement.$groupEl,localTransform)}));var svgElement=image.elementSVG;$pattern.appendChild(svgElement.$groupEl)}}return patternId}(document,$def,object,parsedColor,createImage,plugin);return $el.style[name]="url(#".concat(patternId,")"),patternId}if(1===parsedColor.length){var gradientId=createOrUpdateGradient(document,object,$def,$el,parsedColor[0]);return null==$el||$el.setAttribute(name,"url(#".concat(gradientId,")")),gradientId}var filterId=function createOrUpdateMultiGradient(document,object,$def,$el,gradients){var filterId=FILTER_PREFIX+object.entity+"-gradient",$existed=$def.querySelector("#".concat(filterId));$existed||(($existed=createSVGElement("filter",document)).setAttribute("filterUnits","userSpaceOnUse"),$existed.setAttribute("x","0%"),$existed.setAttribute("y","0%"),$existed.setAttribute("width","100%"),$existed.setAttribute("height","100%"),$existed.id=filterId,$def.appendChild($existed));var blended=0;gradients.forEach((function(gradient,i){var gradientId=createOrUpdateGradient(document,object,$def,$el,gradient),rectId=gradientId+"_rect",$rect=createSVGElement("rect",document);$rect.setAttribute("x","0"),$rect.setAttribute("y","0"),$rect.setAttribute("width","100%"),$rect.setAttribute("height","100%"),$rect.setAttribute("fill","url(#".concat(gradientId,")")),$rect.id=rectId,$def.appendChild($rect);var $feImage=createSVGElement("feImage",document);if($feImage.setAttribute("href","#".concat(rectId)),$feImage.setAttribute("result","".concat(filterId,"-").concat(i)),$existed.appendChild($feImage),i>0){var $feBlend=createSVGElement("feBlend",document);$feBlend.setAttribute("in",1===i?"".concat(filterId,"-").concat(i-1):"".concat(filterId,"-blended-").concat(blended-1)),$feBlend.setAttribute("in2","".concat(filterId,"-").concat(i)),$feBlend.setAttribute("result","".concat(filterId,"-blended-").concat(blended++)),$feBlend.setAttribute("mode","multiply"),$existed.appendChild($feBlend)}}));var $feComposite=createSVGElement("feComposite",document);return $feComposite.setAttribute("in","".concat(filterId,"-blended-").concat(blended)),$feComposite.setAttribute("in2","SourceGraphic"),$feComposite.setAttribute("operator","in"),$existed.appendChild($feComposite),filterId}(document,object,$def,$el,parsedColor);return null==$el||$el.setAttribute("filter","url(#".concat(filterId,")")),null==$el||$el.setAttribute("fill","black"),filterId}return"currentColor"===object.style[name]?null==$el||$el.setAttribute(name,"currentColor"):null==$el||$el.setAttribute(name,parsedColor.isNone?"none":parsedColor.toString()),""}function generateCacheKey(src,options){void 0===options&&(options={});var cacheKey="";if(function isCSSGradientValue(object){return!!object.type&&!!object.value}(src)){var type=src.type,value=src.value;if(type===GradientType.LinearGradient||type===GradientType.RadialGradient){var _a=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},value),options),type_1=_a.type,width=_a.width,height=_a.height,steps=_a.steps,angle=_a.angle,cx=_a.cx,cy=_a.cy,size=_a.size;cacheKey="gradient-".concat(type_1,"-").concat((null==angle?void 0:angle.toString())||0,"-").concat((null==cx?void 0:cx.toString())||0,"-").concat((null==cy?void 0:cy.toString())||0,"-").concat((null==size?void 0:size.toString())||0,"-").concat(width,"-").concat(height,"-").concat(steps.map((function(_a){var offset=_a.offset,color=_a.color;return"".concat(offset).concat(color)})).join("-"))}}else isPattern(src)&&(cacheKey=(0,is_string.A)(src.image)?"pattern-".concat(src.image,"-").concat(src.repetition):"rect"===src.image.nodeName?"pattern-rect-".concat(src.image.entity):"pattern-".concat(index_esm_counter));return cacheKey&&(cacheKey2IDMap[cacheKey]||(cacheKey2IDMap[cacheKey]=PATTERN_PREFIX+"".concat(index_esm_counter++))),cacheKey2IDMap[cacheKey]}function create$Pattern(document,$def,object,pattern,patternId,width,height){var repetition=pattern.repetition,transform=pattern.transform,$pattern=createSVGElement("pattern",document);transform&&$pattern.setAttribute("patternTransform",function formatTransform(transform){return parseTransform(transform).map((function(parsed){var t=parsed.t,d=parsed.d;if("translate"===t)return"translate(".concat(d[0].value," ").concat(d[1].value,")");if("translatex"===t)return"translate(".concat(d[0].value," 0)");if("translatey"===t)return"translate(0 ".concat(d[0].value,")");if("rotate"===t)return"rotate(".concat(d[0].value,")");if("scale"===t){var newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1,1];return"scale(".concat(newScale[0],", ").concat(newScale[1],")")}if("scalex"===t)return newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1],"scale(".concat(newScale[0],", 1)");if("scaley"===t)return newScale=(null==d?void 0:d.map((function(s){return s.value})))||[1],"scale(1, ".concat(newScale[0],")");if("skew"===t){var newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0,0];return"skewX(".concat(newSkew[0],") skewY(").concat(newSkew[1],")")}if("skewx"===t)return newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0],"skewX(".concat(newSkew[0],")");if("skewy"===t)return newSkew=(null==d?void 0:d.map((function(s){return s.value})))||[0],"skewY(".concat(newSkew[0],")");if("matrix"===t){var _a=(0,tslib_es6.zs)(d.map((function(s){return s.value})),6),a=_a[0],b=_a[1],c=_a[2],dd=_a[3],tx=_a[4],ty=_a[5];return"matrix(".concat(a," ").concat(b," ").concat(c," ").concat(dd," ").concat(tx," ").concat(ty,")")}})).join(" ")}(transform)),$pattern.setAttribute("patternUnits","userSpaceOnUse"),$pattern.id=patternId,$def.appendChild($pattern),$pattern.setAttribute("x","0"),$pattern.setAttribute("y","0");var halfExtents=object.getGeometryBounds().halfExtents,patternWidth=width,patternHeight=height;return"repeat-x"===repetition?patternHeight=2*halfExtents[1]:"repeat-y"===repetition?patternWidth=2*halfExtents[0]:"no-repeat"===repetition&&(patternWidth=2*halfExtents[0],patternHeight=2*halfExtents[1]),$pattern.setAttribute("width","".concat(patternWidth)),$pattern.setAttribute("height","".concat(patternHeight)),$pattern}function createOrUpdateGradient(document,object,$def,$el,parsedColor){var bounds=object.getGeometryBounds(),width=bounds&&2*bounds.halfExtents[0]||0,height=bounds&&2*bounds.halfExtents[1]||0,gradientId=generateCacheKey(parsedColor,{width,height}),$existed=$def.querySelector("#".concat(gradientId));if(!$existed){($existed=createSVGElement(parsedColor.type===GradientType.LinearGradient?"linearGradient":"radialGradient",document)).setAttribute("gradientUnits","userSpaceOnUse");var innerHTML_1="";parsedColor.value.steps.sort((function(a,b){return a.offset.value-b.offset.value})).forEach((function(_a){var offset=_a.offset,color=_a.color;innerHTML_1+='<stop offset="'.concat(offset.value/100,'" stop-color="').concat(color,'"></stop>')})),$existed.innerHTML=innerHTML_1,$existed.id=gradientId,$def.appendChild($existed)}if(parsedColor.type===GradientType.LinearGradient){var _a=computeLinearGradient(width,height,parsedColor.value.angle),x1=_a.x1,y1=_a.y1,x2=_a.x2,y2=_a.y2;$existed.setAttribute("x1","".concat(x1)),$existed.setAttribute("y1","".concat(y1)),$existed.setAttribute("x2","".concat(x2)),$existed.setAttribute("y2","".concat(y2))}else{var _b=parsedColor.value,_c=computeRadialGradient(width,height,_b.cx,_b.cy,_b.size),x=_c.x,y=_c.y,r=_c.r;$existed.setAttribute("cx","".concat(x)),$existed.setAttribute("cy","".concat(y)),$existed.setAttribute("r","".concat(r))}return gradientId}var urlRegexp=/url\("?#(.*)\)/,DefElementManager=function(){function DefElementManager(context){this.context=context,this.gradientCache={}}return DefElementManager.prototype.getDefElement=function(){return this.$def},DefElementManager.prototype.init=function(){var document=this.context.config.document,$svg=this.context.contextService.getContext();this.$def=createSVGElement("defs",document),$svg.appendChild(this.$def)},DefElementManager.prototype.clear=function(entity){var _this=this;Object.keys(this.gradientCache).forEach((function(id){_this.clearUnusedDefElement(_this.gradientCache,id,entity)}))},DefElementManager.prototype.clearUnusedDefElement=function(cache,id,entity){if(cache[id]&&1===cache[id].size&&cache[id].has(entity)){var targetElement=this.$def.querySelector("#".concat(id));targetElement&&this.$def.removeChild(targetElement)}},DefElementManager.prototype.createOrUpdateGradientAndPattern=function(object,$el,parsedColor,name,plugin){var _a=this.context.config,doc=_a.document,createImage=_a.createImage;if($el){var matches=(isPattern(parsedColor)?$el.style[name]:$el.getAttribute(name)||"").match(urlRegexp);matches&&matches.length>1&&this.clearUnusedDefElement(this.gradientCache,matches[1].replace('"',""),object.entity);var newDefElementId=createOrUpdateGradientAndPattern(doc||document,this.$def,object,$el,parsedColor,name,createImage,plugin);newDefElementId&&(this.gradientCache[newDefElementId]||(this.gradientCache[newDefElementId]=new Set),this.gradientCache[newDefElementId].add(object.entity))}},DefElementManager.prototype.createOrUpdateShadow=function(object,$el,name){!function createOrUpdateShadow(document,$def,object,$el,name){var _a=object.parsedStyle,shadowType=_a.shadowType,shadowBlur=_a.shadowBlur,shadowColor=_a.shadowColor,shadowOffsetX=_a.shadowOffsetX,shadowOffsetY=_a.shadowOffsetY,hasShadow=!(0,is_nil.A)(shadowColor)&&shadowBlur>0,shadowId="g-filter-dropshadow-"+object.entity,$existedFilter=$def.querySelector("#".concat(shadowId));if($existedFilter&&($existedFilter.getAttribute("data-type")===shadowType&&hasShadow||($existedFilter.remove(),$existedFilter=null)),hasShadow){if(null==$el||$el.setAttribute("filter","url(#".concat(shadowId,")")),!$existedFilter){if(($existedFilter=createSVGElement("filter",document)).setAttribute("data-type",shadowType),"outer"===shadowType)($feDropShadow=createSVGElement("feDropShadow",document)).setAttribute("dx","".concat((shadowOffsetX||0)/2)),$feDropShadow.setAttribute("dy","".concat((shadowOffsetY||0)/2)),$feDropShadow.setAttribute("stdDeviation","".concat((shadowBlur||0)/4)),$feDropShadow.setAttribute("flood-color",shadowColor.toString()),$existedFilter.appendChild($feDropShadow);else if("inner"===shadowType){var $feComponentTransfer=createSVGElement("feComponentTransfer",document);$feComponentTransfer.setAttribute("in","SourceAlpha");var $feFuncA=createSVGElement("feFuncA",document);$feFuncA.setAttribute("type","table"),$feFuncA.setAttribute("tableValues","1 0"),$feComponentTransfer.appendChild($feFuncA),$existedFilter.appendChild($feComponentTransfer),($feGaussianBlur=createSVGElement("feGaussianBlur",document)).setAttribute("stdDeviation","".concat((shadowBlur||0)/4)),$existedFilter.appendChild($feGaussianBlur),($feOffset=createSVGElement("feOffset",document)).setAttribute("dx","".concat((shadowOffsetX||0)/2)),$feOffset.setAttribute("dy","".concat((shadowOffsetY||0)/2)),$feOffset.setAttribute("result","offsetblur"),$existedFilter.appendChild($feOffset),($feFlood=createSVGElement("feFlood",document)).setAttribute("flood-color",shadowColor.toString()),$feFlood.setAttribute("result","color"),$existedFilter.appendChild($feFlood);var $feComposite=createSVGElement("feComposite",document);$feComposite.setAttribute("in2","offsetblur"),$feComposite.setAttribute("operator","in"),$existedFilter.appendChild($feComposite);var $feComposite2=createSVGElement("feComposite",document);$feComposite2.setAttribute("in2","SourceAlpha"),$feComposite2.setAttribute("operator","in"),$existedFilter.appendChild($feComposite2);var $feMerge=createSVGElement("feMerge",document);$existedFilter.appendChild($feMerge);var $feMergeNode=createSVGElement("feMergeNode",document);$feMergeNode.setAttribute("in","SourceGraphic");var $feMergeNode2=createSVGElement("feMergeNode",document);$feMerge.appendChild($feMergeNode),$feMerge.appendChild($feMergeNode2)}return $existedFilter.id=shadowId,$existedFilter.setAttribute("filterUnits","userSpaceOnUse"),void $def.appendChild($existedFilter)}if("inner"===shadowType){var $feGaussianBlur=$existedFilter.children[1],$feOffset=$existedFilter.children[2],$feFlood=$existedFilter.children[3];"shadowColor"===name?$feFlood.setAttribute("flood-color",shadowColor.toString()):"shadowBlur"===name?$feGaussianBlur.setAttribute("stdDeviation","".concat((shadowBlur||0)/4)):"shadowOffsetX"===name?$feOffset.setAttribute("dx","".concat((shadowOffsetX||0)/2)):"shadowOffsetY"===name&&$feOffset.setAttribute("dy","".concat((shadowOffsetY||0)/2))}else if("outer"===shadowType){var $feDropShadow=$existedFilter.children[0];"shadowColor"===name?$feDropShadow.setAttribute("flood-color",shadowColor.toString()):"shadowBlur"===name?$feDropShadow.setAttribute("stdDeviation","".concat((shadowBlur||0)/4)):"shadowOffsetX"===name?$feDropShadow.setAttribute("dx","".concat((shadowOffsetX||0)/2)):"shadowOffsetY"===name&&$feDropShadow.setAttribute("dy","".concat((shadowOffsetY||0)/2))}}else null==$el||$el.removeAttribute("filter")}(this.context.config.document||document,this.$def,object,$el,name)},DefElementManager.prototype.createOrUpdateFilter=function(object,$el,filters){createOrUpdateFilter(this.context.config.document||document,this.$def,object,$el,filters)},DefElementManager}();function index_esm_numberToLongString(x){return x.toFixed(6).replace(".000000","")}function convertHTML(str){return str.replace(/[&|<|>|"|']/g,(function(match){return"&"===match?"&amp;":"<"===match?"&lt;":">"===match?"&gt;":'"'===match?"&quot;":"&apos;"}))}var index_esm_a,_b,SVG_ATTR_MAP={opacity:"opacity",fillStyle:"fill",fill:"fill",fillRule:"fill-rule",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",clipPath:"clip-path",textPath:"text-path",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",letterSpacing:"letter-spacing",startArrow:"marker-start",endArrow:"marker-end",class:"class",id:"id",preserveAspectRatio:"preserveAspectRatio",visibility:"visibility",anchor:"anchor",shadowColor:"flood-color",shadowBlur:"stdDeviation",shadowOffsetX:"dx",shadowOffsetY:"dy",filter:"filter",innerHTML:"innerHTML",textAlign:"text-anchor",pointerEvents:"pointer-events"},FORMAT_VALUE_MAP={textAlign:{inherit:"inherit",left:"left",start:"left",center:"middle",right:"end",end:"end"}},DEFAULT_VALUE_MAP={textAlign:"inherit",lineCap:"butt",lineJoin:"miter",lineWidth:"1px",opacity:"1",fillOpacity:"1",fillRule:"nonzero",strokeOpacity:"1",strokeWidth:"0",strokeMiterLimit:"4",letterSpacing:"0",fontSize:"inherit",fontFamily:"inherit",pointerEvents:"auto"},SVGRendererPlugin=function(){function SVGRendererPlugin(pluginOptions,defElementManager,context){this.pluginOptions=pluginOptions,this.defElementManager=defElementManager,this.context=context,this.svgElementMap=new WeakMap,this.renderQueue=[],this.dirtyAttributes=new WeakMap,this.pendingReorderQueue=new Set,this.clipPathUseMap=new WeakMap}return SVGRendererPlugin.prototype.apply=function(context){var _this=this,renderingService=context.renderingService,renderingContext=context.renderingContext;this.context=context,this.context.svgElementMap=this.svgElementMap;var canvas=renderingContext.root.ownerDocument.defaultView,document=this.context.config.document,handleMounted=function(e){var object=e.target;if(_this.clipPathUseMap.get(object)){var existed=_this.defElementManager.getDefElement().querySelector("#".concat(_this.getId(object)));existed&&existed.remove()}_this.createSVGDom(document,object,_this.$camera)},handleUnmounted=function(e){var object=e.target;_this.defElementManager.clear(object.entity),_this.clipPathUseMap.delete(object),_this.removeSVGDom(object)},reorderChildren=function(object){var _a,_b,parent=object.parentNode,$groupEl=null===(_b=null===(_a=object.parentNode)||void 0===_a?void 0:_a.elementSVG)||void 0===_b?void 0:_b.$groupEl,children=((null==parent?void 0:parent.children)||[]).slice();$groupEl&&_this.reorderChildren(document,$groupEl,children)},handleReparent=function(e){var object=e.target;reorderChildren(object)},handleAttributeChanged=function(e){var object=e.target;if(object.elementSVG){var attrName=e.attrName,attribtues=_this.dirtyAttributes.get(object);attribtues||(_this.dirtyAttributes.set(object,[]),attribtues=_this.dirtyAttributes.get(object)),attribtues.push(attrName)}},handleGeometryBoundsChanged=function(e){var _a,object=e.target,$el=null===(_a=object.elementSVG)||void 0===_a?void 0:_a.$el,_b=object.parsedStyle,fill=_b.fill,stroke=_b.stroke,clipPath=_b.clipPath;if(fill&&!isCSSRGB(fill)&&_this.defElementManager.createOrUpdateGradientAndPattern(object,$el,fill,"fill",_this),stroke&&!isCSSRGB(stroke)&&_this.defElementManager.createOrUpdateGradientAndPattern(object,$el,stroke,"stroke",_this),clipPath){var parentInvert=invert(mat4_create(),object.getWorldTransform()),clipPathId="clip-path-"+clipPath.entity+"-"+object.entity,$existed=_this.defElementManager.getDefElement().querySelector("#".concat(clipPathId));$existed&&_this.applyTransform($existed,parentInvert)}};renderingService.hooks.init.tap(SVGRendererPlugin.tag,(function(){var _a=_this.context.config,background=_a.background,document=_a.document;_this.defElementManager.init();var $svg=_this.context.contextService.getContext();background&&($svg.style.background=background),$svg.setAttribute("color-interpolation-filters","sRGB"),_this.$camera=createSVGElement("g",document),_this.$camera.id="".concat("g-svg","-camera"),_this.applyTransform(_this.$camera,_this.context.camera.getOrthoMatrix()),$svg.appendChild(_this.$camera),canvas.addEventListener(ElementEvent.MOUNTED,handleMounted),canvas.addEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.addEventListener(ElementEvent.REPARENT,handleReparent),canvas.addEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.addEventListener(ElementEvent.BOUNDS_CHANGED,handleGeometryBoundsChanged)})),renderingService.hooks.destroy.tap(SVGRendererPlugin.tag,(function(){canvas.removeEventListener(ElementEvent.MOUNTED,handleMounted),canvas.removeEventListener(ElementEvent.UNMOUNTED,handleUnmounted),canvas.removeEventListener(ElementEvent.REPARENT,handleReparent),canvas.removeEventListener(ElementEvent.ATTR_MODIFIED,handleAttributeChanged),canvas.removeEventListener(ElementEvent.BOUNDS_CHANGED,handleGeometryBoundsChanged),function resetPatternCounter(){index_esm_counter=0,cacheKey2IDMap={}}()})),renderingService.hooks.render.tap(SVGRendererPlugin.tag,(function(object){_this.renderQueue.push(object)})),renderingService.hooks.beginFrame.tap(SVGRendererPlugin.tag,(function(){var doc=_this.context.config.document;_this.pendingReorderQueue.size&&(_this.pendingReorderQueue.forEach((function(object){var _a,children=((null==object?void 0:object.children)||[]).slice(),$parentGroupEl=null===(_a=null==object?void 0:object.elementSVG)||void 0===_a?void 0:_a.$groupEl;$parentGroupEl&&_this.reorderChildren(doc||document,$parentGroupEl,children||[])})),_this.pendingReorderQueue.clear())})),renderingService.hooks.endFrame.tap(SVGRendererPlugin.tag,(function(){renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED)&&_this.applyTransform(_this.$camera,_this.context.camera.getOrthoMatrix()),_this.renderQueue.forEach((function(object){var _a,_b,$el=null===(_a=object.elementSVG)||void 0===_a?void 0:_a.$el,$groupEl=null===(_b=object.elementSVG)||void 0===_b?void 0:_b.$groupEl;if($el&&$groupEl){var localTransform=object.getLocalTransform();_this.applyTransform($groupEl,localTransform);var $useRefs=_this.clipPathUseMap.get(object);$useRefs&&$useRefs.length&&$useRefs.forEach((function($use){_this.applyTransform($use,object.getWorldTransform())})),object.renderable.dirty=!1}var attributes=_this.dirtyAttributes.get(object);attributes&&(attributes.forEach((function(attrName){"zIndex"===attrName?reorderChildren(object):"increasedLineWidthForHitTesting"===attrName&&_this.createOrUpdateHitArea(object,$el,$groupEl),_this.updateAttribute(object,[attrName])})),_this.dirtyAttributes.delete(object))})),_this.renderQueue=[]}))},SVGRendererPlugin.prototype.getId=function(object){return object.id||"".concat("g-svg","-").concat(object.entity)},SVGRendererPlugin.prototype.reorderChildren=function(doc,$groupEl,children){if(children.sort((function(a,b){return a.sortable.renderOrder-b.sortable.renderOrder})),children.length){var fragment_1=(doc||document).createDocumentFragment();children.forEach((function(child){if(child.isConnected){var $el=child.elementSVG.$groupEl;$el&&fragment_1.appendChild($el)}})),$groupEl.appendChild(fragment_1)}},SVGRendererPlugin.prototype.applyTransform=function($el,rts){$el.setAttribute("transform","matrix(".concat(index_esm_numberToLongString(rts[0]),",").concat(index_esm_numberToLongString(rts[1]),",").concat(index_esm_numberToLongString(rts[4]),",").concat(index_esm_numberToLongString(rts[5]),",").concat(index_esm_numberToLongString(rts[12]),",").concat(index_esm_numberToLongString(rts[13]),")"))},SVGRendererPlugin.prototype.applyAttributes=function(object){var elementSVG=object.elementSVG,$el=null==elementSVG?void 0:elementSVG.$el,$groupEl=null==elementSVG?void 0:elementSVG.$groupEl;if($el&&$groupEl){var nodeName=object.nodeName,attributes=object.attributes;nodeName!==Shape.HTML&&$el.setAttribute("fill","none"),nodeName===Shape.IMAGE&&$el.setAttribute("preserveAspectRatio","none"),this.updateAttribute(object,Object.keys(attributes))}},SVGRendererPlugin.prototype.updateAttribute=function(object,attributes){var _this=this,enableCSSParsing=this.context.enableCSSParsing,document=this.context.config.document,_a=object.elementSVG,$el=_a.$el,$groupEl=_a.$groupEl,$hitTestingEl=_a.$hitTestingEl,parsedStyle=object.parsedStyle,computedStyle=object.computedStyle,nodeName=object.nodeName;attributes.some((function(name){return _this.context.SVGElementLifeCycleContribution.shouldUpdateElementAttribute(object,name)}))&&$el&&[$el,$hitTestingEl].forEach((function($el){$el&&(_this.context.SVGElementLifeCycleContribution.updateElementAttribute(object,$el,_this.svgElementMap),object.nodeName!==Shape.TEXT&&_this.updateAnchorWithTransform(object))})),attributes.forEach((function(name){var _a,_b,usedName=SVG_ATTR_MAP[name],computedValue=enableCSSParsing?computedStyle[name]:parsedStyle[name],computedValueStr=!(0,is_nil.A)(computedValue)&&computedValue.toString(),formattedValueStr=(null===(_a=FORMAT_VALUE_MAP[name])||void 0===_a?void 0:_a[computedValueStr])||computedValueStr,usedValue=parsedStyle[name],inherited=usedName&&!!(null===(_b=propertyMetadataCache[name])||void 0===_b?void 0:_b.inh);if(nodeName===Shape.HTML)"fill"===name?$el.style.background=usedValue.toString():"stroke"===name?($el.style["border-color"]=usedValue.toString(),$el.style["border-style"]="solid"):"lineWidth"===name?$el.style["border-width"]="".concat(usedValue||0,"px"):"lineDash"===name?$el.style["border-style"]="dashed":"innerHTML"===name?_this.createOrUpdateInnerHTML(document,$el,usedValue):"width"===name||"height"===name||"class"===name?$el.setAttribute(name,usedValue.toString()):"x"===name||"y"===name||(0,is_nil.A)(object.style[name])||""===object.style[name]||($el.style[name]=object.style[name]);else{if(!usedName||(nodeName===Shape.GROUP||object.isCustomElement)&&!enableCSSParsing&&(inherited||"fill"===usedName||"stroke"===usedName))return;"fill"===name||"stroke"===name?_this.defElementManager.createOrUpdateGradientAndPattern(object,$el,usedValue,usedName,_this):enableCSSParsing&&inherited?"unset"!==computedValueStr&&computedValueStr!==DEFAULT_VALUE_MAP[name]?null==$groupEl||$groupEl.setAttribute(usedName,formattedValueStr):null==$groupEl||$groupEl.removeAttribute(usedName):"clipPath"===name?_this.createOrUpdateClipOrTextPath(document,usedValue,object):"textPath"===name?_this.createOrUpdateClipOrTextPath(document,usedValue,object,!0):"shadowType"===name||"shadowColor"===name||"shadowBlur"===name||"shadowOffsetX"===name||"shadowOffsetY"===name?_this.defElementManager.createOrUpdateShadow(object,$el,name):"filter"===name?_this.defElementManager.createOrUpdateFilter(object,$el,usedValue):"anchor"===name?nodeName!==Shape.TEXT&&_this.updateAnchorWithTransform(object):(0,is_nil.A)(computedValue)||[$el,$hitTestingEl].forEach((function($el){$el&&usedName&&("unset"!==computedValueStr&&computedValueStr!==DEFAULT_VALUE_MAP[name]?$el.setAttribute(usedName,formattedValueStr):$el.removeAttribute(usedName))}))}}))},SVGRendererPlugin.prototype.createSVGDom=function(document,object,root,noWrapWithGroup){var _a;void 0===noWrapWithGroup&&(noWrapWithGroup=!1),object.elementSVG=new ElementSVG;var svgElement=object.elementSVG,$el=this.context.SVGElementLifeCycleContribution.createElement(object,this.svgElementMap);if($el){var $groupEl=void 0;object.nodeName===Shape.HTML&&(object.parsedStyle.$el=$el),this.pluginOptions.outputSVGElementId&&($el.id=this.getId(object)),this.pluginOptions.outputSVGElementName&&object.name&&$el.setAttribute("name",object.name),!$el.hasAttribute("data-wrapgroup")&&"g"===$el.nodeName||noWrapWithGroup?$groupEl=$el:($groupEl=createSVGElement("g",document)).appendChild($el),svgElement.$el=$el,svgElement.$groupEl=$groupEl,this.applyAttributes(object),this.createOrUpdateHitArea(object,$el,$groupEl);var $parentGroupEl=root||object.parentNode&&(null===(_a=object.parentNode.elementSVG)||void 0===_a?void 0:_a.$groupEl);$parentGroupEl&&($parentGroupEl.appendChild($groupEl),this.pendingReorderQueue.add(object.parentNode))}},SVGRendererPlugin.prototype.removeSVGDom=function(object){var _a,$groupEl=null===(_a=object.elementSVG)||void 0===_a?void 0:_a.$groupEl;$groupEl&&$groupEl.parentNode&&($groupEl.parentNode.removeChild($groupEl),this.context.SVGElementLifeCycleContribution.destroyElement(object,$groupEl))},SVGRendererPlugin.prototype.createOrUpdateHitArea=function(object,$el,$groupEl){var svgElement=object.elementSVG,$hitTestingEl=svgElement.$hitTestingEl,increasedLineWidthForHitTesting=Number(object.parsedStyle.increasedLineWidthForHitTesting);if(increasedLineWidthForHitTesting){if(!$hitTestingEl){$hitTestingEl=$el.cloneNode(),["filter"].forEach((function(attribute){$hitTestingEl.removeAttribute(attribute)}));var hasFill="none"!==$el.getAttribute("fill");$hitTestingEl.setAttribute("fill",hasFill?"transparent":"none"),$hitTestingEl.setAttribute("stroke","transparent"),$groupEl.appendChild($hitTestingEl),svgElement.$hitTestingEl=$hitTestingEl,this.svgElementMap.set($hitTestingEl,object)}$hitTestingEl.setAttribute("stroke-width","".concat(increasedLineWidthForHitTesting+object.parsedStyle.lineWidth))}else $hitTestingEl&&($groupEl.removeChild($hitTestingEl),svgElement.$hitTestingEl=null)},SVGRendererPlugin.prototype.createOrUpdateInnerHTML=function(doc,$el,usedValue){var $div=(doc||document).createElement("div");"string"==typeof usedValue?$div.innerHTML=usedValue:$div.appendChild(usedValue),$el.innerHTML="",$el.appendChild($div)},SVGRendererPlugin.prototype.createOrUpdateClipOrTextPath=function(document,clipPath,object,isTextPath){void 0===isTextPath&&(isTextPath=!1);var $groupEl=object.elementSVG.$groupEl,attributeNameCamel=isTextPath?"g":"clipPath",attributeNameHyphen=isTextPath?"text-path":"clip-path";if(clipPath){var clipPathId=(isTextPath?"text-path-":"clip-path-")+clipPath.entity+"-"+object.entity,$def=this.defElementManager.getDefElement();if(!$def.querySelector("#".concat(clipPathId))){var $clipPath=void 0;if(isTextPath)this.createSVGDom(document,clipPath,null,!0),$clipPath=clipPath.elementSVG.$el;else{if(!clipPath.isConnected)$def.querySelector("#".concat(this.getId(clipPath)))||this.createSVGDom(document,clipPath,$def,!0);$clipPath=createSVGElement(attributeNameCamel,document);var $use=createSVGElement("use",document);$use.setAttribute("href","#".concat(clipPath.elementSVG.$el.id)),$clipPath.appendChild($use);var $useRefs=this.clipPathUseMap.get(clipPath);$useRefs||(this.clipPathUseMap.set(clipPath,[]),$useRefs=this.clipPathUseMap.get(clipPath)),$useRefs.push($use),this.applyTransform($use,clipPath.getWorldTransform());var parentInvert=invert(mat4_create(),object.getWorldTransform());this.applyTransform($clipPath,parentInvert)}this.pluginOptions.outputSVGElementId&&($clipPath.id=clipPathId),$def.appendChild($clipPath)}this.applyAttributes(clipPath),isTextPath||$groupEl.setAttribute(attributeNameHyphen,"url(#".concat(clipPathId,")"))}else isTextPath||$groupEl.removeAttribute(attributeNameHyphen)},SVGRendererPlugin.prototype.updateAnchorWithTransform=function(object){var _a,_b,bounds=object.getGeometryBounds(),width=bounds&&2*bounds.halfExtents[0]||0,height=bounds&&2*bounds.halfExtents[1]||0,anchor=(object.parsedStyle||{}).anchor;[null===(_a=object.elementSVG)||void 0===_a?void 0:_a.$el,null===(_b=object.elementSVG)||void 0===_b?void 0:_b.$hitTestingEl].forEach((function($el){if($el){var tx=-anchor[0]*width,ty=-anchor[1]*height;0===tx&&0===ty||$el.setAttribute("transform","translate(".concat(tx,",").concat(ty,")")),object.nodeName!==Shape.CIRCLE&&object.nodeName!==Shape.ELLIPSE||($el.setAttribute("cx","".concat(width/2)),$el.setAttribute("cy","".concat(height/2)))}}))},SVGRendererPlugin.tag="SVGRenderer",SVGRendererPlugin}(),BASELINE_MAP={top:"hanging",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",ideographic:"ideographic",hanging:"hanging"};var SHAPE2TAGS=((index_esm_a={})[Shape.RECT]="path",index_esm_a[Shape.CIRCLE]="circle",index_esm_a[Shape.ELLIPSE]="ellipse",index_esm_a[Shape.IMAGE]="image",index_esm_a[Shape.GROUP]="g",index_esm_a[Shape.LINE]="line",index_esm_a[Shape.POLYLINE]="polyline",index_esm_a[Shape.POLYGON]="polygon",index_esm_a[Shape.TEXT]="text",index_esm_a[Shape.PATH]="path",index_esm_a[Shape.HTML]="foreignObject",index_esm_a),SHAPE_UPDATE_DEPS=((_b={})[Shape.CIRCLE]=["r"],_b[Shape.ELLIPSE]=["rx","ry"],_b[Shape.RECT]=["width","height","radius"],_b[Shape.IMAGE]=["img","width","height"],_b[Shape.LINE]=["x1","y1","x2","y2","markerStart","markerEnd","markerStartOffset","markerEndOffset"],_b[Shape.POLYLINE]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],_b[Shape.POLYGON]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],_b[Shape.PATH]=["path","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],_b[Shape.TEXT]=["text","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","wordWrap","wordWrapWidth","maxLines","leading","textBaseline","textAlign","textTransform","textOverflow","textPath","textPathSide","textPathStartOffset","textDecorationLine","textDecorationColor","textDecorationStyle","dx","dy"],_b),DefaultElementLifeCycleContribution=function(){function DefaultElementLifeCycleContribution(context,runtime){this.context=context,this.runtime=runtime}return DefaultElementLifeCycleContribution.prototype.createElement=function(object,svgElementMap){var doc=this.context.config.document,$el=createSVGElement(SHAPE2TAGS[object.nodeName]||"g",doc||document);return svgElementMap.set($el,object),$el},DefaultElementLifeCycleContribution.prototype.destroyElement=function(object,$el){},DefaultElementLifeCycleContribution.prototype.shouldUpdateElementAttribute=function(object,attributeName){var nodeName=object.nodeName;return(SHAPE_UPDATE_DEPS[nodeName]||[]).indexOf(attributeName)>-1},DefaultElementLifeCycleContribution.prototype.updateElementAttribute=function(object){var $el=object.elementSVG.$el,nodeName=object.nodeName,parsedStyle=object.parsedStyle;switch(nodeName){case Shape.IMAGE:!function updateImageElementAttribute($el,parsedStyle){var _a=parsedStyle.img,img=void 0===_a?"":_a,width=parsedStyle.width,height=parsedStyle.height;if($el.setAttribute("x","0"),$el.setAttribute("y","0"),(0,is_string.A)(img))$el.setAttribute("href",img);else if(img instanceof Image)width||$el.setAttribute("width","".concat(img.width)),height||$el.setAttribute("height","".concat(img.height)),$el.setAttribute("href",img.src);else if(img instanceof HTMLElement&&(0,is_string.A)(img.nodeName)&&"CANVAS"===img.nodeName.toUpperCase())$el.setAttribute("href",img.toDataURL());else if(img instanceof ImageData){var canvas=document.createElement("canvas");canvas.setAttribute("width","".concat(img.width)),canvas.setAttribute("height","".concat(img.height));var context=canvas.getContext("2d");context&&(context.putImageData(img,0,0),width||$el.setAttribute("width","".concat(img.width)),height||$el.setAttribute("height","".concat(img.height)),$el.setAttribute("href",canvas.toDataURL()))}}($el,parsedStyle);break;case Shape.RECT:!function updateRectElementAttribute($el,parsedStyle){var radius=parsedStyle.radius,width=parsedStyle.width,height=parsedStyle.height;if(isFinite(width)&&isFinite(height)){var d="";if(radius&&radius.some((function(r){return 0!==r}))){var _a=(0,tslib_es6.zs)(radius.map((function(r){return lodash_clamp(r,0,Math.min(Math.abs(width)/2,Math.abs(height)/2))})),4),tlr=_a[0],trr=_a[1],brr=_a[2],blr=_a[3],signX=width>0?1:-1,signY=height>0?1:-1,sweepFlag=signX+signY!==0?1:0;d=[["M ".concat(signX*tlr,",0")],["l ".concat(width-signX*(tlr+trr),",0")],["a ".concat(trr,",").concat(trr,",0,0,").concat(sweepFlag,",").concat(signX*trr,",").concat(signY*trr)],["l 0,".concat(height-signY*(trr+brr))],["a ".concat(brr,",").concat(brr,",0,0,").concat(sweepFlag,",").concat(-signX*brr,",").concat(signY*brr)],["l ".concat(signX*(brr+blr)-width,",0")],["a ".concat(blr,",").concat(blr,",0,0,").concat(sweepFlag,",").concat(-signX*blr,",").concat(-signY*blr)],["l 0,".concat(signY*(blr+tlr)-height)],["a ".concat(tlr,",").concat(tlr,",0,0,").concat(sweepFlag,",").concat(signX*tlr,",").concat(-signY*tlr)],["z"]].join(" ")}else d="M 0,0 l ".concat(width,",0 l 0,").concat(height," l").concat(-width," 0 z");$el.setAttribute("d",d)}}($el,parsedStyle);break;case Shape.LINE:!function updateLineElementAttribute($el,parsedStyle){var x,y,x1=parsedStyle.x1,y1=parsedStyle.y1,x2=parsedStyle.x2,y2=parsedStyle.y2,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=x2-x1,y=y2-y1,rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=x1-x2,y=y1-y2,rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)),$el.setAttribute("x1","".concat(x1-defX+startOffsetX)),$el.setAttribute("y1","".concat(y1-defY+startOffsetY)),$el.setAttribute("x2","".concat(x2-defX+endOffsetX)),$el.setAttribute("y2","".concat(y2-defY+endOffsetY))}($el,parsedStyle);break;case Shape.POLYGON:case Shape.POLYLINE:!function updatePolylineElementAttribute($el,parsedStyle){var points=parsedStyle.points.points,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerStartOffset=parsedStyle.markerStartOffset,markerEnd=parsedStyle.markerEnd,markerEndOffset=parsedStyle.markerEndOffset,length=points.length;if(points&&length>=2){var startOffsetX_1=0,startOffsetY_1=0,endOffsetX_1=0,endOffsetY_1=0,rad=0,x=void 0,y=void 0;markerStart&&isDisplayObject(markerStart)&&markerStartOffset&&(x=points[1][0]-points[0][0],y=points[1][1]-points[0][1],rad=Math.atan2(y,x),startOffsetX_1=Math.cos(rad)*(markerStartOffset||0),startOffsetY_1=Math.sin(rad)*(markerStartOffset||0)),markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset&&(x=points[length-2][0]-points[length-1][0],y=points[length-2][1]-points[length-1][1],rad=Math.atan2(y,x),endOffsetX_1=Math.cos(rad)*(markerEndOffset||0),endOffsetY_1=Math.sin(rad)*(markerEndOffset||0)),$el.setAttribute("points",points.map((function(point,i){var offsetX=0,offsetY=0;return 0===i?(offsetX=startOffsetX_1,offsetY=startOffsetY_1):i===length-1&&(offsetX=endOffsetX_1,offsetY=endOffsetY_1),"".concat(point[0]-defX+offsetX,",").concat(point[1]-defY+offsetY)})).join(" "))}}($el,parsedStyle);break;case Shape.PATH:!function updatePathElementAttribute($el,parsedStyle){var x,y,path=parsedStyle.path,_a=parsedStyle.defX,defX=void 0===_a?0:_a,_b=parsedStyle.defY,defY=void 0===_b?0:_b,markerStart=parsedStyle.markerStart,markerEnd=parsedStyle.markerEnd,markerStartOffset=parsedStyle.markerStartOffset,markerEndOffset=parsedStyle.markerEndOffset,startOffsetX=0,startOffsetY=0,endOffsetX=0,endOffsetY=0,rad=0;if(markerStart&&isDisplayObject(markerStart)&&markerStartOffset){var _c=(0,tslib_es6.zs)(markerStart.parentNode.getStartTangent(),2),p1=_c[0],p2=_c[1];x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),startOffsetX=Math.cos(rad)*(markerStartOffset||0),startOffsetY=Math.sin(rad)*(markerStartOffset||0)}if(markerEnd&&isDisplayObject(markerEnd)&&markerEndOffset){var _d=(0,tslib_es6.zs)(markerEnd.parentNode.getEndTangent(),2);p1=_d[0],p2=_d[1],x=p1[0]-p2[0],y=p1[1]-p2[1],rad=Math.atan2(y,x),endOffsetX=Math.cos(rad)*(markerEndOffset||0),endOffsetY=Math.sin(rad)*(markerEndOffset||0)}$el.setAttribute("d",function translatePathToString(absolutePath,defX,defY,startOffsetX,startOffsetY,endOffsetX,endOffsetY){void 0===startOffsetX&&(startOffsetX=0),void 0===startOffsetY&&(startOffsetY=0),void 0===endOffsetX&&(endOffsetX=0),void 0===endOffsetY&&(endOffsetY=0);var newValue=absolutePath.map((function(params,i){var command=params[0],nextSegment=absolutePath[i+1],useStartOffset=0===i&&(0!==startOffsetX||0!==startOffsetY),useEndOffset=(i===absolutePath.length-1||nextSegment&&("M"===nextSegment[0]||"Z"===nextSegment[0]))&&0!==endOffsetX&&0!==endOffsetY;switch(command){case"M":return useStartOffset?"M ".concat(params[1]-defX+startOffsetX,",").concat(params[2]-defY+startOffsetY," L ").concat(params[1]-defX,",").concat(params[2]-defY):"M ".concat(params[1]-defX,",").concat(params[2]-defY);case"L":return"L ".concat(params[1]-defX+(useEndOffset?endOffsetX:0),",").concat(params[2]-defY+(useEndOffset?endOffsetY:0));case"Q":return"Q ".concat(params[1]-defX," ").concat(params[2]-defY,",").concat(params[3]-defX," ").concat(params[4]-defY)+(useEndOffset?" L ".concat(params[3]-defX+endOffsetX,",").concat(params[4]-defY+endOffsetY):"");case"C":return"C ".concat(params[1]-defX," ").concat(params[2]-defY,",").concat(params[3]-defX," ").concat(params[4]-defY,",").concat(params[5]-defX," ").concat(params[6]-defY)+(useEndOffset?" L ".concat(params[5]-defX+endOffsetX,",").concat(params[6]-defY+endOffsetY):"");case"A":return"A ".concat(params[1]," ").concat(params[2]," ").concat(params[3]," ").concat(params[4]," ").concat(params[5]," ").concat(params[6]-defX," ").concat(params[7]-defY)+(useEndOffset?" L ".concat(params[6]-defX+endOffsetX,",").concat(params[7]-defY+endOffsetY):"");case"Z":return"Z"}})).join(" ");return~newValue.indexOf("NaN")?"":newValue}(path.absolutePath,defX,defY,startOffsetX,startOffsetY,endOffsetX,endOffsetY))}($el,parsedStyle);break;case Shape.TEXT:!function updateTextElementAttribute($el,parsedStyle,text,runtime){var lineWidth=parsedStyle.lineWidth,dx=parsedStyle.dx,dy=parsedStyle.dy,textPath=parsedStyle.textPath,_a=parsedStyle.textPathSide,textPathSide=void 0===_a?"left":_a,_b=parsedStyle.textPathStartOffset,textPathStartOffset=void 0===_b?0:_b,_c=parsedStyle.textDecorationLine,textDecorationLine=void 0===_c?"":_c,_d=parsedStyle.textDecorationColor,textDecorationColor=void 0===_d?"":_d,_e=parsedStyle.textDecorationStyle,textDecorationStyle=void 0===_e?"":_e,metrics=parsedStyle.metrics,textBaseline=parsedStyle.textBaseline;runtime.enableCSSParsing||"alphabetic"!==textBaseline||(textBaseline="bottom"),$el.setAttribute("dominant-baseline",BASELINE_MAP[textBaseline]),$el.setAttribute("paint-order","stroke");var lines=metrics.lines,lineHeight=metrics.lineHeight,height=metrics.height,lineNum=lines.length,styleCSSText="";if(0===dx&&0===dy||(styleCSSText+="transform:translate(".concat(dx,"px, ").concat(dy,"px);")),textDecorationLine&&"none"!==textDecorationLine&&(styleCSSText+="text-decoration:".concat(textDecorationLine," ").concat(textDecorationStyle," ").concat(textDecorationColor,";")),styleCSSText&&$el.setAttribute("style",styleCSSText),1===lineNum){var textContent=convertHTML(lines[0]);if($el.setAttribute("dx","".concat(lineWidth/2)),"bottom"!==textBaseline&&"top"!==textBaseline||($el.setAttribute("dominant-baseline",BASELINE_MAP.middle),$el.setAttribute("dy","bottom"===textBaseline?"-".concat(height/2,"px"):"".concat(height/2,"px"))),textPath){$el.innerHTML="";var $textPath=createSVGElement("textPath",$el.ownerDocument);$textPath.setAttribute("href","#".concat("text-path-"+textPath.entity)),"left"!==textPathSide&&$textPath.setAttribute("side",textPathSide),0!==textPathStartOffset&&$textPath.setAttribute("startOffset","".concat(textPathStartOffset)),$textPath.innerHTML=textContent,$el.appendChild($textPath)}else $el.innerHTML=textContent}else $el.innerHTML=lines.map((function(line,i){var dy=0;return 0===i?"middle"===textBaseline?dy=lineHeight/2-height/2:"top"===textBaseline||"hanging"===textBaseline?dy=0:"bottom"!==textBaseline&&"alphabetic"!==textBaseline&&"ideographic"!==textBaseline||(dy=-lineHeight*(lineNum-1)):dy=lineHeight,'<tspan x="0" dx="'.concat(lineWidth/2,'" dy="').concat(dy,'">').concat(convertHTML(line),"</tspan>")})).join("")}($el,parsedStyle,0,this.runtime)}},DefaultElementLifeCycleContribution}(),g_plugin_svg_renderer_dist_index_esm_Plugin=function(_super){function Plugin(options){void 0===options&&(options={});var _this=_super.call(this)||this;return _this.options=options,_this.name="svg-renderer",_this}return(0,tslib_es6.C6)(Plugin,_super),Plugin.prototype.init=function(runtime){var _a=this.options,outputSVGElementId=_a.outputSVGElementId,outputSVGElementName=_a.outputSVGElementName,defElementManager=new DefElementManager(this.context),defaultElementLifeCycleContribution=new DefaultElementLifeCycleContribution(this.context,runtime);this.context.defaultElementLifeCycleContribution=defaultElementLifeCycleContribution,this.context.SVGElementLifeCycleContribution=defaultElementLifeCycleContribution;var SVGRendererPluginOptions={outputSVGElementId:!!(0,is_nil.A)(outputSVGElementId)||!!outputSVGElementId,outputSVGElementName:!!(0,is_nil.A)(outputSVGElementName)||!!outputSVGElementName};this.addRenderingPlugin(new SVGRendererPlugin(SVGRendererPluginOptions,defElementManager,this.context))},Plugin.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultElementLifeCycleContribution,delete this.context.SVGElementLifeCycleContribution},Plugin}(AbstractRendererPlugin),SVGContextService=function(){function SVGContextService(context){this.context=context,this.canvasConfig=context.config}return SVGContextService.prototype.init=function(){var _a=this.canvasConfig,container=_a.container,doc=_a.document,devicePixelRatio=_a.devicePixelRatio;if(this.$container=(0,is_string.A)(container)?(doc||document).getElementById(container):container,this.$container){this.$container.style.position||(this.$container.style.position="relative");var $namespace=createSVGElement("svg",doc);$namespace.setAttribute("width","".concat(this.canvasConfig.width)),$namespace.setAttribute("height","".concat(this.canvasConfig.height)),this.$container.appendChild($namespace),this.$namespace=$namespace}var dpr=devicePixelRatio||isBrowser&&window.devicePixelRatio||1;dpr=dpr>=1?Math.ceil(dpr):1,this.dpr=dpr},SVGContextService.prototype.getDomElement=function(){return this.$namespace},SVGContextService.prototype.getContext=function(){return this.$namespace},SVGContextService.prototype.getDPR=function(){return this.dpr},SVGContextService.prototype.getBoundingClientRect=function(){var _a;return null===(_a=this.$namespace)||void 0===_a?void 0:_a.getBoundingClientRect()},SVGContextService.prototype.destroy=function(){this.$container&&this.$namespace&&this.$namespace.parentNode&&this.$container.removeChild(this.$namespace)},SVGContextService.prototype.resize=function(width,height){this.$namespace&&(this.$namespace.setAttribute("width","".concat(width)),this.$namespace.setAttribute("height","".concat(height)))},SVGContextService.prototype.applyCursorStyle=function(cursor){this.$container&&(this.$container.style.cursor=cursor)},SVGContextService.prototype.generateCSSText=function(animationName,selector,keyframes,timing,prefixes){void 0===prefixes&&(prefixes={});var duration=timing.duration,easing=timing.easing,delay=timing.delay,direction=timing.direction,iterations=timing.iterations,fill=timing.fill;return"@keyframes ".concat(animationName,"{").concat(keyframes.map((function(keyframe){keyframe.offset,keyframe.composite;var computedOffset=keyframe.computedOffset;keyframe.easing;var rest=(0,tslib_es6.Tt)(keyframe,["offset","composite","computedOffset","easing"]),rules=Object.keys(rest).map((function(attributeName){return"".concat(attributeName,":").concat(prefixes[attributeName]||"").concat(rest[attributeName],";")})).join("");return"".concat(100*computedOffset,"%{").concat(rules,"}")})).join(""),"}")+"".concat(selector," {animation: ").concat(animationName," ").concat(duration,"ms ").concat(easing," ").concat(delay,"ms ").concat(iterations===1/0?"infinite":iterations," ").concat(direction," ").concat(fill,";}")},SVGContextService.prototype.toDataURL=function(options){return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var cloneNode,doc,animationCounter,$style,svgDocType,svgDoc,_this=this;return(0,tslib_es6.YH)(this,(function(_a){return cloneNode=this.$namespace.cloneNode(!0),doc=this.canvasConfig.document,animationCounter=0,$style=null,this.context.renderingContext.root.forEach((function(object){var animations=object.getAnimations();if(animations.length){$style||($style=(doc||document).createElement("style"),cloneNode.appendChild($style));var svgElement_1=object.elementSVG,selfSelector_1="#".concat(svgElement_1.$el.id),groupSelector_1="#".concat(svgElement_1.$groupEl.id),selfCssText_1="",groupCssText_1="";animations.forEach((function(animation){var keyframes=animation.effect.getKeyframes();if(keyframes.length){var selfAttributes_1=[],groupAttributes_1=[],_a=keyframes[0];_a.offset,_a.composite,_a.computedOffset,_a.easing,_a.transformOrigin;var rest=(0,tslib_es6.Tt)(_a,["offset","composite","computedOffset","easing","transformOrigin"]);if(Object.keys(rest).forEach((function(attributeName){var _a;"transform"===attributeName&&groupAttributes_1.push(attributeName),!!(null===(_a=propertyMetadataCache[attributeName])||void 0===_a?void 0:_a.inh)?groupAttributes_1.push(attributeName):"transform"!==attributeName&&selfAttributes_1.push(attributeName)})),groupAttributes_1.length){var keyframesWithGroup=keyframes.map((function(keyframe){var offset=keyframe.offset,composite=keyframe.composite,computedOffset=keyframe.computedOffset,easing=keyframe.easing;keyframe.transformOrigin;var rest=(0,tslib_es6.Tt)(keyframe,["offset","composite","computedOffset","easing","transformOrigin"]),ret={offset,composite,computedOffset,easing};return Object.keys(rest).forEach((function(attributeName){groupAttributes_1.includes(attributeName)&&(ret[attributeName]=keyframe[attributeName])})),ret}));groupCssText_1+=_this.generateCSSText("a".concat(animationCounter++),groupSelector_1,keyframesWithGroup,animation.effect.getComputedTiming(),{transform:svgElement_1.$groupEl.getAttribute("transform")})}if(selfAttributes_1.length){var keyframesWithSelf=keyframes.map((function(keyframe){var offset=keyframe.offset,composite=keyframe.composite,computedOffset=keyframe.computedOffset,easing=keyframe.easing;keyframe.transformOrigin;var rest=(0,tslib_es6.Tt)(keyframe,["offset","composite","computedOffset","easing","transformOrigin"]),ret={offset,composite,computedOffset,easing};return Object.keys(rest).forEach((function(attributeName){selfAttributes_1.includes(attributeName)&&(ret[attributeName]=keyframe[attributeName])})),ret}));selfCssText_1+=_this.generateCSSText("a".concat(animationCounter++),selfSelector_1,keyframesWithSelf,animation.effect.getComputedTiming())}}})),$style.textContent+=selfCssText_1+groupCssText_1}})),svgDocType=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(svgDoc=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",svgDocType)).replaceChild(cloneNode,svgDoc.documentElement),[2,"data:image/svg+xml;charset=utf8,".concat(encodeURIComponent((new XMLSerializer).serializeToString(svgDoc)))]}))}))},SVGContextService}(),index_esm_ContextRegisterPlugin=function(_super){function ContextRegisterPlugin(){var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arguments),!1))||this;return _this.name="svg-context-register",_this}return(0,tslib_es6.C6)(ContextRegisterPlugin,_super),ContextRegisterPlugin.prototype.init=function(){this.context.ContextService=SVGContextService},ContextRegisterPlugin.prototype.destroy=function(){delete this.context.ContextService},ContextRegisterPlugin}(AbstractRendererPlugin),index_esm_Renderer=function(_super){function Renderer(config){void 0===config&&(config={});var _this=_super.call(this,config)||this;return _this.registerPlugin(new index_esm_ContextRegisterPlugin),_this.registerPlugin(new g_plugin_svg_renderer_dist_index_esm_Plugin({outputSVGElementId:config.outputSVGElementId})),_this.registerPlugin(new g_plugin_dom_interaction_dist_index_esm_Plugin),_this.registerPlugin(new g_plugin_svg_picker_dist_index_esm_Plugin),_this}return(0,tslib_es6.C6)(Renderer,_super),Renderer}(AbstractRenderer),WebGLContextService=function(){function WebGLContextService(context){this.canvasConfig=context.config,this.deviceRendererPlugin=context.deviceRendererPlugin}return WebGLContextService.prototype.init=function(){var _a=this.canvasConfig,container=_a.container,canvas=_a.canvas;if(canvas)this.$canvas=canvas,container&&canvas.parentElement!==container&&container.appendChild(canvas),this.$container=canvas.parentElement,this.canvasConfig.container=this.$container;else if(container&&(this.$container=(0,is_string.A)(container)?document.getElementById(container):container,this.$container)){var $canvas=document.createElement("canvas");this.$container.appendChild($canvas),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=$canvas}this.resize(this.canvasConfig.width,this.canvasConfig.height)},WebGLContextService.prototype.getDomElement=function(){return this.$canvas},WebGLContextService.prototype.getContext=function(){return this.deviceRendererPlugin.getDevice().gl},WebGLContextService.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},WebGLContextService.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},WebGLContextService.prototype.resize=function(width,height){var dpr=this.canvasConfig.devicePixelRatio||isBrowser&&window.devicePixelRatio||1;if(dpr=dpr>=1?Math.ceil(dpr):1,this.dpr=dpr,this.$canvas){var dpr_1=this.getDPR();this.$canvas.width=dpr_1*width,this.$canvas.height=dpr_1*height,setDOMSize(this.$canvas,width,height)}},WebGLContextService.prototype.getDPR=function(){return this.dpr},WebGLContextService.prototype.applyCursorStyle=function(cursor){this.$container&&this.$container.style&&(this.$container.style.cursor=cursor)},WebGLContextService.prototype.toDataURL=function(options){return void 0===options&&(options={}),(0,tslib_es6.sH)(this,void 0,void 0,(function(){return(0,tslib_es6.YH)(this,(function(_a){return[2,this.deviceRendererPlugin.toDataURL(options)]}))}))},WebGLContextService}(),dist_index_esm_ContextRegisterPlugin=function(_super){function ContextRegisterPlugin(rendererPlugin,config){var _this=_super.call(this)||this;return _this.rendererPlugin=rendererPlugin,_this.config=config,_this.name="webgl-context-register",_this}return(0,tslib_es6.C6)(ContextRegisterPlugin,_super),ContextRegisterPlugin.prototype.init=function(){this.context.ContextService=WebGLContextService,this.context.deviceRendererPlugin=this.rendererPlugin;var config=this.config;this.context.deviceContribution=new WebGLDeviceContribution((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},(null==config?void 0:config.targets)?{targets:config.targets}:{targets:["webgl2","webgl1"]}),{onContextLost:null==config?void 0:config.onContextLost,onContextRestored:null==config?void 0:config.onContextRestored,onContextCreationError:null==config?void 0:config.onContextCreationError}))},ContextRegisterPlugin.prototype.destroy=function(){delete this.context.ContextService},ContextRegisterPlugin}(AbstractRendererPlugin),dist_index_esm_Renderer=function(_super){function Renderer(config){var _this=_super.call(this,config)||this,deviceRendererPlugin=new g_plugin_device_renderer_dist_index_esm_Plugin(config);return _this.registerPlugin(new dist_index_esm_ContextRegisterPlugin(deviceRendererPlugin,config)),_this.registerPlugin(new g_plugin_image_loader_dist_index_esm_Plugin),_this.registerPlugin(deviceRendererPlugin),_this.registerPlugin(new g_plugin_dom_interaction_dist_index_esm_Plugin),_this.registerPlugin(new g_plugin_html_renderer_dist_index_esm_Plugin),_this}return(0,tslib_es6.C6)(Renderer,_super),Renderer}(AbstractRenderer);const createCanvas=(rendererType,container,width,height,pixelRatio,canvasConfig={},unregisterPlugins=[])=>{let renderer;switch(rendererType.toLowerCase()){case"svg":renderer=new index_esm_Renderer;break;case"webgl-3d":case"webgl":renderer=new dist_index_esm_Renderer,renderer.registerPlugin(new g_plugin_3d_dist_index_esm_Plugin);break;default:renderer=new Renderer}return renderer.registerPlugin(new g_plugin_dragndrop_dist_index_esm_Plugin({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})),unregisterPlugins.length&&unregisterPlugins.forEach((name=>{const plugin=renderer.getPlugin(name);renderer.unregisterPlugin(plugin)})),new Canvas(Object.assign({container,width,height,devicePixelRatio:pixelRatio,renderer,supportsMutipleCanvasesInOneContainer:!0},canvasConfig))};function createDOM(str){const containerDOM=document.createElement("div");containerDOM.innerHTML=str;let dom=containerDOM.childNodes[0];return dom&&containerDOM.contains(dom)&&(dom=containerDOM.removeChild(dom)),dom}function modifyCSS(dom,css){if(dom)return Object.keys(css).forEach((key=>{dom.style[key]=css[key]})),dom}var hierarchy=__webpack_require__("./node_modules/@antv/hierarchy/build/hierarchy.js"),hierarchy_default=__webpack_require__.n(hierarchy),es=__webpack_require__("./node_modules/@antv/algorithm/es/index.js"),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const deconstructData=data=>{const{nodes:nodesAndCombos=[],edges=[]}=data,nodes=[],combos=[];return nodesAndCombos.forEach((item=>{item.data._isCombo?combos.push(item):nodes.push(item)})),{nodes,edges,combos}},graphCoreTreeDfs=(graphCore,nodes,fn,mode="TB",treeKey="combo",stopFns={})=>{if(!(null==nodes?void 0:nodes.length))return;const{stopBranchFn,stopAllFn}=stopFns;for(let i=0;i<nodes.length;i++){const node=nodes[i];if(graphCore.hasNode(node.id)&&!(null==stopBranchFn?void 0:stopBranchFn(node))){if(null==stopAllFn?void 0:stopAllFn(node))return;"TB"===mode&&fn(node),graphCoreTreeDfs(graphCore,graphCore.getChildren(node.id,treeKey),fn,mode,treeKey,stopFns),"TB"!==mode&&fn(node)}}},graphComboTreeDfs=(graph,nodes,fn,mode="TB")=>{(null==nodes?void 0:nodes.length)&&nodes.forEach((node=>{"TB"===mode&&fn(node),graphComboTreeDfs(graph,graph.getComboChildrenData(node.id),fn,mode),"TB"!==mode&&fn(node)}))},traverseAncestorsAndSucceeds=(graph,graphCore,nodes,fn,mode="TB")=>{(null==nodes?void 0:nodes.length)&&(graphComboTreeDfs(graph,nodes,fn,mode),traverseAncestors(graphCore,nodes,fn))},traverseGraphAncestors=(graph,nodes,fn)=>{(null==nodes?void 0:nodes.length)&&nodes.forEach((node=>{if(!node.data.parentId)return;let ancestor=graph.getComboData(node.data.parentId);for(;ancestor;){if(fn(ancestor))return;if(!ancestor.data.parentId)return;ancestor=graph.getComboData(ancestor.data.parentId)}}))},traverseAncestors=(graphCore,nodes,fn)=>{nodes.forEach((node=>{let ancestor=graphCore.getParent(node.id,"combo");for(;ancestor;){if(fn(ancestor))return;ancestor=graphCore.getParent(ancestor.id,"combo")}}))},isSucceed=(graph,testParent,testSucceed)=>{const succeedIds=[];return!graph.getNodeData(testParent)&&(graphComboTreeDfs(graph,[graph.getComboData(testParent)],(node=>{succeedIds.push(node.id)})),!!succeedIds.includes(testSucceed))},validateComboStructure=(graph,toBeSucceedId,toBeAncestorId)=>toBeAncestorId&&!graph.getComboData(toBeAncestorId)?(console.warn(`Setting parent combo failed. The parent combo with id ${toBeAncestorId} does not exist`),!1):toBeSucceedId===toBeAncestorId?(console.warn(`Setting parent combo failed. Cannot set combo/node with id ${toBeSucceedId} to be the child of itself.`),!1):!toBeAncestorId||!isSucceed(graph,toBeSucceedId,toBeAncestorId)||(console.warn(`Setting parent combo failed, since the parent combo with id ${toBeAncestorId} is a succeed of the combo with id ${toBeSucceedId}.`),!1),treeData2GraphData=treeData=>{const graphData={nodes:[],edges:[],combos:[]};return((0,is_array.A)(treeData)?treeData:[treeData]).forEach((tree=>{traverse(tree,(child=>{var _a,_b;const{id,children,data}=child,others=__rest(child,["id","children","data"]);graphData.nodes.push({id:child.id,data:Object.assign(Object.assign({childrenIds:(null===(_a=child.children)||void 0===_a?void 0:_a.map((c=>c.id)))||[]},others),data)}),null===(_b=child.children)||void 0===_b||_b.forEach((subChild=>{graphData.edges.push({id:`tree-edge-${child.id}-${subChild.id}`,source:child.id,target:subChild.id,data:{}})}))}))})),graphData},graphData2TreeData=(nodeMap,graphData,propRootIds=[])=>{var _a;const trees=[],graphDataWithoutCombos={nodes:null===(_a=graphData.nodes)||void 0===_a?void 0:_a.filter((node=>!node.data._isCombo)),edges:graphData.edges},connectedComponents=(0,es.hb)(graphDataWithoutCombos,!1),rootIds=[],componentsNodeIds=[];return connectedComponents.forEach(((com,i)=>{if(componentsNodeIds[i]=com.map((node=>node.id)),propRootIds.length){const root=componentsNodeIds[0].find((id=>propRootIds.includes(id)));rootIds.push(void 0!==root?root:com[0].id)}else rootIds.push(com[0].id)})),rootIds.forEach(((id,i)=>{nodeMap[id]={id,children:[]},trees.push(nodeMap[id]),(0,es.CK)(graphData,id,{enter:({previous,current})=>{previous&&current!==id&&componentsNodeIds[i].includes(current)&&(nodeMap[previous]=nodeMap[previous]||{id:previous,children:[]},nodeMap[current]={id:current,children:[]},nodeMap[previous].children.push(nodeMap[current]))}},!1)})),trees},traverse=(treeData,callback)=>{callback(treeData),treeData.children&&treeData.children.forEach((child=>{child&&traverse(child,callback)}))},AVAILABLE_DATA_LIFECYCLE=["read","changeData","updateData","addData","removeData"],dataLifecycleMap={replace:"read",mergeReplace:"changeData",union:"addData",remove:"removeData",update:"updateData",updatePosition:"updatePosition"},cloneJSON=obj=>obj?JSON.parse(JSON.stringify(obj)):obj,isTreeLayout=options=>{const{type}=options;return!!hierarchy_default()[type]},getLayoutBounds=graph=>{const min=[1/0,1/0],max=[-1/0,-1/0],borderIds={min:[],max:[]};return graph.getAllNodesData().forEach((model=>{const{x,y}=model.data;isNaN(x)||isNaN(y)||(min[0]>x&&(min[0]=x,borderIds.min[0]=model.id),min[1]>y&&(min[1]=y,borderIds.min[1]=model.id),max[0]<x&&(max[0]=x,borderIds.max[0]=model.id),max[1]<y&&(max[1]=y,borderIds.max[1]=model.id))})),borderIds.min.forEach(((id,i)=>{const{halfExtents:nodeHalfSize}=graph.getRenderBBox(id);min[i]-=nodeHalfSize[i]})),borderIds.max.forEach(((id,i)=>{const{halfExtents:nodeHalfSize}=graph.getRenderBBox(id);max[i]+=nodeHalfSize[i]})),{min,max,center:min.map(((val,i)=>(max[i]+val)/2)),halfExtents:min.map(((val,i)=>(max[i]-val)/2))}},RESERVED_SHAPE_IDS=["keyShape","labelShape","labelBackgroundShape","iconShape","haloShape","anchorShapes","badgeShapes","donutShapes"],DEFAULT_LABEL_BG_PADDING=[4,4,4,4],DEFAULT_SHAPE_STYLE={opacity:1,fillOpacity:1,shadowColor:void 0,shadowBlur:0,lineDash:void 0,zIndex:0},DEFAULT_TEXT_STYLE=Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{fontSize:12,fontFamily:"sans-serif",fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",lineWidth:0});function uniq(arr,cache){void 0===cache&&(cache=new Map);var r=[];if(Array.isArray(arr))for(var i=0,len=arr.length;i<len;i++){var item=arr[i];cache.has(item)||(r.push(item),cache.set(item,!0))}return r}const array_isArrayOverlap=(arr1,arr2)=>{if(!(null==arr1?void 0:arr1.length)||!(null==arr2?void 0:arr2.length))return!1;for(let i=0;i<arr1.length;i++)for(let j=0;j<arr2.length;j++)if(arr1[i]===arr2[j])return!0;return!1};function diffSet(a=[],b=[]){const valueMap={};return b.forEach((value=>{"object"==typeof value&&(valueMap[JSON.stringify(value)]=!0),valueMap[value]=!0})),a.filter((value=>!valueMap[value]))}function unionSet(a,b){const resultSet=new Set(a);return b.forEach((value=>{resultSet.add(value)})),Array.from(resultSet)}function intersectSet(a,b){const aSet=new Set(a),result=[];return b.forEach((value=>{aSet.has(value)&&result.push(value)})),result}function replaceElements(arr,target,replaceWith){for(let i=0;i<arr.length;i++)arr[i]===target&&(arr[i]=replaceWith);return arr}const uniqBy=(arr,key)=>Object.values(arr.reduce(((map,item)=>Object.assign(Object.assign({},map),{[`${item[key]}`]:item})),{}));var animate_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const getShapeAnimateBeginStyles=shape=>{if(!shape)return{};const shapeType=shape.nodeName,commonStyles={opacity:0,strokeOpacity:0,lineWidth:1,offsetDistance:0};return["line","polyline","path"].includes(shapeType)?Object.assign({lineDash:[0,"100%"]},commonStyles):"circle"===shapeType?Object.assign({r:0},commonStyles):"ellipse"===shapeType?Object.assign({rx:0,ry:0},commonStyles):"text"===shapeType?{fontSize:0,opacity:0,strokeOpacity:0,offsetDistance:0,fill:"#000"}:Object.assign({width:0,height:0},commonStyles)},GROUP_ANIMATE_STYLES=[{opacity:0,transform:"scale(0)"},{opacity:1,transform:"scale(1)"}],DEFAULT_ANIMATE_CFG={buildIn:{duration:500,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"},show:{duration:500,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"},update:{duration:500,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"},zoom:{duration:200,easing:"linear",iterations:1,delay:0,fill:"both"}},runAnimateOnShape=(shape,fields,targetStyle,beginStyle,animateConfig)=>{let animateArr,percentLineDash=!1;if((null==fields?void 0:fields.length)?(animateArr=[{},{}],fields.forEach((key=>{if(animateArr[0][key]=void 0===shape.style[key]?cloneJSON(beginStyle[key]):cloneJSON(shape.style[key]),void 0!==targetStyle[key])if(animateArr[1][key]=cloneJSON(targetStyle[key]),"lineDash"===key){const beginPercents=uniq(animateArr[0][key].filter((val=>(0,is_string.A)(val)&&val.includes("%")))),targetPercents=uniq(animateArr[1][key].filter((val=>(0,is_string.A)(val)&&val.includes("%"))));if(beginPercents.length||targetPercents.length){percentLineDash=cloneJSON(animateArr[0].lineDash);const totalLength=shape.getTotalLength();beginPercents.forEach(((percent,i)=>{replaceElements(animateArr[0][key],percent,Number(percent.replace("%",""))/100*totalLength)})),targetPercents.forEach(((percent,i)=>{replaceElements(animateArr[1][key],percent,Number(percent.replace("%",""))/100*totalLength)}))}}else"offsetDistance"===key&&(animateArr[1][key]=animateArr[1][key]||1)}))):animateArr=((style1,style2)=>{const diff=[{},{}];return Object.keys(style1).forEach((key=>{style2[key]!==style1[key]&&(diff[0][key]=style1[key],diff[1][key]=style2[key])})),diff})(shape.attributes,targetStyle),!checkFrames(animateArr,shape))return;if(!shape.isVisible())return void Object.keys(animateArr[1]).forEach((field=>shape.style[field]=animateArr[1][field]));-1!==animateConfig.iterations&&null!==animateConfig.iterations||(animateConfig.iterations=1/0);const animation=shape.animate(animateArr,animateConfig);return percentLineDash&&(animation.onfinish=()=>{shape.style.lineDash=percentLineDash}),animation},checkFrames=(frames,shape)=>JSON.stringify(frames[0])!==JSON.stringify(frames[1])&&(["x","y"].forEach((dim=>{if(!frames[0].hasOwnProperty(dim))return;let val;const formatted=[...frames];void 0===frames[0][dim]&&frames[0][dim]!==frames[1][dim]&&(val=frames[1][dim]),void 0===frames[1][dim]&&frames[0][dim]!==frames[1][dim]&&(val=frames[1][dim]),void 0!==val&&(shape.style[dim]=val,delete formatted[0][dim],delete formatted[1][dim])})),JSON.stringify(frames[0])!==JSON.stringify(frames[1])),animateShapes=(animates,mergedStyles,shapeMap,shapeIds=void 0,groups,timing="buildIn",changedStates=[],onAnimatesFrame=(()=>{}),onAnimatesEnd=(()=>{}))=>{if(!(null==animates?void 0:animates[timing]))return void onAnimatesEnd(!1);const timingAnimateGroups=((animates,segmentedTiming,changedStates)=>{const timingAnimateGroups={};return animates["stateUpdate"===segmentedTiming?"update":segmentedTiming].forEach((item=>{const{order=0,states}=item;(null==states?void 0:states.length)&&!array_isArrayOverlap(states,changedStates)||(timingAnimateGroups[order]=timingAnimateGroups[order]||[],timingAnimateGroups[order].push(item))})),timingAnimateGroups})(animates,"update"===timing&&(null==changedStates?void 0:changedStates.length)?"stateUpdate":timing,changedStates);let i=0;const groupKeys=Object.keys(timingAnimateGroups);if(!groupKeys.length)return;const animations=[];let canceled=!1;const onfinish=()=>{if(i>=groupKeys.length)return void(!canceled&&onAnimatesEnd(canceled));const groupAnimations=((shapeMap,shapeIds,groups,timingAnimates,targetStylesMap,timing,onfinish,cancelAnimations,canceled)=>{let maxDuration=-1/0,maxDurationIdx=-1,hasCanceled=canceled;const isOut="buildOut"===timing||"hide"===timing,shapeIdsToAnimate=shapeIds||Object.keys(shapeMap),animations=timingAnimates.map((animateOptions=>{var _a;const{fields,shapeId,order,states}=animateOptions,animateCfg=animate_rest(animateOptions,["fields","shapeId","order","states"]),animateConfig=Object.assign(Object.assign({},DEFAULT_ANIMATE_CFG[timing]),animateCfg),{iterations}=animateConfig;iterations===1/0&&null==animateCfg.fill&&(animateConfig.fill="auto");let animates=[];if(shapeId&&"group"!==shapeId){const shape=shapeMap[shapeId];if(shape&&"none"!==shape.style.display&&"hidden"!==shape.style.visibility){const targetStyle=targetStylesMap[shapeId]||(null===(_a=targetStylesMap.otherShapes)||void 0===_a?void 0:_a[shapeId])||{};hasCanceled?Object.keys(targetStyle).forEach((key=>{shape.style[key]=targetStyle[key]})):animates.push(runAnimateOnShape(shape,fields,targetStyle,getShapeAnimateBeginStyles(shape),animateConfig))}}else{const usingFields=[];let hasOpacity=!1;null==fields||fields.forEach((field=>{"size"===field?usingFields.push("transform"):"opacity"!==field?usingFields.push(field):hasOpacity=!0}));const targetStyle=targetStylesMap.group||GROUP_ANIMATE_STYLES[isOut?0:1];hasCanceled?Object.keys(targetStyle).forEach((key=>{groups.forEach((group=>group.style[key]=targetStyle[key]))})):(hasOpacity&&shapeIdsToAnimate.forEach((sid=>{var _a;if(!shapeMap[sid])return;const{opacity:targetOpacity=(isOut?0:1)}=targetStylesMap[sid]||(null===(_a=targetStylesMap.otherShapes)||void 0===_a?void 0:_a[sid])||{};animates.push(runAnimateOnShape(shapeMap[sid],["opacity"],{opacity:targetOpacity},getShapeAnimateBeginStyles(shapeMap[sid]),animateConfig))})),usingFields.length&&(animates=animates.concat(groups.map((group=>runAnimateOnShape(group,usingFields,targetStyle,GROUP_ANIMATE_STYLES[isOut?1:0],animateConfig))))))}return animates})).flat().filter(Boolean);if(animations.forEach(((animation,i)=>{const{duration}=animation.effect.timing;maxDuration<duration&&(maxDuration=duration,maxDurationIdx=i),animation&&(animation.onManualCancel=()=>{hasCanceled=!0,cancelAnimations()})})),maxDurationIdx>-1){const selfOnfinish=animations[maxDurationIdx].onfinish;animations[maxDurationIdx].onfinish=()=>{null==selfOnfinish||selfOnfinish(),null==onfinish||onfinish()}}return animations})(shapeMap,shapeIds,groups,timingAnimateGroups[groupKeys[i]],mergedStyles,timing,onfinish,(()=>{canceled=!0,onAnimatesEnd(canceled)}),canceled).filter(Boolean);groupAnimations.forEach((animation=>{animation.onframe=onAnimatesFrame,animations.push(animation)})),i++};return onfinish(),animations},stopAnimate=animation=>{const timing=animation.effect.getTiming();return animation.currentTime=Number(timing.duration)+Number(timing.delay||0),animation.finish(),animation.finished},isBetween=(value,min,max)=>value>=min&&value<=max,manhattanDist=(p1,p2)=>Math.abs(p1.x-p2.x)+Math.abs(p1.y-p2.y),ShapeTagMap={circle:Circle,rect:Rect,ellipse:Ellipse,polygon:Polygon,line:Line,polyline:Polyline,text:Text,image:index_esm_Image,path:Path,group:Group,html:HTML},LINE_TYPES=["line","polyline","path"],createShape=(type,style,id)=>{const shape=new(0,ShapeTagMap[type])({id,style});return void 0===style.draggable&&(shape.style.draggable=!0),void 0===style.droppable&&(shape.style.droppable=!0),LINE_TYPES.includes(type)&&(shape.style.increasedLineWidthForHitTesting=Math.max(shape.style.lineWidth,6)),shape},findAnimateFields=(animates,timing,shapeId,diffState)=>{var _a;if(!(null===(_a=null==animates?void 0:animates[timing])||void 0===_a?void 0:_a.length))return[];let animateFields=[];const{previous:previousState=[],current:currentState=[]}=diffState||{},states=previousState.concat(currentState);return animates[timing].forEach((({fields,shapeId:animateShapeId,states:animateStates=[]})=>{(array_isArrayOverlap(states.map((state=>state.name)),animateStates)||!states.length&&!animateStates.length)&&(animateShapeId===shapeId?animateFields=animateFields.concat(fields):animateShapeId&&"group"!==animateShapeId||!fields.includes("opacity")||animateFields.push("opacity"))})),animateFields.includes(void 0)?[]:animateFields},upsertShape=(type,id,style,config)=>{const{model,shapeMap,diffState}=config;let shape=shapeMap[id];const firstRendering=!shapeMap.keyShape,{animates,disableAnimate}=(null==model?void 0:model.data)||{};if(shape)if(shape.nodeName!==type)shape.remove(),shape=createShape(type,style,id);else{const updateStyles={},oldStyles=shape.attributes,animateFields=findAnimateFields(animates,"update",id,diffState);!disableAnimate&&(null==animates?void 0:animates.update)&&animateFields.length?Object.keys(style).forEach((key=>{oldStyles[key]!==style[key]&&(updateStyles[key]=style[key],animateFields.includes(key)||(shape.style[key]=style[key]))})):Object.keys(style).forEach((key=>{oldStyles[key]!==style[key]&&(updateStyles[key]=style[key],shape.style[key]=style[key])})),!1===style.interactive?shape.interactive=!1:shape.interactive=!0}else{if(!disableAnimate&&animates){const animateFields=findAnimateFields(animates,firstRendering?"buildIn":"update",id,diffState);shape=createShape(type,style,id);const initShapeStyles=getShapeAnimateBeginStyles(shape);animateFields.forEach((key=>{shape.style[key]=initShapeStyles[key]}))}else shape=createShape(type,style,id);!1===style.interactive&&(shape.interactive=!1)}return shapeMap[id]=shape,shape},updateShapes=(prevShapeMap,newShapeMap,group,labelGroup,removeDiff=!0,shouldUpdate=(()=>!0))=>{const totalMap=Object.assign(Object.assign({},prevShapeMap),newShapeMap),finalShapeMap=Object.assign({},prevShapeMap);return Object.keys(totalMap).forEach((id=>{const prevShape=prevShapeMap[id],newShape=newShapeMap[id];if(!newShape||shouldUpdate(id)){if(newShape){prevShape&&prevShape!==newShape&&prevShape.remove(),finalShapeMap[id]=newShape;const parentGroup=newShape.attributes.dataIsLabel||newShape.attributes.dataIsLabelBackground?labelGroup:group;newShape.parentElement===parentGroup||newShape.destroyed||"none"===newShape.style.display||(parentGroup.appendChild(newShape),"auto"===newShape.style.lod&&(newShape.style.visibility="hidden","labelShape"===newShape.id&&parentGroup===labelGroup&&(labelGroup.attributes.visibility="hidden")))}prevShape&&!newShape&&removeDiff&&(delete finalShapeMap[id],prevShape.remove())}})),finalShapeMap},formatPadding=(value,defaultArr=DEFAULT_LABEL_BG_PADDING)=>{if((0,is_array.A)(value))switch(value.length){case 0:return defaultArr;case 1:return[value[0],value[0],value[0],value[0]];case 2:return[value[0],value[1],value[0],value[1]];case 3:return[value[0],value[1],value[2],value[1]];default:return[value[0],value[1],value[2],value[3]||value[4]]}return(0,is_number.A)(value)?[value,value,value,value]:defaultArr},mergeStyles=styleMaps=>{let currentResult=cloneJSON(styleMaps[0]);return styleMaps.forEach(((styleMap,i)=>{i>0&&(currentResult=merge2Styles(currentResult,styleMap))})),currentResult},merge2Styles=(styleMap1,styleMap2)=>{if(!styleMap1)return Object.assign({},styleMap2);if(!styleMap2)return Object.assign({},styleMap1);const mergedStyle=styleMap1;return Object.keys(styleMap2).forEach((shapeId=>{const style=styleMap2[shapeId];style&&(mergedStyle[shapeId]=Object.assign(Object.assign({},mergedStyle[shapeId]),style))})),mergedStyle},isPolygonsIntersect=(points1,points2)=>{const getBBox=points=>{const xArr=points.map((p=>p[0])),yArr=points.map((p=>p[1]));return{min:[Math.min.apply(null,xArr),Math.min.apply(null,yArr),0],max:[Math.max.apply(null,xArr),Math.max.apply(null,yArr),0]}},parseToLines=points=>{const lines=[],count=points.length;for(let i=0;i<count-1;i++){const point=points[i],next=points[i+1];lines.push({from:{x:point[0],y:point[1]},to:{x:next[0],y:next[1]}})}if(lines.length>1){const first=points[0],last=points[count-1];lines.push({from:{x:last[0],y:last[1]},to:{x:first[0],y:first[1]}})}return lines};if(points1.length<2||points2.length<2)return!1;const bbox1=getBBox(points1),bbox2=getBBox(points2);if(!intersectBBox(bbox1,bbox2))return!1;let isIn=!1;if(points2.forEach((point=>{if(isPointInPolygon(points1,point[0],point[1]))return isIn=!0,!1})),isIn)return!0;if(points1.forEach((point=>{if(isPointInPolygon(points2,point[0],point[1]))return isIn=!0,!1})),isIn)return!0;const lines1=parseToLines(points1),lines2=parseToLines(points2);let isIntersect=!1;return lines2.forEach((line=>{if(lineIntersectPolygon(lines1,line))return isIntersect=!0,!1})),isIntersect},intersectBBox=(box1,box2)=>!(!(null==box2?void 0:box2.min)||!(null==box1?void 0:box1.min))&&(box2.min[0]<=box1.max[0]&&box2.max[0]>=box1.min[0]&&box2.min[1]<=box1.max[1]&&box2.max[1]>=box1.min[1]),isPointInPolygon=(points,x,y)=>{let isHit=!1;const n=points.length;function dcmp(xValue){return Math.abs(xValue)<1e-6?0:xValue<0?-1:1}if(n<=2)return!1;for(let i=0;i<n;i++){const p1=points[i],p2=points[(i+1)%n];if(shape_onSegment(p1,p2,[x,y]))return!0;dcmp(p1[1]-y)>0!=dcmp(p2[1]-y)>0&&dcmp(x-(y-p1[1])*(p1[0]-p2[0])/(p1[1]-p2[1])-p1[0])<0&&(isHit=!isHit)}return isHit},shape_onSegment=(p1,p2,q)=>(q[0]-p1[0])*(p2[1]-p1[1])==(p2[0]-p1[0])*(q[1]-p1[1])&&Math.min(p1[0],p2[0])<=q[0]&&q[0]<=Math.max(p1[0],p2[0])&&Math.min(p1[1],p2[1])<=q[1]&&q[1]<=Math.max(p1[1],p2[1]),lineIntersectPolygon=(lines,line)=>{let isIntersect=!1;return lines.forEach((l=>{if(getLineIntersect(l.from,l.to,line.from,line.to))return isIntersect=!0,!1})),isIntersect},getLineIntersect=(p0,p1,p2,p3)=>{const E_x=p2.x-p0.x,E_y=p2.y-p0.y,D0_x=p1.x-p0.x,D0_y=p1.y-p0.y,D1_x=p3.x-p2.x,D1_y=p3.y-p2.y,kross=D0_x*D1_y-D0_y*D1_x,invertKross=1/kross;if(kross*kross>1e-4*(D0_x*D0_x+D0_y*D0_y)*(D1_x*D1_x+D1_y*D1_y)){const s=(E_x*D1_y-E_y*D1_x)*invertKross,t=(E_x*D0_y-E_y*D0_x)*invertKross;return isBetween(s,0,1)&&isBetween(t,0,1)?{x:p0.x+s*D0_x,y:p0.y+s*D0_y}:null}return null},getShapeLocalBoundsByStyle=(shape,style,bbox)=>{const{r,rx,ry,width,height,depth=0,x1,x2,y1,y2,z1=0,z2=0}=style,radius=Number(r),radiusX=Number(rx),radiusY=Number(ry);switch(shape.nodeName){case"circle":return{min:[-radius,-radius,0],max:[radius,radius,0],center:[0,0,0],halfExtents:[radius,radius,0]};case"sphere":return{min:[-radius,-radius,-radius],max:[radius,radius,radius],center:[0,0,0],halfExtents:[radius,radius,radius]};case"image":case"rect":case"cube":case"plane":return{min:[-width/2,-height/2,-depth/2],max:[width/2,height/2,depth/2],center:[0,0,0],halfExtents:[width/2,height/2,depth/2]};case"ellipse":return{min:[-radiusX,-radiusY,0],max:[radiusX,radiusY,0],center:[0,0,0],halfExtents:[radiusX,radiusY,0]};case"line":return{min:[x1,y1,z1],max:[x2,y2,z2],center:[(x1+x2)/2,(y1+y2)/2,(z1+z2)/2],halfExtents:[(x2-x1)/2,(y2-y1)/2,(z2-z1)/2]};case"text":case"polyline":case"path":case"polygon":return bbox||shape.getLocalBounds()}},getBBoxWidth=bbox=>bbox.max[0]-bbox.min[0],getBBoxHeight=bbox=>bbox.max[1]-bbox.min[1],getBBoxFromPoint=point=>{const{x,y}=point,bbox=new AABB;return bbox.setMinMax([x,y,0],[x,y,0]),bbox},getExpandedBBox=(bbox,offset)=>{const{max:[maxX,maxY],min:[minX,minY]}=bbox,expandBBox=new AABB;return(getBBoxWidth(bbox)||getBBoxHeight(bbox))&&expandBBox.setMinMax([minX-offset,minY-offset,0],[maxX+offset,maxY+offset,0]),expandBBox},mergeBBox=(b1,b2)=>{const minX=Math.min(b1.min[0],b2.min[0]),minY=Math.min(b1.min[1],b2.min[1]),maxX=Math.max(b1.max[0],b2.max[0]),maxY=Math.max(b1.max[1],b2.max[1]),bbox=new AABB;return bbox.setMinMax([minX,minY,0],[maxX,maxY,0]),bbox},getBBoxPoints=bbox=>[{x:bbox.min[0],y:bbox.min[1]},{x:bbox.max[0],y:bbox.min[1]},{x:bbox.max[0],y:bbox.max[1]},{x:bbox.min[0],y:bbox.max[1]}],isPointOutsideBBox=(point,bbox)=>{const{x,y}=point;return x<bbox.min[0]||x>bbox.max[0]||y<bbox.min[1]||y>bbox.max[1]},getExpandedBBoxPoint=(bbox,point,anotherPoint)=>{const isHorizontal=((point,bbox)=>{const dx=Math.abs(point.x-bbox.center[0]),dy=Math.abs(point.y-bbox.center[1]);return 0===dx&&0===dy?0:dx/getBBoxWidth(bbox)>dy/getBBoxHeight(bbox)})(point,bbox);if(0===isHorizontal){let x=bbox.center[0],y=bbox.center[1];return anotherPoint.y<point.y?y=bbox.min[1]:anotherPoint.x>point.x?x=bbox.max[0]:anotherPoint.x<point.x?x=bbox.min[0]:anotherPoint.x===point.x&&(y=bbox.max[1]),{x,y}}return isHorizontal?{x:point.x>bbox.center[0]?bbox.max[0]:bbox.min[0],y:point.y}:{x:point.x,y:point.y>bbox.center[1]?bbox.max[1]:bbox.min[1]}},isSegmentsIntersected=(p0,p1,p2,p3)=>{const v1x=p2.x-p0.x,v1y=p2.y-p0.y,v2x=p3.x-p0.x,v2y=p3.y-p0.y,v3x=p2.x-p1.x,v3y=p2.y-p1.y,v4x=p3.x-p1.x,v4y=p3.y-p1.y;return(v1x*v2y-v1y*v2x)*(v3x*v4y-v3y*v4x)<=0&&(v1x*v3y-v1y*v3x)*(v2x*v4y-v2y*v4x)<=0},isSegmentCrossingBBox=(p1,p2,bbox)=>{if(getBBoxWidth(bbox)||getBBoxHeight(bbox)){const[pa,pb,pc,pd]=getBBoxPoints(bbox);return isSegmentsIntersected(p1,p2,pa,pb)||isSegmentsIntersected(p1,p2,pa,pd)||isSegmentsIntersected(p1,p2,pb,pc)||isSegmentsIntersected(p1,p2,pc,pd)}return!1},isBBoxInBBox=(subBBox,bbox,scale)=>scale?subBBox.min[0]>bbox.min[0]-bbox.halfExtents[0]*scale&&subBBox.max[0]<bbox.max[0]+bbox.halfExtents[0]*scale&&subBBox.min[1]>bbox.min[1]-bbox.halfExtents[1]*scale&&subBBox.max[1]<bbox.max[1]+bbox.halfExtents[1]*scale:subBBox.min[0]>bbox.min[0]&&subBBox.max[0]<bbox.max[0]&&subBBox.min[1]>bbox.min[1]&&subBBox.max[1]<bbox.max[1],getCombinedCanvasesBounds=canvases=>{const combinedBounds={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0],center:[0,0,0],halfExtents:[0,0,0]};return canvases.forEach((canvas=>{const bounds=canvas.document.documentElement.getBounds();combinedBounds.min=combinedBounds.min.map(((val,i)=>Math.min(val||1/0,bounds.min[i]))),combinedBounds.max=combinedBounds.max.map(((val,i)=>Math.max(val||-1/0,bounds.max[i])))})),combinedBounds.center=combinedBounds.center.map(((_,i)=>(combinedBounds.max[i]+combinedBounds.min[i])/2)),combinedBounds.halfExtents=combinedBounds.halfExtents.map(((_,i)=>(combinedBounds.max[i]-combinedBounds.min[i])/2)),combinedBounds};var graph=__webpack_require__("./node_modules/@antv/graphlib/esm/graph.js"),circular=__webpack_require__("./node_modules/@antv/layout/lib/circular.js"),grid=__webpack_require__("./node_modules/@antv/layout/lib/grid.js"),lib_random=__webpack_require__("./node_modules/@antv/layout/lib/random.js"),mds=__webpack_require__("./node_modules/@antv/layout/lib/mds.js"),concentric=__webpack_require__("./node_modules/@antv/layout/lib/concentric.js"),radial=__webpack_require__("./node_modules/@antv/layout/lib/radial/index.js"),fruchterman=__webpack_require__("./node_modules/@antv/layout/lib/fruchterman.js"),d3Force=__webpack_require__("./node_modules/@antv/layout/lib/d3Force/index.js"),force=__webpack_require__("./node_modules/@antv/layout/lib/force/index.js"),forceAtlas2=__webpack_require__("./node_modules/@antv/layout/lib/forceAtlas2/index.js"),dagre=__webpack_require__("./node_modules/@antv/layout/lib/dagre.js"),comboCombined=__webpack_require__("./node_modules/@antv/layout/lib/comboCombined.js");class Behavior{constructor(options){this.updateConfig=options=>{this.options=Object.assign(this.options,options)},this.options=options}destroy(){}}const is_plain_object=function(value){if(!is_object_like(value)||!(0,is_type.A)(value,"Object"))return!1;if(null===Object.getPrototypeOf(value))return!0;for(var proto=value;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(value)===proto};function hasOwn(object,property){if(Object.hasOwn)return Object.hasOwn(object,property);if(null==object)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(object),property)}function _deepMix(dist,src,level,maxLevel){for(var key in level=level||0,maxLevel=maxLevel||5,src)if(hasOwn(src,key)){var value=src[key];null!==value&&is_plain_object(value)?(is_plain_object(dist[key])||(dist[key]={}),level<maxLevel?_deepMix(dist[key],value,level+1,maxLevel):dist[key]=src[key]):(0,is_array.A)(value)?(dist[key]=[],dist[key]=dist[key].concat(value)):void 0!==value&&(dist[key]=value)}}const deep_mix=function(rst){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var i=0;i<args.length;i+=1)_deepMix(rst,args[i]);return rst};const lodash_each=function each_each(elements,func){if(elements)if((0,is_array.A)(elements))for(var i=0,len=elements.length;i<len&&!1!==func(elements[i],i);i++);else if((0,is_object.A)(elements))for(var k in elements)if(elements.hasOwnProperty(k)&&!1===func(elements[k],k))break};class plugin_Plugin{constructor(options){this.options=deep_mix(this.getDefaultCfgs(),options),this.events={},this.destroyed=!1}updateCfgs(options){this.options=deep_mix(this.options,options),this.init(this.graph)}getDefaultCfgs(){return{}}init(graph){this.graph=graph}getEvents(){return{}}destroy(){const{graph}=this,events=this.events;lodash_each(events,((v,k)=>{graph.off(k,v)})),this.events=null,this.options=null,this.destroyed=!0}}plugin_Plugin.required=!1;const MOUSE_TRIGGERS=["pointerenter","click"],compare=(prev,curr)=>{const inactive=prev.filter((v=>!curr.includes(v)));return{active:curr.filter((v=>!prev.includes(v))),inactive}},DEFAULT_OPTIONS={multiple:!0,shouldBegin:()=>!0,shouldUpdate:()=>!0,trigger:"click",activeState:"selected"};class ActivateRelations extends Behavior{constructor(options){super(Object.assign({},DEFAULT_OPTIONS,options)),this.getEvents=()=>{const{trigger}=this.options;return"pointerenter"===trigger?{"node:pointerenter":this.setAllItemStates,"combo:pointerenter":this.setAllItemStates,"node:pointerleave":this.clearActiveState,"combo:pointerleave":this.clearActiveState}:{"node:click":this.setAllItemStates,"combo:click":this.setAllItemStates,"canvas:click":this.clearActiveState}},options.trigger&&!MOUSE_TRIGGERS.includes(options.trigger)&&(console.warn(`G6: Invalid trigger option "${options.trigger}" for activate-relations behavior!`),this.options.trigger=DEFAULT_OPTIONS.trigger),this.prevEdgeIds=[],this.prevNodeIds=[]}setAllItemStates(e){const{itemId}=e,{graph}=this,{activeState:ACTIVE_STATE}=this.options;if(!graph||graph.destroyed)return;if(!this.options.shouldBegin(e))return;const ids=graph.getNeighborNodesData(itemId,"both").map((item=>item.id)),edgeIds=graph.getRelatedEdgesData(itemId,"both").map((item=>item.id)),nodeIds=[itemId,...ids],{active:activeNodeIds,inactive:inactiveNodeIds}=compare(this.prevNodeIds,nodeIds),{active:activeEdgeIds,inactive:inactiveEdgeIds}=compare(this.prevEdgeIds,edgeIds);graph.historyBatch((()=>{graph.setItemState(activeNodeIds,ACTIVE_STATE,!0),graph.setItemState(inactiveNodeIds,ACTIVE_STATE,!1),graph.setItemState(activeEdgeIds,ACTIVE_STATE,!0),graph.setItemState(inactiveEdgeIds,ACTIVE_STATE,!1)})),this.prevNodeIds=nodeIds,this.prevEdgeIds=edgeIds}clearActiveState(e){const{activeState:ACTIVE_STATE}=this.options;this.graph.historyBatch((()=>{this.graph.setItemState(this.prevNodeIds,ACTIVE_STATE,!1),this.graph.setItemState(this.prevEdgeIds,ACTIVE_STATE,!1)})),this.prevNodeIds=[],this.prevEdgeIds=[]}}var unique_id_map={};const unique_id=function(prefix){return unique_id_map[prefix=prefix||"g"]?unique_id_map[prefix]+=1:unique_id_map[prefix]=1,prefix+unique_id_map[prefix]},getEdgesBetween=(graph,ids)=>{const edgeIdSet=new Set;return ids.forEach((endId=>{graph.getRelatedEdgesData(endId).forEach((edge=>{const{source,target,id}=edge;graph.getItemVisible(id)&&ids.includes(source)&&ids.includes(target)&&edgeIdSet.add(id)}))})),Array.from(edgeIdSet)},upsertTransientItem=(item,nodeGroup,edgeGroup,comboGroup,nodeLabelGroup,edgeLabelGroup,transientItemMap,itemMap,graphCore,drawOptions={},upsertAncestors=!0)=>{let transientItem=transientItemMap.get(item.model.id);if(transientItem)return transientItem;const{shapeIds,drawSource=!0,drawTarget=!0,visible=!0}=drawOptions;if("node"===item.type)transientItem=item.clone(nodeGroup,nodeLabelGroup,shapeIds,!0);else if("edge"===item.type){let source,target;drawSource&&(source=upsertTransientItem(item.sourceItem,nodeGroup,edgeGroup,comboGroup,nodeLabelGroup,edgeLabelGroup,transientItemMap,itemMap,graphCore,drawOptions,!1)),drawTarget&&(target=upsertTransientItem(item.targetItem,nodeGroup,edgeGroup,comboGroup,nodeLabelGroup,edgeLabelGroup,transientItemMap,itemMap,graphCore,drawOptions,!1)),transientItem=item.clone(edgeGroup,edgeLabelGroup,source,target,shapeIds,!0,visible,transientItemMap)}else{const childItems=[];graphCore.getChildren(item.model.id,"combo").forEach((childModel=>{const childItem=itemMap.get(childModel.id);childItem&&childItems.push(upsertTransientItem(childItem,nodeGroup,edgeGroup,comboGroup,nodeLabelGroup,edgeLabelGroup,transientItemMap,itemMap,graphCore,drawOptions,!1))})),transientItem=item.clone(comboGroup,nodeLabelGroup,shapeIds,!0,(()=>(items=>{if(!items.length)return!1;const resBounds={center:[0,0,0],min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0],size:[0,0,0]};let validCounts=0;return items.forEach((item=>{const bounds=item.getBBox();if(bounds){validCounts++;const{min,max}=bounds;min.forEach(((val,i)=>{val<resBounds.min[i]&&(resBounds.min[i]=val)})),max.forEach(((val,i)=>{val>resBounds.max[i]&&(resBounds.max[i]=val)}))}})),!!validCounts&&(resBounds.size=resBounds.size.map(((val,i)=>resBounds.max[i]-resBounds.min[i])),resBounds.center=resBounds.center.map(((val,i)=>(resBounds.max[i]+resBounds.min[i])/2)),resBounds)})(childItems)),(()=>childItems)),transientItem.toBack()}if(transientItemMap.set(item.model.id,transientItem),transientItem.transient=!0,"edge"!==item.type&&upsertAncestors&&graphCore.hasTreeStructure("combo")){let currentAncestor=graphCore.getParent(item.model.id,"combo");for(;currentAncestor;){const ancestorItem=itemMap.get(currentAncestor.id);if(ancestorItem){upsertTransientItem(ancestorItem,nodeGroup,edgeGroup,comboGroup,nodeLabelGroup,edgeLabelGroup,transientItemMap,itemMap,graphCore,drawOptions).toBack()}currentAncestor=graphCore.getParent(currentAncestor.id,"combo")}}return(null==shapeIds?void 0:shapeIds.length)&&visible&&transientItem.childNodes.forEach((shape=>shape.show())),transientItem};function generateEdgeID(source,target){return[source,unique_id(),target].join("-")}const rect=(graph,points,itemTypes)=>{const[p1,p2]=points,left=Math.min(p1.x,p2.x),right=Math.max(p1.x,p2.x),top=Math.min(p1.y,p2.y),bottom=Math.max(p1.y,p2.y),selectedNodeIds=[],selectedComboIds=[];let selectedEdgeIds=[];return itemTypes.includes("node")&&graph.getAllNodesData().forEach((node=>{const{id}=node;graph.getItemVisible(id)&&isBBoxCenterInRect(graph,id,left,right,top,bottom)&&selectedNodeIds.push(id)})),itemTypes.includes("combo")&&graph.getAllCombosData().forEach((combo=>{const{id}=combo;graph.getItemVisible(id)&&isBBoxCenterInRect(graph,id,left,right,top,bottom)&&selectedComboIds.push(id)})),itemTypes.includes("edge")&&(selectedEdgeIds=getEdgesBetween(graph,selectedNodeIds.concat(selectedComboIds))),{nodes:selectedNodeIds,edges:selectedEdgeIds,combos:selectedComboIds}},isBBoxCenterInRect=(graph,id,left,right,top,bottom)=>{const bbox=graph.getRenderBBox(id);return!!bbox&&(bbox.center[0]>=left&&bbox.center[0]<=right&&bbox.center[1]>=top&&bbox.center[1]<=bottom)},ALLOWED_TRIGGERS=["drag","shift","ctrl","alt","meta"],brush_select_DEFAULT_OPTIONS={trigger:"shift",selectedState:"selected",itemTypes:["node","edge"],eventName:"",selectSetMode:"latest",brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},shouldBegin:()=>!0,shouldUpdate:()=>!0,onSelect:()=>{},onDeselect:()=>{}};class BrushSelect extends Behavior{constructor(options){super(Object.assign({},brush_select_DEFAULT_OPTIONS,options)),this.selectedIds={nodes:[],edges:[],combos:[]},this.getEvents=()=>({pointerdown:this.onMouseDown,pointermove:this.onMouseMove,pointerup:this.onMouseUp,"canvas:click":this.onCanvasClick}),options.trigger&&!ALLOWED_TRIGGERS.includes(options.trigger)&&(console.warn(`G6: Invalid trigger option "${options.trigger}" for brush-select behavior!`),this.options.trigger=brush_select_DEFAULT_OPTIONS.trigger)}isKeydown(event){const trigger=this.options.trigger;return{drag:!0,shift:event.shiftKey,ctrl:event.ctrlKey,alt:event.altKey,meta:event.metaKey}[trigger]}onCanvasClick(event){this.clearStates()}onMouseDown(event){if(!this.options.shouldBegin(event))return;const{itemId,itemType,canvas}=event;if(itemId&&"node"===itemType)return;this.beginPoint={x:canvas.x,y:canvas.y};const{brush}=this;brush||(this.brush=this.createBrush()),this.brush&&(this.brush.setAttribute("width",0),this.brush.setAttribute("height",0),this.brush.setAttribute("visibility","visible")),this.mousedown=!0}onMouseMove(event){this.mousedown&&this.isKeydown(event)&&(this.dragging=!0,this.brush=this.updateBrush(event))}onMouseUp(event){this.mousedown&&(this.removeBrush(),this.brush=void 0,this.isKeydown(event)&&(this.selectedIds=this.selectItems(event)),this.dragging=!1,this.mousedown=!1)}clearStates(clearIds=void 0,restIds=void 0){const{graph}=this,{selectedState,eventName,onDeselect}=this.options;let nodes=[],edges=[],combos=[];if(clearIds?(nodes=clearIds.nodes,edges=clearIds.edges,combos=clearIds.combos,this.selectedIds=restIds||{nodes:[],edges:[],combos:[]}):(nodes=graph.findIdByState("node",selectedState),edges=graph.findIdByState("edge",selectedState),combos=graph.findIdByState("combo",selectedState),this.selectedIds={nodes:[],edges:[],combos:[]}),nodes.concat(edges).concat(combos).forEach((id=>graph.setItemState(id,selectedState,!1))),nodes.length||edges.length||combos.length){const deselectIds={nodes,edges,combos};null==onDeselect||onDeselect(this.selectedIds,deselectIds),eventName&&graph.emit(eventName,{action:"deselect",selectedIds:this.selectedIds,deselectedIds:deselectIds})}}selectItems(event){var _a,_b,_c,_d,_e,_f,_g,_h;const{graph,options}=this,{selectedState,itemTypes,eventName,selectSetMode,shouldUpdate,onSelect}=options,selector=this.getSelector(),points=this.getPoints(event).filter(Boolean);if(points.length<2)return;let selectedIds=selector(graph,points,itemTypes.concat("node")),operateSetFunc=(a,b)=>b;const currentNotEmpty=(null===(_a=this.selectedIds)||void 0===_a?void 0:_a.nodes.length)||(null===(_b=this.selectedIds)||void 0===_b?void 0:_b.edges.length)||(null===(_c=this.selectedIds)||void 0===_c?void 0:_c.combos.length);switch(selectSetMode){case"diff":currentNotEmpty&&(operateSetFunc=diffSet);break;case"union":operateSetFunc=unionSet;break;case"intersect":currentNotEmpty&&(operateSetFunc=intersectSet)}selectedIds={nodes:operateSetFunc(null===(_d=this.selectedIds)||void 0===_d?void 0:_d.nodes,selectedIds.nodes).filter((id=>shouldUpdate("node",id,"select",this))),edges:[],combos:operateSetFunc(null===(_e=this.selectedIds)||void 0===_e?void 0:_e.combos,selectedIds.combos).filter((id=>shouldUpdate("combo",id,"select",this)))};const edgeSelectable=itemTypes.includes("edge");edgeSelectable&&(selectedIds.edges=getEdgesBetween(graph,selectedIds.nodes.concat(selectedIds.combos)).filter((id=>shouldUpdate("edge",id,"select",this))));const nodeSelectable=itemTypes.includes("node");nodeSelectable||(selectedIds.nodes=[]);const comboSelectable=itemTypes.includes("combo");if(comboSelectable||(selectedIds.combos=[]),selectedState){const diffToClear={nodes:nodeSelectable?diffSet(null===(_f=this.selectedIds)||void 0===_f?void 0:_f.nodes,selectedIds.nodes):[],edges:edgeSelectable?diffSet(null===(_g=this.selectedIds)||void 0===_g?void 0:_g.edges,selectedIds.edges):[],combos:comboSelectable?diffSet(null===(_h=this.selectedIds)||void 0===_h?void 0:_h.combos,selectedIds.combos):[]};(diffToClear.nodes.length||diffToClear.edges.length||diffToClear.combos.length)&&this.clearStates(diffToClear,selectedIds);const{nodes,edges,combos}=selectedIds;nodes.concat(edges).concat(combos).forEach((id=>graph.setItemState(id,selectedState,!0)))}this.selectedIds=selectedIds;return(selectedIds.nodes.length||selectedIds.edges.length||selectedIds.combos.length)&&(null==onSelect||onSelect(this.selectedIds)),eventName&&graph.emit(eventName,{action:"select",selectedIds:this.selectedIds}),this.selectedIds}createBrush(){const{graph,options}=this,{brushStyle}=options;return graph.drawTransient("rect","g6-brush-select-brush-shape",{style:Object.assign(Object.assign({},brushStyle),{pointerEvents:"none"})})}updateBrush(event){const{beginPoint,graph}=this,endPoint=event.canvas;return graph.drawTransient("rect","g6-brush-select-brush-shape",{style:{width:Math.abs(endPoint.x-beginPoint.x),height:Math.abs(endPoint.y-beginPoint.y),x:Math.min(endPoint.x,beginPoint.x),y:Math.min(endPoint.y,beginPoint.y)}})}removeBrush(){const{graph}=this;graph.drawTransient("rect","g6-brush-select-brush-shape",{action:"remove"})}getSelector(){return rect}getPoints(event){const{canvas:point}=event;return[this.beginPoint,point]}destroy(){this.removeBrush()}}const click_select_ALLOWED_TRIGGERS=["shift","ctrl","alt","meta"],click_select_DEFAULT_OPTIONS={multiple:!0,trigger:"shift",selectedState:"selected",itemTypes:["node","edge"],eventName:"",shouldBegin:()=>!0,shouldUpdate:()=>!0};class ClickSelect extends Behavior{constructor(options){super(Object.assign({},click_select_DEFAULT_OPTIONS,options)),this.selectedIds=[],this.canvasPointerDown=void 0,this.canvasPointerMove=!1,this.timeout=void 0,this.getEvents=()=>({"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClickBesideDblClick,"canvas:pointerdown":this.onCanvasPointerDown,"canvas:pointermove":this.onCanvasPointerMove,"canvas:pointerup":this.onCanvasPointerUp}),options.trigger&&!click_select_ALLOWED_TRIGGERS.includes(options.trigger)&&(console.warn(`G6: Invalid trigger option "${options.trigger}" for click-select behavior!`),this.options.trigger=click_select_DEFAULT_OPTIONS.trigger)}isMultipleSelect(event){if(!this.options.multiple)return!1;return{shift:event.shiftKey,ctrl:event.ctrlKey,alt:event.altKey,meta:event.metaKey}[this.options.trigger]}onClickBesideDblClick(event){if(this.timeout)return clearTimeout(this.timeout),void(this.timeout=void 0);this.timeout=setTimeout((()=>{this.timeout=void 0,this.onClick(event)}),200)}onClick(event){if(!this.options.shouldBegin(event))return;const itemType=event.itemType,itemId=event.itemId;if(!this.options.itemTypes.includes(itemType))return;const state=this.options.selectedState,multiple=this.isMultipleSelect(event),isSelectAction=!this.graph.findIdByState(itemType,state).includes(itemId),action=isSelectAction?"select":"unselect";if(this.options.shouldUpdate(event)&&(this.graph.historyBatch((()=>{multiple||(this.graph.setItemState(this.selectedIds,state,!1),this.selectedIds=[]),isSelectAction?this.selectedIds.includes(itemId)||this.graph.setItemState(itemId,state,!0):this.graph.setItemState(itemId,state,!1)})),isSelectAction?this.selectedIds.push(itemId):this.selectedIds=this.selectedIds.filter((id=>id!==itemId))),this.options.eventName){const selectedNodeIds=this.graph.findIdByState("node",state),selectedEdgeIds=this.graph.findIdByState("edge",state),selectedComboIds=this.graph.findIdByState("combo",state);this.graph.emit(this.options.eventName,{action,itemId,itemType,selectedNodeIds,selectedEdgeIds,selectedComboIds})}}onCanvasPointerDown(event){this.canvasPointerDown={x:event.canvas.x,y:event.canvas.y},this.canvasPointerMove=!1}onCanvasPointerMove(event){if(this.canvasPointerDown){const deltaX=Math.abs(this.canvasPointerDown.x-event.canvas.x),deltaY=Math.abs(this.canvasPointerDown.y-event.canvas.y);(deltaX>1||deltaY>1)&&(this.canvasPointerMove=!0)}}onCanvasPointerUp(event){this.canvasPointerDown&&!this.canvasPointerMove&&this.onCanvasClick(event),this.canvasPointerDown=void 0,this.canvasPointerMove=!1}onCanvasClick(event){if(!this.options.shouldBegin(event))return;const state=this.options.selectedState;this.selectedIds.length&&(this.options.shouldUpdate(event)&&this.graph.setItemState(this.selectedIds,state,!1),this.options.eventName&&this.graph.emit(this.options.eventName,{action:"unselect",itemId:"",itemType:"",selectedNodeIds:[],selectedEdgeIds:[],selectedComboIds:[]}))}}const collapse_expand_tree_ALLOWED_TRIGGERS=["click","dblclick"],collapse_expand_tree_DEFAULT_OPTIONS={trigger:"click",eventName:"",disableAnimate:!1,shouldBegin:()=>!0,shouldUpdate:()=>!0};class CollapseExpandTree extends Behavior{constructor(options){super(Object.assign({},collapse_expand_tree_DEFAULT_OPTIONS,options)),this.timeout=void 0,this.getEvents=()=>"dblclick"===this.options.trigger?{"node:dblclick":this.onClick}:{"node:click":this.onClickBesideDblClick},options.trigger&&!collapse_expand_tree_ALLOWED_TRIGGERS.includes(options.trigger)&&(console.warn(`G6: Invalid trigger option "${options.trigger}" for collapse-expand-tree behavior!`),this.options.trigger=collapse_expand_tree_DEFAULT_OPTIONS.trigger)}onClickBesideDblClick(event){if(this.timeout)return clearTimeout(this.timeout),void(this.timeout=void 0);this.timeout=setTimeout((()=>{this.timeout=void 0,this.onClick(event)}),200)}onClick(event){if(!this.options.shouldBegin(event))return;const{itemId,itemType}=event,{disableAnimate}=this.options,model=this.graph.getNodeData(itemId);if(!model)return void console.warn(`Node with id ${itemId} is not exist`);this.graph.frontItem(itemId);let action="expand";model.data.collapsed?this.graph.expand(itemId,disableAnimate):(this.graph.collapse(itemId,disableAnimate),action="collapse"),this.options.eventName&&this.graph.emit(this.options.eventName,{action,itemId,itemType})}}const collapse_expand_combo_DEFAULT_OPTIONS={trigger:"dblclick",shouldBegin:()=>!0};class CollapseExpandCombo extends Behavior{constructor(options){super(Object.assign({},collapse_expand_combo_DEFAULT_OPTIONS,options)),this.getEvents=()=>"dblclick"===this.options.trigger?{"combo:dblclick":this.collapseExpandCombo}:{"combo:click":this.collapseExpandCombo}}collapseExpandCombo(event){if(!this.options.shouldBegin(event))return;const{itemId}=event;this.graph.getComboData(itemId).data.collapsed?this.graph.expandCombo(itemId):this.graph.collapseCombo(itemId)}}const VALID_TRIGGERS=["drag","directionKeys"],drag_canvas_DEFAULT_OPTIONS={enableOptimize:!1,dragOnItems:!1,trigger:"drag",direction:"both",secondaryKey:"",secondaryKeyToDisable:"shift",speedUpKey:"",scalableRange:0,eventName:"",shouldBegin:()=>!0};class DragCanvas extends Behavior{constructor(options){const finalOptions=Object.assign({},drag_canvas_DEFAULT_OPTIONS,options);VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid, 'drag' will take effect.`),finalOptions.trigger="drag"),super(finalOptions)}getEvents(){return"undefined"!=typeof window&&(window.addEventListener("keydown",this.onKeydown.bind(this)),window.addEventListener("keyup",this.onKeyup.bind(this))),"directionKeys"===this.options.trigger?{keydown:this.onKeydown,keyup:this.onKeyup}:{pointerdown:this.onPointerDown,pointermove:this.onPointerMove,pointerup:this.onPointerUp,keydown:this.onKeydown,keyup:this.onKeyup}}onPointerDown(event){const{secondaryKey,secondaryKeyToDisable,dragOnItems,shouldBegin}=this.options;if(secondaryKeyToDisable&&this.disableKeydown)return;if(secondaryKey&&!this.keydown)return;if(!shouldBegin(event))return;if(event.itemId&&"CANVAS"!==event.itemId&&!dragOnItems)return;const{client}=event;this.pointerDownAt={x:client.x,y:client.y},document.addEventListener("mouseup",(evt=>{this.onPointerUp()}),{once:!0})}hideShapes(){const{graph}=this,{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},optimize=void 0!==this.options.enableOptimize?this.options.enableOptimize:graphBehaviorOptimize;if((0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize){this.hiddenEdgeIds=graph.getAllEdgesData().map((edge=>edge.id)).filter((id=>!0===graph.getItemVisible(id))),this.hiddenNodeIds=graph.getAllNodesData().map((node=>node.id)).filter((id=>!0===graph.getItemVisible(id)));const hiddenIds=[...this.hiddenNodeIds],sectionNum=Math.ceil(hiddenIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>hiddenIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{if(!sections.length&&this.tileRequestId)return cancelAnimationFrame(this.tileRequestId),void(this.tileRequestId=void 0);const section=sections.shift();graph.executeWithNoStack((()=>{graph.hideItem(section,{disableAnimate:!1,keepKeyShape:!0})})),this.tileRequestId=requestAnimationFrame(update)};this.tileRequestId=requestAnimationFrame(update)}}formatDisplacement(diffX,diffY){const{graph}=this,{scalableRange,direction}=this.options,[width,height]=graph.getSize(),graphBBox=graph.canvas.getRoot().getRenderBounds();let isPixel,rangeNum=Number(scalableRange);if("string"==typeof scalableRange&&(scalableRange.includes("px")&&(isPixel=scalableRange.includes("px"),rangeNum=Number(scalableRange.replace("px",""))),scalableRange.includes("%")&&(rangeNum=Number(scalableRange.replace("%",""))/100)),0===rangeNum)return{dx:diffX,dy:diffY};let expandWidth=rangeNum,expandHeight=rangeNum;isPixel||(expandWidth=width*rangeNum,expandHeight=height*rangeNum);const leftTopClient=graph.getViewportByCanvas({x:graphBBox.min[0],y:graphBBox.min[1]}),rightBottomClient=graph.getViewportByCanvas({x:graphBBox.max[0],y:graphBBox.max[1]});let dx=diffX,dy=diffY;return("y"===direction||diffX>0&&rightBottomClient.x+diffX>width+expandWidth||diffX<0&&leftTopClient.x+expandWidth+diffX<0)&&(dx=0),("x"===direction||diffY>0&&rightBottomClient.y+diffY>height+expandHeight||diffY<0&&leftTopClient.y+expandHeight+diffY<0)&&(dy=0),{dx,dy}}onPointerMove(event){if(!this.pointerDownAt)return;const{eventName,direction,secondaryKeyToDisable}=this.options;if(secondaryKeyToDisable&&this.disableKeydown)return;this.dragging||(this.hideShapes(),this.dragging=!0,this.graph.canvas.getConfig().disableHitTesting=!0);const{tileBehavior:graphBehaviorOptimize}=this.graph.getSpecification().optimize||{},shouldDebounce="boolean"==typeof graphBehaviorOptimize?graphBehaviorOptimize:this.graph.getAllNodesData().length>graphBehaviorOptimize,now=Date.now();if(shouldDebounce&&this.lastDragTriggerTime&&now-this.lastDragTriggerTime<50)return;const{graph}=this,{client}=event,diffX=client.x-this.pointerDownAt.x,diffY=client.y-this.pointerDownAt.y;if("x"===direction&&!diffX)return;if("y"===direction&&!diffY)return;if("both"===direction&&!diffX&&!diffY)return;const{dx,dy}=this.formatDisplacement(diffX,diffY);graph.translate({dx,dy}),this.pointerDownAt={x:client.x,y:client.y},eventName&&this.graph.emit(eventName,{translate:{dx,dy}}),this.lastDragTriggerTime=now}onPointerUp(){this.pointerDownAt=void 0,this.dragging=!1,this.graph.canvas.getConfig().disableHitTesting=!1;const{graph,hiddenNodeIds,hiddenEdgeIds=[]}=this,{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},optimize=void 0!==this.options.enableOptimize?this.options.enableOptimize:graphBehaviorOptimize;if(((0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize)&&(this.tileRequestId&&(cancelAnimationFrame(this.tileRequestId),this.tileRequestId=void 0),hiddenNodeIds)){const hiddenIds=[...hiddenNodeIds,...hiddenEdgeIds],sectionNum=Math.ceil(hiddenIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>hiddenIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{if(!sections.length&&this.tileRequestId)return cancelAnimationFrame(this.tileRequestId),void(this.tileRequestId=void 0);graph.startHistoryBatch(),graph.showItem(sections.shift(),{disableAnimate:!1}),graph.stopHistoryBatch(),this.tileRequestId=requestAnimationFrame(update)};this.tileRequestId=requestAnimationFrame(update)}}onKeydown(event){const{key}=event,{secondaryKey,secondaryKeyToDisable,trigger,speedUpKey,eventName,shouldBegin}=this.options;if(secondaryKey&&secondaryKey===key.toLowerCase()&&(this.keydown=!0),speedUpKey&&speedUpKey===key.toLowerCase()&&(this.speedupKeydown=!0),secondaryKeyToDisable&&secondaryKeyToDisable===key.toLowerCase()&&(this.disableKeydown=!0),"directionKeys"===trigger){if(secondaryKey&&!this.keydown)return;if(secondaryKeyToDisable&&this.disableKeydown)return;if(!shouldBegin(event))return;const{graph,speedupKeydown}=this,speed=speedupKeydown?20:1;let dx=0,dy=0;switch(key){case"ArrowLeft":dx=-speed;break;case"ArrowRight":dx=speed;break;case"ArrowUp":dy=-speed;break;case"ArrowDown":dy=speed}if(dx||dy){const{dx:formattedDx,dy:formattedDy}=this.formatDisplacement(dx,dy);graph.translate({dx:formattedDx,dy:formattedDy}),eventName&&this.graph.emit(eventName,{translate:{dx:formattedDx,dy:formattedDy}})}}}onKeyup(event){const{key}=event,{secondaryKey,secondaryKeyToDisable,speedUpKey}=this.options;secondaryKey&&secondaryKey===key.toLowerCase()&&(this.keydown=!1),speedUpKey&&speedUpKey===key.toLowerCase()&&(this.speedupKeydown=!1),secondaryKeyToDisable&&secondaryKeyToDisable===key.toLowerCase()&&(this.disableKeydown=!1)}destroy(){"undefined"!=typeof window&&(window.removeEventListener("keydown",this.onKeydown.bind(this)),window.removeEventListener("keyup",this.onKeyup.bind(this)))}}const throttle=function(func,wait,options){var timeout,context,args,result,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:Date.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)},throttled=function(){var now=Date.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result};return throttled.cancel=function(){clearTimeout(timeout),previous=0,timeout=context=args=null},throttled};const lodash_debounce=function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout((function(){timeout=null,immediate||func.apply(context,args)}),wait),callNow&&func.apply(context,args)}},getNearestPoint=(points,curPoint)=>{let index=0,nearestPoint=points[0],minDistance=point_distance(points[0],curPoint);for(let i=0;i<points.length;i++){const point=points[i],dis=point_distance(point,curPoint);dis<minDistance&&(nearestPoint=point,minDistance=dis,index=i)}return{index,nearestPoint}},distanceVec=(p1,p2)=>{const vx=p1[0]-p2[0],vy=p1[1]-p2[1];return Math.sqrt(vx*vx+vy*vy)},point_distance=(p1,p2)=>{const vx=p1.x-p2.x,vy=p1.y-p2.y,vz=p1.z-p2.z;return isNaN(vz)?Math.sqrt(vx*vx+vy*vy):Math.sqrt(vx*vx+vy*vy+vz*vz)},point_isSamePoint=(p1,p2)=>!(!p1||!p2)&&(p1.x===p2.x&&p1.y===p2.y&&p1.z===p2.z),getCircleIntersectByPoint=(circleProps,point)=>{const{x:cx,y:cy,r}=circleProps,{x,y}=point,dx=x-cx,dy=y-cy;if(dx*dx+dy*dy<r*r)return null;const angle=Math.atan(dy/dx);return{x:cx+Math.abs(r*Math.cos(angle))*Math.sign(dx),y:cy+Math.abs(r*Math.sin(angle))*Math.sign(dy)}},getRectIntersectByPoint=(rectProps,point)=>{const{x,y,width,height}=rectProps,points=[],center={x:x+width/2,y:y+height/2};points.push({x,y}),points.push({x:x+width,y}),points.push({x:x+width,y:y+height}),points.push({x,y:y+height}),points.push({x,y});let rst=null;for(let i=1;i<points.length&&(rst=point_getLineIntersect(points[i-1],points[i],center,point),!rst);i++);return rst},point_getLineIntersect=(p0,p1,p2,p3)=>{const E_x=p2.x-p0.x,E_y=p2.y-p0.y,D0_x=p1.x-p0.x,D0_y=p1.y-p0.y,D1_x=p3.x-p2.x,D1_y=p3.y-p2.y,kross=D0_x*D1_y-D0_y*D1_x,invertKross=1/kross;if(kross*kross>1e-4*(D0_x*D0_x+D0_y*D0_y)*(D1_x*D1_x+D1_y*D1_y)){const s=(E_x*D1_y-E_y*D1_x)*invertKross,t=(E_x*D0_y-E_y*D0_x)*invertKross;return isBetween(s,0,1)&&isBetween(t,0,1)?{x:p0.x+s*D0_x,y:p0.y+s*D0_y}:null}return null},simplifyPolylinePoints=points=>{const result=[],map={};return lodash_each(points,(p=>{p.id=`${p.x}|||${p.y}`,map[p.id]||(map[p.id]=p,result.push(p))})),result},simplePathFinder=(start,end,startNode,endNode,cfg)=>simplifyPolylinePoints(getPolylinePoints(start,end,cfg.offset,startNode,endNode)),heuristicCostEstimate=(p,ps,pt,source,target)=>manhattanDist(p,ps)+manhattanDist(p,pt)+((p,points)=>{let result=0;return points.forEach((point=>{point&&(p.x===point.x&&(result+=-2),p.y===point.y&&(result+=-2))})),result})(p,[ps,pt,source,target]),reconstructPath=(pathPoints,pointById,cameFrom,currentId,iterator=0)=>{pathPoints.unshift(pointById[currentId]),cameFrom[currentId]&&cameFrom[currentId]!==currentId&&iterator<=100&&reconstructPath(pathPoints,pointById,cameFrom,cameFrom[currentId],iterator+1)},getNeighborPoints=(points,point,bbox1,bbox2)=>{const neighbors=[];return points.forEach((p=>{if(p!==point&&(p.x===point.x||p.y===point.y)){if(isSegmentCrossingBBox(p,point,bbox1)||isSegmentCrossingBBox(p,point,bbox2))return;neighbors.push(p)}})),simplifyPolylinePoints(neighbors)},pointsToPolyline=(points,borderRadius,z)=>{const pathSegments=[],startPoint=points[0];return pathSegments.push(`M ${startPoint.x} ${startPoint.y}`),lodash_each(points,((p,i)=>{const p1=points[i+1],p2=points[i+2];if(p1&&p2)if(((p0,p1,p2)=>!(p0.x===p1.x&&p1.x===p2.x||p0.y===p1.y&&p1.y===p2.y))(p,p1,p2)&&borderRadius){const[ps,pt]=((p0,p1,p2,r)=>{const d0=manhattanDist(p0,p1),d1=manhattanDist(p2,p1),maxR=Math.min(d0,d1)/2;return r=Math.min(r,maxR),[{x:p1.x-r/d0*(p1.x-p0.x),y:p1.y-r/d0*(p1.y-p0.y)},{x:p1.x-r/d1*(p1.x-p2.x),y:p1.y-r/d1*(p1.y-p2.y)}]})(p,p1,p2,borderRadius);pathSegments.push(`L ${ps.x} ${ps.y}`),pathSegments.push(`Q ${p1.x} ${p1.y} ${pt.x} ${pt.y}`),pathSegments.push(`L ${pt.x} ${pt.y}`)}else pathSegments.push(`L ${p1.x} ${p1.y}`);else p1&&pathSegments.push(`L ${p1.x} ${p1.y}`)})),z&&pathSegments.push("Z"),pathSegments.join(" ")},getPolylinePath=(id,points,radius,z)=>{if(!points||points.length<2)return"M 0 0 L 0 0";const newPoints=removeRedundantPoint(points);return pointsToPolyline(newPoints,radius,z)},getPolylinePoints=(start,end,offset,sNode,tNode)=>{let sBBox,tBBox;sBBox=sNode&&sNode.getType()?null==sNode?void 0:sNode.getBBox():getBBoxFromPoint(start),tBBox=tNode&&tNode.getType()?null==tNode?void 0:tNode.getBBox():getBBoxFromPoint(end);const sxBBox=getExpandedBBox(sBBox,offset),txBBox=getExpandedBBox(tBBox,offset),sPoint=getExpandedBBoxPoint(sxBBox,start,end),tPoint=getExpandedBBoxPoint(txBBox,end,start),lineBBox=((points=[])=>{const xs=[],ys=[];points.forEach((p=>{xs.push(p.x),ys.push(p.y)}));const minX=Math.min(...xs),maxX=Math.max(...xs),minY=Math.min(...ys),maxY=Math.max(...ys),bbox=new AABB;return bbox.setMinMax([minX,minY,0],[maxX,maxY,0]),bbox})([sPoint,tPoint]),sMixBBox=mergeBBox(sxBBox,lineBBox),tMixBBox=mergeBBox(txBBox,lineBBox);let connectPoints=[];connectPoints=connectPoints.concat(getBBoxPoints(sMixBBox)).concat(getBBoxPoints(tMixBBox));const centerPoint={x:(start.x+end.x)/2,y:(start.y+end.y)/2};[lineBBox,sMixBBox,tMixBBox].forEach((bbox=>{connectPoints=connectPoints.concat(((bbox,point)=>((bbox,x)=>x<bbox.min[0]||x>bbox.max[0]?[]:[{x,y:bbox.min[1]},{x,y:bbox.max[1]}])(bbox,point.x).concat(((bbox,y)=>y<bbox.min[1]||y>bbox.max[1]?[]:[{x:bbox.min[0],y},{x:bbox.max[0],y}])(bbox,point.y)))(bbox,centerPoint).filter((p=>isPointOutsideBBox(p,sxBBox)&&isPointOutsideBBox(p,txBBox))))})),[{x:sPoint.x,y:tPoint.y},{x:tPoint.x,y:sPoint.y}].forEach((p=>{isPointOutsideBBox(p,sxBBox)&&isPointOutsideBBox(p,txBBox)&&connectPoints.push(p)})),connectPoints.unshift(sPoint),connectPoints.push(tPoint),connectPoints=simplifyPolylinePoints(connectPoints);const pathPoints=((points,start,goal,sBBox,tBBox,os,ot)=>{const closedSet=[],openSet={[start.id]:start},cameFrom={},gScore={},fScore={};gScore[start.id]=0,fScore[start.id]=heuristicCostEstimate(start,goal,start);const sortedOpenSet=new SortedArray;sortedOpenSet.add({id:start.id,value:fScore[start.id]});const pointById={};let current;for(points.forEach((p=>{pointById[p.id]=p}));Object.keys(openSet).length;){const minId=sortedOpenSet.minId(!1);if(!minId)break;if(current=openSet[minId],current.id===goal.id){const pathPoints=[];return reconstructPath(pathPoints,pointById,cameFrom,goal.id),pathPoints}delete openSet[current.id],sortedOpenSet.remove(current.id),closedSet.push(current),getNeighborPoints(points,current,sBBox,tBBox).forEach((neighbor=>{if(-1!==closedSet.indexOf(neighbor))return;const neighborId=neighbor.id;openSet[neighborId]||(openSet[neighborId]=neighbor);const tentativeGScore=fScore[current.id]+manhattanDist(current,neighbor);gScore[neighborId]&&tentativeGScore>=gScore[neighborId]||(cameFrom[neighborId]=current.id,gScore[neighborId]=tentativeGScore,fScore[neighborId]=gScore[neighborId]+heuristicCostEstimate(neighbor,goal,start,os,ot)),sortedOpenSet.add({id:neighborId,value:fScore[neighborId]})}))}return[start,goal]})(connectPoints,sPoint,tPoint,sBBox,tBBox,start,end);return simplifyPolylinePoints(pathPoints)},removeRedundantPoint=points=>{if(!(null==points?void 0:points.length))return points;const beginPoint=points[points.length-1],current={x:beginPoint.x,y:beginPoint.y};let continueSameX=[beginPoint],continueSameY=[beginPoint];for(let i=points.length-2;i>=0;i--){const point=points[i];if(point.x===current.x?continueSameX.push(point):(continueSameX=[point],current.x=point.x),point.y===current.y?continueSameY.push(point):(continueSameY=[point],current.y=point.y),continueSameX.length>2){const removeIdx=points.indexOf(continueSameX[1]);removeIdx>-1&&points.splice(removeIdx,1)}else if(continueSameY.length>2){const removeIdx=points.indexOf(continueSameY[1]);removeIdx>-1&&points.splice(removeIdx,1)}}return points};class SortedArray{constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}_innerAdd(item,length){const idxRange=[0,length-1];for(;idxRange[1]-idxRange[0]>1;){const midIdx=Math.floor((idxRange[0]+idxRange[1])/2);if(this.arr[midIdx].value>item.value)idxRange[1]=midIdx;else{if(!(this.arr[midIdx].value<item.value))return this.arr.splice(midIdx,0,item),void(this.map[item.id]=!0);idxRange[0]=midIdx}}this.arr.splice(idxRange[1],0,item),this.map[item.id]=!0}add(item){delete this.map[item.id];const length=this.arr.length;return length?this.arr[length-1].value<item.value?(this.arr.push(item),void(this.map[item.id]=!0)):void this._innerAdd(item,length):(this.arr.push(item),void(this.map[item.id]=!0))}remove(id){this.map[id]&&delete this.map[id]}_clearAndGetMinId(){let res;for(let i=this.arr.length-1;i>=0;i--)this.map[this.arr[i].id]?res=this.arr[i].id:this.arr.splice(i,1);return res}_findFirstId(){for(;this.arr.length;){const first=this.arr.shift();if(this.map[first.id])return first.id}}minId(clear){return clear?this._clearAndGetMinId():this._findFirstId()}}class QuadTree{constructor(boundary,capacity){this.boundary=boundary,this.edges=[],this.divided=!1,this.capacity=capacity}insert(edge){var _a,_b,_c,_d;return!!this.boundary.intersects(edge.bbox)&&(this.edges.length<this.capacity?(this.edges.push(edge),!0):(this.divided||this.subdivide(),(null===(_a=this.northeast)||void 0===_a?void 0:_a.insert(edge))||(null===(_b=this.northwest)||void 0===_b?void 0:_b.insert(edge))||(null===(_c=this.southeast)||void 0===_c?void 0:_c.insert(edge))||(null===(_d=this.southwest)||void 0===_d?void 0:_d.insert(edge))||!1))}subdivide(){const x=this.boundary.center[0],y=this.boundary.center[1],hw=this.boundary.halfExtents[0]/2,hh=this.boundary.halfExtents[1]/2,nwBoundary=new AABB;nwBoundary.setMinMax([x-2*hw,y-2*hh,0],[x,y,0]),this.northwest=new QuadTree(nwBoundary,this.capacity);const neBoundary=new AABB;neBoundary.setMinMax([x,y-2*hh,0],[x+2*hw,y,0]),this.northeast=new QuadTree(neBoundary,this.capacity);const swBoundary=new AABB;swBoundary.setMinMax([x-2*hw,y,0],[x,y+2*hh,0]),this.southwest=new QuadTree(swBoundary,this.capacity);const seBoundary=new AABB;seBoundary.setMinMax([x,y,0],[x+2*hw,y+2*hh,0]),this.southeast=new QuadTree(seBoundary,this.capacity),this.divided=!0}queryRange(range){var _a,_b,_c,_d;if(!range.intersects(this.boundary))return[];let found=this.edges.filter((edge=>edge.bbox.intersects(range)));return this.divided&&(found=found.concat((null===(_a=this.northeast)||void 0===_a?void 0:_a.queryRange(range))||[],(null===(_b=this.northwest)||void 0===_b?void 0:_b.queryRange(range))||[],(null===(_c=this.southeast)||void 0===_c?void 0:_c.queryRange(range))||[],(null===(_d=this.southwest)||void 0===_d?void 0:_d.queryRange(range))||[])),found}}class EdgeCollisionChecker{constructor(quadTree){this.quadTree=quadTree}getCollidingEdges(nodeBBox){return this.quadTree.queryRange(nodeBBox)}}const isPolylineWithObstacleAvoidance=(displayModel,polylineEdgeType=["polyline-edge"])=>{var _a;const{type,keyShape}=displayModel.data;if(!polylineEdgeType.includes(type))return!1;return null===(_a=null==keyShape?void 0:keyShape.routeCfg)||void 0===_a?void 0:_a.enableObstacleAvoidance},isPointPreventPolylineOverlap=displayModel=>{if(!displayModel)return!1;const{preventPolylineEdgeOverlap}=displayModel.data;return preventPolylineEdgeOverlap||!1};var __awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const drag_node_DEFAULT_OPTIONS={enableTransient:!0,enableDelegate:!1,delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},throttle:16,hideRelatedEdges:!1,selectedState:"selected",eventName:"",updateComboStructure:!0,shouldBegin:()=>!0};class DragNode extends Behavior{constructor(options){const finalOptions=Object.assign({},drag_node_DEFAULT_OPTIONS,options);finalOptions.enableDelegate&&(finalOptions.enableTransient=!1),(finalOptions.enableDelegate||finalOptions.enableTransient)&&(finalOptions.hideRelatedEdges=!1),super(finalOptions),this.hiddenEdges=[],this.hiddenRelatedNodes=[],this.selectedNodeIds=[],this.hiddenNearEdges=[],this.hiddenComboTreeItems=[],this.originPositions=[],this.pointerDown=void 0,this.dragging=!1,this.hiddenNearEdgesCache=[],this.hiddenShapeCache=new Map,this.getEvents=()=>{const events={"node:pointerdown":this.onPointerDown,pointermove:this.onPointerMove,click:this.onClick,"node:pointerup":this.onPointerUp,keydown:this.onKeydown};return this.options.updateComboStructure?Object.assign({"node:drop":this.onDropNode,"combo:drop":this.onDropCombo,"canvas:drop":this.onDropCanvas},events):Object.assign({pointerup:this.onClick},events)},this.throttledMoveNodes=(deltaX,deltaY,transient,upsertAncestors=!0)=>{}}getRelatedEdges(selectedNodeIds,relatedCombo){const relatedNodeComboIds=[];return graphComboTreeDfs(this.graph,relatedCombo,(item=>relatedNodeComboIds.push(item.id))),uniq(selectedNodeIds.concat(relatedNodeComboIds).flatMap((nodeId=>this.graph.getRelatedEdgesData(nodeId))))}getRelatedNodes(selectedNodeIds){let relatedNodes=[];return selectedNodeIds.forEach((id=>{const neighbors=this.graph.getNeighborNodesData(id,"both").filter((neighbor=>!selectedNodeIds.includes(neighbor.id)));relatedNodes=relatedNodes.concat(neighbors)})),relatedNodes}getNearEdgesForNodes(nodeIds,shouldBegin){return uniq(nodeIds.flatMap((nodeId=>this.graph.getNearEdgesData(nodeId,shouldBegin))))}getComboTreeItems(selectedNodeIds){const ancestors=[];return this.options.updateComboStructure?ancestors:(selectedNodeIds.forEach((id=>{const nodeData=this.graph.getNodeData(id);if(!nodeData.data.parentId)return;let ancestor,parentId=nodeData.data.parentId;for(;parentId;){const parentData=this.graph.getComboData(parentId);if(!parentData)break;ancestor=parentData,parentId=parentData.data.parentId,ancestors.push(ancestor)}})),uniq(ancestors).filter((item=>this.graph.getItemVisible(item.id))))}onPointerDown(event){this.options.shouldBegin(event)&&(this.pointerDown={x:event.canvas.x,y:event.canvas.y},this.dragging=!1,document.addEventListener("mouseup",(evt=>{this.onPointerUp(event)}),{once:!0}))}onPointerMove(event){if(!this.pointerDown)return;const beginDeltaX=Math.abs(this.pointerDown.x-event.canvas.x),beginDeltaY=Math.abs(this.pointerDown.y-event.canvas.y);if(beginDeltaX<1&&beginDeltaY<1)return;const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType;if(!this.dragging){this.dragging=!0;const currentNodeId=event.itemId;this.selectedNodeIds=this.graph.findIdByState("node",this.options.selectedState,!0),currentNodeId&&!this.selectedNodeIds.includes(currentNodeId)&&(this.selectedNodeIds=[currentNodeId]),this.originPositions=this.selectedNodeIds.map((id=>{if(!this.graph.getNodeData(id))return void console.warn("node does not exist",id);const{x,y}=this.graph.getNodeData(id).data;if(this.options.enableDelegate){const bbox=this.graph.getRenderBBox(id);if(bbox){const[minX,minY]=bbox.min,[maxX,maxY]=bbox.max;return{id,x,y,minX,minY,maxX,maxY}}}return{id,x,y}})).filter(Boolean),this.options.hideRelatedEdges&&!enableTransient&&(this.hiddenComboTreeItems=this.getComboTreeItems(this.selectedNodeIds),this.hiddenEdges=this.getRelatedEdges(this.selectedNodeIds,this.hiddenComboTreeItems),this.hiddenRelatedNodes=this.getRelatedNodes(this.selectedNodeIds),this.graph.executeWithNoStack((()=>{const hiddenEdgeIds=this.hiddenEdges.map((edge=>edge.id));hiddenEdgeIds.forEach((edgeId=>{this.hiddenShapeCache.set(edgeId,this.graph.getItemVisibleShapeIds(edgeId))})),this.graph.hideItem(hiddenEdgeIds,{disableAnimate:!0});const hiddenRelatedNodeIds=this.hiddenRelatedNodes.map((node=>node.id));hiddenRelatedNodeIds.forEach((nodeId=>{this.hiddenShapeCache.set(nodeId,this.graph.getItemVisibleShapeIds(nodeId))})),this.graph.hideItem(hiddenRelatedNodeIds,{disableAnimate:!0,keepRelated:!0});this.hiddenComboTreeItems.map((child=>child.id)).forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(this.hiddenComboTreeItems.map((child=>child.id)),{disableAnimate:!0})}))),enableTransient?(this.hiddenComboTreeItems=this.getComboTreeItems(this.selectedNodeIds),this.hiddenEdges=this.getRelatedEdges(this.selectedNodeIds,this.hiddenComboTreeItems),this.hiddenRelatedNodes=this.getRelatedNodes(this.selectedNodeIds),this.selectedNodeIds.forEach((nodeId=>{this.graph.drawTransient("node",nodeId,{upsertAncestors:!this.options.updateComboStructure})})),this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{})})),this.graph.executeWithNoStack((()=>{this.selectedNodeIds.forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(this.selectedNodeIds,{disableAnimate:!0});const hiddenEdgeIds=this.hiddenEdges.map((edge=>edge.id));hiddenEdgeIds.forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(hiddenEdgeIds,{disableAnimate:!0});const hiddenRelatedNodeIds=this.hiddenRelatedNodes.map((node=>node.id));hiddenRelatedNodeIds.forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(hiddenRelatedNodeIds,{disableAnimate:!0,keepRelated:!0});this.hiddenComboTreeItems.map((combo=>combo.id)).forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(this.hiddenComboTreeItems.map((combo=>combo.id)),{disableAnimate:!0})}))):this.graph.frontItem(this.selectedNodeIds),this.options.throttle>0?this.throttledMoveNodes=throttle(this.moveNodes,this.options.throttle,{leading:!0,trailing:!0}):this.throttledMoveNodes=this.moveNodes,this.originX=event.canvas.x,this.originY=event.canvas.y}if(this.dragging&&enableTransient){const preventPolylineOverlapNodeIds=this.selectedNodeIds.filter((nodeId=>{const innerModel=this.graph.getNodeData(nodeId);return isPointPreventPolylineOverlap(innerModel)}));if(preventPolylineOverlapNodeIds.length){const hiddenEdgesIds=this.hiddenEdges.map((edge=>edge.id));this.hiddenNearEdgesCache=this.hiddenNearEdges,this.hiddenNearEdges=this.getNearEdgesForNodes(preventPolylineOverlapNodeIds,(edge=>isPolylineWithObstacleAvoidance(edge))).filter((edge=>!hiddenEdgesIds.includes(edge.id)));const hiddenNearEdgesIds=this.hiddenNearEdges.map((edge=>edge.id));if(this.hiddenNearEdgesCache.forEach((edge=>{hiddenNearEdgesIds.includes(edge.id)||(this.graph.drawTransient("edge",edge.id,{action:"remove"}),this.graph.showItem(edge.id))})),this.hiddenNearEdges.length){this.hiddenNearEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{visible:!0})}));const hiddenNearEdgeIds=this.hiddenNearEdges.map((edge=>edge.id));hiddenNearEdgeIds.forEach((itemId=>{this.hiddenShapeCache.set(itemId,this.graph.getItemVisibleShapeIds(itemId))})),this.graph.hideItem(hiddenNearEdgeIds,{disableAnimate:!0})}}}if(!this.originPositions.length||!this.dragging)return;const pointerEvent=event,deltaX=pointerEvent.canvas.x-this.originX,deltaY=pointerEvent.canvas.y-this.originY;if(this.options.enableDelegate)this.moveDelegate(deltaX,deltaY);else{const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType;this.throttledMoveNodes(deltaX,deltaY,enableTransient,!this.options.updateComboStructure)}}moveNodes(deltaX,deltaY,transient,upsertAncestors=!0,callback){if(transient)this.originPositions.forEach((({id,x,y})=>{this.graph.drawTransient("node",id,{data:{x:x+deltaX,y:y+deltaY},upsertAncestors})})),this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{})}));else{const positionChanges=this.originPositions.map((({id,x,y})=>({id,data:{x:x+deltaX,y:y+deltaY}}))),positions=[...this.originPositions];this.graph.updateNodePosition(positionChanges,upsertAncestors,!0,(()=>null==callback?void 0:callback(positions)))}}moveDelegate(deltaX,deltaY){const x1=Math.min(...this.originPositions.map((position=>position.minX))),y1=Math.min(...this.originPositions.map((position=>position.minY))),x2=Math.max(...this.originPositions.map((position=>position.maxX))),y2=Math.max(...this.originPositions.map((position=>position.maxY)));this.graph.drawTransient("rect","g6-drag-node-delegate-shape",{style:Object.assign({x:x1+deltaX,y:y1+deltaY,width:x2-x1,height:y2-y1},this.options.delegateStyle)})}clearDelegate(){this.graph.drawTransient("rect","g6-drag-node-delegate-shape",{action:"remove"})}clearTransientItems(positions){this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("node",edge.source,{action:"remove"}),this.graph.drawTransient("node",edge.target,{action:"remove"}),this.graph.drawTransient("edge",edge.id,{action:"remove"})})),this.hiddenNearEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{action:"remove"})})),this.hiddenComboTreeItems.forEach((item=>{const isCombo=item.data._isCombo;this.graph.drawTransient(isCombo?"combo":"node",item.id,{action:"remove"})})),positions.forEach((({id})=>{this.graph.drawTransient("node",id,{action:"remove"})}))}restoreHiddenItems(positions){this.graph.pauseStack(),this.hiddenEdges.length&&(this.hiddenEdges.forEach((edge=>{this.graph.showItem(edge.id,{disableAnimate:!0,shapeIds:this.hiddenShapeCache.get(edge.id)}),this.hiddenShapeCache.delete(edge.id)})),this.hiddenEdges=[]),this.hiddenRelatedNodes.length&&(this.hiddenRelatedNodes.forEach((node=>{this.graph.showItem(node.id,{disableAnimate:!0,shapeIds:this.hiddenShapeCache.get(node.id)}),this.hiddenShapeCache.delete(node.id)})),this.hiddenRelatedNodes=[]),this.hiddenNearEdges.length&&(this.hiddenNearEdges.forEach((edge=>{this.graph.showItem(edge.id,{disableAnimate:!0}),this.hiddenShapeCache.delete(edge.id)})),this.hiddenNearEdges=[]),this.hiddenComboTreeItems.length&&(this.hiddenComboTreeItems.forEach((edge=>{this.graph.showItem(edge.id,{disableAnimate:!0,shapeIds:this.hiddenShapeCache.get(edge.id)}),this.hiddenShapeCache.delete(edge.id)})),this.hiddenComboTreeItems=[]);this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType&&this.originPositions.concat(positions).forEach((pos=>{this.graph.showItem(pos.id,{disableAnimate:!0,shapeIds:this.hiddenShapeCache.get(pos.id)}),this.hiddenShapeCache.delete(pos.id)})),this.graph.resumeStack()}clearState(){this.originPositions=[]}onClick(event){this.onPointerUp(event),this.clearState()}onPointerUp(event){this.pointerDown=void 0,this.dragging=!1,this.selectedNodeIds=[];const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType,pointerEvent=event,deltaX=pointerEvent.canvas.x-this.originX+.01,deltaY=pointerEvent.canvas.y-this.originY+.01;this.moveNodes(deltaX,deltaY,!1,!0,lodash_debounce((positions=>{enableTransient&&this.clearTransientItems(positions),this.options.enableDelegate&&this.clearDelegate(),this.restoreHiddenItems(positions),this.options.eventName&&this.graph.emit(this.options.eventName,{itemIds:positions.map((position=>position.id))}),this.clearState()})))}onKeydown(event){if("Escape"!==event.key&&"Esc"!==event.key)return;this.clearDelegate(),this.clearTransientItems(this.originPositions),this.restoreHiddenItems();if(!(this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType)&&!this.options.enableDelegate){const positionChanges=this.originPositions.map((({id,x,y})=>({id,data:{x,y}})));this.graph.updateNodePosition(positionChanges)}this.clearState()}onDropNode(event){return __awaiter(this,void 0,void 0,(function*(){const elements=yield this.graph.canvas.document.elementsFromPoint(event.canvas.x,event.canvas.y),draggingIds=this.originPositions.map((({id})=>id)),currentIds=elements.map((ele=>{var _a,_b;return null===(_b=(_a=ele.parentNode).getAttribute)||void 0===_b?void 0:_b.call(_a,"data-item-id")})).filter((id=>void 0!==id&&!draggingIds.includes(id))),dropId=currentIds.find((id=>this.graph.getComboData(id)||this.graph.getNodeData(id))),newParentId=this.graph.getNodeData(dropId)?this.graph.getNodeData(dropId).data.parentId:dropId;this.graph.startHistoryBatch(),this.originPositions.forEach((({id})=>{const model=this.graph.getNodeData(id);if(!model)return;const{parentId}=model.data;parentId!==newParentId&&this.graph.updateData("node",{id,data:{parentId:newParentId}})})),this.onPointerUp(event),this.graph.stopHistoryBatch()}))}onDropCombo(event){event.stopPropagation();const newParentId=event.itemId;this.graph.startHistoryBatch(),this.onPointerUp(event),this.originPositions.forEach((({id})=>{const model=this.graph.getNodeData(id);if(!model)return;const{parentId}=model.data;parentId!==newParentId&&this.graph.updateData("node",{id,data:{parentId:newParentId}})})),this.clearState(),this.graph.stopHistoryBatch()}onDropCanvas(event){return __awaiter(this,void 0,void 0,(function*(){const elements=yield this.graph.canvas.document.elementsFromPoint(event.canvas.x,event.canvas.y),draggingIds=this.originPositions.map((({id})=>id)),currentIds=elements.map((ele=>{var _a,_b;return null===(_b=(_a=ele.parentNode).getAttribute)||void 0===_b?void 0:_b.call(_a,"data-item-id")})).filter((id=>void 0!==id&&!draggingIds.includes(id))),dropId=currentIds.find((id=>this.graph.getComboData(id)||this.graph.getNodeData(id))),parentId=this.graph.getNodeData(dropId)?this.graph.getNodeData(dropId).data.parentId:dropId;this.graph.startHistoryBatch(),this.onPointerUp(event);const nodeToUpdate=[];this.originPositions.forEach((({id})=>{const{parentId:originParentId}=this.graph.getNodeData(id).data;parentId&&originParentId!==parentId?nodeToUpdate.push({id,data:{parentId}}):originParentId&&nodeToUpdate.push({id,data:{parentId:void 0}})})),nodeToUpdate.length&&this.graph.updateData("node",nodeToUpdate),this.clearState(),this.graph.stopHistoryBatch()}))}}var drag_combo_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const drag_combo_DEFAULT_OPTIONS={enableTransient:!0,enableDelegate:!1,delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},throttle:16,hideRelatedEdges:!1,selectedState:"selected",eventName:"",updateComboStructure:!0,shouldBegin:()=>!0};class DragCombo extends Behavior{constructor(options){const finalOptions=Object.assign({},drag_combo_DEFAULT_OPTIONS,options);finalOptions.enableDelegate&&(finalOptions.enableTransient=!1),(finalOptions.enableDelegate||finalOptions.enableTransient)&&(finalOptions.hideRelatedEdges=!1),super(finalOptions),this.hiddenEdges=[],this.hiddenComboTreeRoots=[],this.originPositions=[],this.pointerDown=void 0,this.dragging=!1,this.getEvents=()=>{const events={"combo:pointerdown":this.onPointerDown,pointermove:this.onPointerMove,click:this.onPointerUp,keydown:this.onKeydown};return this.options.updateComboStructure?Object.assign({"node:drop":this.onDropNode,"combo:drop":this.onDropCombo,"canvas:drop":this.onDropCanvas},events):Object.assign({pointerup:this.onPointerUp},events)},this.throttledMoveCombos=(deltaX,deltaY,transient,upsertAncestors=!0)=>{}}getRelatedEdges(selectedComboIds,comboTreeRoots){let edges=selectedComboIds.flatMap((comboId=>this.graph.getRelatedEdgesData(comboId)));return graphComboTreeDfs(this.graph,comboTreeRoots,(child=>{edges=edges.concat(this.graph.getRelatedEdgesData(child.id))})),uniq(edges).filter((edgeData=>this.graph.getItemVisible(edgeData.id)))}getComboTreeItems(selectedComboIds){let begins=[];this.options.updateComboStructure?begins=selectedComboIds.map((id=>this.graph.getComboData(id))):selectedComboIds.forEach((id=>{const comboData=this.graph.getComboData(id);let rootAncestor=comboData,parentId=comboData.data.parentId;for(;parentId;){const parentData=this.graph.getComboData(parentId);if(!parentData)break;parentId=parentData.data.parentId,rootAncestor=parentData}begins.push(rootAncestor)}));const items=begins;return graphComboTreeDfs(this.graph,begins,(child=>items.push(child)),"TB"),uniq(items).filter((item=>!selectedComboIds.includes(item.id)&&this.graph.getItemVisible(item.id)))}onPointerDown(event){this.options.shouldBegin(event)&&(this.pointerDown={x:event.canvas.x,y:event.canvas.y},this.dragging=!1)}onPointerMove(event){if(!this.pointerDown)return;const beginDeltaX=Math.abs(this.pointerDown.x-event.canvas.x),beginDeltaY=Math.abs(this.pointerDown.y-event.canvas.y);if(beginDeltaX<1&&beginDeltaY<1)return;const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType;if(this.dragging&&(this.originPositions=this.selectedComboIds.map((id=>{if(!this.graph.getComboData(id))return void console.warn("combo does not exist",id);const bounds=this.graph.getRenderBBox(id,!0,enableTransient);if(!bounds)return;const[x,y]=bounds.center;if(this.options.enableDelegate){const[minX,minY]=bounds.min,[maxX,maxY]=bounds.max;return{id,x,y,minX,minY,maxX,maxY}}return{id,x,y}})).filter(Boolean)),!this.dragging){this.dragging=!0;const currentComboId=event.itemId;let selectedComboIds=this.graph.findIdByState("combo",this.options.selectedState,!0);currentComboId&&"combo"===event.itemType&&!selectedComboIds.includes(currentComboId)&&(selectedComboIds=[currentComboId]),this.selectedComboIds=selectedComboIds,this.options.hideRelatedEdges&&!enableTransient&&(this.hiddenComboTreeRoots=this.getComboTreeItems(selectedComboIds),this.hiddenEdges=this.getRelatedEdges(selectedComboIds,this.hiddenComboTreeRoots),this.graph.executeWithNoStack((()=>{this.graph.hideItem(this.hiddenEdges.map((edge=>edge.id)),{disableAnimate:!0}),this.graph.hideItem(this.hiddenComboTreeRoots.map((child=>child.id)),{disableAnimate:!0})}))),enableTransient?(this.hiddenComboTreeRoots=this.getComboTreeItems(selectedComboIds),this.hiddenEdges=this.getRelatedEdges(selectedComboIds,this.hiddenComboTreeRoots),selectedComboIds.forEach((comboId=>{this.graph.drawTransient("combo",comboId,{upsertAncestors:!this.options.updateComboStructure})})),this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{})})),this.graph.executeWithNoStack((()=>{this.graph.hideItem(selectedComboIds,{disableAnimate:!0}),this.graph.hideItem(this.hiddenEdges.map((edge=>edge.id)),{disableAnimate:!0}),this.graph.hideItem(this.hiddenComboTreeRoots.map((child=>child.id)),{disableAnimate:!0})}))):this.graph.frontItem(selectedComboIds),this.options.throttle>0?this.throttledMoveCombos=throttle(this.moveCombos,this.options.throttle,{leading:!0,trailing:!0}):this.throttledMoveCombos=this.moveCombos,this.originX=event.canvas.x,this.originY=event.canvas.y,this.previousX=event.canvas.x,this.previousY=event.canvas.y}if(!this.originPositions.length||!this.dragging)return;const pointerEvent=event,deltaX=pointerEvent.canvas.x-this.previousX,deltaY=pointerEvent.canvas.y-this.previousY;if(this.options.enableDelegate)this.moveDelegate(deltaX,deltaY);else{const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType;this.throttledMoveCombos(deltaX,deltaY,enableTransient,!this.options.updateComboStructure)}}moveCombos(deltaX,deltaY,transient,upsertAncestors=!0,callback){if(transient)this.originPositions.forEach((({id,x,y})=>{this.graph.drawTransient("combo",id,{data:{x:x+deltaX,y:y+deltaY},upsertAncestors})})),this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("edge",edge.id,{})}));else{const positions=[...this.originPositions];this.graph.moveCombo(this.originPositions.map((({id})=>id)),deltaX,deltaY,upsertAncestors,(()=>null==callback?void 0:callback(positions)))}this.previousX+=deltaX,this.previousY+=deltaY}moveDelegate(deltaX,deltaY){const x1=Math.min(...this.originPositions.map((position=>position.minX))),y1=Math.min(...this.originPositions.map((position=>position.minY))),x2=Math.max(...this.originPositions.map((position=>position.maxX))),y2=Math.max(...this.originPositions.map((position=>position.maxY)));this.graph.drawTransient("rect","g6-drag-combo-delegate-shape",{style:Object.assign({x:x1+deltaX,y:y1+deltaY,width:x2-x1,height:y2-y1},this.options.delegateStyle)})}clearDelegate(){this.graph.drawTransient("rect","g6-drag-combo-delegate-shape",{action:"remove"})}clearTransientItems(){this.hiddenEdges.forEach((edge=>{this.graph.drawTransient("combo",edge.source,{action:"remove"}),this.graph.drawTransient("combo",edge.target,{action:"remove"}),this.graph.drawTransient("edge",edge.id,{action:"remove"})})),this.hiddenComboTreeRoots.forEach((item=>{const isCombo=item.data._isCombo;this.graph.drawTransient(isCombo?"combo":"node",item.id,{action:"remove"})})),this.originPositions.forEach((({id})=>{this.graph.drawTransient("combo",id,{action:"remove"})}))}restoreHiddenItems(positions){this.graph.pauseStack(),this.hiddenEdges.length&&(this.graph.showItem(this.hiddenEdges.map((edge=>edge.id)),{disableAnimate:!0}),this.hiddenEdges=[]),this.hiddenComboTreeRoots.length&&(this.graph.showItem(this.hiddenComboTreeRoots.map((model=>model.id)),{disableAnimate:!0}),this.hiddenComboTreeRoots=[]);this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType&&this.graph.showItem(this.originPositions.concat(positions).map((position=>position.id)),{disableAnimate:!0}),this.graph.resumeStack()}onPointerUp(event){this.pointerDown=void 0,this.dragging=!1;const enableTransient=this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType,pointerEvent=event,baseX=enableTransient?this.originX:this.previousX,baseY=enableTransient?this.originY:this.previousY,deltaX=pointerEvent.canvas.x-baseX+.01,deltaY=pointerEvent.canvas.y-baseY+.01;this.moveCombos(deltaX,deltaY,!1,!0,lodash_debounce((positions=>{enableTransient&&this.clearTransientItems(),this.options.enableDelegate&&this.clearDelegate(),this.restoreHiddenItems(positions),this.options.eventName&&this.graph.emit(this.options.eventName,{itemIds:positions.map((position=>position.id))}),this.originPositions=[]}),16,!1))}onKeydown(event){if("Escape"!==event.key&&"Esc"!==event.key)return;this.clearDelegate(),this.clearTransientItems(),this.restoreHiddenItems();if(!(this.options.enableTransient&&"webgl-3d"!==this.graph.rendererType)&&!this.options.enableDelegate){const positionChanges=this.originPositions.map((({id,x,y})=>({id,data:{x,y}})));this.graph.updateComboPosition(positionChanges)}this.originPositions=[]}onDropNode(event){return drag_combo_awaiter(this,void 0,void 0,(function*(){const elements=yield this.graph.canvas.document.elementsFromPoint(event.canvas.x,event.canvas.y),draggingIds=this.originPositions.map((({id})=>id)),currentIds=elements.map((ele=>{var _a,_b;return null===(_b=(_a=ele.parentNode).getAttribute)||void 0===_b?void 0:_b.call(_a,"data-item-id")})).filter((id=>void 0!==id&&!draggingIds.includes(id))),dropId=currentIds.find((id=>this.graph.getComboData(id)||this.graph.getNodeData(id))),newParentId=this.graph.getNodeData(dropId)?this.graph.getNodeData(dropId).data.parentId:dropId;this.originPositions.forEach((({id})=>{const model=this.graph.getComboData(id);if(!model)return;const{parentId}=model.data;parentId!==newParentId&&this.graph.updateData("node",{id,data:{parentId:newParentId}})})),this.onPointerUp(event)}))}onDropCombo(event){const newParentId=event.itemId;this.graph.startHistoryBatch(),this.originPositions.forEach((({id})=>{const model=this.graph.getComboData(id);if(!model||model.id===newParentId)return;const{parentId}=model.data;parentId!==newParentId&&this.graph.updateData("combo",{id,data:{parentId:newParentId}})})),this.graph.stopHistoryBatch(),this.onPointerUp(event)}onDropCanvas(event){this.graph.startHistoryBatch(),this.originPositions.forEach((({id})=>{const model=this.graph.getComboData(id);if(!model)return;const{parentId}=model.data;parentId&&this.graph.updateData("combo",{id,data:{parentId:void 0}})})),this.graph.stopHistoryBatch(),this.onPointerUp(event)}}const zoom_canvas_VALID_TRIGGERS=["wheel","upDownKeys"],zoom_canvas_DEFAULT_OPTIONS={enableOptimize:!1,triggerOnItems:!0,sensitivity:6,trigger:"wheel",secondaryKey:"",speedUpKey:"shift",eventName:"",minZoom:1e-5,maxZoom:1e3,shouldBegin:()=>!0,fixSelectedItems:!1};class ZoomCanvas extends Behavior{constructor(options){const finalOptions=Object.assign({},zoom_canvas_DEFAULT_OPTIONS,options);zoom_canvas_VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid, 'wheel' will take effect.`),finalOptions.trigger="wheel");const{fixSelectedItems}=finalOptions;is_boolean(fixSelectedItems)&&fixSelectedItems&&(finalOptions.fixSelectedItems={fixAll:!0,fixState:"selected"}),is_boolean(fixSelectedItems)||fixSelectedItems.fixState||(finalOptions.fixSelectedItems.fixState="selected"),super(finalOptions),this.zoomCache={fixIds:new Set,balanceRatio:new Map,lineWidth:new Map}}getEvents(){var _a,_b;return null===(_b=(_a=this.graph.canvas.getContextService().getDomElement()).addEventListener)||void 0===_b||_b.call(_a,"wheel",(e=>{e.preventDefault()}),{passive:!1}),"upDownKeys"===this.options.trigger?{keydown:this.onKeydown,keyup:this.onKeyup}:{wheel:this.onWheel,keydown:this.onKeydown,keyup:this.onKeyup}}hideShapes(){const{graph}=this,{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},optimize=void 0!==this.options.enableOptimize?this.options.enableOptimize:graphBehaviorOptimize;if((0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize){this.hiddenEdgeIds=graph.getAllEdgesData().map((edge=>edge.id)).filter((id=>!0===graph.getItemVisible(id))),this.hiddenNodeIds=graph.getAllNodesData().map((node=>node.id)).filter((id=>!0===graph.getItemVisible(id)));const hiddenIds=[...this.hiddenNodeIds],sectionNum=Math.ceil(hiddenIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>hiddenIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{if(!sections.length&&this.tileRequestId)return cancelAnimationFrame(this.tileRequestId),void(this.tileRequestId=void 0);const section=sections.shift();graph.startHistoryBatch(),graph.hideItem(section,{disableAnimate:!1,keepKeyShape:!0}),graph.stopHistoryBatch(),this.tileRequestId=requestAnimationFrame(update)};this.tileRequestId=requestAnimationFrame(update)}}endZoom(){const{graph,hiddenEdgeIds=[],hiddenNodeIds}=this,{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},optimize=void 0!==this.options.enableOptimize?this.options.enableOptimize:graphBehaviorOptimize,shouldOptimize=(0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize;if(this.zooming=!1,shouldOptimize&&(this.tileRequestId&&(cancelAnimationFrame(this.tileRequestId),this.tileRequestId=void 0),hiddenNodeIds)){const hiddenIds=[...hiddenNodeIds,...hiddenEdgeIds],sectionNum=Math.ceil(hiddenIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>hiddenIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{if(!sections.length&&this.tileRequestId)return cancelAnimationFrame(this.tileRequestId),void(this.tileRequestId=void 0);graph.executeWithNoStack((()=>{graph.showItem(sections.shift(),{disableAnimate:!1})})),this.tileRequestId=requestAnimationFrame(update)};this.tileRequestId=requestAnimationFrame(update)}this.hiddenEdgeIds=[],this.hiddenNodeIds=[]}onWheel(event){const{graph,keydown}=this,{deltaY,client,itemId}=event,{eventName,sensitivity,secondaryKey,triggerOnItems,minZoom,maxZoom,shouldBegin}=this.options;if(secondaryKey&&!keydown||itemId&&"CANVAS"!==itemId&&!triggerOnItems||!shouldBegin(event))return void this.endZoom();this.zooming||(this.graph.canvas.getConfig().disableHitTesting=!0,this.hideShapes(),this.clearCache(),this.zooming=!0);const{tileBehavior:graphBehaviorOptimize}=graph.getSpecification().optimize||{},shouldDebounce="boolean"==typeof graphBehaviorOptimize?graphBehaviorOptimize:graph.getAllNodesData().length>graphBehaviorOptimize,now=Date.now();if(shouldDebounce&&this.lastWheelTriggerTime&&now-this.lastWheelTriggerTime<50)return;let zoomRatio=1;deltaY<0&&(zoomRatio=(100+sensitivity)/100),deltaY>0&&(zoomRatio=100/(100+sensitivity));const zoomTo=zoomRatio*graph.getZoom();if(minZoom&&zoomTo<minZoom)return;if(maxZoom&&zoomTo>maxZoom)return;const{fixSelectedItems}=this.options;fixSelectedItems&&this.balanceItemSize(),graph.zoom(zoomRatio,{x:client.x,y:client.y}),this.lastWheelTriggerTime=now,clearTimeout(this.zoomTimer),this.zoomTimer=setTimeout((()=>{this.endZoom(),this.graph.canvas.getConfig().disableHitTesting=!1}),300),eventName&&graph.emit(eventName,{zoom:{ratio:zoomRatio}})}clearCache(){this.zoomCache.fixIds.forEach((fixId=>{this.graph.itemController.itemMap.get(fixId).displayModel.labelShapeVisible=void 0})),this.zoomCache.fixIds.clear()}balanceItemSize(){const{graph}=this,zoom=graph.getZoom();let fixNodeIds=[],fixEdgeIds=[];if(zoom<1){let typeArr=[];const{fixSelectedItems}=this.options,{fixLabel,fixAll,fixLineWidth,fixState}=fixSelectedItems;fixLabel&&typeArr.push("labelSize"),fixLineWidth&&typeArr.push("lineWidth"),fixAll&&(typeArr=["fullSize"]),fixNodeIds=graph.findIdByState("node",fixState),fixEdgeIds=graph.findIdByState("edge",fixState);const fixIds=fixNodeIds.concat(fixEdgeIds);if(!fixIds.length)return;this.zoomCache.fixIds=new Set([...fixIds]),fixIds.forEach((id=>{const item=graph.itemController.itemMap.get(id),balanceRatio=1/zoom||1;"edge"===item.getType()&&typeArr.includes("fullSize")&&(typeArr=["labelSize","lineWidth"]);const balanceLabelShape=()=>{item.updateLabelPosition(),item.displayModel.labelShapeVisible=!0,graph.showItem(id,{shapeIds:["labelShape","labelBackgroundShape"],disableAnimate:!0})};typeArr.forEach((type=>{var _a;switch(type){case"lineWidth":{const{keyShape}=item.shapeMap;this.zoomCache.lineWidth.has(id)||this.zoomCache.lineWidth.set(id,keyShape.attributes.lineWidth);const oriLineWidth=this.zoomCache.lineWidth.get(id);keyShape.attr("lineWidth",oriLineWidth*balanceRatio);break}case"fullSize":{const{group}=item,transform=group.style.transform;if(!this.zoomCache.balanceRatio.has(id)){const oriBalanceRatio=Number(null===(_a=null==transform?void 0:transform.match(/scale\(([\d.]+),/))||void 0===_a?void 0:_a[1])||1;this.zoomCache.balanceRatio.set(id,oriBalanceRatio)}const newBalanceRatio=this.zoomCache.balanceRatio.get(id)*balanceRatio;group.style.transform=`scale(${newBalanceRatio}, ${newBalanceRatio})`,balanceLabelShape();break}case"labelSize":balanceLabelShape()}}))}))}}onKeydown(event){const{key}=event,{secondaryKey,trigger,speedUpKey,eventName,sensitivity,shouldBegin}=this.options;if(secondaryKey&&secondaryKey===key.toLowerCase()&&(this.keydown=!0),speedUpKey&&speedUpKey===key.toLowerCase()&&(this.speedupKeydown=!0),"upDownKeys"===trigger){if(secondaryKey&&!this.keydown)return;if(!shouldBegin(event))return;const{graph,speedupKeydown}=this,speed=speedupKeydown?20:1;let zoomRatio=1;switch(key){case"ArrowUp":zoomRatio=(100+sensitivity*speed)/100;break;case"ArrowDown":zoomRatio=100/(100+sensitivity*speed)}1!==zoomRatio&&(graph.zoom(zoomRatio),eventName&&graph.emit(eventName,{zoom:{ratio:zoomRatio}}))}}onKeyup(event){const{key}=event,{secondaryKey,speedUpKey}=this.options;secondaryKey&&secondaryKey===key.toLowerCase()&&(this.keydown=!1),speedUpKey&&speedUpKey===key.toLowerCase()&&(this.speedupKeydown=!1)}}const hover_activate_DEFAULT_OPTIONS={throttle:16,activateState:"active",eventName:"",itemTypes:["node","edge","combo"],shouldBegin:()=>!0};class HoverActivate extends Behavior{constructor(options){super(Object.assign({},hover_activate_DEFAULT_OPTIONS,options)),this.getEvents=()=>({"node:pointerenter":this.onPointerEnter,"node:pointerleave":this.onPointerLeave,"edge:pointerenter":this.onPointerEnter,"edge:pointerleave":this.onPointerLeave,"combo:pointerenter":this.onPointerEnter,"combo:pointerleave":this.onPointerLeave})}onPointerEnter(event){const{itemId,itemType}=event,{graph,currentItemInfo}=this,{activateState,itemTypes,eventName}=this.options;currentItemInfo&&itemTypes.includes(currentItemInfo.itemType)&&graph.setItemState(currentItemInfo.id,activateState,!1),itemTypes.includes(itemType)&&(graph.setItemState(itemId,activateState,!0),this.currentItemInfo={id:itemId,itemType},eventName&&this.graph.emit(eventName,{itemId,itemType,state:activateState,action:"pointerenter"}))}onPointerLeave(event){const{itemId,itemType}=event,{activateState,itemTypes,eventName}=this.options;if(!itemTypes.includes(itemType))return;const{graph}=this;graph.setItemState(itemId,activateState,!1),this.currentItemInfo=void 0,eventName&&this.graph.emit(eventName,{itemId,itemType,state:activateState,action:"pointerleave"})}}const lasso=(graph,points,itemTypes)=>{const lassoContour=points.map((point=>[point.x,point.y])),selectedNodeIds=[];let selectedEdgeIds=[];const selectedComboIds=[];return itemTypes.includes("node")&&graph.getAllNodesData().forEach((node=>{const{id}=node;graph.getItemVisible(id)&&isItemIntersectPolygon(graph,id,lassoContour)&&selectedNodeIds.push(id)})),itemTypes.includes("combo")&&graph.getAllCombosData().forEach((combo=>{const{id}=combo;graph.getItemVisible(id)&&isItemIntersectPolygon(graph,id,lassoContour)&&selectedComboIds.push(id)})),itemTypes.includes("edge")&&(selectedEdgeIds=getEdgesBetween(graph,selectedNodeIds.concat(selectedComboIds))),{nodes:selectedNodeIds,edges:selectedEdgeIds,combos:selectedComboIds}},isItemIntersectPolygon=(graph,id,polyPoints)=>{const shapeBBox=graph.getRenderBBox(id);if(!shapeBBox)return!1;const shapePoints=[[shapeBBox.min[0],shapeBBox.min[1]],[shapeBBox.max[0],shapeBBox.min[1]],[shapeBBox.max[0],shapeBBox.max[1]],[shapeBBox.min[0],shapeBBox.max[1]]];return isPolygonsIntersect(polyPoints,shapePoints)};class LassoSelect extends BrushSelect{constructor(){super(...arguments),this.selectedIds={nodes:[],edges:[],combos:[]},this.points=[],this.onMouseDown=event=>{this.points=[],this.removeBrush(),super.onMouseDown(event),this.beginPoint&&this.points.push(this.beginPoint)},this.onMouseMove=event=>{if(this.mousedown){const{canvas:point}=event;this.points.push({x:point.x,y:point.y})}super.onMouseMove(event)},this.onMouseUp=event=>{const{canvas:point}=event;this.points.push({x:point.x,y:point.y}),super.onMouseUp(event),this.removeBrush(),this.points=[]},this.updateBrush=event=>{const{graph}=this;return graph.drawTransient("path","g6-lasso-select-brush-shape",{style:{path:this.getLassoPath()}})},this.removeBrush=()=>{const{graph}=this;graph.drawTransient("path","g6-lasso-select-brush-shape",{action:"remove"})},this.getLassoPath=()=>{const points=this.points,path=[];return points.length&&(points.forEach(((point,index)=>{0===index?path.push(["M",point.x,point.y]):path.push(["L",point.x,point.y])})),path.push(["L",points[0].x,points[0].y])),path}}getSelector(){return lasso}getPoints(){return this.points}createBrush(){const{graph,options}=this,{brushStyle}=options;return graph.drawTransient("path","g6-lasso-select-brush-shape",{style:Object.assign({pointerEvents:"none"},brushStyle)})}}const rotate_canvas_3d_VALID_TRIGGERS=["drag","directionKeys"],rotate_canvas_3d_DEFAULT_OPTIONS={trigger:"drag",secondaryKey:"",speedUpKey:"shift",eventName:"",triggerOnItems:!1,shouldBegin:()=>!0};class RotateCanvas3D extends Behavior{constructor(options){const finalOptions=Object.assign({},rotate_canvas_3d_DEFAULT_OPTIONS,options);rotate_canvas_3d_VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid for rotate-canvas-3d behavior, "drag" will take effect instead. Only "${rotate_canvas_3d_VALID_TRIGGERS.join('", "')}" are available.`),finalOptions.trigger="drag"),super(finalOptions),this.getEvents=()=>"drag"===this.options.trigger?{pointerdown:this.onPointerDown,pointermove:this.onPointerMove,pointerup:this.onPointerUp,keydown:this.onKeydown,keyup:this.onKeyup}:{keydown:this.onKeydown,keyup:this.onKeyup}}onPointerDown(event){const{triggerOnItems,shouldBegin}=this.options;if(event.itemId&&!triggerOnItems||!shouldBegin(event))return;const{client}=event;this.pointStartAt={x:client.x,y:client.y}}onPointerMove(event){if(!this.pointStartAt)return;const{shouldBegin,secondaryKey}=this.options;if(secondaryKey&&!this.keydown)return;if(!shouldBegin(event))return;const{client}=event,diff={x:client.x-this.pointStartAt.x,y:client.y-this.pointStartAt.y},{graph}=this,camera=graph.canvas.getCamera();this.rotate(camera,diff.x,diff.y),this.pointStartAt={x:client.x,y:client.y}}onPointerUp(event){this.pointStartAt=void 0}onKeydown(event){const{key}=event,{trigger,secondaryKey,speedUpKey}=this.options;if("directionKeys"===trigger&&(!secondaryKey||secondaryKey&&this.keydown)){const{graph}=this,camera=graph.canvas.getCamera(),speed=1*(this.speedUpKeydown?10:1);"ArrowUp"===key&&camera.pan(0,speed),"ArrowDown"===key&&camera.pan(0,-speed),"ArrowLeft"===key&&camera.pan(speed,0),"ArrowRight"===key&&camera.pan(-speed,0)}secondaryKey===key.toLowerCase()&&(this.keydown=!0),speedUpKey===key.toLowerCase()&&(this.speedUpKeydown=!0)}onKeyup(event){const{key}=event,{secondaryKey,speedUpKey}=this.options;secondaryKey===key.toLowerCase()&&(this.keydown=!1),speedUpKey===key.toLowerCase()&&(this.speedUpKeydown=!1)}rotate(camera,rx,ry){const{width,height}=this.graph.canvas.getConfig();let motionFactorX=10,motionFactorY=10;rx*rx>2*ry*ry?motionFactorY*=.5:ry*ry>2*rx*rx&&(motionFactorX*=.5);const rotX=rx*(20/height)*motionFactorX,rotY=ry*(20/width)*motionFactorY;camera.rotate(rotX,-rotY,0)}}const orbit_canvas_3d_VALID_TRIGGERS=["drag","directionKeys"],orbit_canvas_3d_DEFAULT_OPTIONS={trigger:"directionKeys",secondaryKey:"",eventName:"",shouldBegin:()=>!0};class OrbitCanvas3D extends RotateCanvas3D{constructor(options){const finalOptions=Object.assign({},orbit_canvas_3d_DEFAULT_OPTIONS,options);orbit_canvas_3d_VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid for track-canvas-3d behavior, "drag" will take effect instead. Only "${orbit_canvas_3d_VALID_TRIGGERS.join('", "')}" are available.`),finalOptions.trigger="drag"),super(finalOptions)}setTrackingCamera(){const{graph}=this,camera=graph.canvas.getCamera();this.previousType=camera.type,graph.canvas.getCamera().setType(CameraType.ORBITING)}restoreCameraType(){if(void 0!==this.previousType){const{graph}=this;graph.canvas.getCamera().setType(this.previousType)}}onPointerDown(event){this.setTrackingCamera(),super.onPointerDown(event)}onPointerUp(event){this.restoreCameraType(),super.onPointerUp(event)}onKeydown(event){const{trigger,secondaryKey}=this.options;"directionKeys"===trigger&&(!secondaryKey||secondaryKey&&this.keydown)&&this.setTrackingCamera(),super.onKeydown(event)}onKeyup(event){const{trigger,secondaryKey}=this.options;"directionKeys"===trigger&&(!secondaryKey||secondaryKey&&this.keydown)&&this.restoreCameraType(),super.onKeyup(event)}}const track_canvas_3d_VALID_TRIGGERS=["drag","directionKeys"],track_canvas_3d_DEFAULT_OPTIONS={trigger:"directionKeys",secondaryKey:"",eventName:"",shouldBegin:()=>!0};class TrackCanvas3D extends RotateCanvas3D{constructor(options){const finalOptions=Object.assign({},track_canvas_3d_DEFAULT_OPTIONS,options);track_canvas_3d_VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid for track-canvas-3d behavior, "drag" will take effect instead. Only "${track_canvas_3d_VALID_TRIGGERS.join('", "')}" are available.`),finalOptions.trigger="drag"),super(finalOptions)}setTrackingCamera(){const{graph}=this,camera=graph.canvas.getCamera();this.previousType=camera.type,graph.canvas.getCamera().setType(CameraType.TRACKING)}restoreCameraType(){if(void 0!==this.previousType){const{graph}=this;graph.canvas.getCamera().setType(this.previousType)}}onPointerDown(event){this.setTrackingCamera(),super.onPointerDown(event)}onPointerUp(event){this.restoreCameraType(),super.onPointerUp(event)}onKeydown(event){const{trigger,secondaryKey}=this.options;"directionKeys"===trigger&&(!secondaryKey||secondaryKey&&this.keydown)&&this.setTrackingCamera(),super.onKeydown(event)}onKeyup(event){const{trigger,secondaryKey}=this.options;"directionKeys"===trigger&&(!secondaryKey||secondaryKey&&this.keydown)&&this.restoreCameraType(),super.onKeyup(event)}}const zoom_canvas_3d_VALID_TRIGGERS=["wheel","upDownKeys"],zoom_canvas_3d_DEFAULT_OPTIONS={trigger:"wheel",secondaryKey:"",eventName:"",sensitivity:10,triggerOnItems:!0,minZoom:.01,maxZoom:10,shouldBegin:()=>!0};class ZoomCanvas3D extends Behavior{constructor(options){const finalOptions=Object.assign({},zoom_canvas_3d_DEFAULT_OPTIONS,options);zoom_canvas_3d_VALID_TRIGGERS.includes(finalOptions.trigger)||(console.warn(`The trigger ${finalOptions.trigger} is not valid for zoom-canvas-3d behavior, "wheel" will take effect instead. Only "${zoom_canvas_3d_VALID_TRIGGERS.join('", "')}" are available.`),finalOptions.trigger="wheel"),super(finalOptions),this.getEvents=()=>{const $el=this.graph.canvas.getContextService().getDomElement();return $el&&$el.addEventListener&&$el.addEventListener("wheel",(e=>{e.preventDefault()}),{passive:!1}),"wheel"===this.options.trigger?{wheel:this.onWheel,keydown:this.onKeydown,keyup:this.onKeyup}:{keydown:this.onKeydown,keyup:this.onKeyup}}}onWheel(event){const{graph,options}=this,{secondaryKey,triggerOnItems,eventName,minZoom,maxZoom,sensitivity=1,shouldBegin}=options;if(event.itemId&&!triggerOnItems)return;if(!shouldBegin(event))return;if(secondaryKey&&!this.keydown)return;const camera=graph.canvas.getCamera(),sign=event.deltaY>0?1:-1,currentDistance=camera.getDistance(),dolly=100*sign*sensitivity/currentDistance*Math.sqrt(currentDistance),toDistance=currentDistance+dolly,azimuth=camera.getAzimuth(),cameraFrontOfFocalPoint=(azimuth<90&&azimuth>-90?1:-1)*(camera.getDistanceVector()[2]<0?1:-1)>0;dolly>0&&cameraFrontOfFocalPoint&&toDistance>1/minZoom*200||dolly<0&&!cameraFrontOfFocalPoint&&toDistance>200*maxZoom||(camera.dolly(dolly),eventName&&graph.emit(eventName,{zoom:camera.getZoom()}))}onKeydown(event){const{key}=event,{trigger,secondaryKey}=this.options;"upDownKeys"===trigger&&("ArrowUp"===key&&this.onWheel({deltaY:-1}),"ArrowDown"===key&&this.onWheel({deltaY:1})),secondaryKey===key.toLowerCase()&&(this.keydown=!0)}onKeyup(event){const{key}=event,{secondaryKey}=this.options;secondaryKey===key.toLowerCase()&&(this.keydown=!1)}}function warn({optionName,shouldBe,now,scope}){console.warn(`G6 [${scope}]: Invalid option, ${optionName} must be one of ${shouldBe.join(", ")}, but got ${now}`)}var create_edge_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const create_edge_KEYBOARD_TRIGGERS=["shift","ctrl","control","alt","meta"],EVENT_TRIGGERS=["click","drag"],DUMMY_NODE_ID="g6-create-edge-dummy-node",create_edge_DEFAULT_OPTIONS={trigger:"click",secondaryKey:void 0,shouldBegin:()=>!0,shouldEnd:()=>!0,edgeConfig:{}};class CreateEdge extends Behavior{constructor(options){super(Object.assign({},create_edge_DEFAULT_OPTIONS,options)),this.isKeyDown=!1,this.addingEdge=null,this.dummyNode=null,this.getEvents=()=>{const{trigger,secondaryKey}=this.options,[CLICK_NAME]=EVENT_TRIGGERS,triggerEvents=trigger===CLICK_NAME?{"node:click":this.handleCreateEdge,pointermove:this.updateEndPoint,"edge:click":this.cancelCreating,"canvas:click":this.cancelCreating,"combo:click":this.handleCreateEdge}:{"node:dragstart":this.handleCreateEdge,"combo:dragstart":this.handleCreateEdge,drag:this.updateEndPoint,drop:this.onDrop},keyboardEvents=secondaryKey?{keydown:this.onKeyDown,keyup:this.onKeyUp}:{};return Object.assign(Object.assign({},triggerEvents),keyboardEvents)},this.handleCreateEdge=e=>{if(this.options.secondaryKey&&!this.isKeyDown)return;const{graph,options,addingEdge}=this,currentNodeId=e.itemId,{edgeConfig,createVirtualEventName,createActualEventName}=options;if(addingEdge){if(!this.options.shouldEnd(e))return void this.cancelCreating();const actualEdge=graph.addData("edge",{id:generateEdgeID(addingEdge.source,currentNodeId),source:addingEdge.source,target:currentNodeId,data:Object.assign(Object.assign({},edgeConfig),{type:currentNodeId===addingEdge.source?"loop-edge":edgeConfig.type})});return createActualEventName&&graph.emit(createActualEventName,{edge:actualEdge}),void this.cancelCreating()}this.options.shouldBegin(e)&&(this.dummyNode=graph.addData("node",{id:DUMMY_NODE_ID,data:{x:e.canvas.x,y:e.canvas.y,keyShape:{opacity:0,interactive:!1},labelShape:{opacity:0},anchorPoints:[[.5,.5]]}}),this.addingEdge=graph.addData("edge",{id:"g6-create-edge-virtual-edge",source:currentNodeId,target:DUMMY_NODE_ID,data:Object.assign({},edgeConfig)}),createVirtualEventName&&graph.emit(createVirtualEventName,{edge:this.addingEdge}))},this.onDrop=e=>create_edge_awaiter(this,void 0,void 0,(function*(){const{addingEdge,options,graph}=this,{edgeConfig,secondaryKey,createActualEventName}=options;if(secondaryKey&&!this.isKeyDown)return;if(!addingEdge)return;const currentIds=(yield this.graph.canvas.document.elementsFromPoint(e.canvas.x,e.canvas.y)).map((ele=>{var _a,_b;return null===(_b=(_a=ele.parentNode).getAttribute)||void 0===_b?void 0:_b.call(_a,"data-item-id")})).filter((id=>void 0!==id&&!1!==id)),dropId=currentIds.find((id=>this.graph.getComboData(id)||this.graph.getNodeData(id)));if(!dropId)return void this.cancelCreating();if(!this.options.shouldEnd(e))return void this.cancelCreating();const actualEdge=graph.addData("edge",{id:generateEdgeID(addingEdge.source,dropId),source:addingEdge.source,target:dropId,data:Object.assign(Object.assign({},edgeConfig),{type:dropId===addingEdge.source?"loop-edge":edgeConfig.type})});createActualEventName&&graph.emit(createActualEventName,{edge:actualEdge}),this.cancelCreating()})),this.updateEndPoint=e=>{const{options,graph,addingEdge,isKeyDown}=this;if(options.secondaryKey&&!isKeyDown)return;if(!addingEdge)return;const sourceId=addingEdge.source,targetId=addingEdge.target;graph.getItemById(sourceId)?graph.updatePosition("node",{id:targetId,data:{x:e.canvas.x,y:e.canvas.y}}):this.addingEdge=null},this.cancelCreating=()=>{this.addingEdge&&(this.graph.removeData("edge","g6-create-edge-virtual-edge"),this.addingEdge=null),this.dummyNode&&(this.graph.removeData("node",DUMMY_NODE_ID),this.dummyNode=null),this.options.cancelCreateEventName&&this.graph.emit(this.options.cancelCreateEventName,{})},this.onKeyDown=e=>{const code=e.key;code&&code.toLocaleLowerCase()===this.options.secondaryKey&&(this.isKeyDown=!0)},this.onKeyUp=e=>{this.addingEdge&&this.cancelCreating(),this.isKeyDown=!1},this.validateOptions(options)}validateOptions(options){options.trigger&&!EVENT_TRIGGERS.includes(options.trigger)&&(warn({optionName:"create-edge.trigger",shouldBe:EVENT_TRIGGERS,now:options.trigger,scope:"behavior"}),this.options.trigger=create_edge_DEFAULT_OPTIONS.trigger),options.secondaryKey&&!create_edge_KEYBOARD_TRIGGERS.includes(options.secondaryKey)&&(warn({optionName:"create-edge.secondaryKey",shouldBe:create_edge_KEYBOARD_TRIGGERS,now:options.secondaryKey,scope:"behavior"}),this.options.secondaryKey=create_edge_DEFAULT_OPTIONS.secondaryKey)}}const ALLOW_TRIGGERS=["shift","ctrl","alt","control"],shortcuts_call_DEFAULT_OPTIONS={trigger:"ctrl",combinedKey:"1",functionName:"fitView",functionParams:[]};class ShortcutsCall extends Behavior{constructor(options){super(Object.assign({},shortcuts_call_DEFAULT_OPTIONS,options)),this.triggerKeydown=!1,this.getEvents=()=>({keyup:this.onKeyUp,keydown:this.onKeyDown}),options.trigger&&!ALLOW_TRIGGERS.includes(options.trigger)&&(console.warn(`G6: Invalid trigger option "${options.trigger}" for shortcuts-call behavior!`),this.options.trigger=shortcuts_call_DEFAULT_OPTIONS.trigger),options.combinedKey===this.options.trigger&&(this.options.combinedKey=void 0)}onKeyDown(e){const code=e.key;if(!code)return;const{graph}=this,{trigger,combinedKey,functionName,functionParams}=this.options,triggerLowerCase=trigger.toLowerCase(),codeLowerCase=code.toLowerCase();if(this.triggerKeydown||(codeLowerCase===triggerLowerCase||"control"===codeLowerCase&&"ctrl"===triggerLowerCase||"ctrl"===codeLowerCase&&"control"===triggerLowerCase)&&(this.triggerKeydown=!0),!graph[functionName])return console.warn(`G6: Invalid functionName option: "${functionName}" for shortcuts-call behavior!`),{};if(!this.triggerKeydown)return;if(!combinedKey)return void(functionParams&&functionParams.length?graph[functionName](...functionParams):graph[functionName]());const combinedKeyLowerCase=combinedKey.toLowerCase();(codeLowerCase===combinedKeyLowerCase||"control"===codeLowerCase&&"ctrl"===combinedKeyLowerCase||"ctrl"===codeLowerCase&&"control"===combinedKeyLowerCase)&&(functionParams&&functionParams.length?graph[functionName](...functionParams):graph[functionName]())}onKeyUp(e){const code=e.key;if(!code)return;const{trigger}=this.options,triggerLowerCase=trigger.toLowerCase(),codeLowerCase=code.toLowerCase();(codeLowerCase===triggerLowerCase||"control"===codeLowerCase&&"ctrl"===triggerLowerCase||"ctrl"===codeLowerCase&&"control"===triggerLowerCase)&&(this.triggerKeydown=!1)}}const scroll_canvas_DEFAULT_OPTIONS={direction:"both",enableOptimize:!1,zoomKey:"ctrl",scalableRange:0,allowDragOnItem:!0,zoomRatio:.05};class ScrollCanvas extends Behavior{constructor(options){super(Object.assign({},scroll_canvas_DEFAULT_OPTIONS,options,{zoomKey:initZoomKey(options.zoomKey)})),this.optimized=!1,this.getEvents=()=>({wheel:this.onWheel})}onWheel(ev){if(!this.allowDrag(ev))return;const graph=this.graph,{zoomKey,zoomRatio,enableOptimize}=this.options,zoomKeys=Array.isArray(zoomKey)?[].concat(zoomKey):[zoomKey];zoomKeys.includes("control")&&zoomKeys.push("ctrl");const keyDown=zoomKeys.some((ele=>ev[`${ele}Key`])),nativeEvent=ev.nativeEvent;if(keyDown){const point=graph.canvas.client2Viewport({x:ev.client.x,y:ev.client.y});let ratio=graph.getZoom();nativeEvent&&nativeEvent.wheelDelta>0?ratio+=ratio*zoomRatio:ratio-=ratio*zoomRatio,graph.zoomTo(ratio,{x:point.x,y:point.y})}else{const diffX=ev.deltaX||ev.movement.x,diffY=ev.deltaY||ev.movement.y,{dx,dy}=this.formatDisplacement(diffX,diffY);graph.translate({dx:-dx,dy:-dy})}if(enableOptimize){this.optimized||(this.hideShapes(),this.optimized=!0),clearTimeout(this.timeout),this.timeout=void 0;const timeout=window.setTimeout((()=>{this.showShapes(),this.optimized=!1}),100);this.timeout=timeout}}formatDisplacement(dx,dy){const{graph}=this,{scalableRange,direction}=this.options,[width,height]=graph.getSize(),graphBBox=graph.canvas.getRoot().getRenderBounds();let isPixel,rangeNum=Number(scalableRange);"string"==typeof scalableRange&&(scalableRange.includes("px")&&(isPixel=scalableRange.includes("px"),rangeNum=Number(scalableRange.replace("px",""))),scalableRange.includes("%")&&(rangeNum=Number(scalableRange.replace("%",""))/100));let expandWidth=rangeNum,expandHeight=rangeNum;isPixel||(expandWidth=width*rangeNum,expandHeight=height*rangeNum);const leftTopClient=graph.getViewportByCanvas({x:graphBBox.min[0],y:graphBBox.min[1]}),rightBottomClient=graph.getViewportByCanvas({x:graphBBox.max[0],y:graphBBox.max[1]}),minX=leftTopClient.x,minY=leftTopClient.y,maxX=rightBottomClient.x,maxY=rightBottomClient.y;return dx>0?maxX<-expandWidth?dx=0:maxX-dx<-expandWidth&&(dx=maxX+expandWidth):dx<0&&(minX>width+expandWidth?dx=0:minX-dx>width+expandWidth&&(dx=minX-(width+expandWidth))),dy>0?maxY<-expandHeight?dy=0:maxY-dy<-expandHeight&&(dy=maxY+expandHeight):dy<0&&(minY>height+expandHeight?dy=0:minY-dy>height+expandHeight&&(dy=minY-(height+expandHeight))),"x"===direction?dy=0:"y"===direction&&(dx=0),{dx,dy}}allowDrag(evt){const{itemType}=evt,{allowDragOnItem}=this.options,targetIsCanvas="canvas"===itemType;if(is_boolean(allowDragOnItem)&&!allowDragOnItem&&!targetIsCanvas)return!1;if((0,is_object.A)(allowDragOnItem)){const{node,edge,combo}=allowDragOnItem;if(!node&&"node"===itemType)return!1;if(!edge&&"edge"===itemType)return!1;if(!combo&&"combo"===itemType)return!1}return!0}hideShapes(){const{graph,options}=this,{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},{optimizeZoom}=options,optimize=this.options.enableOptimize||graphBehaviorOptimize;if((0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize){const currentZoom=graph.getZoom(),newHiddenEdgeIds=graph.getAllEdgesData().map((edge=>edge.id)).filter((id=>graph.getItemVisible(id)));graph.hideItem(newHiddenEdgeIds,{disableAnimate:!0}),currentZoom<optimizeZoom?this.hiddenEdgeIds.push(...newHiddenEdgeIds):this.hiddenEdgeIds=newHiddenEdgeIds;const newHiddenNodeIds=graph.getAllNodesData().map((node=>node.id)).filter((id=>graph.getItemVisible(id)));let requestId;const sectionNum=Math.ceil(newHiddenNodeIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>newHiddenNodeIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{if(!sections.length)return void cancelAnimationFrame(requestId);const section=sections.shift();graph.startHistoryBatch(),graph.hideItem(section,{disableAnimate:!1,keepKeyShape:!0}),graph.stopHistoryBatch(),requestId=requestAnimationFrame(update)};requestId=requestAnimationFrame(update),currentZoom<optimizeZoom?this.hiddenNodeIds.push(...newHiddenNodeIds):this.hiddenNodeIds=newHiddenNodeIds}}showShapes(){const{graph,hiddenEdgeIds,hiddenNodeIds}=this,currentZoom=graph.getZoom(),{optimizeZoom}=this.options;if(currentZoom<optimizeZoom)return;const{tileBehavior:graphBehaviorOptimize,tileBehaviorSize=1e3}=graph.getSpecification().optimize||{},optimize=this.options.enableOptimize||graphBehaviorOptimize;if(!((0,is_number.A)(optimize)?graph.getAllNodesData().length>optimize:optimize))return void(this.hiddenEdgeIds=this.hiddenNodeIds=[]);let requestId;const hiddenIds=[...hiddenNodeIds,...hiddenEdgeIds],sectionNum=Math.ceil(hiddenIds.length/tileBehaviorSize),sections=Array.from({length:sectionNum},((v,i)=>hiddenIds.slice(i*tileBehaviorSize,i*tileBehaviorSize+tileBehaviorSize))),update=()=>{sections.length?(graph.executeWithNoStack((()=>{graph.showItem(sections.shift(),{disableAnimate:!1})})),requestId=requestAnimationFrame(update)):cancelAnimationFrame(requestId)};requestId=requestAnimationFrame(update),this.hiddenEdgeIds=this.hiddenNodeIds=[]}}const ALLOW_EVENTS=["shift","ctrl","alt","control","meta"];function initZoomKey(zoomKey){const validZoomKeys=(zoomKey?Array.isArray(zoomKey)?zoomKey:[zoomKey]:[]).filter((zoomKey=>{const keyIsValid=ALLOW_EVENTS.includes(zoomKey);return keyIsValid||console.warn(`Invalid zoomKey: ${zoomKey}, please use a valid zoomKey: ${JSON.stringify(ALLOW_EVENTS)}`),keyIsValid}));return 0===validZoomKeys.length&&validZoomKeys.push("ctrl"),validZoomKeys}const MapNodeSize=(data,options={},graphCore)=>{const{dataAdded,dataUpdated,dataRemoved}=data;return{dataAdded:handler(dataAdded||{},options,graphCore),dataUpdated:handler(dataUpdated||{},options,graphCore),dataRemoved}},handler=(data,options={},graphCore)=>{const{field,range=[8,40]}=options;if(!field)return data;const{nodes}=data;if(!nodes)return data;const nodeMap=new Map;let maxValue=-1/0,minValue=1/0;nodes.forEach((n=>{nodeMap.set(n.id,n),maxValue<n.data[field]&&(maxValue=n.data[field]),minValue>n.data[field]&&(minValue=n.data[field])}));return scaleNodeProp(nodes,field,[minValue,maxValue],range).forEach(((val,id)=>{let value=val;!isNaN(val)&&val||(value=range[0]);const node=nodeMap.get(id);node.data.keyShape=Object.assign(Object.assign({},node.data.keyShape),{r:Math.round(value/2),width:value,height:value})})),data},scaleNodeProp=(nodes,field,valueRange,mappedRange)=>{const outLength=mappedRange[1]-mappedRange[0],dataLength=valueRange[1]-valueRange[0],map=new Map;return nodes.forEach((n=>{map.set(n.id,(n.data[field]-valueRange[0])*outLength/dataLength+mappedRange[0])})),map};var transformV4Data_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const TransformV4Data=(data,options={},graphCore)=>{const{dataAdded,dataUpdated,dataRemoved}=data;return{dataAdded:transformV4Data_handler(dataAdded,options,graphCore),dataUpdated:transformV4Data_handler(dataUpdated,options,graphCore),dataRemoved:transformV4Data_handler(dataRemoved,options,graphCore)}},transformV4Data_handler=(data,options={},graphCore)=>{const{nodes=[],edges=[],combos=[]}=data,formattedNodes=nodes.map((node=>{const prevNode=null==graphCore?void 0:graphCore.getNode(node.id),mergedNode=Object.assign(Object.assign({},prevNode),node),{id,type,style,size,color,label,labelCfg={},icon,linkPoints,data={}}=mergedNode,others=transformV4Data_rest(mergedNode,["id","type","style","size","color","label","labelCfg","icon","linkPoints","data"]),anchorShapes=[];if(linkPoints){const{top,bottom,left,right}=linkPoints,otherAnchorShapeStyles=transformV4Data_rest(linkPoints,["top","bottom","left","right"]);Object.keys({top,bottom,left,right}).forEach((key=>{linkPoints[key]&&anchorShapes.push(Object.assign({position:key},otherAnchorShapeStyles))}))}const{style:labelStyle={}}=labelCfg,otherLabelStyle=transformV4Data_rest(labelCfg,["style"]),{background}=labelStyle,newNode={id,data:Object.assign(Object.assign(Object.assign({},others),data),{labelShape:Object.assign(Object.assign(Object.assign({},labelStyle),otherLabelStyle),data.labelShape)})};type&&(newNode.data.type=type.includes("-node")?type:`${type}-node`),style&&(newNode.data.keyShape=style);const nodeSize=formatSize(size);return nodeSize&&(newNode.data.keyShape=Object.assign(Object.assign({},newNode.data.keyShape),{r:null==nodeSize?void 0:nodeSize[0],width:null==nodeSize?void 0:nodeSize[0],height:null==nodeSize?void 0:nodeSize[1]})),color&&(newNode.data.keyShape.fill=color),label&&(newNode.data.labelShape.text=label),(null==icon?void 0:icon.show)&&(newNode.data.icon=icon),anchorShapes.length&&(newNode.data.anchorShapes=anchorShapes),background&&(newNode.data.labelBackgroundShape=background),newNode})),formattedEdges=edges.map((edge=>{const prevEdge=null==graphCore?void 0:graphCore.getEdge(edge.id),mergedEdge=Object.assign(Object.assign({},prevEdge),edge),{id=unique_id(),type,source,target,style,size,color,label,labelCfg={},icon,linkPoints,data={}}=mergedEdge,others=transformV4Data_rest(mergedEdge,["id","type","source","target","style","size","color","label","labelCfg","icon","linkPoints","data"]),{style:labelStyle={}}=labelCfg,otherLabelStyle=transformV4Data_rest(labelCfg,["style"]),{background}=labelStyle,newEdge={id,source,target,data:Object.assign(Object.assign(Object.assign({},others),data),{labelShape:Object.assign(Object.assign(Object.assign({},labelStyle),otherLabelStyle),data.labelShape)})};return type&&(newEdge.data.type=type.includes("-edge")?type:`${type}-edge`),style&&(newEdge.data.keyShape=style),size&&(newEdge.data.keyShape=newEdge.data.keyShape||{},newEdge.data.keyShape.lineWidth=size),color&&(newEdge.data.keyShape=newEdge.data.keyShape||{},newEdge.data.keyShape.stroke=color),label&&(newEdge.data.labelShape.text=label),background&&(newEdge.data.labelBackgroundShape=background),newEdge})),formattedCombos=combos.map((combo=>{const prevCombo=null==graphCore?void 0:graphCore.getNode(combo.id),mergedCombo=Object.assign(Object.assign({},prevCombo),combo),{id,type,style,size,color,label,labelCfg={},icon,linkPoints,data={}}=mergedCombo,others=transformV4Data_rest(mergedCombo,["id","type","style","size","color","label","labelCfg","icon","linkPoints","data"]),{style:labelStyle={}}=labelCfg,otherLabelStyle=transformV4Data_rest(labelCfg,["style"]),{background}=labelStyle,newCombo={id,data:Object.assign(Object.assign(Object.assign({},others),data),{labelShape:Object.assign(Object.assign(Object.assign({},labelStyle),otherLabelStyle),data.labelShape)})};type&&(newCombo.data.type=type.includes("-combo")?type:`${type}-combo`),style&&(newCombo.data.keyShape=style);const comboSize=formatSize(size);return comboSize&&(newCombo.data.keyShape=Object.assign(Object.assign({},newCombo.data.keyShape),{r:null==comboSize?void 0:comboSize[0],width:null==comboSize?void 0:comboSize[0],height:null==comboSize?void 0:comboSize[1]})),color&&(newCombo.data.keyShape=newCombo.data.keyShape||{},newCombo.data.keyShape.fill=color),label&&(newCombo.data.labelShape.text=label),background&&(newCombo.data.labelBackgroundShape=background),newCombo}));return{nodes:formattedNodes||[],edges:formattedEdges||[],combos:formattedCombos||[]}},formatSize=size=>{if(size)return(0,is_number.A)(size)?[size,size]:(0,is_array.A)(size)?size.length>2?[size[0],size[1]]:size:void 0},ValidateData=(data,options={},graphCore)=>{const{dataAdded,dataRemoved,dataUpdated}=data;return{dataAdded:validateData_handler(dataAdded,options,graphCore),dataRemoved,dataUpdated}},validateData_handler=(data,options={},graphCore)=>{const{nodes,edges,combos}=data,idMap=new Map,nodeIdMap=new Map,comboIdMap=new Map,idAndDataCheck=(item,type,generateId=!1)=>{if(void 0===item.id){if(!generateId)return console.error(`Unique global id is neccessary for graph items. The ${type} ${JSON.stringify(item)} without id will be ignored.`),!1;item.id=`${type}-${unique_id()}`}return idMap.has(item.id)?(console.error(`Unique global id is neccessary for graph nodes/edges/combos. The ${type} ${JSON.stringify(item)} with id ${item.id} is duplicated.`),!1):(void 0===item.data&&(item.data={}),!0)},formattedCombos=null==combos?void 0:combos.map((combo=>!!idAndDataCheck(combo,"combo")&&(idMap.set(combo.id,!0),comboIdMap.set(combo.id,!0),combo))).filter(Boolean);null==formattedCombos||formattedCombos.forEach((combo=>{const{parentId}=combo.data;void 0===parentId||comboIdMap.has(parentId)||graphCore&&graphCore.hasNode(parentId)||(console.error(`The parentId of combo with id ${combo.id} will be removed since it is not exist in combos.`),delete combo.data.parentId)}));const formattedNodes=null==nodes?void 0:nodes.map((node=>{if(!idAndDataCheck(node,"node"))return!1;const{parentId}=node.data;return void 0===parentId||comboIdMap.has(parentId)||graphCore&&graphCore.hasNode(parentId)||(console.error(`The parentId of node with id ${node.id} will be removed since it is not exist in combos.`),delete node.data.parentId),idMap.set(node.id,!0),nodeIdMap.set(node.id,!0),node})).filter(Boolean),formattedEdges=null==edges?void 0:edges.map((edge=>{const{id}=edge;let{source,target}=edge;if(!idAndDataCheck(edge,"edge",!0))return!1;if(null==graphCore?void 0:graphCore.hasEdge(id)){const existEdge=null==graphCore?void 0:graphCore.getEdge(id);void 0===source&&(source=existEdge.source),void 0===target&&(target=existEdge.target)}return void 0===source?(console.error(`The edge with id ${id} will be ignored since its source is undefined.`),!1):void 0===target?(console.error(`The edge with id ${id} will be ignored since its target is undefined.`),!1):nodeIdMap.has(source)||comboIdMap.has(source)||graphCore&&graphCore.hasNode(source)?nodeIdMap.has(target)||comboIdMap.has(target)||graphCore&&graphCore.hasNode(target)?(idMap.set(id,!0),edge):(console.error(`The edge with id ${id} will be ignored since its target ${target} is not existed in nodes and combos.`),!1):(console.error(`The edge with id ${id} will be ignored since its source ${source} is not existed in nodes and combos.`),!1)})).filter(Boolean);return{nodes:formattedNodes||[],edges:formattedEdges||[],combos:formattedCombos||[]}};var LOOP_POSITION;!function(LOOP_POSITION){LOOP_POSITION.top="top",LOOP_POSITION["top-right"]="top-right",LOOP_POSITION.right="right",LOOP_POSITION["bottom-right"]="bottom-right",LOOP_POSITION.bottom="bottom",LOOP_POSITION["bottom-left"]="bottom-left",LOOP_POSITION.left="left",LOOP_POSITION["top-left"]="top-left"}(LOOP_POSITION||(LOOP_POSITION={}));const loopPosition=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"],PI_OVER_8=Math.PI/8,radiansMap={[LOOP_POSITION.top]:[-5*PI_OVER_8,-3*PI_OVER_8],[LOOP_POSITION["top-right"]]:[-3*PI_OVER_8,-PI_OVER_8],[LOOP_POSITION.right]:[-PI_OVER_8,PI_OVER_8],[LOOP_POSITION["bottom-right"]]:[PI_OVER_8,3*PI_OVER_8],[LOOP_POSITION.bottom]:[3*PI_OVER_8,5*PI_OVER_8],[LOOP_POSITION["bottom-left"]]:[5*PI_OVER_8,7*PI_OVER_8],[LOOP_POSITION.left]:[7*PI_OVER_8,9*PI_OVER_8],[LOOP_POSITION["top-left"]]:[-7*PI_OVER_8,-5*PI_OVER_8]},getPointOnEllipseAtAngle=(halfOfWidth,halfOfHeight,angleInRadians)=>[halfOfWidth*Math.cos(angleInRadians),halfOfHeight*Math.sin(angleInRadians)],getPointsOnEllipseAtAngles=(halfOfWidth,halfOfHeight,startAngle,endAngle)=>{const[rstartX,rstartY]=getPointOnEllipseAtAngle(halfOfWidth,halfOfHeight,startAngle),[rendX,rendY]=getPointOnEllipseAtAngle(halfOfWidth,halfOfHeight,endAngle);return[rstartX,rstartY,rendX,rendY]},ProcessParallelEdges=(data,options={},graphCore)=>{const{edgeIds=[]}=options,{dataAdded:{edges:edgesAdded=[]}={},dataUpdated:{edges:edgesUpdated=[]}={},dataRemoved:{edges:edgesRemoved=[]}={}}=data,prevEdges=graphCore?graphCore.getAllEdges():[],edgeIdsToAdd=new Set(null==edgesAdded?void 0:edgesAdded.map((edge=>edge.id))),edgeIdsToRemove=new Set(null==edgesRemoved?void 0:edgesRemoved.map((edge=>edge.id))),cacheEdges=uniqBy([...prevEdges,...edgesUpdated],"id");let edges=[...edgesRemoved,...edgesUpdated,...edgesAdded];return edgesUpdated.forEach((newModel=>{const oldModel=null==graphCore?void 0:graphCore.getEdge(newModel.id);if(!oldModel)return;const{id,source,target}=newModel;if(source&&oldModel.source!==source||target&&oldModel.target!==target){const prevParallelEdges=getParallelEdges(graphCore.getEdge(id),cacheEdges);edges=[...prevParallelEdges,...edges]}})),edges.forEach((newModel=>{const newParallelEdges=getParallelEdges(newModel,cacheEdges);edges=[...newParallelEdges,...edges]})),edges=uniqBy(edges.filter((edge=>!edgeIdsToRemove.has(edge.id))),"id"),edgeIds.length>0&&(edges=edges.filter((edge=>edgeIds.includes(edge.id)))),edges=calculateOffset(edges,options),Object.assign(Object.assign({},data),{dataAdded:Object.assign(Object.assign({},data.dataAdded),{edges:edges.filter((edge=>edgeIdsToAdd.has(edge.id)))}),dataUpdated:Object.assign(Object.assign({},data.dataUpdated),{edges:edges.filter((edge=>!edgeIdsToAdd.has(edge.id)))})})},getParallelEdges=(edgeModel,allEdges)=>{const{id,source,target}=edgeModel;return allEdges.filter((edge=>edge.id!==id&&edge.source===source&&edge.target===target||edge.source===target&&edge.target===source))},calculateOffset=(edges,options)=>{var _a;const{offsetDiff=15,multiEdgeType="quadratic-edge",singleEdgeType,loopEdgeType}=options,len=edges.length,cod=2*offsetDiff,edgeMap=new Map,processedEdgesSet=new Set,reverses={};for(let i=0;i<len;i++){if(processedEdgesSet.has(i))continue;const edge=edges[i],{source,target}=edge,sourceTarget=`${source}-${target}`;edgeMap.has(sourceTarget)||edgeMap.set(sourceTarget,[]),edgeMap.get(sourceTarget).push(edge),processedEdgesSet.add(i);for(let j=i+1;j<len;j++){if(processedEdgesSet.has(j))continue;const sedge=edges[j],src=sedge.source,dst=sedge.target;(source===dst&&target===src||source===src&&target===dst)&&(edgeMap.get(sourceTarget).push(sedge),processedEdgesSet.add(j),source===dst&&target===src&&(reverses[`${src}|${dst}|${(null===(_a=edgeMap.get(sourceTarget))||void 0===_a?void 0:_a.length)-1}`]=!0))}}return edgeMap.forEach(((arcEdges,key)=>{var _a,_b;const{length}=arcEdges;for(let k=0;k<length;k++){const current=arcEdges[k];if(current.data||(current.data={}),current.source===current.target)loopEdgeType&&(current.data.type=loopEdgeType),(_a=current.data).keyShape||(_a.keyShape={}),current.data.keyShape.loopCfg={position:loopPosition[k%8],dist:20*Math.floor(k/8)+50};else if(1===length)singleEdgeType&&(current.data.type=singleEdgeType);else{current.data.type=multiEdgeType;const sign=(k%2==0?1:-1)*(reverses[`${current.source}|${current.target}|${k}`]?-1:1);(_b=current.data).keyShape||(_b.keyShape={}),current.data.keyShape.curveOffset=length%2==1?sign*Math.ceil(k/2)*cod:sign*(Math.floor(k/2)*cod+offsetDiff)}}})),edges};var math=__webpack_require__("./node_modules/@antv/layout/lib/util/math.js");const getWordWrapWidthByBox=(keyShapeBox,maxWidth,zoom=1,enableBalanceShape=!1)=>{const balanceZoom=enableBalanceShape?zoom:1,keyShapeWidth=(keyShapeBox.max[0]-keyShapeBox.min[0])*balanceZoom;return getWordWrapWidthWithBase(keyShapeWidth,maxWidth)},getWordWrapWidthByEnds=(points,maxWidth,zoom=1)=>{const dist=(0,math.Yc)(points[0],points[1])*zoom;return getWordWrapWidthWithBase(dist,maxWidth)},getWordWrapWidthWithBase=(length,maxWidth)=>{let wordWrapWidth=2*length;return"string"==typeof maxWidth?wordWrapWidth=length*Number(maxWidth.replace("%",""))/100:"number"==typeof maxWidth&&(wordWrapWidth=maxWidth),isNaN(wordWrapWidth)&&(wordWrapWidth=2*length),wordWrapWidth},isEncode=value=>Boolean((null==value?void 0:value.fields)&&value.formatter);var _BaseNode_instances,_BaseNode_zoomCache,_BaseNode_getAnchorPosition,__classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)},base_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class BaseNode{constructor(props){_BaseNode_instances.add(this),_BaseNode_zoomCache.set(this,{zoom:1,wordWrapWidth:32}),this.onZoom=(shapeMap,zoom,cacheHiddenShape={})=>{};const{graph,themeStyles,lodLevels,enableBalanceShape,zoom}=props;themeStyles&&(this.themeStyles=themeStyles),this.graph=graph,this.lodLevels=lodLevels,this.enableBalanceShape=enableBalanceShape,__classPrivateFieldGet(this,_BaseNode_zoomCache,"f").zoom=zoom}mergeStyles(model){this.mergedStyles=this.getMergedStyles(model)}getMergedStyles(model){var _a;const{data}=model,dataStyles={};Object.keys(data).forEach((fieldName=>{RESERVED_SHAPE_IDS.includes(fieldName)?"badgeShapes"===fieldName?(dataStyles[fieldName]={},Object.keys(data[fieldName]).forEach((key=>{if(isNaN(Number(key)))return void(dataStyles[fieldName][key]=data[fieldName][key]);const{position}=data[fieldName][key];dataStyles[`${position}BadgeShape`]=Object.assign(Object.assign(Object.assign({},this.themeStyles[fieldName]),data[fieldName][key]),{tag:"badgeShape"})}))):"anchorShapes"===fieldName?Object.keys(data[fieldName]).forEach((idx=>{dataStyles[`anchorShape${idx}`]=Object.assign(Object.assign(Object.assign({},this.themeStyles[fieldName]),data[fieldName][idx]),{tag:"anchorShape"})})):dataStyles[fieldName]=data[fieldName]:"otherShapes"===fieldName&&Object.keys(data[fieldName]).forEach((otherShapeId=>dataStyles[otherShapeId]=data[fieldName][otherShapeId]))}));const merged=mergeStyles([this.themeStyles,this.defaultStyles,dataStyles]),padding=null===(_a=merged.labelBackgroundShape)||void 0===_a?void 0:_a.padding;return padding&&(merged.labelBackgroundShape.padding=formatPadding(padding)),merged}updateCache(shapeMap){if(shapeMap.labelShape){const{maxWidth="200%"}=this.mergedStyles.labelShape||{};__classPrivateFieldGet(this,_BaseNode_zoomCache,"f").wordWrapWidth=getWordWrapWidthByBox(shapeMap.keyShape.getLocalBounds(),maxWidth,1)}}afterDraw(model,shapeMap,diffData,diffState){return{}}drawLabelShape(model,shapeMap,diffData,diffState){const{labelShape:shapeStyle}=this.mergedStyles;if(!shapeStyle||!shapeStyle.text||!model.data.labelShape)return;const{keyShape}=shapeMap,keyShapeBox=getShapeLocalBoundsByStyle(keyShape,this.mergedStyles.keyShape,keyShape.getLocalBounds()),{position,offsetX:propsOffsetX,offsetY:propsOffsetY,offsetZ:propsOffsetZ,maxWidth,angle}=shapeStyle,otherStyle=base_rest(shapeStyle,["position","offsetX","offsetY","offsetZ","maxWidth","angle"]),wordWrapWidth=getWordWrapWidthByBox(keyShapeBox,maxWidth,__classPrivateFieldGet(this,_BaseNode_zoomCache,"f").zoom,this.enableBalanceShape),positionPreset={x:keyShapeBox.center[0],y:keyShapeBox.max[1],z:keyShapeBox.center[2],textBaseline:"top",textAlign:"center",offsetX:0,offsetY:0,offsetZ:0,wordWrapWidth};switch(position){case"center":positionPreset.y=keyShapeBox.center[1],positionPreset.textBaseline="middle";break;case"top":positionPreset.y=keyShapeBox.min[1],positionPreset.textBaseline="bottom",positionPreset.offsetY=-2;break;case"left":positionPreset.x=keyShapeBox.min[0],positionPreset.y=keyShapeBox.center[1],positionPreset.textAlign="right",positionPreset.textBaseline="middle",positionPreset.offsetX=-4;break;case"right":positionPreset.x=keyShapeBox.max[0],positionPreset.y=keyShapeBox.center[1],positionPreset.textAlign="left",positionPreset.textBaseline="middle",positionPreset.offsetX=4;break;default:positionPreset.offsetY=2}const offsetX=void 0===propsOffsetX?positionPreset.offsetX:propsOffsetX,offsetY=void 0===propsOffsetY?positionPreset.offsetY:propsOffsetY,offsetZ=void 0===propsOffsetZ?positionPreset.offsetZ:propsOffsetZ;positionPreset.x+=offsetX,positionPreset.y+=offsetY,positionPreset.z+=offsetZ;const style=Object.assign(Object.assign(Object.assign(Object.assign({},this.defaultStyles.labelShape),positionPreset),{isBillboard:!0}),otherStyle);return angle&&(style.transform=`rotate(${angle}rad)`),this.upsertShape("text","labelShape",style,{model,shapeMap,diffData,diffState})}drawLabelBackgroundShape(model,shapeMap,diffData,diffState){const{labelShape}=shapeMap;if(!labelShape||!labelShape.style.text||!model.data.labelShape)return;const textBBoxGeo=labelShape.getGeometryBounds(),height=textBBoxGeo.max[1]-textBBoxGeo.min[1],width=Math.min(textBBoxGeo.max[0]-textBBoxGeo.min[0]+2,labelShape.attributes.wordWrapWidth),_a=this.mergedStyles.labelBackgroundShape,{padding}=_a,backgroundStyle=base_rest(_a,["padding"]),bgStyle=Object.assign(Object.assign({fill:"#fff"},backgroundStyle),{x:labelShape.attributes.x+textBBoxGeo.min[0]-padding[3],y:labelShape.attributes.y+textBBoxGeo.min[1]-padding[0],width:width+padding[1]+padding[3],height:height+padding[0]+padding[2]});return this.upsertShape("rect","labelBackgroundShape",bgStyle,{model,shapeMap,diffData,diffState})}drawIconShape(model,shapeMap,diffData,diffState){const{iconShape:shapeStyle}=this.mergedStyles,{width,height,fontSize,text,offsetX=0,offsetY=0}=shapeStyle,w=width||fontSize,h=height||fontSize,iconShapeType=text?"text":"image";return"image"===iconShapeType?(shapeStyle.x=-w/2+offsetX,shapeStyle.y=-h/2+offsetY,shapeStyle.width=w,shapeStyle.height=h):(shapeStyle.textAlign="center",shapeStyle.textBaseline="middle",shapeStyle.x=offsetX,shapeStyle.y=offsetY,shapeStyle.fontSize=w),this.upsertShape(iconShapeType,"iconShape",shapeStyle,{shapeMap,model,diffData,diffState})}drawHaloShape(model,shapeMap,diffData,diffState){const{keyShape}=shapeMap,{haloShape:haloShapeStyle,keyShape:keyShapeStyle}=this.mergedStyles;if(!1===haloShapeStyle.visible)return;const{nodeName,attributes}=keyShape,{x,y,fill}=attributes,s=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},attributes),keyShapeStyle),{x,y,stroke:fill}),haloShapeStyle),{batchKey:"halo"});delete s.fillOpacity;return this.upsertShape(nodeName,"haloShape",s,{model,shapeMap,diffData,diffState})}drawAnchorShapes(model,shapeMap,diffData,diffState){const{anchorShapes:commonStyle,keyShape:keyShapeStyle}=this.mergedStyles,individualConfigs=Object.values(this.mergedStyles).filter((style=>"anchorShape"===style.tag));if(!individualConfigs.length)return;const shapes={},anchorPositionMap=this.calculateAnchorPosition(keyShapeStyle);return individualConfigs.forEach(((config,i)=>{const{position,fill=keyShapeStyle.fill}=config,style=base_rest(config,["position","fill"]),[cx,cy]=__classPrivateFieldGet(this,_BaseNode_instances,"m",_BaseNode_getAnchorPosition).call(this,position,anchorPositionMap,shapeMap),id=`anchorShape${i}`;shapes[id]=this.upsertShape("circle",id,Object.assign(Object.assign({cx,cy,fill},commonStyle),style),{shapeMap,model,diffData,diffState})})),shapes}calculateAnchorPosition(keyShapeStyle){const x=keyShapeStyle.x,y=keyShapeStyle.y,r=keyShapeStyle.r,anchorPositionMap={};return anchorPositionMap.top=[x,y-r],anchorPositionMap.left=[x-r,y],anchorPositionMap.right=anchorPositionMap.default=[x+r,y],anchorPositionMap.bottom=[x,y+r],anchorPositionMap}drawBadgeShapes(model,shapeMap,diffData,diffState){const{badgeShapes:commonStyle,keyShape:keyShapeStyle}=this.mergedStyles,individualConfigs=Object.values(this.mergedStyles).filter((style=>"badgeShape"===style.tag));if(!individualConfigs.length)return{};const keyShapeBBox=getShapeLocalBoundsByStyle(shapeMap.keyShape,keyShapeStyle,shapeMap.keyShape.getLocalBounds()),keyShapeSize=Math.min(keyShapeBBox.max[0]-keyShapeBBox.min[0],keyShapeBBox.max[1]-keyShapeBBox.min[1]),shapes={};return individualConfigs.forEach(((config,i)=>{const{position}=config,individualStyle=base_rest(config,["position"]),id=`${position}BadgeShape`,style=Object.assign(Object.assign({},commonStyle),individualStyle),colorFromPalette=commonStyle.palette?commonStyle.palette[i%commonStyle.palette.length]:"#7E92B5",{text="",type,color=colorFromPalette,size=keyShapeSize/3,textColor,zIndex=2,offsetX=0,offsetY=0}=style,otherStyles=base_rest(style,["text","type","color","size","textColor","zIndex","offsetX","offsetY"]),bgHeight=size,pos={x:0,y:0};switch(position){case"rightTop":case"topRight":pos.x=keyShapeBBox.max[0]/2+offsetX,pos.y=.44*keyShapeBBox.min[1]-bgHeight+offsetY;break;case"right":pos.x=keyShapeBBox.max[0]/2+offsetX,pos.y=-bgHeight/2+offsetY;break;case"rightBottom":case"bottomRight":pos.x=keyShapeBBox.max[0]/2+offsetX,pos.y=.44*keyShapeBBox.max[1]+offsetY;break;case"leftTop":case"topLeft":pos.x=keyShapeBBox.min[0]/2+offsetX,pos.y=.44*keyShapeBBox.min[1]-bgHeight+offsetY;break;case"left":pos.x=keyShapeBBox.min[0]/2+offsetX,pos.y=-bgHeight/2+offsetY;break;case"leftBottom":case"bottomLeft":pos.x=keyShapeBBox.min[0]/2+offsetX,pos.y=.44*keyShapeBBox.max[1]+offsetY;break;case"top":pos.x=offsetX,pos.y=.44*keyShapeBBox.min[1]-bgHeight+offsetY;break;default:pos.x=offsetX,pos.y=.44*keyShapeBBox.max[1]+offsetY}const positionLowerCase=position.toLowerCase(),isLeft=positionLowerCase.includes("left"),isCenter=!isLeft&&!positionLowerCase.includes("right"),fontSize=bgHeight-3;let textAlign=isLeft?"right":"left",textX=isLeft?pos.x-3:pos.x+2;isCenter&&(textAlign="center",textX=pos.x),shapes[id]=this.upsertShape("text",id,Object.assign(Object.assign({text,fill:textColor,fontSize,x:textX,y:pos.y+bgHeight/2},otherStyles),{textAlign,textBaseline:"middle",zIndex:zIndex+1}),{shapeMap,model,diffData,diffState});const bbox=shapes[id].getLocalBounds(),bgShapeId=`${position}BadgeBackgroundShape`,bgWidth=text.length<=1?bgHeight:Math.max(bgHeight,bbox.max[0]-bbox.min[0])+8;shapes[bgShapeId]=this.upsertShape("rect",bgShapeId,Object.assign({text,fill:color,height:bgHeight,width:bgWidth,radius:bgHeight/2,zIndex,x:bbox.center[0]-bgWidth/2,y:bbox.center[1]-bgHeight/2},otherStyles),{shapeMap,model,diffData,diffState})})),shapes}drawOtherShapes(model,shapeMap,diffData,diffState){return{}}upsertShape(type,id,style,config){return upsertShape(type,id,style,config)}}_BaseNode_zoomCache=new WeakMap,_BaseNode_instances=new WeakSet,_BaseNode_getAnchorPosition=function _BaseNode_getAnchorPosition(position,anchorPositionMap,shapeMap){const keyShapeBBox=shapeMap.keyShape.getLocalBounds(),keyShapeWidth=keyShapeBBox.max[0]-keyShapeBBox.min[0],keyShapeHeight=keyShapeBBox.max[1]-keyShapeBBox.min[1],defaultPosition=[keyShapeBBox.max[0]-keyShapeBBox.center[0],keyShapeBBox.min[1]-keyShapeBBox.center[1]];return position instanceof Array?[keyShapeWidth*(position[0]-.5),keyShapeHeight*(position[1]-.5)]:"string"==typeof position?anchorPositionMap[position=position.toLowerCase()]||anchorPositionMap.default||defaultPosition:anchorPositionMap.default||defaultPosition};class CircleCombo extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{r:16,x:0,y:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("circle","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}}class RectCombo extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{x:0,y:0,width:32,height:32}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("rect","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}getMergedStyles(model){const merged=super.getMergedStyles(model);return merged.keyShape.x=merged.keyShape.x-merged.keyShape.width/2,merged.keyShape.y=merged.keyShape.y-merged.keyShape.height/2,merged}}class CircleNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{r:16,x:0,y:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&this.drawLabelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&this.drawLabelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes&&this.drawAnchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&this.drawIconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes&&this.drawBadgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("circle","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}}var shape3d_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const GeometryTagMap={sphere:SphereGeometry,cube:CubeGeometry,plane:PlaneGeometry},createShape3D=(type,style,id,device)=>{if(!GeometryTagMap[type])return createShape(type,style,id);const _a=style,{materialType="lambert",materialProps={}}=_a,otherStyles=shape3d_rest(_a,["materialType","materialProps"]);device.GeometryCache||(device.GeometryCache={});let cachedGeometry=device.GeometryCache[type];if(cachedGeometry||(cachedGeometry=device.GeometryCache[type]=new GeometryTagMap[type](device,{radius:10,latitudeBands:32,longitudeBands:32})),device.MaterialCache||(device.MaterialCache={}),!device.MaterialCache[materialType])switch(materialType){case"basic":device.MaterialCache[materialType]=new MeshBasicMaterial(device,materialProps);break;case"phong":device.MaterialCache[materialType]=new MeshPhongMaterial(device,Object.assign({shininess:30},materialProps));default:device.MaterialCache[materialType]=new MeshLambertMaterial(device,materialProps)}const shape=new Mesh({style:Object.assign(Object.assign({visibility:"visible",strokeOpacity:0},otherStyles),{geometry:cachedGeometry,material:device.MaterialCache[materialType]}),id});switch(shape.setOrigin(0,0,0),type){case"cube":shape.scale([style.width/10,style.height/10,style.depth/10]);break;case"plane":shape.scale(style.width/10,1,style.depth/10);break;default:{const scaling=(style.r||style.radius)/10;shape.scale(scaling)}}return shape};var base3d_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class BaseNode3D extends BaseNode{constructor(props){super(props),this.dimensions=3,this.onZoom=(shapeMap,zoom)=>{},this.device=props.device}drawLabelShape(model,shapeMap,diffData,diffState){const{keyShape}=shapeMap,{r,width,height,depth,x,y,z}=keyShape.attributes,keyShapeBox={center:[x,y,z],min:[x-r||width/2,y-r||height/2,z-r||depth/2],max:[x+r||width/2,y+r||height/2,z+r||depth/2]},{labelShape:shapeStyle}=this.mergedStyles,{position,offsetX:propsOffsetX,offsetY:propsOffsetY,maxWidth}=shapeStyle,otherStyle=base3d_rest(shapeStyle,["position","offsetX","offsetY","maxWidth"]),positionPreset={x:keyShapeBox.center[0],y:keyShapeBox.max[1],z:keyShapeBox.center[2],textBaseline:"top",textAlign:"center",offsetX:0,offsetY:0};switch(position){case"top":positionPreset.y=keyShapeBox.min[1],positionPreset.textBaseline="bottom",positionPreset.offsetY=-4;break;case"left":positionPreset.x=keyShapeBox.min[0],positionPreset.y=keyShapeBox.center[1],positionPreset.textAlign="right",positionPreset.textBaseline="middle",positionPreset.offsetX=-8;break;case"right":positionPreset.x=keyShapeBox.max[0],positionPreset.y=keyShapeBox.center[1],positionPreset.textAlign="left",positionPreset.textBaseline="middle",positionPreset.offsetX=8;break;default:positionPreset.offsetY=4}const offsetX=void 0===propsOffsetX?positionPreset.offsetX:propsOffsetX,offsetY=void 0===propsOffsetY?positionPreset.offsetY:propsOffsetY;positionPreset.x+=offsetX,positionPreset.y+=offsetY;const style=Object.assign(Object.assign(Object.assign(Object.assign({},this.defaultStyles.labelShape),positionPreset),{isBillboard:!0}),otherStyle);return this.upsertShape("text","labelShape",style,{model,shapeMap,diffData,diffState})}drawIconShape(model,shapeMap,diffData,diffState){return super.drawIconShape(model,shapeMap,diffData,diffState)}drawHaloShape(model,shapeMap,diffData,diffState){const{keyShape}=shapeMap,{haloShape:haloShapeStyle}=this.mergedStyles;if(!1===haloShapeStyle.visible)return;const{nodeName,attributes}=keyShape;return this.upsertShape(nodeName,"haloShape",Object.assign(Object.assign(Object.assign({},attributes),{stroke:attributes.fill}),haloShapeStyle),{model,shapeMap,diffData,diffState})}drawAnchorShapes(model,shapeMap,diffData,diffState){return{}}drawBadgeShapes(model,shapeMap,diffData,diffState){return super.drawBadgeShapes(model,shapeMap,diffData,diffState)}drawOtherShapes(model,shapeMap,diffData,diffState){return{}}upsertShape(type,id,style,config){const{shapeMap}=config;return((type,id,style,shapeMap,device)=>{let shape=shapeMap[id];if(shape)if(shape.nodeName!==type)shape.remove(),shape=createShape3D(type,style,id,device);else{const updateStyles={},oldStyles=shape.attributes;Object.keys(style).forEach((key=>{oldStyles[key]!==style[key]&&(updateStyles[key]=style[key],shape.style[key]=style[key])}))}else shape=createShape3D(type,style,id,device);return shapeMap[id]=shape,shape})(type,id,style,shapeMap,this.device)}}class SphereNode extends BaseNode3D{constructor(props){super(props),this.defaultStyles={keyShape:{r:5,latitudeBands:32,longitudeBands:32,x:0,y:0,z:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("sphere","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}}class RectNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{x:0,y:0,width:32,height:32}}}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("rect","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{x:this.mergedStyles.keyShape.x-this.mergedStyles.keyShape.width/2,y:this.mergedStyles.keyShape.y-this.mergedStyles.keyShape.height/2}),{model,shapeMap,diffData,diffState})}calculateAnchorPosition(keyShapeStyle){const x=keyShapeStyle.x,y=keyShapeStyle.y,height=keyShapeStyle.height,width=keyShapeStyle.width,anchorPositionMap={};return anchorPositionMap.top=[x,y-height/2],anchorPositionMap.left=[x-width/2,y],anchorPositionMap.right=anchorPositionMap.default=[x+width/2,y],anchorPositionMap.bottom=[x,y+height/2],anchorPositionMap}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}}class StarNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{outerR:20,x:0,y:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,path=this.getStarPath(keyShapeStyle.outerR,keyShapeStyle.innerR);return this.upsertShape("path","keyShape",Object.assign(Object.assign({},keyShapeStyle),{path}),{model,shapeMap,diffData,diffState})}getStarPath(outerR,innerR){return innerR||(innerR=3*outerR/8),[["M",0,-outerR],["L",innerR*Math.cos(3*Math.PI/10),-innerR*Math.sin(3*Math.PI/10)],["L",outerR*Math.cos(Math.PI/10),-outerR*Math.sin(Math.PI/10)],["L",innerR*Math.cos(Math.PI/10),innerR*Math.sin(Math.PI/10)],["L",outerR*Math.cos(3*Math.PI/10),outerR*Math.sin(3*Math.PI/10)],["L",0,innerR],["L",-outerR*Math.cos(3*Math.PI/10),outerR*Math.sin(3*Math.PI/10)],["L",-innerR*Math.cos(Math.PI/10),innerR*Math.sin(Math.PI/10)],["L",-outerR*Math.cos(Math.PI/10),-outerR*Math.sin(Math.PI/10)],["L",-innerR*Math.cos(3*Math.PI/10),-innerR*Math.sin(3*Math.PI/10)],"Z"]}calculateAnchorPosition(keyShapeStyle){const anchorPositionMap={},outerR=keyShapeStyle.outerR,innerR=keyShapeStyle.innerR;return anchorPositionMap.top=[0,-outerR],anchorPositionMap.left=[-outerR*Math.cos(Math.PI/10),-outerR*Math.sin(Math.PI/10)],anchorPositionMap.leftbottom=[-outerR*Math.cos(3*Math.PI/10),outerR*Math.sin(3*Math.PI/10)],anchorPositionMap.bottom=[0,innerR],anchorPositionMap.rightbottom=[outerR*Math.cos(3*Math.PI/10),outerR*Math.sin(3*Math.PI/10)],anchorPositionMap.right=anchorPositionMap.default=[outerR*Math.cos(Math.PI/10),-outerR*Math.sin(Math.PI/10)],anchorPositionMap}}const offsetAngleMap={horizontal:0,vertical:Math.PI/2};class HexagonNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{r:16,x:0,y:0,direction:"vertical"}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles;return this.upsertShape("polygon","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{points:this.getHexagonPoints(keyShapeStyle.r,keyShapeStyle.direction)}),{model,shapeMap,diffData,diffState})}getHexagonPoints(r,direction){const angleIncrement=Math.PI/3,v=[];for(let i=0;i<6;i++){const angle=i*angleIncrement+offsetAngleMap[direction],vx=r*Math.cos(angle),vy=r*Math.sin(angle);v.push([vx,vy])}return v}calculateAnchorPosition(keyShapeStyle){const anchorPositionDirection="horizontal"===keyShapeStyle.direction?["right","rightbottom","leftbottom","left","lefttop","righttop"]:["bottom","leftbottom","lefttop","top","righttop","rightbottom"],angleIncrement=Math.PI/3,offsetAngle=offsetAngleMap[keyShapeStyle.direction],r=keyShapeStyle.r,anchorPositionMap={};for(let i=0;i<6;i++){const angle=i*angleIncrement+offsetAngle,vx=r*Math.cos(angle),vy=r*Math.sin(angle);anchorPositionMap[anchorPositionDirection[i]]=[vx,vy]}return anchorPositionMap.hasOwnProperty("default")||(anchorPositionMap.default=anchorPositionMap[anchorPositionDirection[0]]),anchorPositionMap}}class TriangleNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{r:12,x:0,y:0,direction:"up"}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles;return this.upsertShape("path","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{path:this.getTrianglePath(keyShapeStyle.r,keyShapeStyle.direction)}),{model,shapeMap,diffData,diffState})}getTrianglePath(r,direction){const halfHeight=3*r/2,halfLength=3*r/Math.sin(1/3*Math.PI)/2;let path;return path="down"===direction?[["M",0,halfHeight],["L",halfLength,-halfHeight],["L",-halfLength,-halfHeight],["Z"]]:"left"===direction?[["M",-halfHeight,0],["L",halfHeight,halfLength],["L",halfHeight,-halfLength],["Z"]]:"right"===direction?[["M",halfHeight,0],["L",-halfHeight,halfLength],["L",-halfHeight,-halfLength],["Z"]]:[["M",0,-halfHeight],["L",halfLength,halfHeight],["L",-halfLength,halfHeight],["Z"]],path}drawIconShape(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,{iconShape:shapeStyle}=this.mergedStyles;let defaultOffsetX=0,defaultOffsetY=keyShapeStyle.r/4;"right"===keyShapeStyle.direction?(defaultOffsetX=-keyShapeStyle.r/4,defaultOffsetY=0):"left"===keyShapeStyle.direction?(defaultOffsetX=keyShapeStyle.r/4,defaultOffsetY=0):"down"===keyShapeStyle.direction&&(defaultOffsetX=0,defaultOffsetY=-keyShapeStyle.r/4);const{width,height,fontSize,text,offsetX=0,offsetY=0}=shapeStyle,w=width||fontSize,h=height||fontSize,iconShapeType=text?"text":"image";return"image"===iconShapeType?(shapeStyle.x=-w/2+offsetX+defaultOffsetX,shapeStyle.y=-h/2+offsetY+defaultOffsetY,shapeStyle.width=w,shapeStyle.height=h):(shapeStyle.textAlign="center",shapeStyle.textBaseline="middle",shapeStyle.x=offsetX+defaultOffsetX,shapeStyle.y=offsetY+defaultOffsetY,shapeStyle.fontSize=w),this.upsertShape(iconShapeType,"iconShape",shapeStyle,{model,shapeMap,diffData,diffState})}calculateAnchorPosition(keyShapeStyle){const direction=keyShapeStyle.direction,r=keyShapeStyle.r,halfHeight=3*r/2,halfLength=3*r/Math.sin(1/3*Math.PI)/2,anchorPositionMap={};return"down"===direction?(anchorPositionMap.bottom=[0,halfHeight],anchorPositionMap.right=anchorPositionMap.default=[halfLength,-halfHeight],anchorPositionMap.left=[-halfLength,-halfHeight]):"left"===direction?(anchorPositionMap.top=[halfHeight,-halfLength],anchorPositionMap.bottom=[halfHeight,halfLength],anchorPositionMap.left=anchorPositionMap.default=[-halfHeight,0]):"right"===direction?(anchorPositionMap.top=[-halfHeight,-halfLength],anchorPositionMap.bottom=[-halfHeight,halfLength],anchorPositionMap.right=anchorPositionMap.default=[halfHeight,0]):(anchorPositionMap.left=[-halfLength,halfHeight],anchorPositionMap.top=anchorPositionMap.default=[0,-halfHeight],anchorPositionMap.right=[halfLength,halfHeight]),anchorPositionMap}}class EllipseNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{rx:16,ry:12,x:0,y:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("ellipse","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}calculateAnchorPosition(keyShapeStyle){const x=keyShapeStyle.x,y=keyShapeStyle.y,anchorPositionMap={};return anchorPositionMap.top=[x,y-keyShapeStyle.ry],anchorPositionMap.left=[x-keyShapeStyle.rx,y],anchorPositionMap.right=anchorPositionMap.default=[x+keyShapeStyle.rx,y],anchorPositionMap.bottom=[x,y+keyShapeStyle.ry],anchorPositionMap}}const defaultDonutPalette=["#61DDAA","#65789B","#F6BD16","#7262FD","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"];class DonutNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{r:16,x:0,y:0},donutShapes:{innerSize:.6,attrs:{},colorMap:{},zIndex:1}},this.drawDonutSegment=(cfg,shapes,model,shapeMap,diffData,diffState)=>{const{arcR,beginAngle,config,index,lineWidth,zIndex,totalValue,drawWhole=!1}=cfg,id=`donutShape${index}`,percent=config.value/totalValue;if(percent<.001)return{beginAngle,shouldEnd:!1};let arcEnd,endAngle,isLargeArc;const arcBegin=calculateArcEndpoint(arcR,beginAngle);if(drawWhole||percent>.999)arcEnd=[arcR,1e-4],isLargeArc=1;else{const angle=percent*Math.PI*2;endAngle=beginAngle+angle,arcEnd=calculateArcEndpoint(arcR,endAngle),isLargeArc=angle>Math.PI?1:0}const style={path:[["M",arcBegin[0],arcBegin[1]],["A",arcR,arcR,0,isLargeArc,0,arcEnd[0],arcEnd[1]]],stroke:config.color||defaultDonutPalette[index%defaultDonutPalette.length],lineWidth,zIndex};return shapes[id]=this.upsertShape("path",id,style,{model,shapeMap,diffData,diffState}),{beginAngle:endAngle,shouldEnd:drawWhole||percent>.999}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}if(data.donutShapes){const donutShapes=this.drawDonutShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),donutShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawDonutShapes(model,shapeMap,diffData,diffState){const{donutShapes:{innerSize,attrs,colorMap,zIndex}}=this.mergedStyles,attrNum=Object.keys(attrs).length;if(!attrNum)return;const{configs,totalValue}=getDonutConfig(attrs,colorMap);if(!totalValue)return;const{lineWidth,arcR}=getDonutSize(shapeMap.keyShape,innerSize);let beginAngle=0;const shapes={};return lodash_each(configs,((config,index)=>{const result=this.drawDonutSegment({arcR,beginAngle,config,index,lineWidth,zIndex,totalValue,drawWhole:1===attrNum},shapes,model,shapeMap,diffData,diffState);result.shouldEnd||(beginAngle=result.beginAngle)})),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("circle","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}}const calculateArcEndpoint=(arcR,angle)=>[arcR*Math.cos(angle),-arcR*Math.sin(angle)],getDonutConfig=(donutAttrs,donutColorMap)=>{let totalValue=0;const configs=[];return Object.keys(donutAttrs).forEach((name=>{const value=+donutAttrs[name];isNaN(value)||(configs.push({key:name,value,color:donutColorMap[name]}),totalValue+=value)})),{totalValue,configs}},getDonutSize=(keyShape,innerSize)=>{const keyShapeR=keyShape.attr("r"),innerR=innerSize*keyShapeR;return{lineWidth:keyShapeR-innerR,arcR:(keyShapeR+innerR)/2}};class DiamondNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{size:[32,32],x:0,y:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles;return this.upsertShape("path","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{path:this.getDiamondPath(keyShapeStyle)}),{model,shapeMap,diffData,diffState})}getDiamondPath(keyShapeStyle){const{size}=keyShapeStyle,sizeArr=Array.isArray(size)?size:[size,size],width=sizeArr[0],height=sizeArr[1];return[["M",0,-height/2],["L",width/2,0],["L",0,height/2],["L",-width/2,0],["Z"]]}calculateAnchorPosition(keyShapeStyle){const anchorPositionMap={},{size}=keyShapeStyle,sizeArr=Array.isArray(size)?size:[size,size],width=sizeArr[0],height=sizeArr[1];return anchorPositionMap.bottom=[0,height/2],anchorPositionMap.left=[-width/2,0],anchorPositionMap.right=anchorPositionMap.default=[width/2,0],anchorPositionMap.top=[0,-height/2],anchorPositionMap}}var modelRect_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class ModelRectNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{x:0,y:0,width:185,height:70,stroke:"#69c0ff",fill:"#ffffff",lineWidth:1,radius:5},preRect:{show:!0,width:5,fill:"#69c0ff",radius:5},logoIcon:{show:!0,width:16,height:16,offsetX:0,offsetY:0,img:"https://gw.alipayobjects.com/zos/basement_prod/4f81893c-1806-4de4-aff3-9a6b266bc8a2.svg"},stateIcon:{show:!0,width:16,height:16,offsetX:0,offsetY:0,img:"https://gw.alipayobjects.com/zos/basement_prod/300a2523-67e0-4cbf-9d4a-67c077b40395.svg"},description:{show:!0,maxLines:1,textOverflow:"ellipsis",fill:"#C2C2C2",textBaseline:"middle",textAlign:"left",offsetX:0,offsetY:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}return data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),shapes}drawKeyShape(model,shapeMap,diffData,diffState){const{x,y,height,width}=this.mergedStyles.keyShape;return this.upsertShape("rect","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{x:x-width/2,y:y-height/2}),{model,shapeMap,diffData,diffState})}calculateAnchorPosition(keyShapeStyle){const x=keyShapeStyle.x,y=keyShapeStyle.y,{height,width}=keyShapeStyle,anchorPositionMap={};return anchorPositionMap.top=[x,y-height/2],anchorPositionMap.left=[x-width/2,y],anchorPositionMap.right=anchorPositionMap.default=[x+width/2,y],anchorPositionMap.bottom=[x,y+height/2],anchorPositionMap}drawLabelShape(model,shapeMap,diffData,diffState){var _a;const{labelShape:labelShapeStyle,description:descriptionStyle,keyShape:keyShapeStyle}=this.mergedStyles;if(!labelShapeStyle)return;const{width,height,x,y}=keyShapeStyle,{offsetX:labelOffsetX=0,offsetY:labelOffsetY=0}=labelShapeStyle,mixDisplay=descriptionStyle.show,defaultLabelFontSize=mixDisplay?Math.min(height,width)/4:Math.min(height,width)/6,logoIconBBox=null===(_a=shapeMap.logoIcon)||void 0===_a?void 0:_a.getBBox(),defaultLabelX=mixDisplay?-width/2+(null==logoIconBBox?void 0:logoIconBBox.width)+width/10:0,defaultLabelY=mixDisplay?0-height/7:0,defaultWordWrapWidth=width/2-(logoIconBBox.left+logoIconBBox.width+width/20)-2*defaultLabelFontSize-labelOffsetX;return labelShapeStyle.maxWidth=defaultWordWrapWidth,this.upsertShape("text","labelShape",Object.assign({x:defaultLabelX+labelOffsetX,y:defaultLabelY+labelOffsetY,wordWrap:!0,textOverflow:"ellipsis",textBaseline:"middle",textAlign:mixDisplay?"left":"middle",maxLines:1,wordWrapWidth:defaultWordWrapWidth},labelShapeStyle),{model,shapeMap,diffData,diffState})}drawOtherShapes(model,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle,label:labelStyle,preRect:preRectStyle,logoIcon:logoIconStyle,stateIcon:stateIconStyle,description:descriptionStyle}=this.mergedStyles;return{preRect:this.drawPreRectShape(preRectStyle,keyShapeStyle,model,shapeMap,diffData,diffState),logoIcon:this.drawLogoIconShape(logoIconStyle,keyShapeStyle,model,shapeMap,diffData,diffState),description:this.drawDescriptionShape(descriptionStyle,keyShapeStyle,model,shapeMap,diffData,diffState),stateIcon:this.drawStateIcon(stateIconStyle,keyShapeStyle,model,shapeMap,diffData,diffState)}}drawPreRectShape(preRectStyle,keyShapeStyle,model,shapeMap,diffData,diffState){if(!preRectStyle||!preRectStyle.show)return;const{x,y,height,width}=keyShapeStyle,{width:preRectWidth}=preRectStyle,restPreRectStyle=modelRect_rest(preRectStyle,["width"]);return this.upsertShape("rect","preRect",Object.assign({width:preRectWidth,height,x:x-width/2,y:y-height/2},restPreRectStyle),{model,shapeMap,diffData,diffState})}drawLogoIconShape(logoIconStyle,keyShapeStyle,model,shapeMap,diffData,diffState){if(!logoIconStyle||!logoIconStyle.show)return;const{x,y,width}=keyShapeStyle,{width:logoIconWidth,height:logoIconHeight,fontSize:logoIconFontSize,text:logoIconText,offsetX:logoIconOffsetX,offsetY:logoIconOffsetY}=logoIconStyle,logoWidth=logoIconWidth||logoIconFontSize,logoHeight=logoIconWidth||logoIconFontSize,logoIconShapeType=logoIconText?"text":"image",logoX=x-width/2+logoIconOffsetX+width/10-logoIconWidth/2,logoY=logoIconText?logoIconOffsetY:y-logoIconHeight/2+logoIconOffsetY;return logoIconText&&(logoIconStyle.textAlign="center",logoIconStyle.textBaseline="middle"),this.upsertShape(logoIconShapeType,"logoIcon",Object.assign({width:logoWidth,height:logoHeight,x:logoX,y:logoY},logoIconStyle),{model,shapeMap,diffData,diffState})}drawDescriptionShape(descriptionStyle,keyShapeStyle,model,shapeMap,diffData,diffState){var _a;if(!descriptionStyle||!descriptionStyle.show)return;const{width,height}=keyShapeStyle,{fontSize:descFontSize,offsetX:descOffsetX,offsetY:descOffsetY}=descriptionStyle,logoIconBBox=null===(_a=shapeMap.logoIcon)||void 0===_a?void 0:_a.getBBox(),defaultLabelFontSize=Math.min(height,width)/5,defaultDescriptionX=-width/2+(null==logoIconBBox?void 0:logoIconBBox.width)+width/10,defaultWordWrapWidth=width/2-defaultDescriptionX-2*defaultLabelFontSize,defaultDescriptionFontSize=defaultLabelFontSize/2;return this.upsertShape("text","description",Object.assign({fontSize:descFontSize||defaultDescriptionFontSize,x:defaultDescriptionX+descOffsetX,y:0+height/6+descOffsetY,wordWrap:!0,wordWrapWidth:defaultWordWrapWidth},descriptionStyle),{model,shapeMap,diffData,diffState})}drawStateIcon(stateIconStyle,keyShapeStyle,model,shapeMap,diffData,diffState){if(!stateIconStyle||!stateIconStyle.show)return;const{x,y,width}=keyShapeStyle,{width:stateIconWidth,height:stateIconHeight,fontSize:stateIconFontSize,text:stateIconText,offsetX:stateIconOffsetX,offsetY:stateIconOffsetY}=stateIconStyle,stateWidth=stateIconWidth||stateIconFontSize,stateHeight=stateIconWidth||stateIconFontSize,stateIconShapeType=stateIconText?"text":"image",stateX=x+width/2-stateIconWidth+stateIconOffsetX,stateY=stateIconText?stateIconOffsetY:y-(stateIconHeight||stateIconFontSize)/2+stateIconOffsetY;return stateIconText&&(stateIconStyle.textAlign="center",stateIconStyle.textBaseline="middle"),this.upsertShape(stateIconShapeType,"stateIcon",Object.assign({width:stateWidth,height:stateHeight,x:stateX,y:stateY},stateIconStyle),{model,shapeMap,diffData,diffState})}}var image_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class ImageNode extends BaseNode{constructor(props){super(props),this.defaultStyles={keyShape:{x:0,y:0,width:32,height:32}}}drawKeyShape(model,shapeMap,diffData,diffState){var _a;const clipCfg=null===(_a=this.mergedStyles.keyShape)||void 0===_a?void 0:_a.clipCfg;let clipPath;if(clipCfg){const{type}=clipCfg,rest=image_rest(clipCfg,["type"]);clipPath=new ShapeTagMap[type],clipPath.attr(rest)}const shape=this.upsertShape("image","keyShape",Object.assign(Object.assign({},this.mergedStyles.keyShape),{x:this.mergedStyles.keyShape.x,y:this.mergedStyles.keyShape.y,anchor:"0.5 0.5"}),{model,shapeMap,diffData,diffState});return clipPath&&(shape.appendChild(clipPath),shape.attr("clipPath",clipPath)),shape}calculateAnchorPosition(keyShapeStyle){const x=keyShapeStyle.x,y=keyShapeStyle.y,height=keyShapeStyle.height,width=keyShapeStyle.width,anchorPositionMap={};return anchorPositionMap.top=[x,y-height/2],anchorPositionMap.left=[x-width/2,y],anchorPositionMap.right=anchorPositionMap.default=[x+width/2,y],anchorPositionMap.bottom=[x,y+height/2],anchorPositionMap}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData)),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData)),data.anchorShapes){const anchorShapes=this.drawAnchorShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),anchorShapes)}if(data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawHaloShape(model,shapeMap,diffData,diffState){var _a;const{keyShape}=shapeMap,{haloShape:haloShapeStyle,keyShape:keyShapeStyle}=this.mergedStyles;if(!1===(null==haloShapeStyle?void 0:haloShapeStyle.visible))return;const clipShape=(null===(_a=null==haloShapeStyle?void 0:haloShapeStyle.clipCfg)||void 0===_a?void 0:_a.type)||"rect",{attributes}=keyShape,{x,y,fill}=attributes;return this.upsertShape(clipShape,"haloShape",Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},attributes),keyShapeStyle),{x,y,stroke:fill}),haloShapeStyle),{fill:"transparent",batchKey:"halo"}),{model,shapeMap,diffData,diffState})}}class CubeNode extends BaseNode3D{constructor(props){super(props),this.defaultStyles={keyShape:{width:10,height:10,depth:10,x:0,y:0,z:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("cube","keyShape",this.mergedStyles.keyShape,{model,shapeMap,diffData,diffState})}}class PlaneNode extends BaseNode3D{constructor(props){super(props),this.defaultStyles={keyShape:{width:100,depth:100,materialType:"basic",materialProps:{wireframe:!1,wireframeColor:"black",cullMode:0},x:0,y:0,z:0}}}draw(model,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};if(shapes.keyShape=this.drawKeyShape(model,shapeMap,diffData,diffState),data.haloShape&&this.drawHaloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.badgeShapes){const badgeShapes=this.drawBadgeShapes(model,shapeMap,diffData,diffState);shapes=Object.assign(Object.assign({},shapes),badgeShapes)}return data.otherShapes&&this.drawOtherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,shapeMap,diffData,diffState){return this.upsertShape("plane","keyShape",this.mergedStyles.keyShape,{shapeMap,model,diffData,diffState})}}const getArrowPath=(type,width,height)=>{switch(type){case"triangle":default:return`M 0,0 L ${width},-${height/2} L ${width},${height/2} Z`;case"circle":{const r=Math.max(width,height)/2;return`M 0, 0\n        a ${r},${r} 0 1,0 ${2*r},0\n        a ${r},${r} 0 1,0 ${2*-r},0`}case"diamond":return`M 0,0 \n        L ${width/2},${-height/2} \n        L ${width},0 \n        L ${width/2},${height/2} Z`;case"vee":return`M 0,0 L ${width},-${height/2}\n              L ${2*width/3},0 L ${width},${height/2} Z`;case"rect":return`M 0,${-height/2} \n                L ${width},${-height/2} \n                L ${width},${height/2} \n                L 0,${height/2} Z`;case"triangle-rect":{const tWidth=width/2,rWidth=width/7,rBeginX=width-rWidth;return`M 0,0 L ${tWidth},-${height/2} L ${tWidth},${height/2} Z\n                        M ${rBeginX}, -${height/2}\n                        L ${rBeginX+rWidth} -${height/2}\n                        L ${rBeginX+rWidth} ${height/2}\n                        L ${rBeginX} ${height/2}\n                        Z`}case"simple":return`M ${width},-${height/2} L 0,0 L ${width},${height/2}`}},DEFAULT_ARROW_CONFIG={type:"triangle",width:10,height:10};var _BaseEdge_zoomCache,base_classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)},edge_base_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class BaseEdge{constructor(props){this.defaultStyles={},_BaseEdge_zoomCache.set(this,{zoom:1,wordWrapWidth:50}),this.onZoom=(shapeMap,zoom,cacheHiddenShape={})=>{};const{themeStyles,lodLevels,zoom}=props;themeStyles&&(this.themeStyles=themeStyles),this.lodLevels=lodLevels,this.transformCache={},base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f").zoom=zoom}mergeStyles(model){this.mergedStyles=this.getMergedStyles(model)}getMergedStyles(model){var _a;const{data}=model,dataStyles={};Object.keys(data).forEach((fieldName=>{RESERVED_SHAPE_IDS.includes(fieldName)?dataStyles[fieldName]=data[fieldName]:"otherShapes"===fieldName&&Object.keys(data[fieldName]).forEach((otherShapeId=>dataStyles[otherShapeId]=data[fieldName][otherShapeId]))}));const merged=mergeStyles([this.themeStyles,this.defaultStyles,dataStyles]),padding=null===(_a=merged.labelBackgroundShape)||void 0===_a?void 0:_a.padding;return padding&&(merged.labelBackgroundShape.padding=formatPadding(padding,DEFAULT_LABEL_BG_PADDING)),merged}updateCache(shapeMap){["labelShape","labelBackgroundShape"].forEach((id=>{const shape=shapeMap[id];shape&&(this.transformCache[`${id}Transform`]=shape.style.transform)}));const{zoom}=base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f"),{maxWidth="60%"}=this.mergedStyles.labelShape||{};base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f").wordWrapWidth=getWordWrapWidthByEnds([this.sourcePoint,this.targetPoint],maxWidth,1),base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f").zoom=1,1!==zoom&&this.onZoom(shapeMap,zoom)}afterDraw(model,shapeMap,diffData,diffState){return{}}drawLabelShape(model,shapeMap,diffData,diffState){const{keyShape}=shapeMap,{labelShape:shapeStyle}=this.mergedStyles;if(!shapeStyle||!shapeStyle.text||!model.data.labelShape)return;const{position,offsetX:propsOffsetX,offsetY:propsOffsetY,autoRotate=!0,maxWidth}=shapeStyle,otherStyle=edge_base_rest(shapeStyle,["position","offsetX","offsetY","autoRotate","maxWidth"]),positionPreset={textAlign:"center",offsetX:0,offsetY:0,pointRatio:[.5,.501]};switch("number"==typeof position&&(positionPreset.pointRatio=[position,position+.01]),position){case"start":positionPreset.pointRatio=[0,.01],positionPreset.textAlign="left",positionPreset.offsetX=4;break;case"end":positionPreset.pointRatio=[.99,1],positionPreset.textAlign="right",positionPreset.offsetX=-4}const point=keyShape.getPoint(positionPreset.pointRatio[0]);let positionStyle={x:point.x,y:point.y},isRevert=!1;if(autoRotate){const pointOffset=keyShape.getPoint(positionPreset.pointRatio[1]);let angle=Math.atan((point.y-pointOffset.y)/(point.x-pointOffset.x));isNaN(angle)&&(angle=0),isRevert=pointOffset.x<point.x,isRevert&&("start"===position?(positionPreset.textAlign="right",positionPreset.offsetX=-4):"end"===position&&(positionPreset.textAlign="left",positionPreset.offsetX=4));const offsetX=void 0===propsOffsetX?positionPreset.offsetX:propsOffsetX,offsetY=void 0===propsOffsetY?positionPreset.offsetY:propsOffsetY,projection={x:point.x+offsetX*Math.cos(angle),y:point.y+offsetX*Math.sin(angle)};positionStyle={x:projection.x+offsetY*Math.cos(Math.PI-angle),y:projection.y+offsetY*Math.sin(Math.PI-angle),transform:`rotate(${angle/Math.PI*180}deg)`}}this.labelPosition=Object.assign(Object.assign({},positionStyle),{isRevert});const wordWrapWidth=getWordWrapWidthByEnds([this.sourcePoint,this.targetPoint],maxWidth,base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f").zoom);base_classPrivateFieldGet(this,_BaseEdge_zoomCache,"f").wordWrapWidth=wordWrapWidth;const style=Object.assign(Object.assign(Object.assign(Object.assign({},this.defaultStyles.labelShape),{textAlign:positionPreset.textAlign,wordWrapWidth,isBillboard:!0}),positionStyle),otherStyle);return this.transformCache.labelShapeTransform=style.transform,this.upsertShape("text","labelShape",style,{model,shapeMap,diffData,diffState})}drawLabelBackgroundShape(model,shapeMap,diffData,diffState){const{labelShape}=shapeMap;if(!labelShape||!labelShape.style.text||!model.data.labelShape)return;const{labelBackgroundShape,labelShape:labelShapeStyle}=this.mergedStyles,textGeoBBox=labelShape.getGeometryBounds(),{x,y,transform,isRevert}=this.labelPosition,{padding}=labelBackgroundShape,backgroundStyle=edge_base_rest(labelBackgroundShape,["padding"]),textWidth=textGeoBBox.max[0]-textGeoBBox.min[0],textHeight=textGeoBBox.max[1]-textGeoBBox.min[1],bgStyle=Object.assign(Object.assign({fill:"#fff"},backgroundStyle),{x:textGeoBBox.min[0]-padding[3]+labelShape.style.x,y:textGeoBBox.min[1]-padding[0]+labelShape.style.y,width:textWidth+padding[1]+padding[3],height:textHeight+padding[0]+padding[2]});return transform&&(bgStyle.transform=transform),"start"===labelShapeStyle.position?bgStyle.transformOrigin=isRevert?`${bgStyle.width-padding[1]} ${bgStyle.height/2}`:`${padding[3]} ${bgStyle.height/2}`:"end"===labelShapeStyle.position?bgStyle.transformOrigin=isRevert?`${padding[3]} ${bgStyle.height/2}`:`${bgStyle.width-padding[1]} ${bgStyle.height/2}`:bgStyle.transformOrigin=`${textWidth/2+padding[3]} ${textHeight/2+padding[0]}`,this.upsertShape("rect","labelBackgroundShape",bgStyle,{model,shapeMap,diffData,diffState})}drawIconShape(model,shapeMap,diffData,diffState){const{labelShape,labelBackgroundShape,keyShape}=shapeMap,{iconShape:shapeStyle,labelShape:labelShapeProps}=this.mergedStyles,{width,height,fontSize,text,offsetX=0,offsetY=0}=shapeStyle,w=width||fontSize,h=height||fontSize,iconShapeType=text?"text":"image";if("text"===iconShapeType?(shapeStyle.textAlign="left",shapeStyle.textBaseline="top",shapeStyle.fontSize=w):(shapeStyle.width=w,shapeStyle.height=h),labelShapeProps){const referShape=labelBackgroundShape||labelShape,referBounds=referShape.getGeometryBounds(),{min:referMin,max:referMax,halfExtents:referHalExtents}=referBounds,referHeight=referMax[1]-referMin[1],referWidth=referMax[0]-referMin[0],{x:referX,y:referY,transform:referTransform}=referShape.attributes,{textAlign:labelAlign}=labelShape.attributes;shapeStyle.x=referMin[0]-w+4+referX+offsetX,shapeStyle.y=referMin[1]+(referHeight-h)/2+referY+offsetY,referTransform&&(shapeStyle.transform=referTransform,shapeStyle.transformOrigin="right"===labelAlign?`${referWidth/2-w/2+4+referHalExtents[0]-offsetX} ${h/2-offsetY}`:"left"===labelAlign?`${w+4-offsetX} ${h/2-offsetY}`:`${(w+referWidth)/2-offsetX} ${h/2-offsetY}`)}else{const midPoint=keyShape.getPoint(.5);shapeStyle.x=midPoint.x+offsetX,shapeStyle.y=midPoint.y+offsetY}return this.upsertShape(iconShapeType,"iconShape",shapeStyle,{model,shapeMap,diffData,diffState})}drawHaloShape(model,shapeMap,diffData,diffState){const{keyShape}=shapeMap,{haloShape:haloShapeStyle}=this.mergedStyles;if(!1===haloShapeStyle.visible)return;const{nodeName,attributes}=keyShape;return this.upsertShape(nodeName,"haloShape",Object.assign(Object.assign(Object.assign({},attributes),{stroke:attributes.stroke}),haloShapeStyle),{model,shapeMap,diffData,diffState})}drawOtherShapes(model,shapeMap,diffData,diffState){return{}}setSourcePoint(point){this.sourcePoint=point}setTargetPoint(point){this.targetPoint=point}setNodeMap(nodeMap){this.nodeMap=nodeMap}upsertArrow(position,arrowConfig,bodyStyle,model,resultStyle){const markerField="marker"+("start"===position?"Start":"End");if(!arrowConfig)return resultStyle[markerField]=null,void(resultStyle[`${markerField}Offset`]=0);const arrowStyle=is_boolean(arrowConfig)?Object.assign({},DEFAULT_ARROW_CONFIG):arrowConfig,{type="triangle",width=10,height=10,path:propPath,offset=0}=arrowStyle,others=edge_base_rest(arrowStyle,["type","width","height","path","offset"]);resultStyle[markerField]=this.upsertShape("path",`${markerField}Shape`,Object.assign(Object.assign(Object.assign({},bodyStyle),{fill:"simple"===type?"":bodyStyle.stroke,path:propPath||getArrowPath(type,width,height),anchor:"0.5 0.5",transformOrigin:"center"}),others),{model,shapeMap:{}}),resultStyle[`${markerField}Offset`]=width/2+offset}upsertShape(type,id,style,config){return upsertShape(type,id,style,config)}}_BaseEdge_zoomCache=new WeakMap;var line_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class LineEdge extends BaseEdge{constructor(props){super(props),this.type="line-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0}}}draw(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{data={}}=model;let shapes={keyShape:void 0};return shapes.keyShape=this.drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState),data.haloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),data.otherShapes&&(shapes=Object.assign(Object.assign({},shapes),this.drawOtherShapes(model,shapeMap,diffData,diffState))),shapes}drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,{startArrow,endArrow}=keyShapeStyle,others=line_rest(keyShapeStyle,["startArrow","endArrow"]),lineStyle=Object.assign(Object.assign({},others),{x1:sourcePoint.x,y1:sourcePoint.y,z1:sourcePoint.z||0,x2:targetPoint.x,y2:targetPoint.y,z2:targetPoint.z||0,isBillboard:!0});return this.upsertArrow("start",startArrow,others,model,lineStyle),this.upsertArrow("end",endArrow,others,model,lineStyle),this.upsertShape("line","keyShape",lineStyle,{model,shapeMap,diffData,diffState})}}const getControlPoint=(startPoint,endPoint,percent=0,offset=0)=>{const point={x:(1-percent)*startPoint.x+percent*endPoint.x,y:(1-percent)*startPoint.y+percent*endPoint.y};let tangent=[0,0];vec2_normalize(tangent,[endPoint.x-startPoint.x,endPoint.y-startPoint.y]),tangent&&(tangent[0]||tangent[1])||(tangent=[0,0]);const perpendicular=[-tangent[1]*offset,tangent[0]*offset];return point.x+=perpendicular[0],point.y+=perpendicular[1],point},PATH_COMMANDS={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]},pathToPoints=path=>{const points=[];let segments=[];return segments="string"==typeof path?(path=>{const items=path.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),segments=[];let currentCommand="",currentElement={};for(;items.length>0;){let it=items.shift();PATH_COMMANDS.hasOwnProperty(it)?currentCommand=it:items.unshift(it),currentElement={type:currentCommand},PATH_COMMANDS[currentCommand].forEach((prop=>{it=items.shift(),currentElement[prop]=it})),"M"===currentCommand?currentCommand="L":"m"===currentCommand&&(currentCommand="l"),segments.push(currentElement)}return segments})(path):path,segments.forEach((seg=>{if("A"!==seg[0])for(let i=1;i<seg.length;i+=2)points.push([seg[i],seg[i+1]]);else{const length=seg.length;points.push([seg[length-2],seg[length-1]])}})),points};var quadratic_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class QuadraticEdge extends BaseEdge{constructor(props){super(props),this.type="quadratic-edge",this.defaultStyles={keyShape:{controlPoints:[],curvePosition:.5,curveOffset:30,isBillboard:!0}},this.getControlPoints=(startPoint,endPoint,percent=0,controlPoints,offset)=>(null==controlPoints?void 0:controlPoints.length)?controlPoints:[getControlPoint(startPoint,endPoint,percent,offset)]}draw(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{data={}}=model,shapes={keyShape:void 0};return shapes.keyShape=this.drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState),data.haloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),shapes}drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,{startArrow,endArrow}=keyShapeStyle,others=quadratic_rest(keyShapeStyle,["startArrow","endArrow"]),controlPoint=this.getControlPoints(sourcePoint,targetPoint,keyShapeStyle.curvePosition,keyShapeStyle.controlPoints,keyShapeStyle.curveOffset)[0],lineStyle=Object.assign(Object.assign({},others),{path:[["M",sourcePoint.x,sourcePoint.y],["Q",controlPoint.x,controlPoint.y,targetPoint.x,targetPoint.y]]});return this.upsertArrow("start",startArrow,others,model,lineStyle),this.upsertArrow("end",endArrow,others,model,lineStyle),this.upsertShape("path","keyShape",lineStyle,{model,shapeMap,diffData,diffState})}}function _mix(dist,obj){for(var key in obj)obj.hasOwnProperty(key)&&"constructor"!==key&&void 0!==obj[key]&&(dist[key]=obj[key])}const defaultCfg={name:"orth",enableObstacleAvoidance:!1,offset:2,maxAllowedDirectionChange:Math.PI/2,maximumLoops:2e3,gridSize:10,directions:[{stepX:1,stepY:0},{stepX:-1,stepY:0},{stepX:0,stepY:1},{stepX:0,stepY:-1}],get penalties(){return{0:0,45:this.gridSize/2,90:this.gridSize/2}},distFunc:manhattanDist,fallbackRoute:simplePathFinder},octolinearCfg={name:"er",maxAllowedDirectionChange:Math.PI/4,directions:[{stepX:1,stepY:0},{stepX:1,stepY:1},{stepX:0,stepY:1},{stepX:-1,stepY:1},{stepX:-1,stepY:0},{stepX:-1,stepY:-1},{stepX:0,stepY:-1},{stepX:1,stepY:-1}],distFunc:(p1,p2)=>Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2)),fallbackRoute:simplePathFinder},pos2GridIx=(pos,gridSize)=>{const gridIx=Math.round(Math.abs(pos/gridSize));return gridIx<0?0:(pos<0?-1:1)*gridIx},getDirectionAngle=(p1,p2)=>{const deltaX=p2.x-p1.x,deltaY=p2.y-p1.y;return deltaX||deltaY?Math.atan2(deltaY,deltaX):0},getAngleDiff=(angle1,angle2)=>{const directionChange=Math.abs(angle1-angle2);return directionChange>Math.PI?2*Math.PI-directionChange:directionChange},estimateCost=(from,endPoints,distFunc)=>{let min=1/0;for(let i=0,len=endPoints.length;i<len;i++){const cost=distFunc(from,endPoints[i]);cost<min&&(min=cost)}return min},getBoxPoints=(point,oriPoint,node,anotherPoint,cfg)=>{const points=[];if(!node)return[point];const{directions,offset}=cfg,bbox=node.getBBox(),isInside=oriPoint.x>bbox.min[0]&&oriPoint.x<bbox.max[0]&&oriPoint.y>bbox.min[1]&&oriPoint.y<bbox.max[1],expandBBox=getExpandedBBox(bbox,offset);for(const i in expandBBox)expandBBox[i]=lodash_map(expandBBox[i],(item=>pos2GridIx(item,cfg.gridSize)));if(isInside){for(const dir of directions){const bounds=[[{x:expandBBox.min[0],y:expandBBox.min[1]},{x:expandBBox.max[0],y:expandBBox.min[1]}],[{x:expandBBox.min[0],y:expandBBox.min[1]},{x:expandBBox.min[0],y:expandBBox.max[1]}],[{x:expandBBox.max[0],y:expandBBox.min[1]},{x:expandBBox.max[0],y:expandBBox.max[1]}],[{x:expandBBox.min[0],y:expandBBox.max[1]},{x:expandBBox.max[0],y:expandBBox.max[1]}]];for(let i=0;i<4;i++){const boundLine=bounds[i],intersectP=getLineIntersect(point,{x:point.x+dir.stepX*getBBoxWidth(expandBBox),y:point.y+dir.stepY*getBBoxHeight(expandBBox)},boundLine[0],boundLine[1]);intersectP&&!isSegmentCrossingBBox(point,intersectP,bbox)&&(intersectP.id=`${intersectP.x}|||${intersectP.y}`,points.push(intersectP))}}return points}const intersectP=getExpandedBBoxPoint(expandBBox,point,anotherPoint);return intersectP.id=`${intersectP.x}|||${intersectP.y}`,[intersectP]},getDirectionChange=(current,neighbor,cameFrom,scaleStartPoint)=>{const directionAngle=getDirectionAngle(current,neighbor),currentCameFrom=cameFrom[current.id];if(!currentCameFrom){const startAngle=getDirectionAngle(scaleStartPoint,current);return getAngleDiff(startAngle,directionAngle)}const prevDirectionAngle=getDirectionAngle({x:currentCameFrom.x,y:currentCameFrom.y},current);return getAngleDiff(prevDirectionAngle,directionAngle)},getControlPoints=(current,cameFrom,scaleStartPoint,endPoint,startPoints,scaleEndPoint,gridSize)=>{const controlPoints=[];let pointZero=endPoint,currentId=current.id,currentX=current.x,currentY=current.y;const lastPoint_x=currentX,lastPoint_y=currentY;pointZero={x:scaleEndPoint.x===endPoint.x?endPoint.x:lastPoint_x*gridSize,y:scaleEndPoint.y===endPoint.y?endPoint.y:lastPoint_y*gridSize},controlPoints.unshift(pointZero);let currentCameFrom=cameFrom[currentId];for(;currentCameFrom&&currentCameFrom.id!==currentId;){const point={x:currentX,y:currentY,id:currentId},prePoint={x:currentCameFrom.x,y:currentCameFrom.y,id:currentCameFrom.id};getDirectionChange(prePoint,point,cameFrom,scaleStartPoint)&&(pointZero={x:prePoint.x===point.x?pointZero.x:prePoint.x*gridSize,y:prePoint.y===point.y?pointZero.y:prePoint.y*gridSize},controlPoints.unshift(pointZero)),currentId=prePoint.id,currentX=prePoint.x,currentY=prePoint.y,currentCameFrom=cameFrom[currentId]}const realStartPoints=startPoints.map((point=>({x:point.x*gridSize,y:point.y*gridSize}))),startPoint=getNearestPoint(realStartPoints,pointZero).nearestPoint;return controlPoints.unshift(startPoint),controlPoints},pathFinder=(points,sourceNodeId,targetNodeId,nodeMap,routerCfg)=>{const startNode=nodeMap.get(sourceNodeId),endNode=nodeMap.get(targetNodeId),startPoint=(null==startNode?void 0:startNode.getPosition())||points[0],endPoint=(null==endNode?void 0:endNode.getPosition())||points[points.length-1];if(isNaN(startPoint.x)||isNaN(endPoint.x))return[];const defaultCfgs="orth"===routerCfg.name?defaultCfg:deep_mix(defaultCfg,octolinearCfg),cfg=deep_mix(defaultCfgs,routerCfg);if(!cfg.enableObstacleAvoidance)return cfg.fallbackRoute(startPoint,endPoint,startNode,endNode,cfg);const{penalties,gridSize}=cfg,obstacleMap=((items,gridSize,offset)=>{const obstacleMap={};return items.forEach((item=>{if(!item||!item.isVisible())return;const bbox=getExpandedBBox(item.getBBox(),offset);for(let x=pos2GridIx(bbox.min[0],gridSize);x<=pos2GridIx(bbox.max[0],gridSize);x+=1)for(let y=pos2GridIx(bbox.min[1],gridSize);y<=pos2GridIx(bbox.max[1],gridSize);y+=1)obstacleMap[`${x}|||${y}`]=!0})),obstacleMap})(nodeMap,gridSize,cfg.offset),scaleStartPoint={x:pos2GridIx(startPoint.x,gridSize),y:pos2GridIx(startPoint.y,gridSize)},scaleEndPoint={x:pos2GridIx(endPoint.x,gridSize),y:pos2GridIx(endPoint.y,gridSize)};startPoint.id=`${scaleStartPoint.x}|||${scaleStartPoint.y}`,endPoint.id=`${scaleEndPoint.x}|||${scaleEndPoint.y}`;const startPoints=getBoxPoints(scaleStartPoint,startPoint,startNode,scaleEndPoint,cfg),endPoints=getBoxPoints(scaleEndPoint,endPoint,endNode,scaleStartPoint,cfg);startPoints.forEach((point=>{delete obstacleMap[point.id]})),endPoints.forEach((point=>{delete obstacleMap[point.id]}));const openSet={},closedSet={},cameFrom={},gScore={},fScore={},sortedOpenSet=new SortedArray;for(let i=0;i<startPoints.length;i++){const firstStep=startPoints[i];openSet[firstStep.id]=firstStep,gScore[firstStep.id]=0,fScore[firstStep.id]=estimateCost(firstStep,endPoints,cfg.distFunc),sortedOpenSet.add({id:firstStep.id,value:fScore[firstStep.id]})}let current,direction,neighbor,neighborCost,costFromStart,directionChange,remainLoops=cfg.maximumLoops,curCost=1/0;const endPointMap={};for(endPoints.forEach((point=>{endPointMap[`${point.x}|||${point.y}`]=!0})),Object.keys(openSet).forEach((key=>{const id=openSet[key].id;fScore[id]<=curCost&&(curCost=fScore[id],current=openSet[id])}));Object.keys(openSet).length>0&&remainLoops>0;){const minId=sortedOpenSet.minId((remainLoops+1)%30==0);if(!minId)break;if(current=openSet[minId],endPointMap[`${current.x}|||${current.y}`])return getControlPoints(current,cameFrom,scaleStartPoint,endPoint,startPoints,scaleEndPoint,gridSize);delete openSet[current.id],sortedOpenSet.remove(current.id),closedSet[current.id]=!0;for(let i=0;i<cfg.directions.length;i++){direction=cfg.directions[i];const neighborId=`${Math.round(current.x)+direction.stepX}|||${Math.round(current.y)+direction.stepY}`;if(neighbor={x:current.x+direction.stepX,y:current.y+direction.stepY,id:neighborId},closedSet[neighborId])continue;if(directionChange=getDirectionChange(current,neighbor,cameFrom,scaleStartPoint),directionChange>cfg.maxAllowedDirectionChange)continue;if(obstacleMap[neighborId])continue;openSet[neighborId]||(openSet[neighborId]=neighbor);const directionPenalties=penalties[directionChange];neighborCost=cfg.distFunc(current,neighbor)+(isNaN(directionPenalties)?gridSize:directionPenalties),costFromStart=gScore[current.id]+neighborCost;const neighborGScore=gScore[neighborId];neighborGScore&&costFromStart>=neighborGScore||(cameFrom[neighborId]=current,gScore[neighborId]=costFromStart,fScore[neighborId]=costFromStart+estimateCost(neighbor,endPoints,cfg.distFunc),sortedOpenSet.add({id:neighborId,value:fScore[neighborId]}))}remainLoops-=1}return cfg.fallbackRoute(startPoint,endPoint,startNode,endNode,cfg)};var polyline_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class PolylineEdge extends LineEdge{constructor(props){super(props),this.type="polyline-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0}}}draw(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{data={}}=model,shapes={keyShape:void 0};return shapes.keyShape=this.drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState),data.haloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),shapes}getControlPoints(model,sourcePoint,targetPoint){const{keyShape:keyShapeStyle}=this.mergedStyles;return keyShapeStyle.controlPoints}getPath(model,points,radius,routeCfg,auto){const{id:edgeId,source:sourceNodeId,target:targetNodeId}=model;if(!auto&&"er"!==routeCfg.name)return getPolylinePath(0,points,radius);const polylinePoints=pathFinder(points,sourceNodeId,targetNodeId,this.nodeMap,routeCfg);return getPolylinePath(0,polylinePoints,radius)}drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,controlPoints=this.getControlPoints(model,sourcePoint,targetPoint);let points=[sourcePoint,targetPoint];controlPoints&&(points=[sourcePoint,...controlPoints,targetPoint]);const routeCfg=function mix_mix(dist,src1,src2,src3){return src1&&_mix(dist,src1),src2&&_mix(dist,src2),src3&&_mix(dist,src3),dist}({},{offset:keyShapeStyle.offset,name:"orth"},keyShapeStyle.routeCfg),path=this.getPath(model,points,keyShapeStyle.radius,routeCfg,is_empty(controlPoints)),{startArrow,endArrow}=keyShapeStyle,others=polyline_rest(keyShapeStyle,["startArrow","endArrow"]),lineStyle=Object.assign(Object.assign({},others),{path,isBillboard:!0});return this.upsertArrow("start",startArrow,others,model,lineStyle),this.upsertArrow("end",endArrow,others,model,lineStyle),this.upsertShape("path","keyShape",lineStyle,{model,shapeMap,diffData,diffState})}}var cubic_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class CubicEdge extends BaseEdge{constructor(props){super(props),this.type="cubic-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0}},this.getControlPoints=(startPoint,endPoint,percent=.5,controlPoints,offset=20)=>{if((null==controlPoints?void 0:controlPoints.length)>1)return controlPoints;return[this.getControlPoint(startPoint,endPoint,percent,offset),this.getControlPoint(startPoint,endPoint,percent,-offset)]},this.getControlPoint=(startPoint,endPoint,percent=0,offset=0)=>{const point={x:(1-percent)*startPoint.x+percent*endPoint.x,y:(1-percent)*startPoint.y+percent*endPoint.y};let tangent=[0,0];vec2_normalize(tangent,[endPoint.x-startPoint.x,endPoint.y-startPoint.y]),tangent&&(tangent[0]||tangent[1])||(tangent=[0,0]);const perpendicular=[-tangent[1]*offset,tangent[0]*offset];return point.x+=perpendicular[0],point.y+=perpendicular[1],point}}draw(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{data={}}=model,shapes={keyShape:void 0};return shapes.keyShape=this.drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState),data.haloShape&&(shapes.haloShape=this.drawHaloShape(model,shapeMap,diffData,diffState)),data.labelShape&&(shapes.labelShape=this.drawLabelShape(model,shapeMap,diffData,diffState)),data.labelBackgroundShape&&(shapes.labelBackgroundShape=this.drawLabelBackgroundShape(model,shapeMap,diffData,diffState)),data.iconShape&&(shapes.iconShape=this.drawIconShape(model,shapeMap,diffData,diffState)),shapes}drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,{startArrow,endArrow}=keyShapeStyle,others=cubic_rest(keyShapeStyle,["startArrow","endArrow"]),controlPoints=this.getControlPoints(sourcePoint,targetPoint,keyShapeStyle.curvePosition,keyShapeStyle.controlPoints,keyShapeStyle.curveOffset),lineStyle=Object.assign(Object.assign({},others),{path:[["M",sourcePoint.x,sourcePoint.y],["C",controlPoints[0].x,controlPoints[0].y,controlPoints[1].x,controlPoints[1].y,targetPoint.x,targetPoint.y]]});return this.upsertArrow("start",startArrow,others,model,lineStyle),this.upsertArrow("end",endArrow,others,model,lineStyle),this.upsertShape("path","keyShape",lineStyle,{model,shapeMap,diffData,diffState})}}var loop_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class LoopEdge extends CubicEdge{constructor(props){super(props),this.type="loop-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0,loopCfg:{position:LOOP_POSITION.top,clockwise:!0}}}}drawKeyShape(model,sourcePoint,targetPoint,shapeMap,diffData,diffState){const{keyShape:keyShapeStyle}=this.mergedStyles,{startPoint,endPoint,controlPoints}=this.getPathPoints(model,sourcePoint,targetPoint,keyShapeStyle.loopCfg),{startArrow,endArrow}=keyShapeStyle,others=loop_rest(keyShapeStyle,["startArrow","endArrow"]),lineStyle=Object.assign(Object.assign({},keyShapeStyle),{path:[["M",startPoint.x,startPoint.y],["C",controlPoints[0].x,controlPoints[0].y,controlPoints[1].x,controlPoints[1].y,endPoint.x,endPoint.y]]});return this.upsertArrow("start",startArrow,others,model,lineStyle),this.upsertArrow("end",endArrow,others,model,lineStyle),this.upsertShape("path","keyShape",lineStyle,{model,shapeMap,diffData,diffState})}getPathPoints(model,sourcePoint,targetPoint,loopCfg){const{source:sourceNodeId,target:targetNodeId}=model;if(sourceNodeId!==targetNodeId)throw new Error;const item=this.nodeMap.get(sourceNodeId),shapeType=item.shapeMap.keyShape.nodeName,bbox=item.getKeyBBox(),width=getBBoxWidth(bbox),height=getBBoxHeight(bbox),halfOfHeight=height/2,halfOfWidth=width/2,center=bbox.center;let startPoint=[sourcePoint.x,sourcePoint.y],endPoint=[targetPoint.x,targetPoint.y];const position=loopCfg.position||LOOP_POSITION.top;if(startPoint[0]===endPoint[0]&&startPoint[1]===endPoint[1]&&([startPoint,endPoint]="circle"===shapeType||"ellipse"===shapeType?((position,center,halfOfWidth,halfOfHeight)=>{var _a,_b;const[rstartX,rstartY,rendX,rendY]=getPointsOnEllipseAtAngles(halfOfWidth,halfOfHeight,(null===(_a=radiansMap[position])||void 0===_a?void 0:_a[0])||-PI_OVER_8,(null===(_b=radiansMap[position])||void 0===_b?void 0:_b[1])||PI_OVER_8);return[[center[0]+rstartX,center[1]+rstartY],[center[0]+rendX,center[1]+rendY]]})(position,center,halfOfWidth,halfOfHeight):((position,center,halfOfWidth,halfOfHeight,customPointPadding)=>{const defaultPointPadding=Math.min(halfOfHeight/2,halfOfWidth/2),maxPointPadding=Math.min(halfOfHeight,halfOfWidth),pointPadding=customPointPadding?Math.min(maxPointPadding,customPointPadding):defaultPointPadding,pointsPositionMap={[LOOP_POSITION.top]:[[center[0]-pointPadding,center[1]-halfOfHeight],[center[0]+pointPadding,center[1]-halfOfHeight]],[LOOP_POSITION["top-right"]]:[[center[0]+halfOfWidth-pointPadding,center[1]-halfOfHeight],[center[0]+halfOfWidth,center[1]-halfOfHeight+pointPadding]],[LOOP_POSITION.right]:[[center[0]+halfOfWidth,center[1]-pointPadding],[center[0]+halfOfWidth,center[1]+pointPadding]],[LOOP_POSITION["bottom-right"]]:[[center[0]+halfOfWidth,center[1]+halfOfHeight-pointPadding],[center[0]+halfOfWidth-pointPadding,center[1]+halfOfHeight]],[LOOP_POSITION.bottom]:[[center[0]+pointPadding,center[1]+halfOfHeight],[center[0]-pointPadding,center[1]+halfOfHeight]],[LOOP_POSITION["bottom-left"]]:[[center[0]-halfOfWidth+pointPadding,center[1]+halfOfHeight],[center[0]-halfOfWidth,center[1]+halfOfHeight-pointPadding]],[LOOP_POSITION.left]:[[center[0]-halfOfWidth,center[1]+pointPadding],[center[0]-halfOfWidth,center[1]-pointPadding]],[LOOP_POSITION["top-left"]]:[[center[0]-halfOfWidth,center[1]-halfOfHeight+pointPadding],[center[0]-halfOfWidth+pointPadding,center[1]-halfOfHeight]]};return pointsPositionMap[position]||pointsPositionMap[LOOP_POSITION.top]})(position,center,halfOfWidth,halfOfHeight,loopCfg.pointPadding),!1===loopCfg.clockwise)){const swap=startPoint;startPoint=endPoint,endPoint=swap}const dist=loopCfg.dist||2*Math.max(width,height),startVec=[startPoint[0]-center[0],startPoint[1]-center[1]],endVec=[endPoint[0]-center[0],endPoint[1]-center[1]],rstart=distanceVec([0,0],startVec),rend=distanceVec([0,0],endVec),scaleRateEnd=(rend+dist)/rend,startExtendVec=vec2_scale([0,0],startVec,(rstart+dist)/rstart),endExtendVec=vec2_scale([0,0],endVec,scaleRateEnd),controlPoints=[{x:center[0]+startExtendVec[0],y:center[1]+startExtendVec[1]},{x:center[0]+endExtendVec[0],y:center[1]+endExtendVec[1]}];return{startPoint:{x:startPoint[0],y:startPoint[1]},endPoint:{x:endPoint[0],y:endPoint[1]},controlPoints}}}class CubicHorizontalEdge extends CubicEdge{constructor(props){super(props),this.type="cubic-horizontal-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0}},this.getControlPoints=(startPoint,endPoint,percent=.5,controlPoints,offset)=>{if((null==controlPoints?void 0:controlPoints.length)>1)return controlPoints;const distanceToPoint=(startPoint.x-endPoint.x)*percent;return[this.getControlPoint(startPoint,endPoint,distanceToPoint),this.getControlPoint(endPoint,startPoint,-distanceToPoint)]},this.getControlPoint=(startPoint,endPoint,offset=0)=>{if(endPoint.y===startPoint.y||endPoint.x===startPoint.x)return{x:(startPoint.x+endPoint.x)/2,y:startPoint.y};return{x:startPoint.x-offset,y:startPoint.y}}}}class CubicVerticalEdge extends CubicEdge{constructor(props){super(props),this.type="cubic-vertical-edge",this.defaultStyles={keyShape:{x1:0,y1:0,z1:0,x2:0,y2:0,z2:0,isBillboard:!0}},this.getControlPoints=(startPoint,endPoint,percent=.5,controlPoints,offset)=>{if((null==controlPoints?void 0:controlPoints.length)>1)return controlPoints;const distanceToPoint=(startPoint.y-endPoint.y)*percent;return[this.getControlPoint(startPoint,endPoint,distanceToPoint),this.getControlPoint(endPoint,startPoint,-distanceToPoint)]},this.getControlPoint=(startPoint,endPoint,offset=0)=>{if(endPoint.y===startPoint.y||endPoint.x===startPoint.x)return{x:startPoint.x,y:(startPoint.y+endPoint.y)/2};return{x:startPoint.x,y:startPoint.y-offset}}}}const comboFill="rgb(253, 253, 253)",comboStroke="rgba(153,173,209,1)",LightTheme={node:{palette:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"],lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{r:16,fill:"rgb(34,126,255)",lineWidth:0,zIndex:0}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"#000",position:"bottom",zIndex:2,lod:"auto",maxWidth:"200%",textOverflow:"ellipsis",wordWrap:!0,maxLines:1}),labelBackgroundShape:{padding:[2,4,2,4],lineWidth:0,fill:"#fff",opacity:.75,zIndex:1,lod:"auto"},iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"#fff",fontSize:16,zIndex:1,lod:-1}),anchorShapes:{lineWidth:1,stroke:"rgba(0, 0, 0, 0.65)",zIndex:2,r:3,lod:0},badgeShapes:{palette:["#7E92B5","#F86254","#EDB74B"],textColor:"#fff",zIndex:3,lod:-1},haloShape:{visible:!1,droppable:!1}},selected:{keyShape:{stroke:"#000",lineWidth:3},labelShape:{fontWeight:700,fontSize:14},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,droppable:!1}},active:{keyShape:{lineWidth:0},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,droppable:!1}},highlight:{keyShape:{stroke:"rgba(0,0,0,0.85)",lineWidth:3},labelShape:{fontWeight:700},haloShape:{visible:!1,droppable:!1}},inactive:{keyShape:{opacity:.25},labelShape:{opacity:.25},iconShape:{opacity:.25},haloShape:{visible:!1,droppable:!1}},disable:{keyShape:{fill:"rgb(240, 240, 240)",lineWidth:0},haloShape:{visible:!1,droppable:!1}}}]},edge:{palette:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"],lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{lineWidth:1,stroke:"rgb(153, 173, 209)",increasedLineWidthForHitTesting:2,zIndex:1}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgba(0,0,0,0.85)",position:"middle",textBaseline:"middle",zIndex:3,textOverflow:"ellipsis",wordWrap:!0,maxLines:1,maxWidth:"60%",lod:"auto"}),labelBackgroundShape:{padding:[4,4,4,4],lineWidth:0,fill:"#fff",opacity:.75,zIndex:2,lod:"auto"},iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgb(140, 140, 140)",fontSize:16,zIndex:2,offsetX:-10,lod:-1})},selected:{keyShape:{lineWidth:2},labelShape:{fontWeight:700,fontSize:14},haloShape:{opacity:.25,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},active:{keyShape:{lineWidth:1},haloShape:{opacity:.25,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},highlight:{keyShape:{lineWidth:2},labelShape:{fontWeight:700}},inactive:{keyShape:{stroke:"rgb(210, 218, 233)",lineWidth:1}},disable:{keyShape:{stroke:"rgb(217, 217, 217)",lineWidth:1}}}]},combo:{lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{fill:comboFill,lineWidth:1,stroke:comboStroke,r:5,width:20,height:10,padding:[25,20,15,20]}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"#000",position:"bottom",zIndex:2,lod:0,maxLines:1}),labelBackgroundShape:{padding:[2,4,2,4],lineWidth:0,fill:"#fff",opacity:.75,zIndex:1,lod:0}},selected:{keyShape:{stroke:"rgba(27,50,79,1)",fill:comboFill,lineWidth:4},labelShape:{fontWeight:700,fontSize:14},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,stroke:"rgba(153,173,209,1)",droppable:!1}},active:{keyShape:{stroke:comboStroke,lineWidth:1},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,stroke:"rgba(153,173,209,1)",droppable:!1}},highlight:{keyShape:{stroke:comboStroke,lineWidth:4},labelShape:{fontWeight:700}},inactive:{keyShape:{stroke:comboStroke,fill:comboFill,lineWidth:1,opacity:.65},labelShape:{opacity:.65}},disable:{keyShape:{fill:"rgb(240, 240, 240)",stroke:"rgba(153,173,209,1)",opacity:.25,lineWidth:1},labelShape:{opacity:.25}},collapsed:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{fill:comboFill,lineWidth:1,stroke:comboStroke,r:16,width:48,height:24,padding:[25,20,15,20]}),iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:comboStroke,fontSize:12,zIndex:1,lod:-1,contentType:"childCount",visible:!0})}}]},canvas:{backgroundColor:"rgba(255, 255, 255, 0)"}},DarkTheme={node:{palette:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"],lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{r:16,fill:"rgb(23,131,255)",lineWidth:0,zIndex:0}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgba(255,255,255,0.85)",opacity:.85,position:"bottom",zIndex:2,lod:0,maxWidth:"200%",textOverflow:"ellipsis",wordWrap:!0,maxLines:1}),labelBackgroundShape:{padding:[2,4,2,4],lineWidth:0,fill:"#000",opacity:.75,zIndex:1,lod:0},iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"#fff",fontSize:16,zIndex:1,lod:-1}),anchorShapes:{lineWidth:1,stroke:"#D0E4FF",fill:"#000",zIndex:2,r:3,lod:0},badgeShapes:{palette:["#7E92B5","#F86254","#EDB74B"],textColor:"#fff",zIndex:3,lod:-1},haloShape:{visible:!1,droppable:!1}},selected:{keyShape:{stroke:"#D0E4FF",lineWidth:3},labelShape:{fontWeight:700},haloShape:{opacity:.45,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},active:{keyShape:{lineWidth:0},haloShape:{opacity:.25,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},highlight:{keyShape:{stroke:"#D0E4FF",lineWidth:3},labelShape:{fontWeight:700},haloShape:{visible:!1,droppable:!1}},inactive:{keyShape:{opacity:.45},labelShape:{opacity:.45},iconShape:{opacity:.45},haloShape:{visible:!1,droppable:!1}},disable:{keyShape:{fill:"#D0E4FF",lineWidth:0},haloShape:{visible:!1,droppable:!1}}}]},edge:{palette:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"],lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{lineWidth:1,stroke:"#637088",increasedLineWidthForHitTesting:2,zIndex:1}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgba(255,255,255,0.85)",opacity:.85,position:"middle",textBaseline:"middle",zIndex:3,textOverflow:"ellipsis",wordWrap:!0,maxLines:1,maxWidth:"60%",lod:0}),labelBackgroundShape:{padding:[4,4,4,4],lineWidth:0,fill:"#000",opacity:.75,zIndex:2,lod:0},iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgb(140, 140, 140)",fontSize:16,zIndex:2,offsetX:-10,lod:-1})},selected:{keyShape:{lineWidth:2},labelShape:{fontWeight:700},haloShape:{opacity:.25,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},active:{keyShape:{lineWidth:1},haloShape:{opacity:.25,lineWidth:12,zIndex:-1,pointerEvents:"none",visible:!0,droppable:!1}},highlight:{keyShape:{lineWidth:2},labelShape:{fontWeight:700}},inactive:{keyShape:{stroke:"#637088",lineWidth:1,opacity:.45}},disable:{keyShape:{stroke:"#637088",opacity:.08,lineWidth:1}}}]},combo:{lodLevels:[{zoomRange:[0,.65]},{zoomRange:[.65,.8]},{zoomRange:[.8,1.6],primary:!0},{zoomRange:[1.6,2]},{zoomRange:[2,1/0]}],styles:[{default:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{fill:"rgb(253, 253, 253)",lineWidth:1,stroke:"#637088",r:5,width:20,height:10,padding:[25,20,15,20]}),labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgba(255,255,255,0.85)",opacity:.85,position:"bottom",zIndex:2,lod:0,maxLines:1}),labelBackgroundShape:{padding:[2,4,2,4],lineWidth:0,fill:"#000",opacity:.75,zIndex:1,lod:0}},selected:{keyShape:{stroke:"#D0E4FF",fill:"rgb(253, 253, 253)",lineWidth:2},labelShape:{fontWeight:700},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,stroke:"rgba(153,173,209,1)",droppable:!1}},active:{keyShape:{stroke:"#D0E4FF",lineWidth:1},haloShape:{opacity:.25,lineWidth:12,pointerEvents:"none",zIndex:-1,visible:!0,stroke:"rgba(153,173,209,1)",droppable:!1}},highlight:{keyShape:{stroke:"#D0E4FF",fill:"rgb(253, 253, 253)",lineWidth:2},labelShape:{fontWeight:700}},inactive:{keyShape:{stroke:"#637088",fill:"rgb(253, 253, 253)",lineWidth:1},labelShape:{opacity:.65}},disable:{keyShape:{fill:"#D0E4FF",opacity:.25},iconShape:{fill:"#D0E4FF",opacity:.25},labelShape:{opacity:.25}},collapsed:{keyShape:Object.assign(Object.assign({},DEFAULT_SHAPE_STYLE),{fill:"rgb(253, 253, 253)",lineWidth:1,stroke:"rgba(153,173,209,1)",r:16,width:48,height:24,padding:[25,20,15,20]}),iconShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{fill:"rgba(153,173,209,1)",fontSize:12,zIndex:1,lod:-1,contentType:"childCount",visible:!0})}}]},canvas:{backgroundColor:"#000"}};class BaseThemeSolver{constructor(options,themes){this.getSpecification=()=>this.specification,this.specification=this.solver(options,themes),this.options=options}destroy(){}}class SpecThemeSolver extends BaseThemeSolver{solver(options,themes){const{base="light",specification}=options,baseSpec=themes[base],mergedSpec=Object.assign({},baseSpec);return specification&&(["node","edge","combo"].forEach((itemType=>{if(!specification[itemType])return;const{palette=mergedSpec[itemType].palette,lodLevels=mergedSpec[itemType].lodLevels,dataTypeField}=specification[itemType];let{getStyleSets}=specification[itemType];dataTypeField&&!getStyleSets&&(getStyleSets=paletteProps=>{if((0,is_array.A)(paletteProps))return paletteProps.map((color=>({default:{keyShape:"edge"===itemType?{stroke:color}:{fill:color}}})));if((0,is_object.A)(paletteProps)){const res={};return Object.keys(paletteProps).map((dataType=>{res[dataType]={default:{keyShape:"edge"===itemType?{stroke:paletteProps[dataType]}:{fill:paletteProps[dataType]}}}})),res}});const{styles:[baseStyles]}=baseSpec[itemType],incomingStyles=(null==getStyleSets?void 0:getStyleSets(palette))||{};let mergedStyles;(0,is_array.A)(incomingStyles)?mergedStyles=incomingStyles.map((incomingStyle=>{const mergedStatesStyles=Object.assign({},baseStyles);return Object.keys(incomingStyle).forEach((stateName=>{mergedStatesStyles[stateName]=mergeStyles([baseStyles[stateName],incomingStyle[stateName]])})),mergedStatesStyles})):(mergedStyles={others:baseStyles},Object.keys(incomingStyles).forEach((dataType=>{const mergedStatesStyles=Object.assign({},baseStyles),incomingStyle=incomingStyles[dataType];Object.keys(incomingStyle).forEach((stateName=>{mergedStatesStyles[stateName]=mergeStyles([baseStyles[stateName],incomingStyle[stateName]])})),mergedStyles[dataType]=mergedStatesStyles}))),mergedSpec[itemType]={dataTypeField,palette,lodLevels,styles:mergedStyles}})),mergedSpec.canvas=Object.assign(Object.assign({},baseSpec.canvas),specification.canvas)),mergedSpec}}var color=__webpack_require__("./node_modules/color/index.js"),color_default=__webpack_require__.n(color);function util_bound01(n,max){(function isOnePointZero(n){return"string"==typeof n&&-1!==n.indexOf(".")&&1===parseFloat(n)})(n)&&(n="100%");var isPercent=function isPercentage(n){return"string"==typeof n&&-1!==n.indexOf("%")}(n);return n=360===max?n:Math.min(max,Math.max(0,parseFloat(n))),isPercent&&(n=parseInt(String(n*max),10)/100),Math.abs(n-max)<1e-6?1:n=360===max?(n<0?n%max+max:n%max)/parseFloat(String(max)):n%max/parseFloat(String(max))}function convertToPercentage(n){return n<=1?"".concat(100*Number(n),"%"):n}function util_pad2(c){return 1===c.length?"0"+c:String(c)}function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*t*(q-p):t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}function convertHexToDecimal(h){return parseIntFromHex(h)/255}function parseIntFromHex(val){return parseInt(val,16)}var names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function inputToRGB(color){var rgb={r:0,g:0,b:0},a=1,s=null,v=null,l=null,ok=!1,format=!1;return"string"==typeof color&&(color=function stringInputToObject(color){if(color=color.trim().toLowerCase(),0===color.length)return!1;var named=!1;if(names[color])color=names[color],named=!0;else if("transparent"===color)return{r:0,g:0,b:0,a:0,format:"name"};var match=matchers.rgb.exec(color);if(match)return{r:match[1],g:match[2],b:match[3]};if(match=matchers.rgba.exec(color),match)return{r:match[1],g:match[2],b:match[3],a:match[4]};if(match=matchers.hsl.exec(color),match)return{h:match[1],s:match[2],l:match[3]};if(match=matchers.hsla.exec(color),match)return{h:match[1],s:match[2],l:match[3],a:match[4]};if(match=matchers.hsv.exec(color),match)return{h:match[1],s:match[2],v:match[3]};if(match=matchers.hsva.exec(color),match)return{h:match[1],s:match[2],v:match[3],a:match[4]};if(match=matchers.hex8.exec(color),match)return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),a:convertHexToDecimal(match[4]),format:named?"name":"hex8"};if(match=matchers.hex6.exec(color),match)return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"};if(match=matchers.hex4.exec(color),match)return{r:parseIntFromHex(match[1]+match[1]),g:parseIntFromHex(match[2]+match[2]),b:parseIntFromHex(match[3]+match[3]),a:convertHexToDecimal(match[4]+match[4]),format:named?"name":"hex8"};if(match=matchers.hex3.exec(color),match)return{r:parseIntFromHex(match[1]+match[1]),g:parseIntFromHex(match[2]+match[2]),b:parseIntFromHex(match[3]+match[3]),format:named?"name":"hex"};return!1}(color)),"object"==typeof color&&(isValidCSSUnit(color.r)&&isValidCSSUnit(color.g)&&isValidCSSUnit(color.b)?(rgb=function rgbToRgb(r,g,b){return{r:255*util_bound01(r,255),g:255*util_bound01(g,255),b:255*util_bound01(b,255)}}(color.r,color.g,color.b),ok=!0,format="%"===String(color.r).substr(-1)?"prgb":"rgb"):isValidCSSUnit(color.h)&&isValidCSSUnit(color.s)&&isValidCSSUnit(color.v)?(s=convertToPercentage(color.s),v=convertToPercentage(color.v),rgb=function hsvToRgb(h,s,v){h=6*util_bound01(h,360),s=util_bound01(s,100),v=util_bound01(v,100);var i=Math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6;return{r:255*[v,q,p,p,t,v][mod],g:255*[t,v,v,q,p,p][mod],b:255*[p,p,t,v,v,q][mod]}}(color.h,s,v),ok=!0,format="hsv"):isValidCSSUnit(color.h)&&isValidCSSUnit(color.s)&&isValidCSSUnit(color.l)&&(s=convertToPercentage(color.s),l=convertToPercentage(color.l),rgb=function hslToRgb(h,s,l){var r,g,b;if(h=util_bound01(h,360),s=util_bound01(s,100),l=util_bound01(l,100),0===s)g=l,b=l,r=l;else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return{r:255*r,g:255*g,b:255*b}}(color.h,s,l),ok=!0,format="hsl"),Object.prototype.hasOwnProperty.call(color,"a")&&(a=color.a)),a=function boundAlpha(a){return a=parseFloat(a),(isNaN(a)||a<0||a>1)&&(a=1),a}(a),{ok,format:color.format||format,r:Math.min(255,Math.max(rgb.r,0)),g:Math.min(255,Math.max(rgb.g,0)),b:Math.min(255,Math.max(rgb.b,0)),a}}var CSS_UNIT="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),PERMISSIVE_MATCH3="[\\s|\\(]+(".concat(CSS_UNIT,")[,|\\s]+(").concat(CSS_UNIT,")[,|\\s]+(").concat(CSS_UNIT,")\\s*\\)?"),PERMISSIVE_MATCH4="[\\s|\\(]+(".concat(CSS_UNIT,")[,|\\s]+(").concat(CSS_UNIT,")[,|\\s]+(").concat(CSS_UNIT,")[,|\\s]+(").concat(CSS_UNIT,")\\s*\\)?"),matchers={CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function isValidCSSUnit(color){return Boolean(matchers.CSS_UNIT.exec(String(color)))}var hueStep=2,saturationStep=.16,saturationStep2=.05,brightnessStep1=.05,brightnessStep2=.15,lightColorCount=5,darkColorCount=4,darkColorMap=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function toHsv(_ref){var hsv=function rgbToHsv(r,g,b){r=util_bound01(r,255),g=util_bound01(g,255),b=util_bound01(b,255);var max=Math.max(r,g,b),min=Math.min(r,g,b),h=0,v=max,d=max-min,s=0===max?0:d/max;if(max===min)h=0;else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h,s,v}}(_ref.r,_ref.g,_ref.b);return{h:360*hsv.h,s:hsv.s,v:hsv.v}}function toHex(_ref2){var r=_ref2.r,g=_ref2.g,b=_ref2.b;return"#".concat(function rgbToHex(r,g,b,allow3Char){var hex=[util_pad2(Math.round(r).toString(16)),util_pad2(Math.round(g).toString(16)),util_pad2(Math.round(b).toString(16))];return allow3Char&&hex[0].startsWith(hex[0].charAt(1))&&hex[1].startsWith(hex[1].charAt(1))&&hex[2].startsWith(hex[2].charAt(1))?hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0):hex.join("")}(r,g,b,!1))}function getHue(hsv,i,light){var hue;return(hue=Math.round(hsv.h)>=60&&Math.round(hsv.h)<=240?light?Math.round(hsv.h)-hueStep*i:Math.round(hsv.h)+hueStep*i:light?Math.round(hsv.h)+hueStep*i:Math.round(hsv.h)-hueStep*i)<0?hue+=360:hue>=360&&(hue-=360),hue}function getSaturation(hsv,i,light){return 0===hsv.h&&0===hsv.s?hsv.s:((saturation=light?hsv.s-saturationStep*i:i===darkColorCount?hsv.s+saturationStep:hsv.s+saturationStep2*i)>1&&(saturation=1),light&&i===lightColorCount&&saturation>.1&&(saturation=.1),saturation<.06&&(saturation=.06),Number(saturation.toFixed(2)));var saturation}function getValue(hsv,i,light){var value;return(value=light?hsv.v+brightnessStep1*i:hsv.v-brightnessStep2*i)>1&&(value=1),Number(value.toFixed(2))}function generate(color){for(var opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},patterns=[],pColor=inputToRGB(color),i=lightColorCount;i>0;i-=1){var hsv=toHsv(pColor),colorString=toHex(inputToRGB({h:getHue(hsv,i,!0),s:getSaturation(hsv,i,!0),v:getValue(hsv,i,!0)}));patterns.push(colorString)}patterns.push(toHex(pColor));for(var _i=1;_i<=darkColorCount;_i+=1){var _hsv=toHsv(pColor),_colorString=toHex(inputToRGB({h:getHue(_hsv,_i),s:getSaturation(_hsv,_i),v:getValue(_hsv,_i)}));patterns.push(_colorString)}return"dark"===opts.theme?darkColorMap.map((function(_ref3){var index=_ref3.index,opacity=_ref3.opacity;return toHex(function generate_mix(rgb1,rgb2,amount){var p=amount/100;return{r:(rgb2.r-rgb1.r)*p+rgb1.r,g:(rgb2.g-rgb1.g)*p+rgb1.g,b:(rgb2.b-rgb1.b)*p+rgb1.b}}(inputToRGB(opts.backgroundColor||"#141414"),inputToRGB(patterns[index]),100*opacity))})):patterns}var presetPrimaryColors={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},presetPalettes={},presetDarkPalettes={};Object.keys(presetPrimaryColors).forEach((function(key){presetPalettes[key]=generate(presetPrimaryColors[key]),presetPalettes[key].primary=presetPalettes[key][5],presetDarkPalettes[key]=generate(presetPrimaryColors[key],{theme:"dark",backgroundColor:"#141414"}),presetDarkPalettes[key].primary=presetDarkPalettes[key][5]}));presetPalettes.red,presetPalettes.volcano,presetPalettes.gold,presetPalettes.orange,presetPalettes.yellow,presetPalettes.lime,presetPalettes.green,presetPalettes.cyan,presetPalettes.blue,presetPalettes.geekblue,presetPalettes.purple,presetPalettes.magenta,presetPalettes.grey,presetPalettes.grey;class SubjectThemeSolver extends BaseThemeSolver{solver(options,themes){const{base="light",baseColor="#fff",specification}=options,baseSpec=themes[base],mergedSpec=Object.assign({},baseSpec);return specification&&(["node","edge","combo"].forEach((itemType=>{if(!specification[itemType])return;const{palette,dataTypeField}=specification[itemType],{styles:[baseStyles]}=baseSpec[itemType];let mergedStyles;(0,is_array.A)(palette)?mergedStyles=palette.map((subjectColor=>{const colorSet=getColorsWithSubjectColor(subjectColor,baseColor,base);return this.getMergeStylesFromColorSet(itemType,colorSet,baseStyles)})):(mergedStyles={others:baseStyles},Object.keys(palette).forEach((dataType=>{const subjectColor=palette[dataType],colorSet=getColorsWithSubjectColor(subjectColor,baseColor,base);mergedStyles[dataType]=this.getMergeStylesFromColorSet(itemType,colorSet,baseStyles)}))),mergedSpec[itemType]={dataTypeField,palette,styles:mergedStyles}})),mergedSpec.canvas=Object.assign(Object.assign({},baseSpec.canvas),specification.canvas)),mergedSpec.canvas=Object.assign(Object.assign({},baseSpec.canvas),specification.canvas),mergedSpec}getMergeStylesFromColorSet(itemType,colorSet,baseStyles){const mergedStatesStyles=Object.assign({},baseStyles);return"node"===itemType?(mergedStatesStyles.default=mergeStyles([baseStyles.default,{keyShape:{stroke:colorSet.mainStroke,fill:colorSet.mainFill}}]),mergedStatesStyles.selected=mergeStyles([baseStyles.selected,{keyShape:{fill:colorSet.selectedFill,stroke:colorSet.selectedStroke,shadowColor:colorSet.selectedStroke}}]),mergedStatesStyles.active=mergeStyles([baseStyles.active,{keyShape:{fill:colorSet.activeFill,stroke:colorSet.activeStroke,shadowColor:colorSet.mainStroke}}]),mergedStatesStyles.highlight=mergeStyles([baseStyles.highlight,{keyShape:{fill:colorSet.highlightFill,stroke:colorSet.highlightStroke}}]),mergedStatesStyles.inactive=mergeStyles([baseStyles.inactive,{keyShape:{fill:colorSet.inactiveFill,stroke:colorSet.inactiveStroke}}]),mergedStatesStyles.disable=mergeStyles([baseStyles.disable,{keyShape:{fill:colorSet.disableFill,stroke:colorSet.disableStroke}}])):"edge"===itemType?(mergedStatesStyles.default=mergeStyles([baseStyles.default,{keyShape:{stroke:colorSet.edgeMainStroke}}]),mergedStatesStyles.selected=mergeStyles([baseStyles.selected,{keyShape:{stroke:colorSet.edgeSelectedStroke,shadowColor:colorSet.edgeSelectedStroke}}]),mergedStatesStyles.active=mergeStyles([baseStyles.active,{keyShape:{stroke:colorSet.edgeActiveStroke}}]),mergedStatesStyles.highlight=mergeStyles([baseStyles.highlight,{keyShape:{stroke:colorSet.edgeHighlightStroke}}]),mergedStatesStyles.inactive=mergeStyles([baseStyles.inactive,{keyShape:{stroke:colorSet.edgeInactiveStroke}}]),mergedStatesStyles.disable=mergeStyles([baseStyles.disable,{keyShape:{stroke:colorSet.edgeDisableStroke}}])):"combo"===itemType&&(mergedStatesStyles.default=mergeStyles([baseStyles.default,{keyShape:{fill:colorSet.comboMainFill,stroke:colorSet.comboMainStroke}}]),mergedStatesStyles.selected=mergeStyles([baseStyles.selected,{keyShape:{stroke:colorSet.comboSelectedStroke,fill:colorSet.comboSelectedFill,shadowColor:colorSet.comboSelectedStroke}}]),mergedStatesStyles.active=mergeStyles([baseStyles.active,{keyShape:{stroke:colorSet.comboActiveStroke,fill:colorSet.comboActiveFill}}]),mergedStatesStyles.highlight=mergeStyles([baseStyles.highlight,{keyShape:{stroke:colorSet.comboHighlightStroke,fill:colorSet.comboHighlightFill}}]),mergedStatesStyles.inactive=mergeStyles([baseStyles.inactive,{keyShape:{stroke:colorSet.comboInactiveStroke,fill:colorSet.comboInactiveFill}}]),mergedStatesStyles.disable=mergeStyles([baseStyles.disable,{keyShape:{stroke:colorSet.comboDisableStroke,fill:colorSet.comboDisableFill}}])),mergedStatesStyles}}const mixColor=(backColor,frontColor,frontAlpha)=>{const bc=color_default()(backColor),fc=color_default()(frontColor);return color_default()([(1-frontAlpha)*bc.red()+frontAlpha*fc.red(),(1-frontAlpha)*bc.green()+frontAlpha*fc.green(),(1-frontAlpha)*bc.blue()+frontAlpha*fc.blue()]).rgb()},getColorsWithSubjectColor=(subjectColor,backColor="#fff",theme="light")=>"light"!==theme?((subjectColor,backColor="#fff",disableColor="#777")=>{const subjectColor02=mixColor(backColor,subjectColor,.2).rgb().toString(),subjectColor03=mixColor(backColor,subjectColor,.3).rgb().toString(),subjectColor06=mixColor(backColor,subjectColor,.6).rgb().toString(),subjectColor08=mixColor(backColor,subjectColor,.8).rgb().toString(),disableColor02=mixColor(backColor,disableColor,.2).rgb().toString(),disableColor025=mixColor(backColor,disableColor,.25).rgb().toString(),disableColor03=mixColor(backColor,disableColor,.3).rgb().toString(),disableColor04=mixColor(backColor,disableColor,.4).rgb().toString(),disableColor05=mixColor(backColor,disableColor,.5).rgb().toString(),paletteFromSubject=generate(subjectColor,{theme:"dark",backgroundColor:backColor}),subjectHex=color_default()(subjectColor).hex().toLowerCase(),subjectIdx=paletteFromSubject.indexOf(subjectHex);let deeperSubject=subjectColor;return-1!==subjectIdx&&(deeperSubject=paletteFromSubject[subjectIdx+1]),{mainStroke:subjectColor08,mainFill:subjectColor02,activeStroke:subjectColor,activeFill:subjectColor03,inactiveStroke:subjectColor08,inactiveFill:subjectColor02,selectedStroke:subjectColor,selectedFill:subjectColor02,highlightStroke:subjectColor,highlightFill:subjectColor06,disableStroke:disableColor05,disableFill:disableColor025,edgeMainStroke:subjectColor08,edgeActiveStroke:subjectColor,edgeInactiveStroke:disableColor,edgeSelectedStroke:subjectColor,edgeHighlightStroke:subjectColor,edgeDisableStroke:disableColor03,comboMainStroke:disableColor04,comboMainFill:disableColor025,comboActiveStroke:subjectColor,comboActiveFill:disableColor02,comboInactiveStroke:disableColor04,comboInactiveFill:disableColor025,comboSelectedStroke:subjectColor,comboSelectedFill:disableColor02,comboHighlightStroke:deeperSubject,comboHighlightFill:disableColor025,comboDisableStroke:disableColor04,comboDisableFill:disableColor02}})(subjectColor,backColor,"#777"):((subjectColor,backColor="#fff",disableColor="rgb(150, 150, 150)")=>{const subjectColor005=mixColor(backColor,subjectColor,.05).rgb().toString(),subjectColor01=mixColor(backColor,subjectColor,.1).rgb().toString(),subjectColor02=mixColor(backColor,subjectColor,.2).rgb().toString(),subjectColor04=mixColor(backColor,subjectColor,.4).rgb().toString(),disableColor002=mixColor(backColor,disableColor,.02).rgb().toString(),disableColor005=mixColor(backColor,disableColor,.05).rgb().toString(),disableColor01=mixColor(backColor,disableColor,.1).rgb().toString(),disableColor02=mixColor(backColor,disableColor,.2).rgb().toString(),disableColor03=mixColor(backColor,disableColor,.3).rgb().toString(),paletteFromSubject=generate(subjectColor,{theme:"default",backgroundColor:backColor}),subjectHex=color_default()(subjectColor).hex().toLowerCase(),subjectIdx=paletteFromSubject.indexOf(subjectHex);let deeperSubject=subjectColor;return-1!==subjectIdx&&(deeperSubject=paletteFromSubject[subjectIdx+1]),{mainStroke:subjectColor,mainFill:subjectColor01,activeStroke:subjectColor,activeFill:subjectColor005,inactiveStroke:subjectColor04,inactiveFill:subjectColor005,selectedStroke:subjectColor,selectedFill:subjectColor01,highlightStroke:deeperSubject,highlightFill:subjectColor02,disableStroke:disableColor03,disableFill:disableColor005,edgeMainStroke:subjectColor04,edgeActiveStroke:subjectColor,edgeInactiveStroke:disableColor02,edgeSelectedStroke:subjectColor,edgeHighlightStroke:subjectColor,edgeDisableStroke:disableColor01,comboMainStroke:disableColor03,comboMainFill:disableColor002,comboActiveStroke:subjectColor,comboActiveFill:subjectColor005,comboInactiveStroke:disableColor03,comboInactiveFill:disableColor002,comboSelectedStroke:subjectColor,comboSelectedFill:disableColor002,comboHighlightStroke:deeperSubject,comboHighlightFill:disableColor002,comboDisableStroke:disableColor02,comboDisableFill:disableColor005}})(subjectColor,backColor,"rgb(150, 150, 150)");function getEucliDis(pointA,pointB,eps){const vx=pointA.x-pointB.x,vy=pointA.y-pointB.y;return!eps||Math.abs(vx)>eps||Math.abs(vy)>eps?Math.sqrt(vx*vx+vy*vy):eps}function projectPointToEdge(p,e){const k=(e.source.data.y-e.target.data.y)/(e.source.data.x-e.target.data.x),x=(k*k*e.source.data.x+k*(p.y-e.source.data.y)+p.x)/(k*k+1);return{x,y:k*(x-e.source.data.x)+e.source.data.y}}class EdgeBundling extends plugin_Plugin{constructor(config){super(config),this.nodeIdMap={}}getDefaultCfgs(){return{edgeBundles:[],edgePoints:[],K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:.6666667,bundleThreshold:.6,eps:1e-6}}init(graph){super.init(graph)}setOptionByKey(key,value){this.options[key]=value}getOptionByKey(key){return this.options[key]}bundling(data){if(this.destroyed)return;const self=this;self.setOptionByKey("data",data);const edges=data.edges||[],nodes=data.nodes||[],nodeIdMap={};let error=!1;if(nodes.forEach((node=>{var _a,_b,_c,_d;null!==(null===(_a=node.data)||void 0===_a?void 0:_a.x)&&null!==!(null===(_b=node.data)||void 0===_b?void 0:_b.y)&&void 0!==(null===(_c=node.data)||void 0===_c?void 0:_c.x)&&void 0!==!(null===(_d=node.data)||void 0===_d?void 0:_d.y)||(error=!0),nodeIdMap[node.id]=node})),error)throw new Error("please layout the graph or assign x and y for nodes first");self.nodeIdMap=nodeIdMap;let divisions=self.getOptionByKey("divisions");const divRate=self.getOptionByKey("divRate");let edgePoints=self.divideEdges(divisions);self.setOptionByKey("edgePoints",edgePoints);const edgeBundles=self.getEdgeBundles();self.setOptionByKey("edgeBundles",edgeBundles);const C=self.getOptionByKey("cycles");let iterations=self.getOptionByKey("iterations");const iterRate=self.getOptionByKey("iterRate");let lambda=self.getOptionByKey("lambda");for(let i=0;i<C;i++){for(let j=0;j<iterations;j++){const forces=[];edges.forEach(((e,k)=>{if(e.source===e.target)return;const source=nodeIdMap[e.source],target=nodeIdMap[e.target];forces[k]=self.getEdgeForces({source,target},k,divisions,lambda);for(let p=0;p<divisions+1;p++)edgePoints[k][p].x+=forces[k][p].x,edgePoints[k][p].y+=forces[k][p].y}))}lambda/=2,divisions*=divRate,iterations*=iterRate,edgePoints=self.divideEdges(divisions),self.setOptionByKey("edgePoints",edgePoints)}edges.forEach(((e,i)=>{e.source!==e.target&&(e.data.type="polyline-edge","object"==typeof e.data.keyShape?e.data.keyShape.controlPoints=edgePoints[i].slice(1,edgePoints[i].length-1):e.data.keyShape={controlPoints:edgePoints[i].slice(1,edgePoints[i].length-1)})}));self.graph.updateData("edge",edges);const onTick=this.getOptionByKey("onTick");onTick&&onTick()}updateBundling(cfg){const self=this,{data}=cfg;data&&self.setOptionByKey("data",data),Object.keys(cfg).forEach((key=>{self.setOptionByKey(key,cfg[key])})),self.bundling(data)}divideEdges(divisions){const self=this,edges=self.getOptionByKey("data").edges,nodeIdMap=self.nodeIdMap;let edgePoints=self.getOptionByKey("edgePoints");return edgePoints&&void 0!==edgePoints||(edgePoints=[]),edges.forEach(((edge,i)=>{var _a;edgePoints[i]&&void 0!==edgePoints[i]||(edgePoints[i]=[]);const source=nodeIdMap[edge.source],target=nodeIdMap[edge.target];if(1===divisions)edgePoints[i].push({x:source.data.x,y:source.data.y}),edgePoints[i].push({x:.5*(source.data.x+target.data.x),y:.5*(source.data.y+target.data.y)}),edgePoints[i].push({x:target.data.x,y:target.data.y});else{let edgeLength=0;edgeLength=(null===(_a=edgePoints[i])||void 0===_a?void 0:_a.length)?self.getEdgeLength(edgePoints[i]):getEucliDis({x:source.data.x,y:source.data.y},{x:target.data.x,y:target.data.y});const divisionLength=edgeLength/(divisions+1);let currentDivisonLength=divisionLength;const newEdgePoints=[{x:source.data.x,y:source.data.y}];edgePoints[i].forEach(((ep,j)=>{if(0===j)return;let oriDivisionLength=getEucliDis(ep,edgePoints[i][j-1]);for(;oriDivisionLength>currentDivisonLength;){const ratio=currentDivisonLength/oriDivisionLength,edgePoint={x:edgePoints[i][j-1].x,y:edgePoints[i][j-1].y};edgePoint.x+=ratio*(ep.x-edgePoints[i][j-1].x),edgePoint.y+=ratio*(ep.y-edgePoints[i][j-1].y),newEdgePoints.push(edgePoint),oriDivisionLength-=currentDivisonLength,currentDivisonLength=divisionLength}currentDivisonLength-=oriDivisionLength})),newEdgePoints.push({x:target.data.x,y:target.data.y}),edgePoints[i]=newEdgePoints}})),edgePoints}getEdgeLength(points){let length=0;return points.forEach(((p,i)=>{0!==i&&(length+=getEucliDis(p,points[i-1]))})),length}getEdgeBundles(){const self=this,edges=self.getOptionByKey("data").edges||[],bundleThreshold=self.getOptionByKey("bundleThreshold"),nodeIdMap=self.nodeIdMap;let edgeBundles=self.getOptionByKey("edgeBundles");return edgeBundles||(edgeBundles=[]),edges.forEach(((e,i)=>{edgeBundles[i]&&void 0!==edgeBundles[i]||(edgeBundles[i]=[])})),edges.forEach(((ei,i)=>{const iSource=nodeIdMap[ei.source],iTarget=nodeIdMap[ei.target];edges.forEach(((ej,j)=>{if(j<=i)return;const jSource=nodeIdMap[ej.source],jTarget=nodeIdMap[ej.target];self.getBundleScore({source:iSource,target:iTarget},{source:jSource,target:jTarget})>=bundleThreshold&&(edgeBundles[i].push(j),edgeBundles[j].push(i))}))})),edgeBundles}getBundleScore(ei,ej){ei.vx=ei.target.data.x-ei.source.data.x,ei.vy=ei.target.data.y-ei.source.data.y,ej.vx=ej.target.data.x-ej.source.data.x,ej.vy=ej.target.data.y-ej.source.data.y,ei.length=getEucliDis({x:ei.source.data.x,y:ei.source.data.y},{x:ei.target.data.x,y:ei.target.data.y}),ej.length=getEucliDis({x:ej.source.data.x,y:ej.source.data.y},{x:ej.target.data.x,y:ej.target.data.y});return this.getAngleScore(ei,ej)*this.getScaleScore(ei,ej)*this.getPositionScore(ei,ej)*this.getVisibilityScore(ei,ej)}getAngleScore(ei,ej){const dotProduct=function getDotProduct(ei,ej){return ei.x*ej.x+ei.y*ej.y}({x:ei.vx,y:ei.vy},{x:ej.vx,y:ej.vy});return dotProduct/(ei.length*ej.length)}getScaleScore(ei,ej){const aLength=(ei.length+ej.length)/2;return 2/(aLength/Math.min(ei.length,ej.length)+Math.max(ei.length,ej.length)/aLength)}getPositionScore(ei,ej){const aLength=(ei.length+ej.length)/2;return aLength/(aLength+getEucliDis({x:(ei.source.data.x+ei.target.data.x)/2,y:(ei.source.data.y+ei.target.data.y)/2},{x:(ej.source.data.x+ej.target.data.x)/2,y:(ej.source.data.y+ej.target.data.y)/2}))}getVisibilityScore(ei,ej){const vij=this.getEdgeVisibility(ei,ej),vji=this.getEdgeVisibility(ej,ei);return vij<vji?vij:vji}getEdgeVisibility(ei,ej){const ps=projectPointToEdge(ej.source.data,ei),pt=projectPointToEdge(ej.target.data,ei),pMid={x:(ps.x+pt.x)/2,y:(ps.y+pt.y)/2},iMid={x:(ei.source.data.x+ei.target.data.x)/2,y:(ei.source.data.y+ei.target.data.y)/2};return Math.max(0,1-2*getEucliDis(pMid,iMid)/getEucliDis(ps,pt))}getEdgeForces(e,eidx,divisions,lambda){const self=this,edgePoints=self.getOptionByKey("edgePoints"),kp=self.getOptionByKey("K")/(getEucliDis(e.source.data,e.target.data)*(divisions+1)),edgePointForces=[{x:0,y:0}];for(let i=1;i<divisions;i++){const force={x:0,y:0},spring=self.getSpringForce({pre:edgePoints[eidx][i-1],cur:edgePoints[eidx][i],next:edgePoints[eidx][i+1]},kp),electrostatic=self.getElectrostaticForce(i,eidx);force.x=lambda*(spring.x+electrostatic.x),force.y=lambda*(spring.y+electrostatic.y),edgePointForces.push(force)}return edgePointForces.push({x:0,y:0}),edgePointForces}getSpringForce(divisions,kp){let x=divisions.pre.x+divisions.next.x-2*divisions.cur.x,y=divisions.pre.y+divisions.next.y-2*divisions.cur.y;return x*=kp,y*=kp,{x,y}}getElectrostaticForce(pidx,eidx){const eps=this.getOptionByKey("eps"),edgeBundles=this.getOptionByKey("edgeBundles"),edgePoints=this.getOptionByKey("edgePoints"),edgeBundle=edgeBundles[eidx],resForce={x:0,y:0};return edgeBundle.forEach((eb=>{const force={x:edgePoints[eb][pidx].x-edgePoints[eidx][pidx].x,y:edgePoints[eb][pidx].y-edgePoints[eidx][pidx].y};if(Math.abs(force.x)>eps||Math.abs(force.y)>eps){const diff=1/getEucliDis(edgePoints[eb][pidx],edgePoints[eidx][pidx]);resForce.x+=force.x*diff,resForce.y+=force.y*diff}})),resForce}destroy(){super.destroy()}}const lensDelegateStyle={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"};class Fisheye extends plugin_Plugin{constructor(options){super(options),this.pointerDown=void 0,this.cacheCenter=void 0,this.dragPrePos=void 0,this.dragging=!1,this.cachedOriginPositions={},this.cachedTransientTexts={},this.initOriginPositions=()=>{const{graph}=this,positions={};return graph.getAllNodesData().forEach((node=>{positions[node.id]={x:node.data.x,y:node.data.y,texts:[]}})),this.cachedOriginPositions=positions,positions},this.scaleRByDrag=throttle(this.scaleRByDragMethod.bind(this),this.options.throttle,{leading:!0,trailing:!0}),this.scaleDByDrag=throttle(this.scaleDByDragMethod.bind(this),this.options.throttle,{leading:!0,trailing:!0})}getDefaultCfgs(){return{key:`fisheye-${unique_id()}`,trigger:"mousemove",d:1.5,r:300,delegateStyle:cloneJSON(lensDelegateStyle),showLabel:!0,maxD:5,minD:0,throttle:16,scaleRBy:"drag",scaleDBy:"drag",showDPercent:!0}}getEvents(){const events={pointerdown:this.onPointerDown,pointerup:this.onPointerUp,wheel:this.onWheel,afterlayout:this.initOriginPositions};switch(this.options.trigger){case"click":return Object.assign(Object.assign({},events),{click:this.magnify});case"drag":return Object.assign(Object.assign({},events),{pointermove:this.onPointerMove});default:return Object.assign(Object.assign({},events),{pointermove:this.magnify})}}init(graph){super.init(graph);const{r,d}=this.options;this.cachedTransientTexts={},this.initOriginPositions(),this.r2=r*r,this.molecularParam=(d+1)*r}isInLensDelegate(lensDelegate,pointer){const{cx:lensX,cy:lensY,r:lensR}=lensDelegate.style;return pointer.x>=lensX-lensR&&pointer.x<=lensX+lensR&&pointer.y>=lensY-lensR&&pointer.y<=lensY+lensR}onPointerUp(e){this.pointerDown=void 0,this.cacheCenter=void 0,this.dragging=!1}onPointerMove(e){!this.dragging&&this.pointerDown&&(this.dragging=!0),this.pointerDown&&this.moveDelegate(this.delegate,e)}onPointerDown(e){const{delegate:lensDelegate}=this;!lensDelegate||lensDelegate.destroyed?(this.cacheCenter={x:e.canvas.x,y:e.canvas.y},this.magnify(e)):this.cacheCenter={x:lensDelegate.attr("cx"),y:lensDelegate.attr("cy")},this.pointerDown={x:e.canvas.x,y:e.canvas.y},this.dragging=!1,this.dragPrePos={x:e.canvas.x,y:e.canvas.y}}moveDelegate(lensDelegate,e){this.isInLensDelegate(lensDelegate,{x:e.canvas.x,y:e.canvas.y})&&(this.delegateCenterDiff={x:e.canvas.x-this.pointerDown.x,y:e.canvas.y-this.pointerDown.y},this.magnify(e,this.cacheCenter))}onWheel(e){const{delegate:lensDelegate,options}=this,{scaleDBy,scaleRBy}=options;lensDelegate&&!lensDelegate.destroyed&&("wheel"!==scaleDBy&&"wheel"!==scaleRBy||this.isInLensDelegate(lensDelegate,{x:e.canvas.x,y:e.canvas.y})&&("wheel"===scaleRBy&&this.scaleRByWheel(e),"wheel"===scaleDBy&&this.scaleDByWheel(e)))}scaleRByWheel(e){if(!e||!e.originalEvent)return;e.preventDefault&&e.preventDefault();const{graph,options}=this;let ratio;const{delegate:lensDelegate,maxR,minR,d}=options;let{r}=options;const mousePos=(lensDelegate?{x:lensDelegate.attr("cx"),y:lensDelegate.attr("cy")}:void 0)||{x:e.canvas.x,y:e.canvas.y};ratio=e.originalEvent.deltaY<0?.95:1/.95;const graphHeight=graph.canvas.context.config.canvas.height;(r>(maxR||graphHeight)&&ratio>1||r<(minR||.05*graphHeight)&&ratio<1)&&(ratio=1),r*=ratio,this.options.r=r,this.r2=r*r,this.molecularParam=(d+1)*r,this.delegateCenterDiff=void 0,this.magnify(e,mousePos)}scaleRByDragMethod(e){if(!e)return;const{dragPrePos,graph,options}=this,{maxR,minR,d}=options;let ratio,{r}=options;ratio=e.canvas.x-dragPrePos.x<0?.95:1/.95;const graphCanvasEl=graph.canvas.context.config.canvas,[graphWidth=(null==graphCanvasEl?void 0:graphCanvasEl.width)||500,graphHeight=(null==graphCanvasEl?void 0:graphCanvasEl.height)||500]=graph.getSize();(r>(maxR||graphHeight)&&ratio>1||r<(minR||.05*graphHeight)&&ratio<1)&&(ratio=1),r*=ratio,this.options.r=r,this.r2=r*r,this.molecularParam=(d+1)*r,this.magnify(e),this.dragPrePos={x:e.canvas.x,y:e.canvas.y}}scaleDByWheel(evt){if(!evt&&!evt.originalEvent)return;evt.preventDefault&&evt.preventDefault();let delta=0;delta=evt.originalEvent.deltaY<0?-.1:.1;const{d,maxD,minD,r}=this.options,newD=d+delta;if(newD<maxD&&newD>minD){this.options.d=newD,this.molecularParam=(newD+1)*r;const{delegate:lensDelegate}=this,lensCenter=lensDelegate?{x:lensDelegate.attr("cx"),y:lensDelegate.attr("cy")}:void 0;this.delegateCenterDiff=void 0,this.magnify(evt,lensCenter)}}scaleDByDragMethod(e){const{d,maxD,minD,r}=this.options,newD=d+(e.canvas.x-this.dragPrePos.x>0?.1:-.1);newD<maxD&&newD>minD&&(this.options.d=newD,this.molecularParam=(newD+1)*r,this.magnify(e)),this.dragPrePos={x:e.canvas.x,y:e.canvas.y}}magnify(e,mousePos){var _a;this.restoreCache();const{r2,graph,cachedOriginPositions,cachedTransientTexts,molecularParam,delegateCenterDiff,options}=this,positions=Object.keys(cachedOriginPositions).map((id=>({id,data:{x:cachedOriginPositions[id].x,y:cachedOriginPositions[id].y}}))),{r,d,showLabel,trigger}=options,nodes=graph.getAllNodesData(),nodeLength=nodes.length,point=graph.getCanvasByClient(e.client);let mCenter=mousePos?{x:mousePos.x,y:mousePos.y}:{x:point.x,y:point.y};!this.dragging||"mousemove"!==trigger&&"click"!==trigger||(mCenter=this.cacheCenter),delegateCenterDiff&&(mCenter.x+=delegateCenterDiff.x,mCenter.y+=delegateCenterDiff.y),this.updateDelegate(mCenter,r,e);for(let i=0;i<nodeLength;i++){const model=nodes[i],{x,y}=cachedOriginPositions[model.id];if(isNaN(x)||isNaN(y))continue;const dist2=(x-mCenter.x)*(x-mCenter.x)+(y-mCenter.y)*(y-mCenter.y);if(!isNaN(dist2)&&dist2<r2&&0!==dist2){const dist=Math.sqrt(dist2),magnifiedDist=molecularParam*dist/(d*dist+r),vecX=(x-mCenter.x)/dist,vecY=(y-mCenter.y)/dist,magnifiedX=vecX*magnifiedDist+mCenter.x,magnifiedY=vecY*magnifiedDist+mCenter.y,magnifiedNode={id:model.id,data:{x:magnifiedX,y:magnifiedY}},textContent=model.data.label||(null===(_a=model.data.labelShape)||void 0===_a?void 0:_a.text);if(showLabel&&2*dist<r){const transientTextID=`node-text-${model.id}`,cachedTransientText=cachedTransientTexts[transientTextID];if(cachedTransientText)cachedTransientText.attr({x:magnifiedNode.data.x,y:magnifiedNode.data.y}),cachedTransientText.show(),cachedOriginPositions[model.id].texts.push(cachedTransientText);else if(textContent){const text=graph.drawTransient("text",transientTextID,{style:{text:textContent,x:magnifiedNode.data.x,y:magnifiedNode.data.y,textAlign:"center",textBaseline:"middle",fill:"#000",lineWidth:1,fontSize:12,isBillboard:!0,lod:-1}});cachedTransientTexts[transientTextID]=text,cachedOriginPositions[model.id].texts.push(text)}}positions[model.id]=magnifiedNode}else cachedOriginPositions[model.id]||(cachedOriginPositions[model.id]={x,y,texts:[]})}graph.updateNodePosition(Object.values(positions))}restoreCache(){const cachePositions=Object.assign({},this.cachedOriginPositions);return Object.values(this.cachedOriginPositions).forEach((position=>{var _a;null===(_a=position.texts)||void 0===_a||_a.forEach((text=>text.hide()))})),cachePositions}updateParams(cfg){const{r,d,trigger,minD,maxD,minR,maxR,scaleDBy,scaleRBy}=cfg;isNaN(cfg.r)||(this.options.r=r,this.r2=r*r),isNaN(d)||(this.options.d=d),isNaN(maxD)||(this.options.maxD=maxD),isNaN(minD)||(this.options.minD=minD),isNaN(maxR)||(this.options.maxR=maxR),isNaN(minR)||(this.options.minR=minR);const{graph,dPercentText,options}=this,{d:nd,r:nr}=options;this.molecularParam=(nd+1)*nr,"mousemove"!==trigger&&"click"!==trigger&&"drag"!==trigger||(this.options.trigger=trigger),"drag"!==scaleDBy&&"wheel"!==scaleDBy&&"unset"!==scaleDBy||(this.options.scaleDBy=scaleDBy,graph.drawTransient("circle","lens-shape",{action:"remove"}),dPercentText&&graph.drawTransient("text","lens-text-shape",{action:"remove"})),"drag"!==scaleRBy&&"wheel"!==scaleRBy&&"unset"!==scaleRBy||(this.options.scaleRBy=scaleRBy,graph.drawTransient("circle","lens-shape",{action:"remove"}),dPercentText&&graph.drawTransient("text","lens-text-shape",{action:"remove"}))}updateDelegate(mCenter,r,e){const{graph,dPercentText}=this;let lensDelegate=this.delegate;if(!lensDelegate||lensDelegate.destroyed){const attrs=this.options.delegateStyle||lensDelegateStyle;lensDelegate=graph.drawTransient("circle","lens-shape",{style:Object.assign({r:r/1.5,cx:mCenter.x,cy:mCenter.y},attrs)})}else lensDelegate.attr({cx:mCenter.x,cy:mCenter.y,r:r/1.5});const{d,minD,maxD,showDPercent}=this.options;if(showDPercent){const percent=Math.round((d-minD)/(maxD-minD)*100),textY=mCenter.y+r/1.5+16;if(!dPercentText||dPercentText.destroyed){const text=graph.drawTransient("text","lens-text-shape",{style:{text:`${percent}%`,x:mCenter.x,y:textY,fill:"#aaa",stroke:"#fff",lineWidth:1,fontSize:12}});this.dPercentText=text}else dPercentText.attr({text:`${percent}%`,x:mCenter.x,y:textY})}if(this.delegate=lensDelegate,"drag"!==this.options.trigger){if("drag"===this.options.scaleRBy){if(!this.pointerDown)return;this.scaleRByDrag(e)}if("drag"===this.options.scaleDBy){if(!this.pointerDown)return;this.scaleDByDrag(e)}}}clear(){const{graph,delegate:lensDelegate,cachedOriginPositions,dPercentText}=this;this.restoreCache(),graph.updateNodePosition(Object.keys(cachedOriginPositions).map((id=>({id,data:{x:cachedOriginPositions[id].x,y:cachedOriginPositions[id].y}})))),lensDelegate&&!lensDelegate.destroyed&&graph.drawTransient("circle","lens-shape",{action:"remove"}),dPercentText&&!dPercentText.destroyed&&graph.drawTransient("text","lens-text-shape",{action:"remove"})}destroy(){this.clear()}}const GRID_PNG="url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2UwZTBlMCIgb3BhY2l0eT0iMC4yIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=)";class Grid extends plugin_Plugin{constructor(options){super(options)}getDefaultCfgs(){return{key:`grid-${unique_id()}`,img:GRID_PNG,follow:!0}}init(graph){super.init(graph);const minZoom=graph.getZoom(),graphContainer=graph.container,canvas=this.canvas||graphContainer.firstChild.nextSibling,[width,height]=graph.getSize(),img=this.options.img||GRID_PNG,container=createDOM("<div class='g6-grid-container' style=\"position: absolute; left:0;top:0;right:0;bottom:0;overflow: hidden;\"></div>"),gridContainer=createDOM(`<div \n        class='g6-grid' \n        style='position:absolute;\n        transform-origin: 0% 0% 0px;\n        background-image: ${img};\n        user-select: none\n        '></div>`);container.appendChild(gridContainer),modifyCSS(container,{width:`${width}px`,height:`${height}px`,left:`${graphContainer.offsetLeft}px`,top:`${graphContainer.offsetTop}px`}),modifyCSS(gridContainer,{width:width/minZoom+"px",height:height/minZoom+"px",left:"0px",top:"0px"}),graphContainer.insertBefore(container,canvas),this.container=container}getEvents(){return{viewportchange:this.updateGrid}}updateGrid(param){const gridContainer=this.container;let{matrix}=param;matrix||(matrix=[1,0,0,0,1,0,0,0,1]);const isFollow=this.options.follow;modifyCSS(gridContainer,{transform:`matrix(${matrix[0]}, ${matrix[1]}, ${matrix[3]}, ${matrix[4]}, ${isFollow?matrix[6]:"0"}, ${isFollow?matrix[7]:"0"})`})}getContainer(){return this.container}destroy(){var _a;super.destroy(),null===(_a=this.canvas)||void 0===_a||_a.destroy();const container=this.container;(null==container?void 0:container.parentNode)&&container.parentNode.removeChild(container)}}const upper_first=function(value){var str=function(value){return(0,is_nil.A)(value)?"":value.toString()}(value);return str.charAt(0).toUpperCase()+str.substring(1)};var STACK_TYPE;!function(STACK_TYPE){STACK_TYPE.redo="redo",STACK_TYPE.undo="undo"}(STACK_TYPE||(STACK_TYPE={}));class LayerUpdatedCommand{constructor(action,ids){this.action=action,this.ids=ids}undo(graph){graph.executeWithNoStack((()=>{"front"===this.action?graph.backItem(this.ids):graph.frontItem(this.ids)}))}redo(graph){graph.executeWithNoStack((()=>{"front"===this.action?graph.frontItem(this.ids):graph.backItem(this.ids)}))}}class StateUpdatedCommand{constructor(props){this.changes=props}updateItemsStates(graph,stateOptions){null==stateOptions||stateOptions.map((option=>{const{ids,states,value}=option;graph.executeWithNoStack((()=>{graph.setItemState(ids,states,value)}))}))}undo(graph){this.updateItemsStates(graph,this.changes.oldValue)}redo(graph){this.updateItemsStates(graph,this.changes.newValue)}}class VisibilityUpdatedCommand{constructor(changes,disableAnimate){this.changes=changes,this.disableAnimate=disableAnimate}toggleItemsVisible(graph,values){graph.pauseStack(),lodash_each(values,(value=>value.visible?graph.showItem(value.ids,{disableAnimate:this.disableAnimate}):graph.hideItem(value.ids,{disableAnimate:this.disableAnimate}))),graph.resumeStack()}undo(graph){const{oldValue}=this.changes;this.toggleItemsVisible(graph,oldValue)}redo(graph){const{newValue}=this.changes;this.toggleItemsVisible(graph,newValue)}}class ItemDataCommand{constructor(action,type,changes,upsertAncestors){this.action=action,this.type=type,this.changes=changes,this.upsertAncestors=upsertAncestors}removeChangedData(graph){const ids=this.changes.map((data=>{var _a;return null===(_a=data.value)||void 0===_a?void 0:_a.id})).filter(Boolean);graph.executeWithNoStack((()=>{graph.removeData(this.type,ids)}))}addChangedData(graph){const models=this.changes.map((data=>data.value)).filter(Boolean);graph.executeWithNoStack((()=>{graph.addData(this.type,models)}))}updateChangedData(graph,operationType,onlyMove=!1){const modelMap=new Map;"combo"!==this.type||onlyMove?this.changes.forEach((data=>{const value=operationType===STACK_TYPE.undo?data.oldValue:data.newValue;if("number"==typeof value&&isNaN(value)||["x","y"].includes(data.propertyName)&&void 0===value)return;const model=modelMap.get(data.nodeId)||{};modelMap.set(data.id,{id:data.id,data:Object.assign(Object.assign({},model.data),{[data.propertyName]:value})})})):this.changes.forEach((data=>{const model=modelMap.get(data.nodeId)||{};modelMap.set(data.nodeId,{id:data.nodeId,data:Object.assign(Object.assign({},model.data),{parentId:STACK_TYPE.undo?data.oldParentId:data.newParentId})})})),graph.pauseStack();const models=Array.from(modelMap.values());onlyMove?graph.updateNodePosition(models,this.upsertAncestors):graph.updateData(this.type,models),graph.resumeStack()}undo(graph){"add"===this.action&&this.removeChangedData(graph),"remove"===this.action&&this.addChangedData(graph),"update"===this.action&&this.updateChangedData(graph,STACK_TYPE.undo),"updatePosition"===this.action&&this.updateChangedData(graph,STACK_TYPE.undo,"updatePosition"===this.action)}redo(graph){"remove"===this.action&&this.removeChangedData(graph),"add"===this.action&&this.addChangedData(graph),"update"===this.action&&this.updateChangedData(graph,STACK_TYPE.redo),"updatePosition"===this.action&&this.updateChangedData(graph,STACK_TYPE.redo,"updatePosition"===this.action)}}class ComboCommand{constructor(action,ids){this.action=action,this.ids=ids}undo(graph){graph.executeWithNoStack((()=>{"expandCombo"===this.action?graph.collapseCombo(this.ids):graph.expandCombo(this.ids)}))}redo(graph){graph.executeWithNoStack((()=>{"collapseCombo"===this.action?graph.collapseCombo(this.ids):graph.expandCombo(this.ids)}))}}var command_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class CommandFactory{static create(_a){var{type:itemType,action,changes}=_a,rest=command_rest(_a,["type","action","changes"]);const commands=[],groupedByType=group_by(changes,"type");for(const type in groupedByType){const itemDataCommandMap={NodeDataUpdated:"node",EdgeDataUpdated:"edge",NodeAdded:"node",EdgeAdded:"edge",NodeRemoved:"node",EdgeRemoved:"edge",TreeStructureChanged:"combo"};itemDataCommandMap[type]&&commands.push(new ItemDataCommand(action,itemType||itemDataCommandMap[type],groupedByType[type],"NodeDataUpdated"===type?rest.upsertAncestors:void 0))}const actionCommandMap={updateState:new StateUpdatedCommand(changes),updateVisibility:new VisibilityUpdatedCommand(changes,rest.disableAnimate),front:new LayerUpdatedCommand("front",rest.ids),back:new LayerUpdatedCommand("back",rest.ids),expandCombo:new ComboCommand("expandCombo",rest.ids),collapseCombo:new ComboCommand("collapseCombo",rest.ids)};return actionCommandMap[action]&&commands.push(actionCommandMap[action]),commands}}const apiMap={add:["addData","addCombo"],remove:["removeData"],update:["updateData","updateNodePosition","updateComboPosition","updatePosition","moveCombo","collapseCombo","expandCombo"],stateChange:["setItemState","clearItemState"],layerChange:["frontItem","backItem"],displayChange:["showItem","hideItem"]};class HistoryStack{constructor(maxStep=0){this.items=[],this.maxStep=maxStep}push(item){0!==this.maxStep&&this.items.length===this.maxStep&&this.items.shift(),this.items.push(item)}pop(){if(0!==this.items.length)return this.items.pop();throw new Error("Stack is empty")}size(){return this.items.length}clear(){this.items=[]}toArray(){return this.items}}class History extends plugin_Plugin{constructor(options){super(),this.stackSize=0,this.stackActive=!0,this.withoutStackingCounter=0;const{enableStack,stackCfg}=deep_mix(this.getDefaultCfgs(),options);this.enableStack=enableStack,this.cfg=stackCfg,this.isBatching=!1,this.undoStack=new HistoryStack(this.cfg.stackSize),this.redoStack=new HistoryStack(this.cfg.stackSize),this.initBatchCommands()}getDefaultCfgs(){return{enableStack:!0,stackCfg:{stackSize:0,stackActive:!0,includes:[],excludes:[],ignoreAdd:!1,ignoreRemove:!1,ignoreUpdate:!1,ignoreStateChange:!1,ignoreLayerChange:!1,ignoreDisplayChange:!1}}}init(graph){super.init(graph),this.clear()}getUndoStack(){return this.undoStack.toArray()}getRedoStack(){return this.redoStack.toArray()}getStack(){return{redoStack:this.getRedoStack(),undoStack:this.getUndoStack()}}clear(){this.clearUndoStack(),this.clearRedoStack()}clearUndoStack(){this.undoStack.clear()}clearRedoStack(){this.redoStack.clear()}isEnable(){return this.enableStack}push(cmd,stackType=STACK_TYPE.undo,isNew=!0){if(this.stackActive){if(stackType===STACK_TYPE.undo){if(isNew&&this.clearRedoStack(),is_empty(cmd))return;this.undoStack.push(cmd),this.initBatchCommands()}else this.redoStack.push(cmd);this.graph.emit("history:change",cmd,stackType,isNew)}else console.error("Stacking operations are currently paused. Unable to push to the stack.")}pauseStack(){this.withoutStackingCounter++,1===this.withoutStackingCounter&&(this.stackActive=!1)}resumeStack(){this.withoutStackingCounter>0&&this.withoutStackingCounter--,0===this.withoutStackingCounter&&(this.stackActive=!0)}undo(){if(this.isEnable()){const cmds=this.undoStack.pop();if(cmds){this.push(cmds,STACK_TYPE.redo,!1);for(let i=cmds.length-1;i>=0;i--)cmds[i].undo(this.graph)}}return this}redo(){if(this.isEnable()){const cmds=this.redoStack.pop();cmds&&(this.push(cmds,STACK_TYPE.undo,!1),lodash_each(cmds,(cmd=>cmd.redo(this.graph))))}return this}canUndo(){return this.isEnable()&&this.undoStack.size()>0}canRedo(){return this.isEnable()&&this.redoStack.size()>0}initBatchCommands(){this.batchCommands=[]}startHistoryBatch(){if(this.isBatching)throw new Error("Ensure that historyBatch processing is stopped before starting.");this.initBatchCommands(),this.isBatching=!0}stopHistoryBatch(){if(!this.isBatching)throw new Error("Ensure that historyBatch processing is started before stopping.");this.push(this.batchCommands),this.isBatching=!1}historyBatch(callback){this.startHistoryBatch(),callback(),this.stopHistoryBatch()}getEvents(){return{afteritemchange:this.handleUpdateHistory,afteritemzindexchange:this.handleUpdateHistory,afteritemstatechange:this.handleUpdateHistory,afteritemvisibilitychange:this.handleUpdateHistory,aftercollapsecombo:this.handleUpdateHistory,afterexpandcombo:this.handleUpdateHistory}}handleUpdateHistory(props){const{apiName,changes}=props;if((!changes||0!==changes.length)&&this.shouldPushToStack(apiName)){if(this.batchCommands=[...this.batchCommands,...CommandFactory.create(props)],this.isBatching)return;this.push(this.batchCommands)}}shouldPushToStack(apiName){const{includes=[],excludes=[]}=this.cfg;if(!this.enableStack||!this.stackActive)return!1;if(includes.includes(apiName))return!0;if(excludes.includes(apiName))return!1;let categoryKey=(apiName=>{for(const[categoryKey,apiList]of Object.entries(apiMap))if(apiList.includes(apiName))return categoryKey;throw new Error(`Unknown apiName: ${apiName}. Unable to determine category.`)})(apiName);return!categoryKey||(categoryKey="ignore"+upper_first(categoryKey),!this.cfg[categoryKey])}notify(graph,eventName,...data){graph.emit(eventName,data)}}function traverse_traverse(element,callback){callback(element),element.children&&element.children.forEach((function(child){child&&traverse_traverse(child,callback)}))}function show(element){visibility(element,!0)}function hide(element){visibility(element,!1)}function visibility(element,visible){var value=visible?"visible":"hidden";traverse_traverse(element,(function(node){node.attr("visibility",value)}))}var deep=function(dist,src,level,maxLevel){void 0===level&&(level=0),void 0===maxLevel&&(maxLevel=5),Object.entries(src).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],value=_b[1],res=dist;Object.prototype.hasOwnProperty.call(src,key)&&(value?is_plain_object(value)?(is_plain_object(dist[key])||(res[key]={}),level<maxLevel?deep(dist[key],value,level+1,maxLevel):res[key]=src[key]):(0,is_array.A)(value)?(res[key]=[],res[key]=res[key].concat(value)):res[key]=value:res[key]=value)}))},deepAssign=function(rst){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var i=0;i<args.length;i+=1)deep(rst,args[i]);return rst},OffscreenGroup=function(_super){function OffscreenGroup(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var _this=_super.apply(this,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(args),!1))||this;return _this.addEventListener(ElementEvent.INSERTED,(function(){hide(_this)})),_this}return(0,tslib_es6.C6)(OffscreenGroup,_super),OffscreenGroup}(Group);function createOffscreenGroup(container){var group=container.appendChild(new OffscreenGroup({class:"offscreen"}));return hide(group),group}function applyVisibility(){visibility(this,"hidden"!==this.attributes.visibility)}var GUI=function(_super){function GUI(options,defaultStyleProps){void 0===defaultStyleProps&&(defaultStyleProps={});var _this=_super.call(this,deepAssign({},{style:defaultStyleProps},options))||this;return _this.initialized=!1,_this._defaultOptions=defaultStyleProps,_this}return(0,tslib_es6.C6)(GUI,_super),Object.defineProperty(GUI.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=createOffscreenGroup(this)),this._offscreen},enumerable:!1,configurable:!0}),Object.defineProperty(GUI.prototype,"defaultOptions",{get:function(){return this._defaultOptions},enumerable:!1,configurable:!0}),GUI.prototype.connectedCallback=function(){this.render(this.attributes,this),this.bindEvents(this.attributes,this),this.initialized=!0},GUI.prototype.disconnectedCallback=function(){var _a;null===(_a=this._offscreen)||void 0===_a||_a.destroy()},GUI.prototype.attributeChangedCallback=function(name){"visibility"===name&&applyVisibility.call(this)},GUI.prototype.update=function(attr,animate){var _a;return this.attr(deepAssign({},this.attributes,attr||{})),null===(_a=this.render)||void 0===_a?void 0:_a.call(this,this.attributes,this,animate)},GUI.prototype.clear=function(){this.removeChildren()},GUI.prototype.bindEvents=function(attributes,container){},GUI}(CustomElement);function toUppercaseFirstLetter(string){return string.toString().charAt(0).toUpperCase()+string.toString().slice(1)}function removePrefix(string,prefix,lowercaseFirstLetter){var _a;void 0===lowercaseFirstLetter&&(lowercaseFirstLetter=!0);var inferPrefix=prefix||(null===(_a=string.match(/^([a-z][a-z0-9]+)/))||void 0===_a?void 0:_a[0])||"",withoutPrefix=string.replace(new RegExp("^(".concat(inferPrefix,")")),"");return lowercaseFirstLetter?function toLowercaseFirstLetter(string){return string.toString().charAt(0).toLowerCase()+string.toString().slice(1)}(withoutPrefix):withoutPrefix}var startsWith=function(text,prefix){if(!(null==text?void 0:text.startsWith(prefix)))return!1;var nextChart=text[prefix.length];return nextChart>="A"&&nextChart<="Z"};function subStyleProps(style,prefix,invert){void 0===invert&&(invert=!1);var result={};return Object.entries(style).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],value=_b[1];if("className"===key||"class"===key);else if(startsWith(key,"show")&&startsWith(removePrefix(key,"show"),prefix)!==invert)key===function addPrefix(string,prefix){return"".concat(prefix).concat(toUppercaseFirstLetter(string))}(prefix,"show")?result[key]=value:result[key.replace(new RegExp(toUppercaseFirstLetter(prefix)),"")]=value;else if(!startsWith(key,"show")&&startsWith(key,prefix)!==invert){var name_1=removePrefix(key,prefix);"filter"===name_1&&"function"==typeof value||(result[name_1]=value)}})),result}function superStyleProps(style,prefix){return Object.entries(style).reduce((function(acc,_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],value=_b[1];return key.startsWith("show")?acc["show".concat(prefix).concat(key.slice(4))]=value:acc["".concat(prefix).concat(toUppercaseFirstLetter(key))]=value,acc}),{})}function splitStyle(style,ignoreStyleDict){void 0===ignoreStyleDict&&(ignoreStyleDict=["x","y","class","className"]);var groupStyleDict=["transform","transformOrigin","anchor","visibility","pointerEvents","zIndex","cursor","clipPath","clipPathTargets","offsetPath","offsetPathTargets","offsetDistance","draggable","droppable"],output={},groupStyle={};return Object.entries(style).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],val=_b[1];ignoreStyleDict.includes(key)||(-1!==groupStyleDict.indexOf(key)?groupStyle[key]=val:output[key]=val)})),[output,groupStyle]}var Text_Text=function(_super){function Text(_a){void 0===_a&&(_a={});var style=_a.style,restOptions=(0,tslib_es6.Tt)(_a,["style"]);return _super.call(this,(0,tslib_es6.Cl)({style:(0,tslib_es6.Cl)({text:"",fill:"black",fontFamily:"sans-serif",fontSize:16,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineWidth:1,textAlign:"start",textBaseline:"middle"},style)},restOptions))||this}return(0,tslib_es6.C6)(Text,_super),Object.defineProperty(Text.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=createOffscreenGroup(this)),this._offscreen},enumerable:!1,configurable:!0}),Text.prototype.disconnectedCallback=function(){var _a;null===(_a=this._offscreen)||void 0===_a||_a.destroy()},Text}(Text);var Selection=function(){function Selection(elements,data,parent,document,selections,transitions,updateElements){void 0===elements&&(elements=null),void 0===data&&(data=null),void 0===parent&&(parent=null),void 0===document&&(document=null),void 0===selections&&(selections=[null,null,null,null,null]),void 0===transitions&&(transitions=[]),void 0===updateElements&&(updateElements=[]),_Selection_instances.add(this),this._elements=Array.from(elements),this._data=data,this._parent=parent,this._document=document,this._enter=selections[0],this._update=selections[1],this._exit=selections[2],this._merge=selections[3],this._split=selections[4],this._transitions=transitions,this._facetElements=updateElements}var _Selection_instances,_a,_Selection_maybeAppend;return Selection.prototype.selectAll=function(selector){var elements="string"==typeof selector?this._parent.querySelectorAll(selector):selector;return new _a(elements,null,this._elements[0],this._document)},Selection.prototype.selectFacetAll=function(selector){var elements="string"==typeof selector?this._parent.querySelectorAll(selector):selector;return new _a(this._elements,null,this._parent,this._document,void 0,void 0,elements)},Selection.prototype.select=function(selector){var element="string"==typeof selector?this._parent.querySelectorAll(selector)[0]||null:selector;return new _a([element],null,element,this._document)},Selection.prototype.append=function(node){var _this=this,callback="function"==typeof node?node:function(){return _this.createElement(node)},elements=[];if(null!==this._data){for(var i=0;i<this._data.length;i++){var d=this._data[i],_b=(0,tslib_es6.zs)(Array.isArray(d)?d:[d,null],2),datum=_b[0],from=_b[1];(newElement=callback(datum,i)).__data__=datum,null!==from&&(newElement.__fromElements__=from),this._parent.appendChild(newElement),elements.push(newElement)}return new _a(elements,null,this._parent,this._document)}for(i=0;i<this._elements.length;i++){var element=this._elements[i],newElement=callback(datum=element.__data__,i);element.appendChild(newElement),elements.push(newElement)}return new _a(elements,null,elements[0],this._document)},Selection.prototype.maybeAppend=function(id,node){var element=(0,tslib_es6.gn)(this,_Selection_instances,"m",_Selection_maybeAppend).call(this,"#"===id[0]?id:"#".concat(id),node);return element.attr("id",id),element},Selection.prototype.maybeAppendByClassName=function(className,node){var cls=className.toString(),element=(0,tslib_es6.gn)(this,_Selection_instances,"m",_Selection_maybeAppend).call(this,"."===cls[0]?cls:".".concat(cls),node);return element.attr("className",cls),element},Selection.prototype.maybeAppendByName=function(name,node){var element=(0,tslib_es6.gn)(this,_Selection_instances,"m",_Selection_maybeAppend).call(this,'[name="'.concat(name,'"]'),node);return element.attr("name",name),element},Selection.prototype.data=function(data,id,groupId){var e_1,_b;void 0===id&&(id=function(d){return d}),void 0===groupId&&(groupId=function(){return null});for(var enter=[],update=[],exit=new Set(this._elements),merge=[],split=new Set,keyElement=new Map(this._elements.map((function(d,i){return[id(d.__data__,i),d]}))),keyUpdateElement=new Map(this._facetElements.map((function(d,i){return[id(d.__data__,i),d]}))),groupKeyElements=function group(array,keyFunc){var grouped=new Map;return array.forEach((function(item){var key=keyFunc(item);grouped.has(key)||grouped.set(key,[]),grouped.get(key).push(item)})),grouped}(this._elements,(function(d){return groupId(d.__data__)})),i=0;i<data.length;i++){var datum=data[i],key=id(datum,i),groupKey=groupId(datum,i);if(keyElement.has(key))(element=keyElement.get(key)).__data__=datum,element.__facet__=!1,update.push(element),exit.delete(element),keyElement.delete(key);else if(keyUpdateElement.has(key)){(element=keyUpdateElement.get(key)).__data__=datum,element.__facet__=!0,update.push(element),keyUpdateElement.delete(key)}else if(groupKeyElements.has(key)){var group_2=groupKeyElements.get(key);merge.push([datum,group_2]);try{for(var group_1=(e_1=void 0,(0,tslib_es6.Ju)(group_2)),group_1_1=group_1.next();!group_1_1.done;group_1_1=group_1.next()){var element=group_1_1.value;exit.delete(element)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{group_1_1&&!group_1_1.done&&(_b=group_1.return)&&_b.call(group_1)}finally{if(e_1)throw e_1.error}}groupKeyElements.delete(key)}else if(keyElement.has(groupKey)){(element=keyElement.get(groupKey)).__toData__?element.__toData__.push(datum):element.__toData__=[datum],split.add(element),exit.delete(element)}else enter.push(datum)}var S=[new _a([],enter,this._parent,this._document),new _a(update,null,this._parent,this._document),new _a(exit,null,this._parent,this._document),new _a([],merge,this._parent,this._document),new _a(split,null,this._parent,this._document)];return new _a(this._elements,null,this._parent,this._document,S)},Selection.prototype.merge=function(other){var elements=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(this._elements),!1),(0,tslib_es6.zs)(other._elements),!1),transitions=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(this._transitions),!1),(0,tslib_es6.zs)(other._transitions),!1);return new _a(elements,null,this._parent,this._document,void 0,transitions)},Selection.prototype.createElement=function(type){if(this._document)return this._document.createElement(type,{});var Ctor=_a.registry[type];return Ctor?new Ctor:function error(msg){throw new Error(msg)}("Unknown node type: ".concat(type))},Selection.prototype.join=function(enter,update,exit,merge,split){void 0===enter&&(enter=function(d){return d}),void 0===update&&(update=function(d){return d}),void 0===exit&&(exit=function(d){return d.remove()}),void 0===merge&&(merge=function(d){return d}),void 0===split&&(split=function(d){return d.remove()});var newEnter=enter(this._enter),newUpdate=update(this._update),newExit=exit(this._exit),newMerge=merge(this._merge),newSplit=split(this._split);return newUpdate.merge(newEnter).merge(newExit).merge(newMerge).merge(newSplit)},Selection.prototype.remove=function(){for(var _loop_1=function(i){var element=this_1._elements[i],transition=this_1._transitions[i];transition?transition.then((function(){return element.remove()})):element.remove()},this_1=this,i=0;i<this._elements.length;i++)_loop_1(i);return new _a([],null,this._parent,this._document,void 0,this._transitions)},Selection.prototype.each=function(callback){for(var i=0;i<this._elements.length;i++){var element=this._elements[i],datum=element.__data__;callback.call(element,datum,i)}return this},Selection.prototype.attr=function(key,value){var callback="function"!=typeof value?function(){return value}:value;return this.each((function(d,i){void 0!==value&&(this[key]=callback.call(this,d,i))}))},Selection.prototype.style=function(key,value,callable){void 0===callable&&(callable=!0);var callback="function"==typeof value&&callable?value:function(){return value};return this.each((function(d,i){void 0!==value&&(this.style[key]=callback.call(this,d,i))}))},Selection.prototype.styles=function(style,callable){return void 0===style&&(style={}),void 0===callable&&(callable=!0),this.each((function(d,i){var _this=this;Object.entries(style).forEach((function(_b){var _c=(0,tslib_es6.zs)(_b,2),key=_c[0],value=_c[1],callback="function"==typeof value&&callable?value:function(){return value};void 0!==value&&_this.attr(key,callback.call(_this,d,i))}))}))},Selection.prototype.update=function(option,callable){void 0===callable&&(callable=!0);var callback="function"==typeof option&&callable?option:function(){return option};return this.each((function(d,i){option&&this.update&&this.update(callback.call(this,d,i))}))},Selection.prototype.maybeUpdate=function(option,callable){void 0===callable&&(callable=!0);var callback="function"==typeof option&&callable?option:function(){return option};return this.each((function(d,i){option&&this.update&&this.update(callback.call(this,d,i))}))},Selection.prototype.transition=function(callback){var T=this._transitions;return this.each((function(d,i){T[i]=callback.call(this,d,i)}))},Selection.prototype.on=function(event,handler){return this.each((function(){this.addEventListener(event,handler)})),this},Selection.prototype.call=function(callback){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];return callback.call.apply(callback,(0,tslib_es6.fX)([this._parent,this],(0,tslib_es6.zs)(args),!1)),this},Selection.prototype.node=function(){return this._elements[0]},Selection.prototype.nodes=function(){return this._elements},Selection.prototype.transitions=function(){return this._transitions.filter((function(t){return!!t}))},Selection.prototype.parent=function(){return this._parent},_a=Selection,_Selection_instances=new WeakSet,_Selection_maybeAppend=function _Selection_maybeAppend(selector,node){var element=this._elements[0],child=element.querySelector(selector);if(child)return new _a([child],null,this._parent,this._document);var newChild="string"==typeof node?this.createElement(node):node();return element.appendChild(newChild),new _a([newChild],null,this._parent,this._document)},Selection.registry={g:Group,rect:Rect,circle:Circle,path:Path,text:Text_Text,ellipse:Ellipse,image:index_esm_Image,line:Line,polygon:Polygon,polyline:Polyline,html:HTML},Selection}();function selection_select(node){return new Selection([node],null,node,node.ownerDocument)}var BBox=function(){function BBox(x,y,width,height){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.x=0,this.y=0,this.width=0,this.height=0,this.x=x,this.y=y,this.width=width,this.height=height}return Object.defineProperty(BBox.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(BBox.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(BBox.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(BBox.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),BBox.fromRect=function(other){return new BBox(other.x,other.y,other.width,other.height)},BBox.prototype.toJSON=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,top:this.top,right:this.right,bottom:this.bottom,left:this.left}},BBox}();var classNames=function(cls,prefix){var PREFIX=function(str){return"".concat(prefix,"-").concat(str)},obj=Object.fromEntries(Object.entries(cls).map((function(_a){var _b=(0,tslib_es6.zs)(_a,2),k=_b[0],v=_b[1],name=PREFIX(v);return[k,{name,class:".".concat(name),id:"#".concat(name),toString:function(){return name}}]})));return Object.assign(obj,{prefix:PREFIX}),obj};function parseSeriesAttr(series){if((0,is_number.A)(series))return[series,series,series,series];if((0,is_array.A)(series)){var len=series.length;if(1===len)return[series[0],series[0],series[0],series[0]];if(2===len)return[series[0],series[1],series[0],series[1]];if(3===len)return[series[0],series[1],series[2],series[1]];if(4===len)return series}return[0,0,0,0]}function ifShow(show,container,creator,removeChildren,removeHandler){return void 0===removeChildren&&(removeChildren=!0),void 0===removeHandler&&(removeHandler=function(g){g.node().removeChildren()}),show?creator(container):(removeChildren&&removeHandler(container),null)}var CLASS_NAMES=classNames({text:"text"},"title");function parsePosition(position){return/\S+-\S+/g.test(position)?position.split("-").map((function(str){return str[0]})):position.length>2?[position[0]]:position.split("")}function mayApplyStyle(el,style){var finalStyle=Object.entries(style).reduce((function(acc,_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],value=_b[1];return el.node().attr(key)||(acc[key]=value),acc}),{});el.styles(finalStyle)}var Title=function(_super){function Title(options){return _super.call(this,options,{text:"",width:0,height:0,fill:"#4a505a",fontWeight:"bold",fontSize:12,fontFamily:"sans-serif",inset:0,spacing:0,position:"top-left"})||this}return(0,tslib_es6.C6)(Title,_super),Title.prototype.getAvailableSpace=function(){var _a=this.attributes,containerWidth=_a.width,containerHeight=_a.height,position=_a.position,spacing=_a.spacing,inset=_a.inset,title=this.querySelector(CLASS_NAMES.text.class);if(!title)return new BBox(0,0,+containerWidth,+containerHeight);var _b=title.getBBox(),titleWidth=_b.width,titleHeight=_b.height,_c=(0,tslib_es6.zs)(parseSeriesAttr(spacing),4),spacingTop=_c[0],spacingRight=_c[1],spacingBottom=_c[2],spacingLeft=_c[3],_d=(0,tslib_es6.zs)([0,0,+containerWidth,+containerHeight],4),x=_d[0],y=_d[1],width=_d[2],height=_d[3],pos=parsePosition(position);if(pos.includes("i"))return new BBox(x,y,width,height);pos.forEach((function(p,i){var _a,_b,_c,_d;"t"===p&&(_a=(0,tslib_es6.zs)(0===i?[titleHeight+spacingBottom,+containerHeight-titleHeight-spacingBottom]:[0,+containerHeight],2),y=_a[0],height=_a[1]),"r"===p&&(_b=(0,tslib_es6.zs)([+containerWidth-titleWidth-spacingLeft],1),width=_b[0]),"b"===p&&(_c=(0,tslib_es6.zs)([+containerHeight-titleHeight-spacingTop],1),height=_c[0]),"l"===p&&(_d=(0,tslib_es6.zs)(0===i?[titleWidth+spacingRight,+containerWidth-titleWidth-spacingRight]:[0,+containerWidth],2),x=_d[0],width=_d[1])}));var _e=(0,tslib_es6.zs)(parseSeriesAttr(inset),4),insetTop=_e[0],insetRight=_e[1],insetBottom=_e[2],insetLeft=_e[3],_f=(0,tslib_es6.zs)([insetLeft+insetRight,insetTop+insetBottom],2),insetWidth=_f[0],insetHeight=_f[1];return new BBox(x+insetLeft,y+insetTop,width-insetWidth,height-insetHeight)},Title.prototype.getBBox=function(){return this.title?this.title.getBBox():new BBox(0,0,0,0)},Title.prototype.render=function(attributes,container){var _this=this,restStyle=(attributes.width,attributes.height,attributes.position,attributes.spacing,(0,tslib_es6.Tt)(attributes,["width","height","position","spacing"])),titleStyle=(0,tslib_es6.zs)(splitStyle(restStyle),1)[0],_b=function getTitleLayout(cfg){var _a,_b,_c,_d,_e=cfg,width=_e.width,height=_e.height,position=_e.position,_f=(0,tslib_es6.zs)([+width/2,+height/2],2),hW=_f[0],hH=_f[1],_g=(0,tslib_es6.zs)([+hW,+hH,"center","middle"],4),x=_g[0],y=_g[1],textAlign=_g[2],textBaseline=_g[3],pos=parsePosition(position);return pos.includes("l")&&(x=(_a=(0,tslib_es6.zs)([0,"start"],2))[0],textAlign=_a[1]),pos.includes("r")&&(x=(_b=(0,tslib_es6.zs)([+width,"end"],2))[0],textAlign=_b[1]),pos.includes("t")&&(y=(_c=(0,tslib_es6.zs)([0,"top"],2))[0],textBaseline=_c[1]),pos.includes("b")&&(y=(_d=(0,tslib_es6.zs)([+height,"bottom"],2))[0],textBaseline=_d[1]),{x,y,textAlign,textBaseline}}(attributes),x=_b.x,y=_b.y,textAlign=_b.textAlign,textBaseline=_b.textBaseline;ifShow(!!restStyle.text,selection_select(container),(function(group){_this.title=group.maybeAppendByClassName(CLASS_NAMES.text,"text").styles(titleStyle).call(mayApplyStyle,{x,y,textAlign,textBaseline}).node()}))},Title}(GUI);const noop=function(){};function getCallbackValue(value,params){return(0,is_function.A)(value)?value.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(params),!1)):value}function parseAnimationOption(option){if(!option)return{enter:!1,update:!1,exit:!1};var keys=["enter","update","exit"],baseOption=Object.fromEntries(Object.entries(option).filter((function(_a){var k=(0,tslib_es6.zs)(_a,1)[0];return!keys.includes(k)})));return Object.fromEntries(keys.map((function(k){return function isStandardAnimationOption(option){return"boolean"!=typeof option&&"enter"in option&&"update"in option&&"exit"in option}(option)?!1===option[k]?[k,!1]:[k,(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},option[k]),baseOption)]:[k,baseOption]})))}function onAnimateFinished(animation,callback){animation?animation.finished.then(callback):callback()}function attr(target,value){"update"in target?target.update(value):target.attr(value)}function animate(target,keyframes,options){return 0===keyframes.length?null:options?target.animate(keyframes,options):(attr(target,{style:keyframes.slice(-1)[0]}),null)}function transition(target,state,options){var from={},to={};return Object.entries(state).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),key=_b[0],tarStyle=_b[1];if(!(0,is_nil.A)(tarStyle)){var currStyle=target.style[key]||target.parsedStyle[key]||0;currStyle!==tarStyle&&(from[key]=currStyle,to[key]=tarStyle)}})),options?animate(target,[from,to],(0,tslib_es6.Cl)({fill:"both"},options)):(attr(target,to),null)}function scaleToPixel(el,size,applyScale){void 0===applyScale&&(applyScale=!1);var _a=el.getBBox(),width=_a.width,height=_a.height,scale=size/Math.max(width,height);return applyScale&&el.scale(scale),scale}var circle=function(x,y,r){return[["M",x-r,y],["A",r,r,0,1,0,x+r,y],["A",r,r,0,1,0,x-r,y],["Z"]]},point=circle,line=function(x,y,r){return[["M",x,y+r],["L",x,y-r]]},symbol_dot=function(x,y,r){return[["M",x-r,y],["L",x+r,y]]},dash=symbol_dot;var navigator_CLASS_NAMES=classNames({prevBtnGroup:"prev-btn-group",prevBtn:"prev-btn",nextBtnGroup:"next-btn-group",nextBtn:"next-btn",pageInfoGroup:"page-info-group",pageInfo:"page-info",playWindow:"play-window",contentGroup:"content-group",controller:"controller",clipPath:"clip-path"},"navigator"),Navigator=function(_super){function Navigator(options){var x,y,r,_this=_super.call(this,options,{animate:{easing:"linear",duration:200,fill:"both"},buttonCursor:"pointer",buttonFill:"black",buttonPath:(x=0,y=0,r=6,[["M",x-r,y-r],["L",x+r,y],["L",x-r,y+r],["Z"]]),buttonSize:12,controllerPadding:5,controllerSpacing:5,formatter:function(curr,total){return"".concat(curr,"/").concat(total)},defaultPage:0,loop:!1,orientation:"horizontal",pageNumFill:"black",pageNumFontSize:12,pageNumTextAlign:"start",pageNumTextBaseline:"middle"})||this;return _this.playState="idle",_this.contentGroup=_this.appendChild(new Group({class:navigator_CLASS_NAMES.contentGroup.name})),_this.playWindow=_this.contentGroup.appendChild(new Group({class:navigator_CLASS_NAMES.playWindow.name})),_this.innerCurrPage=_this.defaultPage,_this}return(0,tslib_es6.C6)(Navigator,_super),Object.defineProperty(Navigator.prototype,"defaultPage",{get:function(){var defaultPage=this.attributes.defaultPage;return lodash_clamp(defaultPage,0,Math.max(this.pageViews.length-1,0))},enumerable:!1,configurable:!0}),Object.defineProperty(Navigator.prototype,"pageViews",{get:function(){return this.playWindow.children},enumerable:!1,configurable:!0}),Object.defineProperty(Navigator.prototype,"controllerShape",{get:function(){return this.totalPages>1?{width:55,height:0}:{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(Navigator.prototype,"pageShape",{get:function(){var pageViews=this.pageViews,_a=(0,tslib_es6.zs)(function transpose_transpose(m){var _a;return(null===(_a=m[0])||void 0===_a?void 0:_a.map((function(x,i){return m.map((function(x){return x[i]}))})))||[]}(pageViews.map((function(pageView){var _a=pageView.getBBox();return[_a.width,_a.height]}))).map((function(arr){return Math.max.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(arr),!1))})),2),maxWidth=_a[0],maxHeight=_a[1],_b=this.attributes,_c=_b.pageWidth,pageWidth=void 0===_c?maxWidth:_c,_d=_b.pageHeight;return{pageWidth,pageHeight:void 0===_d?maxHeight:_d}},enumerable:!1,configurable:!0}),Navigator.prototype.getContainer=function(){return this.playWindow},Object.defineProperty(Navigator.prototype,"totalPages",{get:function(){return this.pageViews.length},enumerable:!1,configurable:!0}),Object.defineProperty(Navigator.prototype,"currPage",{get:function(){return this.innerCurrPage},enumerable:!1,configurable:!0}),Navigator.prototype.getBBox=function(){var _a=_super.prototype.getBBox.call(this),x=_a.x,y=_a.y,controllerShape=this.controllerShape,_b=this.pageShape,pageWidth=_b.pageWidth,pageHeight=_b.pageHeight;return new BBox(x,y,pageWidth+controllerShape.width,pageHeight)},Navigator.prototype.goTo=function(pageNum){var _this=this,animateOptions=this.attributes.animate,currPage=this.currPage,playState=this.playState,playWindow=this.playWindow,pageViews=this.pageViews;if("idle"!==playState||pageNum<0||pageViews.length<=0||pageNum>=pageViews.length)return null;pageViews[currPage].setLocalPosition(0,0),this.prepareFollowingPage(pageNum);var _b=(0,tslib_es6.zs)(this.getFollowingPageDiff(pageNum),2),dx=_b[0],dy=_b[1];this.playState="running";var animation=animate(playWindow,[{transform:"translate(0, 0)"},{transform:"translate(".concat(-dx,", ").concat(-dy,")")}],animateOptions);return onAnimateFinished(animation,(function(){_this.innerCurrPage=pageNum,_this.playState="idle",_this.setVisiblePages([pageNum]),_this.updatePageInfo()})),animation},Navigator.prototype.prev=function(){var loop=this.attributes.loop,pages=this.pageViews.length,page=this.currPage;if(!loop&&page<=0)return null;var following=loop?(page-1+pages)%pages:lodash_clamp(page-1,0,pages);return this.goTo(following)},Navigator.prototype.next=function(){var loop=this.attributes.loop,pages=this.pageViews.length,page=this.currPage;if(!loop&&page>=pages-1)return null;var following=loop?(page+1)%pages:lodash_clamp(page+1,0,pages);return this.goTo(following)},Navigator.prototype.renderClipPath=function(container){var _a=this.pageShape,pageWidth=_a.pageWidth,pageHeight=_a.pageHeight;pageWidth&&pageHeight?(this.clipPath=container.maybeAppendByClassName(navigator_CLASS_NAMES.clipPath,"rect").styles({width:pageWidth,height:pageHeight}),this.contentGroup.attr("clipPath",this.clipPath.node())):this.contentGroup.style.clipPath=void 0},Navigator.prototype.setVisiblePages=function(pages){this.playWindow.children.forEach((function(page,index){pages.includes(index)?show(page):hide(page)}))},Navigator.prototype.adjustControllerLayout=function(){var prevBtn=this.prevBtnGroup,nextBtn=this.nextBtnGroup,pageNum=this.pageInfoGroup,_b=this.attributes,orientation=_b.orientation,padding=_b.controllerPadding,_c=pageNum.getBBox(),pW=_c.width,_d=(_c.height,(0,tslib_es6.zs)("horizontal"===orientation?[-180,0]:[-90,90],2)),r1=_d[0],r2=_d[1];prevBtn.setLocalEulerAngles(r1),nextBtn.setLocalEulerAngles(r2);var _e=prevBtn.getBBox(),bpW=_e.width,bpH=_e.height,_f=nextBtn.getBBox(),bnW=_f.width,bnH=_f.height,maxWidth=Math.max(bpW,pW,bnW),_g="horizontal"===orientation?{offset:[[0,0],[bpW/2+padding,0],[bpW+pW+2*padding,0]],textAlign:"start"}:{offset:[[maxWidth/2,-bpH-padding],[maxWidth/2,0],[maxWidth/2,bnH+padding]],textAlign:"center"},_h=(0,tslib_es6.zs)(_g.offset,3),_j=(0,tslib_es6.zs)(_h[0],2),o1x=_j[0],o1y=_j[1],_k=(0,tslib_es6.zs)(_h[1],2),o2x=_k[0],o2y=_k[1],_l=(0,tslib_es6.zs)(_h[2],2),o3x=_l[0],o3y=_l[1],textAlign=_g.textAlign,pageNumText=pageNum.querySelector("text");pageNumText&&(pageNumText.style.textAlign=textAlign),prevBtn.setLocalPosition(o1x,o1y),pageNum.setLocalPosition(o2x,o2y),nextBtn.setLocalPosition(o3x,o3y)},Navigator.prototype.updatePageInfo=function(){var _a,currPage=this.currPage,pageViews=this.pageViews,formatter=this.attributes.formatter;pageViews.length<2||(null===(_a=this.pageInfoGroup.querySelector(navigator_CLASS_NAMES.pageInfo.class))||void 0===_a||_a.attr("text",formatter(currPage+1,pageViews.length)),this.adjustControllerLayout())},Navigator.prototype.getFollowingPageDiff=function(pageNum){var currPage=this.currPage;if(currPage===pageNum)return[0,0];var orientation=this.attributes.orientation,_a=this.pageShape,pageWidth=_a.pageWidth,pageHeight=_a.pageHeight,sign=pageNum<currPage?-1:1;return"horizontal"===orientation?[sign*pageWidth,0]:[0,sign*pageHeight]},Navigator.prototype.prepareFollowingPage=function(pageNum){var currPage=this.currPage,pageViews=this.pageViews;if(this.setVisiblePages([pageNum,currPage]),pageNum!==currPage){var _b=(0,tslib_es6.zs)(this.getFollowingPageDiff(pageNum),2),dx=_b[0],dy=_b[1];pageViews[pageNum].setLocalPosition(dx,dy)}},Navigator.prototype.renderController=function(container){var _this=this,spacing=this.attributes.controllerSpacing,_a=this.pageShape,pageWidth=_a.pageWidth,pageHeight=_a.pageHeight,visible=this.pageViews.length>=2,group=container.maybeAppendByClassName(navigator_CLASS_NAMES.controller,"g");if(visibility(group.node(),visible),visible){var style=subStyleProps(this.attributes,"button"),textStyle=subStyleProps(this.attributes,"pageNum"),_b=(0,tslib_es6.zs)(splitStyle(style),2),_c=_b[0],groupStyle=_b[1],size=_c.size,pathStyle=(0,tslib_es6.Tt)(_c,["size"]),whetherToAddEventListener=!group.select(navigator_CLASS_NAMES.prevBtnGroup.class).node(),prevBtnGroup=group.maybeAppendByClassName(navigator_CLASS_NAMES.prevBtnGroup,"g").styles(groupStyle);this.prevBtnGroup=prevBtnGroup.node();var prevBtn=prevBtnGroup.maybeAppendByClassName(navigator_CLASS_NAMES.prevBtn,"path"),nextBtnGroup=group.maybeAppendByClassName(navigator_CLASS_NAMES.nextBtnGroup,"g").styles(groupStyle);this.nextBtnGroup=nextBtnGroup.node(),[prevBtn,nextBtnGroup.maybeAppendByClassName(navigator_CLASS_NAMES.nextBtn,"path")].forEach((function(btn){btn.styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},pathStyle),{transformOrigin:"center"})),scaleToPixel(btn.node(),size,!0)}));var pageInfoGroup=group.maybeAppendByClassName(navigator_CLASS_NAMES.pageInfoGroup,"g");this.pageInfoGroup=pageInfoGroup.node(),pageInfoGroup.maybeAppendByClassName(navigator_CLASS_NAMES.pageInfo,"text").styles(textStyle),this.updatePageInfo(),group.node().setLocalPosition(pageWidth+spacing,pageHeight/2),whetherToAddEventListener&&(this.prevBtnGroup.addEventListener("click",(function(){_this.prev()})),this.nextBtnGroup.addEventListener("click",(function(){_this.next()})))}},Navigator.prototype.render=function(attributes,container){var containerSelection=selection_select(container);this.renderClipPath(containerSelection),this.renderController(containerSelection),this.setVisiblePages([this.defaultPage]),this.goTo(this.defaultPage)},Navigator.prototype.bindEvents=function(){var _this=this,render=lodash_debounce((function(){return _this.render(_this.attributes,_this)}),50);this.playWindow.addEventListener(ElementEvent.INSERTED,render),this.playWindow.addEventListener(ElementEvent.REMOVED,render)},Navigator}(GUI);function marker_getType(symbol){var markerType=function parseMarker(icon){var type="default";if((0,is_object.A)(icon)&&icon instanceof Image)type="image";else if((0,is_function.A)(icon))type="symbol";else if((0,is_string.A)(icon)){var dataURLsPattern=new RegExp("data:(image|text)");type=icon.match(dataURLsPattern)?"base64":/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(icon)?"url":"symbol"}return type}(symbol);return["base64","url","image"].includes(markerType)?"image":symbol&&"symbol"===markerType?"path":null}var Marker=function(_super){function Marker(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Marker,_super),Marker.prototype.render=function(attributes,container){var symbol=attributes.symbol,_a=attributes.size,size=void 0===_a?16:_a,style=(0,tslib_es6.Tt)(attributes,["symbol","size"]),type=marker_getType(symbol);ifShow(!!type,selection_select(container),(function(group){group.maybeAppendByClassName("marker",type).attr("className","marker ".concat(type,"-marker")).call((function(selection){if("image"===type){var r=2*size;selection.styles({img:symbol,width:r,height:r,x:-size,y:-size})}else{r=size/2;var symbolFn=(0,is_function.A)(symbol)?symbol:Marker.getSymbol(symbol);selection.styles((0,tslib_es6.Cl)({path:null==symbolFn?void 0:symbolFn(0,0,r)},style))}}))}))},Marker.MARKER_SYMBOL_MAP=new Map,Marker.registerSymbol=function(type,symbol){Marker.MARKER_SYMBOL_MAP.set(type,symbol)},Marker.getSymbol=function(type){return Marker.MARKER_SYMBOL_MAP.get(type)},Marker}(GUI);Marker.registerSymbol("cross",(function(x,y,r){return[["M",x-r,y-r],["L",x+r,y+r],["M",x+r,y-r],["L",x-r,y+r]]})),Marker.registerSymbol("hyphen",(function(x,y,r){return[["M",x-r,y],["L",x+r,y]]})),Marker.registerSymbol("line",line),Marker.registerSymbol("plus",(function(x,y,r){return[["M",x-r,y],["L",x+r,y],["M",x,y-r],["L",x,y+r]]})),Marker.registerSymbol("tick",(function(x,y,r){return[["M",x-r/2,y-r],["L",x+r/2,y-r],["M",x,y-r],["L",x,y+r],["M",x-r/2,y+r],["L",x+r/2,y+r]]})),Marker.registerSymbol("circle",circle),Marker.registerSymbol("point",point),Marker.registerSymbol("bowtie",(function(x,y,r){var diffY=r-1.5;return[["M",x-r,y-diffY],["L",x+r,y+diffY],["L",x+r,y-diffY],["L",x-r,y+diffY],["Z"]]})),Marker.registerSymbol("hexagon",(function(x,y,r){var diffX=r/2*Math.sqrt(3);return[["M",x,y-r],["L",x+diffX,y-r/2],["L",x+diffX,y+r/2],["L",x,y+r],["L",x-diffX,y+r/2],["L",x-diffX,y-r/2],["Z"]]})),Marker.registerSymbol("square",(function(x,y,r){return[["M",x-r,y-r],["L",x+r,y-r],["L",x+r,y+r],["L",x-r,y+r],["Z"]]})),Marker.registerSymbol("diamond",(function(x,y,r){return[["M",x-r,y],["L",x,y-r],["L",x+r,y],["L",x,y+r],["Z"]]})),Marker.registerSymbol("triangle",(function(x,y,r){var diffY=r*Math.sin(1/3*Math.PI);return[["M",x-r,y+diffY],["L",x,y-diffY],["L",x+r,y+diffY],["Z"]]})),Marker.registerSymbol("triangle-down",(function(x,y,r){var diffY=r*Math.sin(1/3*Math.PI);return[["M",x-r,y-diffY],["L",x+r,y-diffY],["L",x,y+diffY],["Z"]]})),Marker.registerSymbol("line",line),Marker.registerSymbol("dot",symbol_dot),Marker.registerSymbol("dash",dash),Marker.registerSymbol("smooth",(function(x,y,r){return[["M",x-r,y],["A",r/2,r/2,0,1,1,x,y],["A",r/2,r/2,0,1,0,x+r,y]]})),Marker.registerSymbol("hv",(function(x,y,r){return[["M",x-r-1,y-2.5],["L",x,y-2.5],["L",x,y+2.5],["L",x+r+1,y+2.5]]})),Marker.registerSymbol("vh",(function(x,y,r){return[["M",x-r-1,y+2.5],["L",x,y+2.5],["L",x,y-2.5],["L",x+r+1,y-2.5]]})),Marker.registerSymbol("hvh",(function(x,y,r){return[["M",x-(r+1),y+2.5],["L",x-r/2,y+2.5],["L",x-r/2,y-2.5],["L",x+r/2,y-2.5],["L",x+r/2,y+2.5],["L",x+r+1,y+2.5]]})),Marker.registerSymbol("vhv",(function vhv(x,y){return[["M",x-5,y+2.5],["L",x-5,y],["L",x,y],["L",x,y-3],["L",x,y+3],["L",x+6.5,y+3]]}));Marker.registerSymbol("hiddenHandle",(function hiddenHandle(x,y,r){var diffY=1.4*r;return[["M",x-r,y-diffY],["L",x+r,y-diffY],["L",x+r,y+diffY],["L",x-r,y+diffY],["Z"]]})),Marker.registerSymbol("verticalHandle",(function verticalHandle(x,y,r){var height=1.4*r,halfWidth=r/2,oneSixthWidth=r/6,triangleX=x+.4*height;return[["M",x,y],["L",triangleX,y+halfWidth],["L",x+height,y+halfWidth],["L",x+height,y-halfWidth],["L",triangleX,y-halfWidth],["Z"],["M",triangleX,y+oneSixthWidth],["L",x+height-2,y+oneSixthWidth],["M",triangleX,y-oneSixthWidth],["L",x+height-2,y-oneSixthWidth]]})),Marker.registerSymbol("horizontalHandle",(function horizontalHandle(x,y,r){var height=1.4*r,halfWidth=r/2,oneSixthWidth=r/6,triangleY=y+.4*height;return[["M",x,y],["L",x-halfWidth,triangleY],["L",x-halfWidth,y+height],["L",x+halfWidth,y+height],["L",x+halfWidth,triangleY],["Z"],["M",x-oneSixthWidth,triangleY],["L",x-oneSixthWidth,y+height-2],["M",x+oneSixthWidth,triangleY],["L",x+oneSixthWidth,y+height-2]]}));function ifHorizontal(orientation,a,b){return void 0===orientation&&(orientation="horizontal"),"horizontal"===orientation?a:b}function getLocalBBox(shape){var _a=shape.getLocalBounds(),min=_a.min,max=_a.max,_b=(0,tslib_es6.zs)([min,max],2),_c=(0,tslib_es6.zs)(_b[0],2),x1=_c[0],y1=_c[1],_d=(0,tslib_es6.zs)(_b[1],2),x2=_d[0],y2=_d[1];return{x:x1,y:y1,width:x2-x1,height:y2-y1,left:x1,bottom:y2,top:y1,right:x2}}function isHorizontal(p1,p2){var _a=(0,tslib_es6.zs)(p1,2),x1=_a[0],y1=_a[1],_b=(0,tslib_es6.zs)(p2,2),x2=_b[0],y2=_b[1];return x1!==x2&&y1===y2}function renderExtDo(el){return"function"==typeof el?el():(0,is_string.A)(el)||(0,is_number.A)(el)?new Text_Text({style:{text:String(el)}}):el}const lodash_memoize=function(f,resolver,maxSize){if(void 0===maxSize&&(maxSize=128),!(0,is_function.A)(f))throw new TypeError("Expected a function");var memoized=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=f.apply(this,args);return cache.set(key,result),result};return memoized.cache=function flru(max){var num,curr,prev,limit=max||1;function keep(key,value){++num>limit&&(prev=curr,reset(1),++num),curr[key]=value}function reset(isPartial){num=0,curr=Object.create(null),isPartial||(prev=Object.create(null))}return reset(),{clear:reset,has:function(key){return void 0!==curr[key]||void 0!==prev[key]},get:function(key){var val=curr[key];return void 0!==val?val:void 0!==(val=prev[key])?(keep(key,val),val):void 0},set:function(key,value){void 0!==curr[key]?curr[key]=value:keep(key,value)}}}(maxSize),memoized};var ctx,text_measureTextWidth=lodash_memoize((function(text,font){var content=(0,is_string.A)(text)?text:text.style.text.toString(),_a=font||getFont(text),fontSize=_a.fontSize,fontFamily=_a.fontFamily,fontWeight=_a.fontWeight,fontStyle=_a.fontStyle,fontVariant=_a.fontVariant;return ctx||(ctx=document.createElement("canvas").getContext("2d")),ctx.font=[fontStyle,fontVariant,fontWeight,"".concat(fontSize,"px"),fontFamily].join(" "),ctx.measureText(content).width}),(function(text,font){return[(0,is_string.A)(text)?text:text.style.text.toString(),Object.values(font||getFont(text)).join()].join("")})),getFont=function(textShape){var fontFamily=textShape.style.fontFamily||"sans-serif",fontWeight=textShape.style.fontWeight||"normal",fontStyle=textShape.style.fontStyle||"normal",fontVariant=textShape.style.fontVariant,fontSize=textShape.style.fontSize;return{fontSize:fontSize="object"==typeof fontSize?fontSize.value:fontSize,fontFamily,fontWeight,fontStyle,fontVariant}};function textOf(node){return"text"===node.nodeName?node:"g"===node.nodeName&&1===node.children.length&&"text"===node.children[0].nodeName?node.children[0]:null}function applyToText(node,style){var text=textOf(node);text&&text.attr(style)}function ellipsisIt(node,w,suffix){void 0===suffix&&(suffix="..."),applyToText(node,{wordWrap:!0,wordWrapWidth:w,maxLines:1,textOverflow:suffix})}var item_CLASS_NAMES=classNames({layout:"flex",markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label",valueGroup:"value-group",value:"value",backgroundGroup:"background-group",background:"background"},"legend-category-item");var CategoryItem=function(_super){function CategoryItem(options){return _super.call(this,options,{span:[1,1],marker:function(){return new Circle({style:{r:6}})},markerSize:10,labelFill:"#646464",valueFill:"#646464",labelFontSize:12,valueFontSize:12,labelTextBaseline:"middle",valueTextBaseline:"middle"})||this}return(0,tslib_es6.C6)(CategoryItem,_super),Object.defineProperty(CategoryItem.prototype,"showValue",{get:function(){var valueText=this.attributes.valueText;return!!valueText&&("string"==typeof valueText||"number"==typeof valueText?""!==valueText:"function"==typeof valueText||""!==valueText.attr("text"))},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"actualSpace",{get:function(){var label=this.labelGroup,value=this.valueGroup,markerSize=this.attributes.markerSize,_a=label.node().getBBox(),labelWidth=_a.width,labelHeight=_a.height,_b=value.node().getBBox(),valueWidth=_b.width,valueHeight=_b.height;return{markerWidth:markerSize,labelWidth,valueWidth,height:Math.max(markerSize,labelHeight,valueHeight)}},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"span",{get:function(){var span=this.attributes.span;if(!span)return[1,1];var _a=(0,tslib_es6.zs)(parseSeriesAttr(span),2),span1=_a[0],innerSpan=_a[1],span2=this.showValue?innerSpan:0,basis=span1+span2;return[span1/basis,span2/basis]},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"shape",{get:function(){var _a,_b=this.attributes,markerSize=_b.markerSize,fullWidth=_b.width,actualSpace=this.actualSpace,markerWidth=actualSpace.markerWidth,height=actualSpace.height,_c=this.actualSpace,labelWidth=_c.labelWidth,valueWidth=_c.valueWidth,_d=(0,tslib_es6.zs)(this.spacing,2),spacing1=_d[0],spacing2=_d[1];if(fullWidth){var width_1=fullWidth-markerSize-spacing1-spacing2,_e=(0,tslib_es6.zs)(this.span,2),span1=_e[0],span2=_e[1];labelWidth=(_a=(0,tslib_es6.zs)([span1*width_1,span2*width_1],2))[0],valueWidth=_a[1]}return{width:markerWidth+labelWidth+valueWidth+spacing1+spacing2,height,markerWidth,labelWidth,valueWidth}},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"spacing",{get:function(){var spacing=this.attributes.spacing;if(!spacing)return[0,0];var _a=(0,tslib_es6.zs)(parseSeriesAttr(spacing),2),spacing1=_a[0],spacing2=_a[1];return this.showValue?[spacing1,spacing2]:[spacing1,0]},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"layout",{get:function(){var _a=this.shape,markerWidth=_a.markerWidth,labelWidth=_a.labelWidth,valueWidth=_a.valueWidth,width=_a.width,height=_a.height,_b=(0,tslib_es6.zs)(this.spacing,2),spacing1=_b[0];return{height,width,markerWidth,labelWidth,valueWidth,position:[markerWidth/2,markerWidth+spacing1,markerWidth+labelWidth+spacing1+_b[1]]}},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItem.prototype,"scaleSize",{get:function(){var markerShapeStyle=function styleOfMarker(group){var marker=group.querySelector(item_CLASS_NAMES.marker.class);return marker?marker.style:{}}(this.markerGroup.node()),_a=this.attributes,markerSize=_a.markerSize,_b=_a.markerStrokeWidth,markerStrokeWidth=void 0===_b?markerShapeStyle.strokeWidth:_b,_c=_a.markerLineWidth,markerLineWidth=void 0===_c?markerShapeStyle.lineWidth:_c,_d=_a.markerStroke,markerStroke=void 0===_d?markerShapeStyle.stroke:_d,strokeWidth=+(markerStrokeWidth||markerLineWidth||(markerStroke?1:0))*Math.sqrt(2),_e=this.markerGroup.node().getBBox(),width=_e.width,height=_e.height;return(1-strokeWidth/Math.max(width,height))*markerSize},enumerable:!1,configurable:!0}),CategoryItem.prototype.renderMarker=function(container){var _this=this,marker=this.attributes.marker,style=subStyleProps(this.attributes,"marker");this.markerGroup=container.maybeAppendByClassName(item_CLASS_NAMES.markerGroup,"g").style("zIndex",0),ifShow(!!marker,this.markerGroup,(function(){var parent=_this.markerGroup.node(),oldMarker=parent.getElementsByClassName(item_CLASS_NAMES.marker.name)[0],newMarker=marker();oldMarker?newMarker.nodeName===oldMarker.nodeName?(!function copyAttributes(target,source){var e_1,_a,attributes=source.attributes;try{for(var _b=(0,tslib_es6.Ju)(Object.entries(attributes)),_c=_b.next();!_c.done;_c=_b.next()){var _d=(0,tslib_es6.zs)(_c.value,2),key=_d[0],value=_d[1];"id"!==key&&"className"!==key&&target.attr(key,value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}(oldMarker,newMarker),selection_select(oldMarker).styles(style)):(oldMarker.remove(),selection_select(newMarker).attr("className",item_CLASS_NAMES.marker.name).styles(style),parent.appendChild(newMarker)):(selection_select(newMarker).attr("className",item_CLASS_NAMES.marker.name).styles(style),parent.appendChild(newMarker)),_this.markerGroup.node().scale(1/_this.markerGroup.node().getScale()[0]),scaleToPixel(_this.markerGroup.node(),_this.scaleSize,!0)}))},CategoryItem.prototype.renderLabel=function(container){var _a=subStyleProps(this.attributes,"label"),label=_a.text,style=(0,tslib_es6.Tt)(_a,["text"]);this.labelGroup=container.maybeAppendByClassName(item_CLASS_NAMES.labelGroup,"g").style("zIndex",0),this.labelGroup.maybeAppendByClassName(item_CLASS_NAMES.label,(function(){return renderExtDo(label)})).styles(style)},CategoryItem.prototype.renderValue=function(container){var _this=this,_a=subStyleProps(this.attributes,"value"),value=_a.text,style=(0,tslib_es6.Tt)(_a,["text"]);this.valueGroup=container.maybeAppendByClassName(item_CLASS_NAMES.valueGroup,"g").style("zIndex",0),ifShow(this.showValue,this.valueGroup,(function(){_this.valueGroup.maybeAppendByClassName(item_CLASS_NAMES.value,(function(){return renderExtDo(value)})).styles(style)}))},CategoryItem.prototype.renderBackground=function(container){var _a=this.shape,width=_a.width,height=_a.height,style=subStyleProps(this.attributes,"background");this.background=container.maybeAppendByClassName(item_CLASS_NAMES.backgroundGroup,"g").style("zIndex",-1),this.background.maybeAppendByClassName(item_CLASS_NAMES.background,"rect").styles((0,tslib_es6.Cl)({width,height},style))},CategoryItem.prototype.adjustLayout=function(){var _a=this.layout,labelWidth=_a.labelWidth,valueWidth=_a.valueWidth,height=_a.height,_b=(0,tslib_es6.zs)(_a.position,3),markerX=_b[0],labelX=_b[1],valueX=_b[2],halfHeight=height/2;this.markerGroup.styles({x:markerX,y:halfHeight}),this.labelGroup.styles({x:labelX,y:halfHeight}),ellipsisIt(this.labelGroup.select(item_CLASS_NAMES.label.class).node(),Math.ceil(labelWidth)),this.showValue&&(this.valueGroup.styles({x:valueX,y:halfHeight}),ellipsisIt(this.valueGroup.select(item_CLASS_NAMES.value.class).node(),Math.ceil(valueWidth)))},CategoryItem.prototype.render=function(attributes,container){var ctn=selection_select(container);this.renderMarker(ctn),this.renderLabel(ctn),this.renderValue(ctn),this.renderBackground(ctn),this.adjustLayout()},CategoryItem}(GUI),items_CLASS_NAMES=classNames({page:"item-page",navigator:"navigator",item:"item"},"items"),ifSatisfied=function(value,rule,defaultValue){return void 0===defaultValue&&(defaultValue=!0),value?rule(value):defaultValue},CategoryItems=function(_super){function CategoryItems(options){var _this=_super.call(this,options,{data:[],gridRow:1/0,gridCol:void 0,padding:0,width:1e3,height:100,rowPadding:0,colPadding:0,layout:"flex",orientation:"horizontal",click:noop,mouseenter:noop,mouseleave:noop})||this;return _this.navigatorShape=[0,0],_this}return(0,tslib_es6.C6)(CategoryItems,_super),Object.defineProperty(CategoryItems.prototype,"pageViews",{get:function(){return this.navigator.getContainer()},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItems.prototype,"grid",{get:function(){var _a=this.attributes,gridRow=_a.gridRow,gridCol=_a.gridCol,data=_a.data;if(!gridRow&&!gridCol)throw new Error("gridRow and gridCol can not be set null at the same time");return gridRow&&gridCol?[gridRow,gridCol]:gridRow?[gridRow,data.length]:[data.length,gridCol]},enumerable:!1,configurable:!0}),Object.defineProperty(CategoryItems.prototype,"renderData",{get:function(){var _a=this.attributes,data=_a.data,layout=_a.layout,style=subStyleProps(this.attributes,"item"),d=data.map((function(datum,index){var _a=datum.id,id=void 0===_a?index:_a,labelText=datum.label,valueText=datum.value;return{id:"".concat(id),index,style:(0,tslib_es6.Cl)({layout,labelText,valueText},Object.fromEntries(Object.entries(style).map((function(_a){var _b=(0,tslib_es6.zs)(_a,2);return[_b[0],getCallbackValue(_b[1],[datum,index,data])]}))))}}));return d},enumerable:!1,configurable:!0}),CategoryItems.prototype.getGridLayout=function(){var _this=this,_a=this.attributes,orientation=_a.orientation,width=_a.width,rowPadding=_a.rowPadding,colPadding=_a.colPadding,navWidth=(0,tslib_es6.zs)(this.navigatorShape,1)[0],_c=(0,tslib_es6.zs)(this.grid,2),gridRow=_c[0],gridCol=_c[1],pageSize=gridCol*gridRow,prevOffset=0;return this.pageViews.children.map((function(item,index){var _a,_b,page=Math.floor(index/pageSize),pageIndex=index%pageSize,dir=_this.ifHorizontal(gridCol,gridRow),pos=[Math.floor(pageIndex/dir),pageIndex%dir];"vertical"===orientation&&pos.reverse();var _c=(0,tslib_es6.zs)(pos,2),row=_c[0],col=_c[1],colWidth=(width-navWidth-(gridCol-1)*colPadding)/gridCol,rowHeight=item.getBBox().height,_d=(0,tslib_es6.zs)([0,0],2),x=_d[0],y=_d[1];return"horizontal"===orientation?(x=(_a=(0,tslib_es6.zs)([prevOffset,row*(rowHeight+rowPadding)],2))[0],y=_a[1],prevOffset=col===gridCol-1?0:prevOffset+colWidth+colPadding):(x=(_b=(0,tslib_es6.zs)([col*(colWidth+colPadding),prevOffset],2))[0],y=_b[1],prevOffset=row===gridRow-1?0:prevOffset+rowHeight+rowPadding),{page,index,row,col,pageIndex,width:colWidth,height:rowHeight,x,y}}))},CategoryItems.prototype.getFlexLayout=function(){var _a=this.attributes,maxWidth=_a.width,maxHeight=_a.height,rowPadding=_a.rowPadding,cP=_a.colPadding,navWidth=(0,tslib_es6.zs)(this.navigatorShape,1)[0],_c=(0,tslib_es6.zs)(this.grid,2),gridRow=_c[0],gridCol=_c[1],_d=(0,tslib_es6.zs)([maxWidth-navWidth,maxHeight],2),limitWidth=_d[0],limitHeight=_d[1],_e=(0,tslib_es6.zs)([0,0,0,0,0,0,0,0],8),x=_e[0],y=_e[1],page=_e[2],pageIndex=_e[3],col=_e[4],row=_e[5],prevWidth=_e[6],prevHeight=_e[7];return this.pageViews.children.map((function(item,index){var _a,_b,_c,_d,_e=item.getBBox(),width=_e.width,height=_e.height,colPadding=0===prevWidth?0:cP,nextWidth=prevWidth+colPadding+width;return nextWidth<=limitWidth&&ifSatisfied(col,(function(c){return c<gridCol}))?(_a=(0,tslib_es6.zs)([prevWidth+colPadding,prevHeight,nextWidth],3),x=_a[0],y=_a[1],prevWidth=_a[2],{width,height,x,y,page,index,pageIndex:pageIndex++,row,col:col++}):(_b=(0,tslib_es6.zs)([row+1,0,0,prevHeight+height+rowPadding],4),row=_b[0],col=_b[1],prevWidth=_b[2],(prevHeight=_b[3])+height<=limitHeight&&ifSatisfied(row,(function(r){return r<gridRow}))?(_c=(0,tslib_es6.zs)([prevWidth,prevHeight,width],3),x=_c[0],y=_c[1],prevWidth=_c[2],{width,height,x,y,page,index,pageIndex:pageIndex++,row,col:col++}):(_d=(0,tslib_es6.zs)([0,0,width,0,page+1,0,0,0],8),x=_d[0],y=_d[1],prevWidth=_d[2],prevHeight=_d[3],page=_d[4],pageIndex=_d[5],row=_d[6],col=_d[7],{width,height,x,y,page,index,pageIndex:pageIndex++,row,col:col++}))}))},Object.defineProperty(CategoryItems.prototype,"itemsLayout",{get:function(){this.navigatorShape=[0,0];var cb="grid"===this.attributes.layout?this.getGridLayout:this.getFlexLayout,layout=cb.call(this);return layout.slice(-1)[0].page>0?(this.navigatorShape=[55,0],cb.call(this)):layout},enumerable:!1,configurable:!0}),CategoryItems.prototype.ifHorizontal=function(a,b){return ifHorizontal(this.attributes.orientation,a,b)},CategoryItems.prototype.flattenPage=function(container){container.querySelectorAll(items_CLASS_NAMES.item.class).forEach((function(item){container.appendChild(item)})),container.querySelectorAll(items_CLASS_NAMES.page.class).forEach((function(page){container.removeChild(page).destroy()}))},CategoryItems.prototype.renderItems=function(container){var _a=this.attributes,click=_a.click,mouseenter=_a.mouseenter,mouseleave=_a.mouseleave;this.flattenPage(container);var dispatchCustomEvent=this.dispatchCustomEvent.bind(this);selection_select(container).selectAll(items_CLASS_NAMES.item.class).data(this.renderData,(function(d){return d.id})).join((function(enter){return enter.append((function(_a){var style=_a.style;return new CategoryItem({style})})).attr("className",items_CLASS_NAMES.item.name).on("click",(function(){null==click||click(this),dispatchCustomEvent("itemClick",{item:this})})).on("pointerenter",(function(){null==mouseenter||mouseenter(this),dispatchCustomEvent("itemMouseenter",{item:this})})).on("pointerleave",(function(){null==mouseleave||mouseleave(this),dispatchCustomEvent("itemMouseleave",{item:this})}))}),(function(update){return update.each((function(_a){var style=_a.style;this.update(style)}))}),(function(exit){return exit.remove()}))},CategoryItems.prototype.relayoutNavigator=function(){var _a,_b=this.attributes,layout=_b.layout,width=_b.width,height=(null===(_a=this.pageViews.children[0])||void 0===_a?void 0:_a.getBBox().height)||0,_c=(0,tslib_es6.zs)(this.navigatorShape,2),navWidth=_c[0],navHeight=_c[1];this.navigator.update("grid"===layout?{pageWidth:width-navWidth,pageHeight:height-navHeight}:{})},CategoryItems.prototype.adjustLayout=function(){var _this=this,itemsLayouts=Object.entries(function util_group_by_groupBy(source,by){return source.reduce((function(acc,curr){return(acc[curr[by]]=acc[curr[by]]||[]).push(curr),acc}),{})}(this.itemsLayout,"page")).map((function(_a){var _b=(0,tslib_es6.zs)(_a,2);return{page:_b[0],layouts:_b[1]}})),categoryItems=(0,tslib_es6.fX)([],(0,tslib_es6.zs)(this.navigator.getContainer().children),!1);itemsLayouts.forEach((function(_a){var layouts=_a.layouts,page=_this.pageViews.appendChild(new Group({className:items_CLASS_NAMES.page.name}));layouts.forEach((function(layout){var path,value,o,keyArr,x=layout.x,y=layout.y,index=layout.index,width=layout.width,height=layout.height,item=categoryItems[index];page.appendChild(item),path="__layout__",value=layout,o=item,(keyArr=(0,is_string.A)(path)?path.split("."):path).forEach((function(key,idx){idx<keyArr.length-1?((0,is_object.A)(o[key])||(o[key]=(0,is_number.A)(keyArr[idx+1])?[]:{}),o=o[key]):o[key]=value})),item.update({x,y,width,height})}))})),this.relayoutNavigator()},CategoryItems.prototype.renderNavigator=function(container){var orientation=this.attributes.orientation,navStyle=subStyleProps(this.attributes,"nav"),style=deepAssign({orientation},navStyle),that=this;return container.selectAll(items_CLASS_NAMES.navigator.class).data(["nav"]).join((function(enter){return enter.append((function(){return new Navigator({style})})).attr("className",items_CLASS_NAMES.navigator.name).each((function(){that.navigator=this}))}),(function(update){return update.each((function(){this.update(style)}))}),(function(exit){return exit.remove()})),this.navigator},CategoryItems.prototype.getBBox=function(){return this.navigator.getBBox()},CategoryItems.prototype.render=function(attributes,container){var data=this.attributes.data;if(data&&0!==data.length){var navigator=this.renderNavigator(selection_select(container));this.renderItems(navigator.getContainer()),this.adjustLayout()}},CategoryItems.prototype.dispatchCustomEvent=function(type,payload){var evt=new CustomEvent(type,{detail:payload});this.dispatchEvent(evt)},CategoryItems}(GUI),handle_CLASS_NAMES=classNames({markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label"},"handle"),DEFAULT_HANDLE_CFG={showLabel:!0,formatter:function(val){return val.toString()},markerSize:25,markerStroke:"#c5c5c5",markerFill:"#fff",markerLineWidth:1,labelFontSize:12,labelFill:"#c5c5c5",labelText:"",orientation:"vertical",spacing:0},LEGEND_BASE_DEFAULT_OPTIONS=(function(_super){function Handle(options){return _super.call(this,options,DEFAULT_HANDLE_CFG)||this}(0,tslib_es6.C6)(Handle,_super),Handle.prototype.render=function(attributes,container){var markerGroup=selection_select(container).maybeAppendByClassName(handle_CLASS_NAMES.markerGroup,"g");this.renderMarker(markerGroup);var labelGroup=selection_select(container).maybeAppendByClassName(handle_CLASS_NAMES.labelGroup,"g");this.renderLabel(labelGroup)},Handle.prototype.renderMarker=function(container){var _this=this,_a=this.attributes,orientation=_a.orientation,_b=_a.markerSymbol,markerSymbol=void 0===_b?ifHorizontal(orientation,"horizontalHandle","verticalHandle"):_b;ifShow(!!markerSymbol,container,(function(group){var handleStyle=subStyleProps(_this.attributes,"marker"),markerStyle=(0,tslib_es6.Cl)({symbol:markerSymbol},handleStyle);_this.marker=group.maybeAppendByClassName(handle_CLASS_NAMES.marker,(function(){return new Marker({style:markerStyle})})).update(markerStyle)}))},Handle.prototype.renderLabel=function(container){var _this=this,_a=this.attributes,showLabel=_a.showLabel,orientation=_a.orientation,_b=_a.spacing,spacing=void 0===_b?0:_b,formatter=_a.formatter;ifShow(showLabel,container,(function(group){var _a,_b=subStyleProps(_this.attributes,"label"),text=_b.text,labelStyle=(0,tslib_es6.Tt)(_b,["text"]),_c=(null===(_a=group.select(handle_CLASS_NAMES.marker.class))||void 0===_a?void 0:_a.node().getBBox())||{},_d=_c.width,width=void 0===_d?0:_d,_e=_c.height,height=void 0===_e?0:_e,_f=(0,tslib_es6.zs)(ifHorizontal(orientation,[0,height+spacing,"center","top"],[width+spacing,0,"start","middle"]),4),x=_f[0],y=_f[1],textAlign=_f[2],textBaseline=_f[3];group.maybeAppendByClassName(handle_CLASS_NAMES.label,"text").styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},labelStyle),{x,y,text:formatter(text).toString(),textAlign,textBaseline}))}))}}(GUI),{showTitle:!0,padding:0,orientation:"horizontal",backgroundFill:"transparent",titleText:"",titleSpacing:4,titlePosition:"top-left",titleFill:"#2C3542",titleFontWeight:"bold",titleFontFamily:"sans-serif",titleFontSize:12}),CATEGORY_DEFAULT_OPTIONS=deepAssign({},LEGEND_BASE_DEFAULT_OPTIONS,{}),constant_CLASS_NAMES=(deepAssign({},LEGEND_BASE_DEFAULT_OPTIONS,superStyleProps(DEFAULT_HANDLE_CFG,"handle"),{color:["#d0e3fa","#acc7f6","#8daaf2","#6d8eea","#4d73cd","#325bb1","#5a3e75","#8c3c79","#e23455","#e7655b"],indicatorBackgroundFill:"#262626",indicatorLabelFill:"white",indicatorLabelFontSize:12,indicatorVisibility:"hidden",labelAlign:"value",labelDirection:"positive",labelSpacing:5,showHandle:!0,showIndicator:!0,showLabel:!0,slidable:!0,titleText:"",type:"continuous"}),classNames({title:"title",titleGroup:"title-group",items:"items",itemsGroup:"items-group",contentGroup:"content-group",ribbonGroup:"ribbon-group",ribbon:"ribbon",handlesGroup:"handles-group",handle:"handle",startHandle:"start-handle",endHandle:"end-handle",labelGroup:"label-group",label:"label",indicator:"indicator"},"legend")),Category=function(_super){function Category(options){return _super.call(this,options,CATEGORY_DEFAULT_OPTIONS)||this}return(0,tslib_es6.C6)(Category,_super),Category.prototype.renderTitle=function(container,width,height){var _a=this.attributes,showTitle=_a.showTitle,titleText=_a.titleText,style=subStyleProps(this.attributes,"title"),_b=(0,tslib_es6.zs)(splitStyle(style),2),titleStyle=_b[0],groupStyle=_b[1];this.titleGroup=container.maybeAppendByClassName(constant_CLASS_NAMES.titleGroup,"g").styles(groupStyle);var finalTitleStyle=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({width,height},titleStyle),{text:showTitle?titleText:""});this.title=this.titleGroup.maybeAppendByClassName(constant_CLASS_NAMES.title,(function(){return new Title({style:finalTitleStyle})})).update(finalTitleStyle)},Category.prototype.renderItems=function(container,bbox){var x=bbox.x,y=bbox.y,width=bbox.width,height=bbox.height,style=subStyleProps(this.attributes,"title",!0),_a=(0,tslib_es6.zs)(splitStyle(style),2),partialItemStyle=_a[0],groupStyle=_a[1],itemStyle=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},partialItemStyle),{width,height,x:0,y:0});this.itemsGroup=container.maybeAppendByClassName(constant_CLASS_NAMES.itemsGroup,"g").styles((0,tslib_es6.Cl)({x,y},groupStyle));var that=this;this.itemsGroup.selectAll(constant_CLASS_NAMES.items.class).data(["items"]).join((function(enter){return enter.append((function(){return new CategoryItems({style:itemStyle})})).attr("className",constant_CLASS_NAMES.items.name).each((function(){that.items=selection_select(this)}))}),(function(update){return update.update(itemStyle)}),(function(exit){return exit.remove()}))},Category.prototype.adjustLayout=function(){if(this.attributes.showTitle){var _a=this.title.node().getAvailableSpace(),x=_a.x,y=_a.y;this.itemsGroup.node().setLocalPosition(x,y)}},Object.defineProperty(Category.prototype,"availableSpace",{get:function(){var _a=this.attributes,showTitle=_a.showTitle,width=_a.width,height=_a.height;return showTitle?this.title.node().getAvailableSpace():new BBox(0,0,width,height)},enumerable:!1,configurable:!0}),Category.prototype.getBBox=function(){var _a,_b,title=null===(_a=this.title)||void 0===_a?void 0:_a.node(),items=null===(_b=this.items)||void 0===_b?void 0:_b.node();return title&&items?function getBBox(title,content){var _a=title.attributes,position=_a.position,spacing=_a.spacing,inset=_a.inset,text=_a.text,titleBBox=title.getBBox(),contentBBox=content.getBBox(),pos=parsePosition(position),_b=(0,tslib_es6.zs)(parseSeriesAttr(text?spacing:0),4),spacingTop=_b[0],spacingRight=_b[1],spacingBottom=_b[2],spacingLeft=_b[3],_c=(0,tslib_es6.zs)(parseSeriesAttr(inset),4),insetTop=_c[0],insetRight=_c[1],insetBottom=_c[2],insetLeft=_c[3],_d=(0,tslib_es6.zs)([spacingLeft+spacingRight,spacingTop+spacingBottom],2),spacingWidth=_d[0],spacingHeight=_d[1],_e=(0,tslib_es6.zs)([insetLeft+insetRight,insetTop+insetBottom],2),insetWidth=_e[0],insetHeight=_e[1];if("l"===pos[0])return new BBox(titleBBox.x,titleBBox.y,contentBBox.width+titleBBox.width+spacingWidth+insetWidth,Math.max(contentBBox.height+insetHeight,titleBBox.height));if("t"===pos[0])return new BBox(titleBBox.x,titleBBox.y,Math.max(contentBBox.width+insetWidth,titleBBox.width),contentBBox.height+titleBBox.height+spacingHeight+insetHeight);var _f=(0,tslib_es6.zs)([content.attributes.width||contentBBox.width,content.attributes.height||contentBBox.height],2),contentWidth=_f[0],contentHeight=_f[1];return new BBox(contentBBox.x,contentBBox.y,contentWidth+titleBBox.width+spacingWidth+insetWidth,contentHeight+titleBBox.height+spacingHeight+insetHeight)}(title,items):_super.prototype.getBBox.call(this)},Category.prototype.render=function(attributes,container){var width=attributes.width,height=attributes.height,ctn=selection_select(container);this.renderTitle(ctn,width,height),this.renderItems(ctn,this.availableSpace),this.adjustLayout()},Category}(GUI),legend_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class Legend extends plugin_Plugin{constructor(options){super(options)}getDefaultCfgs(){return{key:`legend-${unique_id()}`,container:null,className:"g6-category-legend",orientation:"horizontal",selectedState:"selected",activeState:"active"}}getEvents(){return{afterrender:this.updateLegend,afteritemchange:this.updateLegend}}init(graph){super.init(graph);const{size="fit-content",orientation}=this.options,graphSize=graph.getSize();if(this.size=size,this.selectedTypes={node:new Set,edge:new Set},this.activeType={node:void 0,edge:void 0},this.selectedIds={node:new Set,edge:new Set},this.activeIds={node:new Set,edge:new Set},this.styleCache={node:{},edge:{}},"fit-content"===size&&(this.size=["horizontal"===orientation?graphSize[0]:"fit-content","horizontal"===orientation?"fit-content":graphSize[1]]),"number"==typeof size[0])this.size[0]=size[0];else if(size[0].includes("%")){const ratio=Number(size[0].replace("%"))/100||1;this.size[0]=graphSize[0]*ratio}if("number"==typeof size[1])this.size[1]=size[1];else if("100%"===size[1]){const ratio=Number(size[0].replace("%"))/100||1;this.size[1]=graphSize[1]*ratio}}updateLegend(){const{size}=this;if(!this.canvas){const canvasSize=["fit-content"===size[0]?0:size[0],"fit-content"===size[1]?0:size[1]],{canvas,background,renderer="canvas"}=this.options;canvas?this.canvas=canvas:(this.wrapper||(this.wrapper=this.createWrapper()),this.canvas=createCanvas(renderer,this.wrapper,canvasSize[0],canvasSize[1],void 0,{background})),this.canvas.addEventListener("click",(evt=>{var _a;if("document"!==(null===(_a=evt.target)||void 0===_a?void 0:_a.nodeName))return;const{graph,options}=this,{activeState,selectedState}=options;if(this.activeIds.node.size&&graph.clearItemState(Array.from(this.activeIds.node),activeState),this.activeIds.edge.size&&graph.clearItemState(Array.from(this.activeIds.edge),activeState),this.activeIds={node:new Set,edge:new Set},selectedState){const{node:selectedNodes,edge:selectedEdges}=this.selectedIds;graph.clearItemState(Array.from(selectedNodes),selectedState),graph.clearItemState(Array.from(selectedEdges),selectedState),this.selectedIds={node:new Set,edge:new Set}}this.selectedTypes.node.forEach((nodeType=>{const marker=this.canvas.getRoot().querySelector(`#marker-node-${nodeType}`);if(!marker)return;const lineWidth=this.styleCache.node[nodeType].lineWidth;marker.style.lineWidth=lineWidth})),this.selectedTypes.edge.forEach((edgeType=>{const marker=this.canvas.getRoot().querySelector(`#marker-edge-${edgeType}`);if(!marker)return;const lineWidth=this.styleCache.edge[edgeType].lineWidth;marker.style.lineWidth=lineWidth})),this.selectedTypes={node:new Set,edge:new Set},this.activeType={node:void 0,edge:void 0}}))}this.canvas.removeChildren();this.canvas.ready.then((()=>{this.nodeLegend=this.upsertLegend("node"),this.edgeLegend=this.upsertLegend("edge"),this.updateLayout()}))}createWrapper(){const{options,graph,size}=this,{container,className}=options;let $container;(0,is_string.A)(container)&&($container=document.getElementById(container)),$container||($container=graph.container);const wrapperSize=["fit-content"===size[0]?0:size[0],"fit-content"===size[1]?0:size[1]],wrapper=createDOM(`<div class='${className}' style='width: ${wrapperSize[0]}px; height: ${wrapperSize[1]}px; overflow: hidden;'></div>`);return $container.appendChild(wrapper),wrapper}upsertLegend(itemType="node"){const{graph,options,canvas}=this,{node,edge,orientation}=options,itemLegendConfig="node"===itemType?node:edge;if(!(null==itemLegendConfig?void 0:itemLegendConfig.enable))return;const{title,typeField,labelFormatter,rows=1,cols=4,colPadding=5,rowPadding=8,padding:propsPadding=[0,0,0,0],labelStyle={},markerStyle:propsMarkerStyle}=itemLegendConfig,defaultStyle={shape:"node"===itemType?"circle":"line",size:10,color:"#ccc",fillOpacity:.3},padding=formatPadding(propsPadding),labelRelatedStyle={};Object.keys(labelStyle).forEach((key=>{labelRelatedStyle[`itemLabel${upper_first(key)}`]=labelStyle[key]}));const itemSpacing=labelRelatedStyle.itemLabelSpacing,{size:legendSize,grid}=this.getLegendSize(rows,cols,padding),data="node"===itemType?graph.getAllNodesData():graph.getAllEdgesData(),typeSet=new Set,typeModelMap={};data.map((model=>{if(model.data[typeField]){const type=model.data[typeField];typeSet.add(type),typeModelMap[type]||(typeModelMap[type]=model)}}));const types=Array.from(typeSet),legendData=types.map((type=>({typeValue:type,label:labelFormatter?labelFormatter(type):type}))),markerStyleKeys=["fill","stroke","fillOpacity","opacity","lineWidth","shadow","shadowBlur","size"],markerRelatedStyle={};let getShape;if(propsMarkerStyle){const _a=Object.assign({},defaultStyle,propsMarkerStyle||{}),{shape:markerShape}=_a,markerStyle=legend_rest(_a,["shape"]);getShape=this.getShapeConfig(itemType,markerShape),Object.keys(markerStyle).forEach((key=>{const styleValue=markerStyle[key];let value=styleValue;"object"==typeof styleValue?value=item=>styleValue[item.typeValue]||styleValue[item.typeValue].size||10:(0,is_function.A)(styleValue)&&(value=item=>styleValue(item.typeValue)),"color"===key?(markerRelatedStyle.itemMarkerFill=markerRelatedStyle.itemMarkerFill||value,markerRelatedStyle.itemMarkerStroke=markerRelatedStyle.itemMarkerStroke||value):markerRelatedStyle[`itemMarker${upperFirstLetter(key)}`]=value}))}else{const graphGroup=graph.canvas.getRoot(),itemTypeGroup=graphGroup.getElementById(`${itemType}-group`)||graphGroup,typeStyleMap={},formatStyles={x1:-10,y1:0,x2:10,y2:0};types.forEach((type=>{const keyShape=itemTypeGroup.find((ele=>ele.getAttribute("data-item-id")===typeModelMap[type].id)).querySelector("#keyShape");typeStyleMap[type]={shape:keyShape.nodeName,style:Object.assign(Object.assign({},keyShape.attributes),formatStyles)}})),markerStyleKeys.forEach((key=>{markerRelatedStyle[`itemMarker${upperFirstLetter(key)}`]=item=>{const{typeValue}=item;let markerStyleKey=key;return"size"===key&&(typeStyleMap[typeValue].style.r&&(markerStyleKey="r"),markerStyleKey="width"),typeStyleMap[typeValue].style[markerStyleKey]||defaultStyle[key]}})),getShape=item=>{const{typeValue}=item,shape=typeStyleMap[typeValue].shape||defaultStyle.shape;return{Shape:ShapeTagMap[shape],style:typeStyleMap[typeValue].style}}}const legend=new Category({style:Object.assign(Object.assign(Object.assign({x:padding[3],y:padding[0],data:legendData,layout:"flex",orientation,gridRow:grid[0],gridCol:grid[1],colPadding,rowPadding,width:legendSize[0],height:legendSize[1],titleText:title,itemSpacing},labelRelatedStyle),markerRelatedStyle),{itemMarker:item=>{const{Shape,style}=getShape(item),{typeValue}=item;return this.styleCache[itemType][typeValue]=style,()=>new Shape({style,id:`marker-${itemType}-${typeValue}`})},mouseenter:ele=>this.handleMouseEnter(ele,types,typeField,itemType,data),mouseleave:ele=>this.handleMouseLeave(ele,types,typeField,itemType),click:ele=>this.handleClick(ele,types,typeField,itemType,data)})});return canvas.appendChild(legend),legend}updateLayout(){const{nodeLegend,edgeLegend,options,size}=this;if(nodeLegend&&edgeLegend){const{node,edge,orientation}=options,{order:nodeOrder=1,padding:nodePadding}=node,{order:edgeOrder=2,padding:edgePadding}=edge;let firstItem,secondItem;nodeOrder<edgeOrder?(firstItem={padding:formatPadding(nodePadding),legend:nodeLegend},secondItem={padding:formatPadding(edgePadding),legend:edgeLegend}):(secondItem={padding:formatPadding(nodePadding),legend:nodeLegend},firstItem={padding:formatPadding(edgePadding),legend:edgeLegend});const bbox=firstItem.legend.getRenderBounds();if("horizontal"===orientation){firstItem.legend.translateLocal([0,-bbox.min[1]+firstItem.padding[0]]);const firstItemBounds=firstItem.legend.childNodes[1].childNodes[0].childNodes[0].getRenderBounds();if(firstItemBounds){const firstBottom=firstItemBounds.max[1]+firstItem.padding[2];secondItem.legend.translateLocal([0,firstBottom])}}else{firstItem.legend.translateLocal([-bbox.min[0]+firstItem.padding[3],0]);const firstRight=firstItem.legend.childNodes[1].childNodes[0].childNodes[0].childNodes[1].getRenderBounds().max[0]+firstItem.padding[1];secondItem.legend.translateLocal([firstRight,0])}}if("fit-content"===size[0]||"fit-content"===size[1]){const totalBBox=this.canvas.getRoot().getRenderBounds(),canvasSize=["fit-content"===size[0]?totalBBox.max[0]-totalBBox.min[0]:size[0],"fit-content"===size[1]?totalBBox.max[1]-totalBBox.min[1]:size[1]];this.canvas.resize(canvasSize[0],canvasSize[1]),this.wrapper&&(this.wrapper.style.width=`${canvasSize[0]}px`,this.wrapper.style.height=`${canvasSize[1]}px`)}}getShapeConfig(itemType,markerShape){const DefaultShape="node"===itemType?Circle:Line,defaultStyle="node"===itemType?{r:10,width:20,height:20,lineWidth:1}:{lineWidth:4,x1:-10,y1:0,x2:10,y2:0};if("string"==typeof markerShape){const Shape=ShapeTagMap[markerShape]||DefaultShape;return()=>({Shape,style:defaultStyle})}return item=>{const shapeConfig=markerShape[item.typeValue];if("string"==typeof shapeConfig){return{Shape:ShapeTagMap[shapeConfig],style:defaultStyle}}{const{type:shapeType,style}=shapeConfig;return{Shape:ShapeTagMap[shapeType]||DefaultShape,style:Object.assign(Object.assign({},defaultStyle),style)}}}}getLegendSize(rows,cols,padding){const{graph,options,size}=this,{orientation}=options;let[width,height]=size,grid=[rows,cols];const[graphWidth,graphHeight]=graph.getSize();return"horizontal"===orientation?("fit-content"===size[0]&&(width=graphWidth),"fit-content"===size[1]&&(height=50)):("fit-content"===size[0]&&(width=50),"fit-content"===size[1]&&(height=graphHeight),grid=[cols,rows]),width+=padding[1]+padding[3],height+=padding[0]+padding[2],{size:[width,height],grid}}handleMouseEnter(ele,types,typeField,itemType,data){const{graph,options}=this,{activeState}=options;if(!activeState)return;const{index}=ele.__data__,type=types[index];this.activeType[typeField]=type;const activeIds=data.filter((model=>model.data[typeField]===type)).map((model=>model.id));graph.setItemState(activeIds,activeState,!0),activeIds.forEach((id=>this.activeIds[itemType].add(id))),ele.querySelector(".legend-category-item-marker").style.lineWidth=this.styleCache[itemType][type].lineWidth+2||4}handleMouseLeave(ele,types,typeField,itemType){const{graph,options}=this,{activeState}=options;if(!activeState)return;this.activeType[typeField]=void 0;const currentActiveIds=graph.findIdByState(itemType,activeState,!0),{index}=ele.__data__,type=types[index];this.selectedTypes[itemType].has(type)?ele.querySelector(".legend-category-item-marker").style.lineWidth=this.styleCache[itemType][type].lineWidth+4||6:ele.querySelector(".legend-category-item-marker").style.lineWidth=this.styleCache[itemType][type].lineWidth||1,graph.setItemState(currentActiveIds,activeState,!1),currentActiveIds.forEach((id=>this.activeIds[itemType].delete(id)))}handleClick(ele,types,typeField,itemType,data){const{graph,options}=this,{selectedState}=options;if(!selectedState)return;const{index}=ele.__data__,type=types[index],ids=data.filter((model=>model.data[typeField]===type)).map((model=>model.id));this.selectedTypes[itemType].has(type)?(this.selectedTypes[itemType].delete(type),ids.forEach((id=>this.selectedIds[itemType].delete(id))),graph.setItemState(ids,selectedState,!1),ele.querySelector(".legend-category-item-marker").style.lineWidth=4):(this.selectedTypes[itemType].add(type),ids.forEach((id=>this.selectedIds[itemType].add(id))),graph.setItemState(ids,selectedState,!0),ele.querySelector(".legend-category-item-marker").style.lineWidth=this.styleCache[itemType][type].lineWidth+4||6)}destroy(){var _a;super.destroy(),null===(_a=this.canvas)||void 0===_a||_a.destroy()}}const upperFirstLetter=str=>str?`${str.substring(0,1).toUpperCase()}${str.substring(1)}`:"";var insert_css=__webpack_require__("./node_modules/insert-css/index.js"),insert_css_default=__webpack_require__.n(insert_css),menu_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};"undefined"!=typeof document&&insert_css_default()("\n  .g6-component-contextmenu {\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    background-color: rgba(255, 255, 255, 0.9);\n    padding: 10px 8px;\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n  }\n  .g6-contextmenu-ul {\n    padding: 0;\n    margin: 0;\n    list-style: none;\n  }\n  .g6-loading-dom {\n    border: 5px solid #e5e5e5;\n    border-top: 5px solid #227EFF;\n    border-radius: 50%;\n    width: 25px;\n    height: 25px;\n    animation: turn-around 1.5s linear infinite;\n    }\n    @keyframes turn-around {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n");class Menu extends plugin_Plugin{constructor(options){super(options)}getDefaultCfgs(){return{key:`menu-${unique_id()}`,offsetX:6,offsetY:6,handleMenuClick:void 0,getContent:e=>"\n          <ul class='g6-contextmenu-ul'>\n            <li class='g6-contextmenu-li'>菜单项1</li>\n            <li class='g6-contextmenu-li'>菜单项2</li>\n          </ul>\n        ",shouldBegin:e=>!0,onHide:()=>!0,itemTypes:["node","edge","combo"],trigger:"click",container:null,loadingContent:"<div class='g6-loading-dom'></div>",liHoverStyle:{color:"white","background-color":"#227EFF"}}}getEvents(){return"click"===this.options.trigger?{click:this.onMenuShow,touchend:this.onMenuShow}:{contextmenu:this.onMenuShow}}init(graph){super.init(graph);const className=this.options.className;insert_css_default()(`\n            .g6-contextmenu-li:hover{\n            ${Object.keys(this.options.liHoverStyle).map((k=>`${k}:${this.options.liHoverStyle[k]};`)).join("")}\n            }\n        `);const menu=createDOM(`<div class=${className||"g6-component-contextmenu"}></div>`);modifyCSS(menu,{top:"0px",position:"absolute",visibility:"hidden"});let container=this.options.container;container||(container=this.graph.container),(0,is_string.A)(container)&&(container=document.getElementById(container)),container.appendChild(menu),this.menu=menu}onMenuShow(e){var _a;return menu_awaiter(this,void 0,void 0,(function*(){const self=this;null===(_a=e.preventDefault)||void 0===_a||_a.call(e),self.onMenuHide();const itemTypes=this.options.itemTypes;if(e.itemId){if(e.itemId&&e.itemType&&-1===itemTypes.indexOf(e.itemType))return void self.onMenuHide()}else if(-1===itemTypes.indexOf("canvas"))return void self.onMenuHide();if(!(0,this.options.shouldBegin)(e))return;const menuDom=this.menu,graph=this.graph,menu=this.options.getContent(e),width=graph.getSize()[0],height=graph.getSize()[1],bbox=menuDom.getBoundingClientRect(),offsetX=this.options.offsetX||0,offsetY=this.options.offsetY||0,graphTop=this.graph.container.offsetTop,graphLeft=this.graph.container.offsetLeft;let x=e.viewport.x+graphLeft+offsetX,y=e.viewport.y+graphTop+offsetY-55;if(x+bbox.width>width&&(x-=bbox.width+graphLeft+offsetX),y+bbox.height>height&&(y-=bbox.height+graphTop+offsetY),modifyCSS(menuDom,{top:`${y}px`,left:`${x}px`,visibility:"visible"}),(0,is_string.A)(menu))menuDom.innerHTML=menu;else if(menu instanceof HTMLElement)menuDom.innerHTML=menu.outerHTML;else{if((0,is_string.A)(this.options.loadingContent)?menuDom.innerHTML=this.options.loadingContent:menuDom.innerHTML=this.options.loadingContent.outerHTML,e.itemId==this.currentTarget&&this.asyncMenu||(this.currentTarget=e.itemId,this.asyncMenu=yield this.options.getContent(e)),e.itemId!=this.currentTarget)return;(0,is_string.A)(this.asyncMenu)?menuDom.innerHTML=this.asyncMenu:menuDom.innerHTML=this.asyncMenu.outerHTML}this.removeMenuEventListener();const handleMenuClick=this.options.handleMenuClick;handleMenuClick&&(this.handleMenuClickWrapper=event=>{handleMenuClick(event.target,e.itemId,graph)},menuDom.addEventListener("click",this.handleMenuClickWrapper));let triggeredByFirstClick="click"===this.options.trigger;const handler=e=>{triggeredByFirstClick?triggeredByFirstClick=!1:self.onMenuHide()};document.body.addEventListener("click",handler),this.handler=handler}))}removeMenuEventListener(){const handleMenuClickWrapper=this.handleMenuClickWrapper,handler=this.handler;if(handleMenuClickWrapper){this.menu.removeEventListener("click",handleMenuClickWrapper),this.handleMenuClickWrapper=null}handler&&document.body.removeEventListener("click",handler)}onMenuHide(){const menuDom=this.menu;menuDom&&(modifyCSS(menuDom,{visibility:"hidden"}),this.removeMenuEventListener())}destroy(){const menu=this.menu;if(this.removeMenuEventListener(),menu){let container=this.options.container;container||(container=this.graph.container),(0,is_string.A)(container)&&(container=document.getElementById(container)),container.removeChild(menu)}}}class Minimap extends plugin_Plugin{constructor(options){super(options),this.itemMap=new Map,this.visibleCache={},this.handleUpdateCanvas=lodash_debounce((event=>{this.destroyed||this.updateCanvas()}),100,!1),this.handleVisibilityChange=params=>{const{ids,value}=params;ids.forEach((id=>{this.visibleCache[id]=value})),this.debounceCloneVisibility()},this.debounceCloneVisibility=lodash_debounce((()=>{const nodeGroup=this.canvas.getRoot().getElementById("node-group"),edgeGroup=this.canvas.getRoot().getElementById("edge-group");((null==nodeGroup?void 0:nodeGroup.childNodes)||[]).concat((null==edgeGroup?void 0:edgeGroup.childNodes)||[]).forEach((child=>{var _a;const id=null===(_a=child.getAttribute)||void 0===_a?void 0:_a.call(child,"data-item-id");this.visibleCache.hasOwnProperty(id)&&(this.visibleCache[id]?child.childNodes.forEach((shape=>shape.show())):!1===this.visibleCache[id]&&child.childNodes.forEach((shape=>shape.hide())))})),this.visibleCache={}}),50,!1)}getDefaultCfgs(){return{key:`minimap-${unique_id()}`,container:null,className:"g6-minimap",viewportClassName:"g6-minimap-viewport",mode:"default",padding:8,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0,hideEdge:!1}}getEvents(){return{afteritemstatechange:this.handleUpdateCanvas,afterlayout:this.handleUpdateCanvas,viewportchange:this.handleUpdateCanvas,afteritemchange:this.handleUpdateCanvas,afteritemvisibilitychange:this.handleVisibilityChange}}disableRefresh(){this.options.refresh=!1}enableRefresh(){this.options.refresh=!0,this.updateCanvas()}initViewport(){const{canvas,options,destroyed,graph}=this,{size,viewportClassName}=options;if(destroyed)return;const containerDOM=canvas.context.config.container,isFireFox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isSafari=navigator.userAgent.toLowerCase().indexOf("safari")>-1,viewport=createDOM(`<div\n      class=${viewportClassName}\n      style='position:absolute;\n        left:0;\n        top:0;\n        border: 2px solid #1980ff;\n        box-sizing:border-box;\n        background: rgba(0, 0, 255, 0.1);\n        cursor:move'\n      draggable=${!isSafari&&!isFireFox}\n    />`);let x=0,y=0,dragging=!1,resizing=!1;const dragstartevent=isSafari||isFireFox?"mousedown":"dragstart";this.container.addEventListener("mousemove",(e=>{const moveAtBorder=getMoveAtBorder(viewport,e);moveAtBorder?(this.container.style.cursor=cursorMap[moveAtBorder],viewport.style.cursor=cursorMap[moveAtBorder]):(this.container.style.cursor="unset",viewport.style.cursor="move")})),viewport.addEventListener(dragstartevent,(e=>{var _a,_b;if(resizing=getMoveAtBorder(viewport,e),!resizing){if(e.dataTransfer){const img=new Image;img.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' %3E%3Cpath /%3E%3C/svg%3E",null===(_b=(_a=e.dataTransfer).setDragImage)||void 0===_b||_b.call(_a,img,0,0);try{e.dataTransfer.setData("text/html","view-port-minimap")}catch(_c){e.dataTransfer.setData("text","view-port-minimap")}}this.options.refresh=!1,e.target===viewport&&(dragging=!0,x=e.clientX,y=e.clientY)}}).bind(this),!1);const dragListener=e=>{const{style}=viewport,left=parseInt(style.left,10),top=parseInt(style.top,10),width=parseInt(style.width,10),height=parseInt(style.height,10);if(resizing){const{clientX,clientY}=e,afterResize={left,top,width,height};return resizing.includes("left")?(afterResize.left=`${clientX}px`,afterResize.width=left+width-clientX+"px"):resizing.includes("right")&&(afterResize.width=clientX-left+"px"),resizing.includes("top")?(afterResize.top=`${clientY}`,afterResize.height=""+(top+height-clientY)):resizing.includes("bottom")&&(afterResize.height=""+(clientY-top)),void modifyCSS(viewport,afterResize)}if(!dragging||(0,is_nil.A)(e.clientX)||(0,is_nil.A)(e.clientY))return;const{ratio}=this,zoom=graph.getZoom();let dx=x-e.clientX,dy=y-e.clientY;(left-dx<0||left-dx+width>=size[0])&&(dx=0),(top-dy<0||top-dy+height>=size[1])&&(dy=0),graph.translate({dx:dx*zoom/ratio,dy:dy*zoom/ratio}).then((()=>{this.updateViewport()})),x=e.clientX,y=e.clientY};isSafari||isFireFox||viewport.addEventListener("drag",dragListener.bind(this),!1);const dragendListener=()=>{dragging=!1,resizing=!1,this.options.refresh=!0},dragendevent=isSafari||isFireFox?"mouseup":"dragend";viewport.addEventListener(dragendevent,dragendListener.bind(this),!1);viewport.addEventListener("wheel",(evt=>{}),!1),containerDOM.addEventListener("mouseleave",dragendListener.bind(this)),containerDOM.addEventListener("mouseup",dragendListener.bind(this)),(isSafari||isFireFox)&&containerDOM.addEventListener("mousemove",dragListener.bind(this),!1),this.viewport=viewport,containerDOM.appendChild(viewport)}updateViewport(){if(this.destroyed)return;this.viewport||this.initViewport();const{options,graph,dx,dy,ratio,viewport}=this,{size}=options,graphCanvasEl=graph.canvas.context.config.canvas,[graphWidth=(null==graphCanvasEl?void 0:graphCanvasEl.scrollWidth)||500,graphHeight=(null==graphCanvasEl?void 0:graphCanvasEl.scrollHeight)||500]=graph.getSize(),graphZoom=graph.getZoom(),graphBBox=graph.canvas.getRoot().getRenderBounds(),graphTopLeftViewport=graph.getViewportByCanvas({x:graphBBox.min[0],y:graphBBox.min[1]}),graphBottomRightViewport=graph.getViewportByCanvas({x:graphBBox.max[0],y:graphBBox.max[1]});let width=graphWidth*ratio/graphZoom,height=graphHeight*ratio/graphZoom,left=0,top=0;graphTopLeftViewport.x<0?(left=-graphTopLeftViewport.x/graphWidth*width+dx,graphBottomRightViewport.x<graphWidth&&(width=size[0]-left)):width-=graphTopLeftViewport.x/graphWidth*width-dx,graphTopLeftViewport.y<0?(top=-graphTopLeftViewport.y/graphHeight*height+dy,graphBottomRightViewport.y<graphHeight&&(height=size[1]-top)):height-=graphTopLeftViewport.y/graphHeight*height-dy;const right=width+left;right>size[0]&&(width-=right-size[0]);const bottom=height+top;bottom>size[1]&&(height-=bottom-size[1]),modifyCSS(viewport,{left:`${left}px`,top:`${top}px`,width:`${width}px`,height:`${height}px`})}updateGraphShapes(){const{graph,options,canvas}=this,graphGroup=graph.canvas.getRoot();if(graphGroup.destroyed)return;let clonedGroup;canvas.removeChildren();const{hideEdge}=options;hideEdge?(clonedGroup=new Group,canvas.appendChild(clonedGroup),graphGroup.children.forEach((group=>{"edge-group"!==group.id&&clonedGroup.appendChild(group.cloneNode(!0))}))):(clonedGroup=graphGroup.cloneNode(!0),canvas.appendChild(clonedGroup))}updateKeyShapes(){const{graph,options,canvas}=this,{hideEdge}=options,group=canvas.getRoot();hideEdge||lodash_each(graph.getAllEdgesData(),(edge=>{this.updateOneEdgeKeyShape(edge,group)})),lodash_each(graph.getAllNodesData(),(node=>{this.updateOneNodeKeyShape(node,group)}));const combos=graph.getAllCombosData();if(combos&&combos.length){let comboGroup=group.find((e=>"combo-group"===e.id));comboGroup||(comboGroup=new Group({id:"combo-group"}),group.appendChild(comboGroup)),setTimeout((()=>{this.destroyed||(lodash_each(combos,(combo=>{this.updateOneNodeKeyShape(combo,comboGroup)})),null==comboGroup||comboGroup.sort(),null==comboGroup||comboGroup.toBack(),this.updateCanvas())}),250)}this.clearDestroyedShapes()}updateOneNodeKeyShape(nodeModel,group){var _a;const{itemMap=new Map,graph}=this,graphNodeGroup=graph.canvas.getRoot().find((ele=>"node-group"===ele.id));if(!graphNodeGroup)return;let{minimapItem,graphItem}=itemMap.get(nodeModel.id)||{};minimapItem&&!minimapItem.destroyed||(graphItem=null===(_a=graphNodeGroup.find((ele=>ele.getAttribute("data-item-id")===nodeModel.id)))||void 0===_a?void 0:_a.find((ele=>"keyShape"===ele.id)),minimapItem=graphItem.cloneNode(),minimapItem.id=`minimap-keyShape-${nodeModel.id}`,group.appendChild(minimapItem),itemMap.set(nodeModel.id,{graphItem,minimapItem}));const bbox=graphItem.getRenderBounds();if(!bbox)return;const keyShapeStyle=graphItem.attributes,attrs=Object.assign(Object.assign({},keyShapeStyle),{cx:bbox.center[0],cy:bbox.center[1]});minimapItem.toFront();const shapeType=minimapItem.get("type");"rect"!==shapeType&&"image"!==shapeType&&"text"!==shapeType||(attrs.x=bbox.min[0],attrs.y=bbox.min[1]),Object.keys(attrs).forEach((key=>{minimapItem.style[key]=attrs[key]})),graph.getItemVisible(nodeModel.id)?minimapItem.show():minimapItem.hide();const zIndex=nodeModel.data.depth;isNaN(zIndex)||minimapItem.set("zIndex",zIndex),this.itemMap=itemMap}updateDelegateShapes(){const{graph,options,canvas}=this,{hideEdge}=options,group=canvas.getRoot();hideEdge||lodash_each(graph.getAllEdgesData(),(edge=>{this.updateOneEdgeKeyShape(edge,group)})),lodash_each(graph.getAllNodesData(),(node=>{this.updateOneNodeDelegateShape(node,group)}));const combos=graph.getAllCombosData();if(combos&&combos.length){const comboGroup=group.find((e=>"comboGroup"===e.get("name")))||group.addGroup({name:"comboGroup"});setTimeout((()=>{this.destroyed||(lodash_each(combos,(combo=>{this.updateOneNodeKeyShape(combo,comboGroup)})),null==comboGroup||comboGroup.sort(),null==comboGroup||comboGroup.toBack(),this.updateCanvas())}),250)}this.clearDestroyedShapes()}clearDestroyedShapes(){const{itemMap=new Map}=this;itemMap.forEach(((val,key)=>{const{minimapItem,graphItem}=val||{};graphItem.destroyed&&minimapItem&&(minimapItem.remove(),itemMap.delete(key))}))}updateOneEdgeKeyShape(edgeModel,group){var _a;const{itemMap=new Map,graph}=this,graphEdgeGroup=graph.canvas.getRoot().find((ele=>"edge-group"===ele.id));if(!graphEdgeGroup)return;let{minimapItem,graphItem}=itemMap.get(edgeModel.id)||{};if(minimapItem&&!minimapItem.destroyed){const{path,x1,x2,y1,y2}=graphItem.style;minimapItem.style.path=path,minimapItem.style.x1=x1,minimapItem.style.x2=x2,minimapItem.style.y1=y1,minimapItem.style.y2=y2}else graphItem=null===(_a=graphEdgeGroup.find((ele=>ele.getAttribute("data-item-id")===edgeModel.id)))||void 0===_a?void 0:_a.find((ele=>"keyShape"===ele.id)),minimapItem=graphItem.cloneNode(),minimapItem.id=`minimap-keyShape-${edgeModel.id}`,group.appendChild(minimapItem);graph.getItemVisible(edgeModel.id)?minimapItem.show():minimapItem.hide(),itemMap.set(edgeModel.id,{graphItem,minimapItem}),this.itemMap=itemMap}updateOneNodeDelegateShape(nodeModel,group){var _a;const{itemMap=new Map,options,graph}=this,{delegateStyle}=options,graphNodeGroup=graph.canvas.getRoot().find((ele=>"node-group"===ele.id));if(!graphNodeGroup)return;let{minimapItem,graphItem}=itemMap.get(nodeModel.id)||{};graphItem||(graphItem=null===(_a=graphNodeGroup.find((ele=>ele.getAttribute("data-item-id")===nodeModel.id)))||void 0===_a?void 0:_a.find((ele=>"keyShape"===ele.id)));const bbox=graphItem.getRenderBounds(),attrs=Object.assign({x:bbox.min[0],y:bbox.min[1],width:bbox.max[0]-bbox.min[0],height:bbox.max[1]-bbox.min[1]},delegateStyle);!minimapItem||minimapItem.destroyed?(minimapItem=new Rect({style:Object.assign(Object.assign(Object.assign({},graphItem.attributes),attrs),delegateStyle),id:`minimap-delegate-${nodeModel.id}`}),group.appendChild(minimapItem)):Object.keys(attrs).forEach((key=>minimapItem.style[key]=attrs[key])),minimapItem.toFront(),graph.getItemVisible(nodeModel.id)?minimapItem.show():minimapItem.hide(),itemMap.set(nodeModel.id,{graphItem,minimapItem}),this.itemMap=itemMap}init(graph){super.init(graph);this.initContainer().then((()=>this.updateCanvas()))}initContainer(){var _a,_b;const{graph,options}=this,{size,className}=options;let parentNode=options.container;const container=createDOM(`<div class='${className}' style='width: ${size[0]}px; height: ${size[1]}px; overflow: hidden;'></div>`);(0,is_string.A)(parentNode)&&(parentNode=document.getElementById(parentNode)),parentNode?parentNode.appendChild(container):graph.container.appendChild(container),this.container&&(this.container.remove(),null===(_a=this.viewport)||void 0===_a||_a.remove(),this.viewport=void 0,null===(_b=this.canvas)||void 0===_b||_b.destroy()),this.container=container;const containerDOM=createDOM('<div class="g6-minimap-container" style="position: relative;"></div>');container.appendChild(containerDOM),containerDOM.addEventListener("dragenter",(e=>{e.preventDefault()})),containerDOM.addEventListener("dragover",(e=>{e.preventDefault()}));const graphCanvas=graph.canvas;return this.canvas=createCanvas("canvas",containerDOM,size[0],size[1],graphCanvas.devicePixelRatio),this.canvas.ready}updateCanvas(){if(this.destroyed)return;const{graph,canvas,options}=this,{refresh,size,padding,mode}=options;if(!refresh||graph.destroyed||canvas.destroyed)return;switch(mode){case"default":this.updateGraphShapes();break;case"keyShape":this.updateKeyShapes();break;case"delegate":this.updateDelegateShapes()}const group=canvas.getRoot();if(!group)return;const minimapBBox=group.getRenderBounds(),graphBBox=graph.canvas.getRoot().getRenderBounds(),width=graphBBox.max[0]-graphBBox.min[0],height=graphBBox.max[1]-graphBBox.min[1],zoomRatio=Math.min((size[0]-2*padding)/width,(size[1]-2*padding)/height),zoomCenter=canvas.viewport2Canvas({x:0,y:0});canvas.getCamera().setFocalPoint(zoomCenter.x,zoomCenter.y),canvas.getCamera().setPosition(zoomCenter.x,zoomCenter.y),canvas.getCamera().setZoom(zoomRatio),canvas.getCamera().setPosition(minimapBBox.center[0],minimapBBox.center[1]),canvas.getCamera().setFocalPoint(minimapBBox.center[0],minimapBBox.center[1]);const{x:dx,y:dy}=canvas.canvas2Viewport({x:minimapBBox.min[0],y:minimapBBox.min[1]});this.ratio=zoomRatio,this.dx=dx,this.dy=dy,this.updateViewport()}getCanvas(){return this.canvas}getViewport(){return this.viewport}getContainer(){return this.container}destroy(){var _a;super.destroy(),null===(_a=this.canvas)||void 0===_a||_a.destroy();const container=this.container;(null==container?void 0:container.parentNode)&&container.parentNode.removeChild(container)}}const getMoveAtBorder=(dom,evt)=>{const bounds=dom.getBoundingClientRect(),{clientX,clientY}=evt;return Math.abs(clientX-bounds.x)<4&&Math.abs(clientY-bounds.y)<4?"left-top":Math.abs(clientX-bounds.x)<4&&Math.abs(clientY-bounds.y-bounds.height)<4?"left-bottom":Math.abs(clientX-bounds.x-bounds.width)<4&&Math.abs(clientY-bounds.y)<4?"right-top":Math.abs(clientX-bounds.x-bounds.width)<4&&Math.abs(clientY-bounds.y-bounds.height)<4?"right-bottom":Math.abs(clientX-bounds.x)<4?"left":Math.abs(clientY-bounds.y)<4?"top":Math.abs(clientY-bounds.y-bounds.height)<4&&"bottom"},cursorMap={"left-top":"nwse-resize","right-bottom":"nwse-resize","right-top":"nesw-resize","left-bottom":"nesw-resize",left:"ew-resize",right:"ew-resize",top:"ns-resize",bottom:"ns-resize"};class Toolbar extends plugin_Plugin{constructor(config){super(config),this.toolbarDOM=createDOM("<div></div>"),this.containerDOM=createDOM("<div></div>")}getDefaultCfgs(){return{handleClick:void 0,getContent:graph=>'<ul class="g6-component-toolbar">\n            <li code=\'zoomIn\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M658.432 428.736a33.216 33.216 0 0 1-33.152 33.152H525.824v99.456a33.216 33.216 0 0 1-66.304 0V461.888H360.064a33.152 33.152 0 0 1 0-66.304H459.52V296.128a33.152 33.152 0 0 1 66.304 0V395.52H625.28c18.24 0 33.152 14.848 33.152 33.152z m299.776 521.792a43.328 43.328 0 0 1-60.864-6.912l-189.248-220.992a362.368 362.368 0 0 1-215.36 70.848 364.8 364.8 0 1 1 364.8-364.736 363.072 363.072 0 0 1-86.912 235.968l192.384 224.64a43.392 43.392 0 0 1-4.8 61.184z m-465.536-223.36a298.816 298.816 0 0 0 298.432-298.432 298.816 298.816 0 0 0-298.432-298.432A298.816 298.816 0 0 0 194.24 428.8a298.816 298.816 0 0 0 298.432 298.432z"></path>\n              </svg>\n            </li>\n            <li code="zoomOut">\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M639.936 416a32 32 0 0 1-32 32h-256a32 32 0 0 1 0-64h256a32 32 0 0 1 32 32z m289.28 503.552a41.792 41.792 0 0 1-58.752-6.656l-182.656-213.248A349.76 349.76 0 0 1 480 768 352 352 0 1 1 832 416a350.4 350.4 0 0 1-83.84 227.712l185.664 216.768a41.856 41.856 0 0 1-4.608 59.072zM479.936 704c158.784 0 288-129.216 288-288S638.72 128 479.936 128a288.32 288.32 0 0 0-288 288c0 158.784 129.216 288 288 288z" p-id="3853"></path>\n              </svg>\n            </li>\n            <li code="realZoom">\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M384 320v384H320V320h64z m256 0v384H576V320h64zM512 576v64H448V576h64z m0-192v64H448V384h64z m355.968 576H92.032A28.16 28.16 0 0 1 64 931.968V28.032C64 12.608 76.608 0 95.168 0h610.368L896 192v739.968a28.16 28.16 0 0 1-28.032 28.032zM704 64v128h128l-128-128z m128 192h-190.464V64H128v832h704V256z"></path>\n              </svg>\n            </li>\n            <li code="autoZoom">\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z"></path>\n              </svg>\n            </li>\n          </ul>',zoomSensitivity:10,minZoom:1e-5,maxZoom:1e3}}getContainer(){const{container}=this.options;return this.containerDOM="string"==typeof container?document.getElementById(container):this.graph.container,this.containerDOM}init(graph){super.init(graph),this.getContainer(),this.insertStyle();const{getContent,className,handleClick,position}=this.options,toolBarContent=getContent(graph);this.toolbarDOM="string"==typeof toolBarContent?createDOM(toolBarContent):toolBarContent,this.toolbarDOM.className=className||"g6-component-toolbar",this.containerDOM.appendChild(this.toolbarDOM),this.toolbarDOM.addEventListener("click",(evt=>{const current=(evt=>{if(!evt)return[];if(evt.composedPath)return evt.composedPath();const path=[];let el=evt.target;for(;el;){if(path.push(el),"HTML"===el.tagName)return path.push(document,window),path;el=el.parentElement}return path})(evt).filter((p=>"LI"===p.nodeName));if(0===current.length)return;const code=current[0].getAttribute("code");code&&(handleClick?handleClick(code,graph):this.handleDefaultOperator(code))})),position&&modifyCSS(this.toolbarDOM,{top:`${position.y}px`,left:`${position.x}px`})}insertStyle(){"undefined"!=typeof document&&insert_css_default()("\n      .g6-component-toolbar {\n        position: absolute;\n        list-style-type: none;\n        padding: 6px;\n        left: 0px;\n        top: 0px;\n        background-color: rgba(255, 255, 255, 0.9);\n        border: 1px solid #e2e2e2;\n        border-radius: 4px;\n        font-size: 12px;\n        color: #545454;\n        margin: 0;\n      }\n      .g6-component-toolbar li {\n        float: left;\n        text-align: center;\n        width: 35px;\n        height: 24px;\n        cursor: pointer;\n        list-style-type:none;\n        list-style: none;\n        margin-left: 0px;\n      }\n      .g6-component-toolbar li .icon {\n        opacity: 0.7;\n      }\n      .g6-component-toolbar li .icon:hover {\n        opacity: 1;\n      }\n    ")}zoomOut(){const{zoomSensitivity}=this.options,zoomRatio=100/(100+zoomSensitivity);1!==zoomRatio&&this.graph.zoom(zoomRatio,void 0,{})}zoomIn(){const{zoomSensitivity}=this.options,zoomRatio=(100+zoomSensitivity)/100;1!==zoomRatio&&this.graph.zoom(zoomRatio,void 0,{})}realZoom(){this.graph.zoomTo(1,void 0,{})}autoZoom(){this.graph.fitView(void 0,{})}handleDefaultOperator(code){switch(code){case"zoomOut":this.zoomOut();break;case"zoomIn":this.zoomIn();break;case"realZoom":this.realZoom();break;case"autoZoom":this.autoZoom()}}destroy(){const{toolbarDOM,containerDOM}=this,{handleClick}=this.options;toolbarDOM&&containerDOM.removeChild(toolbarDOM),handleClick&&toolbarDOM.removeEventListener("click",handleClick),super.destroy()}}var tooltip_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};"undefined"!=typeof document&&insert_css_default()("\n    .g6-component-tooltip {\n        border: 1px solid #e2e2e2;\n        border-radius: 4px;\n        font-size: 12px;\n        color: #545454;\n        background-color: rgba(255, 255, 255, 0.9);\n        padding: 10px 8px;\n        box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n    }\n    .tooltip-type {\n        padding: 0;\n        margin: 0;\n    }\n    .tooltip-id {\n        color: #531dab;\n    }\n    .g6-loading-dom {\n    border: 5px solid #e5e5e5;\n    border-top: 5px solid #227EFF;\n    border-radius: 50%;\n    width: 25px;\n    height: 25px;\n    animation: turn-around 1.5s linear infinite;\n    }\n    @keyframes turn-around {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n");class Tooltip extends plugin_Plugin{constructor(options){super(options)}getDefaultCfgs(){return{key:`tooltip-${unique_id()}`,offsetX:0,offsetY:0,getContent:e=>`\n        <div>\n          <h4 class='tooltip-type'>类型: ${e.itemType}</h4>\n          <span class='tooltip-id'>ID: ${e.itemId}</span>\n        </div>\n        `,shouldBegin:e=>!0,itemTypes:["node","edge","combo"],trigger:"pointerenter",fixToNode:void 0,loadingContent:"<div class='g6-loading-dom'></div>"}}getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,afterremoveitem:this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointerleave":this.onPointerLeave,"node:pointermove":this.onPointerMove,"edge:pointerenter":this.onPointerEnter,"edge:pointerleave":this.onPointerLeave,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointerleave":this.onPointerLeave,"combo:pointermove":this.onPointerMove,afterremoveitem:this.onPointerLeave,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}init(graph){super.init(graph);const tooltip=createDOM(`<div class='${this.options.className||"g6-component-tooltip"}'></div>`);modifyCSS(tooltip,{position:"absolute",visibility:"hidden",display:"none"}),"click"!==this.options.trigger&&(tooltip.addEventListener("pointerenter",(e=>{modifyCSS(tooltip,{visibility:"visible",display:"unset"})})),tooltip.addEventListener("pointerleave",(e=>{this.hideTooltip()})));let container=this.options.container;container||(container=this.graph.container),(0,is_string.A)(container)&&(container=document.getElementById(container)),container.appendChild(tooltip),this.tooltip=tooltip,this.container=container}onClick(e){if(e.itemId&&e.itemType&&-1===this.options.itemTypes.indexOf(e.itemType))return;const{itemId}=e;this.currentTarget===itemId?(this.currentTarget=null,this.hideTooltip(),this.graph.emit("tooltipchange",{itemId,action:"hide"})):(this.currentTarget=itemId,this.showTooltip(e))}onPointerEnter(e){if(e.itemId&&e.itemType&&-1===this.options.itemTypes.indexOf(e.itemType))return;const{itemId}=e;this.currentTarget=itemId,this.showTooltip(e),this.graph.emit("tooltipchange",{itemId:e.itemId,action:"show"})}onPointerMove(e){e.itemId&&e.itemType&&-1===this.options.itemTypes.indexOf(e.itemType)||this.currentTarget&&e.itemId!==this.currentTarget&&this.showTooltip(e)}onPointerLeave(){this.hideTooltip(),this.graph.emit("tooltipchange",{itemId:this.currentTarget,action:"hide"}),this.currentTarget=null}clearContainer(){this.container.innerHTML=""}showTooltip(e){return tooltip_awaiter(this,void 0,void 0,(function*(){if(clearTimeout(this.hiddenTimer),!e.itemId)return;if(e.itemType&&-1===this.options.itemTypes.indexOf(e.itemType))return;const tooltip=this.options.getContent(e),tooltipDom=this.tooltip;modifyCSS(tooltipDom,{display:"unset"});const res=this.updatePosition(e);if(modifyCSS(tooltipDom,{visibility:"visible",left:`${res.x}px`,top:`${res.y}px`}),(0,is_string.A)(tooltip))tooltipDom.innerHTML=tooltip;else if(tooltip instanceof HTMLElement)this.clearContainer(),this.container.appendChild(tooltip);else{if(this.asyncTooltip=null,(0,is_string.A)(this.options.loadingContent)?tooltipDom.innerHTML=this.options.loadingContent:tooltipDom.innerHTML=this.options.loadingContent.outerHTML,this.asyncTooltip&&e.itemId===this.currentAsyncTarget||(this.currentAsyncTarget=e.itemId,this.asyncTooltip=yield this.options.getContent(e)),e.itemId!=this.currentAsyncTarget)return;(0,is_string.A)(this.asyncTooltip)?tooltipDom.innerHTML=this.asyncTooltip:(this.clearContainer(),this.container.appendChild(this.asyncTooltip))}}))}hideTooltip(){const tooltip=this.tooltip;tooltip&&(this.hiddenTimer=setTimeout((()=>{modifyCSS(tooltip,{visibility:"hidden",display:"none"})}),100),tooltip.addEventListener("pointerenter",(e=>{clearTimeout(this.hiddenTimer)})),tooltip.addEventListener("pointerleave",(e=>{modifyCSS(tooltip,{visibility:"hidden",display:"none"})})))}updatePosition(e){const shouldBegin=this.options.shouldBegin,tooltip=this.tooltip;if(!shouldBegin(e))return void modifyCSS(tooltip,{visibility:"hidden",display:"none"});const graph=this.graph,width=graph.getSize()[0],height=graph.getSize()[1],offsetX=this.options.offsetX||0,offsetY=this.options.offsetY||0;let point={x:e.viewport.x,y:e.viewport.y};const fixToNode=this.options.fixToNode;if(e.itemType&&"node"===e.itemType&&fixToNode){const itemBBox=graph.getRenderBBox(e.itemId),itemWidth=itemBBox.max[0]-itemBBox.min[0],itemHeight=itemBBox.max[1]-itemBBox.min[1];if((0,is_string.A)(fixToNode))switch(fixToNode){case"right":point={x:itemBBox.min[0]+1*itemWidth,y:itemBBox.min[1]-.5*itemHeight};break;case"rightTop":case"topRight":point={x:itemBBox.min[0]+1*itemWidth,y:itemBBox.min[1]-1*itemHeight};break;case"rightBottom":case"bottomRight":point={x:itemBBox.min[0]+1*itemWidth,y:itemBBox.min[1]};break;case"bottom":point={x:itemBBox.min[0]+0*itemWidth,y:itemBBox.min[1]};break;case"top":{const tooltipBBox=tooltip.getBoundingClientRect();point={x:itemBBox.min[0]+0*itemWidth,y:itemBBox.min[1]-tooltipBBox.height};break}case"left":{const tooltipBBox=tooltip.getBoundingClientRect();point={x:itemBBox.min[0]-tooltipBBox.width,y:itemBBox.min[1]-.5*itemHeight};break}case"leftTop":case"topLeft":{const tooltipBBox=tooltip.getBoundingClientRect();point={x:itemBBox.min[0]-tooltipBBox.width,y:itemBBox.min[1]-1*itemHeight};break}case"leftBottom":case"bottomLeft":{const tooltipBBox=tooltip.getBoundingClientRect();point={x:itemBBox.min[0]-tooltipBBox.width,y:itemBBox.min[1]};break}default:point={x:itemBBox.min[0]+1*itemWidth,y:itemBBox.min[1]-.5*itemHeight},console.warn(`The '${this.options.fixToNode}' fixToNode position configuration is not supported, please use 'top'|'left'| 'right'| 'bottom'| 'topLeft'| 'leftTop'| 'topRight'| 'rightTop'| 'bottomLeft'| 'leftBottom'| 'bottomRight'| 'rightBottom', or use array to config, like: [0,5,1]`)}else(0,is_array.A)(fixToNode)&&fixToNode.length>=2&&(point={x:itemBBox.min[0]+itemWidth*fixToNode[0],y:itemBBox.min[1]-itemHeight*(1-fixToNode[1])})}const{x,y}=this.graph.getViewportByCanvas(point),graphContainer=this.graph.container,res={x:x+graphContainer.offsetLeft+offsetX,y:y+graphContainer.offsetTop+offsetY},bbox=tooltip.getBoundingClientRect();return x+bbox.width+offsetX>width&&(res.x-=bbox.width+offsetX),y+bbox.height+offsetY>height&&(res.y-=bbox.height+offsetY,res.y<0&&(res.y=0)),res}destroy(){this.container.removeChild(this.tooltip)}}function formatTime(date,mask){var timeMap={YYYY:date.getFullYear(),MM:date.getMonth()+1,DD:date.getDate(),HH:date.getHours(),mm:date.getMinutes(),ss:date.getSeconds()},strftime=mask;return Object.keys(timeMap).forEach((function(key){var val=timeMap[key];strftime=strftime.replace(key,"YYYY"===key?"".concat(val):"".concat(val).padStart(2,"0"))})),strftime}var AXIS_BASE_DEFAULT_ATTR={data:[],animate:{enter:!1,update:{duration:100,easing:"ease-in-out-sine",fill:"both"},exit:{duration:100,fill:"both"}},showArrow:!0,showGrid:!0,showLabel:!0,showLine:!0,showTick:!0,showTitle:!0,showTrunc:!1,dataThreshold:100,lineLineWidth:1,lineStroke:"black",crossPadding:10,titleFill:"black",titleFontSize:12,titlePosition:"lb",titleSpacing:0,titleTextAlign:"center",titleTextBaseline:"middle",lineArrow:function(){return new Path({style:{path:[["M",10,10],["L",-10,0],["L",10,-10],["L",0,0],["L",10,10],["Z"]],anchor:"0.5 0.5",fill:"black",transformOrigin:"center"}})},labelAlign:"parallel",labelDirection:"positive",labelFontSize:12,labelSpacing:0,gridConnect:"line",gridControlAngles:[],gridDirection:"positive",gridLength:0,gridType:"segment",lineArrowOffset:15,lineArrowSize:10,tickDirection:"positive",tickLength:5,tickLineWidth:1,tickStroke:"black",labelOverlap:[]},axis_constant_CLASS_NAMES=(deep_mix({},AXIS_BASE_DEFAULT_ATTR,{style:{type:"arc"}}),deep_mix({},AXIS_BASE_DEFAULT_ATTR,{style:{}}),classNames({mainGroup:"main-group",gridGroup:"grid-group",grid:"grid",lineGroup:"line-group",line:"line",tickGroup:"tick-group",tick:"tick",tickItem:"tick-item",labelGroup:"label-group",label:"label",labelItem:"label-item",titleGroup:"title-group",title:"title",lineFirst:"line-first",lineSecond:"line-second"},"axis"));function matrix_scale(vec,s){return[vec[0]*s,vec[1]*s]}function matrix_add(vec1,vec2){return[vec1[0]+vec2[0],vec1[1]+vec2[1]]}function matrix_sub(vec1,vec2){return[vec1[0]-vec2[0],vec1[1]-vec2[1]]}function matrix_min(vec1,vec2){return[Math.min(vec1[0],vec2[0]),Math.min(vec1[1],vec2[1])]}function matrix_max(vec1,vec2){return[Math.max(vec1[0],vec2[0]),Math.max(vec1[1],vec2[1])]}function matrix_distance(vec1,vec2){return Math.sqrt(Math.pow(vec1[0]-vec2[0],2)+Math.pow(vec1[1]-vec2[1],2))}function matrix_normalize(vec){if(0===vec[0]&&0===vec[1])return[0,0];var len=Math.sqrt(Math.pow(vec[0],2)+Math.pow(vec[1],2));return[vec[0]/len,vec[1]/len]}function degToRad(deg){return deg*Math.PI/180}function radToDeg(rad){return Number((180*rad/Math.PI).toPrecision(5))}function animation_fadeOut(element,options){return element.style.opacity||(element.style.opacity=1),transition(element,{opacity:0},options)}var PRIMILTIVE_ATTRIBUTES=["$el","anchor","cx","cy","d","defX","defY","dx","dy","fill","fillOpacity","filter","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","img","increasedLineWidthForHitTesting","innerHTML","isBillboard","billboardRotation","isSizeAttenuation","isClosed","isOverflowing","leading","letterSpacing","lineDash","lineHeight","lineWidth","markerEnd","markerEndOffset","markerMid","markerStart","markerStartOffset","maxLines","metrics","miterLimit","offsetX","offsetY","opacity","path","points","r","radius","rx","ry","shadowColor","src","stroke","strokeOpacity","text","textAlign","textBaseline","textDecorationColor","textDecorationLine","textDecorationStyle","textOverflow","textPath","textPathSide","textPathStartOffset","transform","transformOrigin","visibility","width","wordWrap","wordWrapWidth","x","x1","x2","y","y1","y2","z1","z2","zIndex"];function isPrimitiveAttribute(key){return PRIMILTIVE_ATTRIBUTES.includes(key)}function getPrimitiveAttributes(attributes){var object={};for(var key in attributes)isPrimitiveAttribute(key)&&(object[key]=attributes[key]);return object}var grid_CLASS_NAMES=classNames({lineGroup:"line-group",line:"line",regionGroup:"region-group",region:"region"},"grid");function getStraightPath(points){return points.reduce((function(acc,curr,idx){return acc.push((0,tslib_es6.fX)([0===idx?"M":"L"],(0,tslib_es6.zs)(curr),!1)),acc}),[])}function getLinePath(points,cfg,reversed){return"surround"===cfg.type?function getSurroundPath(points,attr,reversed){var _a=attr.connect,connect=void 0===_a?"line":_a,center=attr.center;if("line"===connect)return getStraightPath(points);if(!center)return[];var radius=matrix_distance(points[0],center),sweepFlag=reversed?0:1;return points.reduce((function(r,p,idx){return 0===idx?r.push((0,tslib_es6.fX)(["M"],(0,tslib_es6.zs)(p),!1)):r.push((0,tslib_es6.fX)(["A",radius,radius,0,0,sweepFlag],(0,tslib_es6.zs)(p),!1)),r}),[])}(points,cfg,reversed):getStraightPath(points)}function connectPaths(from,to,cfg){var type=cfg.type,connect=cfg.connect,center=cfg.center,closeFlag=cfg.closed?[["Z"]]:[],_a=(0,tslib_es6.zs)([getLinePath(from,cfg),getLinePath(to.slice().reverse(),cfg,!0)],2),path1=_a[0],path2=_a[1],_b=(0,tslib_es6.zs)([from[0],to.slice(-1)[0]],2),startOfFrom=_b[0],endOfTo=_b[1],createPath=function(insertA,insertB){return[path1,insertA,path2,insertB,closeFlag].flat()};if("line"===connect||"surround"===type)return createPath([(0,tslib_es6.fX)(["L"],(0,tslib_es6.zs)(endOfTo),!1)],[(0,tslib_es6.fX)(["L"],(0,tslib_es6.zs)(startOfFrom),!1)]);if(!center)throw new Error("Arc grid need to specified center");var _c=(0,tslib_es6.zs)([matrix_distance(endOfTo,center),matrix_distance(startOfFrom,center)],2),raduis1=_c[0],radius2=_c[1];return createPath([(0,tslib_es6.fX)(["A",raduis1,raduis1,0,0,1],(0,tslib_es6.zs)(endOfTo),!1),(0,tslib_es6.fX)(["L"],(0,tslib_es6.zs)(endOfTo),!1)],[(0,tslib_es6.fX)(["A",radius2,radius2,0,0,0],(0,tslib_es6.zs)(startOfFrom),!1),(0,tslib_es6.fX)(["L"],(0,tslib_es6.zs)(startOfFrom),!1)])}var grid_Grid=function(_super){function Grid(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Grid,_super),Grid.prototype.render=function(attributes,container){attributes.type,attributes.center,attributes.areaFill,attributes.closed;var style=(0,tslib_es6.Tt)(attributes,["type","center","areaFill","closed"]),data=function getData(attr){var _a=attr.data,data=void 0===_a?[]:_a;return attr.closed?data.map((function(datum){var points=datum.points,start=(0,tslib_es6.zs)(points,1)[0];return(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},datum),{points:(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(points),!1),[start],!1)})})):data}(attributes),lineGroup=selection_select(container).maybeAppendByClassName(grid_CLASS_NAMES.lineGroup,"g"),regionGroup=selection_select(container).maybeAppendByClassName(grid_CLASS_NAMES.regionGroup,"g"),lineTransitions=function renderGridLine(container,data,attr,style){var animate=attr.animate,isBillboard=attr.isBillboard,lines=data.map((function(item,idx){return{id:item.id||"grid-line-".concat(idx),path:getLinePath(item.points,attr)}}));return container.selectAll(grid_CLASS_NAMES.line.class).data(lines,(function(d){return d.id})).join((function(enter){return enter.append("path").each((function(datum,index){var lineStyle=getCallbackValue(getPrimitiveAttributes((0,tslib_es6.Cl)({path:datum.path},style)),[datum,index,lines]);this.attr((0,tslib_es6.Cl)({class:grid_CLASS_NAMES.line.name,stroke:"#D9D9D9",lineWidth:1,lineDash:[4,4],isBillboard},lineStyle))}))}),(function(update){return update.transition((function(datum,index){return transition(this,getCallbackValue(getPrimitiveAttributes((0,tslib_es6.Cl)({path:datum.path},style)),[datum,index,lines]),animate.update)}))}),(function(exit){return exit.transition((function(){var _this=this,animation=animation_fadeOut(this,animate.exit);return onAnimateFinished(animation,(function(){return _this.remove()})),animation}))})).transitions()}(lineGroup,data,attributes,style),reigionTransitions=function renderAlternateRegion(container,data,style){var animate=style.animate,connect=style.connect,areaFill=style.areaFill;if(data.length<2||!areaFill||!connect)return[];for(var colors=Array.isArray(areaFill)?areaFill:[areaFill,"transparent"],getColor=function(idx){return colors[idx%colors.length]},regions=[],idx=0;idx<data.length-1;idx++){var _a=(0,tslib_es6.zs)([data[idx].points,data[idx+1].points],2),path=connectPaths(_a[0],_a[1],style);regions.push({path,fill:getColor(idx)})}return container.selectAll(grid_CLASS_NAMES.region.class).data(regions,(function(_,i){return i})).join((function(enter){return enter.append("path").each((function(datum,index){var regionStyle=getCallbackValue(datum,[datum,index,regions]);this.attr(regionStyle)})).attr("className",grid_CLASS_NAMES.region.name)}),(function(update){return update.transition((function(datum,index){return transition(this,getCallbackValue(datum,[datum,index,regions]),animate.update)}))}),(function(exit){return exit.transition((function(){var _this=this,animation=animation_fadeOut(this,animate.exit);return onAnimateFinished(animation,(function(){return _this.remove()})),animation}))})).transitions()}(regionGroup,data,attributes);return(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(lineTransitions),!1),(0,tslib_es6.zs)(reigionTransitions),!1)},Grid}(GUI);const get=function(obj,key,defaultValue){for(var p=0,keyArr=(0,is_string.A)(key)?key.split("."):key;obj&&p<keyArr.length;)obj=obj[keyArr[p++]];return void 0===obj||p<keyArr.length?defaultValue:obj};var numberInterpolate=function(from,to){return function(t){return from*(1-t)+to*t}};function interpolate_interpolate(from,to){return"number"==typeof from&&"number"==typeof to?numberInterpolate(from,to):Array.isArray(from)&&Array.isArray(to)?function arrayInterpolate(from,to){var nb=to?to.length:0,na=from?Math.min(nb,from.length):0;return function(t){var x=new Array(na),c=new Array(nb),i=0;for(i=0;i<na;++i)x[i]=interpolate_interpolate(from[i],to[i]);for(;i<nb;++i)c[i]=to[i];for(i=0;i<na;++i)c[i]=x[i](t);return c}}(from,to):"object"==typeof from&&"object"==typeof to?function objectInterpolate(from,to){void 0===from&&(from={}),void 0===to&&(to={});var i={},c={};return Object.entries(to).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),k=_b[0],v=_b[1];k in from?i[k]=interpolate_interpolate(from[k],v):c[k]=v})),function(t){return Object.entries(i).forEach((function(_a){var _b=(0,tslib_es6.zs)(_a,2),k=_b[0],v=_b[1];return c[k]=v(t)})),c}}(from,to):function(t){return from}}function omit(obj,keys){var res={},innerKeys=Array.isArray(keys)?keys:[keys];for(var key in obj)innerKeys.includes(key)||(res[key]=obj[key]);return res}function getCallbackStyle(style,params){return Object.fromEntries(Object.entries(style).map((function(_a){var _b=(0,tslib_es6.zs)(_a,2);return[_b[0],getCallbackValue(_b[1],params)]})))}function filterExec(data,filter){return filter&&(0,is_function.A)(filter)?data.filter(filter):data}var getLineAngle=lodash_memoize((function(value,attr){var startAngle=attr.startAngle;return(attr.endAngle-startAngle)*value+startAngle}),(function(value,attr){return[value,attr.startAngle,attr.endAngle].join()})),getLineTangentVector=lodash_memoize((function(value,attr){if("linear"===attr.type){var _a=(0,tslib_es6.zs)(attr.startPos,2),startX=_a[0],startY=_a[1],_b=(0,tslib_es6.zs)(attr.endPos,2),endX=_b[0],endY=_b[1],_c=(0,tslib_es6.zs)([endX-startX,endY-startY],2);return matrix_normalize([_c[0],_c[1]])}var angle=degToRad(getLineAngle(value,attr));return[-Math.sin(angle),Math.cos(angle)]}),(function(value,attr){var dependencies=function baseDependencies(attr){if("linear"===attr.type){var startPos=attr.startPos,endPos=attr.endPos;return(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(startPos),!1),(0,tslib_es6.zs)(endPos),!1)}var startAngle=attr.startAngle,endAngle=attr.endAngle,center=attr.center,radius=attr.radius;return(0,tslib_es6.fX)((0,tslib_es6.fX)([startAngle,endAngle],(0,tslib_es6.zs)(center),!1),[radius],!1)}(attr);return"arc"===attr.type&&dependencies.push(value),dependencies.join()}));function getDirectionVector(value,direction,attr){return function vertical(vec,flag){return flag?[vec[1],-vec[0]]:[-vec[1],vec[0]]}(getLineTangentVector(value,attr),"positive"!==direction)}function getLabelVector(value,attr){return getDirectionVector(value,attr.labelDirection,attr)}var getLinearValuePos=lodash_memoize((function(value,attr){var _a=(0,tslib_es6.zs)(attr.startPos,2),sx=_a[0],sy=_a[1],_b=(0,tslib_es6.zs)(attr.endPos,2),ex=_b[0],ey=_b[1],_c=(0,tslib_es6.zs)([ex-sx,ey-sy],2);return[sx+_c[0]*value,sy+_c[1]*value]}),(function(value,attr){return(0,tslib_es6.fX)((0,tslib_es6.fX)([value],(0,tslib_es6.zs)(attr.startPos),!1),(0,tslib_es6.zs)(attr.endPos),!1).join()})),getArcValuePos=lodash_memoize((function(value,attr){var radius=attr.radius,_a=(0,tslib_es6.zs)(attr.center,2),cx=_a[0],cy=_a[1],angle=degToRad(getLineAngle(value,attr));return[cx+radius*Math.cos(angle),cy+radius*Math.sin(angle)]}),(function(value,attr){var startAngle=attr.startAngle,endAngle=attr.endAngle,radius=attr.radius,center=attr.center;return(0,tslib_es6.fX)([value,startAngle,endAngle,radius],(0,tslib_es6.zs)(center),!1).join()}));function getValuePos(value,attr){return"linear"===attr.type?getLinearValuePos(value,attr):getArcValuePos(value,attr)}function isAxisHorizontal(attr){return 0===getLineTangentVector(0,attr)[1]}function isAxisVertical(attr){return 0===getLineTangentVector(0,attr)[0]}function isCircle(startAngle,endAngle){return endAngle-startAngle==360}function getArcPath(startAngle,endAngle,cx,cy,radius){var diffAngle=endAngle-startAngle,_a=(0,tslib_es6.zs)([radius,radius],2),rx=_a[0],ry=_a[1],_b=(0,tslib_es6.zs)([degToRad(startAngle),degToRad(endAngle)],2),startAngleRadians=_b[0],endAngleRadians=_b[1],getPosByAngle=function(angle){return[cx+radius*Math.cos(angle),cy+radius*Math.sin(angle)]},_c=(0,tslib_es6.zs)(getPosByAngle(startAngleRadians),2),x1=_c[0],y1=_c[1],_d=(0,tslib_es6.zs)(getPosByAngle(endAngleRadians),2),x2=_d[0],y2=_d[1];if(isCircle(startAngle,endAngle)){var middleAngleRadians=(endAngleRadians+startAngleRadians)/2,_e=(0,tslib_es6.zs)(getPosByAngle(middleAngleRadians),2);return[["M",x1,y1],["A",rx,ry,0,1,0,_e[0],_e[1]],["A",rx,ry,0,1,0,x2,y2]]}var large=diffAngle>180?1:0,sweep=startAngle>endAngle?0:1;return"M".concat(x1,",").concat(y1,",A").concat(rx,",").concat(ry,",0,").concat(large,",").concat(sweep,",").concat(x2,",").concat(y2)}function renderArc(container,attr,style,animate){var startAngle=attr.startAngle,endAngle=attr.endAngle,center=attr.center,radius=attr.radius;return container.selectAll(axis_constant_CLASS_NAMES.line.class).data([{path:getArcPath.apply(void 0,(0,tslib_es6.fX)((0,tslib_es6.fX)([startAngle,endAngle],(0,tslib_es6.zs)(center),!1),[radius],!1))}],(function(d,i){return i})).join((function(enter){return enter.append("path").attr("className",axis_constant_CLASS_NAMES.line.name).styles(attr).styles({path:function(d){return d.path}})}),(function(update){return update.transition((function(){var _this=this,animation=function keyframeInterpolate(element,from,to,options){if(!options)return element.attr("__keyframe_data__",to),null;var _a=options.duration,duration=void 0===_a?0:_a,int=interpolate_interpolate(from,to),count=Math.ceil(+duration/16),keyframes=new Array(count).fill(0).map((function(datum,index,array){return{__keyframe_data__:int(index/(array.length-1))}}));return element.animate(keyframes,(0,tslib_es6.Cl)({fill:"both"},options))}(this,function getArcAttr(arc){var _a=arc.attributes,startAngle=_a.startAngle,endAngle=_a.endAngle,center=_a.center,radius=_a.radius;return(0,tslib_es6.fX)((0,tslib_es6.fX)([startAngle,endAngle],(0,tslib_es6.zs)(center),!1),[radius],!1)}(this),(0,tslib_es6.fX)((0,tslib_es6.fX)([startAngle,endAngle],(0,tslib_es6.zs)(center),!1),[radius],!1),animate.update);if(animation){var layout=function(){var data=get(_this.attributes,"__keyframe_data__");_this.style.path=getArcPath.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(data),!1))};animation.onframe=layout,animation.onfinish=layout}return animation})).styles(attr)}),(function(exit){return exit.remove()})).styles(style).transitions()}function line_getLinePath(points){var _a=(0,tslib_es6.zs)(points,2),_b=(0,tslib_es6.zs)(_a[0],2),x1=_b[0],y1=_b[1],_c=(0,tslib_es6.zs)(_a[1],2);return{x1,y1,x2:_c[0],y2:_c[1]}}function renderLinear(container,attr,style,animate){var showTrunc=attr.showTrunc,startPos=attr.startPos,endPos=attr.endPos,truncRange=attr.truncRange,lineExtension=attr.lineExtension,_a=(0,tslib_es6.zs)([startPos,endPos],2),_b=(0,tslib_es6.zs)(_a[0],2),x1=_b[0],y1=_b[1],_c=(0,tslib_es6.zs)(_a[1],2),x2=_c[0],y2=_c[1],_d=(0,tslib_es6.zs)(lineExtension?function extendLine(startPos,endPos,range){void 0===range&&(range=[0,0]);var _a=(0,tslib_es6.zs)([startPos,endPos,range],3),_b=(0,tslib_es6.zs)(_a[0],2),x1=_b[0],y1=_b[1],_c=(0,tslib_es6.zs)(_a[1],2),x2=_c[0],y2=_c[1],_d=(0,tslib_es6.zs)(_a[2],2),l1=_d[0],l2=_d[1],_e=(0,tslib_es6.zs)([x2-x1,y2-y1],2),x=_e[0],y=_e[1],L=Math.sqrt(Math.pow(x,2)+Math.pow(y,2)),_f=(0,tslib_es6.zs)([-l1/L,l2/L],2),s1=_f[0],s2=_f[1];return[s1*x,s1*y,s2*x,s2*y]}(startPos,endPos,lineExtension):new Array(4).fill(0),4),ox1=_d[0],oy1=_d[1],ox2=_d[2],oy2=_d[3],renderLine=function(data){return container.selectAll(axis_constant_CLASS_NAMES.line.class).data(data,(function(d,i){return i})).join((function(enter){return enter.append("line").attr("className",(function(d){return"".concat(axis_constant_CLASS_NAMES.line.name," ").concat(d.className)})).styles(style).transition((function(d){return transition(this,line_getLinePath(d.line),!1)}))}),(function(update){return update.styles(style).transition((function(_a){return transition(this,line_getLinePath(_a.line),animate.update)}))}),(function(exit){return exit.remove()})).transitions()};if(!showTrunc||!truncRange)return renderLine([{line:[[x1+ox1,y1+oy1],[x2+ox2,y2+oy2]],className:axis_constant_CLASS_NAMES.line.name}]);var _e=(0,tslib_es6.zs)(truncRange,2),r1=_e[0],r2=_e[1],dx=x2-x1,dy=y2-y1,_f=(0,tslib_es6.zs)([x1+dx*r1,y1+dy*r1],2),x3=_f[0],y3=_f[1],_g=(0,tslib_es6.zs)([x1+dx*r2,y1+dy*r2],2),x4=_g[0],y4=_g[1],animation=renderLine([{line:[[x1+ox1,y1+oy1],[x3,y3]],className:axis_constant_CLASS_NAMES.lineFirst.name},{line:[[x4,y4],[x2+ox2,y2+oy2]],className:axis_constant_CLASS_NAMES.lineSecond.name}]);return function renderTruncation(container,_a){_a.truncRange,_a.truncShape,_a.lineExtension}(0,attr),animation}function renderAxisLine(container,attr,animate){var animation,type=attr.type,style=subStyleProps(attr,"line");return animation="linear"===type?renderLinear(container,attr,omit(style,"arrow"),animate):renderArc(container,attr,omit(style,"arrow"),animate),function renderAxisArrow(container,type,attr,style){var shapeToAddArrow,showArrow=attr.showArrow,showTrunc=attr.showTrunc,lineArrow=attr.lineArrow,lineArrowOffset=attr.lineArrowOffset,lineArrowSize=attr.lineArrowSize;if(shapeToAddArrow="arc"===type?container.select(axis_constant_CLASS_NAMES.line.class):showTrunc?container.select(axis_constant_CLASS_NAMES.lineSecond.class):container.select(axis_constant_CLASS_NAMES.line.class),!showArrow||!lineArrow||"arc"===attr.type&&isCircle(attr.startAngle,attr.endAngle)){var node=shapeToAddArrow.node();node&&(node.style.markerEnd=void 0)}else{var arrow=renderExtDo(lineArrow);arrow.attr(style),scaleToPixel(arrow,lineArrowSize,!0),shapeToAddArrow.style("markerEnd",arrow).style("markerEndOffset",-lineArrowOffset)}}(container,type,attr,style),animation}function getGridCenter(attr){var type=attr.type,gridCenter=attr.gridCenter;return"linear"===type?gridCenter:gridCenter||attr.center}function renderStraight(data,attr){var gridLength=attr.gridLength;return data.map((function(_a,index){var value=_a.value,_b=(0,tslib_es6.zs)(getValuePos(value,attr),2),x=_b[0],y=_b[1],_c=(0,tslib_es6.zs)(matrix_scale(function getGridVector(value,attr){return getDirectionVector(value,attr.gridDirection,attr)}(value,attr),gridLength),2);return{id:index,points:[[x,y],[x+_c[0],y+_c[1]]]}}))}function renderGrid(container,data,attr,animate){var gridAttr=subStyleProps(attr,"grid"),type=gridAttr.type,areaFill=gridAttr.areaFill,center=getGridCenter(attr),finalData=filterExec(data,attr.gridFilter),gridItems="segment"===type?renderStraight(finalData,attr):function renderSurround(data,attr){var controlAngles=attr.gridControlAngles,center=getGridCenter(attr);if(!center)throw new Error("grid center is not provide");if(data.length<2)throw new Error("Invalid grid data");if(!controlAngles||0===controlAngles.length)throw new Error("Invalid gridControlAngles");var _a=(0,tslib_es6.zs)(center,2),cx=_a[0],cy=_a[1];return data.map((function(_a,index){var value=_a.value,_b=(0,tslib_es6.zs)(getValuePos(value,attr),2),sx=_b[0],sy=_b[1],_c=(0,tslib_es6.zs)([sx-cx,sy-cy],2),dx=_c[0],dy=_c[1],points=[];return controlAngles.forEach((function(angle){var angleInRad=degToRad(angle),_a=(0,tslib_es6.zs)([Math.cos(angleInRad),Math.sin(angleInRad)],2),cosa=_a[0],sina=_a[1],x=dx*cosa-dy*sina+cx,y=dx*sina+dy*cosa+cy;points.push([x,y])})),{points,id:index}}))}(finalData,attr),style=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},gridAttr),{center,areaFill:(0,is_function.A)(areaFill)?finalData.map((function(datum,index){return getCallbackValue(areaFill,[datum,index,finalData])})):areaFill,animate,data:gridItems});return container.selectAll(axis_constant_CLASS_NAMES.grid.class).data([1]).join((function(enter){return enter.append((function(){return new grid_Grid({style})})).attr("className",axis_constant_CLASS_NAMES.grid.name)}),(function(update){return update.transition((function(){return this.update(style)}))}),(function(exit){return exit.remove()})).transitions()}function inRange(n,start,end,includeLeft,includeRight){return void 0===includeLeft&&(includeLeft=!0),void 0===includeRight&&(includeRight=!1),!!(includeLeft&&n===start||includeRight&&n===end)||n>start&&n<end}function percentTransform(node,val){if(val)try{var computedVal=val.replace(/translate\(([+-]*[\d]+[%]*),[ ]*([+-]*[\d]+[%]*)\)/g,(function(match,x,y){return"translate(".concat(function getTranslate(node,x,y){var _a=node.getBBox(),width=_a.width,height=_a.height,_b=(0,tslib_es6.zs)([x,y].map((function(v,i){var _a;return v.includes("%")?parseFloat((null===(_a=v.match(/[+-]?([0-9]*[.])?[0-9]+/))||void 0===_a?void 0:_a[0])||"0")/100*(0===i?width:height):v})),2);return[_b[0],_b[1]]}(node,x,y),")")}));node.attr("transform",computedVal)}catch(e){}}var defined=function(x){return void 0!==x&&null!=x&&!Number.isNaN(x)},Bounds=function(){function Bounds(x1,y1,x2,y2){this.set(x1,y1,x2,y2)}return Object.defineProperty(Bounds.prototype,"left",{get:function(){return this.x1},enumerable:!1,configurable:!0}),Object.defineProperty(Bounds.prototype,"top",{get:function(){return this.y1},enumerable:!1,configurable:!0}),Object.defineProperty(Bounds.prototype,"right",{get:function(){return this.x2},enumerable:!1,configurable:!0}),Object.defineProperty(Bounds.prototype,"bottom",{get:function(){return this.y2},enumerable:!1,configurable:!0}),Object.defineProperty(Bounds.prototype,"width",{get:function(){return this.defined("x2")&&this.defined("x1")?this.x2-this.x1:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Bounds.prototype,"height",{get:function(){return this.defined("y2")&&this.defined("y1")?this.y2-this.y1:void 0},enumerable:!1,configurable:!0}),Bounds.prototype.rotatedPoints=function(radian,x,y){var x1=this.x1,y1=this.y1,x2=this.x2,y2=this.y2,cos=Math.cos(radian),sin=Math.sin(radian),cx=x-x*cos+y*sin,cy=y-x*sin-y*cos;return[[cos*x1-sin*y2+cx,sin*x1+cos*y2+cy],[cos*x2-sin*y2+cx,sin*x2+cos*y2+cy],[cos*x1-sin*y1+cx,sin*x1+cos*y1+cy],[cos*x2-sin*y1+cx,sin*x2+cos*y1+cy]]},Bounds.prototype.set=function(x1,y1,x2,y2){return x2<x1?(this.x2=x1,this.x1=x2):(this.x1=x1,this.x2=x2),y2<y1?(this.y2=y1,this.y1=y2):(this.y1=y1,this.y2=y2),this},Bounds.prototype.defined=function(key){return this[key]!==Number.MAX_VALUE&&this[key]!==-Number.MAX_VALUE},Bounds}();function getBounds(item,margin){var angle=item.getEulerAngles()||0;item.setEulerAngles(0);var _a=item.getLocalBounds(),_b=(0,tslib_es6.zs)(_a.min,2),x=_b[0],y=_b[1],_c=(0,tslib_es6.zs)(_a.max,2),right=_c[0],bottom=_c[1],_d=bounds_getBBox(item),w=_d.width,height=_d.height,dx=0,dy=0,anchorX=x,anchorY=y,text=textOf(item);if(text){height-=1.5;var a=text.style.textAlign,b_1=text.style.textBaseline;"center"===a?anchorX=(x+right)/2:"right"!==a&&"end"!==a||(anchorX=right),"middle"===b_1?anchorY=(y+bottom)/2:"bottom"===b_1&&(anchorY=bottom)}var _e=(0,tslib_es6.zs)(parseSeriesAttr(margin),4),_f=_e[0],t=void 0===_f?0:_f,_g=_e[1],r=void 0===_g?0:_g,_h=_e[2],b=void 0===_h?t:_h,_j=_e[3],bounds=new Bounds((dx+=x)-(void 0===_j?r:_j),(dy+=y)-t,dx+w+r,dy+height+b);return item.setEulerAngles(angle),bounds.rotatedPoints(degToRad(angle),anchorX,anchorY)}function bounds_getBBox(shape){return shape.__bbox__?shape.__bbox__:shape.getBBox()}function onLine(line,point){return point[0]<=Math.max(line[0][0],line[1][0])&&point[0]<=Math.min(line[0][0],line[1][0])&&point[1]<=Math.max(line[0][1],line[1][1])&&point[1]<=Math.min(line[0][1],line[1][1])}function direction(a,b,c){var val=(b[1]-a[1])*(c[0]-b[0])-(b[0]-a[0])*(c[1]-b[1]);return 0===val?0:val<0?2:1}function isRectangleBInsideA(rectA,rectB){return rectB.every((function(point){return function isPointInsideRectangle(polygon,point){var n=polygon.length;if(n<3)return!1;var line1,line2,dir1,dir2,dir3,dir4,lineToInfinity=[point,[9999,point[1]]],count=0,i=0;do{var side=[polygon[i],polygon[(i+1)%n]];if(line2=lineToInfinity,dir1=void 0,dir2=void 0,dir3=void 0,dir4=void 0,dir1=direction((line1=side)[0],line1[1],line2[0]),dir2=direction(line1[0],line1[1],line2[1]),dir3=direction(line2[0],line2[1],line1[0]),dir4=direction(line2[0],line2[1],line1[1]),dir1!==dir2&&dir3!==dir4||0===dir1&&onLine(line1,line2[0])||0===dir2&&onLine(line1,line2[1])||0===dir3&&onLine(line2,line1[0])||0===dir4&&onLine(line2,line1[1])){if(0===direction(side[0],point,side[1]))return onLine(side,point);count++}i=(i+1)%n}while(0!==i);return!!(1&count)}(rectA,point)}))}function lineToLine(line1,line2){var _a=(0,tslib_es6.zs)(line1,4),x0=_a[0],y0=_a[1],x1=_a[2],y1=_a[3],_b=(0,tslib_es6.zs)(line2,4),x2=_b[0],y2=_b[1],s10x=x1-x0,s10y=y1-y0,s32x=_b[2]-x2,s32y=_b[3]-y2,denom=s10x*s32y-s32x*s10y;if(0===denom)return!1;var denomPositive=denom>0,s02x=x0-x2,s02y=y0-y2,sNum=s10x*s02y-s10y*s02x;if(sNum<0===denomPositive)return!1;var tNum=s32x*s02y-s32y*s02x;return tNum<0!==denomPositive&&(sNum>denom!==denomPositive&&tNum>denom!==denomPositive)}function intersectBoxLine(box,line){return[[box[0],box[1],box[2],box[3]],[box[2],box[3],box[4],box[5]],[box[4],box[5],box[6],box[7]],[box[6],box[7],box[0],box[1]]].some((function(boxLine){return lineToLine(line,boxLine)}))}function boundTest(items,attr,margin){var e_1,_a,crossPadding=attr.crossPadding,resultSet=new Set,prev=null,crossBBox=function createCrossBBox(attr,padding){var type=attr.type,labelDirection=attr.labelDirection,crossSize=attr.crossSize;if(!crossSize)return!1;if("arc"===type){var center=attr.center,radius=attr.radius,_a=(0,tslib_es6.zs)(center,2),cx=_a[0],cy=_a[1],size="negative"===labelDirection?0:crossSize,dMin=-radius-size,dMax=radius+size,_b=(0,tslib_es6.zs)(parseSeriesAttr(padding),4),top_1=_b[0],right_1=_b[1],bottom_1=_b[2],left_1=_b[3];return new Bounds(cx+dMin-left_1,cy+dMin-top_1,cx+dMax+right_1,cy+dMax+bottom_1)}var _c=(0,tslib_es6.zs)(attr.startPos,2),sx=_c[0],sy=_c[1],_d=(0,tslib_es6.zs)(attr.endPos,2),ex=_d[0],ey=_d[1],_e=(0,tslib_es6.zs)(isAxisVertical(attr)?[-padding,0,padding,0]:[0,padding,0,-padding],4),top=_e[0],right=_e[1],bottom=_e[2],left=_e[3],diff=matrix_scale(getLabelVector(0,attr),crossSize),bbox=new Bounds(sx,sy,ex,ey);return bbox.x1+=left,bbox.y1+=top,bbox.x2+=right+diff[0],bbox.y2+=bottom+diff[1],bbox}(attr,crossPadding),testContain=function(item){return!crossBBox||function contain(container,child,margin){var x1=container.x1,x2=container.x2,y1=container.y1,y2=container.y2;return isRectangleBInsideA([[x1,y1],[x2,y1],[x2,y2],[x1,y2]],getBounds(child,margin))}(crossBBox,item)},testIntersect=function(prevItem,currItem){return!prevItem||!function intersect(a,b,margin){var e_1,_a,p=getBounds(a,margin).flat(1),q=getBounds(b,margin).flat(1),linesP=[[p[0],p[1],p[2],p[3]],[p[0],p[1],p[4],p[5]],[p[4],p[5],p[6],p[7]],[p[2],p[3],p[6],p[7]]];try{for(var linesP_1=(0,tslib_es6.Ju)(linesP),linesP_1_1=linesP_1.next();!linesP_1_1.done;linesP_1_1=linesP_1.next())if(intersectBoxLine(q,linesP_1_1.value))return!0}catch(e_1_1){e_1={error:e_1_1}}finally{try{linesP_1_1&&!linesP_1_1.done&&(_a=linesP_1.return)&&_a.call(linesP_1)}finally{if(e_1)throw e_1.error}}return!1}(prevItem,currItem,parseSeriesAttr(margin))};try{for(var items_1=(0,tslib_es6.Ju)(items),items_1_1=items_1.next();!items_1_1.done;items_1_1=items_1.next()){var curr=items_1_1.value;testContain(curr)?!prev||testIntersect(prev,curr)?prev=curr:(resultSet.add(prev),resultSet.add(curr)):resultSet.add(curr)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{items_1_1&&!items_1_1.done&&(_a=items_1.return)&&_a.call(items_1)}finally{if(e_1)throw e_1.error}}return Array.from(resultSet)}function parseLengthString(str,font){return void 0===font&&(font={}),(0,is_nil.A)(str)?0:"number"==typeof str?str:Math.floor(text_measureTextWidth(str,font))}var methods_parity=function(items,_a){var _b=_a.seq,seq=void 0===_b?2:_b;return items.filter((function(item,i){return!(i%seq)||(hide(item),!1)}))};var OverlapUtils=new Map([["hide",function hideLabels(labels,overlapCfg,attr,utils){var count=labels.length,keepHeader=overlapCfg.keepHeader,keepTail=overlapCfg.keepTail;if(!(count<=1||2===count&&keepHeader&&keepTail)){var first,last,arr,parityHide=methods_parity,reset=function(els){return els.forEach(utils.show),els},seq=2,source=labels.slice(),target=labels.slice(),minLabelWidth=Math.min.apply(Math,(0,tslib_es6.fX)([1],(0,tslib_es6.zs)(labels.map((function(d){return bounds_getBBox(d).width}))),!1));if("linear"===attr.type&&(isAxisHorizontal(attr)||isAxisVertical(attr))){var minX=getLocalBBox(labels[0]).left,maxX=getLocalBBox(labels[count-1]).right,distance=Math.abs(maxX-minX)||1;seq=Math.max(Math.floor(count*minLabelWidth/distance),seq)}for(keepHeader&&(first=source.splice(0,1)[0]),keepTail&&(last=source.splice(-1,1)[0],source.reverse()),reset(source);seq<labels.length&&boundTest((arr=last?(0,tslib_es6.fX)((0,tslib_es6.fX)([last],(0,tslib_es6.zs)(target),!1),[first],!1):(0,tslib_es6.fX)([first],(0,tslib_es6.zs)(target),!1),arr.filter(defined)),attr,null==overlapCfg?void 0:overlapCfg.margin).length;){if(last&&!first&&seq%2==0)source.splice(0,1).forEach(utils.hide);else if(last&&first){source.splice(0,1).forEach(utils.hide)}target=parityHide(reset(source),{seq}),seq++}}}],["rotate",function rotateLabels(labels,overlapCfg,attr,utils){var e_1,_a,_b=overlapCfg.optionalAngles,optionalAngles=void 0===_b?[0,45,90]:_b,margin=overlapCfg.margin,_c=overlapCfg.recoverWhenFailed,recoverWhenFailed=void 0===_c||_c,defaultAngles=labels.map((function(label){return label.getLocalEulerAngles()})),setLabelsRotate=function(angle){return labels.forEach((function(label,index){var rotate=Array.isArray(angle)?angle[index]:angle;utils.rotate(label,+rotate)}))};try{for(var optionalAngles_1=(0,tslib_es6.Ju)(optionalAngles),optionalAngles_1_1=optionalAngles_1.next();!optionalAngles_1_1.done;optionalAngles_1_1=optionalAngles_1.next()){if(setLabelsRotate(optionalAngles_1_1.value),boundTest(labels,attr,margin).length<1)return}}catch(e_1_1){e_1={error:e_1_1}}finally{try{optionalAngles_1_1&&!optionalAngles_1_1.done&&(_a=optionalAngles_1.return)&&_a.call(optionalAngles_1)}finally{if(e_1)throw e_1.error}}recoverWhenFailed&&setLabelsRotate(defaultAngles)}],["ellipsis",function ellipseLabels(labels,overlapCfg,attr,utils){if(!(labels.length<=1)){var _a=overlapCfg.suffix,suffix=void 0===_a?"...":_a,minLength=overlapCfg.minLength,_b=overlapCfg.maxLength,maxLength=void 0===_b?1/0:_b,_c=overlapCfg.step,ellipsisStep=void 0===_c?" ":_c,_d=overlapCfg.margin,margin=void 0===_d?[0,0,0,0]:_d,font=getFont(utils.getTextShape(labels[0])),step=parseLengthString(ellipsisStep,font),min=minLength?parseLengthString(minLength,font):step,max=parseLengthString(maxLength,font);((0,is_nil.A)(max)||max===1/0)&&(max=Math.max.apply(null,labels.map((function(d){return bounds_getBBox(d).width}))));for(var source=labels.slice(),_e=(0,tslib_es6.zs)(margin,4),_loop_1=(_e[0],_e[1],_e[2],_e[3],function(allowedLength){if(source.forEach((function(label){utils.ellipsis(utils.getTextShape(label),allowedLength,suffix)})),(source=boundTest(labels,attr,margin)).length<1)return{value:void 0}}),allowedLength=max;allowedLength>min+step;allowedLength-=step){var state_1=_loop_1(allowedLength);if("object"==typeof state_1)return state_1.value}}}],["wrap",function wrapLabels(labels,overlapCfg,attr,utils){var _a=overlapCfg.wordWrapWidth,wordWrapWidth=void 0===_a?50:_a,_b=overlapCfg.maxLines,maxLines=void 0===_b?3:_b,_c=overlapCfg.recoverWhenFailed,recoverWhenFailed=void 0===_c||_c,_d=overlapCfg.margin,margin=void 0===_d?[0,0,0,0]:_d,defaultLines=labels.map((function(label){return label.attr("maxLines")||1})),minLines=Math.min.apply(Math,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(defaultLines),!1)),textBaseline=function inferTextBaseline(attr){var type=attr.type,labelDirection=attr.labelDirection;return"linear"===type&&isAxisHorizontal(attr)?"negative"===labelDirection?"bottom":"top":"middle"}(attr),setLabelsWrap=function(lines){return labels.forEach((function(label,index){var maxLines=Array.isArray(lines)?lines[index]:lines;utils.wrap(label,wordWrapWidth,maxLines,textBaseline)}))};if(!(minLines>maxLines)){for(var lines=minLines;lines<=maxLines;lines++)if(setLabelsWrap(lines),boundTest(labels,attr,margin).length<1)return;recoverWhenFailed&&setLabelsWrap(defaultLines)}}]]);function getFactor(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return args.reduce((function(acc,cur){return acc*function(str){return"positive"===str?-1:1}(cur)}),1)}var angleNormalizer=function(angle){for(var normalizedAngle=angle;normalizedAngle<0;)normalizedAngle+=360;return Math.round(normalizedAngle%360)},labels_getAngle=lodash_memoize((function(v1,v2){var _a=(0,tslib_es6.zs)(v1,2),x1=_a[0],y1=_a[1],_b=(0,tslib_es6.zs)(v2,2),x2=_b[0],y2=_b[1],_c=(0,tslib_es6.zs)([x1*x2+y1*y2,x1*y2-y1*x2],2),dot=_c[0],det=_c[1];return Math.atan2(det,dot)}),(function(v1,v2){return(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(v1),!1),(0,tslib_es6.zs)(v2),!1).join()}));function getLabelRotation(datum,label,attr){var _a,labelAlign=attr.labelAlign;if(null===(_a=label.style.transform)||void 0===_a?void 0:_a.includes("rotate"))return label.getLocalEulerAngles();var labelVector=getLabelVector(datum.value,attr),tangentVector=getLineTangentVector(datum.value,attr);return"horizontal"===labelAlign?0:function correctLabelRotation(_rotate){var rotate=(_rotate+360)%180;return inRange(rotate,-90,90)||(rotate+=180),rotate}(radToDeg("perpendicular"===labelAlign?labels_getAngle([1,0],labelVector):labels_getAngle([tangentVector[0]<0?-1:1,0],tangentVector)))}function getLabelStyle(value,rotate,attr){var type=attr.type,labelAlign=attr.labelAlign,labelVector=getLabelVector(value,attr),labelAngle=angleNormalizer(rotate),tickAngle=angleNormalizer(radToDeg(labels_getAngle([1,0],labelVector))),textAlign="center",textBaseline="middle";return"linear"===type?[90,270].includes(tickAngle)&&0===labelAngle?(textAlign="center",textBaseline=1===labelVector[1]?"top":"bottom"):tickAngle%180||![90,270].includes(labelAngle)?0===tickAngle?(inRange(labelAngle,0,90,!1,!0)||inRange(labelAngle,0,90)||inRange(labelAngle,270,360))&&(textAlign="start"):90===tickAngle?inRange(labelAngle,0,90,!1,!0)?textAlign="start":(inRange(labelAngle,90,180)||inRange(labelAngle,270,360))&&(textAlign="end"):270===tickAngle?inRange(labelAngle,0,90,!1,!0)?textAlign="end":(inRange(labelAngle,90,180)||inRange(labelAngle,270,360))&&(textAlign="start"):180===tickAngle&&(90===labelAngle?textAlign="start":(inRange(labelAngle,0,90)||inRange(labelAngle,270,360))&&(textAlign="end")):textAlign="center":"parallel"===labelAlign?textBaseline=inRange(tickAngle,0,180,!0)?"top":"bottom":"horizontal"===labelAlign?inRange(tickAngle,90,270,!1)?textAlign="end":(inRange(tickAngle,270,360,!1)||inRange(tickAngle,0,90))&&(textAlign="start"):"perpendicular"===labelAlign&&(textAlign=inRange(tickAngle,90,270)?"end":"start"),{textAlign,textBaseline}}function getLabelPos(datum,data,attr){var showTick=attr.showTick,tickLength=attr.tickLength,tickDirection=attr.tickDirection,labelDirection=attr.labelDirection,labelSpacing=attr.labelSpacing,index=data.indexOf(datum),finalLabelSpacing=getCallbackValue(labelSpacing,[datum,index,data]),_a=(0,tslib_es6.zs)([getLabelVector(datum.value,attr),getFactor(labelDirection,tickDirection)],2),labelVector=_a[0],extraLength=1===_a[1]?getCallbackValue(showTick?tickLength:0,[datum,index,data]):0,_b=(0,tslib_es6.zs)(matrix_add(matrix_scale(labelVector,finalLabelSpacing+extraLength),getValuePos(datum.value,attr)),2);return{x:_b[0],y:_b[1]}}function applyTextStyle(node,style){"text"===node.nodeName&&node.attr(style)}function overlapHandler(attr){!function processOverlap(labels,attr,utils){var _a=attr.labelOverlap,labelOverlap=void 0===_a?[]:_a;labelOverlap.length&&labelOverlap.forEach((function(overlapCfg){var type=overlapCfg.type,util=OverlapUtils.get(type);(function canProcessOverlap(labels,attr,type){return!(attr.labelOverlap.length<1)&&("hide"===type?!function isInOffscreenGroup(group){for(var ancestor=group;ancestor;){if("offscreen"===ancestor.className)return!0;ancestor=ancestor.parent}return!1}(labels[0]):"rotate"===type?!labels.some((function(label){var _a;return!!(null===(_a=label.attr("transform"))||void 0===_a?void 0:_a.includes("rotate"))})):"ellipsis"!==type&&"wrap"!==type||labels.filter((function(item){return item.querySelector("text")})).length>1)})(labels,attr,type)&&(null==util||util(labels,overlapCfg,attr,utils))}))}(this.node().childNodes,attr,{hide,show,rotate:function(label,angle){!function setRotateAndAdjustLabelAlign(rotate,group,attr){group.setLocalEulerAngles(rotate);var textStyle=getLabelStyle(group.__data__.value,rotate,attr),label=group.querySelector(axis_constant_CLASS_NAMES.labelItem.class);label&&applyTextStyle(label,textStyle)}(+angle,label,attr)},ellipsis:function(label,len,suffix){label&&ellipsisIt(label,len||1/0,suffix)},wrap:function(label,width,lines){label&&function wrapIt(node,wordWrapWidth,maxLines,textBaseline){void 0===maxLines&&(maxLines=2),void 0===textBaseline&&(textBaseline="top"),applyToText(node,{wordWrap:!0,wordWrapWidth,maxLines,textBaseline})}(label,width,lines)},getTextShape:function(label){return label.querySelector("text")}})}function renderLabel(container,datum,data,style,attr){var index=data.indexOf(datum),label=selection_select(container).append(function formatter(datum,index,data,attr){var labelFormatter=attr.labelFormatter;return(0,is_function.A)(labelFormatter)?function(){return renderExtDo(getCallbackValue(labelFormatter,[datum,index,data,getLabelVector(datum.value,attr)]))}:function(){return renderExtDo(datum.label||"")}}(datum,index,data,attr)).attr("className",axis_constant_CLASS_NAMES.labelItem.name).node(),_a=(0,tslib_es6.zs)(splitStyle(getCallbackStyle(style,[datum,index,data])),2),labelStyle=_a[0],_b=_a[1],transform=_b.transform,groupStyle=(0,tslib_es6.Tt)(_b,["transform"]);percentTransform(container,transform);var rotate=getLabelRotation(datum,container,attr);return container.setLocalEulerAngles(+rotate),applyTextStyle(label,(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},getLabelStyle(datum.value,rotate,attr)),labelStyle)),percentTransform(container,transform),container.attr(groupStyle),label}function renderLabels(container,data,attr,animate){var finalData=filterExec(data,attr.labelFilter),style=subStyleProps(attr,"label");return container.selectAll(axis_constant_CLASS_NAMES.label.class).data(finalData,(function(d,i){return i})).join((function(enter){return enter.append("g").attr("className",axis_constant_CLASS_NAMES.label.name).transition((function(datum){return renderLabel(this,datum,data,style,attr),this.attr(getLabelPos(datum,data,attr)),this.__bbox__=datum.bbox,null})).call((function(){return overlapHandler.call(container,attr)}))}),(function(update){return update.transition((function(datum){var shapeAnimation=function transitionShape(source,target,options,after){if(void 0===after&&(after="destroy"),function identicalTextNode(source,target){return"text"===source.nodeName&&"text"===target.nodeName&&source.attributes.text===target.attributes.text}(source,target))return source.remove(),[null];var afterTransition=function(){"destroy"===after?source.destroy():"hide"===after&&hide(source),target.isVisible()&&show(target)};if(!options)return afterTransition(),[null];var _a=options.duration,duration=void 0===_a?0:_a,_b=options.delay,delay=void 0===_b?0:_b,middle=Math.ceil(+duration/2),offset=+duration/4,getPosition=function(shape){if("circle"===shape.nodeName){var _a=(0,tslib_es6.zs)(shape.getLocalPosition(),2),cx=_a[0],cy=_a[1],r=shape.attr("r");return[cx-r,cy-r]}return shape.getLocalPosition()},_c=(0,tslib_es6.zs)(getPosition(source),2),sx=_c[0],sy=_c[1],_d=(0,tslib_es6.zs)(getPosition(target),2),ex=_d[0],ey=_d[1],_e=(0,tslib_es6.zs)([(sx+ex)/2-sx,(sy+ey)/2-sy],2),mx=_e[0],my=_e[1],_f=source.style.opacity,so=void 0===_f?1:_f,_g=target.style.opacity,to=void 0===_g?1:_g,sourceAnimation=source.animate([{opacity:so,transform:"translate(0, 0)"},{opacity:0,transform:"translate(".concat(mx,", ").concat(my,")")}],(0,tslib_es6.Cl)((0,tslib_es6.Cl)({fill:"both"},options),{duration:delay+middle+offset})),targetAnimation=target.animate([{opacity:0,transform:"translate(".concat(-mx,", ").concat(-my,")"),offset:.01},{opacity:to,transform:"translate(0, 0)"}],(0,tslib_es6.Cl)((0,tslib_es6.Cl)({fill:"both"},options),{duration:middle+offset,delay:delay+middle-offset}));return onAnimateFinished(targetAnimation,afterTransition),[sourceAnimation,targetAnimation]}(this.querySelector(axis_constant_CLASS_NAMES.labelItem.class),renderLabel(this,datum,data,style,attr),animate.update),animation=transition(this,getLabelPos(datum,data,attr),animate.update);return this.__bbox__=datum.bbox,(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(shapeAnimation),!1),[animation],!1)})).call((function(selection){!function onAnimatesFinished(animations,callback){0===animations.length?callback():Promise.all(animations.map((function(a){return null==a?void 0:a.finished}))).then(callback)}(get(selection,"_transitions").flat().filter(defined),(function(){return overlapHandler.call(container,attr)}))}))}),(function(exit){return exit.transition((function(){var _this=this,animation=animation_fadeOut(this.childNodes[0],animate.exit);return onAnimateFinished(animation,(function(){return selection_select(_this).remove()})),animation}))})).transitions()}function getTickVector(value,attr){return getDirectionVector(value,attr.tickDirection,attr)}var getTickPoints=lodash_memoize((function(unitVector,tickLength){var _a=(0,tslib_es6.zs)(unitVector,2);return[[0,0],[_a[0]*tickLength,_a[1]*tickLength]]}),(function(unitVector,tickLength){return(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(unitVector),!1),[tickLength],!1).join()}));function applyTickStyle(datum,index,data,tick,group,attr,style){var tickVector=getTickVector(datum.value,attr),_a=function getTickLineLayout(datum,index,data,tickVector,attr){var tickLength=attr.tickLength,_a=(0,tslib_es6.zs)(getTickPoints(tickVector,getCallbackValue(tickLength,[datum,index,data])),2),_b=(0,tslib_es6.zs)(_a[0],2),x1=_b[0],y1=_b[1],_c=(0,tslib_es6.zs)(_a[1],2);return{x1,x2:_c[0],y1,y2:_c[1]}}(datum,index,data,tickVector,attr),x1=_a.x1,x2=_a.x2,y1=_a.y1,y2=_a.y2,_b=(0,tslib_es6.zs)(splitStyle(getCallbackStyle(style,[datum,index,data,tickVector])),2),tickStyle=_b[0],groupStyle=_b[1];"line"===tick.node().nodeName&&tick.styles((0,tslib_es6.Cl)({x1,x2,y1,y2},tickStyle)),group.attr(groupStyle),tick.styles(tickStyle)}function createTick(datum,index,data,attr,tickAttr,animate){var tick=function createTickEl(container,datum,index,data,attr){var formatter=attr.tickFormatter,tickVector=getTickVector(datum.value,attr),el="line";return(0,is_function.A)(formatter)&&(el=function(){return getCallbackValue(formatter,[datum,index,data,tickVector])}),container.append(el).attr("className",axis_constant_CLASS_NAMES.tickItem.name)}(selection_select(this),datum,index,data,attr);applyTickStyle(datum,index,data,tick,this,attr,tickAttr);var _a=(0,tslib_es6.zs)(getValuePos(datum.value,attr),2);return transition(this,{x:_a[0],y:_a[1]},animate)}function applyTitleStyle(title,group,axis,attr,animate){var style=subStyleProps(attr,"title"),_a=(0,tslib_es6.zs)(splitStyle(style),2),titleStyle=_a[0],_b=_a[1],specified=_b.transform,groupStyle=(0,tslib_es6.Tt)(_b,["transform"]);title.styles(titleStyle),group.styles(groupStyle);var transform=specified||function inferTransform(n,direction,position){var node=n.cloneNode(!0);node.style.transform="scale(1, 1)",node.style.transform="none";var height=node.getBBox().height;if("vertical"===direction){if("left"===position)return"rotate(-90) translate(0, ".concat(height/2,")");if("right"===position)return"rotate(-90) translate(0, -".concat(height/2,")")}return""}(title.node(),titleStyle.direction,titleStyle.position);percentTransform(title.node(),transform);var _c=function getTitlePosition(mainGroup,titleGroup,attr){var _a=attr.titlePosition,position=void 0===_a?"lb":_a,spacing=attr.titleSpacing,pos=parsePosition(position),_b=mainGroup.node().getLocalBounds(),_c=(0,tslib_es6.zs)(_b.min,2),mainX=_c[0],mainY=_c[1],_d=(0,tslib_es6.zs)(_b.halfExtents,2),mainHalfWidth=_d[0],mainHalfHeight=_d[1],_e=(0,tslib_es6.zs)(titleGroup.node().getLocalBounds().halfExtents,2),titleHalfWidth=_e[0],titleHalfHeight=_e[1],_f=(0,tslib_es6.zs)([mainX+mainHalfWidth,mainY+mainHalfHeight],2),x=_f[0],y=_f[1],_g=(0,tslib_es6.zs)(parseSeriesAttr(spacing),4),spacingTop=_g[0],spacingRight=_g[1],spacingBottom=_g[2],spacingLeft=_g[3];if(["start","end"].includes(position)&&"linear"===attr.type){var startPos=attr.startPos,endPos=attr.endPos,_h=(0,tslib_es6.zs)("start"===position?[startPos,endPos]:[endPos,startPos],2),from=_h[0],to=_h[1],direction=matrix_normalize([-to[0]+from[0],-to[1]+from[1]]),_j=(0,tslib_es6.zs)(matrix_scale(direction,spacingTop),2),dx=_j[0],dy=_j[1];return{x:from[0]+dx,y:from[1]+dy}}return pos.includes("t")&&(y-=mainHalfHeight+titleHalfHeight+spacingTop),pos.includes("r")&&(x+=mainHalfWidth+titleHalfWidth+spacingRight),pos.includes("l")&&(x-=mainHalfWidth+2*titleHalfWidth+spacingLeft),pos.includes("b")&&(y+=mainHalfHeight+2*titleHalfHeight+spacingBottom),{x,y}}(selection_select(axis._offscreen||axis.querySelector(axis_constant_CLASS_NAMES.mainGroup.class)),group,attr),x=_c.x,y=_c.y,animation=transition(group.node(),{x,y},animate);return percentTransform(title.node(),transform),animation}function renderAxisMain(attributes,container,data,animation){var showLine=attributes.showLine,showTick=attributes.showTick,showLabel=attributes.showLabel,lineTransitions=ifShow(showLine,container.maybeAppendByClassName(axis_constant_CLASS_NAMES.lineGroup,"g"),(function(group){return renderAxisLine(group,attributes,animation)}))||[],tickTransitions=ifShow(showTick,container.maybeAppendByClassName(axis_constant_CLASS_NAMES.tickGroup,"g"),(function(group){return function renderTicks(container,axisData,attr,animate){var finalData=filterExec(axisData,attr.tickFilter),tickAttr=subStyleProps(attr,"tick");return container.selectAll(axis_constant_CLASS_NAMES.tick.class).data(finalData,(function(d){return d.id||d.label})).join((function(enter){return enter.append("g").attr("className",axis_constant_CLASS_NAMES.tick.name).transition((function(datum,index){return createTick.call(this,datum,index,finalData,attr,tickAttr,!1)}))}),(function(update){return update.transition((function(datum,index){return this.removeChildren(),createTick.call(this,datum,index,finalData,attr,tickAttr,animate.update)}))}),(function(exit){return exit.transition((function(){var _this=this,animation=animation_fadeOut(this.childNodes[0],animate.exit);return onAnimateFinished(animation,(function(){return _this.remove()})),animation}))})).transitions()}(group,data,attributes,animation)}))||[],labelTransitions=ifShow(showLabel,container.maybeAppendByClassName(axis_constant_CLASS_NAMES.labelGroup,"g"),(function(group){return renderLabels(group,data,attributes,animation)}))||[];return(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(lineTransitions),!1),(0,tslib_es6.zs)(tickTransitions),!1),(0,tslib_es6.zs)(labelTransitions),!1).filter((function(t){return!!t}))}var Axis=function(_super){function Axis(options){return _super.call(this,options,AXIS_BASE_DEFAULT_ATTR)||this}return(0,tslib_es6.C6)(Axis,_super),Axis.prototype.render=function(attributes,container,specificAnimation){var _this=this,titleText=attributes.titleText,data=attributes.data,animate=attributes.animate,showTitle=attributes.showTitle,showGrid=attributes.showGrid,dataThreshold=attributes.dataThreshold,truncRange=attributes.truncRange,sampledData=function sampling(data,size){if(data.length<=size)return data;for(var step=Math.floor(data.length/size),result=[],i=0;i<data.length;i+=step)result.push(data[i]);return result}(data,dataThreshold).filter((function(_a){var value=_a.value;return!(truncRange&&value>truncRange[0]&&value<truncRange[1])})),finalAnimation=parseAnimationOption(void 0===specificAnimation?animate:specificAnimation),gridTransitions=ifShow(showGrid,selection_select(container).maybeAppendByClassName(axis_constant_CLASS_NAMES.gridGroup,"g"),(function(group){return renderGrid(group,sampledData,attributes,finalAnimation)}))||[],mainGroup=selection_select(container).maybeAppendByClassName(axis_constant_CLASS_NAMES.mainGroup,"g");titleText&&(!this.initialized&&finalAnimation.enter||this.initialized&&finalAnimation.update)&&renderAxisMain(attributes,selection_select(this.offscreenGroup),sampledData,parseAnimationOption(!1));var mainTransitions=renderAxisMain(attributes,selection_select(mainGroup.node()),sampledData,finalAnimation),titleTransitions=ifShow(showTitle,selection_select(container).maybeAppendByClassName(axis_constant_CLASS_NAMES.titleGroup,"g"),(function(group){return function renderTitle(container,axis,attr,animate){var titleText=attr.titleText;return container.selectAll(axis_constant_CLASS_NAMES.title.class).data([{title:titleText}].filter((function(d){return!!d.title})),(function(d,i){return d.title})).join((function(enter){return enter.append((function(){return renderExtDo(titleText)})).attr("className",axis_constant_CLASS_NAMES.title.name).transition((function(){return applyTitleStyle(selection_select(this),container,axis,attr,animate.enter)}))}),(function(update){return update.transition((function(){return applyTitleStyle(selection_select(this),container,axis,attr,animate.update)}))}),(function(exit){return exit.remove()})).transitions()}(group,_this,attributes,finalAnimation)}))||[];return(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(gridTransitions),!1),(0,tslib_es6.zs)(mainTransitions),!1),(0,tslib_es6.zs)(titleTransitions),!1).flat().filter((function(t){return!!t}))},Axis}(GUI);function getEventPos(e){var canvas=e.canvas,touches=e.touches,offsetX=e.offsetX,offsetY=e.offsetY;if(canvas)return[canvas.x,canvas.y];if(touches){var _a=touches[0];return[_a.clientX,_a.clientY]}return offsetX&&offsetY?[offsetX,offsetY]:[0,0]}function toPrecision(num,precision){return+num.toPrecision(precision)}var is_type_toString={}.toString;const esm_is_type=function(value,type){return is_type_toString.call(value)==="[object "+type+"]"},esm_is_function=function(value){return esm_is_type(value,"Function")},esm_is_array=function(value){return Array.isArray?Array.isArray(value):esm_is_type(value,"Array")};const esm_each=function esm_each_each(elements,func){var value,type;if(elements)if(esm_is_array(elements))for(var i=0,len=elements.length;i<len&&!1!==func(elements[i],i);i++);else if(type=typeof(value=elements),null!==value&&"object"===type||"function"===type)for(var k in elements)if(elements.hasOwnProperty(k)&&!1===func(elements[k],k))break};Object.keys;const esm_is_object_like=function(value){return"object"==typeof value&&null!==value};const esm_is_plain_object=function(value){if(!esm_is_object_like(value)||!esm_is_type(value,"Object"))return!1;if(null===Object.getPrototypeOf(value))return!0;for(var proto=value;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(value)===proto};var arrPrototype=Array.prototype;arrPrototype.splice,arrPrototype.indexOf;Array.prototype.splice;Object.prototype.hasOwnProperty;const esm_is_number=function(value){return esm_is_type(value,"Number")};Number.isInteger&&Number.isInteger;Math.PI;Math.PI;const esm_values=Object.values?function(obj){return Object.values(obj)}:function(obj){var result=[];return esm_each(obj,(function(value,key){esm_is_function(obj)&&"prototype"===key||result.push(value)})),result};const is_null=function(value){return null===value};Object.prototype;const esm_is_undefined=function(value){return void 0===value};function deep_mix_deepMix(dist,src,level,maxLevel){for(var key in level=level||0,maxLevel=maxLevel||5,src)if(src.hasOwnProperty(key)){var value=src[key];null!==value&&esm_is_plain_object(value)?(esm_is_plain_object(dist[key])||(dist[key]={}),level<maxLevel?deep_mix_deepMix(dist[key],value,level+1,maxLevel):dist[key]=src[key]):esm_is_array(value)?(dist[key]=[],dist[key]=dist[key].concat(value)):void 0!==value&&(dist[key]=value)}}const esm_deep_mix=function(rst){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var i=0;i<args.length;i+=1)deep_mix_deepMix(rst,args[i]);return rst};Object.prototype.hasOwnProperty;Object.prototype.hasOwnProperty;const esm_identity=function(v){return v};var measure_text_width_ctx;!function(f,resolver){if(!esm_is_function(f))throw new TypeError("Expected a function");var memoized=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=f.apply(this,args);return cache.set(key,result),result};memoized.cache=new Map}((function(text,font){void 0===font&&(font={});var fontSize=font.fontSize,fontFamily=font.fontFamily,fontWeight=font.fontWeight,fontStyle=font.fontStyle,fontVariant=font.fontVariant;return measure_text_width_ctx||(measure_text_width_ctx=document.createElement("canvas").getContext("2d")),measure_text_width_ctx.font=[fontStyle,fontVariant,fontWeight,fontSize+"px",fontFamily].join(" "),measure_text_width_ctx.measureText(function(str){return esm_is_type(str,"String")}(text)?text:"").width}),(function(text,font){return void 0===font&&(font={}),(0,tslib_es6.aN)([text],esm_values(font)).join("")}));!function(){function default_1(){this.map={}}default_1.prototype.has=function(key){return void 0!==this.map[key]},default_1.prototype.get=function(key,def){var v=this.map[key];return void 0===v?def:v},default_1.prototype.set=function(key,value){this.map[key]=value},default_1.prototype.clear=function(){this.map={}},default_1.prototype.delete=function(key){delete this.map[key]},default_1.prototype.size=function(){return Object.keys(this.map).length}}();class Base{constructor(options){this.options=esm_deep_mix({},this.getDefaultOptions()),this.update(options)}getOptions(){return this.options}update(updateOptions={}){this.options=esm_deep_mix({},this.options,updateOptions),this.rescale(updateOptions)}rescale(options){}}function createNormalize(a,b){return b-a?t=>(t-a)/(b-a):_=>.5}function compose(fn,...rest){return rest.reduce(((pre,cur)=>x=>pre(cur(x))),fn)}var color_string=__webpack_require__("./node_modules/color-string/index.js"),color_string_default=__webpack_require__.n(color_string);function color_hue2rgb(p,q,m){let t=m;return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}function string2rbg(s){const color=color_string_default().get(s);if(!color)return null;const{model,value}=color;return"rgb"===model?value:"hsl"===model?function hsl2rbg(hsl){const h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100,a=hsl[3];if(0===s)return[255*l,255*l,255*l,a];const q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;return[255*color_hue2rgb(p,q,h+1/3),255*color_hue2rgb(p,q,h),255*color_hue2rgb(p,q,h-1/3),a]}(value):null}const createInterpolateNumber=(a,b)=>t=>a*(1-t)+b*t,createInterpolateValue=(a,b)=>"number"==typeof a&&"number"==typeof b?createInterpolateNumber(a,b):"string"==typeof a&&"string"==typeof b?((a,b)=>{const c1=string2rbg(a),c2=string2rbg(b);return null===c1||null===c2?c1?()=>a:()=>b:t=>{const values=new Array(4);for(let i=0;i<4;i+=1){const from=c1[i],to=c2[i];values[i]=from*(1-t)+to*t}const[r,g,b,a]=values;return`rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, ${a})`}})(a,b):()=>a,createInterpolateRound=(a,b)=>{const interpolateNumber=createInterpolateNumber(a,b);return t=>Math.round(interpolateNumber(t))};function isValid(x){return!esm_is_undefined(x)&&!is_null(x)&&!Number.isNaN(x)}const e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickIncrement(start,stop,count){const step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/10**power;return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*10**power:-(10**-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}const d3LinearNice=(min,max,count=5)=>{const d=[min,max];let step,i0=0,i1=d.length-1,start=d[i0],stop=d[i1];return stop<start&&([start,stop]=[stop,start],[i0,i1]=[i1,i0]),step=tickIncrement(start,stop,count),step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step,step=tickIncrement(start,stop,count)):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step,step=tickIncrement(start,stop,count)),step>0?(d[i0]=Math.floor(start/step)*step,d[i1]=Math.ceil(stop/step)*step):step<0&&(d[i0]=Math.ceil(start*step)/step,d[i1]=Math.floor(stop*step)/step),d};const createBiMap=(domain,range,createInterpolate)=>{const[d0,d1]=domain,[r0,r1]=range;let normalize,interpolate;return d0<d1?(normalize=createNormalize(d0,d1),interpolate=createInterpolate(r0,r1)):(normalize=createNormalize(d1,d0),interpolate=createInterpolate(r1,r0)),compose(interpolate,normalize)},createPolyMap=(domain,range,createInterpolate)=>{const len=Math.min(domain.length,range.length)-1,normalizeList=new Array(len),interpolateList=new Array(len),reverse=domain[0]>domain[len],ascendingDomain=reverse?[...domain].reverse():domain,ascendingRange=reverse?[...range].reverse():range;for(let i=0;i<len;i+=1)normalizeList[i]=createNormalize(ascendingDomain[i],ascendingDomain[i+1]),interpolateList[i]=createInterpolate(ascendingRange[i],ascendingRange[i+1]);return x=>{const i=function bisect(array,x,lo,hi,getter){let i=lo||0,j=hi||array.length;const get=getter||(x=>x);for(;i<j;){const mid=Math.floor((i+j)/2);get(array[mid])>x?j=mid:i=mid+1}return i}(domain,x,1,len)-1,normalize=normalizeList[i];return compose(interpolateList[i],normalize)(x)}},choosePiecewise=(domain,range,interpolate,shouldRound)=>(Math.min(domain.length,range.length)>2?createPolyMap:createBiMap)(domain,range,shouldRound?createInterpolateRound:interpolate);class Continuous extends Base{getDefaultOptions(){return{domain:[0,1],range:[0,1],nice:!1,clamp:!1,round:!1,interpolate:createInterpolateNumber,tickCount:5}}map(x){return isValid(x)?this.output(x):this.options.unknown}invert(x){return isValid(x)?this.input(x):this.options.unknown}nice(){if(!this.options.nice)return;const[min,max,tickCount,...rest]=this.getTickMethodOptions();this.options.domain=this.chooseNice()(min,max,tickCount,...rest)}getTicks(){const{tickMethod}=this.options,[min,max,tickCount,...rest]=this.getTickMethodOptions();return tickMethod(min,max,tickCount,...rest)}getTickMethodOptions(){const{domain,tickCount}=this.options;return[domain[0],domain[domain.length-1],tickCount]}chooseNice(){return d3LinearNice}rescale(){this.nice();const[transform,untransform]=this.chooseTransforms();this.composeOutput(transform,this.chooseClamp(transform)),this.composeInput(transform,untransform,this.chooseClamp(untransform))}chooseClamp(transform){const{clamp:shouldClamp,range}=this.options,domain=this.options.domain.map(transform),n=Math.min(domain.length,range.length);return shouldClamp?function createClamp(a,b){const lo=b<a?b:a,hi=a>b?a:b;return x=>Math.min(Math.max(lo,x),hi)}(domain[0],domain[n-1]):esm_identity}composeOutput(transform,clamp){const{domain,range,round,interpolate}=this.options,piecewise=choosePiecewise(domain.map(transform),range,interpolate,round);this.output=compose(piecewise,clamp,transform)}composeInput(transform,untransform,clamp){const{domain,range}=this.options,piecewise=choosePiecewise(range,domain.map(transform),createInterpolateNumber);this.input=compose(untransform,clamp,piecewise)}}const d3Ticks=(begin,end,count)=>{let n,ticks,start=begin,stop=end;if(start===stop&&count>0)return[start];let step=tickIncrement(start,stop,count);if(0===step||!Number.isFinite(step))return[];if(step>0){start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));for(let i=0;i<n;i+=1)ticks[i]=(start+i)*step}else{step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));for(let i=0;i<n;i+=1)ticks[i]=(start+i)/step}return ticks};class Linear extends Continuous{getDefaultOptions(){return{domain:[0,1],range:[0,1],unknown:void 0,nice:!1,clamp:!1,round:!1,interpolate:createInterpolateValue,tickMethod:d3Ticks,tickCount:5}}chooseTransforms(){return[esm_identity,esm_identity]}clone(){return new Linear(this.options)}}function internGet({map,initKey},value){const key=initKey(value);return map.has(key)?map.get(key):value}function keyof(value){return"object"==typeof value?value.valueOf():value}class InternMap extends Map{constructor(entries){if(super(),this.map=new Map,this.initKey=keyof,null!==entries)for(const[key,value]of entries)this.set(key,value)}get(key){return super.get(internGet({map:this.map,initKey:this.initKey},key))}has(key){return super.has(internGet({map:this.map,initKey:this.initKey},key))}set(key,value){return super.set(function internSet({map,initKey},value){const key=initKey(value);return map.has(key)?map.get(key):(map.set(key,value),value)}({map:this.map,initKey:this.initKey},key),value)}delete(key){return super.delete(function internDelete({map,initKey},value){const key=initKey(value);return map.has(key)&&(value=map.get(key),map.delete(key)),value}({map:this.map,initKey:this.initKey},key))}}const defaultUnknown=Symbol("defaultUnknown");function updateIndexMap(target,arr,key){for(let i=0;i<arr.length;i+=1)target.has(arr[i])||target.set(key(arr[i]),i)}function mapBetweenArrByMapIndex(options){const{value,from,to,mapper,notFoundReturn}=options;let mappedIndex=mapper.get(value);if(void 0===mappedIndex){if(notFoundReturn!==defaultUnknown)return notFoundReturn;mappedIndex=from.push(value)-1,mapper.set(value,mappedIndex)}return to[mappedIndex%to.length]}function createKey(d){return d instanceof Date?d=>`${d}`:"object"==typeof d?d=>JSON.stringify(d):d=>d}class Ordinal extends Base{getDefaultOptions(){return{domain:[],range:[],unknown:defaultUnknown}}constructor(options){super(options)}map(x){return 0===this.domainIndexMap.size&&updateIndexMap(this.domainIndexMap,this.getDomain(),this.domainKey),mapBetweenArrByMapIndex({value:this.domainKey(x),mapper:this.domainIndexMap,from:this.getDomain(),to:this.getRange(),notFoundReturn:this.options.unknown})}invert(y){return 0===this.rangeIndexMap.size&&updateIndexMap(this.rangeIndexMap,this.getRange(),this.rangeKey),mapBetweenArrByMapIndex({value:this.rangeKey(y),mapper:this.rangeIndexMap,from:this.getRange(),to:this.getDomain(),notFoundReturn:this.options.unknown})}rescale(options){const[d]=this.options.domain,[r]=this.options.range;if(this.domainKey=createKey(d),this.rangeKey=createKey(r),!this.rangeIndexMap)return this.rangeIndexMap=new Map,void(this.domainIndexMap=new Map);options&&!options.range||this.rangeIndexMap.clear(),(!options||options.domain||options.compare)&&(this.domainIndexMap.clear(),this.sortedDomain=void 0)}clone(){return new Ordinal(this.options)}getRange(){return this.options.range}getDomain(){if(this.sortedDomain)return this.sortedDomain;const{domain,compare}=this.options;return this.sortedDomain=compare?[...domain].sort(compare):domain,this.sortedDomain}}function pretty(n){return Math.round(1e12*n)/1e12}function computeFlexBandState(options){const{domain,range,paddingOuter,paddingInner,flex:F,round,align}=options,n=domain.length,flex=function band_splice(array,n){const diff=n-array.length;return diff>0?[...array,...new Array(diff).fill(1)]:diff<0?array.slice(0,n):array}(F,n),[start,end]=range,width=end-start,stepSum=width/(2/n*paddingOuter+1-1/n*paddingInner),PI=stepSum*paddingInner/n,bandWidthSum=stepSum-n*PI,normalizedFlex=function band_normalize(array){const min=Math.min(...array);return array.map((d=>d/min))}(flex),minBandWidth=bandWidthSum/normalizedFlex.reduce(((sum,value)=>sum+value)),valueBandWidth=new InternMap(domain.map(((d,i)=>{const bandWidth=normalizedFlex[i]*minBandWidth;return[d,round?Math.floor(bandWidth):bandWidth]}))),valueStep=new InternMap(domain.map(((d,i)=>{const step=normalizedFlex[i]*minBandWidth+PI;return[d,round?Math.floor(step):step]}))),finalStepSum=Array.from(valueStep.values()).reduce(((sum,value)=>sum+value)),bandStart=start+(width-(finalStepSum-finalStepSum/n*paddingInner))*align;let prev=round?Math.round(bandStart):bandStart;const adjustedRange=new Array(n);for(let i=0;i<n;i+=1){adjustedRange[i]=pretty(prev);const value=domain[i];prev+=valueStep.get(value)}return{valueBandWidth,valueStep,adjustedRange}}class Band extends Ordinal{getDefaultOptions(){return{domain:[],range:[0,1],align:.5,round:!1,paddingInner:0,paddingOuter:0,padding:0,unknown:defaultUnknown,flex:[]}}constructor(options){super(options)}clone(){return new Band(this.options)}getStep(x){return void 0===this.valueStep?1:"number"==typeof this.valueStep?this.valueStep:void 0===x?Array.from(this.valueStep.values())[0]:this.valueStep.get(x)}getBandWidth(x){return void 0===this.valueBandWidth?1:"number"==typeof this.valueBandWidth?this.valueBandWidth:void 0===x?Array.from(this.valueBandWidth.values())[0]:this.valueBandWidth.get(x)}getRange(){return this.adjustedRange}getPaddingInner(){const{padding,paddingInner}=this.options;return padding>0?padding:paddingInner}getPaddingOuter(){const{padding,paddingOuter}=this.options;return padding>0?padding:paddingOuter}rescale(){super.rescale();const{align,domain,range,round,flex}=this.options,{adjustedRange,valueBandWidth,valueStep}=function computeBandState(options){var _a;const{domain}=options,n=domain.length;if(0===n)return{valueBandWidth:void 0,valueStep:void 0,adjustedRange:[]};if(null===(_a=options.flex)||void 0===_a?void 0:_a.length)return computeFlexBandState(options);const{range,paddingOuter,paddingInner,round,align}=options;let step,bandWidth,rangeStart=range[0];const deltaRange=range[1]-rangeStart,outerTotal=2*paddingOuter,innerTotal=n-paddingInner;step=deltaRange/Math.max(1,outerTotal+innerTotal),round&&(step=Math.floor(step)),rangeStart+=(deltaRange-step*(n-paddingInner))*align,bandWidth=step*(1-paddingInner),round&&(rangeStart=Math.round(rangeStart),bandWidth=Math.round(bandWidth));const adjustedRange=new Array(n).fill(0).map(((_,i)=>rangeStart+i*step));return{valueStep:step,valueBandWidth:bandWidth,adjustedRange}}({align,range,round,flex,paddingInner:this.getPaddingInner(),paddingOuter:this.getPaddingOuter(),domain});this.valueStep=valueStep,this.valueBandWidth=valueBandWidth,this.adjustedRange=adjustedRange}}var Columns=function(_super){function Columns(_a){var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,deep_mix({},{type:"column"},(0,tslib_es6.Cl)({style},rest)))||this).columnsGroup=new Group({name:"columns"}),_this.appendChild(_this.columnsGroup),_this.render(),_this}return(0,tslib_es6.C6)(Columns,_super),Columns.prototype.render=function(){var columns=this.attributes.columns;selection_select(this.columnsGroup).selectAll(".column").data(columns.flat()).join((function(enter){return enter.append("rect").attr("className","column").each((function(style){this.attr(style)}))}),(function(update){return update.each((function(style){this.attr(style)}))}),(function(exit){return exit.remove()}))},Columns.prototype.update=function(attr){this.attr(deepAssign({},this.attributes,attr)),this.render()},Columns.prototype.clear=function(){this.removeChildren()},Columns}(DisplayObject),Lines=function(_super){function Lines(_a){var _this=this,style=_a.style,rest=(0,tslib_es6.Tt)(_a,["style"]);return(_this=_super.call(this,deep_mix({},{type:"lines"},(0,tslib_es6.Cl)({style},rest)))||this).linesGroup=_this.appendChild(new Group),_this.areasGroup=_this.appendChild(new Group),_this.render(),_this}return(0,tslib_es6.C6)(Lines,_super),Lines.prototype.render=function(){var _a=this.attributes,lines=_a.lines,areas=_a.areas;lines&&this.renderLines(lines),areas&&this.renderAreas(areas)},Lines.prototype.clear=function(){this.linesGroup.removeChildren(),this.areasGroup.removeChildren()},Lines.prototype.update=function(attr){this.attr(deepAssign({},this.attributes,attr)),this.render()},Lines.prototype.renderLines=function(lines){selection_select(this.linesGroup).selectAll(".line").data(lines).join((function(enter){return enter.append("path").attr("className","line").each((function(style){this.attr(style)}))}),(function(update){return update.each((function(style){this.attr(style)}))}),(function(exit){return exit.remove()}))},Lines.prototype.renderAreas=function(areas){selection_select(this.linesGroup).selectAll(".area").data(areas).join((function(enter){return enter.append("path").attr("className","area").each((function(style){this.attr(style)}))}),(function(update){return update.each((function(style){this.style(style)}))}),(function(exit){return exit.remove()}))},Lines}(DisplayObject);function catmullRom2Bezier(crp,z,constraint){void 0===z&&(z=!1),void 0===constraint&&(constraint=[[0,0],[1,1]]);for(var isLoop=!!z,pointList=[],i=0,l=crp.length;i<l;i+=2)pointList.push([crp[i],crp[i+1]]);var cp1,cp2,p,controlPointList=function smoothBezier(points,smooth,isLoop,constraint){var _a,prevPoint,nextPoint,nextCp0,cp1,cp0,cps=[],hasConstraint=!!constraint,min=[1/0,1/0],max=[-1/0,-1/0];if(hasConstraint){min=(_a=(0,tslib_es6.zs)(constraint,2))[0],max=_a[1];for(var i=0,l=points.length;i<l;i+=1)min=matrix_min(min,point=points[i]),max=matrix_max(max,point)}i=0;for(var len=points.length;i<len;i+=1){var point=points[i];if(0!==i||isLoop)if(i!==len-1||isLoop){prevPoint=points[[i?i-1:len-1,i-1][isLoop?0:1]];var v=[0,0];v=matrix_scale(v=matrix_sub(nextPoint=points[isLoop?(i+1)%len:i+1],prevPoint),smooth);var d0=matrix_distance(point,prevPoint),d1=matrix_distance(point,nextPoint),sum=d0+d1;0!==sum&&(d0/=sum,d1/=sum);var v1=matrix_scale(v,-d0),v2=matrix_scale(v,d1);cp1=matrix_add(point,v1),nextCp0=matrix_min(nextCp0=matrix_add(point,v2),matrix_max(nextPoint,point)),nextCp0=matrix_max(nextCp0,matrix_min(nextPoint,point)),cp1=matrix_min(cp1=matrix_add(point,v1=matrix_scale(v1=matrix_sub(nextCp0,point),-d0/d1)),matrix_max(prevPoint,point)),nextCp0=matrix_add(point,v2=matrix_scale(v2=matrix_sub(point,cp1=matrix_max(cp1,matrix_min(prevPoint,point))),d1/d0)),hasConstraint&&(cp1=matrix_min(cp1=matrix_max(cp1,min),max),nextCp0=matrix_min(nextCp0=matrix_max(nextCp0,min),max)),cps.push(cp0),cps.push(cp1),cp0=nextCp0}else cp1=point,cps.push(cp0),cps.push(cp1);else cp0=point}return isLoop&&cps.push(cps.shift()),cps}(pointList,.4,isLoop,constraint),len=pointList.length,d1=[];for(i=0;i<len-1;i+=1)cp1=controlPointList[2*i],cp2=controlPointList[2*i+1],p=pointList[i+1],d1.push(["C",cp1[0],cp1[1],cp2[0],cp2[1],p[0],p[1]]);return isLoop&&(cp1=controlPointList[len],cp2=controlPointList[len+1],p=(0,tslib_es6.zs)(pointList,1)[0],d1.push(["C",cp1[0],cp1[1],cp2[0],cp2[1],p[0],p[1]])),d1}function lineToLinePath(line,reverse){void 0===reverse&&(reverse=!1);var M=reverse?line.length-1:0,linePath=line.map((function(point,idx){return(0,tslib_es6.fX)([idx===M?"M":"L"],(0,tslib_es6.zs)(point),!1)}));return reverse?linePath.reverse():linePath}function lineToCurvePath(line,reverse){if(void 0===reverse&&(reverse=!1),line.length<=2)return lineToLinePath(line);for(var data=[],len=line.length,idx=0;idx<len;idx+=1){var point=reverse?line[len-idx-1]:line[idx];is_equal(point,data.slice(-2))||data.push.apply(data,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(point),!1))}var path=catmullRom2Bezier(data,!1);return reverse?path.unshift((0,tslib_es6.fX)(["M"],(0,tslib_es6.zs)(line[len-1]),!1)):path.unshift((0,tslib_es6.fX)(["M"],(0,tslib_es6.zs)(line[0]),!1)),path}function closePathByBaseLine(path,width,baseline){var closedPath=(0,lodash_clone.A)(path);return closedPath.push(["L",width,baseline],["L",0,baseline],["Z"]),closedPath}const lodash_min_by=function(arr,fn){if((0,is_array.A)(arr)){for(var minItem,min=1/0,i=0;i<arr.length;i++){var item=arr[i],v=(0,is_function.A)(fn)?fn(item):item[fn];v<min&&(minItem=item,min=v)}return minItem}},lodash_max_by=function(arr,fn){if((0,is_array.A)(arr)){for(var maxItem,max=-1/0,i=0;i<arr.length;i++){var item=arr[i],v=(0,is_function.A)(fn)?fn(item):item[fn];v>max&&(maxItem=item,max=v)}return maxItem}};function utils_getRange(data){return 0===data.length?[0,0]:[lodash_min(lodash_min_by(data,(function(arr){return lodash_min(arr)||0}))),lodash_max(lodash_max_by(data,(function(arr){return lodash_max(arr)||0})))]}function getStackedData(_){for(var data=(0,lodash_clone.A)(_),datumLen=data[0].length,_a=(0,tslib_es6.zs)([Array(datumLen).fill(0),Array(datumLen).fill(0)],2),positivePrev=_a[0],negativePrev=_a[1],i=0;i<data.length;i+=1)for(var datum=data[i],j=0;j<datumLen;j+=1)datum[j]>=0?(datum[j]+=positivePrev[j],positivePrev[j]=datum[j]):(datum[j]+=negativePrev[j],negativePrev[j]=datum[j]);return data}var Sparkline=function(_super){function Sparkline(options){return _super.call(this,options,{type:"line",width:200,height:20,isStack:!1,color:["#83daad","#edbf45","#d2cef9","#e290b3","#6f63f4"],smooth:!0,lineLineWidth:1,areaOpacity:0,isGroup:!1,columnLineWidth:1,columnStroke:"#fff",scale:1,spacing:0})||this}return(0,tslib_es6.C6)(Sparkline,_super),Object.defineProperty(Sparkline.prototype,"rawData",{get:function(){var rawData=this.attributes.data;if(!rawData||0===(null==rawData?void 0:rawData.length))return[[]];var data=(0,lodash_clone.A)(rawData);return(0,is_number.A)(data[0])?[data]:data},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"data",{get:function(){return this.attributes.isStack?getStackedData(this.rawData):this.rawData},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"scales",{get:function(){return this.createScales(this.data)},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"baseline",{get:function(){var y=this.scales.y,_a=(0,tslib_es6.zs)(y.getOptions().domain||[0,0],2),y1=_a[0],y2=_a[1];return y2<0?y.map(y2):y.map(y1<0?0:y1)},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"containerShape",{get:function(){var _a=this.attributes;return{width:_a.width,height:_a.height}},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"linesStyle",{get:function(){var _this=this,_a=this.attributes,type=_a.type,isStack=_a.isStack,smooth=_a.smooth;if("line"!==type)throw new Error("linesStyle can only be used in line type");var areaStyle=subStyleProps(this.attributes,"area"),lineStyle=subStyleProps(this.attributes,"line"),width=this.containerShape.width,data=this.data;if(0===data[0].length)return{lines:[],areas:[]};var _b=this.scales,lines=function dataToLines(data,scales){var _a,x=scales.x,y=scales.y,_b=(0,tslib_es6.zs)(y.getOptions().range||[0,0],2),max=_b[0],min=_b[1];return min>max&&(_a=(0,tslib_es6.zs)([max,min],2),min=_a[0],max=_a[1]),data.map((function(points){return points.map((function(val,idx){return[x.map(idx),lodash_clamp(y.map(val),min,max)]}))}))}(data,{type:"line",x:_b.x,y:_b.y}),areas=[];if(areaStyle){var baseline=this.baseline;areas=isStack?smooth?function linesToStackCurveAreaPaths(lines,width,baseline){for(var paths=[],idx=lines.length-1;idx>=0;idx-=1){var currLine=lines[idx],currCurvePath=lineToCurvePath(currLine),path=void 0;if(0===idx)path=closePathByBaseLine(currCurvePath,width,baseline);else{var belowCurvePath=lineToCurvePath(lines[idx-1],!0),A=currLine[0];belowCurvePath[0][0]="L",path=(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(currCurvePath),!1),(0,tslib_es6.zs)(belowCurvePath),!1),[(0,tslib_es6.fX)(["M"],(0,tslib_es6.zs)(A),!1),["Z"]],!1)}paths.push(path)}return paths}(lines,width,baseline):function linesToStackAreaPaths(lines,width,baseline){for(var paths=[],idx=lines.length-1;idx>=0;idx-=1){var currCurvePath=lineToLinePath(lines[idx]),path=void 0;if(0===idx)path=closePathByBaseLine(currCurvePath,width,baseline);else{var belowCurvePath=lineToLinePath(lines[idx-1],!0);belowCurvePath[0][0]="L",path=(0,tslib_es6.fX)((0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(currCurvePath),!1),(0,tslib_es6.zs)(belowCurvePath),!1),[["Z"]],!1)}paths.push(path)}return paths}(lines,width,baseline):function linesToAreaPaths(lines,smooth,width,baseline){return lines.map((function(line){return closePathByBaseLine(smooth?lineToCurvePath(line):lineToLinePath(line),width,baseline)}))}(lines,smooth,width,baseline)}return{lines:lines.map((function(line,idx){return(0,tslib_es6.Cl)({stroke:_this.getColor(idx),path:smooth?lineToCurvePath(line):lineToLinePath(line)},lineStyle)})),areas:areas.map((function(path,idx){return(0,tslib_es6.Cl)({path,fill:_this.getColor(idx)},areaStyle)}))}},enumerable:!1,configurable:!0}),Object.defineProperty(Sparkline.prototype,"columnsStyle",{get:function(){var _this=this,columnStyle=subStyleProps(this.attributes,"column"),_a=this.attributes,isStack=_a.isStack,type=_a.type,scale=_a.scale;if("column"!==type)throw new Error("columnsStyle can only be used in column type");var height=this.containerShape.height,data=this.rawData;if(!data)return{columns:[]};isStack&&(data=getStackedData(data));var _b=this.createScales(data),x=_b.x,y=_b.y,_c=(0,tslib_es6.zs)(utils_getRange(data),2),minVal=_c[0],maxVal=_c[1],heightScale=new Linear({domain:[0,maxVal-(minVal>0?0:minVal)],range:[0,height*scale]}),bandWidth=x.getBandWidth(),rawData=this.rawData;return{columns:data.map((function(column,i){return column.map((function(val,j){var barWidth=bandWidth/data.length;return(0,tslib_es6.Cl)((0,tslib_es6.Cl)({fill:_this.getColor(i)},columnStyle),isStack?{x:x.map(j),y:y.map(val),width:bandWidth,height:heightScale.map(rawData[i][j])}:{x:x.map(j)+barWidth*i,y:val>=0?y.map(val):y.map(0),width:barWidth,height:heightScale.map(Math.abs(val))})}))}))}},enumerable:!1,configurable:!0}),Sparkline.prototype.render=function(attributes,container){(function maybeAppend(parent,selector,node){return parent.querySelector(selector)?selection_select(parent).select(selector):selection_select(parent).append(node)})(container,".container","rect").attr("className","container").node();var type=attributes.type,className="spark".concat(type),style="line"===type?this.linesStyle:this.columnsStyle;selection_select(container).selectAll(".spark").data([type]).join((function(enter){return enter.append((function(type){return"line"===type?new Lines({className,style}):new Columns({className,style})})).attr("className","spark ".concat(className))}),(function(update){return update.update(style)}),(function(exit){return exit.remove()}))},Sparkline.prototype.getColor=function(index){var color=this.attributes.color;return(0,is_array.A)(color)?color[index%color.length]:(0,is_function.A)(color)?color.call(null,index):color},Sparkline.prototype.createScales=function(data){var _a,_b,_c=this.attributes,type=_c.type,scale=_c.scale,_d=_c.range,range=void 0===_d?[]:_d,spacing=_c.spacing,_e=this.containerShape,width=_e.width,height=_e.height,_f=(0,tslib_es6.zs)(utils_getRange(data),2),minVal=_f[0],maxVal=_f[1],yScale=new Linear({domain:[null!==(_a=range[0])&&void 0!==_a?_a:minVal,null!==(_b=range[1])&&void 0!==_b?_b:maxVal],range:[height,height*(1-scale)]});return"line"===type?{type,x:new Linear({domain:[0,data[0].length-1],range:[0,width]}),y:yScale}:{type,x:new Band({domain:data[0].map((function(val,idx){return idx})),range:[0,width],paddingInner:spacing,paddingOuter:spacing/2,align:.5}),y:yScale}},Sparkline.tag="sparkline",Sparkline}(GUI),HANDLE_ICON_DEFAULT_CFG={fill:"#fff",lineWidth:1,radius:2,size:10,stroke:"#bfbfbf",strokeOpacity:1,zIndex:0},HANDLE_LABEL_DEFAULT_CFG={fill:"#000",fillOpacity:.45,fontSize:12,textAlign:"center",textBaseline:"middle",zIndex:1},HANDLE_DEFAULT_CFG={orientation:"horizontal",showLabel:!0,type:"start"},slider_constant_CLASS_NAMES=classNames({foreground:"foreground",handle:"handle",selection:"selection",sparkline:"sparkline",sparklineGroup:"sparkline-group",track:"track",brushArea:"brush-area"},"slider"),slider_handle_CLASS_NAMES=classNames({labelGroup:"label-group",label:"label",iconGroup:"icon-group",icon:"icon",iconRect:"icon-rect",iconLine:"icon-line"},"handle"),HandleIcon=function(_super){function HandleIcon(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(HandleIcon,_super),HandleIcon.prototype.render=function(attributes,container){var _a=attributes.size,size=void 0===_a?10:_a,_b=attributes.radius,radius=void 0===_b?size/4:_b,orientation=attributes.orientation,iconStyle=(0,tslib_es6.Tt)(attributes,["size","radius","orientation"]),width=size,height=2.4*width,rect=selection_select(container).maybeAppendByClassName(slider_handle_CLASS_NAMES.iconRect,"rect").styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},iconStyle),{width,height,radius,x:-width/2,y:-height/2})),x1=1/3*width,x2=2/3*width,y1=1/4*height,y2=3/4*height;rect.maybeAppendByClassName("".concat(slider_handle_CLASS_NAMES.iconLine,"-1"),"line").styles((0,tslib_es6.Cl)({x1,x2:x1,y1,y2},iconStyle)),rect.maybeAppendByClassName("".concat(slider_handle_CLASS_NAMES.iconLine,"-2"),"line").styles((0,tslib_es6.Cl)({x1:x2,x2,y1,y2},iconStyle)),rect.node().setOrigin(width/2,height/2),"vertical"===orientation?container.setLocalEulerAngles(90):container.setLocalEulerAngles(0)},HandleIcon}(GUI),handle_Handle=function(_super){function Handle(options){return _super.call(this,options,HANDLE_DEFAULT_CFG)||this}return(0,tslib_es6.C6)(Handle,_super),Handle.prototype.renderLabel=function(container){var _this=this,showLabel=this.attributes.showLabel,_a=subStyleProps(this.attributes,"label"),transform=_a.transform,style=(0,tslib_es6.Tt)(_a,["transform"]),_b=(0,tslib_es6.zs)(splitStyle(style,[]),2),labelStyle=_b[0],groupStyle=_b[1],labelGroup=selection_select(container).maybeAppendByClassName(slider_handle_CLASS_NAMES.labelGroup,"g").styles(groupStyle),_c=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},HANDLE_LABEL_DEFAULT_CFG),labelStyle),text=_c.text,rest=(0,tslib_es6.Tt)(_c,["text"]);ifShow(!!showLabel,labelGroup,(function(group){_this.label=group.maybeAppendByClassName(slider_handle_CLASS_NAMES.label,"text").styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},rest),{transform,text:"".concat(text)})),_this.label.on("mousedown",(function(e){e.stopPropagation()})),_this.label.on("touchstart",(function(e){e.stopPropagation()}))}))},Handle.prototype.renderIcon=function(container){var _a=this.attributes,orientation=_a.orientation,type=_a.type,iconStyle=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({orientation},HANDLE_ICON_DEFAULT_CFG),subStyleProps(this.attributes,"icon")),_b=this.attributes.iconShape,iconShape=void 0===_b?function(){return new HandleIcon({style:iconStyle})}:_b;selection_select(container).maybeAppendByClassName(slider_handle_CLASS_NAMES.iconGroup,"g").selectAll(slider_handle_CLASS_NAMES.icon.class).data([iconShape]).join((function(enter){return enter.append("string"==typeof iconShape?iconShape:function(){return iconShape(type)}).attr("className",slider_handle_CLASS_NAMES.icon.name)}),(function(update){return update.update(iconStyle)}),(function(exit){return exit.remove()}))},Handle.prototype.render=function(attributes,container){this.renderIcon(container),this.renderLabel(container)},Handle}(GUI),Slider=function(_super){function Slider(options){var _this=_super.call(this,options,(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({animate:{duration:100,fill:"both"},brushable:!0,formatter:function(val){return val.toString()},handleSpacing:2,orientation:"horizontal",padding:0,autoFitLabel:!0,scrollable:!0,selectionFill:"#5B8FF9",selectionFillOpacity:.45,selectionZIndex:2,showHandle:!0,showLabel:!0,slidable:!0,trackFill:"#416180",trackLength:200,trackOpacity:.05,trackSize:20,trackZIndex:-1,values:[0,1],type:"range",selectionType:"select",handleIconOffset:0},superStyleProps(HANDLE_DEFAULT_CFG,"handle")),superStyleProps(HANDLE_ICON_DEFAULT_CFG,"handleIcon")),superStyleProps(HANDLE_LABEL_DEFAULT_CFG,"handleLabel")))||this;return _this.range=[0,1],_this.onDragStart=function(target){return function(e){e.stopPropagation(),_this.target=target,_this.prevPos=_this.getOrientVal(getEventPos(e));var _a=_this.availableSpace,x=_a.x,y=_a.y,_b=_this.getBBox(),X=_b.x,Y=_b.y;_this.selectionStartPos=_this.getRatio(_this.prevPos-_this.getOrientVal([x,y])-_this.getOrientVal([+X,+Y])),_this.selectionWidth=0,document.addEventListener("pointermove",_this.onDragging),document.addEventListener("pointerup",_this.onDragEnd)}},_this.onDragging=function(e){var _a=_this.attributes,slidable=_a.slidable,brushable=_a.brushable,type=_a.type;e.stopPropagation();var currPos=_this.getOrientVal(getEventPos(e)),diffPos=currPos-_this.prevPos;if(diffPos){var deltaVal=_this.getRatio(diffPos);switch(_this.target){case"start":slidable&&_this.setValuesOffset(deltaVal);break;case"end":slidable&&_this.setValuesOffset(0,deltaVal);break;case"selection":slidable&&_this.setValuesOffset(deltaVal,deltaVal);break;case"track":if(!brushable)return;_this.selectionWidth+=deltaVal,"range"===type?_this.innerSetValues([_this.selectionStartPos,_this.selectionStartPos+_this.selectionWidth].sort(),!0):_this.innerSetValues([0,_this.selectionStartPos+_this.selectionWidth],!0)}_this.prevPos=currPos}},_this.onDragEnd=function(){document.removeEventListener("pointermove",_this.onDragging),document.removeEventListener("pointermove",_this.onDragging),document.removeEventListener("pointerup",_this.onDragEnd),_this.target="",_this.updateHandlesPosition(!1)},_this.onValueChange=function(oldValue){var _a=_this.attributes,onChange=_a.onChange,type=_a.type,internalOldValue="range"===type?oldValue:oldValue[1],value="range"===type?_this.getValues():_this.getValues()[1],evt=new CustomEvent("valuechange",{detail:{oldValue:internalOldValue,value}});_this.dispatchEvent(evt),null==onChange||onChange(value)},_this.selectionStartPos=0,_this.selectionWidth=0,_this.prevPos=0,_this.target="",_this}return(0,tslib_es6.C6)(Slider,_super),Object.defineProperty(Slider.prototype,"values",{get:function(){return this.attributes.values},set:function(values){this.attributes.values=this.clampValues(values)},enumerable:!1,configurable:!0}),Object.defineProperty(Slider.prototype,"sparklineStyle",{get:function(){if("horizontal"!==this.attributes.orientation)return null;var attr=subStyleProps(this.attributes,"sparkline");return(0,tslib_es6.Cl)((0,tslib_es6.Cl)({zIndex:0},this.availableSpace),attr)},enumerable:!1,configurable:!0}),Object.defineProperty(Slider.prototype,"shape",{get:function(){var _a=this.attributes,trackLength=_a.trackLength,trackSize=_a.trackSize,_b=(0,tslib_es6.zs)(this.getOrientVal([[trackLength,trackSize],[trackSize,trackLength]]),2);return{width:_b[0],height:_b[1]}},enumerable:!1,configurable:!0}),Object.defineProperty(Slider.prototype,"availableSpace",{get:function(){var padding=this.attributes.padding,_a=(0,tslib_es6.zs)(parseSeriesAttr(padding),4),top=_a[0],right=_a[1],bottom=_a[2],left=_a[3],_b=this.shape;return{x:left,y:top,width:_b.width-(left+right),height:_b.height-(top+bottom)}},enumerable:!1,configurable:!0}),Slider.prototype.getValues=function(){return this.values},Slider.prototype.setValues=function(values,animate){void 0===values&&(values=[0,0]),void 0===animate&&(animate=!1),this.attributes.values=values;var animation=!1!==animate&&this.attributes.animate;this.updateSelectionArea(animation),this.updateHandlesPosition(animation)},Slider.prototype.updateSelectionArea=function(animation){var newSelectionArea=this.calcSelectionArea();this.foregroundGroup.selectAll(slider_constant_CLASS_NAMES.selection.class).each((function(datum,index){transition(this,newSelectionArea[index],animation)}))},Slider.prototype.updateHandlesPosition=function(animation){this.attributes.showHandle&&(this.startHandle&&transition(this.startHandle,this.getHandleStyle("start"),animation),this.endHandle&&transition(this.endHandle,this.getHandleStyle("end"),animation))},Slider.prototype.innerSetValues=function(values,trigger){void 0===values&&(values=[0,0]),void 0===trigger&&(trigger=!1);var oldValues=this.values,newValues=this.clampValues(values);this.attributes.values=newValues,this.setValues(newValues),trigger&&this.onValueChange(oldValues)},Slider.prototype.renderTrack=function(container){var style=subStyleProps(this.attributes,"track");this.trackShape=selection_select(container).maybeAppendByClassName(slider_constant_CLASS_NAMES.track,"rect").styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.shape),style))},Slider.prototype.renderBrushArea=function(container){var brushable=this.attributes.brushable;this.brushArea=selection_select(container).maybeAppendByClassName(slider_constant_CLASS_NAMES.brushArea,"rect").styles((0,tslib_es6.Cl)({fill:"transparent",cursor:brushable?"crosshair":"default"},this.shape))},Slider.prototype.renderSparkline=function(container){var _this=this;ifShow("horizontal"===this.attributes.orientation,selection_select(container).maybeAppendByClassName(slider_constant_CLASS_NAMES.sparklineGroup,"g"),(function(group){var style=_this.sparklineStyle;group.maybeAppendByClassName(slider_constant_CLASS_NAMES.sparkline,(function(){return new Sparkline({style})})).update(style)}))},Slider.prototype.renderHandles=function(){var _a,_this=this,_b=this.attributes,showHandle=_b.showHandle,type=_b.type,data=showHandle?"range"===type?["start","end"]:["end"]:[],that=this;null===(_a=this.foregroundGroup)||void 0===_a||_a.selectAll(slider_constant_CLASS_NAMES.handle.class).data(data.map((function(type){return{type}})),(function(d){return d.type})).join((function(enter){return enter.append((function(_a){var type=_a.type;return new handle_Handle({style:_this.getHandleStyle(type)})})).each((function(_a){var type=_a.type;this.attr("class","".concat(slider_constant_CLASS_NAMES.handle.name," ").concat(type,"-handle"));var name="".concat(type,"Handle");that[name]=this,this.addEventListener("pointerdown",that.onDragStart(type))}))}),(function(update){return update.each((function(_a){var type=_a.type;this.update(that.getHandleStyle(type))}))}),(function(exit){return exit.each((function(_a){var type=_a.type,name="".concat(type,"Handle");that[name]=void 0})).remove()}))},Slider.prototype.renderSelection=function(container){var _a=this.attributes,type=_a.type,selectionType=_a.selectionType;this.foregroundGroup=selection_select(container).maybeAppendByClassName(slider_constant_CLASS_NAMES.foreground,"g");var selectionStyle=subStyleProps(this.attributes,"selection"),applyStyle=function(selection){return selection.style("visibility",(function(d){return d.show?"visible":"hidden"})).style("cursor",(function(d){return"select"===selectionType?"grab":"invert"===selectionType?"crosshair":"default"})).styles(selectionStyle)},that=this;this.foregroundGroup.selectAll(slider_constant_CLASS_NAMES.selection.class).data("value"===type?[]:this.calcSelectionArea().map((function(area,index){return{style:(0,tslib_es6.Cl)({},area),index,show:"select"===selectionType?1===index:1!==index}})),(function(d){return d.index})).join((function(enter){return enter.append("rect").attr("className",slider_constant_CLASS_NAMES.selection.name).call(applyStyle).each((function(datum,index){var _this=this;1===index?(that.selectionShape=selection_select(this),this.on("pointerdown",(function(e){_this.attr("cursor","grabbing"),that.onDragStart("selection")(e)})),that.dispatchCustomEvent(this,"pointerenter","selectionMouseenter"),that.dispatchCustomEvent(this,"pointerleave","selectionMouseleave"),that.dispatchCustomEvent(this,"click","selectionClick"),this.addEventListener("pointerdown",(function(){_this.attr("cursor","grabbing")})),this.addEventListener("pointerup",(function(){_this.attr("cursor","grab")}))):this.on("pointerdown",that.onDragStart("track"))}))}),(function(update){return update.call(applyStyle)}),(function(exit){return exit.remove()})),this.updateSelectionArea(!1),this.renderHandles()},Slider.prototype.render=function(attributes,container){this.renderTrack(container),this.renderSparkline(container),this.renderBrushArea(container),this.renderSelection(container)},Slider.prototype.clampValues=function(values,precision){var _a;void 0===precision&&(precision=4);var _b=(0,tslib_es6.zs)(this.range,2),min=_b[0],max=_b[1],_c=(0,tslib_es6.zs)(this.getValues().map((function(num){return toPrecision(num,precision)})),2),prevStart=_c[0],prevEnd=_c[1],internalValues=Array.isArray(values)?values:[prevStart,null!=values?values:prevEnd],_d=(0,tslib_es6.zs)((internalValues||[prevStart,prevEnd]).map((function(num){return toPrecision(num,precision)})),2),startVal=_d[0],endVal=_d[1];if("value"===this.attributes.type)return[0,lodash_clamp(endVal,min,max)];startVal>endVal&&(startVal=(_a=(0,tslib_es6.zs)([endVal,startVal],2))[0],endVal=_a[1]);var range=endVal-startVal;return range>max-min?[min,max]:startVal<min?prevStart===min&&prevEnd===endVal?[min,endVal]:[min,range+min]:endVal>max?prevEnd===max&&prevStart===startVal?[startVal,max]:[max-range,max]:[startVal,endVal]},Slider.prototype.calcSelectionArea=function(values){var _a=(0,tslib_es6.zs)(this.clampValues(values),2),start=_a[0],end=_a[1],_b=this.availableSpace,x=_b.x,y=_b.y,width=_b.width,height=_b.height;return this.getOrientVal([[{y,height,x,width:start*width},{y,height,x:start*width+x,width:(end-start)*width},{y,height,x:end*width,width:(1-end)*width}],[{x,width,y,height:start*height},{x,width,y:start*height+y,height:(end-start)*height},{x,width,y:end*height,height:(1-end)*height}]])},Slider.prototype.calcHandlePosition=function(handleType){var handleIconOffset=this.attributes.handleIconOffset,_a=this.availableSpace,x=_a.x,y=_a.y,width=_a.width,height=_a.height,_b=(0,tslib_es6.zs)(this.clampValues(),2),stVal=_b[0],endVal=_b[1],offset="start"===handleType?-handleIconOffset:handleIconOffset,L=("start"===handleType?stVal:endVal)*this.getOrientVal([width,height])+offset;return{x:x+this.getOrientVal([L,width/2]),y:y+this.getOrientVal([height/2,L])}},Slider.prototype.inferTextStyle=function(handleType){return"horizontal"===this.attributes.orientation?{}:"start"===handleType?{transform:"rotate(90)",textAlign:"start"}:"end"===handleType?{transform:"rotate(90)",textAlign:"end"}:{}},Slider.prototype.calcHandleText=function(handleType){var _a,_b=this.attributes,type=_b.type,orientation=_b.orientation,formatter=_b.formatter,autoFitLabel=_b.autoFitLabel,handleStyle=subStyleProps(this.attributes,"handle"),labelStyle=subStyleProps(handleStyle,"label"),spacing=handleStyle.spacing,size=this.getHandleSize(),values=this.clampValues(),text=formatter("start"===handleType?values[0]:values[1]),temp=new Text_Text({style:(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},labelStyle),this.inferTextStyle(handleType)),{text})}),_c=temp.getBBox(),textWidth=_c.width,textHeight=_c.height;if(temp.destroy(),!autoFitLabel){if("value"===type)return{text,x:0,y:-textHeight-spacing};var finaleWidth=spacing+size+("horizontal"===orientation?textWidth/2:0);return(_a={text})["horizontal"===orientation?"x":"y"]="start"===handleType?-finaleWidth:finaleWidth,_a}var x=0,y=0,_d=this.availableSpace,iW=_d.width,iH=_d.height,_e=this.calcSelectionArea()[1],fX=_e.x,fY=_e.y,fW=_e.width,fH=_e.height,totalSpacing=spacing+size;if("horizontal"===orientation){var finalWidth=totalSpacing+textWidth/2;if("start"===handleType)x=fX-totalSpacing-textWidth>0?-finalWidth:finalWidth;else x=iW-fX-fW-totalSpacing>textWidth?finalWidth:-finalWidth}else{var negativeSize=textHeight+totalSpacing;y="start"===handleType?fY-size>textHeight?-negativeSize:totalSpacing:iH-(fY+fH)-size>textHeight?negativeSize:-totalSpacing}return{x,y,text}},Slider.prototype.getHandleLabelStyle=function(handleType){var style=subStyleProps(this.attributes,"handleLabel");return(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},style),this.calcHandleText(handleType)),this.inferTextStyle(handleType))},Slider.prototype.getHandleIconStyle=function(){var shape=this.attributes.handleIconShape,style=subStyleProps(this.attributes,"handleIcon"),cursor=this.getOrientVal(["ew-resize","ns-resize"]),size=this.getHandleSize();return(0,tslib_es6.Cl)({cursor,shape,size},style)},Slider.prototype.getHandleStyle=function(handleType){var _a=this.attributes,showLabel=_a.showLabel,showLabelOnInteraction=_a.showLabelOnInteraction,orientation=_a.orientation,handlePosition=this.calcHandlePosition(handleType),textStyle=this.calcHandleText(handleType),internalShowLabel=showLabel;return!showLabel&&showLabelOnInteraction&&(internalShowLabel=!!this.target),(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},superStyleProps(this.getHandleIconStyle(),"icon")),superStyleProps((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},this.getHandleLabelStyle(handleType)),textStyle),"label")),handlePosition),{orientation,showLabel:internalShowLabel,type:handleType,zIndex:3})},Slider.prototype.getHandleSize=function(){var _a=this.attributes,size=_a.handleIconSize,width=_a.width,height=_a.height;return size||Math.floor((this.getOrientVal([+height,+width])+4)/2.4)},Slider.prototype.getOrientVal=function(_a){var _b=(0,tslib_es6.zs)(_a,2),x=_b[0],y=_b[1];return"horizontal"===this.attributes.orientation?x:y},Slider.prototype.setValuesOffset=function(stOffset,endOffset,animate){void 0===endOffset&&(endOffset=0),void 0===animate&&(animate=!1);var type=this.attributes.type,_a=(0,tslib_es6.zs)(this.getValues(),2),values=[_a[0]+("range"===type?stOffset:0),_a[1]+endOffset].sort();animate?this.setValues(values):this.innerSetValues(values,!0)},Slider.prototype.getRatio=function(val){var _a=this.availableSpace,width=_a.width,height=_a.height;return val/this.getOrientVal([width,height])},Slider.prototype.dispatchCustomEvent=function(target,event,name){var _this=this;target.on(event,(function(e){e.stopPropagation(),_this.dispatchEvent(new CustomEvent(name,{detail:e}))}))},Slider.prototype.bindEvents=function(){this.addEventListener("wheel",this.onScroll);var brushArea=this.brushArea;this.dispatchCustomEvent(brushArea,"click","trackClick"),this.dispatchCustomEvent(brushArea,"pointerenter","trackMouseenter"),this.dispatchCustomEvent(brushArea,"pointerleave","trackMouseleave"),brushArea.on("pointerdown",this.onDragStart("track"))},Slider.prototype.onScroll=function(event){if(this.attributes.scrollable){var deltaX=event.deltaX,offset=event.deltaY||deltaX,deltaVal=this.getRatio(offset);this.setValuesOffset(deltaVal,deltaVal,!0)}},Slider.tag="slider",Slider}(GUI);const lodash_reduce=function(arr,fn,init){if(!(0,is_array.A)(arr)&&!is_plain_object(arr))return arr;var result=init;return lodash_each(arr,(function(data,i){result=fn(result,data,i)})),result};var DEFAULT_INDICATOR_STYLE_PROPS={backgroundFill:"#262626",backgroundLineCap:"round",backgroundLineWidth:1,backgroundStroke:"#333",backgroundZIndex:-1,formatter:function(val){return val.toString()},labelFill:"#fff",labelFontSize:12,labelTextBaseline:"middle",padding:[2,4],position:"right",radius:0,zIndex:999},indicator_CLASS_NAMES=classNames({background:"background",labelGroup:"label-group",label:"label"},"indicator"),Indicator=function(_super){function Indicator(options){var _this=_super.call(this,options,DEFAULT_INDICATOR_STYLE_PROPS)||this;return _this.point=[0,0],_this.group=_this.appendChild(new Group({})),_this.isMutationObserved=!0,_this}return(0,tslib_es6.C6)(Indicator,_super),Indicator.prototype.renderBackground=function(){if(this.label){var _a=this.attributes,position=_a.position,padding=_a.padding,_b=(0,tslib_es6.zs)(parseSeriesAttr(padding),4),t=_b[0],r=_b[1],b=_b[2],l=_b[3],_c=this.label.node().getLocalBounds(),min=_c.min,max=_c.max,bbox=new BBox(min[0]-l,min[1]-t,max[0]+r-min[0]+l,max[1]+b-min[1]+t),path=this.getPath(position,bbox),style=subStyleProps(this.attributes,"background");this.background=selection_select(this.group).maybeAppendByClassName(indicator_CLASS_NAMES.background,"path").styles((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},style),{path})),this.group.appendChild(this.label.node())}},Indicator.prototype.renderLabel=function(){var _a=this.attributes,formatter=_a.formatter,labelText=_a.labelText,style=subStyleProps(this.attributes,"label"),_b=(0,tslib_es6.zs)(splitStyle(style),2),_c=_b[0],groupStyle=_b[1],textStyle=(_c.text,(0,tslib_es6.Tt)(_c,["text"]));(this.label=selection_select(this.group).maybeAppendByClassName(indicator_CLASS_NAMES.labelGroup,"g").styles(groupStyle),labelText)&&this.label.maybeAppendByClassName(indicator_CLASS_NAMES.label,(function(){return renderExtDo(formatter(labelText))})).style("text",formatter(labelText).toString()).selectAll("text").styles(textStyle)},Indicator.prototype.adjustLayout=function(){var _a=(0,tslib_es6.zs)(this.point,2),dx=_a[0],dy=_a[1];this.group.attr("x",-dx).attr("y",-dy)},Indicator.prototype.getPath=function(position,bbox){var r=this.attributes.radius,x=bbox.x,y=bbox.y,width=bbox.width,height=bbox.height,pathArray=[["M",x+r,y],["L",x+width-r,y],["A",r,r,0,0,1,x+width,y+r],["L",x+width,y+height-r],["A",r,r,0,0,1,x+width-r,y+height],["L",x+r,y+height],["A",r,r,0,0,1,x,y+height-r],["L",x,y+r],["A",r,r,0,0,1,x+r,y],["Z"]],index={top:4,right:6,bottom:0,left:2}[position],newPath=this.createCorner([pathArray[index].slice(-2),pathArray[index+1].slice(-2)]);return pathArray.splice.apply(pathArray,(0,tslib_es6.fX)([index+1,1],(0,tslib_es6.zs)(newPath),!1)),pathArray[0][0]="M",pathArray},Indicator.prototype.createCorner=function(edge,size){void 0===size&&(size=10);var isH=isHorizontal.apply(void 0,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(edge),!1)),_a=(0,tslib_es6.zs)(edge,2),_b=(0,tslib_es6.zs)(_a[0],2),x0=_b[0],y0=_b[1],_c=(0,tslib_es6.zs)(_a[1],2),x1=_c[0],y1=_c[1],_d=(0,tslib_es6.zs)(isH?[x1-x0,[x0,x1]]:[y1-y0,[y0,y1]],2),len=_d[0],_e=(0,tslib_es6.zs)(_d[1],2),b0=_e[0],b1=_e[1],hL=len/2,cL=size*(len/Math.abs(len)),hCL=cL/2,cS=cL*Math.sqrt(3)/2*.8,_f=(0,tslib_es6.zs)([b0,b0+hL-hCL,b0+hL,b0+hL+hCL,b1],5),a0=_f[0],a1=_f[1],a2=_f[2],a3=_f[3],a4=_f[4];return isH?(this.point=[a2,y0-cS],[["L",a0,y0],["L",a1,y0],["L",a2,y0-cS],["L",a3,y0],["L",a4,y0]]):(this.point=[x0+cS,a2],[["L",x0,a0],["L",x0,a1],["L",x0+cS,a2],["L",x0,a3],["L",x0,a4]])},Indicator.prototype.applyVisibility=function(){"hidden"===this.attributes.visibility?hide(this):show(this)},Indicator.prototype.bindEvents=function(){this.label.on(ElementEvent.BOUNDS_CHANGED,this.renderBackground)},Indicator.prototype.render=function(){this.renderLabel(),this.renderBackground(),this.adjustLayout(),this.applyVisibility()},Indicator}(GUI),Option=function(_super){function Option(options){var _this=_super.call(this,deepAssign({},Option.defaultOptions,options))||this;return _this.hoverColor="#f5f5f5",_this.selectedColor="#e6f7ff",_this.background=_this.appendChild(new Rect({})),_this.label=_this.background.appendChild(new Group({})),_this}return(0,tslib_es6.C6)(Option,_super),Object.defineProperty(Option.prototype,"padding",{get:function(){return parseSeriesAttr(this.style.padding)},enumerable:!1,configurable:!0}),Option.prototype.renderLabel=function(){var _a=this.style,label=_a.label,value=_a.value,labelStyle=subStyleProps(this.attributes,"label");selection_select(this.label).maybeAppend(".label",(function(){return renderExtDo(label)})).attr("className","label").styles(labelStyle),this.label.attr("__data__",value)},Option.prototype.renderBackground=function(){var labelBBox=this.label.getBBox(),_a=(0,tslib_es6.zs)(this.padding,4),top=_a[0],right=_a[1],bottom=_a[2],left=_a[3],labelWidth=labelBBox.width,labelHeight=labelBBox.height,backgroundWidth=labelWidth+left+right,backgroundHeight=labelHeight+top+bottom,backgroundStyle=subStyleProps(this.attributes,"background"),_b=this.style,_c=_b.width,styleWidth=void 0===_c?0:_c,_d=_b.height,styleHeight=void 0===_d?0:_d,selected=_b.selected;this.background.attr((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},backgroundStyle),{width:Math.max(backgroundWidth,styleWidth),height:Math.max(backgroundHeight,styleHeight),fill:selected?this.selectedColor:"#fff"})),this.label.attr({x:left,y:(backgroundHeight-labelHeight)/2})},Option.prototype.render=function(){this.renderLabel(),this.renderBackground()},Option.prototype.bindEvents=function(){var _this=this;this.addEventListener("pointerenter",(function(){_this.style.selected||_this.background.attr("fill",_this.hoverColor)})),this.addEventListener("pointerleave",(function(){_this.style.selected||_this.background.attr("fill",_this.style.backgroundFill)}));var item=this;this.addEventListener("click",(function(){var _a=_this.style,label=_a.label,value=_a.value,onClick=_a.onClick;null==onClick||onClick(value,{label,value},item)}))},Option.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},Option}(GUI),Select=function(_super){function Select(options){var _a,_b,_this=_super.call(this,deepAssign({},Select.defaultOptions,options))||this;_this.currentValue=null===(_a=Select.defaultOptions.style)||void 0===_a?void 0:_a.defaultValue,_this.isPointerInSelect=!1,_this.select=_this.appendChild(new Rect({className:"select",style:{cursor:"pointer",width:0,height:0}})),_this.dropdown=_this.appendChild(new Rect({className:"dropdown"}));var defaultValue=_this.style.defaultValue;return defaultValue&&(null===(_b=_this.style.options)||void 0===_b?void 0:_b.some((function(option){return option.value===defaultValue})))&&(_this.currentValue=defaultValue),_this}return(0,tslib_es6.C6)(Select,_super),Select.prototype.setValue=function(value){this.currentValue=value,this.render()},Select.prototype.getValue=function(){return this.currentValue},Object.defineProperty(Select.prototype,"dropdownPadding",{get:function(){return parseSeriesAttr(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),Select.prototype.renderSelect=function(){var _a,_this=this,_b=this.style,width=_b.width,height=_b.height,bordered=_b.bordered,showDropdownIcon=_b.showDropdownIcon,selectStyle=subStyleProps(this.attributes,"select"),placeholderStyle=subStyleProps(this.attributes,"placeholder");this.select.attr((0,tslib_es6.Cl)((0,tslib_es6.Cl)({width,height},selectStyle),{fill:"#fff",strokeWidth:bordered?1:0}));var padding=this.dropdownPadding;showDropdownIcon&&selection_select(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(width-10-padding[1]-padding[3],", ").concat(height/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var currentOption=null===(_a=this.style.options)||void 0===_a?void 0:_a.find((function(option){return option.value===_this.currentValue})),finalPlaceholderStyle=(0,tslib_es6.Cl)({x:padding[3]},placeholderStyle);selection_select(this.select).selectAll(".placeholder").data(currentOption?[]:[1]).join((function(enter){return enter.append("text").attr("className","placeholder").styles(finalPlaceholderStyle).style("y",(function(){var bbox=this.getBBox();return(height-bbox.height)/2}))}),(function(update){return update.styles(finalPlaceholderStyle)}),(function(exit){return exit.remove()}));var labelStyle=subStyleProps(this.attributes,"optionLabel"),finalValueStyle=(0,tslib_es6.Cl)({x:padding[3]},labelStyle);selection_select(this.select).selectAll(".value").data(currentOption?[currentOption]:[]).join((function(enter){return enter.append((function(datum){return renderExtDo(datum.label)})).attr("className","value").styles(finalValueStyle).style("y",(function(){var bbox=this.getBBox();return(height-bbox.height)/2}))}),(function(update){return update.styles(finalValueStyle)}),(function(exit){return exit.remove()}))},Select.prototype.renderDropdown=function(){var _a,_b,_this=this,_c=this.style,width=_c.width,height=_c.height,options=_c.options,onSelect=_c.onSelect,open=_c.open,dropdownStyle=subStyleProps(this.attributes,"dropdown"),optionStyle=subStyleProps(this.attributes,"option"),padding=this.dropdownPadding;selection_select(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(options,(function(datum){return datum.value})).join((function(enter){return enter.append((function(datum){return new Option({className:"dropdown-item",style:(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},datum),optionStyle),{width:width-padding[1]-padding[3],selected:datum.value===_this.currentValue,onClick:function(value,option,item){_this.setValue(value),null==onSelect||onSelect(value,option,item),_this.dispatchEvent(new CustomEvent("change",{detail:{value,option,item}})),hide(_this.dropdown)}})})})).each((function(datum,i){var _a,accHeight=(null===(_a=this.parentNode)||void 0===_a?void 0:_a.children).reduce((function(acc,curr,index){return index<i&&(acc+=curr.getBBox().height),acc}),0);this.attr("transform","translate(".concat(padding[3],", ").concat(padding[0]+accHeight,")"))}))}),(function(update){return update.update((function(datum){return{selected:datum.value===_this.currentValue}}))}),(function(exit){return exit.remove()}));var bbox=null===(_b=null===(_a=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===_a?void 0:_a[0])||void 0===_b?void 0:_b.getBBox(),spacing=dropdownStyle.spacing;this.dropdown.attr((0,tslib_es6.Cl)({y:height+spacing,width:bbox.width+padding[1]+padding[3],height:bbox.height+padding[0]+padding[2]},dropdownStyle)),!open&&hide(this.dropdown)},Select.prototype.render=function(){this.renderSelect(),this.renderDropdown()},Select.prototype.bindEvents=function(){var _this=this;this.addEventListener("click",(function(e){e.stopPropagation()})),this.select.addEventListener("click",(function(){"visible"===_this.dropdown.style.visibility?hide(_this.dropdown):show(_this.dropdown)})),this.addEventListener("pointerenter",(function(){_this.isPointerInSelect=!0})),this.addEventListener("pointerleave",(function(){_this.isPointerInSelect=!1})),null===document||void 0===document||document.addEventListener("click",(function(){_this.isPointerInSelect||hide(_this.dropdown)}))},Select.defaultOptions={style:{width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"请选择",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},Select}(GUI),IconBase=function(_super){function IconBase(options){var _this=_super.call(this,deepAssign({},{style:{backgroundOpacity:IconBase.backgroundOpacities.default}},IconBase.defaultOptions,options))||this;return _this.showBackground=!0,_this.background=_this.appendChild(new Rect({})),_this.icon=_this.appendChild(new Group({})),_this}return(0,tslib_es6.C6)(IconBase,_super),Object.defineProperty(IconBase.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(IconBase.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(IconBase.prototype,"padding",{get:function(){return parseSeriesAttr(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(IconBase.prototype,"iconSize",{get:function(){var size=this.attributes.size,_a=(0,tslib_es6.zs)(this.padding,4),top=_a[0],right=_a[1],bottom=_a[2],left=_a[3];return Math.max(size-Math.max(left+right,top+bottom),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),IconBase.prototype.renderBackground=function(){var size=this.attributes.size,halfSize=size/2,backgroundStyle=subStyleProps(this.attributes,"background");this.background.attr((0,tslib_es6.Cl)({x:-halfSize,y:-halfSize,width:size,height:size},backgroundStyle))},IconBase.prototype.showIndicator=function(){if(this.label){var size=this.attributes.size,_a=this.background.getBBox(),x=_a.x,y=_a.y;this.indicator.update({x:x+size/2,y:y-5,labelText:this.label,visibility:"visible"})}},IconBase.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},IconBase.prototype.connectedCallback=function(){var _a;_super.prototype.connectedCallback.call(this);var size=this.attributes.size,_b=this.background.getBBox(),x=_b.x,y=_b.y,canvas=null===(_a=this.ownerDocument)||void 0===_a?void 0:_a.defaultView;canvas&&(this.indicator=canvas.appendChild(new Indicator({style:{x:x+size/2,y:y-size/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},IconBase.prototype.disconnectedCallback=function(){this.indicator.destroy()},IconBase.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},IconBase.prototype.bindEvents=function(){var _this=this,onClick=this.attributes.onClick;if(this.addEventListener("click",(function(){null==onClick||onClick(_this)})),this.showBackground){var resetBackground_1=function(){return _this.background.attr({opacity:IconBase.backgroundOpacities.default})};this.addEventListener("pointerenter",(function(){_this.background.attr({opacity:IconBase.backgroundOpacities.hover}),_this.showIndicator()})),this.addEventListener("pointerleave",(function(){resetBackground_1(),_this.hideIndicator()})),this.addEventListener("pointerdown",(function(){_this.background.attr({opacity:IconBase.backgroundOpacities.active})})),this.addEventListener("pointerup",(function(){resetBackground_1()}))}},IconBase.tag="IconBase",IconBase.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},IconBase.backgroundOpacities={default:0,hover:.8,active:1},IconBase}(GUI),arrow=function(size,color){return void 0===color&&(color="#565758"),new Path({style:{fill:color,anchor:"0.5 0.5",path:"M ".concat(size,",").concat(size," L -").concat(size,",0 L ").concat(size,",-").concat(size," Z"),transformOrigin:"center"}})},Reset=function(_super){function Reset(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Reset,_super),Reset.prototype.arcPath=function(cx,cy,radius){var _a=(0,tslib_es6.zs)([radius,radius],2),rx=_a[0],ry=_a[1],getPosByAngle=function(angle){return[cx+radius*Math.cos(angle),cy+radius*Math.sin(angle)]},_b=(0,tslib_es6.zs)(getPosByAngle(-5/4*Math.PI),2),x1=_b[0],y1=_b[1],_c=(0,tslib_es6.zs)(getPosByAngle(1/4*Math.PI),2),x2=_c[0],y2=_c[1];return"M".concat(x1,",").concat(y1,",A").concat(rx,",").concat(ry,",0,1,1,").concat(x2,",").concat(y2)},Object.defineProperty(Reset.prototype,"label",{get:function(){return"重置"},enumerable:!1,configurable:!0}),Reset.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth,arrowSize=lineWidth+.5;selection_select(this.icon).maybeAppend(".reset","path").styles({stroke:color,lineWidth,path:this.arcPath(0,0,size/2-lineWidth),markerStart:arrow(arrowSize,color)})},Reset}(IconBase),Backward=function(_super){function Backward(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Backward,_super),Object.defineProperty(Backward.prototype,"label",{get:function(){return"快退"},enumerable:!1,configurable:!0}),Backward.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,deltaX=size/2,deltaY=size/2/Math.pow(3,.5),points=[[0,0],[0,-deltaY],[-deltaX,0],[0,deltaY],[0,0],[deltaX,-deltaY],[deltaX,deltaY],[0,0]];selection_select(this.icon).maybeAppend(".backward","polygon").styles({points,fill:color})},Backward}(IconBase),Forward=function(_super){function Forward(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Forward,_super),Object.defineProperty(Forward.prototype,"label",{get:function(){return"快进"},enumerable:!1,configurable:!0}),Forward.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,deltaX=size/2,deltaY=size/2/Math.pow(3,.5),points=[[0,0],[0,-deltaY],[deltaX,0],[0,deltaY],[0,0],[-deltaX,-deltaY],[-deltaX,deltaY],[0,0]];selection_select(this.icon).maybeAppend(".forward","polygon").styles({points,fill:color})},Forward}(IconBase),Play=function(_super){function Play(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Play,_super),Object.defineProperty(Play.prototype,"label",{get:function(){return"播放"},enumerable:!1,configurable:!0}),Play.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,deltaX=size/3*Math.pow(3,.5)*.8,points=[[deltaX,0],[-deltaX/2,-size/2*.8],[-deltaX/2,size/2*.8],[deltaX,0]];selection_select(this.icon).maybeAppend(".play","polygon").styles({points,fill:color})},Play}(IconBase),Pause=function(_super){function Pause(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Pause,_super),Object.defineProperty(Pause.prototype,"label",{get:function(){return"暂停"},enumerable:!1,configurable:!0}),Pause.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,deltaX=size/3,points=[[-deltaX,-size/2],[-deltaX,size/2],[-deltaX/2,size/2],[-deltaX/2,-size/2],[-deltaX,-size/2],[deltaX/2,-size/2],[deltaX/2,size/2],[deltaX,size/2],[deltaX,-size/2]];selection_select(this.icon).maybeAppend(".pause","polygon").styles({points,fill:color})},Pause}(IconBase),Range=function(_super){function Range(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Range,_super),Object.defineProperty(Range.prototype,"label",{get:function(){return"范围时间"},enumerable:!1,configurable:!0}),Range.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth,gap=lineWidth;selection_select(this.icon).maybeAppend(".left-line","line").styles({x1:-size/2,y1:-size/2,x2:-size/2,y2:size/2,stroke:color,lineWidth}),selection_select(this.icon).maybeAppend(".right-line","line").styles({x1:size/2,y1:-size/2,x2:size/2,y2:size/2,stroke:color,lineWidth}),selection_select(this.icon).maybeAppend(".left-arrow","line").styles({x1:0,y1:0,x2:-size/2+2*gap,y2:0,stroke:color,lineWidth,markerEnd:arrow(2*lineWidth,color)}),selection_select(this.icon).maybeAppend(".right-arrow","line").styles({x1:0,y1:0,x2:size/2-2*gap,y2:0,stroke:color,lineWidth,markerEnd:arrow(2*lineWidth,color)})},Range}(IconBase),Value=function(_super){function Value(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(Value,_super),Object.defineProperty(Value.prototype,"label",{get:function(){return"单一时间"},enumerable:!1,configurable:!0}),Value.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth;selection_select(this.icon).maybeAppend(".line","line").styles({x1:0,y1:-size/2,x2:0,y2:size/2,stroke:color,lineWidth});var gap=lineWidth;selection_select(this.icon).maybeAppend(".left-arrow","line").styles({x1:-size/2-2*gap,y1:0,x2:2*-gap,y2:0,stroke:color,lineWidth,markerEnd:arrow(2*lineWidth,color)}),selection_select(this.icon).maybeAppend(".right-arrow","line").styles({x1:size/2+2*gap,y1:0,x2:2*gap,y2:0,stroke:color,lineWidth,markerEnd:arrow(2*lineWidth,color)})},Value}(IconBase),getCoordinatePoints=function(size){return[[-size/2,-size/2],[-size/2,size/2],[size/2,size/2]]},LineChart=function(_super){function LineChart(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(LineChart,_super),Object.defineProperty(LineChart.prototype,"label",{get:function(){return"折线图"},enumerable:!1,configurable:!0}),LineChart.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth,gap=lineWidth,deltaX=(size-2*gap-lineWidth)/4,deltaY=(size-2*gap-lineWidth)/2,_b=(0,tslib_es6.zs)([-size/2+gap,size/2-2*gap],2),ox=_b[0],oy=_b[1];selection_select(this.icon).maybeAppend(".coordinate","polyline").styles({points:getCoordinatePoints(size),stroke:color,lineWidth}),selection_select(this.icon).maybeAppend(".line","polyline").styles({points:[[ox,oy],[ox+deltaX,oy-deltaY],[ox+2*deltaX,oy],[ox+4*deltaX,oy-2*deltaY]],stroke:color,lineWidth})},LineChart}(IconBase),BarChart=function(_super){function BarChart(){return null!==_super&&_super.apply(this,arguments)||this}return(0,tslib_es6.C6)(BarChart,_super),Object.defineProperty(BarChart.prototype,"label",{get:function(){return"条形图"},enumerable:!1,configurable:!0}),Object.defineProperty(BarChart.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),BarChart.prototype.renderIcon=function(){var data=this.data,color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth,gap=lineWidth,deltaX=(size-gap)/data.length,deltaY=(size-2*gap)/4,_b=(0,tslib_es6.zs)([-size/2+2*gap,size/2-gap],2),ox=_b[0],oy=_b[1];selection_select(this.icon).maybeAppend(".coordinate","polyline").styles({points:getCoordinatePoints(size),stroke:color,lineWidth}),selection_select(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map((function(value,index){return{value,index}}))).join((function(enter){return enter.append("line").attr("className","column").style("x1",(function(_a){var index=_a.index;return ox+deltaX*index})).style("y1",oy).style("x2",(function(_a){var index=_a.index;return ox+deltaX*index})).style("y2",(function(_a){var value=_a.value;return oy-deltaY*value})).styles({y1:oy,stroke:color,lineWidth})}))},BarChart}(IconBase),Split=function(_super){function Split(options){var _this=_super.call(this,deepAssign({},{style:{color:"#d8d9d9"}},options))||this;return _this.showBackground=!1,_this}return(0,tslib_es6.C6)(Split,_super),Split.prototype.renderIcon=function(){var color=this.attributes.color,size=this.iconSize,lineWidth=this.lineWidth;selection_select(this.icon).maybeAppend(".split","line").styles({x1:0,y1:-size/2,x2:0,y2:size/2,stroke:color,lineWidth})},Split}(IconBase),SpeedSelect=function(_super){function SpeedSelect(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.showBackground=!1,_this}return(0,tslib_es6.C6)(SpeedSelect,_super),Object.defineProperty(SpeedSelect.prototype,"padding",{get:function(){return parseSeriesAttr(0)},enumerable:!1,configurable:!0}),SpeedSelect.prototype.renderIcon=function(){var iconSize=this.iconSize,_a=this.attributes.speed,speed=void 0===_a?1:_a,inheritStyle=function(obj,keys){return lodash_reduce(obj,(function(r,curr,key){return keys.includes(key)||(r[key]=curr),r}),{})}(this.attributes,["x","y","width","height","size","color","speed"]),width=lodash_clamp(iconSize,20,1/0),x=-width/2,style=(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},inheritStyle),{x,y:-10,width,height:20,defaultValue:speed,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:iconSize/5,placeholderFontSize:iconSize/2,optionPadding:0,optionLabelFontSize:iconSize/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});selection_select(this.icon).maybeAppend(".speed",(function(){return new Select({style})})).attr("className","speed").each((function(){this.update(style)}))},SpeedSelect.tag="SpeedSelect",SpeedSelect}(IconBase),ToggleIcon=function(_super){function ToggleIcon(options){var _this=_super.call(this,options)||this;return _this.icon=_this.appendChild(new Group({})),_this.currentType=_this.attributes.type,_this}return(0,tslib_es6.C6)(ToggleIcon,_super),ToggleIcon.prototype.getType=function(){return this.currentType},ToggleIcon.prototype.render=function(){var _this=this,_a=this.attributes,restStyles=(_a.x,_a.y,_a.onChange,(0,tslib_es6.Tt)(_a,["x","y","onChange"]));selection_select(this.icon).selectAll(".icon").data([this.currentType]).join((function(enter){return enter.append((function(type){var _a,Ctor=null===(_a=_this.toggles.find((function(_a){return(0,tslib_es6.zs)(_a,1)[0]===type})))||void 0===_a?void 0:_a[1];if(!Ctor)throw new Error("Invalid type: ".concat(type));return new Ctor({})})).attr("className","icon").styles(restStyles,!1).update({})}),(function(update){return update.styles({restStyles}).update({})}),(function(exit){return exit.remove()}))},ToggleIcon.prototype.bindEvents=function(){var _this=this,onChange=this.attributes.onChange;this.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();var nextIndex=(_this.toggles.findIndex((function(_a){return(0,tslib_es6.zs)(_a,1)[0]===_this.currentType}))+1)%_this.toggles.length,nextType=_this.toggles[nextIndex][0];null==onChange||onChange(_this.currentType),_this.currentType=nextType,_this.render()}))},ToggleIcon.tag="ToggleIcon",ToggleIcon}(GUI),PlayPause=function(_super){function PlayPause(options){var _this=_super.call(this,deepAssign({},{style:{type:"play"}},options))||this;return _this.toggles=[["play",Play],["pause",Pause]],_this}return(0,tslib_es6.C6)(PlayPause,_super),PlayPause}(ToggleIcon),SelectionType=function(_super){function SelectionType(options){var _this=_super.call(this,deepAssign({},{style:{type:"range"}},options))||this;return _this.toggles=[["range",Range],["value",Value]],_this}return(0,tslib_es6.C6)(SelectionType,_super),SelectionType}(ToggleIcon),ChartType=function(_super){function ChartType(options){var _this=_super.call(this,deepAssign({},{style:{type:"column"}},options))||this;return _this.toggles=[["line",LineChart],["column",BarChart]],_this}return(0,tslib_es6.C6)(ChartType,_super),ChartType}(ToggleIcon),componentsMap={reset:Reset,speed:SpeedSelect,backward:Backward,playPause:PlayPause,forward:Forward,selectionType:SelectionType,chartType:ChartType,split:Split},Controller=function(_super){function Controller(options){var _this=_super.call(this,deepAssign({},Controller.defaultOptions,options))||this;return _this.background=_this.appendChild(new Rect({})),_this.functions=_this.appendChild(new Group({})),_this}return(0,tslib_es6.C6)(Controller,_super),Object.defineProperty(Controller.prototype,"padding",{get:function(){return parseSeriesAttr(this.attributes.padding)},enumerable:!1,configurable:!0}),Controller.prototype.renderBackground=function(){var _a=this.style,width=_a.width,height=_a.height,backgroundStyle=subStyleProps(this.attributes,"background");this.background.attr((0,tslib_es6.Cl)({width,height},backgroundStyle))},Controller.prototype.renderFunctions=function(){var _a,_this=this,_b=this.attributes,functions=_b.functions,iconSize=_b.iconSize,iconSpacing=_b.iconSpacing,width=_b.width,height=_b.height,align=_b.align,_c=(0,tslib_es6.zs)(this.padding,4),right=_c[1],left=_c[3],components=functions.reduce((function(prev,curr){return prev.length&&curr.length?prev.concat.apply(prev,(0,tslib_es6.fX)(["split"],(0,tslib_es6.zs)(curr),!1)):prev.concat.apply(prev,(0,tslib_es6.fX)([],(0,tslib_es6.zs)(curr),!1))}),[]),componentsWidth=components.length*(iconSize+iconSpacing)-iconSpacing,xOffset={left:left+iconSize/2,center:(width-componentsWidth)/2+iconSize/2,right:width-componentsWidth-left-right+iconSize/2}[align]||0;null===(_a=this.speedSelect)||void 0===_a||_a.destroy(),this.functions.removeChildren(),components.forEach((function(name,index){var _a,Ctor=componentsMap[name],style={x:index*(iconSize+iconSpacing)+xOffset,y:height/2,size:iconSize};if(Ctor===SpeedSelect?(style.speed=_this.attributes.speed,style.onSelect=function(value){return _this.handleFunctionChange(name,{value})}):[PlayPause,SelectionType,ChartType].includes(Ctor)?(style.onChange=function(value){return _this.handleFunctionChange(name,{value})},Ctor===PlayPause&&(style.type="play"===_this.attributes.state?"pause":"play"),Ctor===SelectionType&&(style.type="range"===_this.attributes.selectionType?"value":"range"),Ctor===ChartType&&(style.type="line"===_this.attributes.chartType?"column":"line")):style.onClick=function(){return _this.handleFunctionChange(name,{value:name})},Ctor===SpeedSelect){var _b=_this.getBBox(),baseX=_b.x,baseY=_b.y,x=style.x,y=style.y,canvas=null===(_a=_this.ownerDocument)||void 0===_a?void 0:_a.defaultView;canvas&&(_this.speedSelect=new Ctor({style:(0,tslib_es6.Cl)((0,tslib_es6.Cl)({},style),{zIndex:100,x:baseX+x,y:baseY+y})}),canvas.appendChild(_this.speedSelect))}else _this.functions.appendChild(new Ctor({style}))}))},Controller.prototype.disconnectedCallback=function(){var _a;_super.prototype.disconnectedCallback.call(this),null===(_a=this.speedSelect)||void 0===_a||_a.destroy()},Controller.prototype.render=function(){this.renderBackground(),this.renderFunctions()},Controller.prototype.handleFunctionChange=function(name,value){var onChange=this.attributes.onChange;null==onChange||onChange(name,value)},Controller.defaultOptions={style:{width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},Controller}(GUI),TimeModeHandle=function(_super){function TimeModeHandle(options){var _this=_super.call(this,deepAssign({},TimeModeHandle.defaultOptions,options))||this;return _this.bindEvents(),_this}return(0,tslib_es6.C6)(TimeModeHandle,_super),TimeModeHandle.prototype.bindEvents=function(){var _this=this;this.addEventListener("mouseenter",(function(){_this.attr("lineWidth",Math.ceil(+(_this.style.r||0)/2))})),this.addEventListener("mouseleave",(function(){_this.attr("lineWidth",0)}))},TimeModeHandle.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},TimeModeHandle}(Circle),ChartModeHandle=function(_super){function ChartModeHandle(options){return _super.call(this,deepAssign({},ChartModeHandle.defaultOptions,options))||this}return(0,tslib_es6.C6)(ChartModeHandle,_super),ChartModeHandle.prototype.renderBackground=function(){var _a=this.attributes,width=_a.width,height=_a.height,style=subStyleProps(this.attributes,"background");selection_select(this).maybeAppend("background","rect").attr("className","background").styles((0,tslib_es6.Cl)({x:-width/2,y:-height/2,width,height},style))},ChartModeHandle.prototype.renderIcon=function(){var iconSize=this.attributes.iconSize,style=subStyleProps(this.attributes,"icon"),diffY=iconSize/2;selection_select(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles((0,tslib_es6.Cl)({x1:-1,y1:-diffY,x2:-1,y2:diffY},style)),selection_select(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles((0,tslib_es6.Cl)({x1:1,y1:-diffY,x2:1,y2:diffY},style))},ChartModeHandle.prototype.renderBorder=function(){var _a=this.attributes,width=_a.width,height=_a.height,type=_a.type,style=subStyleProps(this.attributes,"border"),x="start"===type?+width/2:-width/2;selection_select(this).maybeAppend("border","line").attr("className","border").styles((0,tslib_es6.Cl)({x1:x,y1:-height/2,x2:x,y2:+height/2},style))},ChartModeHandle.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},ChartModeHandle.defaultOptions={style:{width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},ChartModeHandle}(GUI);function labelFormatter(time,interval){return"number"==typeof time?parseBySeries(time):function parseByTime(time,interval){var date=new Date(time);switch(interval){case"half-hour":case"hour":case"four-hour":return[0,6,12,18].includes(date.getHours())&&0===date.getMinutes()?formatTime(date,"HH:mm\nYYYY-MM-DD"):formatTime(date,"HH:mm");case"half-day":return date.getHours()<12?"AM\n".concat(formatTime(date,"YYYY-MM-DD")):"PM";case"day":return[1,10,20].includes(date.getDate())?formatTime(date,"DD\nYYYY-MM"):formatTime(date,"DD");case"week":return date.getDate()<=7?formatTime(date,"DD\nYYYY-MM"):formatTime(date,"DD");case"month":return[0,6].includes(date.getMonth())?formatTime(date,"MM月\nYYYY"):formatTime(date,"MM月");case"season":return[0].includes(date.getMonth())?formatTime(date,"MM月\nYYYY"):formatTime(date,"MM月");case"year":return formatTime(date,"YYYY");default:return formatTime(date,"YYYY-MM-DD HH:mm")}}(time,interval)}function parseBySeries(time){var hours=String(Math.floor(time/3600)).padStart(2,"0"),minutes=String(Math.floor(time%3600/60)).padStart(2,"0"),seconds=String(Math.floor(time%60)).padStart(2,"0");return time<3600?"".concat(minutes,":").concat(seconds):"".concat(hours,":").concat(minutes,":").concat(seconds)}var timebar_Timebar=function(_super){function Timebar(options){var _this=_super.call(this,deepAssign({},Timebar.defaultOptions,options))||this;_this.axis=_this.appendChild(new Axis({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),_this.timeline=_this.appendChild(new Slider({style:{onChange:function(values){_this.handleSliderChange(values)}}})),_this.controller=_this.appendChild(new Controller({})),_this.states={},_this.handleSliderChange=function(values){var val,prevValues=(val=_this.states.values,Array.isArray(val)?(0,tslib_es6.fX)([],(0,tslib_es6.zs)(val),!1):val);_this.setBySliderValues(values),_this.dispatchOnChange(prevValues)};var _a=_this.attributes,selectionType=_a.selectionType,chartType=_a.chartType,speed=_a.speed,state=_a.state,playMode=_a.playMode,values=_a.values;return _this.states={chartType,playMode,selectionType,speed,state},_this.setByTimebarValues(values),_this}return(0,tslib_es6.C6)(Timebar,_super),Object.defineProperty(Timebar.prototype,"data",{get:function(){return this.attributes.data.sort((function(a,b){return a.time<b.time?-1:a.time>b.time?1:0}))},enumerable:!1,configurable:!0}),Object.defineProperty(Timebar.prototype,"space",{get:function(){var _a=this.attributes,width=_a.width,height=_a.height,type=_a.type,controllerHeight=_a.controllerHeight,availableTimelineHeight=lodash_clamp(+height-controllerHeight,0,+height),controllerBBox=new BBox(0,+height-controllerHeight,+width,controllerHeight),axisHeight=0,timelineHeight="time"===type?10:availableTimelineHeight;return{axisBBox:"chart"===type?new BBox(0,availableTimelineHeight-(axisHeight=35),+width,axisHeight):new BBox,controllerBBox,timelineBBox:new BBox(0,"time"===type?availableTimelineHeight:availableTimelineHeight-timelineHeight,+width,timelineHeight-axisHeight)}},enumerable:!1,configurable:!0}),Timebar.prototype.setBySliderValues=function(val){var _a,_b,data=this.data,_c=(0,tslib_es6.zs)(Array.isArray(val)?val:[0,val],2),startRatio=_c[0],endRatio=_c[1],length=data.length,startDatum=data[Math.floor(startRatio*length)],endDatum=data[Math.ceil(endRatio*length)-(Array.isArray(val)?0:1)];this.states.values=[null!==(_a=null==startDatum?void 0:startDatum.time)&&void 0!==_a?_a:data[0].time,null!==(_b=null==endDatum?void 0:endDatum.time)&&void 0!==_b?_b:1/0]},Timebar.prototype.setByTimebarValues=function(val){var _a,_b,_c,data=this.data,_d=(0,tslib_es6.zs)(Array.isArray(val)?val:[void 0,val],2),start=_d[0],end=_d[1],startDatum=data.find((function(_a){return _a.time===start})),endDatum=data.find((function(_a){return _a.time===end}));this.states.values=[null!==(_a=null==startDatum?void 0:startDatum.time)&&void 0!==_a?_a:null===(_b=data[0])||void 0===_b?void 0:_b.time,null!==(_c=null==endDatum?void 0:endDatum.time)&&void 0!==_c?_c:1/0]},Timebar.prototype.setByIndex=function(index){var _a,_b,_c,_d,data=this.data,_e=(0,tslib_es6.zs)(index,2),startIndex=_e[0],endIndex=_e[1];this.states.values=[null!==(_b=null===(_a=data[startIndex])||void 0===_a?void 0:_a.time)&&void 0!==_b?_b:data[0].time,null!==(_d=null===(_c=this.data[endIndex])||void 0===_c?void 0:_c.time)&&void 0!==_d?_d:1/0]},Object.defineProperty(Timebar.prototype,"sliderValues",{get:function(){var startDatumIndex,_a=this.states,values=_a.values,selectionType=_a.selectionType,_b=(0,tslib_es6.zs)(Array.isArray(values)?values:[void 0,values],2),start=_b[0],end=_b[1],data=this.data,length=data.length,isValue="value"===selectionType;return[(startDatumIndex=data.findIndex((function(_a){return _a.time===start})),isValue?0:startDatumIndex>-1?startDatumIndex/length:0),function(){if(end===1/0)return 1;var endDatumIndex=data.findIndex((function(_a){return _a.time===end}));return endDatumIndex>-1?endDatumIndex/length:isValue?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(Timebar.prototype,"values",{get:function(){var _a=this.states,values=_a.values,selectionType=_a.selectionType,_b=(0,tslib_es6.zs)(Array.isArray(values)?values:[this.data[0].time,values],2),start=_b[0],end=_b[1];return"value"===selectionType?end:[start,end]},enumerable:!1,configurable:!0}),Timebar.prototype.getDatumByRatio=function(ratio){var data=this.data,length=data.length;return data[Math.floor(ratio*(length-1))]},Object.defineProperty(Timebar.prototype,"chartHandleIconShape",{get:function(){var selectionType=this.states.selectionType,height=this.space.timelineBBox.height;return"range"===selectionType?function(type){return new ChartModeHandle({style:{type,height,iconSize:height/6}})}:function(){return new Line({style:{x1:0,y1:-height/2,x2:0,y2:height/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),Timebar.prototype.getChartStyle=function(bbox){var _this=this,x=bbox.x,y=bbox.y,width=bbox.width,height=bbox.height,_a=this.states,selectionType=_a.selectionType,chartType=_a.chartType,data=this.data,_b=this.attributes,type=_b.type,userDefinedLabelFormatter=_b.labelFormatter,_c=subStyleProps(this.attributes,"chart"),userDefinedChartStyle=(_c.type,(0,tslib_es6.Tt)(_c,["type"])),isRange="range"===selectionType;if("time"===type)return(0,tslib_es6.Cl)({handleIconShape:function(){return new TimeModeHandle({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:isRange?-15:0,autoFitLabel:isRange,handleSpacing:isRange?-15:0,trackFill:"#edeeef",trackLength:width,trackOpacity:.5,trackRadius:height/2,trackSize:height/2,type:selectionType,values:this.sliderValues,formatter:function(value){if(userDefinedLabelFormatter)return userDefinedLabelFormatter(value);var time=_this.getDatumByRatio(value).time;return"number"==typeof time?parseBySeries(time):formatTime(time,"YYYY-MM-DD HH:mm:ss")},x,y,zIndex:1},userDefinedChartStyle);var handleIconOffset="range"===selectionType?5:0,sparklineData=data.map((function(_a){return _a.value}));return(0,tslib_es6.Cl)({handleIconOffset,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData,sparklineType:chartType,sparklineScale:.8,trackLength:width,trackSize:height,type:selectionType,values:this.sliderValues,x,y,zIndex:1},userDefinedChartStyle)},Timebar.prototype.renderChart=function(bbox){void 0===bbox&&(bbox=this.space.timelineBBox),this.timeline.update(this.getChartStyle(bbox))},Timebar.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},Timebar.prototype.getAxisStyle=function(bbox){var data=this.data,_a=this.attributes,interval=_a.interval,userDefinedLabelFormatter=_a.labelFormatter,userDefinedAxisStyle=subStyleProps(this.attributes,"axis"),x=bbox.x,y=bbox.y,width=bbox.width,axisData=(0,tslib_es6.fX)((0,tslib_es6.fX)([],(0,tslib_es6.zs)(data),!1),[{time:0}],!1).map((function(_a,index,arr){var time=_a.time;return{label:"".concat(time),value:index/(arr.length-1),time}})),style=(0,tslib_es6.Cl)({startPos:[x,y],endPos:[x+width,y],data:axisData,labelFilter:function(_datum,index){return index<axisData.length-1},labelFormatter:function(_a){var time=_a.time;return userDefinedLabelFormatter?userDefinedLabelFormatter(time):labelFormatter(time,interval)}},userDefinedAxisStyle);return style},Timebar.prototype.renderAxis=function(bbox){void 0===bbox&&(bbox=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(bbox))},Timebar.prototype.renderController=function(bbox){void 0===bbox&&(bbox=this.space.controllerBBox);var type=this.attributes.type,_a=this.states,state=_a.state,speed=_a.speed,selectionType=_a.selectionType,chartType=_a.chartType,userDefinedControllerStyle=subStyleProps(this.attributes,"controller"),that=this,style=(0,tslib_es6.Cl)((0,tslib_es6.Cl)((0,tslib_es6.Cl)({},bbox),{iconSize:20,speed,state,selectionType,chartType,onChange:function(type,_a){var value=_a.value;switch(type){case"reset":that.internalReset();break;case"speed":that.handleSpeedChange(value);break;case"backward":that.internalBackward();break;case"playPause":"play"===value?that.internalPlay():that.internalPause();break;case"forward":that.internalForward();break;case"selectionType":that.handleSelectionTypeChange(value);break;case"chartType":that.handleChartTypeChange(value)}}}),userDefinedControllerStyle);"time"===type&&(style.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(style)},Timebar.prototype.dispatchOnChange=function(prevValues){var data=this.data,onChange=this.attributes.onChange,_a=this.states,values=_a.values,selectionType=_a.selectionType,_b=(0,tslib_es6.zs)(values,2),start=_b[0],end=_b[1],endTime=end===1/0?data.at(-1).time:end;prevValues&&function(val1,val2){if(Array.isArray(val1)){if(!Array.isArray(val2))return!1;if(val1[0]===val2[0]){if(val1[1]===val2[1])return!0;if(val1[1]===1/0||val2[1]===1/0)return!0}return!1}return!Array.isArray(val2)&&val1===val2}(prevValues,"range"===selectionType?[start,endTime]:endTime)||null==onChange||onChange("range"===selectionType?[start,endTime]:endTime)},Timebar.prototype.internalReset=function(preventEvent){var _a,_b,selectionType=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===selectionType?[0,1]:[0,0]),this.renderController(),this.updateSelection(),preventEvent||(null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onReset)||void 0===_b||_b.call(_a),this.dispatchOnChange())},Timebar.prototype.reset=function(){this.internalReset()},Timebar.prototype.moveSelection=function(direction,preventEvent){var data=this.data,length=data.length,_a=this.states,values=_a.values,selectionType=_a.selectionType,playMode=_a.playMode,_b=(0,tslib_es6.zs)(values,2),startTime=_b[0],endTime=_b[1],startIndex=data.findIndex((function(_a){return _a.time===startTime})),endIndex=data.findIndex((function(_a){return _a.time===endTime}));-1===endIndex&&(endIndex=length);var currentIndexes,diff="backward"===direction?-1:1;"range"===selectionType?"acc"===playMode?(currentIndexes=[startIndex,endIndex+diff],-1===diff&&startIndex===endIndex&&(currentIndexes=[startIndex,length])):currentIndexes=[startIndex+diff,endIndex+diff]:currentIndexes=[startIndex,endIndex+diff];var normalizedIndexes=function(indexes){var _a=(0,tslib_es6.zs)(indexes.sort((function(a,b){return a-b})),2),start=_a[0],end=_a[1],clampIndex=function(index){return lodash_clamp(index,0,length)};return end>length?"value"===selectionType?[0,0]:"acc"===playMode?[clampIndex(start),clampIndex(start)]:[0,clampIndex(end-start)]:start<0?"acc"===playMode?[0,clampIndex(end)]:[clampIndex(start+length-end),length]:[clampIndex(start),clampIndex(end)]}(currentIndexes);return this.setByIndex(normalizedIndexes),this.updateSelection(),normalizedIndexes},Timebar.prototype.internalBackward=function(preventEvent){var _a,_b,indexes=this.moveSelection("backward",preventEvent);return preventEvent||(null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onBackward)||void 0===_b||_b.call(_a),this.dispatchOnChange()),indexes},Timebar.prototype.backward=function(){this.internalBackward()},Timebar.prototype.internalPlay=function(preventEvent){var _a,_b,_this=this,data=this.data,loop=this.attributes.loop,_c=this.states.speed,speed=void 0===_c?1:_c;this.playInterval=window.setInterval((function(){_this.internalForward()[1]!==data.length||loop||(_this.internalPause(),_this.renderController())}),1e3/speed),this.states.state="play",!preventEvent&&(null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onPlay)||void 0===_b||_b.call(_a))},Timebar.prototype.play=function(){this.internalPlay()},Timebar.prototype.internalPause=function(preventEvent){var _a,_b;clearInterval(this.playInterval),this.states.state="pause",!preventEvent&&(null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onPause)||void 0===_b||_b.call(_a))},Timebar.prototype.pause=function(){this.internalPause()},Timebar.prototype.internalForward=function(preventEvent){var _a,_b,indexes=this.moveSelection("forward",preventEvent);return preventEvent||(null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onForward)||void 0===_b||_b.call(_a),this.dispatchOnChange()),indexes},Timebar.prototype.forward=function(){this.internalForward()},Timebar.prototype.handleSpeedChange=function(value){var _a,_b;this.states.speed=value,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onSpeedChange)||void 0===_b||_b.call(_a,value)},Timebar.prototype.handleSelectionTypeChange=function(type){var _a,_b;this.states.selectionType=type,this.renderChart(),null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onSelectionTypeChange)||void 0===_b||_b.call(_a,type)},Timebar.prototype.handleChartTypeChange=function(type){var _a,_b;this.states.chartType=type,this.renderChart(),null===(_b=null===(_a=this.attributes)||void 0===_a?void 0:_a.onChartTypeChange)||void 0===_b||_b.call(_a,type)},Timebar.prototype.render=function(){var _a=this.space,axisBBox=_a.axisBBox,controllerBBox=_a.controllerBBox,timelineBBox=_a.timelineBBox;this.renderController(controllerBBox),this.renderAxis(axisBBox),this.renderChart(timelineBBox),"play"===this.states.state&&this.internalPlay()},Timebar.prototype.destroy=function(){_super.prototype.destroy.call(this),this.internalPause(!0)},Timebar.defaultOptions={style:{axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},Timebar}(GUI),timebar_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const prefixStyleProps=(style,prefix)=>{const result={};return Object.entries(style).forEach((([key,val])=>{const newKey=`${prefix}${key[0].toUpperCase()}${key.slice(1)}`;result[newKey]=val})),result},prospectiveTimeKeys=["timestamp","time","date","datetime"],prospectiveValueKeys=["value","date"],tryToGet=(datum,optionsKeys,defaultValue)=>{for(let i=0;i<optionsKeys.length;i++){const key=optionsKeys[i],val=null==datum?void 0:datum[key];if(val)return val}return defaultValue};class Timebar extends plugin_Plugin{get padding(){return formatPadding(this.options.padding)}get containerShape(){const{width,height}=this.options,[top,right,bottom,left]=this.padding;return{x:left,y:top,width:width+left+right,height:height+top+bottom+30}}get data(){const{graph}=this;return{nodes:graph.getAllNodesData(),edges:graph.getAllEdgesData()}}constructor(options){super(options),this.itemTypes=["node","edge"]}getDefaultCfgs(){return{axisStyle:{},className:"g6-component-timebar",controllerStyle:{},data:[],filterItemTypes:["node"],filterType:"modify",getTimeFromItem:model=>tryToGet(model.data,prospectiveTimeKeys,void 0),getTimeFromData:datum=>tryToGet(datum,prospectiveTimeKeys,void 0),getValueFromItem:datum=>tryToGet(datum,prospectiveValueKeys,0),height:60,padding:10,position:"bottom",timebarType:"time",width:200}}getEvents(){return{afterrender:this.updateTimebar,afterchangedata:this.handleDataChange}}init(graph){super.init(graph)}reset(){this.timebar.reset()}backward(){this.timebar.backward()}play(){this.timebar.play()}pause(){this.timebar.pause()}forward(){this.timebar.forward()}destroy(){this.canvas.destroy(),super.destroy()}get container(){const{container}=this.options;if(container instanceof HTMLElement)return container;const element=document.getElementById(container);return element||this.graph.container}createWrapper(){const{options}=this,{className}=options,{width,height}=this.containerShape,wrapper=createDOM(`<div class="${className}" style="width: ${width}px;height: ${height}"></div>`);return this.container.appendChild(wrapper),wrapper}createCanvas(){const{width,height}=this.containerShape;return createCanvas("canvas",this.wrapper,width,height,void 0,{background:"#fff"})}updateTimebar(){this.wrapper||(this.wrapper=this.createWrapper()),this.canvas||(this.canvas=this.createCanvas()),this.canvas.ready.then((()=>{this.renderTimebar()}))}updatePosition(){const{graph}=this,{x,y}=this.options,{width}=this.containerShape,{position}=this.options,[graphWidth,graphHeight]=graph.getSize();if(!x&&!y&&"bottom"===position)this.wrapper.style.top=graphHeight+"px",this.wrapper.style.left=(graphWidth-width)/2+"px"}renderTimebar(){const{x,y}=this.containerShape,_a=this.options,{x:ignoreX,y:ignoreY,axisStyle={},chartStyle={},className,container,controllerStyle={},data:userDefinedData,filter,filterItemTypes,filterType,getTimeFromData,getTimeFromItem,getValueFromData,onChange,padding,position,shouldIgnore,timebarType,type}=_a,userDefinedOptions=timebar_rest(_a,["x","y","axisStyle","chartStyle","className","container","controllerStyle","data","filter","filterItemTypes","filterType","getTimeFromData","getTimeFromItem","getValueFromData","onChange","padding","position","shouldIgnore","timebarType","type"]),data=userDefinedData.map((datum=>({time:(null==getTimeFromData?void 0:getTimeFromData(datum))||(null==datum?void 0:datum.time),value:(null==getValueFromData?void 0:getValueFromData(datum))||(null==datum?void 0:datum.value)}))),style=Object.assign(Object.assign(Object.assign(Object.assign({x,y,data,type:timebarType,onChange:values=>{this.handleValuesChange(values),null==onChange||onChange(values)}},prefixStyleProps(axisStyle,"axis")),prefixStyleProps(controllerStyle,"controller")),prefixStyleProps(chartStyle,"chart")),userDefinedOptions);this.timebar?this.timebar.update(style):this.timebar=this.canvas.appendChild(new timebar_Timebar({style})),this.updatePosition()}handleDataChange(){this.graphDataCache=deep_mix({},this.data),this.updateTimebar(),this.processValuesChange()}handleValuesChange(values){this.processValuesChange(values)}processValuesChange(values=this.timebar.values){const{filter}=this.options;filter?filter(values):this.filter(values)}filter(values){(!this.graphDataCache||0===this.graphDataCache.nodes.length&&0===this.graphDataCache.edges.length)&&(this.graphDataCache=deep_mix({},this.data));const{filterType,filterItemTypes,shouldIgnore,getTimeFromItem}=this.options,state={nodes:{enter:[],exit:[]},edges:{enter:[],exit:[]}},filterByType=type=>{const key=`${type}s`;if(!(key in this.data))return;this.graphDataCache[key].forEach((item=>{const queryItem="node"===type?this.graph.getNodeData(item.id):this.graph.getEdgeData(item.id),time=getTimeFromItem(item,type),isItemExists=void 0!==queryItem,isItemVisible=queryItem&&this.graph.getItemVisible(item.id),addItem=()=>{("modify"!==filterType||isItemExists)&&("visibility"!==filterType||isItemVisible)||state[key].enter.push(item)};(()=>{if("edge"!==type)return!1;const{source,target}=item,nodes=[...state.nodes.enter,...this.data.nodes],isSourceExists=nodes.find((n=>n.id===source)),isTargetExists=nodes.find((n=>n.id===target));return!isSourceExists||!isTargetExists})()||(filterItemTypes.includes(type)?void 0===time||(null==shouldIgnore?void 0:shouldIgnore(item,type,values))||(time=>Array.isArray(values)?time>=values[0]&&time<=values[1]:time===values)(time)?addItem():this.data[key].find((({id})=>id===item.id))&&("modify"===filterType&&isItemExists||"visibility"===filterType&&isItemVisible)&&state[key].exit.push(item):addItem())}))};this.itemTypes.forEach((type=>filterByType(type))),this.mutateGraph(state)}mutateGraph(state){const{filterType}=this.options,mutateByType=type=>{const{enter,exit}=state[`${type}s`];"modify"===filterType?(this.graph.addData(type,enter),this.graph.removeData(type,exit.map((n=>n.id)))):(this.graph.showItem(enter.map((e=>e.id))),this.graph.hideItem(exit.map((e=>e.id))))};(callback=>{const originError=console.error;console.error=()=>{},null==callback||callback(),console.error=originError})((()=>{this.itemTypes.forEach((type=>mutateByType(type)))}))}}class Snapline extends plugin_Plugin{setTolerance(tolerance){this.tolerance=tolerance}getTolerance(){return this.tolerance}getDrawLineIdByDrawLine(dl){if(dl)return`${dl.line[0].x}-${dl.line[0].y}-${dl.line[1].x}-${dl.line[1].y}`}getDrawLineIdByPoints([cp,dp]){return`${cp.x}-${cp.y}-${dp.x}-${dp.y}`}addAlignLinesForChoose(){function isInToleranceRange(xOrY,contrast,tolerance){return xOrY>=contrast-tolerance&&xOrY<=contrast+tolerance}this.vContrastPoints.forEach((vpoint=>{isInToleranceRange(this.draggingBBox.min[0],vpoint.x,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[vpoint,{x:vpoint.x,y:this.draggingBBox.center[1]}],lp:"left"},offset:{x:vpoint.x-this.draggingBBox.min[0],y:0}}),isInToleranceRange(this.draggingBBox.center[0],vpoint.x,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[vpoint,{x:vpoint.x,y:this.draggingBBox.center[1]}],lp:"vcenter"},offset:{x:vpoint.x-this.draggingBBox.center[0],y:0}}),isInToleranceRange(this.draggingBBox.max[0],vpoint.x,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[vpoint,{x:vpoint.x,y:this.draggingBBox.center[1]}],lp:"right"},offset:{x:vpoint.x-this.draggingBBox.max[0],y:0}})})),this.hContrastPoints.forEach((hpoint=>{isInToleranceRange(this.draggingBBox.min[1],hpoint.y,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[hpoint,{x:this.draggingBBox.min[0],y:hpoint.y}],lp:"top"},offset:{x:0,y:hpoint.y-this.draggingBBox.min[1]}}),isInToleranceRange(this.draggingBBox.center[1],hpoint.y,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[hpoint,{x:this.draggingBBox.center[0],y:hpoint.y}],lp:"hcenter"},offset:{x:0,y:hpoint.y-this.draggingBBox.center[1]}}),isInToleranceRange(this.draggingBBox.max[1],hpoint.y,this.tolerance)&&this.alignLinesForChoose.v.push({dl:{line:[hpoint,{x:this.draggingBBox.max[0],y:hpoint.y}],lp:"bottom"},offset:{x:0,y:hpoint.y-this.draggingBBox.max[1]}})}))}initAlignLinesForChoose(){this.alignLinesForChoose.v=[],this.alignLinesForChoose.h=[];let allIds=[];this.graph.getAllCombosData().forEach((item=>{allIds.push(item.id)})),this.graph.getAllNodesData().forEach((item=>{allIds.push(item.id)})),allIds=allIds.filter((item=>item!==this.dragItemId)),allIds.forEach((id=>{const cb=this.graph.getRenderBBox(id,!0);Math.abs(this.draggingBBox.min[0]-cb.min[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.min[0],y:cb.center[1]},{x:cb.min[0],y:this.draggingBBox.center[1]}],lp:"left"},offset:{x:this.draggingBBox.min[0]-cb.min[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.min[0]-cb.center[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:cb.center[0],y:this.draggingBBox.center[1]}],lp:"left"},offset:{x:this.draggingBBox.min[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.min[0]-cb.max[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.max[0],y:cb.center[1]},{x:cb.max[0],y:this.draggingBBox.center[1]}],lp:"left"},offset:{x:this.draggingBBox.min[0]-cb.max[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.center[0]-cb.min[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.min[0],y:cb.center[1]},{x:cb.min[0],y:this.draggingBBox.center[1]}],lp:"vcenter"},offset:{x:this.draggingBBox.center[0]-cb.min[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.center[0]-cb.center[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:cb.center[0],y:this.draggingBBox.center[1]}],lp:"vcenter"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.center[0]-cb.max[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.max[0],y:cb.center[1]},{x:cb.max[0],y:this.draggingBBox.center[1]}],lp:"vcenter"},offset:{x:this.draggingBBox.center[0]-cb.max[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.max[0]-cb.min[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.min[0],y:cb.center[1]},{x:cb.min[0],y:this.draggingBBox.center[1]}],lp:"right"},offset:{x:this.draggingBBox.max[0]-cb.min[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.max[0]-cb.center[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:cb.center[0],y:this.draggingBBox.center[1]}],lp:"right"},offset:{x:this.draggingBBox.max[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.max[0]-cb.max[0])<=this.tolerance&&this.alignLinesForChoose.v.push({dl:{line:[{x:cb.max[0],y:cb.center[1]},{x:cb.max[0],y:this.draggingBBox.center[1]}],lp:"right"},offset:{x:this.draggingBBox.max[0]-cb.max[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.min[1]-cb.max[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.max[1]},{x:this.draggingBBox.center[0],y:cb.max[1]}],lp:"top"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.min[1]-cb.max[1]}}),Math.abs(this.draggingBBox.min[1]-cb.center[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:this.draggingBBox.center[0],y:cb.center[1]}],lp:"top"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.min[1]-cb.center[1]}}),Math.abs(this.draggingBBox.min[1]-cb.min[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.max[1]},{x:this.draggingBBox.center[0],y:cb.max[1]}],lp:"top"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.min[1]-cb.min[1]}}),Math.abs(this.draggingBBox.center[1]-cb.max[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.max[1]},{x:this.draggingBBox.center[0],y:cb.max[1]}],lp:"hcenter"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.max[1]}}),Math.abs(this.draggingBBox.center[1]-cb.center[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:this.draggingBBox.center[0],y:cb.center[1]}],lp:"hcenter"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.center[1]}}),Math.abs(this.draggingBBox.center[1]-cb.min[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.min[1]},{x:this.draggingBBox.center[0],y:cb.min[1]}],lp:"hcenter"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.center[1]-cb.min[1]}}),Math.abs(this.draggingBBox.max[1]-cb.max[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.max[1]},{x:this.draggingBBox.center[0],y:cb.max[1]}],lp:"bottom"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.max[1]-cb.max[1]}}),Math.abs(this.draggingBBox.max[1]-cb.center[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.center[1]},{x:this.draggingBBox.center[0],y:cb.center[1]}],lp:"bottom"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.max[1]-cb.center[1]}}),Math.abs(this.draggingBBox.max[1]-cb.min[1])<=this.tolerance&&this.alignLinesForChoose.h.push({dl:{line:[{x:cb.center[0],y:cb.min[1]},{x:this.draggingBBox.center[0],y:cb.min[1]}],lp:"bottom"},offset:{x:this.draggingBBox.center[0]-cb.center[0],y:this.draggingBBox.max[1]-cb.min[1]}})}))}chooseAlignLine(){if(this.alignLinesForChoose.v.length+this.alignLinesForChoose.h.length===0)return{v:void 0,h:void 0};let vTmpLines=[],hTmpLines=[];const vMinOffset=Math.min(...this.alignLinesForChoose.v.map((dlFc=>dlFc.offset.x))),hMinOffset=Math.min(...this.alignLinesForChoose.h.map((dlFc=>dlFc.offset.y)));vTmpLines=this.alignLinesForChoose.v.filter((dlFc=>dlFc.offset.x===vMinOffset)),hTmpLines=this.alignLinesForChoose.h.filter((dlFc=>dlFc.offset.y===hMinOffset));{const vcenter_hasdata=vTmpLines.some((dlFc=>"vcenter"===dlFc.dl.lp)),left_hasdata=vTmpLines.some((dlFc=>"left"===dlFc.dl.lp));vTmpLines=vTmpLines.filter((dlFc=>"vcenter"===dlFc.dl.lp||("left"===dlFc.dl.lp?!(vcenter_hasdata||!left_hasdata):"right"===dlFc.dl.lp&&(!vcenter_hasdata&&!left_hasdata))));const hcenter_hasdata=hTmpLines.some((dlFc=>"hcenter"===dlFc.dl.lp)),top_hasdata=hTmpLines.some((dlFc=>"top"===dlFc.dl.lp));hTmpLines=hTmpLines.filter((dlFc=>"hcenter"===dlFc.dl.lp||("top"===dlFc.dl.lp?!(hcenter_hasdata||!top_hasdata):"bottom"===dlFc.dl.lp&&(!hcenter_hasdata&&!top_hasdata))))}const uniVTmpLines=Array.from(vTmpLines.reduce(((map,item)=>{var _a;return(!map.has(item.dl.lp)||Math.abs(item.offset.x)<Math.abs(null===(_a=map.get(item.dl.lp))||void 0===_a?void 0:_a.offset.x))&&map.set(item.dl.lp,item),map}),new Map).values()),uniHTmpLines=Array.from(hTmpLines.reduce(((map,item)=>{var _a;return(!map.has(item.dl.lp)||Math.abs(item.offset.y)<Math.abs(null===(_a=map.get(item.dl.lp))||void 0===_a?void 0:_a.offset.y))&&map.set(item.dl.lp,item),map}),new Map).values()),vMaxDL=uniVTmpLines.length?uniVTmpLines.reduce(((maxItem,curItem)=>curItem.offset.x>maxItem.offset.x?curItem:maxItem)):void 0,hMaxDL=uniHTmpLines.length?uniHTmpLines.reduce(((maxItem,curItem)=>curItem.offset.y>maxItem.offset.y?curItem:maxItem)):void 0;return{v:vMaxDL?vMaxDL.dl:void 0,h:hMaxDL?hMaxDL.dl:void 0}}constructor(options){super(options),this.historyPoints=[void 0,void 0],this.initialOffset=[void 0,void 0],this.updateCache=new Map,this.getCurOffsetCompareToInitialOffset=e=>{if(void 0===this.initialOffset[0]||void 0===this.initialOffset[1])return[void 0,void 0];const curOffset=[e.canvas.x-this.draggingBBox.center[0],e.canvas.y-this.draggingBBox.center[1]];return[curOffset[0]-this.initialOffset[0],curOffset[1]-this.initialOffset[1]]},this.dragging=!1,this.draggingBBox=void 0,this.getPointerOffsetWithItem=pointer=>({x:Math.abs(pointer.x-this.draggingBBox.center[0]),y:Math.abs(pointer.x-this.draggingBBox.center[1])}),this.tolerance=4,this.toleranceFactor=2,this.vContrastPoints=[],this.hContrastPoints=[],this.alignLinesForChoose={v:[],h:[]},this.isAdsorbed=[!1,!1],this.dragEvent=void 0,this.dragItemId=void 0,this.dragItemType=void 0,this.historyAbsorbArea=[void 0,void 0],this.canAdsorbCount=0,this.canAdsorbCountDown=()=>{if(this.canAdsorbCount>0){const intervalID=setInterval((()=>{this.canAdsorbCount--,this.canAdsorbCount<=0&&clearTimeout(intervalID)}),100)}},this.onDrag=throttle((event=>{var _a,_b,_c,_d,_e,_f,_g,_h;let vlp,vline,hlp,hline;this.dragEvent=event,this.initAlignLinesForChoose(),this.historyPoints[0]=this.historyPoints[1],this.historyPoints[1]={x:event.canvas.x,y:event.canvas.y};const checkVShouldHoldAbsorb=(vlp,vline)=>{Math.abs(this.getCurOffsetCompareToInitialOffset(event)[0])<=this.tolerance*this.toleranceFactor?("left"===vlp?this.doUpdatePosition({x:vline[0].x+this.draggingBBox.halfExtents[0]}):"vcenter"===vlp?this.doUpdatePosition({x:vline[0].x}):"right"===vlp&&this.doUpdatePosition({fx:vline[0].x-this.draggingBBox.halfExtents[0]}),this.updateAlignLineWhenAbsorb([!0,!1])):(this.doUpdatePosition({fx:void 0}),this.removeAlignLine([!0,void 0]),this.canAdsorbCount=10,this.canAdsorbCountDown())},checkHShouldHoldAbsorb=(hlp,hline)=>{Math.abs(this.getCurOffsetCompareToInitialOffset(event)[1])<=this.tolerance*this.toleranceFactor?("top"===hlp?this.doUpdatePosition({fy:hline[0].y+this.draggingBBox.halfExtents[1]}):"hcenter"===hlp?this.doUpdatePosition({fy:hline[0].y}):"bottom"===hlp&&this.doUpdatePosition({fy:hline[0].y-this.draggingBBox.halfExtents[1]}),this.updateAlignLineWhenAbsorb([!1,!0])):(this.doUpdatePosition({fy:void 0}),this.removeAlignLine([void 0,!0]),this.canAdsorbCount=10,this.canAdsorbCountDown())},checkVShouldAbsorb=()=>{const ret=this.canDrawLine();ret&&(this.drawAlignLines({vdl:ret.vdl,hdl:void 0}),this.absorb({vdl:ret.vdl,hdl:void 0}))},checkHShouldAbsorb=()=>{const ret=this.canDrawLine();ret&&(this.drawAlignLines({vdl:void 0,hdl:ret.hdl}),this.absorb({vdl:void 0,hdl:ret.hdl}))};if(this.isAdsorbed[0]&&this.isAdsorbed[1])vlp=null===(_a=this.drawedLines[0].dl)||void 0===_a?void 0:_a.lp,vline=null===(_b=this.drawedLines[0].dl)||void 0===_b?void 0:_b.line,hlp=null===(_c=this.drawedLines[1].dl)||void 0===_c?void 0:_c.lp,hline=null===(_d=this.drawedLines[1].dl)||void 0===_d?void 0:_d.line,checkVShouldHoldAbsorb(vlp,vline),checkHShouldHoldAbsorb(hlp,hline);else if(this.isAdsorbed[0]&&!this.isAdsorbed[1])vlp=null===(_e=this.drawedLines[0].dl)||void 0===_e?void 0:_e.lp,vline=null===(_f=this.drawedLines[0].dl)||void 0===_f?void 0:_f.line,checkVShouldHoldAbsorb(vlp,vline),checkHShouldAbsorb();else if(!this.isAdsorbed[0]&&this.isAdsorbed[1])hlp=null===(_g=this.drawedLines[1].dl)||void 0===_g?void 0:_g.lp,hline=null===(_h=this.drawedLines[1].dl)||void 0===_h?void 0:_h.line,checkHShouldHoldAbsorb(vlp,vline),checkVShouldAbsorb();else if(!this.isAdsorbed[0]&&!this.isAdsorbed[1]){const ret=this.canDrawLine();ret&&(this.drawAlignLines(ret),this.absorb(ret))}}).bind(this),16,{leading:!1,trailing:!0}),this.drawedLines=[void 0,void 0],this.throttleUpdate=throttle((()=>{this.graph.updateNodePosition(Array.from(this.updateCache.values()),!1,!0),this.updateCache.clear()}),16,{leading:!0,trailing:!0}),this.init(options.graph)}getEvents(){return{pointerdown:this.onPointerDown,pointermove:this.onPointerMove,pointerup:this.onPointerUp}}onPointerDown(event){this.historyPoints[1]={x:event.canvas.x,y:event.canvas.y},this.dragItemId=event.itemId,this.dragItemType=event.itemType}onPointerMove(event){this.historyPoints[1]&&"node"===this.dragItemType&&(this.dragging?this.onDrag(event):(this.onDragStart(event),this.dragging=!0))}onPointerUp(event){this.dragging?this.onDragEnd():(this.historyPoints=[void 0,void 0],this.dragging=!1,this.dragItemId=void 0,this.dragItemType=void 0)}getGraph(event){return event.currentTarget}onDragStart(event){this.draggingBBox=this.graph.getRenderBBox(event.itemId,!0),this.initialOffset=[event.canvas.x-this.draggingBBox.center[0],event.canvas.y-this.draggingBBox.center[1]]}onDragEnd(){this.dragEvent=void 0,this.historyPoints=[void 0,void 0],this.dragging=!1,this.dragItemId=void 0,this.dragItemType=void 0}drawAlignLines({vdl,hdl}){const vLineID=vdl?this.getDrawLineIdByDrawLine(vdl):void 0,hLineID=hdl?this.getDrawLineIdByDrawLine(hdl):void 0;let vLine,hLine;vdl&&(vLine=this.graph.drawTransient("line",vLineID,{style:{stroke:"red",lineWidth:1,x1:vdl.line[0].x,y1:vdl.line[0].y,x2:vdl.line[1].x,y2:vdl.line[1].y}}),this.drawedLines[0]={do:vLine,dl:vdl}),hdl&&(hLine=this.graph.drawTransient("line",hLineID,{style:{stroke:"red",lineWidth:1,x1:hdl.line[0].x,y1:hdl.line[0].y,x2:hdl.line[1].x,y2:hdl.line[1].y}}),this.drawedLines[1]={do:hLine,dl:hdl})}removeAlignLine([rvdl,rhdl]){if(rvdl){const vlid=this.getDrawLineIdByDrawLine(this.drawedLines[0].dl);this.graph.drawTransient("line",vlid,{action:"remove"}),this.drawedLines[0]=void 0,this.isAdsorbed[0]=!1}if(rhdl){const hlid=this.getDrawLineIdByDrawLine(this.drawedLines[1].dl);this.graph.drawTransient("line",hlid,{action:"remove"}),this.drawedLines[1]=void 0,this.isAdsorbed[1]=!1}}removeAlignLineByID(rmLineID){const[vTmpDrawedLine,hTmpDrawedLine]=this.drawedLines;this.drawedLines.forEach(((line,index)=>{if(line&&line.do){this.getDrawLineIdByPoints(line.dl.line)===rmLineID&&(0===index&&vTmpDrawedLine?(vTmpDrawedLine.dl=void 0,vTmpDrawedLine.do=void 0):1===index&&hTmpDrawedLine&&(hTmpDrawedLine.dl=void 0,hTmpDrawedLine.do=void 0),this.isAdsorbed[index]=!1)}})),this.drawedLines[0]=vTmpDrawedLine,this.drawedLines[1]=hTmpDrawedLine,this.graph.drawTransient("line",rmLineID,{action:"remove"})}getDraggingBBoxPointByLinePosition(lp){if(this.draggingBBox)return"left"===lp?{x:this.draggingBBox.min[0],y:this.draggingBBox.center[1]}:"vcenter"===lp||"hcenter"===lp?{x:this.draggingBBox.center[0],y:this.draggingBBox.center[1]}:"right"===lp?{x:this.draggingBBox.max[0],y:this.draggingBBox.center[1]}:"top"===lp?{x:this.draggingBBox.center[0],y:this.draggingBBox.min[1]}:"bottom"===lp?{x:this.draggingBBox.center[0],y:this.draggingBBox.max[1]}:void 0}updateAlignLineWhenAbsorb([v,h]){if(v&&this.drawedLines[0]&&this.drawedLines[0].do){const draggingBBoxDrawEndPoint=this.getDraggingBBoxPointByLinePosition(this.drawedLines[0].dl.lp),vdl={line:[this.drawedLines[0].dl.line[0],{x:this.drawedLines[0].dl.line[0].x,y:draggingBBoxDrawEndPoint.y}],lp:this.drawedLines[0].dl.lp};this.removeAlignLineByID(this.drawedLines[0].do.id),this.drawAlignLines({vdl,hdl:void 0}),this.isAdsorbed[0]=!0}if(h&&this.drawedLines[1]&&this.drawedLines[1].do){const draggingBBoxDrawEndPoint=this.getDraggingBBoxPointByLinePosition(this.drawedLines[1].dl.lp),hdl={line:[this.drawedLines[1].dl.line[0],{x:draggingBBoxDrawEndPoint.x,y:this.drawedLines[1].dl.line[0].y}],lp:this.drawedLines[1].dl.lp};this.removeAlignLineByID(this.drawedLines[1].do.id),this.drawAlignLines({vdl:void 0,hdl}),this.isAdsorbed[1]=!0}}canDrawLine(){const{v,h}=this.chooseAlignLine();return!(!v&&!h)&&{vdl:v,hdl:h}}canCancelAbsorb(){let ret=[void 0,void 0];const vdl=this.drawedLines[0].dl,hdl=this.drawedLines[1].dl,offset=this.getPointerOffsetWithItem({x:this.dragEvent.canvas.x,y:this.dragEvent.canvas.y});return vdl&&Math.abs(offset.x)>this.tolerance*this.toleranceFactor&&(ret[0]=!0),hdl&&Math.abs(offset.y)>this.tolerance*this.toleranceFactor&&(ret[1]=!0),ret}absorb(dls){dls.vdl&&(this.isAdsorbed[0]=!0,this.historyAbsorbArea[0]=[dls.vdl.line[0].x-this.tolerance*this.toleranceFactor,dls.vdl.line[0].x+this.tolerance*this.toleranceFactor],this.updateDraggingItemPosition(this.drawedLines[0].dl)),dls.hdl&&(this.isAdsorbed[1]=!0,this.historyAbsorbArea[1]=[dls.hdl.line[0].y-this.tolerance*this.toleranceFactor,dls.hdl.line[0].y+this.tolerance*this.toleranceFactor],this.updateDraggingItemPosition(this.drawedLines[1].dl))}updateDraggingItemPosition(dl,shouldChange){if(this.historyPoints[0]||this.historyPoints[1]){if(dl){if("left"===dl.lp){const tmpX=dl.line[0].x+this.draggingBBox.halfExtents[0];this.doUpdatePosition({fx:tmpX})}"vcenter"===dl.lp&&this.doUpdatePosition({fx:dl.line[0].x}),"right"===dl.lp&&this.doUpdatePosition({fx:dl.line[0].x-this.draggingBBox.halfExtents[0]}),"top"===dl.lp&&this.doUpdatePosition({fy:dl.line[0].y+this.draggingBBox.halfExtents[1]}),"hcenter"===dl.lp&&this.doUpdatePosition({fy:dl.line[0].y}),"bottom"===dl.lp&&this.doUpdatePosition({fy:dl.line[0].y-this.draggingBBox.halfExtents[1]})}if(shouldChange){if(shouldChange.x){const changeX=this.draggingBBox.center[0]+shouldChange.x;this.doUpdatePosition({x:changeX,fx:void 0})}if(shouldChange.y){const changeY=this.draggingBBox.center[1]+shouldChange.y;this.doUpdatePosition({y:changeY,fy:void 0})}}}}doUpdatePosition(data){const cache=this.updateCache.get(this.dragItemId);this.updateCache.set(this.dragItemId,{id:this.dragItemId,data:Object.assign(Object.assign({},null==cache?void 0:cache.data),data)}),this.throttleUpdate()}}const edgeFilterLens_lensDelegateStyle={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:1,fill:"#fff"};class EdgeFilterLens extends plugin_Plugin{constructor(config){super(config),this.cachedTransientNodes=new Set,this.cachedTransientEdges=new Set}getDefaultCfgs(){return{showType:"both",trigger:"mousemove",r:60,delegateStyle:cloneJSON(edgeFilterLens_lensDelegateStyle),showLabel:"edge",scaleRBy:"wheel"}}getEvents(){let events={pointerdown:this.onPointerDown,pointerup:this.onPointerUp,wheel:this.onWheel};switch(this.options.trigger){case"click":events=Object.assign(Object.assign({},events),{click:this.filter});break;case"drag":events=Object.assign(Object.assign({},events),{pointermove:this.onPointerMove});break;default:events=Object.assign(Object.assign({},events),{pointermove:this.filter})}return events}init(graph){super.init(graph);const showLabel=this.options.showLabel,showNodeLabel="node"===showLabel||"both"===showLabel,showEdgeLabel="edge"===showLabel||"both"===showLabel;this.showNodeLabel=showNodeLabel,this.showEdgeLabel=showEdgeLabel;this.options.shouldShow||(this.options.shouldShow=()=>!0)}onPointerUp(e){this.dragging=!1}onPointerMove(e){this.dragging&&this.moveDelegate(e)}onPointerDown(e){const{delegate:lensDelegate}=this;let cacheCenter;!lensDelegate||lensDelegate.destroyed?(cacheCenter={x:e.canvas.x,y:e.canvas.y},this.filter(e)):cacheCenter={x:lensDelegate.style.cx,y:lensDelegate.style.cy},this.delegateCenterDiff={x:e.canvas.x-cacheCenter.x,y:e.canvas.y-cacheCenter.y},this.dragging=!0}isInLensDelegate(lensDelegate,pointer){const{cx:lensX,cy:lensY,r:lensR}=lensDelegate.style;return pointer.x>=lensX-lensR&&pointer.x<=lensX+lensR&&pointer.y>=lensY-lensR&&pointer.y<=lensY+lensR}moveDelegate(e){if(this.isInLensDelegate(this.delegate,{x:e.canvas.x,y:e.canvas.y})){const center={x:e.canvas.x-this.delegateCenterDiff.x,y:e.canvas.y-this.delegateCenterDiff.y};this.filter(e,center)}}onWheel(e){const{delegate:lensDelegate,options}=this,{scaleRBy}=options;lensDelegate&&!lensDelegate.destroyed&&"wheel"===scaleRBy&&this.isInLensDelegate(lensDelegate,{x:e.canvas.x,y:e.canvas.y})&&"wheel"===scaleRBy&&this.scaleRByWheel(e)}scaleRByWheel(e){if(!e||!e.originalEvent)return;e.preventDefault&&e.preventDefault();const{graph,options}=this,graphCanvasEl=graph.canvas.context.config.canvas,graphHeight=(null==graphCanvasEl?void 0:graphCanvasEl.height)||500,maxR=options.maxR?Math.min(options.maxR,graphHeight):graphHeight,minR=options.minR?Math.max(options.minR,.01*graphHeight):.01*graphHeight,scale=1+-1*e.originalEvent.deltaY*.01;let r=options.r*scale;r=Math.min(r,maxR),r=Math.max(r,minR),options.r=r,this.delegate.style.r=r,this.filter(e)}filter(e,mousePos){const{graph,options,showNodeLabel,showEdgeLabel,cachedTransientNodes,cachedTransientEdges}=this,r=options.r,showType=options.showType,shouldShow=options.shouldShow,fCenter=mousePos||{x:e.canvas.x,y:e.canvas.y};this.updateDelegate(fCenter,r);const nodes=graph.getAllNodesData(),hitNodesMap=new Map;nodes.forEach((node=>{const{data,id}=node;point_distance({x:data.x,y:data.y},fCenter)<r&&hitNodesMap.set(id,node)}));const edges=graph.getAllEdgesData(),hitEdges=[];edges.forEach((edge=>{const sourceId=edge.source,targetId=edge.target;shouldShow(edge)&&("only-source"===showType||"one"===showType?hitNodesMap.get(sourceId)&&!hitNodesMap.get(targetId)&&hitEdges.push(edge):"only-target"===showType||"one"===showType?hitNodesMap.get(targetId)&&!hitNodesMap.get(sourceId)&&hitEdges.push(edge):"both"===showType&&hitNodesMap.get(sourceId)&&hitNodesMap.get(targetId)&&hitEdges.push(edge))}));const currentTransientNodes=new Set,currentTransientEdges=new Set;hitNodesMap.forEach((node=>{currentTransientNodes.add(node.id),cachedTransientNodes.has(node.id)?cachedTransientNodes.delete(node.id):graph.drawTransient("node",node.id,{shapeIds:showNodeLabel?["labelShape","labelBackgroundShape","keyShape"]:["keyShape"]})})),cachedTransientNodes.forEach((id=>{graph.drawTransient("node",id,{action:"remove"})})),showEdgeLabel&&(hitEdges.forEach((edge=>{currentTransientEdges.add(edge.id),cachedTransientEdges.has(edge.id)?cachedTransientEdges.delete(edge.id):graph.drawTransient("edge",edge.id,{shapeIds:["labelShape","labelBackgroundShape","keyShape"],drawSource:!1,drawTarget:!1})})),cachedTransientEdges.forEach((id=>{graph.drawTransient("edge",id,{action:"remove"})}))),this.cachedTransientNodes=currentTransientNodes,this.cachedTransientEdges=currentTransientEdges}updateParams(cfg){const self=this,{r,trigger,minR,maxR,scaleRBy,showLabel,shouldShow}=cfg;isNaN(cfg.r)||(self.options.r=r),isNaN(maxR)||(self.options.maxR=maxR),isNaN(minR)||(self.options.minR=minR),"mousemove"!==trigger&&"click"!==trigger&&"drag"!==trigger||(self.options.trigger=trigger),"wheel"!==scaleRBy&&"unset"!==scaleRBy||(self.options.scaleRBy=scaleRBy,self.delegate.remove(),self.delegate.destroy()),"node"!==showLabel&&"both"!==showLabel||(self.showNodeLabel=!0),"edge"!==showLabel&&"both"!==showLabel||(self.showEdgeLabel=!0),shouldShow&&(self.options.shouldShow=shouldShow)}updateDelegate(mCenter,r){const{graph,options,delegate}=this;let lensDelegate=delegate;if(!lensDelegate||lensDelegate.destroyed){const attrs=options.delegateStyle||edgeFilterLens_lensDelegateStyle;lensDelegate=graph.drawTransient("circle","lens-shape",{style:Object.assign({r,cx:mCenter.x,cy:mCenter.y,zIndex:-1},attrs)}),lensDelegate.toBack()}else lensDelegate=graph.drawTransient("circle","lens-shape",{style:{r,cx:mCenter.x,cy:mCenter.y}});this.delegate=lensDelegate}clear(){const{graph,delegate:lensDelegate,cachedTransientNodes,cachedTransientEdges}=this;lensDelegate&&!lensDelegate.destroyed&&graph.drawTransient("circle","lens-shape",{action:"remove"}),cachedTransientNodes.forEach((id=>{graph.drawTransient("node",id,{action:"remove"})})),cachedTransientEdges.forEach((id=>{graph.drawTransient("edge",id,{action:"remove"})})),cachedTransientNodes.clear(),cachedTransientEdges.clear()}destroy(){this.clear()}}const formatLodLevels=lodLevels=>{if(!(null==lodLevels?void 0:lodLevels.length))return;const primaryLevel=lodLevels.find((level=>level.primary));if(!primaryLevel)return;const primaryIndex=lodLevels.indexOf(primaryLevel),formattedLevels={};return lodLevels.forEach(((level,i)=>{formattedLevels[i-primaryIndex]=level.zoomRange})),formattedLevels},getZoomLevel=(levels,zoom)=>{const keys=Object.keys(levels);for(let i=0;i<keys.length;i++){const idx=keys[i],zoomRange=levels[idx];if(zoom>=zoomRange[0]&&zoom<zoomRange[1])return Number(idx)}};var lodController_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class LodController extends plugin_Plugin{constructor(options){super(options),this.shownIds=new Map,this.displayModelCache=new Map,this.renderBoundsCache=new Map,this.canvasCellDirty=!0,this.canvasCellSize=100,this.labelPositionDirty=new Map,this.debounce=16,this.animationUpdateTimer=0,this.onAfterRender=()=>{const{graph,options}=this;if(this.clearCache(),this.debounce=80,void 0===(null==options?void 0:options.debounce)||"auto"===options.debounce){const nodes=graph.getAllNodesData();this.debounce=Math.min(Math.floor(nodes.length/100),80)}this.debounceUpdateVisible=this.getDebounceFn(this.updateVisible.bind(this))},this.onAfterLayout=()=>{this.canvasCellDirty=!0,this.updateLabelPositions(1),this.updateCells()},this.updateCells=params=>{var _a;if(!this.graph.canvasReady)return;const{zoom}=params||{};params&&this.updateLabelPositions(null==zoom?void 0:zoom.ratio),(null===(_a=this.options)||void 0===_a?void 0:_a.disableLod)||this.debounceUpdateVisible(null==zoom?void 0:zoom.ratio)},this.getDebounceFn=fn=>lodash_debounce(fn,this.debounce,!1),this.updateVisible=(zoomRatio=1)=>{const{graph,cacheViewModels,options}=this,{cellSize,numberPerCell,disableAnimate,disableLod}=options||{},graphZoom=graph.getZoom(),{inView}=cacheViewModels||this.groupItemsByView(1),cells=new Map,candidateShapeMap=new Map,lodVisibleIds=[],lodInvisibleIds=new Map;inView.forEach((model=>{const _a=this.getDisplayModel(model.id).data,{lodLevels,x,y,z}=_a,others=lodController_rest(_a,["lodLevels","x","y","z"]),lodLevelsEmpty=isEmptyObj(lodLevels),currentZoomLevel=lodLevelsEmpty?0:getZoomLevel(lodLevels,graphZoom),autoVisibleShapeIds=[],lodVisibleShapeIds=[],invisibleShapeIds=[];if(Object.keys(others).forEach((shapeId=>{if("keyShape"===shapeId)return;const val=others[shapeId];if(!val||"object"!=typeof val||!Object.keys(val).length||(0,is_array.A)(val))return;const{lod,visible}=val;!1!==visible&&(lodLevelsEmpty||"auto"===lod?autoVisibleShapeIds.push(shapeId):lod<=currentZoomLevel?lodVisibleShapeIds.push(shapeId):invisibleShapeIds.push(shapeId))})),!lodVisibleShapeIds.length&&!autoVisibleShapeIds.length)return void lodInvisibleIds.set(model.id,invisibleShapeIds);const bounds=this.getRenderBBox(model.id);if(!bounds||!graph.getItemVisible(model.id))return void lodInvisibleIds.set(model.id,invisibleShapeIds);autoVisibleShapeIds.length||lodVisibleIds.push(model.id);const{center}=bounds,param=graphZoom/cellSize,cellIdx=`${Math.floor((center[0]||x)*param)}-${Math.floor((center[1]||y)*param)}`,cellNodeIds=cells.get(cellIdx)||[];cellNodeIds.push(model.id),cells.set(cellIdx,cellNodeIds),candidateShapeMap.set(model.id,{lodVisibleShapeIds,autoVisibleShapeIds,invisibleShapeIds})}));const shownIds=new Map;cells.forEach((cell=>{cell.sort(((a,b)=>{const{lodVisibleShapeIds:aLodVisibleShapeIds}=candidateShapeMap.get(a),{lodVisibleShapeIds:bLodVisibleShapeIds}=candidateShapeMap.get(b);if(lodVisibleIds.includes(b)&&bLodVisibleShapeIds.length)return 1;if(lodVisibleIds.includes(a)&&aLodVisibleShapeIds.length)return-1;if(this.shownIds.has(b)&&!lodInvisibleIds.has(b))return 1;return this.shownIds.has(a)&&!lodInvisibleIds.has(a)?-1:0}));let rest=numberPerCell;cell.forEach((id=>{const{lodVisibleShapeIds,autoVisibleShapeIds,invisibleShapeIds}=candidateShapeMap.get(id);!disableLod&&invisibleShapeIds.length&&graph.hideItem(id,{shapeIds:invisibleShapeIds,disableAnimate});const item=graph.itemController.itemMap.get(id);if(disableLod||item.labelGroup.children.length&&(rest>0||zoomRatio>=1&&this.shownIds.has(id))){lodVisibleShapeIds.concat(autoVisibleShapeIds).length&&graph.showItem(id,{shapeIds:lodVisibleShapeIds.concat(autoVisibleShapeIds),disableAnimate}),this.labelPositionDirty.has(id)&&(item.updateLabelPosition(disableLod),this.labelPositionDirty.delete(id)),shownIds.set(id,1),rest--}else lodVisibleShapeIds.includes("labelShape")&&this.labelPositionDirty.has(id)&&(item.updateLabelPosition(disableLod),this.labelPositionDirty.delete(id)),lodVisibleShapeIds.length&&graph.showItem(id,{shapeIds:lodVisibleShapeIds,disableAnimate}),!disableLod&&autoVisibleShapeIds.length&&graph.hideItem(id,{shapeIds:autoVisibleShapeIds,disableAnimate})}))})),disableLod||lodInvisibleIds.forEach(((shapeIds,id)=>{shapeIds.length&&graph.hideItem(id,{shapeIds,disableAnimate})})),this.shownIds=shownIds},this.debounceUpdateVisible=this.getDebounceFn(this.updateVisible.bind(this)),this.updateLabelPositions=throttle((zoomRatio=>{const{graph,options}=this,{inView,newlyOutView,newlyInView}=this.groupItemsByView(zoomRatio),graphZoom=graph.getZoom(),levelCache={};this.labelPositionDirty.clear(),inView.forEach((model=>{var _a;this.labelPositionDirty.set(model.id,!0);const item=graph.itemController.itemMap.get(model.id);if(!(item&&item.labelGroup.children.length&&item.shapeMap.labelShape&&((null==options?void 0:options.disableLod)||"hidden"!==item.labelGroup.style.visibility&&"hidden"!==item.shapeMap.labelShape.style.visibility)))return;const displayModel=this.getDisplayModel(model.id),{labelShape,lodLevels}=displayModel.data;if(!labelShape)return;const updatePosition=()=>{item.updateLabelPosition(null==options?void 0:options.disableLod),this.labelPositionDirty.delete(model.id)},{visible,lod}=labelShape;if(!1===visible)return;if(void 0===lod)return void updatePosition();if("auto"===lod)return void updatePosition();if("number"!=typeof lod||(null===(_a=item.animations)||void 0===_a?void 0:_a.length))return void updatePosition();const lodLevelsEmpty=isEmptyObj(lodLevels);if(lodLevelsEmpty)return void updatePosition();const levelsKey=JSON.stringify(lodLevels),currentZoomLevel=levelCache[levelsKey]||lodLevelsEmpty?0:getZoomLevel(lodLevels,graphZoom);levelCache[levelsKey]=currentZoomLevel,lod<=currentZoomLevel&&updatePosition()})),newlyOutView.forEach((model=>{graph.hideItem(model.id,{shapeIds:["labelShape","labelBackgroundShape"],disableAnimate:!0})})),(null==options?void 0:options.disableLod)&&newlyInView.forEach((model=>{graph.showItem(model.id,{shapeIds:["labelShape","labelBackgroundShape"],disableAnimate:!0})}))}),16,{leading:!0,trailing:!0}),this.groupItemsByView=(ratio=1)=>{const{graph}=this,range=graph.getCanvasRange(),models=graph.getAllNodesData().concat(graph.getAllEdgesData());let{inView,outView}=this.cacheViewModels||{};this.canvasCellDirty&&this.updateCanvasCells();const canvasCellRowRange=[Math.floor(range.min[0]/this.canvasCellSize),Math.ceil(range.max[0]/this.canvasCellSize)],canvasCellColRange=[Math.floor(range.min[1]/this.canvasCellSize),Math.ceil(range.max[1]/this.canvasCellSize)],atBoundary=(rowIdx,colIdx)=>rowIdx>canvasCellRowRange[0]&&rowIdx<canvasCellRowRange[1]&&(Math.abs(colIdx-canvasCellColRange[0])<2||Math.abs(colIdx-canvasCellColRange[1])<2)||colIdx>canvasCellColRange[0]&&colIdx<canvasCellColRange[1]&&(Math.abs(rowIdx-canvasCellRowRange[0])<2||Math.abs(rowIdx-canvasCellRowRange[1])<2),outBoundary=(rowIdx,colIdx)=>rowIdx<=canvasCellRowRange[0]||rowIdx>=canvasCellRowRange[1]||colIdx<=canvasCellColRange[0]||colIdx>=canvasCellColRange[1],newlyOutView=[],newlyInView=[],cacheIsEmpty=!this.cacheViewModels||!inView.length&&!outView.length;if(!ratio||1===ratio||cacheIsEmpty){const previousOutView=new Map,previousInView=new Map;null==outView||outView.forEach((model=>previousOutView.set(model.id,!0))),null==inView||inView.forEach((model=>previousInView.set(model.id,!0))),inView=[],outView=[],models.forEach((model=>{if(!this.modelCanvasIdxMap.get(model.id))return outView.push(model),void(previousOutView.has(model.id)||newlyOutView.push(model));const{rowIdx,colIdx}=this.modelCanvasIdxMap.get(model.id);if(atBoundary(rowIdx,colIdx)){const renderBounds=this.getRenderBBox(model.id);if(!renderBounds)return;intersectBBox(renderBounds,range)?(inView.push(model),previousInView.has(model.id)||newlyInView.push(model)):(outView.push(model),previousOutView.has(model.id)||newlyOutView.push(model))}else outBoundary(rowIdx,colIdx)?(outView.push(model),previousOutView.has(model.id)||newlyOutView.push(model)):(inView.push(model),previousInView.has(model.id)||newlyInView.push(model))}))}else if(ratio<1){const outViewNew=[];outView.forEach((model=>{if(!this.modelCanvasIdxMap.get(model.id))return void outViewNew.push(model);const{rowIdx,colIdx}=this.modelCanvasIdxMap.get(model.id);if(atBoundary(rowIdx,colIdx)){const renderBounds=this.getRenderBBox(model.id);if(!renderBounds)return;intersectBBox(renderBounds,range)?(inView.push(model),newlyInView.push(model)):outViewNew.push(model)}else outBoundary(rowIdx,colIdx)?outViewNew.push(model):(inView.push(model),newlyInView.push(model))})),outView=outViewNew}else if(ratio>1){const inViewNew=[];inView.forEach((model=>{if(!this.modelCanvasIdxMap.get(model.id))return outView.push(model),void newlyOutView.push(model);const{rowIdx,colIdx}=this.modelCanvasIdxMap.get(model.id);if(atBoundary(rowIdx,colIdx)){const renderBounds=this.getRenderBBox(model.id);if(!renderBounds)return;intersectBBox(renderBounds,range)?inViewNew.push(model):(outView.push(model),newlyOutView.push(model))}else outBoundary(rowIdx,colIdx)?(outView.push(model),newlyOutView.push(model)):inViewNew.push(model)})),inView=inViewNew}return this.cacheViewModels={inView,outView,newlyOutView,newlyInView},this.cacheViewModels},this.updateCanvasCells=()=>{const canvasCells=new Map,idxMap=new Map,{graph,canvasCellSize}=this;graph.getAllNodesData().forEach((model=>{const{x,y}=model.data,rowIdx=Math.floor(x/canvasCellSize),colIdx=Math.floor(y/canvasCellSize),cellIdx=`${rowIdx}-${colIdx}`,cell=canvasCells.get(cellIdx)||[];cell.push(model.id),canvasCells.set(cellIdx,cell),idxMap.set(model.id,{rowIdx,colIdx})})),graph.getAllEdgesData().forEach((model=>{const{source,target}=model,{rowIdx:sourceRowIdx,colIdx:sourceColIdx}=idxMap.get(source),{rowIdx:targetRowIdx,colIdx:targetColIdx}=idxMap.get(target),centerRowIdx=Math.round((sourceRowIdx+targetRowIdx)/2),centerColIdx=Math.round((sourceColIdx+targetColIdx)/2),cellIdx=`${centerRowIdx}-${centerColIdx}`,cell=canvasCells.get(cellIdx)||[];cell.push(model.id),canvasCells.set(cellIdx,cell),idxMap.set(model.id,{rowIdx:centerRowIdx,colIdx:centerColIdx})})),this.modelCanvasIdxMap=idxMap,this.canvasCellDirty=!1},this.updateCacheModels=params=>{const{models,action}=params;this.canvasCellDirty=!0,null==models||models.forEach((model=>{var _a;this.renderBoundsCache.delete(model.id),"updatePosition"!==action&&this.displayModelCache.delete(model.id),(null===(_a=this.options)||void 0===_a?void 0:_a.disableLod)&&this.graph.showItem(model.id,{shapeIds:["labelShape","labelBackgroundShape"],disableAnimate:!0})}))},this.beforeViewportAnimation=()=>{this.animationUpdateTimer||(this.animationUpdateTimer=setInterval((()=>{this.updateLabelPositions()}),16))},this.afterViewportAnimation=()=>{this.animationUpdateTimer&&(clearInterval(this.animationUpdateTimer),this.animationUpdateTimer=0)},this.clearCache=()=>{this.displayModelCache.clear(),this.renderBoundsCache.clear(),this.cacheViewModels={inView:[],outView:[],newlyOutView:[],newlyInView:[]}},this.getDisplayModel=id=>{let displayModel=this.displayModelCache.get(id);return displayModel||(displayModel=this.graph.getDisplayModel(id),this.displayModelCache.set(id,displayModel)),displayModel},this.getRenderBBox=id=>{let renderBounds;return this.renderBoundsCache.has(id)?renderBounds=this.renderBoundsCache.get(id):(renderBounds=this.graph.getRenderBBox(id,!0),this.renderBoundsCache.set(id,renderBounds)),renderBounds}}getDefaultCfgs(){return{key:`lodController-${unique_id()}`,cellSize:200,numberPerCell:1,disableLod:!1,disableAnimate:!0,debounce:"auto"}}init(graph){super.init(graph)}getEvents(){return"webgl-3d"===this.graph.rendererType?{}:{afterrender:this.onAfterRender,afterlayout:this.onAfterLayout,aftersetsize:this.updateCells,viewportchange:this.updateCells,afteritemchange:this.updateCacheModels,beforeviewportanimation:this.beforeViewportAnimation,afterviewportanimation:this.afterViewportAnimation,cancelviewportanimation:this.afterViewportAnimation}}destroy(){super.destroy()}}LodController.required=!0;const isEmptyObj=obj=>!obj||!Object.keys(obj).length,getClosedSpline=points=>{if(points.length<2)throw new Error(`point length must larges than 2, now it's ${points.length}`);const first=points[0],second=points[1],last=points[points.length-1],lastSecond=points[points.length-2];points.unshift(last),points.unshift(lastSecond),points.push(first),points.push(second);const closedPath=[];for(let i=1;i<points.length-2;i+=1){const x0=points[i-1].x,y0=points[i-1].y,x1=points[i].x,y1=points[i].y,x2=points[i+1].x,y2=points[i+1].y,cp1x=x1+(x2-x0)/6,cp1y=y1+(y2-y0)/6,cp2x=x2-((i!==points.length-2?points[i+2].x:x2)-x1)/6,cp2y=y2-((i!==points.length-2?points[i+2].y:y2)-y1)/6;closedPath.push(["C",cp1x,cp1y,cp2x,cp2y,x2,y2])}return closedPath.unshift(["M",last.x,last.y]),closedPath};function roundedHull(polyPoints,padding){if(!polyPoints||polyPoints.length<1)return"";if(1===polyPoints.length)return(points=>{const p1=[points[0][0],points[0][1]-padding],p2=[points[0][0],points[0][1]+padding];return[["M",p1],["A",padding,padding,0,0,0,p2],["A",padding,padding,0,0,0,p1]]})(polyPoints);if(2===polyPoints.length)return(points=>{const offsetVector=vec2_scale([0,0],unitNormal(points[0],points[1]),padding),invOffsetVector=vec2_scale([0,0],offsetVector,-1),p0=vec2_add([0,0],points[0],offsetVector),p1=vec2_add([0,0],points[1],offsetVector),p2=vec2_add([0,0],points[1],invOffsetVector),p3=vec2_add([0,0],points[0],invOffsetVector);return`M ${p0} L ${p1} A ${[padding,padding,"0,0,0",p2].join(",")} L ${p3} A ${[padding,padding,"0,0,0",p0].join(",")}`})(polyPoints);let segments=new Array(polyPoints.length);for(let segmentIndex=0;segmentIndex<segments.length;++segmentIndex){const p0=0===segmentIndex?polyPoints[polyPoints.length-1]:polyPoints[segmentIndex-1],p1=polyPoints[segmentIndex],offset=vec2_scale([0,0],unitNormal(p0,p1),padding);segments[segmentIndex]=[vec2_add([0,0],p0,offset),vec2_add([0,0],p1,offset)]}const arcData=`A ${[padding,padding,"0,0,0,"].join(",")}`;return segments=segments.map(((segment,index)=>{let pathFragment="";return 0===index&&(pathFragment=`M ${segments[segments.length-1][1]} `),pathFragment+=`${arcData+segment[0]} L ${segment[1]}`,pathFragment})),segments.join(" ")}const unitNormal=(p0,p1)=>{const n=[p0[1]-p1[1],p1[0]-p0[0]],nLength=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===nLength)throw new Error("p0 should not be equal to p1");return[n[0]/nLength,n[1]/nLength]},vecFrom=(p0,p1)=>[p1[0]-p0[0],p1[1]-p0[1]],vecScaleTo=(v,length)=>vec2_scale([0,0],vec2_normalize([0,0],v),length),pointLineSquareDist=(point,line)=>{const x1=line.x1,y1=line.y1,x2=line.x2-x1,y2=line.y2-y1;let projlenSq,px=point.x-x1,py=point.y-y1,dotprod=px*x2+py*y2;dotprod<=0?projlenSq=0:(px=x2-px,py=y2-py,dotprod=px*x2+py*y2,projlenSq=dotprod<=0?0:dotprod*dotprod/(x2*x2+y2*y2));let lenSq=px*px+py*py-projlenSq;return lenSq<0&&(lenSq=0),lenSq};class LineStructure{constructor(x1,y1,x2,y2){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2}getBBox(){const minX=Math.min(this.x1,this.x2),minY=Math.min(this.y1,this.y2),maxX=Math.max(this.x1,this.x2),maxY=Math.max(this.y1,this.y2);return{min:[minX,minY],max:[maxX,maxY],center:[(minX+maxX)/2,(minY+maxY)/2],halfExtents:[(maxX-minX)/2,(maxY-minY)/2]}}}const squareDist=(a,b)=>Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),fractionToLine=(graph,itemId,line)=>{const directions=["top","left","bottom","right"],bbox=graph.getRenderBBox(itemId);if(!bbox)return 1/0;let minDistance=Number.POSITIVE_INFINITY,countIntersections=0;for(let i=0;i<4;i++){const[x1,y1,x2,y2]=getBBoxBoundLine(bbox,directions[i]);let testDistance=fractionAlongLineA(line,new LineStructure(x1,y1,x2,y2));testDistance=Math.abs(testDistance-.5),testDistance>=0&&testDistance<=1&&(countIntersections+=1,minDistance=testDistance<minDistance?testDistance:minDistance)}return 0===countIntersections?-1:minDistance},getBBoxBoundLine=(bbox,direction)=>({top:[bbox.min[0],bbox.min[1],bbox.max[0],bbox.min[1]],left:[bbox.min[0],bbox.min[1],bbox.min[0],bbox.max[1]],bottom:[bbox.min[0],bbox.max[1],bbox.max[0],bbox.max[1]],right:[bbox.max[0],bbox.min[1],bbox.max[0],bbox.max[1]]}[direction]),fractionAlongLineA=(la,lb)=>{const uaT=(lb.x2-lb.x1)*(la.y1-lb.y1)-(lb.y2-lb.y1)*(la.x1-lb.x1),ubT=(la.x2-la.x1)*(la.y1-lb.y1)-(la.y2-la.y1)*(la.x1-lb.x1),uB=(lb.y2-lb.y1)*(la.x2-la.x1)-(lb.x2-lb.x1)*(la.y2-la.y1);if(uB){const ua=uaT/uB,ub=ubT/uB;if(ua>=0&&ua<=1&&ub>=0&&ub<=1)return ua}return Number.POSITIVE_INFINITY},isPointsOverlap=(p1,p2,e=.001)=>Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2)<Math.pow(e,2),itemIntersectByLine=(graph,itemId,line)=>{const directions=["top","left","bottom","right"],bbox=graph.getRenderBBox(itemId);if(!bbox)return;let countIntersections=0;const intersections=[];for(let i=0;i<4;i++){const[x1,y1,x2,y2]=getBBoxBoundLine(bbox,directions[i]);intersections[i]=getLineIntersect({x:line.x1,y:line.y1},{x:line.x2,y:line.y2},{x:x1,y:y1},{x:x2,y:y2}),intersections[i]&&(countIntersections+=1)}return[intersections,countIntersections]},pointRectSquareDist=(point,rect)=>{const isLeft=point.x<rect.x,isRight=point.x>rect.x+rect.width,isTop=point.y>rect.y+rect.height,isBottom=point.y<rect.y;if(!(isLeft||isRight||isTop||isBottom))return 0;if(isTop&&!isLeft&&!isRight)return Math.pow(rect.y+rect.height-point.y,2);if(isBottom&&!isLeft&&!isRight)return Math.pow(point.y-rect.y,2);if(isLeft&&!isTop&&!isBottom)return Math.pow(rect.x-point.x,2);if(isRight&&!isTop&&!isBottom)return Math.pow(rect.x+rect.width-point.x,2);const dx=Math.min(Math.abs(rect.x-point.x),Math.abs(rect.x+rect.width-point.x)),dy=Math.min(Math.abs(rect.y-point.y),Math.abs(rect.y+rect.height-point.y));return dx*dx+dy*dy},convexHull_cross=(a,b,o)=>(a.y-o.y)*(b.x-o.x)-(a.x-o.x)*(b.y-o.y),genConvexHull=models=>{const points=models.map((model=>({x:model.data.x,y:model.data.y})));points.sort(((a,b)=>a.x===b.x?a.y-b.y:a.x-b.x));const pointMap={};for(let i=points.length-1;i>=0;i--){const{x,y}=points[i];pointMap[`${x}-${y}`]&&points.splice(i,1),pointMap[`${x}-${y}`]=!0}if(1===points.length)return points;const lower=[];for(let i=0;i<points.length;i++){for(;lower.length>=2&&convexHull_cross(lower[lower.length-2],lower[lower.length-1],points[i])<=0;)lower.pop();lower.push(points[i])}const upper=[];for(let i=points.length-1;i>=0;i--){for(;upper.length>=2&&convexHull_cross(upper[upper.length-2],upper[upper.length-1],points[i])<=0;)upper.pop();upper.push(points[i])}upper.pop(),lower.pop();return lower.concat(upper)},defaultOps={maxRoutingIterations:100,maxMarchingIterations:100,pixelGroupSize:2,edgeR0:10,edgeR1:10,nodeR0:5,nodeR1:10,morphBuffer:5,threshold:.001,skip:16,nodeInfluenceFactor:1,edgeInfluenceFactor:1,negativeNodeInfluenceFactor:-.5};function MarchingSquares(contour,potentialArea,threshold){let marched=!1;const getVal=(x,y)=>potentialArea.cells[x+y*potentialArea.width],getState=(x,y)=>{let squareVal=0;return getVal(x-1,y-1)>=threshold&&(squareVal+=1),getVal(x,y-1)>threshold&&(squareVal+=2),getVal(x-1,y)>threshold&&(squareVal+=4),getVal(x,y)>threshold&&(squareVal+=8),squareVal},doMarch=(xPos,yPos)=>{let prevX,prevY,x=xPos,y=yPos;for(let i=0;i<potentialArea.width*potentialArea.height;i++){if(prevX=x,prevY=y,contour.findIndex((item=>item.x===x&&item.y===y))>-1){if(contour[0].x===x&&contour[0].y===y)return!0}else contour.push({x,y});const state=getState(x,y);switch(state){case-1:return console.warn("Marched out of bounds"),!0;case 0:case 3:case 2:case 7:x++;break;case 12:case 14:case 4:x--;break;case 6:0===prevX&&(-1===prevY?x-=1:x+=1);break;case 1:case 13:case 5:y--;break;case 9:1===prevX&&(0===prevY?y-=1:y+=1);break;case 10:case 8:case 11:y++;break;default:return console.warn(`Marching squares invalid state: ${state}`),!0}}};this.march=()=>{for(let x=0;x<potentialArea.width&&!marched;x+=1)for(let y=0;y<potentialArea.height&&!marched;y+=1)getVal(x,y)>threshold&&15!==getState(x,y)&&(marched=doMarch(x,y));return marched}}const getIntersectItem=(graph,items,line)=>{let minDistance=Number.POSITIVE_INFINITY,closestItem=null;return items.forEach((item=>{const distance=fractionToLine(graph,item.id,line);distance>=0&&distance<minDistance&&(closestItem=item,minDistance=distance)})),closestItem};function getRoute(graph,currentModel,nonMembers,visited,maxRoutingIterations,morphBuffer){const optimalNeighbor=((graph,model,visited,nonMembers)=>{let closestNeighbor=null,minCost=Number.POSITIVE_INFINITY;return visited.forEach((neighborModel=>{const itemP={x:model.data.x,y:model.data.y},neighborItemP={x:neighborModel.data.x,y:neighborModel.data.y},dist=squareDist(itemP,neighborItemP),directLine=new LineStructure(itemP.x,itemP.y,neighborItemP.x,neighborItemP.y),numberObstacles=nonMembers.reduce(((count,_item)=>fractionToLine(graph,_item.id,directLine)>0?count+1:count),0);dist*Math.pow(numberObstacles+1,2)<minCost&&(closestNeighbor=neighborModel,minCost=dist*Math.pow(numberObstacles+1,2))})),closestNeighbor})(graph,currentModel,visited,nonMembers);if(null===optimalNeighbor)return[];const directLine=new LineStructure(currentModel.data.x,currentModel.data.y,optimalNeighbor.data.x,optimalNeighbor.data.y),checkedLines=((graph,directLine,nonMembers,maxRoutingIterations,morphBuffer)=>{const checkedLines=[],linesToCheck=[];linesToCheck.push(directLine);let hasIntersection=!0,iterations=0;const pointExists=(point,lines)=>{let flag=!1;return lines.forEach((line=>{flag||(isPointsOverlap(point,{x:line.x1,y:line.y1})||isPointsOverlap(point,{x:line.x2,y:line.y2}))&&(flag=!0)})),flag},isPointInNonMembers=(graph,point,_nonMembers)=>{for(const model of _nonMembers){const bbox=graph.getRenderBBox(model.id);if(!bbox)continue;const[x,y]=bbox.min,itemContour=[[x,y],[bbox.max[0],y],[x,bbox.max[1]],[bbox.max[0],bbox.max[1]]];if(isPointInPolygon(itemContour,point.x,point.y))return!0}return!1};for(;hasIntersection&&iterations<maxRoutingIterations;)for(hasIntersection=!1;!hasIntersection&&linesToCheck.length;){const line=linesToCheck.pop(),closestItem=getIntersectItem(graph,nonMembers,line);if(closestItem){const[intersections,countIntersections]=itemIntersectByLine(graph,closestItem.id,line);if(2===countIntersections){const testReroute=isFirst=>{let tempMorphBuffer=morphBuffer,virtualNode=rerouteLine(closestItem,tempMorphBuffer,intersections,isFirst),exist=pointExists(virtualNode,linesToCheck)||pointExists(virtualNode,checkedLines),pointInside=isPointInNonMembers(graph,virtualNode,nonMembers);for(;!exist&&pointInside&&tempMorphBuffer>=1;)tempMorphBuffer/=1.5,virtualNode=rerouteLine(closestItem,tempMorphBuffer,intersections,isFirst),exist=pointExists(virtualNode,linesToCheck)||pointExists(virtualNode,checkedLines),pointInside=isPointInNonMembers(graph,virtualNode,nonMembers);!virtualNode||exist||isFirst&&pointInside||(linesToCheck.push(new LineStructure(line.x1,line.y1,virtualNode.x,virtualNode.y)),linesToCheck.push(new LineStructure(virtualNode.x,virtualNode.y,line.x2,line.y2)),hasIntersection=!0)};testReroute(!0),hasIntersection||testReroute(!1)}}hasIntersection||checkedLines.push(line),iterations+=1}for(;linesToCheck.length;)checkedLines.push(linesToCheck.pop());return checkedLines})(graph,directLine,nonMembers,maxRoutingIterations,morphBuffer),finalRoute=(checkedLines=>{const finalRoute=[];for(;checkedLines.length>0;){const line1=checkedLines.pop();if(0===checkedLines.length){finalRoute.push(line1);break}const line2=checkedLines.pop(),mergeLine=new LineStructure(line1.x1,line1.y1,line2.x2,line2.y2);getIntersectItem(graph,nonMembers,mergeLine)?(finalRoute.push(line1),checkedLines.push(line2)):checkedLines.push(mergeLine)}return finalRoute})(checkedLines);return finalRoute}const genBubbleSet=(graph,members,nonMembers,ops)=>{const options=Object.assign(defaultOps,ops),centroid=(points=>{let centerX=0,centerY=0;if(points.length>0){for(const point of points)centerX+=point.x,centerY+=point.y;centerX/=points.length,centerY/=points.length}return{x:centerX,y:centerY}})(members.map((model=>({x:model.data.x,y:model.data.y}))));members=members.sort(((a,b)=>squareDist({x:a.data.x,y:a.data.y},centroid)-squareDist({x:b.data.x,y:b.data.y},centroid)));const visited=[],virtualEdges=[];members.forEach((model=>{getRoute(graph,model,nonMembers,visited,options.maxRoutingIterations,options.morphBuffer).forEach((l=>{virtualEdges.push(l)})),visited.push(model)}));const activeRegion=function getActiveRegion(graph,members,edges,offset){const activeRegion={min:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,0],max:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,0],halfExtents:[0,0,0]},bboxes=[];members.forEach((model=>{bboxes.push(graph.getRenderBBox(model.id))})),edges.forEach((l=>{bboxes.push(l.getBBox())}));for(const bbox of bboxes)activeRegion.min[0]=(bbox.min[0]<activeRegion.min[0]?bbox.min[0]:activeRegion.min[0])-offset,activeRegion.min[1]=(bbox.min[1]<activeRegion.min[1]?bbox.min[1]:activeRegion.min[1])-offset,activeRegion.max[0]=(bbox.max[0]>activeRegion.max[0]?bbox.max[0]:activeRegion.max[0])+offset,activeRegion.max[1]=(bbox.max[1]>activeRegion.max[1]?bbox.max[1]:activeRegion.max[1])+offset;return activeRegion.halfExtents=[(activeRegion.max[0]-activeRegion.min[0])/2,(activeRegion.max[1]-activeRegion.min[1])/2,0],activeRegion}(graph,members,virtualEdges,options.nodeR0),potentialArea=((width,height,pixelGroupSize)=>{const scaleWidth=Math.ceil(width/pixelGroupSize),scaleHeight=Math.ceil(height/pixelGroupSize);return{cells:new Float32Array(Math.max(0,scaleWidth*scaleHeight)).fill(0),width:scaleWidth,height:scaleHeight}})(activeRegion.max[0]-activeRegion.min[0],activeRegion.max[1]-activeRegion.min[1],options.pixelGroupSize);let contour=[],hull=[];for(let iterations=0;iterations<options.maxMarchingIterations;iterations++){if(fillPotentialArea(graph,members,nonMembers,virtualEdges,activeRegion,potentialArea,options),contour=[],hull=[],!new MarchingSquares(contour,potentialArea,options.threshold).march())continue;const marchedPath=contour.map((point=>({x:Math.round(point.x*options.pixelGroupSize+activeRegion.min[0]),y:Math.round(point.y*options.pixelGroupSize+activeRegion.min[1])})));if(marchedPath){let size=marchedPath.length;if(options.skip>1)for(size=Math.floor(marchedPath.length/options.skip);size<3&&options.skip>1;)options.skip-=1,size=Math.floor(marchedPath.length/options.skip);for(let i=0,j=0;j<size;j+=1,i+=options.skip)hull.push({x:marchedPath[i].x,y:marchedPath[i].y})}const isContourValid=()=>{for(const model of members){const hullPoints=hull.map((point=>[point.x,point.y])),nodeBBox=graph.getRenderBBox(model.id);if(nodeBBox&&!isPointInPolygon(hullPoints,nodeBBox.center[0],nodeBBox.center[1]))return!1}return!0};if(hull&&isContourValid())return hull;if(options.threshold*=.9,iterations<=.5*options.maxMarchingIterations)options.memberInfluenceFactor*=1.2,options.edgeInfluenceFactor*=1.2;else{if(!(0!==options.nonMemberInfluenceFactor&&nonMembers.length>0))break;options.nonMemberInfluenceFactor*=.8}}return hull};function fillPotentialArea(graph,members,nonMembers,edges,activeRegion,potentialArea,options){function pos2GridIx(x,offset){const gridIx=Math.floor((x-offset)/options.pixelGroupSize);return gridIx<0?0:gridIx}function gridIx2Pos(x,offset){return x*options.pixelGroupSize+offset}const nodeInfA=(options.nodeR0-options.nodeR1)*(options.nodeR0-options.nodeR1),edgeInfA=(options.edgeR0-options.edgeR1)*(options.edgeR0-options.edgeR1),getAffectedRegion=(bbox,thresholdR)=>[Math.min(pos2GridIx(bbox.min[0],thresholdR+activeRegion.min[0]),potentialArea.width),Math.min(pos2GridIx(bbox.min[1],thresholdR+activeRegion.min[1]),potentialArea.height),Math.min(pos2GridIx(bbox.max[0],-thresholdR+activeRegion.min[0]),potentialArea.width),Math.min(pos2GridIx(bbox.max[1],-thresholdR+activeRegion.min[1]),potentialArea.height)],addItemInfluence=(graph,model,influenceFactor)=>{const bbox=graph.getRenderBBox(model.id);if(!bbox)return;const[startX,startY,endX,endY]=getAffectedRegion(bbox,options.nodeR1);for(let y=startY;y<endY;y+=1)for(let x=startX;x<endX;x+=1){if(influenceFactor<0&&potentialArea[x+y*potentialArea.width]<=0)continue;const tempX=gridIx2Pos(x,activeRegion.min[0]),tempY=gridIx2Pos(y,activeRegion.min[1]),distanceSq=pointRectSquareDist({x:tempX,y:tempY},{x:bbox.min[0],y:bbox.min[1],width:bbox.max[0]-bbox.min[0],height:bbox.max[1]-bbox.min[1]});if(distanceSq<Math.pow(options.nodeR1,2)){const dr=Math.sqrt(distanceSq)-options.nodeR1;potentialArea.cells[x+y*potentialArea.width]+=influenceFactor*dr*dr}}};options.nodeInfluenceFactor&&members.forEach((item=>{addItemInfluence(graph,item,options.nodeInfluenceFactor/nodeInfA)})),options.edgeInfluenceFactor&&edges.forEach((edge=>{((line,influenceFactor)=>{const bbox=line.getBBox(),[startX,startY,endX,endY]=getAffectedRegion(bbox,options.edgeR1);for(let y=startY;y<endY;y+=1)for(let x=startX;x<endX;x+=1){if(influenceFactor<0&&potentialArea.cells[x+y*potentialArea.width]<=0)continue;const tempX=gridIx2Pos(x,activeRegion.min[0]),tempY=gridIx2Pos(y,activeRegion.min[1]),minDistanceSq=pointLineSquareDist({x:tempX,y:tempY},line);if(minDistanceSq<Math.pow(options.edgeR1,2)){const mdr=Math.sqrt(minDistanceSq)-options.edgeR1;potentialArea.cells[x+y*potentialArea.width]+=influenceFactor*mdr*mdr}}})(edge,options.edgeInfluenceFactor/edgeInfA)})),options.negativeNodeInfluenceFactor&&nonMembers.forEach((item=>{addItemInfluence(graph,item,options.negativeNodeInfluenceFactor/nodeInfA)}))}function rerouteLine(item,buffer,intersections,wrapNormal){const bbox=item.getBBox(),[topIntersect,leftIntersect,bottomIntersect,rightIntersect]=intersections,cornerPos={topLeft:{x:bbox.minX-buffer,y:bbox.minY-buffer},topRight:{x:bbox.maxX+buffer,y:bbox.minY-buffer},bottomLeft:{x:bbox.minX-buffer,y:bbox.maxY+buffer},bottomRight:{x:bbox.maxX+buffer,y:bbox.maxY+buffer}},totalArea=bbox.height*bbox.width;function calcHalfArea(intersect1,intersect2){return bbox.width*(.5*(intersect1.y-bbox.minY+(intersect2.y-bbox.minY)))}if(leftIntersect){if(topIntersect)return wrapNormal?cornerPos.topLeft:cornerPos.bottomRight;if(bottomIntersect)return wrapNormal?cornerPos.bottomLeft:cornerPos.topRight;return calcHalfArea(leftIntersect,rightIntersect)<.5*totalArea?leftIntersect.y>rightIntersect.y?wrapNormal?cornerPos.topLeft:cornerPos.bottomRight:wrapNormal?cornerPos.topRight:cornerPos.bottomLeft:leftIntersect.y<rightIntersect.y?wrapNormal?cornerPos.bottomLeft:cornerPos.topRight:wrapNormal?cornerPos.bottomRight:cornerPos.topLeft}if(rightIntersect){if(topIntersect)return wrapNormal?cornerPos.topRight:cornerPos.bottomLeft;if(bottomIntersect)return wrapNormal?cornerPos.bottomRight:cornerPos.topLeft}return calcHalfArea(topIntersect,bottomIntersect)<.5*totalArea?topIntersect.x>bottomIntersect.x?wrapNormal?cornerPos.topLeft:cornerPos.bottomRight:wrapNormal?cornerPos.bottomLeft:cornerPos.topRight:topIntersect.x<bottomIntersect.x?wrapNormal?cornerPos.topRight:cornerPos.bottomLeft:wrapNormal?cornerPos.bottomRight:cornerPos.topLeft}var hullComponent_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class hullComponent_Hull{constructor(graph,options){const{members:memberIds=[],nonMembers:nonMemberIds=[]}=options;this.options=options,this.graph=graph,this.members=memberIds.map((id=>graph.getNodeData(id)||graph.getComboData(id))),this.nonMembers=nonMemberIds.map((id=>graph.getNodeData(id)||graph.getComboData(id))),this.setPadding(),this.setType(),this.path=this.getPath(this.members,this.nonMembers),this.render()}getDefaultCfg(){return{id:"g6-hull",type:"round-convex",members:[],nonMembers:[]}}setPadding(){let nodeSize=30;if(this.members.length){const firstBBox=this.graph.getRenderBBox(this.members[0].id);firstBBox&&(nodeSize=firstBBox.halfExtents[0])}this.padding=this.options.padding>0?this.options.padding+nodeSize:10+nodeSize,this.bubbleCfg=Object.assign(Object.assign({},this.options.bubbleCfg),{nodeR0:this.padding-nodeSize,nodeR1:this.padding-nodeSize,morphBuffer:this.padding-nodeSize})}setType(){this.type=this.options.type,this.members.length<3&&(this.type="round-convex"),"round-convex"!==this.type&&"smooth-convex"!==this.type&&"bubble"!==this.type&&(console.warn("The hull type should be either round-convex, smooth-convex or bubble, round-convex is used by default."),this.type="round-convex")}getPath(members,nonMembers){let contour,path,hull;switch(this.type){case"round-convex":contour=genConvexHull(members),hull=roundedHull(contour.map((p=>[p.x,p.y])),this.padding),path=hull;break;case"smooth-convex":contour=genConvexHull(members),2===contour.length?(hull=roundedHull(contour.map((p=>[p.x,p.y])),this.padding),path=hull):contour.length>2&&(hull=function paddedHull(polyPoints,padding){const pointCount=polyPoints.length;if(!polyPoints||pointCount<1)return"";if(1===pointCount)return(points=>{const p1=[points[0][0],points[0][1]-padding],p2=[points[0][0],points[0][1]+padding];return`M ${p1} A ${[padding,padding,"0,0,0",p2].join(",")} A ${[padding,padding,"0,0,0",p1].join(",")}`})(polyPoints);if(2===pointCount)return(points=>{const v=vecFrom(points[0],points[1]),extensionVec=vecScaleTo(v,padding),extension0=vec2_add([0,0],points[0],vec2_scale([0,0],extensionVec,-1)),extension1=vec2_add([0,0],points[1],extensionVec),tangentHalfLength=1.2*padding,controlDelta=vecScaleTo(vec2_normalize([0,0],v),tangentHalfLength),invControlDelta=vec2_scale([0,0],controlDelta,-1),control0=vec2_add([0,0],extension0,invControlDelta),control1=vec2_add([0,0],extension1,invControlDelta),control3=vec2_add([0,0],extension0,controlDelta);return`M ${extension0} C ${[control0,control1,extension1].join(",")} S ${[control3,extension0].join(",")} Z`})(polyPoints);const hullPoints=polyPoints.map(((point,index)=>{const pNext=polyPoints[(index+1)%pointCount];return{p:point,v:vec2_normalize([0,0],vecFrom(point,pNext))}}));for(let i=0;i<hullPoints.length;++i){const extensionVec=vec2_normalize([0,0],vec2_add([0,0],hullPoints[i>0?i-1:pointCount-1].v,vec2_scale([0,0],hullPoints[i].v,-1)));hullPoints[i].p=vec2_add([0,0],hullPoints[i].p,vec2_scale([0,0],extensionVec,padding))}return hullPoints.map((obj=>{const point=obj.p;return{x:point[0],y:point[1]}}))}(contour.map((p=>[p.x,p.y])),this.padding),path=getClosedSpline(hull));break;case"bubble":contour=genBubbleSet(this.graph,members,nonMembers,this.bubbleCfg),path=contour.length>=2&&getClosedSpline(contour)}return path}render(){if(!this.path)return;const shape=this.graph.drawTransient("path",this.options.id,{style:Object.assign({path:this.path,pointerEvents:"none"},this.options.style)}),{labelShape}=this.options;if(null==labelShape?void 0:labelShape.text){const shapeBounds=shape.getRenderBounds(),{position,offsetX,offsetY}=labelShape,labelShapeStyle=hullComponent_rest(labelShape,["position","offsetX","offsetY"]),formattedLabelStyle=this.getLabelStyle(labelShape,shapeBounds);this.graph.drawTransient("text",`${this.options.id}-label`,{style:Object.assign(Object.assign({pointerEvents:"none"},labelShapeStyle),formattedLabelStyle)})}shape.toBack(),this.hullShape=shape}getLabelStyle(propsStyle,keyShapeBounds){const{position,offsetX=0,offsetY=0,autoRotate=!0}=propsStyle,{min,max,center}=keyShapeBounds,style={x:0,y:0,textAlign:"center",textBaseline:"middle"},point={x:0,y:0};switch(position){case"bottom":case"outside-bottom":point.x=(min[0]+max[0])/2,point.y=max[1],style.textBaseline="bottom";break;case"left":case"outside-left":point.x=min[0],point.y=(min[1]+max[1])/2,style.textAlign="left";break;case"right":case"outside-right":point.x=max[0],point.y=(min[1]+max[1])/2,style.textAlign="right";break;default:point.x=(min[0]+max[0])/2,point.y=min[1],style.textBaseline="top"}let startPoint;const points=pathToPoints(this.path);if("bubble"===this.type)switch(position){case"bottom":startPoint={x:center[0],y:max[0]+10};break;case"left":startPoint={x:max[0]+10,y:center[1]};break;case"right":startPoint={x:min[0]-10,y:center[1]};break;default:startPoint={x:center[0],y:max[1]-10}}else startPoint={x:center[0],y:center[1]};const intersect=((polygonPoints,line)=>{const polygonPointsLength=polygonPoints.length,lineMap={};for(let i=0;i<polygonPointsLength-1;i++){const start={x:polygonPoints[i][0],y:polygonPoints[i][1]},end={x:polygonPoints[i+1][0],y:polygonPoints[i+1][1]};if(start.x===end.x&&start.y===end.y)continue;const key=`${start.x}-${start.y}-${end.x}-${end.y}`;if(lineMap[key])continue;lineMap[key]=!0;const intersect=getLineIntersect(start,end,line[0],line[1]);if(intersect)return{point:intersect,line:[start,end]}}})(points,[startPoint,((point1,point2,diff)=>{const k=(point2.y-point1.y)/(point2.x-point1.x);if(Math.abs(k)===1/0)return{x:point1.x,y:point2.y>point1.y?point1.y-diff:point1.y+diff};if(0===k)return{x:point2.x>point1.x?point1.x-diff:point1.x+diff,y:point2.y};const b=point1.y-k*point1.x,diffSign=point2.x>point1.x?-1:1,extendedX=point1.x+diffSign*diff;return{x:extendedX,y:k*extendedX+b}})(point,startPoint,100)]);if(intersect){const{point:intersectPoint,line}=intersect;if(style.x=intersectPoint.x+offsetX,style.y=intersectPoint.y+offsetY,autoRotate){const angle=Math.atan((line[0].y-line[1].y)/(line[0].x-line[1].x));style.transform=`rotate(${angle/Math.PI*180}deg)`,style.textAlign="center","right"!==position&&"left"!==position||(style.textBaseline=angle>0?"right"===position?"top":"bottom":"right"===position?"bottom":"top")}}else style.x=point.x+offsetX,style.y=point.y+offsetY;return"outside"===position.split("-")[0]&&(style.textBaseline=(baseline=>{switch(baseline){case"top":return"bottom";case"bottom":return"top";case"left":return"right";default:return"left"}})(style.textBaseline)),style}addMember(itemIds){if(!itemIds)return;const idArr=(0,is_array.A)(itemIds)?itemIds:[itemIds];let shouldUpdate=!1;return idArr.forEach((id=>{const model=this.graph.getNodeData(id)||this.graph.getComboData(id);-1===this.members.indexOf(model)&&(this.members.push(model),shouldUpdate=!0);const nonMemberIdx=this.nonMembers.indexOf(model);nonMemberIdx>-1&&(this.nonMembers.splice(nonMemberIdx,1),shouldUpdate=!0)})),shouldUpdate&&this.updateMembers(this.members.map((model=>model.id)),this.nonMembers.map((model=>model.id))),!1}addNonMember(itemIds){if(!itemIds)return;const idArr=(0,is_array.A)(itemIds)?itemIds:[itemIds];let shouldUpdate=!1;return idArr.forEach((id=>{const model=this.graph.getNodeData(id)||this.graph.getComboData(id);-1===this.nonMembers.indexOf(model)&&(this.nonMembers.push(model),shouldUpdate=!0);const memberIdx=this.members.indexOf(model);memberIdx>-1&&(this.members.splice(memberIdx,1),shouldUpdate=!0)})),!!shouldUpdate&&(this.updateMembers(this.members.map((model=>model.id)),this.nonMembers.map((model=>model.id))),!0)}removeMember(itemIds){if(!itemIds)return;const idArr=(0,is_array.A)(itemIds)?itemIds:[itemIds];let removed=!1;return idArr.forEach((id=>{const index=this.members.findIndex((member=>member.id===id));index>-1&&(this.members.splice(index,1),removed=!0)})),!!removed&&(this.updateMembers(this.members.map((model=>model.id)),this.nonMembers.map((model=>model.id))),!0)}removeNonMember(itemIds){if(!itemIds)return;const idArr=(0,is_array.A)(itemIds)?itemIds:[itemIds];let removed=!1;return idArr.forEach((id=>{const model=this.graph.getNodeData(id)||this.graph.getComboData(id),index=this.nonMembers.indexOf(model);index>-1&&(this.nonMembers.splice(index,1),removed=!0)})),!!removed&&(this.updateMembers(this.members.map((model=>model.id)),this.nonMembers.map((model=>model.id))),!0)}updateMembers(memberIds,nonMemberIds){memberIds&&(this.options.members=memberIds,this.members=memberIds.map((id=>this.graph.getNodeData(id)||this.graph.getComboData(id)))),nonMemberIds&&(this.options.nonMembers=nonMemberIds,this.nonMembers=nonMemberIds.map((id=>this.graph.getNodeData(id)||this.graph.getComboData(id)))),this.path=this.getPath(this.members,this.nonMembers),this.render()}updateStyle(style){this.graph.drawTransient("path",this.options.id,{style:Object.assign(Object.assign({},style),{pointerEvents:"none"})})}updateOptions(options){const{members:memberIds,nonMembers:nonMemberIds}=options;this.options=Object.assign(Object.assign(Object.assign({},this.options),options),{style:Object.assign(Object.assign({},this.options.style),options.style),labelShape:Object.assign(Object.assign({},this.options.labelShape),options.labelShape)}),memberIds&&(this.members=memberIds.map((id=>this.graph.getNodeData(id)||this.graph.getComboData(id)))),nonMemberIds&&(this.nonMembers=nonMemberIds.map((id=>this.graph.getNodeData(id)||this.graph.getComboData(id)))),this.setPadding(),this.setType(),this.path=this.getPath(this.members,this.nonMembers),this.render()}contain(itemId){let shapePoints;const shapeBBox=this.graph.getRenderBBox(itemId);if(shapeBBox)return shapePoints=[[shapeBBox.min[0],shapeBBox.min[1]],[shapeBBox.max[0],shapeBBox.min[1]],[shapeBBox.max[0],shapeBBox.max[1]],[shapeBBox.min[0],shapeBBox.max[1]]],shapePoints=shapePoints.map((canvasPoint=>{const point=this.graph.getPointByCanvas(canvasPoint[0],canvasPoint[1]);return[point.x,point.y]})),isPolygonsIntersect(shapePoints,pathToPoints(this.path));console.warn(`The item with ${itemId} is not existed in the graph.`)}destroy(){this.graph.drawTransient("path",this.options.id,{action:"remove"})}}var hull_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};var watermarker_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},watermarker_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const{ValidateData:stdlib_ValidateData,TransformV4Data:stdlib_TransformV4Data,MapNodeSize:stdlib_MapNodeSize,ProcessParallelEdges:stdlib_ProcessParallelEdges}=stdlib_data_namespaceObject,{compactBox,dendrogram,indented,mindmap}=hierarchy_default(),{DarkTheme:stdlib_DarkTheme,LightTheme:stdlib_LightTheme}=theme_namespaceObject,{SpecThemeSolver:stdlib_SpecThemeSolver,SubjectThemeSolver:stdlib_SubjectThemeSolver}=themeSolver_namespaceObject,{CircleNode:stdlib_CircleNode,RectNode:stdlib_RectNode,DiamondNode:stdlib_DiamondNode,DonutNode:stdlib_DonutNode,SphereNode:stdlib_SphereNode,StarNode:stdlib_StarNode,HexagonNode:stdlib_HexagonNode,TriangleNode:stdlib_TriangleNode,EllipseNode:stdlib_EllipseNode,ModelRectNode:stdlib_ModelRectNode,ImageNode:stdlib_ImageNode,CubeNode:stdlib_CubeNode,PlaneNode:stdlib_PlaneNode,BaseNode:stdlib_BaseNode,BaseNode3D:stdlib_BaseNode3D}=node_namespaceObject,{LineEdge:stdlib_LineEdge,CubicEdge:stdlib_CubicEdge,CubicHorizontalEdge:stdlib_CubicHorizontalEdge,CubicVerticalEdge:stdlib_CubicVerticalEdge,LoopEdge:stdlib_LoopEdge,PolylineEdge:stdlib_PolylineEdge,QuadraticEdge:stdlib_QuadraticEdge}=edge_namespaceObject,{CircleCombo:stdlib_CircleCombo,RectCombo:stdlib_RectCombo}=combo_namespaceObject,{ActivateRelations:stdlib_ActivateRelations,BrushSelect:stdlib_BrushSelect,HoverActivate:stdlib_HoverActivate,LassoSelect:stdlib_LassoSelect,OrbitCanvas3D:stdlib_OrbitCanvas3D,RotateCanvas3D:stdlib_RotateCanvas3D,TrackCanvas3D:stdlib_TrackCanvas3D,ZoomCanvas3D:stdlib_ZoomCanvas3D,ZoomCanvas:stdlib_ZoomCanvas,DragCanvas:stdlib_DragCanvas,CollapseExpandTree:stdlib_CollapseExpandTree,CollapseExpandCombo:stdlib_CollapseExpandCombo,DragNode:stdlib_DragNode,DragCombo:stdlib_DragCombo,ClickSelect:stdlib_ClickSelect,CreateEdge:stdlib_CreateEdge,ShortcutsCall:stdlib_ShortcutsCall,ScrollCanvas:stdlib_ScrollCanvas}=stdlib_behavior_namespaceObject,{History:stdlib_History,Tooltip:stdlib_Tooltip,Minimap:stdlib_Minimap,Grid:stdlib_Grid,Menu:stdlib_Menu,Fisheye:stdlib_Fisheye,Legend:stdlib_Legend,Toolbar:stdlib_Toolbar,Timebar:stdlib_Timebar,Snapline:stdlib_Snapline,EdgeFilterLens:stdlib_EdgeFilterLens,LodController:stdlib_LodController,EdgeBundling:stdlib_EdgeBundling}=stdlib_plugin_namespaceObject,{ForceLayout,GridLayout,CircularLayout,ConcentricLayout,RandomLayout,MDSLayout,RadialLayout,FruchtermanLayout,D3ForceLayout,ForceAtlas2Layout,DagreLayout,ComboCombinedLayout}=lib_namespaceObject,stdLib={transforms:{"validate-data":stdlib_ValidateData,"transform-v4-data":stdlib_TransformV4Data,"map-node-size":stdlib_MapNodeSize},themes:{light:stdlib_LightTheme,dark:stdlib_DarkTheme},themeSolvers:{spec:stdlib_SpecThemeSolver,subject:stdlib_SubjectThemeSolver},layouts:Object.assign({force:ForceLayout,grid:GridLayout,circular:CircularLayout,concentric:ConcentricLayout},hierarchy_default()),behaviors:{"drag-canvas":stdlib_DragCanvas,"zoom-canvas":stdlib_ZoomCanvas,"drag-node":stdlib_DragNode,"drag-combo":stdlib_DragCombo,"collapse-expand-combo":stdlib_CollapseExpandCombo,"collapse-expand-tree":stdlib_CollapseExpandTree,"click-select":stdlib_ClickSelect},plugins:{history:stdlib_History,"lod-controller":stdlib_LodController},nodes:{"circle-node":stdlib_CircleNode,"rect-node":stdlib_RectNode,"image-node":stdlib_ImageNode},edges:{"line-edge":stdlib_LineEdge,"loop-edge":stdlib_LoopEdge},combos:{"circle-combo":stdlib_CircleCombo,"rect-combo":stdlib_RectCombo},markers:{collapse:(x,y,r)=>[["M",x-r,y],["a",r,r,0,1,0,2*r,0],["a",r,r,0,1,0,2*-r,0],["M",x-r+4,y],["L",x+r-4,y]],expand:(x,y,r)=>[["M",x-r,y],["a",r,r,0,1,0,2*r,0],["a",r,r,0,1,0,2*-r,0],["M",x-r+4,y],["L",x-r+2*r-4,y],["M",x-r+r,y-r+4],["L",x,y+r-4]],upTriangle:(x,y,r)=>{const l1=r*Math.cos(Math.PI/6),l2=r*Math.sin(Math.PI/6);return[["M",x-l1,y+l2],["L",x+l1,y+l2],["L",x,y-r],["Z"]]},downTriangle:(x,y,r)=>{const l1=r*Math.cos(Math.PI/6),l2=r*Math.sin(Math.PI/6);return[["M",x-l1,y-l2],["L",x+l1,y-l2],["L",x,y+r],["Z"]]}}},registry={useLib:{transforms:{},themes:{},layouts:{},behaviors:{},plugins:{},nodes:{},edges:{},combos:{}}},Extensions={ValidateData:stdlib_ValidateData,TransformV4Data:stdlib_TransformV4Data,MapNodeSize:stdlib_MapNodeSize,ProcessParallelEdges:stdlib_ProcessParallelEdges,LightTheme:stdlib_LightTheme,DarkTheme:stdlib_DarkTheme,SpecThemeSolver:stdlib_SpecThemeSolver,SubjectThemeSolver:stdlib_SubjectThemeSolver,ForceLayout,GridLayout,CircularLayout,ConcentricLayout,RandomLayout,MDSLayout,RadialLayout,FruchtermanLayout,D3ForceLayout,ForceAtlas2Layout,DagreLayout,ComboCombinedLayout,compactBox,dendrogram,indented,mindmap,CircleNode:stdlib_CircleNode,RectNode:stdlib_RectNode,DiamondNode:stdlib_DiamondNode,DonutNode:stdlib_DonutNode,SphereNode:stdlib_SphereNode,StarNode:stdlib_StarNode,HexagonNode:stdlib_HexagonNode,TriangleNode:stdlib_TriangleNode,EllipseNode:stdlib_EllipseNode,ModelRectNode:stdlib_ModelRectNode,CubeNode:stdlib_CubeNode,PlaneNode:stdlib_PlaneNode,BaseNode:stdlib_BaseNode,BaseNode3D:stdlib_BaseNode3D,LineEdge:stdlib_LineEdge,CubicEdge:stdlib_CubicEdge,CubicHorizontalEdge:stdlib_CubicHorizontalEdge,CubicVerticalEdge:stdlib_CubicVerticalEdge,LoopEdge:stdlib_LoopEdge,PolylineEdge:stdlib_PolylineEdge,QuadraticEdge:stdlib_QuadraticEdge,CircleCombo:stdlib_CircleCombo,RectCombo:stdlib_RectCombo,BaseBehavior:Behavior,ActivateRelations:stdlib_ActivateRelations,BrushSelect:stdlib_BrushSelect,HoverActivate:stdlib_HoverActivate,LassoSelect:stdlib_LassoSelect,OrbitCanvas3D:stdlib_OrbitCanvas3D,RotateCanvas3D:stdlib_RotateCanvas3D,TrackCanvas3D:stdlib_TrackCanvas3D,ZoomCanvas3D:stdlib_ZoomCanvas3D,ZoomCanvas:stdlib_ZoomCanvas,DragCanvas:stdlib_DragCanvas,CollapseExpandTree:stdlib_CollapseExpandTree,CollapseExpandCombo:stdlib_CollapseExpandCombo,DragNode:stdlib_DragNode,DragCombo:stdlib_DragCombo,CreateEdge:stdlib_CreateEdge,ShortcutsCall:stdlib_ShortcutsCall,ScrollCanvas:stdlib_ScrollCanvas,BasePlugin:plugin_Plugin,History:stdlib_History,LodController:stdlib_LodController,Toolbar:stdlib_Toolbar,Tooltip:stdlib_Tooltip,Minimap:stdlib_Minimap,Grid:stdlib_Grid,Menu:stdlib_Menu,Fisheye:stdlib_Fisheye,Legend:stdlib_Legend,Timebar:stdlib_Timebar,Hull:class Hull extends plugin_Plugin{constructor(options){super(options),this.hullMap={},this.cacheChanges={remove:[],update:[]},this.debounceUpdateMembers=throttle((()=>{Object.keys(this.hullMap).forEach((id=>{const hullComponent=this.hullMap[id];if(this.cacheChanges.remove.length)array_isArrayOverlap(hullComponent.options.members,this.cacheChanges.remove)&&hullComponent.removeMember(this.cacheChanges.remove);else if(this.cacheChanges.update.length){const modelIds=this.cacheChanges.update.map((model=>model.id));array_isArrayOverlap(hullComponent.options.members,modelIds)&&hullComponent.updateMembers()}})),this.cacheChanges={update:[],remove:[]}}),50,{trailing:!0,leading:!0}),this.key=(null==options?void 0:options.key)||`hull-${Math.random()}`}getDefaultCfgs(){return{key:`hull-${unique_id()}`,padding:10,style:{fill:"lightblue",stroke:"blue",opacity:.2},labelShape:Object.assign(Object.assign({},DEFAULT_TEXT_STYLE),{position:"outside-top",offsetY:-2}),hulls:[]}}init(graph){super.init(graph)}getEvents(){return{afteritemchange:this.handleNodesChange,afterrender:this.handleAfterRender}}handleNodesChange(param){const{itemType,models,ids,action}=param;"edge"!==itemType&&"add"!==action&&("remove"===action?this.cacheChanges.remove=this.cacheChanges.remove.concat(ids):this.cacheChanges.update=this.cacheChanges.update.concat(models),this.debounceUpdateMembers())}handleAfterRender(){this.addHull(this.options.hulls)}addHull(options){const{padding,style,bubbleCfg,labelShape}=this.options;((0,is_array.A)(options)?options:[options]).forEach((config=>{const{id,style:singleStyle,labelShape:singleLabelShape,members}=config,others=hull_rest(config,["id","style","labelShape","members"]),validMembers=null==members?void 0:members.filter((memberId=>this.graph.getNodeData(memberId)||this.graph.getComboData(memberId)));if(!(null==validMembers?void 0:validMembers.length))return void console.warn("Create hull failed. There are no valid members.");validMembers.length!==members.length&&console.warn(`Some member of hull ${id} is not exist in the graph. Hull ${id} is added without those invalid members.`);const fullOptions=Object.assign({id:`${this.key}-${id}`,padding,bubbleCfg,style:Object.assign(Object.assign({},style),singleStyle),labelShape:(null==singleLabelShape?void 0:singleLabelShape.text)?Object.assign(Object.assign({},labelShape),singleLabelShape):void 0,members:validMembers},others);this.hullMap[id]?this.updateHull(fullOptions):this.hullMap[id]=new hullComponent_Hull(this.graph,fullOptions)}))}updateHull(options){((0,is_array.A)(options)?options:[options]).forEach((config=>{const{id}=config,others=hull_rest(config,["id"]);this.hullMap[id]?this.hullMap[id].updateOptions(others):console.warn(`Update hull component failed. The bubble with id ${id} is not existed.`)}))}removeHull(ids){((0,is_array.A)(ids)?ids:[ids]).forEach((id=>{this.hullMap[id].destroy(),delete this.hullMap[id]}))}addHullMember(id,members){const hullComponent=this.hullMap[id];hullComponent?hullComponent.addMember(members):console.warn(`Add member to hull failed. The hull with id ${id} is not exist`)}removeHullMember(id,members){const hullComponent=this.hullMap[id];hullComponent?hullComponent.removeMember(members):console.warn(`Remove member from hull failed. The hull with id ${id} is not exist`)}addHullNonMember(id,members){const hullComponent=this.hullMap[id];hullComponent?hullComponent.addNonMember(members):console.warn(`Add non member to hull failed. The hull with id ${id} is not exist`)}removeHullNonMember(id,members){const hullComponent=this.hullMap[id];hullComponent?hullComponent.removeNonMember(members):console.warn(`Remove non member from hull failed. The hull with id ${id} is not exist`)}},Snapline:stdlib_Snapline,EdgeFilterLens:stdlib_EdgeFilterLens,WaterMarker:class WaterMarker extends plugin_Plugin{constructor(options){super(options)}getDefaultCfgs(){return{key:`watermarker-${unique_id()}`,container:null,canvas:void 0,mode:"image",width:void 0,height:void 0,position:"bottom",begin:[0,0],separation:[100,100],image:{imgURL:"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/logo-with-text-73b8a.svg",width:94,height:28,rotate:0},text:{texts:"AntV",rotate:20,fontSize:14,fontFamily:"Microsoft YaHei",fill:"rgba(0, 0, 0, 0.1)",textBaseline:"top"}}}init(graph){super.init(graph);this.initCanvas().then((()=>{this.updateWaterMarker()}))}getEvents(){return{aftersetsize:this.onGraphSetSize}}initCanvas(){const{graph,options}=this,{width,height,position,canvas}=options;let container,parentNode=options.container;const graphSize=graph.getSize();if(canvas)return this.canvas=canvas,this.canvasSize=[graphSize[0],graphSize[1]],this.followGraphSize=!0,this.container=graph.container,canvas.ready;(0,is_string.A)(parentNode)&&(parentNode=document.getElementById(parentNode)),container=parentNode||graph.container,container.style.position||(container.style.position="relative"),this.canvasSize=[void 0===width?graphSize[0]:width,void 0===height?graphSize[1]:height],this.followGraphSize=void 0===width||void 0===height,this.canvas=createCanvas("canvas",container,this.canvasSize[0],this.canvasSize[1]);const $domElement=this.canvas.getContextService().getDomElement();$domElement.style.position="fixed",$domElement.style.outline="none",$domElement.style.pointerEvents="none",$domElement.style.userSelect="none",this.container=container;const canvasEl=this.canvas.getContextService().getDomElement();this.container.removeChild(canvasEl);const graphCanvasDOM=graph.canvas.getContextService().getDomElement(),graphTransientCanvasDOM=graph.transientCanvas.getContextService().getDomElement();switch(position){case"top":this.container.appendChild(canvasEl);break;case"middle":this.container.insertBefore(canvasEl,graphTransientCanvasDOM);break;default:this.container.insertBefore(canvasEl,graphCanvasDOM)}return this.canvas.ready}onGraphSetSize(e){const{size}=e;this.followGraphSize&&(this.canvas.resize(size[0],size[1]),this.updateWaterMarker())}updateWaterMarker(){if("text"===this.options.mode)this.setTextWaterMarker();else this.setImageWaterMarker()}setImageWaterMarker(){const{canvas,options,canvasSize}=this,{image,begin,separation}=options,{imgURL,rotate=0}=image,imageStyles=watermarker_rest(image,["imgURL","rotate"]),currentPosition=[...begin];let imageBounds;const getRowGroup=()=>{const rowGroup=new Group;for(;currentPosition[0]<canvasSize[0];){const imageShape=new index_esm_Image({style:Object.assign(Object.assign({},imageStyles),{img:imgURL,x:currentPosition[0],y:currentPosition[1]})});rotate&&(imageShape.style.transformOrigin="center",imageShape.style.transform=`rotate(${rotate}deg)`),imageBounds||(imageBounds=imageShape.getLocalBounds()),rowGroup.appendChild(imageShape),currentPosition[0]+=2*imageBounds.halfExtents[0]+separation[0]}return rowGroup};for(;currentPosition[1]<canvasSize[1];)canvas.appendChild(getRowGroup()),currentPosition[0]=begin[0],currentPosition[1]+=2*imageBounds.halfExtents[1]+separation[1]}setTextWaterMarker(){return watermarker_awaiter(this,void 0,void 0,(function*(){const{canvas,options,canvasSize}=this,{text,separation,begin}=options,{texts,rotate}=text,textStyles=watermarker_rest(text,["texts","rotate"]),currentPosition=[...begin],textContent=((0,is_string.A)(texts)?[texts]:texts).join("\n");let textBounds;const getRowGroup=()=>{const rowGroup=new Group;for(;currentPosition[0]<canvasSize[0];){const textShape=new Text({style:Object.assign(Object.assign({},textStyles),{text:textContent,x:currentPosition[0],y:currentPosition[1]})});rotate&&(textShape.style.transform=`rotate(${rotate}deg)`),textBounds||(textBounds=textShape.getLocalBounds()),rowGroup.appendChild(textShape),currentPosition[0]+=2*textBounds.halfExtents[0]+separation[0]}return rowGroup};for(;currentPosition[1]<canvasSize[1];)canvas.appendChild(getRowGroup()),currentPosition[0]=begin[0],currentPosition[1]+=2*textBounds.halfExtents[1]+separation[1]}))}destroy(){const{canvas,options}=this;let container;options.container||(container=this.graph.container),(0,is_string.A)(container)&&(container=document.getElementById(container)),container!==this.graph.container&&container.remove(),canvas.destroy()}},EdgeBundling:stdlib_EdgeBundling},stdlib=registry,getExtension=(config,lib,cat)=>{var _a;const catKey=`${cat}s`;if((0,is_function.A)(config))return config;const type="string"==typeof config?config:config.type;return null===(_a=lib[catKey])||void 0===_a?void 0:_a[type]},TREE_BEHAVIORS=["collapse-expand-tree"];function hasTreeBehaviors(behaviors){if(!(null==behaviors?void 0:behaviors.length))return!1;const behaviorTypes=behaviors.map((behavior=>(0,is_string.A)(behavior)?behavior:behavior.type)).filter(Boolean);return array_isArrayOverlap(TREE_BEHAVIORS,behaviorTypes)}var data_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class DataController{constructor(graph){this.extensions=[],this.isTransformActive=(config,changeType)=>{let activeLifecycle=(0,is_object.A)(config)&&"activeLifecycle"in config?config.activeLifecycle:"all";return activeLifecycle=Array.isArray(activeLifecycle)?activeLifecycle:"all"===activeLifecycle?AVAILABLE_DATA_LIFECYCLE:[activeLifecycle],activeLifecycle.includes(dataLifecycleMap[changeType])},this.graph=graph,this.tap()}findData(type,condition){const{graphCore}=this,conditionType=typeof condition,conditionIsArray=(0,is_array.A)(condition);if("string"===conditionType||"number"===conditionType||conditionIsArray){const ids=conditionIsArray?condition:[condition];switch(type){case"node":return ids.map((id=>{if(!graphCore.hasNode(id))return;const model=graphCore.getNode(id);return model.data._isCombo?void 0:model}));case"edge":return ids.map((id=>graphCore.hasEdge(id)?graphCore.getEdge(id):void 0));case"combo":return ids.map((id=>{if(!graphCore.hasNode(id))return;const model=graphCore.getNode(id);return model.data._isCombo?model:void 0}))}}else if("function"===conditionType){return("node"===type?graphCore.getAllNodes:graphCore.getAllEdges)().filter((datum=>condition(datum)))}}findAllData(type){if(!this.graphCore)return[];switch(type){case"node":return this.graphCore.getAllNodes();case"edge":return this.graphCore.getAllEdges();default:return[]}}findRelatedEdges(nodeId,direction="both"){return this.graphCore.getRelatedEdges(nodeId,direction)}findNearEdges(nodeId,itemMap,transientItem,shouldBegin){const edges=this.graphCore.getAllEdges(),canvasBBox=this.graph.getRenderBBox(void 0),quadTree=new QuadTree(canvasBBox,4);edges.forEach((edge=>{const edgeDisplayModel=itemMap.get(edge.id).displayModel;if(!shouldBegin(edgeDisplayModel))return;const{data:{x:sourceX,y:sourceY}}=this.graphCore.getNode(edge.source),{data:{x:targetX,y:targetY}}=this.graphCore.getNode(edge.target);quadTree.insert({id:edge.id,p1:{x:sourceX,y:sourceY},p2:{x:targetX,y:targetY},bbox:this.graph.getRenderBBox(edge.id)})}));const nodeBBox=this.graph.getRenderBBox(nodeId);if(transientItem){const nodeData=transientItem.displayModel.data;nodeData&&nodeBBox.update([nodeData.x,nodeData.y,0],nodeBBox.halfExtents)}return new EdgeCollisionChecker(quadTree).getCollidingEdges(nodeBBox).map((collision=>this.graphCore.getEdge(collision.id)))}findNeighborNodes(nodeId,direction="both"){return"in"===direction?this.graphCore.getAncestors(nodeId):"out"===direction?this.graphCore.getSuccessors(nodeId):this.graphCore.getNeighbors(nodeId)}findChildren(comboId,treeKey){if(this.graphCore.hasNode(comboId))return this.graphCore.getChildren(comboId,treeKey)}tap(){this.extensions=this.getExtensions(),this.graph.hooks.datachange.tap(this.onDataChange.bind(this)),this.graph.hooks.treecollapseexpand.tap(this.onTreeCollapseExpand.bind(this)),this.graph.hooks.layout.tap(this.onLayout.bind(this)),this.graph.hooks.init.tap(this.onGraphInit.bind(this)),this.graph.hooks.behaviorchange.tap(this.onBehaviorChange.bind(this)),this.graph.hooks.modechange.tap(this.onModeChange.bind(this))}getExtensions(){const{transforms=[]}=this.graph.getSpecification();return[...transforms,{type:"validate-data",activeLifecycle:"all"}].map((config=>({config,func:getExtension(config,registry.useLib,"transform")}))).filter((ext=>!!ext.func))}onDataChange(param){const{data,type:changeType}=param,{graphCore}=this,change=()=>{switch(changeType){case"moveCombo":this.moveCombo(data);break;case"addCombo":this.addCombo(data);break;default:this.changeData(data,changeType)}};graphCore?graphCore.batch(change):change()}onTreeCollapseExpand(params){const{ids,action}=params;ids.forEach((id=>{this.graphCore.mergeNodeData(id,{collapsed:"collapse"===action})}))}onLayout({options}){this.treeDirtyFlag&&isTreeLayout(options)&&this.establishGraphCoreTree()}onGraphInit(){const{modes={}}=this.graph.getSpecification();hasTreeBehaviors(modes[this.graph.getMode()||"default"])&&this.establishGraphCoreTree()}onBehaviorChange(param){const{action,modes,behaviors}=param,mode=this.graph.getMode()||"default";"add"===action&&modes.includes(mode)&&hasTreeBehaviors(behaviors)&&this.establishGraphCoreTree()}onModeChange(param){const{modes={}}=this.graph.getSpecification();hasTreeBehaviors(modes[param.mode])&&this.establishGraphCoreTree()}establishGraphCoreTree(){if(!this.treeDirtyFlag)return;const nodes=this.graphCore.getAllNodes(),edges=this.graphCore.getAllEdges(),rootIds=nodes.filter((node=>node.data.isRoot)).map((node=>node.id));graphData2TreeData({},{nodes,edges},rootIds).forEach((tree=>{traverse(tree,(node=>{var _a;null===(_a=node.children)||void 0===_a||_a.forEach((child=>{this.graphCore.setParent(child.id,node.id,"tree")}))}))})),this.treeDirtyFlag=!1}changeData(dataConfig,changeType){var _a;const{type:dataType,data}=this.formatData(dataConfig)||{};if(!dataType)return;this.dataType=dataType;const preprocessedData=this.preprocessData(data,changeType),{dataAdded,dataRemoved,dataUpdated}=this.transformData(preprocessedData,changeType);if("replace"===changeType){const{nodes,edges,combos}=dataAdded;this.graphCore=new graph.T((0,lodash_clone.A)({nodes:nodes.concat((null==combos?void 0:combos.map((combo=>({id:combo.id,data:Object.assign(Object.assign({},combo.data),{_isCombo:!0})}))))||[]),edges})),(null==combos?void 0:combos.length)&&(this.graphCore.attachTreeStructure("combo"),nodes.forEach((node=>{node.data.parentId&&(validateComboStructure(this.graph,node.id,node.data.parentId)?this.graphCore.setParent(node.id,node.data.parentId,"combo"):this.graphCore.mergeNodeData(node.id,{parentId:void 0}))})),combos.forEach((combo=>{combo.data.parentId&&(validateComboStructure(this.graph,combo.id,combo.data.parentId)?this.graphCore.setParent(combo.id,combo.data.parentId,"combo"):this.graphCore.mergeNodeData(combo.id,{parentId:void 0}))})))}else this.doRemove(dataRemoved),this.doAdd(dataAdded),this.doUpdate(dataUpdated);(null===(_a=data.edges)||void 0===_a?void 0:_a.filter((edge=>edge.hasOwnProperty("source")||edge.hasOwnProperty("target"))).length)&&this.updateTreeGraph(dataType,{nodes:this.graphCore.getAllNodes(),edges:this.graphCore.getAllEdges()})}doAdd(data){if(is_empty(data))return;const{graphCore}=this,{nodes=[],edges=[],combos=[]}=data;if(nodes.length||combos.length){const nodesAndCombos=getNodesAndCombos(data);graphCore.addNodes(nodesAndCombos)}edges.length&&graphCore.addEdges(edges)}doUpdate(data){if(is_empty(data))return;const{graphCore}=this,{nodes=[],edges=[],combos=[]}=data;nodes.forEach((newModel=>{const{id,data}=newModel;if(data){const mergedData=mergeOneLevelData(graphCore.getNode(id),newModel);graphCore.mergeNodeData(id,mergedData)}data.hasOwnProperty("parentId")&&graphCore.setParent(id,data.parentId,"combo")})),edges.forEach((newModel=>{if(!graphCore.hasEdge(newModel.id))return;const oldModel=graphCore.getEdge(newModel.id);if(!oldModel)return;const{id,source,target,data}=newModel;if(source&&oldModel.source!==source&&graphCore.updateEdgeSource(id,source),target&&oldModel.target!==target&&graphCore.updateEdgeTarget(id,target),data){const mergedData=mergeOneLevelData(graphCore.getEdge(id),newModel);graphCore.mergeEdgeData(id,mergedData)}}));const modelsToMove=[];combos.forEach((newModel=>{const{id,data}=newModel,{x:comboNewX,y:comboNewY}=data,others=data_rest(data,["x","y"]);if(void 0!==comboNewX||void 0!==comboNewY)if(this.graphCore.getChildren(id,"combo").length){const oldBounds=this.graph.getRenderBBox(id,!0);if(!oldBounds)return;const[comboOldX,comboOldY]=oldBounds.center,dx=comboNewX-comboOldX,dy=comboNewY-comboOldY;graphComboTreeDfs(this.graph,[newModel],(succeed=>{const{x,y,_isCombo}=succeed.data;_isCombo||modelsToMove.push({id:succeed.id,data:{x:x+dx,y:y+dy}})}),"BT")}else modelsToMove.push({id,data:{x:comboNewX,y:comboNewY}});if(Object.keys(others).length){const mergedData=mergeOneLevelData(graphCore.getNode(id),{id,data:others});graphCore.mergeNodeData(id,mergedData),others.hasOwnProperty("parentId")&&graphCore.setParent(id,others.parentId,"combo")}})),modelsToMove.forEach((newModel=>{const{id,data}=newModel;graphCore.mergeNodeData(id,data)}))}doRemove(data){if(is_empty(data))return;const{graphCore}=this;if(data.edges.length){const ids=data.edges.map((edge=>edge.id));graphCore.removeEdges(ids)}const nodesAndCombos=getNodesAndCombos(data);null==nodesAndCombos||nodesAndCombos.forEach((item=>this.removeNode(item)))}removeNode(nodeModel){const{id,data}=nodeModel,{graphCore}=this;if(graphCore.hasTreeStructure("combo")){graphCore.setParent(id,void 0,"combo");const{parentId}=data;graphCore.getChildren(id,"combo").forEach((child=>{graphCore.setParent(child.id,parentId,"combo"),graphCore.mergeNodeData(child.id,{parentId})}))}if(graphCore.hasTreeStructure("tree")){const succeedIds=[];graphCore.dfsTree(id,(child=>{succeedIds.push(child.id)}),"tree");const succeedEdgeIds=graphCore.getAllEdges().filter((({source,target})=>succeedIds.includes(source)&&succeedIds.includes(target))).map((edge=>edge.id));this.graph.showItem(succeedIds.filter((succeedId=>succeedId!==id)).concat(succeedEdgeIds)),graphCore.setParent(id,void 0,"tree"),graphCore.getChildren(id,"tree").forEach((child=>graphCore.setParent(child.id,void 0,"tree")))}graphCore.removeNode(id)}formatData(dataConfig){const{type,value}=dataConfig;let data=value;if(type){if("treeData"===type)data=treeData2GraphData(value);else if("fetch"===type);else if(!data.nodes)return void console.warn('Input data type is invalid, the type shuold be "graphData", "treeData", or "fetch".')}else data=dataConfig;return{type:type||this.dataType||"graphData",data}}moveCombo(data){const{combos=[]}=data,succeedNodesModels=[];combos.forEach((newModel=>{const{dx=0,dy=0}=newModel.data;if(dx||dy)if(this.graphCore.getChildren(newModel.id,"combo").length)graphComboTreeDfs(this.graph,[newModel],(succeed=>{const{x,y,_isCombo}=succeed.data;_isCombo&&this.graphCore.getChildren(succeed.id,"combo").length||succeedNodesModels.push({id:succeed.id,data:{x:x+dx,y:y+dy}})}),"BT");else{const comboModel=this.graphCore.getNode(newModel.id),{x=0,y=0}=comboModel.data;succeedNodesModels.push({id:newModel.id,data:{x:x+dx,y:y+dy}})}}));const{graphCore}=this;succeedNodesModels.forEach((newModel=>{const{id,data}=newModel;if(data){const mergedData=mergeOneLevelData(graphCore.getNode(id),newModel);graphCore.mergeNodeData(id,mergedData)}}))}addCombo(data){const{combos=[]}=data;if(!(null==combos?void 0:combos.length))return;const{graphCore}=this,{id,data:comboData}=combos[0],{_children=[]}=comboData,others=data_rest(comboData,["_children"]);graphCore.hasTreeStructure("combo")||graphCore.attachTreeStructure("combo"),graphCore.hasNode(id)?graphCore.mergeNodeData(id,Object.assign(Object.assign({},others),{_isCombo:!0})):graphCore.addNode({id,data:Object.assign(Object.assign({},others),{_isCombo:!0})}),_children.forEach((childId=>{this.graphCore.hasNode(childId)?(graphCore.setParent(childId,id,"combo"),graphCore.mergeNodeData(childId,{parentId:id})):console.warn(`Adding child ${childId} to combo ${id} failed. The child ${childId} does not exist`)}))}preprocessData(data,type){const{graphCore}=this,dataCloned=(0,lodash_clone.A)(data),prevData=graphCore?deconstructData({nodes:graphCore.getAllNodes(),edges:graphCore.getAllEdges()}):{},{prevMinusNew,newMinusPrev,intersectionOfPrevAndNew}=diffGraphData(prevData,dataCloned);return{replace:{dataAdded:dataCloned,dataUpdated:{},dataRemoved:{}},mergeReplace:{dataAdded:newMinusPrev,dataUpdated:intersectionOfPrevAndNew,dataRemoved:prevMinusNew},union:{dataAdded:newMinusPrev,dataUpdated:intersectionOfPrevAndNew,dataRemoved:{}},remove:{dataAdded:{},dataUpdated:{},dataRemoved:intersectionOfPrevAndNew},update:{dataAdded:{},dataUpdated:intersectionOfPrevAndNew,dataRemoved:{}},updatePosition:{dataAdded:{},dataUpdated:intersectionOfPrevAndNew,dataRemoved:{}}}[type]}transformData(data,changeType){return this.extensions.forEach((({func,config})=>{this.isTransformActive(config,changeType)&&(data=func(data,config,this.graphCore))})),data}updateTreeGraph(dataType,data){this.graphCore.attachTreeStructure("tree"),"treeData"===dataType?data.edges.forEach((edge=>{const{source,target}=edge;this.graphCore.setParent(target,source,"tree")})):this.treeDirtyFlag=!0}}const mergeOneLevelData=(prevModel,newModel)=>{const{data:newData}=newModel,{data:prevData}=prevModel,mergedData={};return Object.keys(newData).forEach((key=>{(0,is_array.A)(prevData[key])||(0,is_array.A)(newData[key])?mergedData[key]=newData[key]:"object"==typeof prevData[key]&&"object"==typeof newData[key]?mergedData[key]=Object.assign(Object.assign({},prevData[key]),newData[key]):mergedData[key]=newData[key]})),mergedData},diffGraphData=(prevData,newData)=>{const result={newMinusPrev:{nodes:[],edges:[],combos:[]},prevMinusNew:{nodes:[],edges:[],combos:[]},intersectionOfPrevAndNew:{nodes:[],edges:[],combos:[]}};return["nodes","edges","combos"].forEach((key=>{const diff=((prevModels=[],newModels=[])=>{const prevIds=new Set(null==prevModels?void 0:prevModels.map((item=>item.id))),newIds=new Set(null==newModels?void 0:newModels.map((item=>item.id)));return{prevMinusNew:null==prevModels?void 0:prevModels.filter((item=>!newIds.has(item.id))),newMinusPrev:null==newModels?void 0:newModels.filter((item=>!prevIds.has(item.id))),intersectionOfPrevAndNew:null==newModels?void 0:newModels.filter((item=>prevIds.has(item.id)))}})(prevData[key],newData[key]);result.newMinusPrev[key]=diff.newMinusPrev,result.prevMinusNew[key]=diff.prevMinusNew,result.intersectionOfPrevAndNew[key]=diff.intersectionOfPrevAndNew})),result},getNodesAndCombos=data=>{const{nodes=[],combos=[]}=data;return nodes.concat(combos.map((combo=>({id:combo.id,data:Object.assign(Object.assign({},combo.data),{_isCombo:!0})}))))};var CANVAS_EVENT_TYPE,DOM_EVENT_TYPE;!function(CANVAS_EVENT_TYPE){CANVAS_EVENT_TYPE.pointerover="pointerover",CANVAS_EVENT_TYPE.pointerenter="pointerenter",CANVAS_EVENT_TYPE.pointerdown="pointerdown",CANVAS_EVENT_TYPE.pointermove="pointermove",CANVAS_EVENT_TYPE.pointerup="pointerup",CANVAS_EVENT_TYPE.pointerleave="pointerleave",CANVAS_EVENT_TYPE.click="click",CANVAS_EVENT_TYPE.wheel="wheel",CANVAS_EVENT_TYPE.dragstart="dragstart",CANVAS_EVENT_TYPE.drag="drag",CANVAS_EVENT_TYPE.dragend="dragend",CANVAS_EVENT_TYPE.dragenter="dragenter",CANVAS_EVENT_TYPE.dragleave="dragleave",CANVAS_EVENT_TYPE.dragover="dragover",CANVAS_EVENT_TYPE.dragout="dragout",CANVAS_EVENT_TYPE.drop="drop"}(CANVAS_EVENT_TYPE||(CANVAS_EVENT_TYPE={})),function(DOM_EVENT_TYPE){DOM_EVENT_TYPE.focus="focus",DOM_EVENT_TYPE.blur="blur",DOM_EVENT_TYPE.keyup="keyup",DOM_EVENT_TYPE.keydown="keydown",DOM_EVENT_TYPE.keypress="keypress"}(DOM_EVENT_TYPE||(DOM_EVENT_TYPE={}));const getItemInfoFromElement=element=>{var _a;if("document"===element.nodeName)return{itemType:"canvas",itemId:void 0,groupElement:element};let parent=element;for(;parent&&!(null===(_a=parent.getAttribute)||void 0===_a?void 0:_a.call(parent,"data-item-type"));)parent=parent.parentElement;return parent?{itemType:parent.getAttribute("data-item-type"),itemId:parent.getAttribute("data-item-id"),groupElement:parent}:null},getContextMenuEventProps=(event,graph)=>Object.assign(Object.assign({},event),{type:"contextmenu",preventDefault:()=>{graph.canvas.getContextService().getDomElement().addEventListener("contextmenu",(e=>{e.preventDefault()}),{once:!0})}});class InteractionController{constructor(graph){this.behaviorMap=new Map,this.listenersMap={},this.tap=()=>{this.graph.hooks.init.tap((()=>this.onModeChange({mode:"default"}))),this.onModeChange({mode:"default"}),this.graph.hooks.modechange.tap(this.onModeChange),this.graph.hooks.behaviorchange.tap(this.onBehaviorChange)},this.validateMode=mode=>{if("default"===mode)return!0;const modes=this.graph.getSpecification().modes||{};return Object.keys(modes).includes(mode)},this.initBehavior=config=>{const key="string"==typeof config?config:config.key||config.type;if(this.behaviorMap.has(key))console.error(`G6: Failed to add behavior with key or type "${key}"! It was already added.`);else try{const BehaviorClass=getExtension(config,registry.useLib,"behavior"),behavior=new BehaviorClass("string"==typeof config?{}:config);return behavior.graph=this.graph,behavior&&this.behaviorMap.set(key,behavior),behavior}catch(error){return console.error(`G6: Failed to initialize behavior with key or type "${key}"!`,error),null}},this.destroyBehavior=(key,behavior)=>{try{this.behaviorMap.delete(key),behavior.destroy()}catch(error){console.error(`G6: Failed to destroy behavior with key or type "${key}"!`,error)}},this.addListeners=(key,behavior)=>{const events=behavior.getEvents();this.listenersMap[key]={},Object.keys(events).forEach((eventName=>{const listener=((type,eventName,listener)=>event=>{try{listener(event)}catch(error){throw console.error(`G6: Error occurred in "${eventName}" phase of the behavior "${type}"!`),error}})(key,eventName,events[eventName].bind(behavior));this.graph.on(eventName,listener),this.listenersMap[key][eventName]=listener}))},this.removeListeners=key=>{Object.keys(this.listenersMap[key]||{}).forEach((eventName=>{const listener=this.listenersMap[key][eventName];this.graph.off(eventName,listener)}))},this.onModeChange=param=>{var _a;const{mode}=param;if(this.mode===mode)return;this.validateMode(mode)||console.warn(`G6: Mode "${mode}" was not specified in current graph.`),this.mode=mode,this.behaviorMap.forEach(((behavior,key)=>{this.removeListeners(key),this.destroyBehavior(key,behavior)})),this.behaviorMap.clear();((null===(_a=this.graph.getSpecification().modes)||void 0===_a?void 0:_a[mode])||[]).forEach((config=>{this.initBehavior(config)})),this.listenersMap={},this.behaviorMap.forEach(((behavior,key)=>{this.addListeners(key,behavior)}))},this.onBehaviorChange=param=>{const{action,modes,behaviors}=param;modes.forEach((mode=>{mode===this.mode&&("add"!==action?"remove"!==action?"update"===action&&behaviors.forEach((config=>{const key="string"==typeof config?config:config.key||config.type,behavior=this.behaviorMap.get(key);behavior&&behavior.updateConfig(config)})):behaviors.forEach((config=>{const key="string"==typeof config?config:config.key||config.type,behavior=this.behaviorMap.get(key);behavior&&(this.removeListeners(key),this.destroyBehavior(key,behavior))})):behaviors.forEach((config=>{const key="string"==typeof config?config:config.key||config.type,behavior=this.initBehavior(config);behavior&&this.addListeners(key,behavior)})))}))},this.initEvents=()=>{Object.values(CANVAS_EVENT_TYPE).forEach((eventName=>{this.graph.canvas.document.addEventListener(eventName,this.handleCanvasEvent)}));const $dom=this.graph.canvas.getContextService().getDomElement();Object.values(DOM_EVENT_TYPE).forEach((eventName=>{$dom&&$dom.addEventListener&&$dom.addEventListener(eventName,this.handleDOMEvent)}))},this.handleCanvasEvent=gEvent=>{const itemInfo=getItemInfoFromElement(gEvent.target);if(!itemInfo)return;const{itemType,itemId}=itemInfo,event=Object.assign(Object.assign({},gEvent),{itemType,itemId,gEvent,stopPropagation:gEvent.stopPropagation,currentTarget:this.graph});"click"===event.type&&2===event.detail&&this.handleCanvasEvent(Object.assign(Object.assign({},gEvent),{type:"dblclick"}));const isRightClick="click"===event.type&&2===event.button;if("canvas"!==event.itemType){if(("node"===itemType||"edge"===itemType||"combo"===itemType)&&("pointermove"!==event.type&&"pointerleave"!==event.type||this.handlePointerMove(event),isRightClick||(this.graph.emit(`${itemType}:${gEvent.type}`,event),this.graph.emit(`${gEvent.type}`,event)),"pointerdown"===event.type&&2===event.button)){const contextMenuEvent=getContextMenuEventProps(event,this.graph);this.graph.emit(`${itemType}:contextmenu`,contextMenuEvent),this.graph.emit("contextmenu",contextMenuEvent)}}else if("pointermove"===event.type&&this.handlePointerMove(event),isRightClick||(this.graph.emit(`canvas:${gEvent.type}`,event),this.graph.emit(`${gEvent.type}`,event)),"pointerdown"===event.type&&2===event.button){const contextMenuEvent=getContextMenuEventProps(event,this.graph);this.graph.emit("canvas:contextmenu",contextMenuEvent),this.graph.emit("contextmenu",contextMenuEvent)}},this.handlePointerMove=event=>{const prevItemInfo=this.prevItemInfo,curItemInfo=getItemInfoFromElement(event.target);if((null==prevItemInfo?void 0:prevItemInfo.itemId)!==(null==curItemInfo?void 0:curItemInfo.itemId)){if(prevItemInfo){const preType=prevItemInfo.itemType;this.graph.emit(`${preType}:pointerleave`,Object.assign(Object.assign({},event),{itemId:prevItemInfo.itemId,itemType:prevItemInfo.itemType,type:"pointerleave",target:prevItemInfo.groupElement}))}if(curItemInfo){const curType=curItemInfo.itemType;this.graph.emit(`${curType}:pointerenter`,Object.assign(Object.assign({},event),{type:"pointerenter",target:curItemInfo.groupElement}))}}this.prevItemInfo=curItemInfo},this.handleDOMEvent=event=>{this.graph.emit(event.type,event)},this.graph=graph,this.initEvents(),this.tap()}getMode(){return this.mode}}const DEFAULT_MAPPER={node:innerNodeModel=>{const{id,data}=innerNodeModel,{color,label,icon,badges,keyShape}=data,resultData=Object.assign(Object.assign({},data),{keyShape:Object.assign({},keyShape)});return color&&(resultData.keyShape.fill=color),label&&(resultData.labelShape={text:label}),icon&&(resultData.iconShape=icon),badges&&(resultData.badgeShapes=badges),{id,data:resultData}},edge:innerEdgeModel=>{const{id,source,target,data}=innerEdgeModel,{color,label,icon,badge,keyShape}=data||{},resultData=Object.assign(Object.assign({},data),{keyShape:Object.assign({},keyShape)});return color&&(resultData.keyShape.stroke=color),label&&(resultData.labelShape={text:label}),icon&&(resultData.iconShape=icon),badge&&(resultData.badgeShape=badge),{id,source,target,data:resultData}},combo:innerComboModel=>innerComboModel};var item_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class Item{constructor(props){this.destroyed=!1,this.visible=!0,this.states=[],this.shapeMap={keyShape:void 0},this.afterDrawShapeMap={},this.transient=!1,this.stateDirtyMap={},this.cacheStateStyles={},this.cacheNotHiddenByItem={},this.cacheHiddenByItem={},this.animateFrameListener=throttle((e=>{var _a;null===(_a=this.onframe)||void 0===_a||_a.call(this,e)}),16,{trailing:!0,leading:!0}),this.device=props.device,this.onframe=props.onframe}init(props){var _a;const{graph,model,containerGroup,labelContainerGroup,mapper,stateMapper,renderExtensions,zoom=1,theme={},type:itemType}=props;this.type=itemType,this.graph=graph,this.group=new Group({style:{zIndex:0}}),this.labelGroup=new Group({style:{zIndex:0}}),this.group.setAttribute("data-item-type",this.type),this.group.setAttribute("data-item-id",props.model.id),this.labelGroup.setAttribute("data-item-type",this.type),this.labelGroup.setAttribute("data-item-id",props.model.id),containerGroup.appendChild(this.group),labelContainerGroup.appendChild(this.labelGroup),this.model=model,this.mapper=mapper,this.zoom=zoom,this.stateMapper=stateMapper,this.displayModel=this.getDisplayModelAndChanges(model).model,this.renderExtensions=renderExtensions;const{type="edge"===this.type?"line-edge":`circle-${this.type}`,lodLevels:modelLodLevels,enableBalanceShape}=this.displayModel.data,RenderExtension=renderExtensions.find((ext=>ext.type===type));if(this.themeStyles=theme.styles,this.lodLevels=modelLodLevels?formatLodLevels(modelLodLevels):theme.lodLevels,!RenderExtension)throw"node"===this.type?new Error(`TypeError: RenderExtension is not a constructor. The '${type}' in your data haven't been registered. You can use built-in node types like 'rect-node', 'circle-node' or create a custom node type as you like.`):"edge"==this.type?new Error(`TypeError: RenderExtension is not a constructor. The '${type}' in your data haven't been registered. You can use built-in edge types like 'line-edge', 'quadratic-edge','cubic-edge' or create a custom edge type as you like.`):new Error(`TypeError: RenderExtension is not a constructor. The '${type}' haven't been registered.`);this.renderExt=new RenderExtension({themeStyles:null===(_a=this.themeStyles)||void 0===_a?void 0:_a.default,lodLevels:this.lodLevels,enableBalanceShape,device:this.device,zoom:this.zoom,graph:this.graph})}draw(displayModel,diffData,diffState,animate=!0,onfinish=(()=>{})){var _a,_b;const afterDrawShapeMap=(null===(_b=(_a=this.renderExt).afterDraw)||void 0===_b?void 0:_b.call(_a,displayModel,Object.assign(Object.assign({},this.shapeMap),this.afterDrawShapeMap),diffData,diffState))||{};this.afterDrawShapeMap.labelShape&&(this.afterDrawShapeMap.labelShape.attributes.dataIsLabel=!0),this.afterDrawShapeMap.labelBackgroundShape&&(this.afterDrawShapeMap.labelBackgroundShape.attributes.dataIsLabelBackground=!0);const shapeMap=updateShapes(this.afterDrawShapeMap,afterDrawShapeMap,this.group,this.labelGroup,!1,(id=>!RESERVED_SHAPE_IDS.includes(id)||(console.warn(`Shape with id ${id} is reserved and should be returned in draw function, if the shape with ${id} returned by afterDraw is a new one, it will not be added to the group.`),!1)));this.shapeMap=Object.assign(Object.assign({},this.shapeMap),shapeMap),this.changedStates=[]}update(model,diffData,isReplace,itemTheme,onlyMove,animate=!0,onfinish){var _a;this.model=model,itemTheme&&(this.themeStyles=itemTheme.styles);const{model:displayModel,typeChange}=this.getDisplayModelAndChanges(this.model,diffData,isReplace);if(this.displayModel=displayModel,this.lodLevels=displayModel.data.lodLevels?formatLodLevels(displayModel.data.lodLevels):(null==itemTheme?void 0:itemTheme.lodLevels)||this.lodLevels,onlyMove)this.updatePosition(displayModel,diffData,animate,onfinish);else{if(typeChange){Object.values(this.shapeMap).forEach((child=>child.destroy())),this.shapeMap={keyShape:void 0};const{type="node"===this.type?"circle-node":"line-edge"}=displayModel.data,RenderExtension=this.renderExtensions.find((ext=>ext.type===type));this.renderExt=new RenderExtension({themeStyles:this.themeStyles.default,lodLevels:this.lodLevels,device:this.device,zoom:this.zoom,graph:this.graph})}else this.renderExt.themeStyles=this.themeStyles.default,this.renderExt.lodLevels=this.lodLevels;(null===(_a=this.states)||void 0===_a?void 0:_a.length)?this.drawWithStates(this.states,animate,onfinish):this.draw(this.displayModel,diffData,void 0,animate,onfinish),this.stateDirtyMap={},this.states.forEach((({name})=>this.stateDirtyMap[name]=!0))}}updatePosition(displayModel,diffData,animate,onfinish){}getDisplayModelAndChanges(innerModel,diffData,isReplace){var _a,_b;const{mapper,type}=this,defaultMapper=DEFAULT_MAPPER[type],{data:innerModelData}=innerModel,otherFields=item_rest(innerModel,["data"]),{current=innerModelData}=diffData||{};if(!mapper){let typeChange=!1;return current&&(typeChange=Boolean(current.type)),{model:defaultMapper(innerModel),typeChange}}if((0,is_function.A)(mapper)){const mappedModel=Object.assign(Object.assign({},defaultMapper(innerModel)),mapper(innerModel));return{model:mappedModel,typeChange:(null===(_b=null===(_a=this.displayModel)||void 0===_a?void 0:_a.data)||void 0===_b?void 0:_b.type)!==mappedModel.data.type}}const dataChangedFields=isReplace?void 0:Object.keys(current||{}).concat(Object.keys(otherFields));let typeChange=!1;const{data}=innerModel,otherProps=item_rest(innerModel,["data"]),displayModelData=defaultMapper(innerModel).data;return Object.keys(mapper).forEach((fieldName=>{var _a,_b;let subMapper=mapper[fieldName];const isReservedShapeId=RESERVED_SHAPE_IDS.includes(fieldName),isShapeId=isReservedShapeId||"otherShapes"===fieldName;if(isShapeId&&isEncode(subMapper)||!isShapeId)if(displayModelData.hasOwnProperty(fieldName))"type"!==fieldName||dataChangedFields&&!dataChangedFields.includes("type")||(typeChange=!0);else{const{changed,value:mappedValue}=updateChange({innerModel,mapper,fieldName,dataChangedFields});if(isShapeId){if(!mappedValue)return;subMapper=mappedValue}else displayModelData[fieldName]=mappedValue;changed&&"type"===fieldName&&(typeChange=!0)}isReservedShapeId?(displayModelData[fieldName]=displayModelData[fieldName]||(0,is_object.A)(innerModel.data[fieldName])||(0,is_object.A)(null===(_a=this.displayModel)||void 0===_a?void 0:_a.data[fieldName])?Object.assign(Object.assign({},innerModel.data[fieldName]),null===(_b=this.displayModel)||void 0===_b?void 0:_b.data[fieldName]):{},updateShapeChange({innerModel,mapper:subMapper,dataChangedFields,shapeConfig:displayModelData[fieldName],fieldPath:[fieldName]})):"otherShapes"===fieldName&&(displayModelData[fieldName]=displayModelData[fieldName]||(0,is_object.A)(innerModel.data[fieldName])?Object.assign({},innerModel.data[fieldName]):{},Object.keys(subMapper).forEach((shapeId=>{var _a;if(!(null===(_a=displayModelData[fieldName])||void 0===_a?void 0:_a.hasOwnProperty(shapeId))){displayModelData[fieldName][shapeId]=displayModelData[fieldName][shapeId]||{};const shappStyle=subMapper[shapeId];updateShapeChange({innerModel,mapper:shappStyle,dataChangedFields,shapeConfig:displayModelData[fieldName][shapeId],fieldPath:[fieldName,shapeId]})}})))})),{model:Object.assign(Object.assign({},otherProps),{data:displayModelData}),typeChange}}getID(){return this.model.id}getType(){return this.type}show(animate=!0,shapeIds=void 0){const shapeIdsToStop=null==shapeIds?void 0:shapeIds.filter((id=>{const shape=this.shapeMap[id];return shape&&"hidden"===shape.style.visibility}));(null==shapeIds?void 0:shapeIds.length)&&!(null==shapeIdsToStop?void 0:shapeIdsToStop.length)||(shapeIdsToStop&&!shapeIdsToStop.includes("labelShape")||(this.labelGroup.style.visibility="visible"),Promise.all(this.stopAnimations(shapeIdsToStop)).finally((()=>{var _a,_b;if(this.destroyed)return;const{animates={}}=this.displayModel.data,shapeIdsToShow=shapeIdsToStop||Object.keys(this.shapeMap).filter((shapeId=>this.cacheHiddenByItem[shapeId]));if(animate&&(null===(_a=animates.show)||void 0===_a?void 0:_a.length)){const showAnimateFieldsMap={};Object.values(animates.show).forEach((animate=>{const{shapeId="group"}=animate;showAnimateFieldsMap[shapeId]=(showAnimateFieldsMap[shapeId]||[]).concat(animate.fields)}));const targetStyleMap={};shapeIdsToShow.forEach((id=>{const shape=this.shapeMap[id];if(showAnimateFieldsMap[id]){targetStyleMap[id]=targetStyleMap[id]||{};const beginStyle=getShapeAnimateBeginStyles(shape);showAnimateFieldsMap[id].forEach((field=>{beginStyle.hasOwnProperty(field)&&(targetStyleMap[id][field]=shape.style[field],shape.style[field]=beginStyle[field])}))}shape.show(),delete this.cacheHiddenByItem[id]})),showAnimateFieldsMap.group&&"hidden"===this.shapeMap.keyShape.attributes.visibility&&showAnimateFieldsMap.group.forEach((field=>{const usingField="size"===field?"transform":field;GROUP_ANIMATE_STYLES[0].hasOwnProperty(usingField)&&(this.group.style[usingField]=GROUP_ANIMATE_STYLES[0][usingField])})),Object.keys(targetStyleMap).length&&(this.animations=this.runWithAnimates(animates,"show",targetStyleMap,shapeIdsToShow))}else shapeIdsToShow.forEach((id=>{this.shapeMap[id].show(),delete this.cacheHiddenByItem[id]}));this.visible=!0,shapeIds||(this.cacheHiddenByItem={}),(null===(_b=this.states)||void 0===_b?void 0:_b.length)&&this.drawWithStates([])})))}hide(animate=!0,keepKeyShape=!1,shapeIds=void 0){const shapeIdsToHide=(null==shapeIds?void 0:shapeIds.filter((id=>{const shape=this.shapeMap[id];return shape&&("hidden"!==shape.attributes.visibility||this.cacheNotHiddenByItem[id])})))||Object.keys(this.shapeMap);if(!shapeIdsToHide.length)return;this.cacheNotHiddenByItem={};const func=()=>{shapeIdsToHide.forEach((id=>{if(keepKeyShape&&"keyShape"===id)return;const shape=this.shapeMap[id];shape&&"hidden"!==shape.attributes.visibility?(shape.hide(),this.cacheHiddenByItem[id]=!0,shapeIds||(this.visible=!1)):this.cacheNotHiddenByItem[id]=!0}))};Promise.all(this.stopAnimations(shapeIdsToHide)).then((()=>{var _a;if(this.destroyed)return;const{animates={}}=this.displayModel.data;animate&&(null===(_a=animates.hide)||void 0===_a?void 0:_a.length)?this.animations=this.runWithAnimates(animates,"hide",void 0,shapeIdsToHide,func):func()}))}isVisible(){return this.visible}toFront(){this.group.toFront()}toBack(){this.group.toBack()}hasState(state){const findState=this.states.find((item=>item.name===state));return(null==findState?void 0:findState.value)||!1}setState(state,value){const previousStates=cloneJSON(this.states),existState=this.states.find((item=>item.name===state));if(value)existState?existState.value=value:this.states.push({name:state,value});else{const idx=this.states.indexOf(existState);this.states.splice(idx,1)}this.renderExt.constructor.prototype.hasOwnProperty("setState")?this.renderExt.setState(state,value,this.shapeMap):(this.changedStates=[state],this.drawWithStates(previousStates))}clearStates(states){const previousStates=cloneJSON(this.states),newStates=[];let changedStates=[];states?this.states.filter((state=>{states.includes(state.name)?changedStates.push(state):newStates.push(state)})):changedStates=this.states.map((({name,value})=>({name,value:!1}))),this.states=newStates,this.changedStates=changedStates.map((state=>state.name)),this.renderExt.constructor.prototype.hasOwnProperty("setState")?changedStates.forEach((({name,value})=>this.renderExt.setState(name,value,this.shapeMap))):this.drawWithStates(previousStates)}getStates(){return this.states}runWithAnimates(animates,timing,targetStyleMap,shapeIdsToShow,callback=(()=>{})){let targetStyle={};return targetStyleMap?targetStyle=targetStyleMap:null==shapeIdsToShow||shapeIdsToShow.forEach((shapeId=>{targetStyle[shapeId]=getShapeAnimateBeginStyles(this.shapeMap[shapeId])})),animateShapes(animates,targetStyle,this.shapeMap,shapeIdsToShow,[this.group,this.labelGroup],timing,[],(()=>{}),callback)}drawWithStates(previousStates,animate=!0,onfinish){var _a;const _b=this.themeStyles,{default:_}=_b,themeStateStyles=item_rest(_b,["default"]),{data:displayModelData}=this.displayModel;let styles={};this.states.forEach((({name:stateName,value})=>{var _a;const stateStyles=this.cacheStateStyles[stateName]||{},mapper=null===(_a=this.stateMapper)||void 0===_a?void 0:_a[stateName];if(!mapper&&!(null==themeStateStyles?void 0:themeStateStyles[stateName]))return;mapper&&value&&(!this.stateDirtyMap.hasOwnProperty(stateName)||this.stateDirtyMap[stateName])&&(this.stateDirtyMap[stateName]=!1,Object.keys(mapper).forEach((shapeId=>{stateStyles[shapeId]=Object.assign({},displayModelData[shapeId]),RESERVED_SHAPE_IDS.includes(shapeId)?updateShapeChange({innerModel:this.model,mapper:mapper[shapeId],dataChangedFields:void 0,shapeConfig:stateStyles[shapeId],fieldPath:[shapeId]}):"otherShapes"===shapeId&&mapper[shapeId]&&Object.keys(mapper[shapeId]).forEach((otherShapeId=>{stateStyles[shapeId]=stateStyles[shapeId]||{},stateStyles[shapeId][otherShapeId]=stateStyles[shapeId][otherShapeId]||{},updateShapeChange({innerModel:this.model,mapper:mapper[shapeId][otherShapeId],dataChangedFields:void 0,shapeConfig:stateStyles[shapeId][otherShapeId],fieldPath:[shapeId,otherShapeId]})}))}))),this.cacheStateStyles[stateName]=stateStyles;const mergedStateStyles=mergeStyles([themeStateStyles[stateName],stateStyles]);styles=mergeStyles([styles,mergedStateStyles])}));const mergedData=mergeStyles([displayModelData,styles]),{animates}=mergedData,displayUpdateAnimates=[],stateNames=previousStates.concat(this.states).map((state=>state.name));null===(_a=null==animates?void 0:animates.update)||void 0===_a||_a.forEach((animateCfg=>{const{states}=animateCfg;states&&array_isArrayOverlap(states,stateNames)&&displayUpdateAnimates.push(animateCfg)})),this.draw(Object.assign(Object.assign({},this.displayModel),{data:Object.assign(Object.assign({},mergedData),{animates:Object.assign(Object.assign({},animates),{update:displayUpdateAnimates})})}),void 0,{previous:previousStates,current:this.states},animate,onfinish)}getKeyBBox(){const{keyShape}=this.shapeMap;return(null==keyShape?void 0:keyShape.getRenderBounds())||{center:[0,0,0]}}getLocalKeyBBox(){const{keyShape}=this.shapeMap;return(null==keyShape?void 0:keyShape.getLocalBounds())||{center:[0,0,0]}}getBBox(){var _a;if(null===(_a=this.animations)||void 0===_a?void 0:_a.length){const{keyShape,labelShape}=this.shapeMap,{x=0,y=0,z=0}=this.displayModel.data,{keyShape:keyShapeStyle,labelShape:labelShapeStyle}=this.renderExt.mergedStyles,estimateBounds=labelShape?(bounds=>{const res={center:[0,0,0],min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0],size:[0,0,0],halfExtents:[0,0,0]};return bounds.forEach((bound=>{const{min,max}=bound;min.forEach(((val,i)=>{val<res.min[i]&&(res.min[i]=val)})),max.forEach(((val,i)=>{val>res.max[i]&&(res.max[i]=val)}))})),res.center=res.center.map(((val,i)=>(res.max[i]+res.min[i])/2)),res.halfExtents=res.halfExtents.map(((val,i)=>(res.max[i]-res.min[i])/2)),res})([getShapeLocalBoundsByStyle(keyShape,keyShapeStyle),getShapeLocalBoundsByStyle(labelShape,labelShapeStyle)]):getShapeLocalBoundsByStyle(keyShape,keyShapeStyle);return[x,y,z].forEach(((val,i)=>{estimateBounds.max[i]+=val,estimateBounds.min[i]+=val,estimateBounds.center[i]+=val})),estimateBounds.halfExtents=[(estimateBounds.max[0]-estimateBounds.min[0])/2,(estimateBounds.max[1]-estimateBounds.min[1])/2,(estimateBounds.max[2]-estimateBounds.min[2])/2],estimateBounds}return this.group.getRenderBounds()}stopAnimations(shapeIds){var _a,_b,_c,_d;const promises=[];if(null===(_a=this.animations)||void 0===_a?void 0:_a.length)for(let i=0;i<this.animations.length;i++){const animate=this.animations[i];if(!(null==shapeIds?void 0:shapeIds.length)||shapeIds.includes(animate.effect.target.id)){if(this.animations.pop(),"running"!==animate.playState)break;promises.push(stopAnimate(animate)),null===(_b=animate.onManualCancel)||void 0===_b||_b.call(animate)}}if(null===(_c=this.groupAnimations)||void 0===_c?void 0:_c.length){for(;this.groupAnimations.length;){const groupAnimate=this.groupAnimations.pop();if("running"!==groupAnimate.playState)break;promises.push(stopAnimate(groupAnimate)),null===(_d=groupAnimate.onManualCancel)||void 0===_d||_d.call(groupAnimate)}this.groupAnimations=[]}return promises}updateZoom(zoom){this.zoom=zoom,this.renderExt.onZoom(this.shapeMap,zoom,this.cacheHiddenByItem)}updateLabelPosition(ignoreVisibility=!1){}destroy(){var _a;const func=()=>{this.group.destroy(),this.labelGroup.destroy(),this.model=null,this.displayModel=null,this.destroyed=!0};this.stopAnimations();const{animates}=this.displayModel.data;(null===(_a=null==animates?void 0:animates.buildOut)||void 0===_a?void 0:_a.length)&&!this.transient?this.animations=this.runWithAnimates(animates,"buildOut",void 0,void 0,func):func()}}const updateChange=({innerModel,fieldName,mapper,dataChangedFields})=>{const value=mapper[fieldName]||"";if(isEncode(value)){const{fields,formatter}=value;if(!dataChangedFields||array_isArrayOverlap(dataChangedFields,fields)){return{changed:!0,value:formatter(innerModel)||""}}return{changed:!1}}return{changed:!0,value}},updateShapeChange=({innerModel,mapper,dataChangedFields,shapeConfig,fieldPath})=>{if(!mapper)return;let innerModelValue=innerModel.data;null==fieldPath||fieldPath.forEach((field=>{innerModelValue=innerModelValue[field]||{}})),Object.keys(mapper).forEach((shapeAttrName=>{if(null==innerModelValue?void 0:innerModelValue.hasOwnProperty(shapeAttrName))return;const{value:mappedValue,changed}=updateChange({innerModel,mapper,fieldName:shapeAttrName,dataChangedFields});changed&&(shapeConfig[shapeAttrName]=mappedValue)}))};class node_Node extends Item{constructor(props){super(props),this.renderBoundsCache=new Map,this.init(Object.assign(Object.assign({},props),{type:props.type||"node"})),props.delayFirstDraw||this.draw(this.displayModel,void 0,void 0,!this.displayModel.data.disableAnimate,props.onfinish)}draw(displayModel,diffData,diffState,animate=!0,onfinish=(()=>{})){var _a;const{group,labelGroup,renderExt,shapeMap:prevShapeMap,model,graph}=this;renderExt.mergeStyles(displayModel);const firstRendering=!(null===(_a=this.shapeMap)||void 0===_a?void 0:_a.keyShape),shapeMap=renderExt.draw(displayModel,this.shapeMap,diffData,diffState);this.shapeMap.labelShape&&(this.shapeMap.labelShape.attributes.dataIsLabel=!0),this.shapeMap.labelBackgroundShape&&(this.shapeMap.labelBackgroundShape.attributes.dataIsLabelBackground=!0),this.shapeMap=updateShapes(prevShapeMap,shapeMap,group,labelGroup);const{animates,disableAnimate,x=0,y=0,z=0}=displayModel.data;if(firstRendering){group.style.x=x,group.style.y=y,group.style.z=z;const viewportPosition=graph.getViewportByCanvas({x,y,z});labelGroup.style.x=viewportPosition.x,labelGroup.style.y=viewportPosition.y,labelGroup.style.z=viewportPosition.z}else this.stopAnimations(),this.updatePosition(displayModel,diffData,animate,onfinish);const{haloShape}=this.shapeMap;if(null==haloShape||haloShape.toBack(),super.draw(displayModel,diffData,diffState,animate,onfinish),renderExt.updateCache(this.shapeMap),firstRendering&&renderExt.onZoom(this.shapeMap,this.zoom),animate&&!disableAnimate&&animates){const animatesExcludePosition=(animates=>{if(!animates.update)return animates;const excludedAnimates=[];return animates.update.forEach((animate=>{const{shapeId,fields}=animate,newFields=[...fields];if(!(id=>!id||"group"===id)(shapeId))return void excludedAnimates.push(Object.assign(Object.assign({},animate),{fields:newFields}));let isGroupPosition=!1;if(fields.includes("x")){const xFieldIdx=newFields.indexOf("x");newFields.splice(xFieldIdx,1),isGroupPosition=!0}if(fields.includes("y")){const yFieldIdx=newFields.indexOf("y");newFields.splice(yFieldIdx,1),isGroupPosition=!0}isGroupPosition?0!==newFields.length&&excludedAnimates.push(Object.assign(Object.assign({},animate),{fields:newFields})):excludedAnimates.push(Object.assign(Object.assign({},animate),{fields:newFields}))})),Object.assign(Object.assign({},animates),{update:excludedAnimates})})(animates),{current=[],previous=[]}=diffState||{};this.animations=animateShapes(animatesExcludePosition,renderExt.mergedStyles,this.shapeMap,void 0,[group,labelGroup],firstRendering?"buildIn":"update",current.concat(previous).map((state=>state.name))||this.changedStates,this.animateFrameListener,(canceled=>onfinish(model.id,canceled)))}this.labelGroup.children.filter((element=>element.attributes.dataIsLabel)).forEach((shape=>shape.attributes.dataOriginPosition="")),this.updateLabelPosition(!0)}updatePosition(displayModel,diffData,animate,onfinish=(()=>{})){const{group,labelGroup,graph}=this,{fx,fy,fz,x,y,z=0,animates,disableAnimate}=displayModel.data,position={x:void 0===fx?x:fx,y:void 0===fy?y:fy,z:void 0===fz?z:fz};if(isNaN(position.x)||isNaN(position.y)||isNaN(position.z))return;const viewportPosition=graph.getViewportByCanvas(position);if(labelGroup.style.x=viewportPosition.x,labelGroup.style.y=viewportPosition.y,labelGroup.style.z=viewportPosition.z||0,animate&&!disableAnimate&&(null==animates?void 0:animates.update)){const groupAnimates=animates.update.filter((({shapeId,fields=[]})=>(!shapeId||"group"===shapeId)&&(fields.includes("x")||fields.includes("y"))));if(groupAnimates.length){const animations=animateShapes({update:groupAnimates},{group:position},this.shapeMap,void 0,[group],"update",[],this.animateFrameListener,(canceled=>onfinish(displayModel.id,canceled)));return void(this.groupAnimations=animations)}}group.style.x=position.x,group.style.y=position.y,group.style.z=position.z,onfinish(displayModel.id,!animate)}updateLabelPosition(ignoreVisibility){if(!ignoreVisibility&&"hidden"===this.labelGroup.style.visibility)return;const{graph,group,labelGroup,displayModel,shapeMap,renderExt}=this;let[x,y,z]=group.getPosition();if(group.getAnimations().length){const{x:dataX,y:dataY,z:dataZ}=displayModel.data;x=dataX,y=dataY,z=dataZ}const renderBounds=group.getRenderBounds(),id=this.getID();this.renderBoundsCache.has(id)||this.renderBoundsCache.set(id,(0,lodash_clone.A)(renderBounds));const dy=renderBounds.halfExtents[1]-this.renderBoundsCache.get(id).halfExtents[1],zoom=graph.getZoom(),{x:vx,y:vy,z:vz}=graph.getViewportByCanvas({x,y:y+dy,z});labelGroup.style.x!==vx&&(labelGroup.style.x=vx),labelGroup.style.y!==vy&&(labelGroup.style.y=vy),labelGroup.style.z!==vz&&(labelGroup.style.z=vz),labelGroup.children.forEach((shape=>{if(shape.attributes.dataIsLabelBackground)return void renderExt.drawLabelBackgroundShape(displayModel,shapeMap);if(shape.attributes.dataIsLabel){const{wordWrapWidth}=shape.style;if(wordWrapWidth){shape.attributes.dataOriginWordWrapWidth||(shape.style.dataOriginWordWrapWidth=wordWrapWidth);const originWordWrapWidth=shape.attributes.dataOriginWordWrapWidth;shape.style.wordWrapWidth=originWordWrapWidth*zoom}}shape.attributes.dataOriginPosition||(shape.attributes.dataOriginPosition={x:shape.style.x,y:shape.style.y,z:shape.style.z});const originPosition=shape.attributes.dataOriginPosition;Object.keys(originPosition).forEach((field=>{isNaN(shape.style[field])||(shape.style[field]=originPosition[field]*zoom)}))}))}clone(containerGroup,labelContainerGroup,shapeIds,disableAnimate){if(null==shapeIds?void 0:shapeIds.length){const group=new Group;return shapeIds.forEach((shapeId=>{var _a;if(!this.shapeMap[shapeId]||this.shapeMap[shapeId].destroyed)return;const clonedKeyShape=this.shapeMap[shapeId].cloneNode();clonedKeyShape.style.opacity=(null===(_a=this.renderExt.mergedStyles[shapeId])||void 0===_a?void 0:_a.opacity)||1,group.appendChild(clonedKeyShape)})),group.setPosition(this.group.getPosition()),containerGroup.appendChild(group),group}const clonedModel=(0,lodash_clone.A)(this.model);clonedModel.data.disableAnimate=disableAnimate;const clonedNode=new node_Node({model:clonedModel,graph:this.graph,renderExtensions:this.renderExtensions,containerGroup,labelContainerGroup,mapper:this.mapper,stateMapper:this.stateMapper,zoom:this.zoom,theme:{styles:this.themeStyles,lodLevels:this.lodLevels}});return Object.keys(this.shapeMap).forEach((shapeId=>{var _a;this.shapeMap[shapeId].isVisible()?null===(_a=clonedNode.shapeMap[shapeId])||void 0===_a||_a.show():clonedNode.shapeMap[shapeId].hide()})),clonedNode}getAnchorPoint(point,anchorIdx){const{anchorPoints=[]}=this.displayModel.data;return this.getIntersectPoint(point,this.getPosition(),anchorPoints,anchorIdx)}getIntersectPoint(point,innerPoint,anchorPoints,anchorIdx){const{keyShape}=this.shapeMap,shapeType=keyShape.nodeName,{x,y,z}=innerPoint,keyShapeRenderBBox=keyShape.getRenderBounds(),keyShapeWidth=keyShapeRenderBBox.max[0]-keyShapeRenderBBox.min[0],keyShapeHeight=keyShapeRenderBBox.max[1]-keyShapeRenderBBox.min[1],anchorPositions=anchorPoints.map((pointRatio=>{const[xRatio,yRatio]=pointRatio;return{x:keyShapeWidth*xRatio+keyShapeRenderBBox.min[0],y:keyShapeHeight*yRatio+keyShapeRenderBBox.min[1]}}));if(void 0!==anchorIdx&&anchorPositions[anchorIdx])return anchorPositions[anchorIdx];let intersectPoint;switch(shapeType){case"circle":intersectPoint=getCircleIntersectByPoint({x,y,r:keyShape.attributes.r},point);break;case"ellipse":intersectPoint=((ellipseProps,point)=>{const{rx:a,ry:b,x:cx,y:cy}=ellipseProps,dx=point.x-cx,dy=point.y-cy;let angle=Math.atan2(dy/b,dx/a);return angle<0&&(angle+=2*Math.PI),{x:cx+a*Math.cos(angle),y:cy+b*Math.sin(angle)}})({x,y,rx:keyShape.attributes.rx,ry:keyShape.attributes.ry},point);break;case"mesh":intersectPoint=innerPoint;break;default:intersectPoint=getRectIntersectByPoint({x:keyShapeRenderBBox.min[0],y:keyShapeRenderBBox.min[1],width:keyShapeWidth,height:keyShapeHeight},point)}let linkPoint=intersectPoint;return anchorPoints.length&&(linkPoint||(linkPoint=point),linkPoint=getNearestPoint(anchorPositions,linkPoint).nearestPoint),linkPoint?(isNaN(z)||(linkPoint.z=z),linkPoint):{x,y,z}}getPosition(){if(this.shapeMap.keyShape&&void 0!==this.group.attributes.x&&3!==this.renderExt.dimensions){const{center}=this.shapeMap.keyShape.getRenderBounds();return{x:center[0],y:center[1],z:center[2]}}const{x=0,y=0,z=0,fx,fy,fz}=this.model.data;return{x:void 0===fx?x:fx,y:void 0===fy?y:fy,z:void 0===fz?z:fz}}}class Edge extends Item{constructor(props){super(props),this.destroyed=!1,this.type="edge",this.cache={},this.throttleUpdateWordWidth=throttle(((zoom,shape)=>{const{maxWidth}=this.renderExt.mergedStyles[shape.id]||{};maxWidth&&(shape.attributes.dataOriginWordWrapWidth||(shape.attributes.dataOriginWordWrapWidth=shape.style.wordWrapWidth),shape.style.wordWrapWidth=shape.attributes.dataOriginWordWrapWidth*zoom)}),50,{leading:!1,trailing:!0}),this.init(Object.assign(Object.assign({},props),{type:"edge"}));const{sourceItem,targetItem,nodeMap}=props;this.sourceItem=sourceItem,this.targetItem=targetItem,this.nodeMap=nodeMap,props.delayFirstDraw||this.draw(this.displayModel)}draw(displayModel,diffData,diffState,animate=!0,onfinish=(()=>{})){var _a,_b;const{sourcePoint,targetPoint}=this.getEndPoints(displayModel);this.renderExt.mergeStyles(displayModel);const firstRendering=!(null===(_a=this.shapeMap)||void 0===_a?void 0:_a.keyShape);this.renderExt.setSourcePoint(sourcePoint),this.renderExt.setTargetPoint(targetPoint),this.renderExt.setNodeMap(this.nodeMap);const shapeMap=this.renderExt.draw(displayModel,sourcePoint,targetPoint,this.shapeMap,diffData,diffState);this.shapeMap.labelShape&&(this.shapeMap.labelShape.attributes.dataIsLabel=!0),this.shapeMap.labelBackgroundShape&&(this.shapeMap.labelBackgroundShape.attributes.dataIsLabelBackground=!0),this.shapeMap=updateShapes(this.shapeMap,Object.assign(Object.assign({},shapeMap),this.afterDrawShapeMap),this.group,this.labelGroup);const{animates,disableAnimate}=displayModel.data,usingAnimates=Object.assign({},animates),targetStyles=this.renderExt.mergedStyles,{haloShape,labelShape}=this.shapeMap;null==haloShape||haloShape.toBack(),null==labelShape||labelShape.toFront(),super.draw(displayModel,diffData,diffState),this.renderExt.updateCache(this.shapeMap),firstRendering?this.renderExt.onZoom(this.shapeMap,this.zoom):this.stopAnimations();if(animate&&!disableAnimate&&(null===(_b=usingAnimates[firstRendering?"buildIn":"update"])||void 0===_b?void 0:_b.length)){const{current=[],previous=[]}=diffState||{};this.animations=animateShapes(usingAnimates,targetStyles,this.shapeMap,void 0,[this.group,this.labelGroup],firstRendering?"buildIn":"update",current.concat(previous).map((state=>state.name))||this.changedStates,this.animateFrameListener,(canceled=>onfinish(displayModel.id,canceled)))}firstRendering&&!this.visible&&(this.visible=!0,this.hide(!1)),this.changedStates=[],this.labelGroup.children.filter((element=>element.attributes.dataIsLabel)).forEach((shape=>shape.attributes.dataOriginPosition="")),this.updateLabelPosition(!0)}forceUpdate(){if(this.destroyed||!this.shapeMap.keyShape)return;const force=isPolylineWithObstacleAvoidance(this.displayModel),{sourcePoint,targetPoint,changed}=this.getEndPoints(this.displayModel);if(!force&&!changed)return;this.renderExt.setSourcePoint(sourcePoint),this.renderExt.setTargetPoint(targetPoint);const shapeMap=this.renderExt.draw(this.displayModel,sourcePoint,targetPoint,this.shapeMap);shapeMap.labelShape&&(shapeMap.labelShape.attributes.dataIsLabel=!0),shapeMap.labelBackgroundShape&&(shapeMap.labelBackgroundShape.attributes.dataIsLabelBackground=!0),this.shapeMap=updateShapes(this.shapeMap,shapeMap,this.group,this.labelGroup),this.labelGroup.children.filter((element=>element.attributes.dataIsLabel)).forEach((shape=>shape.attributes.dataOriginPosition="")),this.updateLabelPosition()}updateEnd(type,endItem){"source"===type?this.sourceItem=endItem:"target"===type&&(this.targetItem=endItem),this.draw(this.displayModel)}getEndPoints(displayModel){var _a;const{sourceAnchor,targetAnchor,keyShape}=displayModel.data,sourcePosition=this.sourceItem.getPosition(),targetPosition=this.targetItem.getPosition();if(!this.shouldUpdatePoints(sourcePosition,targetPosition,null==keyShape?void 0:keyShape.controlPoints))return{sourcePoint:this.cache.sourcePointCache,targetPoint:this.cache.targetPointCache,changed:!1};let targetPrevious=sourcePosition,sourcePrevious=targetPosition;if(null===(_a=null==keyShape?void 0:keyShape.controlPoints)||void 0===_a?void 0:_a.length){const controlPointsBesideEnds=keyShape.controlPoints.filter((point=>!point_isSamePoint(point,sourcePosition)&&!point_isSamePoint(point,targetPosition)));sourcePrevious=getNearestPoint(controlPointsBesideEnds,sourcePosition).nearestPoint,targetPrevious=getNearestPoint(controlPointsBesideEnds,targetPosition).nearestPoint}return this.cache.sourcePointCache=this.sourceItem.getAnchorPoint(sourcePrevious,sourceAnchor),this.cache.targetPointCache=this.targetItem.getAnchorPoint(targetPrevious,targetAnchor),{sourcePoint:this.cache.sourcePointCache,targetPoint:this.cache.targetPointCache,changed:!0}}shouldUpdatePoints(sourcePosition,targetPosition,controlPoints){const isComboEnd="combo"===this.sourceItem.type||"combo"===this.targetItem.type,changed=!(point_isSamePoint(sourcePosition,this.cache.sourcePositionCache)&&point_isSamePoint(targetPosition,this.cache.targetPositionCache)&&controlPoints===this.cache.controlPointsCache)||isComboEnd;return changed&&(this.cache.sourcePositionCache=sourcePosition,this.cache.targetPositionCache=targetPosition,this.cache.controlPointsCache=controlPoints),changed}updateLabelPosition(ignoreVisibility){const{graph,labelGroup}=this;if(!ignoreVisibility&&"hidden"===this.labelGroup.style.visibility)return;const zoom=graph.getZoom();labelGroup.children.forEach((shape=>{if(shape.attributes.dataIsLabelBackground)return void this.renderExt.drawLabelBackgroundShape(this.displayModel,this.shapeMap);if(shape.attributes.dataIsLabel){const{maxWidth}=this.renderExt.mergedStyles[shape.id]||{};maxWidth&&(shape.attributes.dataOriginWordWrapWidth||(shape.attributes.dataOriginWordWrapWidth=shape.style.wordWrapWidth),shape.style.wordWrapWidth=shape.attributes.dataOriginWordWrapWidth*zoom)}shape.attributes.dataOriginPosition||(shape.attributes.dataOriginPosition={x:shape.style.x,y:shape.style.y,z:shape.style.z});const viewportPosition=graph.getViewportByCanvas(shape.attributes.dataOriginPosition);shape.style.x=viewportPosition.x,shape.style.y=viewportPosition.y,shape.style.z=viewportPosition.z}))}clone(containerGroup,labelContainerGroup,sourceItem,targetItem,shapeIds,disableAnimate,visible,transientItemMap){if(null==shapeIds?void 0:shapeIds.length){const group=new Group;return shapeIds.forEach((shapeId=>{var _a;if(!this.shapeMap[shapeId]||this.shapeMap[shapeId].destroyed)return;const clonedKeyShape=this.shapeMap[shapeId].cloneNode();clonedKeyShape.style.opacity=(null===(_a=this.renderExt.mergedStyles[shapeId])||void 0===_a?void 0:_a.opacity)||1,group.appendChild(clonedKeyShape)})),containerGroup.appendChild(group),group}const clonedModel=(0,lodash_clone.A)(this.model);clonedModel.data.disableAnimate=disableAnimate,transientItemMap&&this.nodeMap.forEach(((node,id)=>{const transientItem=transientItemMap.get(id);transientItem&&transientItem.isVisible()&&"node"===transientItem.type&&this.nodeMap.set(id,transientItem)}));const clonedEdge=new Edge({model:clonedModel,graph:this.graph,renderExtensions:this.renderExtensions,sourceItem,targetItem,nodeMap:this.nodeMap,containerGroup,labelContainerGroup,mapper:this.mapper,stateMapper:this.stateMapper,zoom:this.zoom,theme:{styles:this.themeStyles,lodLevels:this.lodLevels}});return visible||Object.keys(this.shapeMap).forEach((shapeId=>{this.shapeMap[shapeId].isVisible()?clonedEdge.shapeMap[shapeId].show():clonedEdge.shapeMap[shapeId].hide()})),clonedEdge}}class Combo extends node_Node{constructor(props){super(Object.assign(Object.assign({},props),{type:"combo"})),this.forceUpdate=throttle((()=>{!this.destroyed&&this.shapeMap.keyShape&&(this.updateModelByBounds(this.displayModel),this.destroyed||this.draw(this.displayModel))}),16,{leading:!0,trailing:!0})}init(props){this.getCombinedBounds=props.getCombinedBounds,this.getChildren=props.getChildren,super.init(props)}draw(displayModel,diffData,diffState,animate=!0,onfinish=(()=>{})){displayModel.data.collapsed&&this.themeStyles.collapsed&&Object.keys(this.themeStyles.collapsed).forEach((shapeId=>{displayModel.data[shapeId]=displayModel.data[shapeId]||{},displayModel.data[shapeId]=Object.assign(Object.assign({},displayModel.data[shapeId]),this.themeStyles.collapsed[shapeId]),"childCount"===this.themeStyles.collapsed[shapeId].contentType&&(displayModel.data[shapeId].text=`${this.getChildren().length||0}`)})),super.draw(displayModel,diffData,diffState,animate,onfinish),this.changedStates=[]}getDisplayModelAndChanges(innerModel,diffData,isReplace){const superResult=super.getDisplayModelAndChanges(innerModel,diffData,isReplace),model=superResult.model;return{model:this.updateModelByBounds(model),typeChange:superResult.typeChange}}updateModelByBounds(model){const bounds=this.getCombinedBounds();if(this.cacheCombinedBounds=bounds,bounds){const{size,center}=bounds;if(model.data.x=center[0],model.data.y=center[1],model.data.z=center[2],!model.data.collapsed){model.data.keyShape=model.data.keyShape||{};const{padding=[0,0,0,0]}=model.data.keyShape,width=size[0]+padding[1]+padding[3],height=size[1]+padding[0]+padding[2];model.data.keyShape.width=width,model.data.keyShape.height=height,model.data.keyShape.r=Math.sqrt(width*width+height*height)/2}}return model}getPosition(){const{x=0,y=0,z=0}=this.model.data;this.cacheCombinedBounds=this.cacheCombinedBounds||this.getCombinedBounds();const{center}=this.cacheCombinedBounds||{};return center?{x:center[0],y:center[1],z:center[2]}:{x,y,z}}getIntersectPoint(point,innerPoint,anchorPoints){const{keyShape}=this.shapeMap,shapeType=keyShape.nodeName,{collapsed,keyShape:keyShapeStyle}=this.displayModel.data,{x,y,z}=innerPoint;let intersectPoint;if("circle"===shapeType)intersectPoint=getCircleIntersectByPoint({x,y,r:(collapsed?null==keyShapeStyle?void 0:keyShapeStyle.r:keyShape.attributes.r)||keyShape.attributes.r},point);else{const bbox=keyShape.getLocalBounds();intersectPoint=getRectIntersectByPoint(collapsed?{x:x-keyShapeStyle.width/2,y:y-keyShapeStyle.height/2,width:keyShapeStyle.width,height:keyShapeStyle.height}:{x:x+bbox.min[0],y:y+bbox.min[1],width:bbox.max[0]-bbox.min[0],height:bbox.max[1]-bbox.min[1]},point)}let anchorPointsPositions=this.anchorPointsCache;if(!anchorPointsPositions){const keyShapeBBox=this.shapeMap.keyShape.getLocalBounds(),keyShapeWidth=keyShapeBBox.max[0]-keyShapeBBox.min[0],keyShapeHeight=keyShapeBBox.max[1]-keyShapeBBox.min[1];anchorPointsPositions=anchorPoints.map((pointRatio=>{const[xRatio,yRatio]=pointRatio;return{x:keyShapeWidth*(xRatio-.5)+x,y:keyShapeHeight*(yRatio-.5)+y}})),this.anchorPointsCache=anchorPointsPositions}let linkPoint=intersectPoint;return anchorPoints.length&&(linkPoint||(linkPoint=point),linkPoint=getNearestPoint(anchorPointsPositions,linkPoint).nearestPoint),linkPoint||{x,y}}clone(containerGroup,labelContainerGroup,shapeIds,disableAnimate,getCombinedBounds,getChildren){if(null==shapeIds?void 0:shapeIds.length){const group=new Group;return shapeIds.forEach((shapeId=>{var _a;if(!this.shapeMap[shapeId]||this.shapeMap[shapeId].destroyed)return;const clonedKeyShape=this.shapeMap[shapeId].cloneNode();clonedKeyShape.style.opacity=(null===(_a=this.renderExt.mergedStyles[shapeId])||void 0===_a?void 0:_a.opacity)||1,group.appendChild(clonedKeyShape)})),group.setPosition(this.group.getPosition()),containerGroup.appendChild(group),group}const clonedModel=(0,lodash_clone.A)(this.model);clonedModel.data.disableAnimate=disableAnimate;const clonedNode=new Combo({model:clonedModel,graph:this.graph,renderExtensions:this.renderExtensions,containerGroup,labelContainerGroup,mapper:this.mapper,stateMapper:this.stateMapper,zoom:this.zoom,theme:{styles:this.themeStyles,lodLevels:this.lodLevels},getCombinedBounds:getCombinedBounds||this.getCombinedBounds,getChildren:getChildren||this.getChildren});return Object.keys(this.shapeMap).forEach((shapeId=>{var _a;this.shapeMap[shapeId].isVisible()?null===(_a=clonedNode.shapeMap[shapeId])||void 0===_a||_a.show():clonedNode.shapeMap[shapeId].hide()})),clonedNode}}var WARN_TYPE,item_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};!function(WARN_TYPE){WARN_TYPE[WARN_TYPE.FAIL_GET_BBOX=0]="FAIL_GET_BBOX",WARN_TYPE[WARN_TYPE.FAIL_GET_VISIBLE=1]="FAIL_GET_VISIBLE",WARN_TYPE[WARN_TYPE.FAIL_SET_STATE=2]="FAIL_SET_STATE",WARN_TYPE[WARN_TYPE.FAIL_GET_STATE=3]="FAIL_GET_STATE",WARN_TYPE[WARN_TYPE.FAIL_SET_VISIBLE=4]="FAIL_SET_VISIBLE",WARN_TYPE[WARN_TYPE.FAIL_DRAW_TRANSIENT=5]="FAIL_DRAW_TRANSIENT",WARN_TYPE[WARN_TYPE.SOURCE_NOT_EXIST=6]="SOURCE_NOT_EXIST",WARN_TYPE[WARN_TYPE.TARGET_NOT_EXIST=7]="TARGET_NOT_EXIST"}(WARN_TYPE||(WARN_TYPE={}));const getWarnMsg={[WARN_TYPE.FAIL_GET_BBOX]:ids=>`Fail to get items' bboxes, the items with ids ${ids.join(", ")} do not exist.`,[WARN_TYPE.FAIL_GET_VISIBLE]:ids=>`Fail to get items' visible, the items with ids ${ids.join(", ")} do not exist.`,[WARN_TYPE.FAIL_SET_STATE]:ids=>`Fail to set states for items ${ids.join(", ")}, which do not exist.`,[WARN_TYPE.FAIL_SET_VISIBLE]:ids=>`Fail to set visibility for items ${ids.join(", ")}, which do not exist.`,[WARN_TYPE.FAIL_DRAW_TRANSIENT]:ids=>`Fail to draw transient items of ${ids}, which do not exist.`,[WARN_TYPE.SOURCE_NOT_EXIST]:params=>`The source nodes ${params.map((p=>p.source)).join(", ")} do not exist in the graph for edges ${params.map((p=>p.id)).join(", ")}, please add the nodes first`,[WARN_TYPE.TARGET_NOT_EXIST]:params=>`The target nodes ${params.map((p=>p.target)).join(", ")} do not exist in the graph for edges ${params.map((p=>p.id)).join(", ")}, please add the nodes first`,[WARN_TYPE.FAIL_GET_STATE]:ids=>`Fail to get items' states, the items with ids ${ids.join(", ")} do not exist.`};class ItemController{constructor(graph){this.nodeExtensions=[],this.edgeExtensions=[],this.comboExtensions=[],this.itemMap=new Map,this.nodeDataTypeSet=new Set,this.edgeDataTypeSet=new Set,this.comboDataTypeSet=new Set,this.transientObjectMap=new Map,this.transientItemMap=new Map,this.nearEdgesCache=new Map,this.cacheWarnMsg={},this.groupItemsByView=(containType="inside",ratio=1)=>{const range=this.graph.getCanvasRange(),items=Array.from(this.itemMap,(([key,value])=>value)),containFunc="intersect"===containType?intersectBBox:isBBoxInBBox;let{inView:itemsInView,outView:itemsOutView}=this.cacheViewItems||{};return ratio&&1!==ratio&&this.cacheViewItems?ratio<1?itemsOutView.forEach((item=>{const{keyShape}=item.shapeMap;if(!keyShape)return;const renderBounds=keyShape.getRenderBounds();containFunc(renderBounds,range,.4)&&itemsInView.push(item)})):ratio>1&&itemsInView.forEach((item=>{const{keyShape}=item.shapeMap;if(!keyShape)return;const renderBounds=keyShape.getRenderBounds();containFunc(renderBounds,range,.4)||itemsOutView.push(item)})):(itemsInView=[],itemsOutView=[],items.forEach((item=>{const{keyShape}=item.shapeMap;if(!keyShape)return;const renderBounds=keyShape.getRenderBounds();containFunc(renderBounds,range,.4)?itemsInView.push(item):itemsOutView.push(item)}))),this.cacheViewItems={inView:itemsInView,outView:itemsOutView},{items,inView:itemsInView,outView:itemsOutView}},this.onViewportChange=lodash_debounce((({transform,effectTiming,tileLodSize=1e3})=>{const{zoom}=transform;if(zoom){const zoomRatio=this.graph.getZoom(),{items,inView:itemsInview,outView:itemsOutView}=this.groupItemsByView(),sortedItems=itemsInview.concat(itemsOutView),sections=Math.ceil(items.length/tileLodSize),itemSections=Array.from({length:sections},((v,i)=>sortedItems.slice(i*tileLodSize,i*tileLodSize+tileLodSize)));let requestId;const update=()=>{itemSections.length?(itemSections.shift().forEach((item=>item.updateZoom(zoomRatio))),requestId=requestAnimationFrame(update)):cancelAnimationFrame(requestId)};requestId=requestAnimationFrame(update),this.zoom=zoomRatio}}),500,!1),this.onThemeChange=({theme})=>{if(!theme)return;const{nodeDataTypeSet,edgeDataTypeSet}=this,{node:nodeTheme,edge:edgeTheme}=theme;this.itemMap.forEach((item=>{const itemTye=item.getType(),usingTheme="node"===itemTye?nodeTheme:edgeTheme,usingTypeSet="node"===itemTye?nodeDataTypeSet:edgeDataTypeSet,{dataTypeField}=usingTheme;let dataType;dataTypeField&&(dataType=item.model.data[dataTypeField]);const itemTheme=getItemTheme(usingTypeSet,dataTypeField,dataType,usingTheme);item.update(item.model,void 0,!1,itemTheme)}))},this.onMapperChange=({type,mapper})=>{mapper&&(this[`${type}Mapper`]=mapper,this.itemMap.forEach((item=>{item.getType()===type&&(item.mapper=mapper,item.update(item.model,void 0,!1))})))},this.onDestroy=()=>{Object.values(this.itemMap).forEach((item=>item.destroy())),this.itemMap.clear()},this.debounceWarn=lodash_debounce((type=>{const msg=getWarnMsg[type](this.cacheWarnMsg[type]);console.warn(msg),this.cacheWarnMsg[type]=[]}),16,!1),this.graph=graph;const{node,edge,combo,nodeState={},edgeState={},comboState={}}=graph.getSpecification();this.nodeMapper=node,this.edgeMapper=edge,this.comboMapper=combo,this.nodeStateMapper=nodeState,this.edgeStateMapper=edgeState,this.comboStateMapper=comboState,this.tap()}tap(){const extensions=this.getExtensions();this.nodeExtensions=extensions.node,this.edgeExtensions=extensions.edge,this.comboExtensions=extensions.combo,this.graph.hooks.render.tap(this.onRender.bind(this)),this.graph.hooks.itemchange.tap(this.onChange.bind(this)),this.graph.hooks.itemstatechange.tap(this.onItemStateChange.bind(this)),this.graph.hooks.itemstateconfigchange.tap(this.onItemStateConfigChange.bind(this)),this.graph.hooks.itemvisibilitychange.tap(this.onItemVisibilityChange.bind(this)),this.graph.hooks.itemzindexchange.tap(this.onItemZIndexChange.bind(this)),this.graph.hooks.transientupdate.tap(this.onTransientUpdate.bind(this)),this.graph.hooks.viewportchange.tap(this.onViewportChange.bind(this)),this.graph.hooks.themechange.tap(this.onThemeChange.bind(this)),this.graph.hooks.mapperchange.tap(this.onMapperChange.bind(this)),this.graph.hooks.treecollapseexpand.tap(this.onTreeCollapseExpand.bind(this)),this.graph.hooks.destroy.tap(this.onDestroy.bind(this))}getExtensions(){const{node,edge,combo}=this.graph.getSpecification(),nodeTypes=Object.keys(stdlib.useLib.nodes||{}),edgeTypes=Object.keys(stdlib.useLib.edges||{}),comboTypes=Object.keys(stdlib.useLib.combos||{});return{node:nodeTypes.map((config=>getExtension(config,stdlib.useLib,"node"))).filter(Boolean),edge:edgeTypes.map((config=>getExtension(config,stdlib.useLib,"edge"))).filter(Boolean),combo:comboTypes.map((config=>getExtension(config,stdlib.useLib,"combo"))).filter(Boolean)}}onRender(param){return item_awaiter(this,void 0,void 0,(function*(){const{graphCore,theme={},transientCanvas,transientLabelCanvas,tileOptimize={}}=param,{graph}=this;if(graph.canvas.removeChildren(),graph.labelCanvas.removeChildren(),graph.transientCanvas.removeChildren(),this.itemMap.forEach((item=>item.destroy())),this.itemMap.clear(),this.comboGroup=new Group({id:"combo-group",style:{zIndex:0}}),this.edgeGroup=new Group({id:"edge-group",style:{zIndex:1}}),this.nodeGroup=new Group({id:"node-group",style:{zIndex:2}}),this.edgeLabelGroup=new Group({id:"node-label-group",style:{zIndex:0}}),this.nodeLabelGroup=new Group({id:"node-label-group",style:{zIndex:1}}),graph.canvas.appendChild(this.comboGroup),graph.canvas.appendChild(this.edgeGroup),graph.canvas.appendChild(this.nodeGroup),graph.labelCanvas.appendChild(this.edgeLabelGroup),graph.labelCanvas.appendChild(this.nodeLabelGroup),transientCanvas.removeChildren(),this.transientComboGroup=new Group({id:"combo-group",style:{zIndex:0}}),this.transientEdgeGroup=new Group({id:"edge-group",style:{zIndex:1}}),this.transientNodeGroup=new Group({id:"node-group",style:{zIndex:2}}),transientCanvas.appendChild(this.transientComboGroup),transientCanvas.appendChild(this.transientEdgeGroup),transientCanvas.appendChild(this.transientNodeGroup),this.transientEdgeLabelGroup=new Group({id:"node-label-group",style:{zIndex:0}}),this.transientNodeLabelGroup=new Group({id:"node-label-group",style:{zIndex:1}}),transientLabelCanvas.appendChild(this.transientEdgeLabelGroup),transientLabelCanvas.appendChild(this.transientNodeLabelGroup),"webgl-3d"===graph.rendererType){const ambientLight=new AmbientLight({style:{fill:"white",intensity:2*Math.PI}}),light=new DirectionalLight({style:{fill:"white",direction:[-1,0,1],intensity:.7*Math.PI}});graph.canvas.appendChild(ambientLight),graph.canvas.appendChild(light);const{width,height}=graph.canvas.getConfig();graph.canvas.getCamera().setPerspective(.1,5e4,45,width/height)}const{nodes,edges,combos}=deconstructData({nodes:graphCore.getAllNodes(),edges:graphCore.getAllEdges()}),renderNodesPromise=this.renderNodes(nodes,theme.node,tileOptimize);let nodesInView;renderNodesPromise&&(nodesInView=yield renderNodesPromise),this.renderCombos(combos,theme.combo,graphCore);const renderEdgesPromise=this.renderEdges(edges,theme.edge,tileOptimize,nodesInView);if(renderEdgesPromise&&(yield renderEdgesPromise),this.sortByComboTree(graphCore),graphCore.hasTreeStructure("combo")&&graphCoreTreeDfs(graphCore,graphCore.getRoots("combo"),(child=>{child.data.collapsed&&this.collapseCombo(graphCore,child)}),"BT","combo"),graphCore.hasTreeStructure("tree")){const collapseNodes=[];graphCoreTreeDfs(graphCore,graphCore.getRoots("tree"),(child=>{child.data.collapsed&&collapseNodes.push(child)}),"BT","tree"),this.collapseSubTree(collapseNodes,graphCore,!1)}}))}onChange(param){const{changes,graphCore,action,animate=!0,upsertAncestors=!0,theme={},callback=()=>{}}=param,groupedChanges=((graphCore,changes)=>{const groupedChanges={NodeRemoved:[],EdgeRemoved:[],NodeAdded:[],EdgeAdded:[],NodeDataUpdated:[],EdgeUpdated:[],EdgeDataUpdated:[],TreeStructureChanged:[],ComboStructureChanged:[],TreeStructureAttached:[],TreeStructureDetached:[]};return changes.forEach((change=>{const{type:changeType}=change;if(["NodeDataUpdated","EdgeUpdated","EdgeDataUpdated"].includes(changeType)){const{id:oid}=change;if(!graphCore.hasNode(oid)&&!graphCore.hasEdge(oid)){const nid=Number(oid);return void((!isNaN(nid)&&graphCore.hasNode(nid)||graphCore.hasEdge(nid))&&groupedChanges[changeType].push(Object.assign(Object.assign({},change),{id:nid})))}}else{if("TreeStructureChanged"===changeType)return void("combo"===change.treeKey?groupedChanges.ComboStructureChanged.push(change):"tree"===change.treeKey&&groupedChanges.TreeStructureChanged.push(change));if(["NodeRemoved","EdgeRemoved","TreeStructureAttached","TreeStructureDetached"].includes(changeType))groupedChanges[changeType].push(change);else{const{id:oid}=change.value;if(!graphCore.hasNode(oid)&&!graphCore.hasEdge(oid)){const nid=Number(oid);return void((!isNaN(nid)&&graphCore.hasNode(nid)||graphCore.hasEdge(nid))&&groupedChanges[changeType].push(Object.assign(Object.assign({},change),{value:Object.assign(Object.assign({},change.value),{id:nid})})))}}}groupedChanges[changeType].push(change)})),groupedChanges})(graphCore,changes),{itemMap}=this;[...groupedChanges.EdgeRemoved,...groupedChanges.NodeRemoved].forEach((({value})=>{const{id}=value,item=itemMap.get(id);item&&(item.destroy(),itemMap.delete(id))}));const{node:nodeTheme={},edge:edgeTheme={},combo:comboTheme={}}=theme;if(groupedChanges.NodeAdded.length){const newNodes=[],newCombos=[];groupedChanges.NodeAdded.map((change=>change.value)).forEach((model=>{model.data._isCombo?newCombos.push(model):newNodes.push(model)})),newNodes.length&&this.renderNodes(newNodes,nodeTheme),newCombos.length&&this.renderCombos(newCombos,comboTheme,graphCore)}if(groupedChanges.EdgeAdded.length&&this.renderEdges(groupedChanges.EdgeAdded.map((change=>change.value)),edgeTheme),groupedChanges.NodeDataUpdated.length){const nodeComboUpdate={};groupedChanges.NodeDataUpdated.forEach((change=>{const{id,propertyName,newValue,oldValue}=change;nodeComboUpdate[id]=nodeComboUpdate[id]||{id,previous:{},current:{}},propertyName?(nodeComboUpdate[id].previous[propertyName]=oldValue,nodeComboUpdate[id].current[propertyName]=newValue):nodeComboUpdate[id]={id,isReplace:!0,previous:oldValue,current:newValue}}));const{dataTypeField:nodeDataTypeField}=nodeTheme,edgeIdsToUpdate=new Set,comboIdsToUpdate=new Set,updateRelates=param=>{const{edgeIds,callback}=param;edgeIds.forEach((nid=>{const item=itemMap.get(nid);item&&!item.destroyed&&item.forceUpdate()})),null==callback||callback()},debounceUpdateAllRelates=lodash_debounce((()=>{[...comboIdsToUpdate,...edgeIdsToUpdate].forEach((nid=>{const item=itemMap.get(nid);item&&!item.destroyed&&item.forceUpdate()}))}),16,!1),debounceUpdateRelates=lodash_debounce(updateRelates,16,!1);Object.values(nodeComboUpdate).forEach((updateObj=>{const{isReplace,previous,current,id}=updateObj;if(!graphCore.hasNode(id))return;const onlyMove="updatePosition"===action,item=itemMap.get(id);if(!item||item.destroyed)return;const type=item.getType(),innerModel=graphCore.getNode(id);if("node"===type&&onlyMove){const{x,y,fx,fy}=current;if(isNaN(x)&&isNaN(y)&&isNaN(fx)&&isNaN(fy))return void callback(innerModel,!0)}const nodeRelatedIdsToUpdate=new Set;if(graphCore.hasTreeStructure("combo")){"combo"===type&&current.collapsed!==previous.collapsed&&(current.collapsed?this.collapseCombo(graphCore,innerModel):!1===current.collapsed&&this.expandCombo(graphCore,innerModel));const previousParentId=item.displayModel.data.parentId||previous.parentId;if(upsertAncestors){const begins=[innerModel];previousParentId&&previousParentId!==current.parentId&&graphCore.hasNode(previousParentId)&&begins.push(graphCore.getNode(previousParentId)),traverseAncestorsAndSucceeds(this.graph,graphCore,begins,(treeItem=>{treeItem.data._isCombo&&treeItem.id!==innerModel.id&&comboIdsToUpdate.add(treeItem.id);graphCore.getRelatedEdges(treeItem.id).forEach((edge=>{edgeIdsToUpdate.add(edge.id),nodeRelatedIdsToUpdate.add(edge.id)}))}))}else"combo"===type&&graphComboTreeDfs(this.graph,[innerModel],(child=>{graphCore.getRelatedEdges(child.id).forEach((edge=>{edgeIdsToUpdate.add(edge.id),nodeRelatedIdsToUpdate.add(edge.id)})),child.data._isCombo&&child.id!==innerModel.id&&comboIdsToUpdate.add(child.id)}))}let itemTheme;nodeDataTypeField&&previous[nodeDataTypeField]!==current[nodeDataTypeField]&&(itemTheme=getItemTheme(this.nodeDataTypeSet,nodeDataTypeField,current[nodeDataTypeField],nodeTheme));const adjacentEdgeInnerModels=graphCore.getRelatedEdges(id);if(isPointPreventPolylineOverlap(innerModel)){const newNearEdges=this.graph.getNearEdgesData(id,(edge=>isPolylineWithObstacleAvoidance(edge))),prevNearEdges=this.nearEdgesCache.get(id)||[];adjacentEdgeInnerModels.push(...newNearEdges),adjacentEdgeInnerModels.push(...prevNearEdges),this.nearEdgesCache.set(id,newNearEdges)}let statesCache;adjacentEdgeInnerModels.forEach((edge=>{edgeIdsToUpdate.add(edge.id),nodeRelatedIdsToUpdate.add(edge.id)})),item.onframe=()=>updateRelates({edgeIds:nodeRelatedIdsToUpdate}),innerModel.data._isCombo&&previous.collapsed!==current.collapsed&&(statesCache=this.graph.getItemAllStates(id),this.graph.clearItemState(id)),item.update(innerModel,{previous,current},isReplace,itemTheme,onlyMove,animate,((_,canceled)=>{item.onframe=void 0,statesCache&&statesCache.forEach((state=>this.graph.setItemState(id,state,!0))),debounceUpdateRelates({edgeIds:nodeRelatedIdsToUpdate,callback:()=>callback(innerModel,canceled)})}));const parentItem=this.itemMap.get(current.parentId);current.parentId&&(null==parentItem?void 0:parentItem.model.data.collapsed)&&this.graph.executeWithNoStack((()=>{this.graph.hideItem(innerModel.id,{disableAnimate:!1})}))})),debounceUpdateAllRelates()}if(groupedChanges.EdgeDataUpdated.length){const edgeUpdate={};groupedChanges.EdgeDataUpdated.forEach((change=>{const{id,propertyName,newValue,oldValue}=change;edgeUpdate[id]=edgeUpdate[id]||{id,previous:{},current:{}},propertyName?(edgeUpdate[id].previous[propertyName]=oldValue,edgeUpdate[id].current[propertyName]=newValue):edgeUpdate[id]={id,isReplace:!0,previous:oldValue,current:newValue}}));const{dataTypeField:edgeDataTypeField=""}=edgeTheme;Object.values(edgeUpdate).forEach((updateObj=>{const{isReplace,current,previous,id}=updateObj;let itemTheme;previous[edgeDataTypeField]!==current[edgeDataTypeField]&&(itemTheme=getItemTheme(this.edgeDataTypeSet,edgeDataTypeField,current[edgeDataTypeField],edgeTheme));const item=itemMap.get(id),innerModel=graphCore.getEdge(id);item&&!item.destroyed&&item.update(innerModel,{current,previous},isReplace,itemTheme,void 0,animate,((_,canceled)=>callback(innerModel,canceled)))}))}if(groupedChanges.EdgeUpdated.length){const edgeUpdate={};groupedChanges.EdgeUpdated.forEach((change=>{const{id,propertyName,newValue}=change;edgeUpdate[id]=edgeUpdate[id]||{id},edgeUpdate[id][propertyName]=newValue})),Object.values(edgeUpdate).forEach((updateObj=>{const{source,target,id}=updateObj,item=itemMap.get(id);void 0!==source&&item.updateEnd("source",this.itemMap.get(source)),void 0!==target&&item.updateEnd("target",this.itemMap.get(target))}))}groupedChanges.ComboStructureChanged.length&&this.sortByComboTree(graphCore),groupedChanges.TreeStructureChanged.length&&groupedChanges.TreeStructureChanged.forEach((change=>{const{nodeId}=change;let parent=graphCore.getParent(nodeId,"tree");for(;parent;){if(parent.data.collapsed){this.graph.hideItem(nodeId,{disableAnimate:!0});break}parent=graphCore.getParent(parent.id,"tree")}}))}onItemStateChange(param){const{ids,states,value}=param;ids.forEach((id=>{const item=this.itemMap.get(id);if(!item)return this.cacheWarnMsg[WARN_TYPE.FAIL_SET_STATE]=this.cacheWarnMsg[WARN_TYPE.FAIL_SET_STATE]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_SET_STATE].push(id),void this.debounceWarn(WARN_TYPE.FAIL_SET_STATE);states&&value?states.forEach((state=>item.setState(state,value))):item.clearStates(states)}))}onItemStateConfigChange(param){const{itemType,stateConfig}=param;this[`${itemType}StateMapper`]=stateConfig,this.graph.getAllNodesData().forEach((node=>{const item=this.itemMap.get(node.id);item&&(item.stateMapper=stateConfig)}))}onItemVisibilityChange(param){const{ids,shapeIds,value,graphCore,animate=!0,keepKeyShape=!1,keepRelated=!1}=param;ids.forEach((id=>{const item=this.itemMap.get(id);if(!item)return this.cacheWarnMsg[WARN_TYPE.FAIL_SET_VISIBLE]=this.cacheWarnMsg[WARN_TYPE.FAIL_SET_VISIBLE]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_SET_VISIBLE].push(id),void this.debounceWarn(WARN_TYPE.FAIL_SET_VISIBLE);if(null==shapeIds?void 0:shapeIds.length)return void(value?item.show(animate,shapeIds):item.hide(animate,!1,shapeIds));const type=item.getType();if(value)if("edge"===type)item.show(animate),item.forceUpdate();else{if(graphCore.hasTreeStructure("combo")){let anccestorCollapsed=!1;if(traverseAncestors(graphCore,[item.model],(model=>(model.data.collapsed&&(anccestorCollapsed=!0),anccestorCollapsed))),anccestorCollapsed)return}const relatedEdges=graphCore.getRelatedEdges(id);item.show(animate),relatedEdges.forEach((({id:edgeId,source,target})=>{var _a;this.getItemVisible(source)&&this.getItemVisible(target)&&(null===(_a=this.itemMap.get(edgeId))||void 0===_a||_a.show(animate))}))}else if(item.hide(animate,keepKeyShape),"edge"!==type&&!keepRelated){graphCore.getRelatedEdges(id).forEach((({id:edgeId})=>{var _a;null===(_a=this.itemMap.get(edgeId))||void 0===_a||_a.hide(animate)}))}}))}onItemZIndexChange(params){const{ids=[],action,graphCore}=params;ids.forEach((id=>{const item=this.itemMap.get(id);item&&("front"===action?(item.toFront(),graphCore.hasTreeStructure("combo")&&graphComboTreeDfs(this.graph,[item.model],(model=>{if(model.data._isCombo){const subCombo=this.itemMap.get(model.id);subCombo&&subCombo.toFront()}}),"TB")):(item.toBack(),graphCore.hasTreeStructure("combo")&&traverseGraphAncestors(this.graph,[item.model],(model=>{var _a;null===(_a=this.itemMap.get(model.id))||void 0===_a||_a.toBack()}))))}))}onTransientUpdate(param){var _a,_b;const{transientObjectMap}=this,{type,id,config={},canvas,graphCore}=param,{style={},data={},capture,action,shapeIds,drawSource,drawTarget,upsertAncestors,visible=!0}=config,isItemType="node"===type||"edge"===type||"combo"===type;if("remove"===action){if(isItemType){const transientItem=this.transientItemMap.get(id);return"combo"===type&&graphCoreTreeDfs(graphCore,[graphCore.getNode(id)],(child=>{const transientChild=this.transientItemMap.get(child.id);transientChild&&!transientChild.destroyed&&transientChild.destroy(),this.transientItemMap.delete(child.id)}),"BT"),transientItem&&!transientItem.destroyed&&((null===(_b=(_a=transientItem).getType)||void 0===_b?void 0:_b.call(_a))||transientItem.remove(),transientItem.destroy()),void this.transientItemMap.delete(id)}{const preObj=transientObjectMap.get(id);return preObj&&!preObj.destroyed&&preObj.destroy(),void transientObjectMap.delete(id)}}if(isItemType){const item=this.itemMap.get(id);if(!item)return this.cacheWarnMsg[WARN_TYPE.FAIL_DRAW_TRANSIENT]=this.cacheWarnMsg[WARN_TYPE.FAIL_DRAW_TRANSIENT]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_DRAW_TRANSIENT].push(id),void this.debounceWarn(WARN_TYPE.FAIL_DRAW_TRANSIENT);const transientItem=upsertTransientItem(item,this.transientNodeGroup,this.transientEdgeGroup,this.transientComboGroup,this.transientNodeLabelGroup,this.transientEdgeLabelGroup,this.transientItemMap,this.itemMap,graphCore,{shapeIds,drawSource,drawTarget,visible},upsertAncestors);if(shapeIds){if(("node"===type||"combo"===type)&&data.hasOwnProperty("x")&&data.hasOwnProperty("y")){const{x,y}=data;transientItem.setPosition([x,y])}}else{const transItem=transientItem,positionChanged=data.hasOwnProperty("x")&&data.hasOwnProperty("y");if("combo"===type&&positionChanged){const{x,y}=data,{x:ox=x,y:oy=y}=transItem.displayModel.data,dx=x-ox,dy=y-oy;graphCoreTreeDfs(graphCore,[transItem.model],(node=>{const transChild=this.transientItemMap.get(node.id);if(!transChild)return;const{x:childX=0,y:childY=0}=transChild.model.data;null==transChild||transChild.update(Object.assign(Object.assign({},transChild.model),{data:Object.assign(Object.assign({},transChild.model.data),{x:childX+dx,y:childY+dy})}))}),"BT")}if(graphCore.hasTreeStructure("combo")&&"edge"!==type&&positionChanged){let currentAncestor=graphCore.getParent(transItem.model.id,"combo");for(;currentAncestor;){const ancestorItem=this.transientItemMap.get(currentAncestor.id);ancestorItem&&ancestorItem.forceUpdate(),currentAncestor=graphCore.getParent(currentAncestor.id,"combo")}}if(transItem.update(Object.assign(Object.assign({},transItem.model),{data:Object.assign(Object.assign({},transItem.model.data),data)})),"edge"!==type){graphCore.getRelatedEdges(transItem.model.id).forEach((relatedEdge=>{const transientEdge=this.transientItemMap.get(relatedEdge.id);transientEdge&&transientEdge.forceUpdate()}))}}return}const idStr=String(id),shape=upsertShape(type,idStr,style,{shapeMap:Object.fromEntries(transientObjectMap)});transientObjectMap.set(idStr,shape),shape.style.pointerEvents=capture?"auto":"none",null===shape.parentNode&&canvas.getRoot().appendChild(shape)}getTransient(id){return this.transientObjectMap.get(id)}getTransientItem(id){return this.transientItemMap.get(id)}getItemMap(){return this.itemMap}findDisplayModel(id){const item=this.itemMap.get(id);return item?{id,data:Object.assign(Object.assign(Object.assign({},item.displayModel.data),item.renderExt.mergedStyles),{lodLevels:item.lodLevels})}:{id,data:{}}}renderNodes(models,nodeTheme={},tileOptimize){return item_awaiter(this,void 0,void 0,(function*(){const{nodeExtensions,nodeGroup,nodeLabelGroup,nodeDataTypeSet,graph}=this,{dataTypeField=""}=nodeTheme,{tileFirstRender,tileFirstRenderSize=1e3}=tileOptimize||{},zoom=graph.getZoom(),delayFirstDraw=(0,is_number.A)(tileFirstRender)?models.length>tileFirstRender:tileFirstRender,itemsInView=[],itemsOutView=[],viewRange=this.graph.getCanvasRange();if(models.forEach((node=>{let dataType;dataTypeField&&(dataType=node.data[dataTypeField]);const itemTheme=getItemTheme(nodeDataTypeSet,dataTypeField,dataType,nodeTheme),nodeItem=new node_Node({graph,delayFirstDraw,model:node,renderExtensions:nodeExtensions,containerGroup:nodeGroup,labelContainerGroup:nodeLabelGroup,mapper:this.nodeMapper,stateMapper:this.nodeStateMapper,zoom,theme:itemTheme,device:"webgl-3d"===graph.rendererType?graph.canvas.context.deviceRendererPlugin.getDevice():void 0});this.itemMap.set(node.id,nodeItem);const{x,y}=nodeItem.model.data;delayFirstDraw&&((point,bbox)=>{const{x,y}=point;return x>bbox.min[0]&&x<bbox.max[0]&&y>bbox.min[1]&&y<bbox.max[1]})({x,y},viewRange)?itemsInView.push(nodeItem):itemsOutView.push(nodeItem)})),delayFirstDraw){let requestId;const sectionNum=Math.ceil(itemsOutView.length/tileFirstRenderSize),sections=Array.from({length:sectionNum},((v,i)=>itemsOutView.slice(i*tileFirstRenderSize,i*tileFirstRenderSize+tileFirstRenderSize)));sections.unshift(itemsInView);const update=resolve=>{if(!sections.length)return cancelAnimationFrame(requestId),resolve(itemsInView);sections.shift().forEach((item=>item.draw(item.displayModel,void 0,void 0,!item.displayModel.data.disableAnimate))),requestId=requestAnimationFrame((()=>update(resolve)))};return new Promise((resolve=>{requestId=requestAnimationFrame((()=>update(resolve)))}))}}))}renderCombos(models,comboTheme={},graphCore){return item_awaiter(this,void 0,void 0,(function*(){const{comboExtensions,comboGroup,comboDataTypeSet,graph,itemMap}=this,{dataTypeField=""}=comboTheme,zoom=graph.getZoom();models.forEach((combo=>{let dataType;dataTypeField&&(dataType=combo.data[dataTypeField]);const itemTheme=getItemTheme(comboDataTypeSet,dataTypeField,dataType,comboTheme),getCombinedBounds=()=>((graph,models)=>{if(!models.length)return!1;const resBounds={center:[0,0,0],min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0],size:[0,0,0]};let validCounts=0;return models.forEach((item=>{const bounds=graph.getRenderBBox(item.model.id);if(bounds){if(item.model.data._isCombo){const{center:childComboCenter}=item.getCombinedBounds()||{};childComboCenter&&["min","max","center"].forEach((field=>{bounds[field]=bounds[field].map(((val,i)=>val-bounds.center[i]+childComboCenter[i]))}))}validCounts++;const{min,max}=bounds;min.forEach(((val,i)=>{val<resBounds.min[i]&&(resBounds.min[i]=val)})),max.forEach(((val,i)=>{val>resBounds.max[i]&&(resBounds.max[i]=val)}))}})),!!validCounts&&(resBounds.size=resBounds.size.map(((val,i)=>resBounds.max[i]-resBounds.min[i])),resBounds.center=resBounds.center.map(((val,i)=>(resBounds.max[i]+resBounds.min[i])/2)),resBounds)})(graph,graphCore.getChildren(combo.id,"combo").map((({id})=>itemMap.get(id))).filter(Boolean)),getChildren=()=>graphCore.getChildren(combo.id,"combo").map((({id})=>itemMap.get(id))),comboItem=new Combo({model:combo,graph:this.graph,getCombinedBounds,getChildren,renderExtensions:comboExtensions,containerGroup:comboGroup,labelContainerGroup:this.nodeLabelGroup,mapper:this.comboMapper,stateMapper:this.comboStateMapper,zoom,theme:itemTheme,device:"webgl-3d"===graph.rendererType?graph.canvas.context.deviceRendererPlugin.getDevice():void 0});comboItem.getCombinedBounds=getCombinedBounds,comboItem.getChildren=getChildren,comboItem.type="combo",itemMap.set(combo.id,comboItem)}))}))}renderEdges(models,edgeTheme={},tileOptimize,nodesInView){const{edgeExtensions,edgeGroup,edgeLabelGroup,itemMap,edgeDataTypeSet,graph}=this,{dataTypeField=""}=edgeTheme,{tileFirstRender,tileFirstRenderSize=1e3}=tileOptimize||{},zoom=graph.getZoom(),nodeMap=filterItemMapByType(itemMap,"node"),delayFirstDraw=(0,is_number.A)(tileFirstRender)?models.length>tileFirstRender:tileFirstRender,nodesInViewIds=new Set(null==nodesInView?void 0:nodesInView.map((node=>node.getID()))),edgesInView=[],edgesOutView=[];if(models.forEach((edge=>{const{source,target,id}=edge,sourceItem=itemMap.get(source),targetItem=itemMap.get(target);if(!sourceItem)return this.cacheWarnMsg[WARN_TYPE.SOURCE_NOT_EXIST]=this.cacheWarnMsg[WARN_TYPE.SOURCE_NOT_EXIST]||[],this.cacheWarnMsg[WARN_TYPE.SOURCE_NOT_EXIST].push({id,source}),void this.debounceWarn(WARN_TYPE.SOURCE_NOT_EXIST);if(!targetItem)return this.cacheWarnMsg[WARN_TYPE.TARGET_NOT_EXIST]=this.cacheWarnMsg[WARN_TYPE.TARGET_NOT_EXIST]||[],this.cacheWarnMsg[WARN_TYPE.TARGET_NOT_EXIST].push({id,source}),void this.debounceWarn(WARN_TYPE.TARGET_NOT_EXIST);let dataType;dataTypeField&&(dataType=edge.data[dataTypeField]);const itemTheme=getItemTheme(edgeDataTypeSet,dataTypeField,dataType,edgeTheme),edgeItem=new Edge({graph,delayFirstDraw,model:edge,renderExtensions:edgeExtensions,containerGroup:edgeGroup,labelContainerGroup:edgeLabelGroup,mapper:this.edgeMapper,stateMapper:this.edgeStateMapper,sourceItem,targetItem,nodeMap,zoom,theme:itemTheme});return itemMap.set(id,edgeItem),nodesInViewIds.has(source)||nodesInViewIds.has(target)?edgesInView.push(edgeItem):edgesOutView.push(edgeItem),edgeItem})),delayFirstDraw){let requestId;const sectionNum=Math.ceil(edgesOutView.length/tileFirstRenderSize),sections=Array.from({length:sectionNum},((v,i)=>edgesOutView.slice(i*tileFirstRenderSize,i*tileFirstRenderSize+tileFirstRenderSize)));sections.unshift(edgesInView);const update=resolve=>{if(!sections.length)return cancelAnimationFrame(requestId),resolve();sections.shift().forEach((item=>item.draw(item.displayModel))),requestId=requestAnimationFrame((()=>update(resolve)))};return new Promise((resolve=>{requestId=requestAnimationFrame((()=>update(resolve)))}))}}findIdByState(itemType,state,value=!0){const ids=[];return this.itemMap.forEach((item=>{item.getType()===itemType&&item.hasState(state)===value&&ids.push(item.getID())})),ids}getItemState(id,state){const item=this.itemMap.get(id);return item?item.hasState(state):(this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE]=this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE].push(id),this.debounceWarn(WARN_TYPE.FAIL_GET_STATE),!1)}getItemAllStates(id){const item=this.itemMap.get(id);return item?item.getStates().filter((({value})=>value)).map((({name})=>name)):(this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE]=this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_GET_STATE].push(id),this.debounceWarn(WARN_TYPE.FAIL_GET_STATE),[])}getItemById(id){return this.itemMap.get(id)}getItemBBox(id,isKeyShape=!1,isTransient=!1){const item=isTransient?this.transientItemMap.get(id):this.itemMap.get(id);return item?item instanceof Group?item.getRenderBounds():isKeyShape?item.getKeyBBox():item.getBBox():(this.cacheWarnMsg[WARN_TYPE.FAIL_GET_BBOX]=this.cacheWarnMsg[WARN_TYPE.FAIL_GET_BBOX]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_GET_BBOX].push(id),this.debounceWarn(WARN_TYPE.FAIL_GET_BBOX),!1)}getItemVisibleShapeIds(id){const item=this.itemMap.get(id),shapeIds=[];return Object.keys(item.shapeMap).forEach((shapeId=>{var _a;"hidden"!==(null===(_a=item.shapeMap[shapeId])||void 0===_a?void 0:_a.attributes.visibility)&&shapeIds.push(shapeId)})),shapeIds}getItemVisible(id){const item=this.itemMap.get(id);if(!item)return this.cacheWarnMsg[WARN_TYPE.FAIL_GET_VISIBLE]=this.cacheWarnMsg[WARN_TYPE.FAIL_GET_VISIBLE]||[],this.cacheWarnMsg[WARN_TYPE.FAIL_GET_VISIBLE].push(id),this.debounceWarn(WARN_TYPE.FAIL_GET_VISIBLE),!1;const transientVisible=this.transientItemMap.get(id);return item.isVisible()||(null==transientVisible?void 0:transientVisible.isVisible())}sortByComboTree(graphCore){graphCore.hasTreeStructure("combo")&&graphCoreTreeDfs(graphCore,graphCore.getRoots("combo"),(node=>{const nodeItem=this.itemMap.get(node.id);node.data._isCombo&&nodeItem&&nodeItem.toFront()}))}collapseCombo(graphCore,comboModel){let relatedEdges=[];const succeedIds=[];graphComboTreeDfs(this.graph,[comboModel],(child=>{child.id!==comboModel.id&&this.graph.executeWithNoStack((()=>{this.graph.hideItem(child.id,{disableAnimate:!1})})),relatedEdges=relatedEdges.concat(graphCore.getRelatedEdges(child.id)),succeedIds.push(child.id)}));const pairs=[];uniq(relatedEdges).forEach((edge=>{const{id,source:s,target:t}=edge;if(!this.graph.getItemVisible(id))return;const sourceIsSucceed=succeedIds.includes(s),targetIsSucceed=succeedIds.includes(t);if(sourceIsSucceed&&targetIsSucceed)return;const source=sourceIsSucceed?comboModel.id:s,target=targetIsSucceed?comboModel.id:t;pairs.push({source,target})})),this.graph.executeWithNoStack((()=>{this.graph.addData("edge",groupVirtualEdges(pairs))}))}expandCombo(graphCore,comboModel){let isAncestorCollapsed=!1;if(traverseAncestors(graphCore,[comboModel],(anccestor=>!!anccestor.data.collapsed&&(isAncestorCollapsed=!0,!0))),isAncestorCollapsed)return;const relatedVirtualEdgeIds=[];let edgesToShow=[];const nodesToShow=[];graphComboTreeDfs(this.graph,[comboModel],(child=>{graphCore.getRelatedEdges(child.id).forEach((edge=>{edge.data._virtual?relatedVirtualEdgeIds.push(edge.id):edgesToShow.push(edge.id)})),child.id!==comboModel.id&&(graphCore.getNode(child.data.parentId).data.collapsed||nodesToShow.push(child.id),child.data._isCombo&&child.data.collapsed&&this.collapseCombo(graphCore,child))}));const virtualPairs=[],visibleAncestorMap=new Map;edgesToShow=uniq(edgesToShow.filter((eid=>{const{source,target}=graphCore.getEdge(eid),ends={source,target},endsVisible={source:this.graph.getItemVisible(source)||nodesToShow.includes(source),target:this.graph.getItemVisible(target)||nodesToShow.includes(target)};if(endsVisible.source&&endsVisible.target)return!0;const virtualEnds={source:void 0,target:void 0};return Object.keys(virtualEnds).forEach((end=>{endsVisible[end]?virtualEnds[end]=ends[end]:(visibleAncestorMap.get(ends[end])||traverseAncestors(graphCore,[graphCore.getNode(ends[end])],(ancestor=>{visibleAncestorMap.has(ends[end])||(this.graph.getItemVisible(ancestor.id)||nodesToShow.includes(ancestor.id))&&visibleAncestorMap.set(ends[end],ancestor.id)})),virtualEnds[end]=visibleAncestorMap.get(ends[end]))})),void 0!==virtualEnds.source&&void 0!==virtualEnds.target&&virtualPairs.push(virtualEnds),!1}))),this.graph.executeWithNoStack((()=>{this.graph.removeData("edge",uniq(relatedVirtualEdgeIds)),this.graph.showItem(edgesToShow.concat(nodesToShow)),this.graph.addData("edge",groupVirtualEdges(virtualPairs))}))}onTreeCollapseExpand(params){const{ids,animate,action,graphCore}=params,rootModels=ids.map((id=>graphCore.getNode(id)));if("collapse"===action)this.collapseSubTree(rootModels,graphCore,animate);else this.expandSubTree(rootModels,graphCore,animate)}collapseSubTree(rootModels,graphCore,animate=!0){let positions=[];rootModels.forEach((root=>{let shouldCollapse=!0;const nodes=[];graphCoreTreeDfs(graphCore,[root],(node=>{var _a;if(node.id===root.id)return;const neighbors=graphCore.getNeighbors(node.id);!(null===(_a=graphCore.getChildren(node.id,"tree"))||void 0===_a?void 0:_a.length)&&neighbors.length>1&&(shouldCollapse=!1),nodes.push(node)}),"TB","tree",{stopAllFn:()=>!shouldCollapse}),shouldCollapse&&(positions=positions.concat(nodes.map((node=>({id:node.id,data:{x:root.data.x,y:root.data.y}})))))})),positions.length&&this.graph.updateNodePosition(positions,void 0,!animate,((model,canceled)=>{positions.forEach((position=>{this.graph.hideItem(position.id,{disableAnimate:canceled})}))}))}expandSubTree(rootModels,graphCore,animate=!0){return item_awaiter(this,void 0,void 0,(function*(){let allNodeIds=[],allEdgeIds=[];rootModels.forEach((root=>{const nodeIds=[];graphCoreTreeDfs(graphCore,[root],(node=>nodeIds.push(node.id)),"TB","tree",{stopBranchFn:node=>{const shouldStop=node.id!==root.id&&node.data.collapsed;return shouldStop&&nodeIds.push(node.id),shouldStop}}),allEdgeIds=allEdgeIds.concat(graphCore.getAllEdges().filter((edge=>nodeIds.includes(edge.source)&&nodeIds.includes(edge.target))).map((edge=>edge.id))),allNodeIds=allNodeIds.concat(nodeIds.filter((id=>id!==root.id)))}));const ids=uniq(allNodeIds.concat(allEdgeIds));this.graph.showItem(ids,{disableAnimate:!animate}),yield this.graph.layout(void 0,!animate)}))}}const getItemTheme=(dataTypeSet,dataTypeField,dataType,itemTheme)=>{const{styles:themeStyles=[],lodLevels}=itemTheme,formattedLodLevels=formatLodLevels(lodLevels);if(!dataTypeField){return{styles:(0,is_array.A)(themeStyles)?themeStyles[0]:Object.values(themeStyles)[0],lodLevels:formattedLodLevels}}let themeStyle;if(dataTypeSet.add(dataType),(0,is_array.A)(themeStyles)){const themeStylesLength=themeStyles.length;themeStyle=themeStyles[Array.from(dataTypeSet).indexOf(dataType)%themeStylesLength]}else(0,is_object.A)(themeStyles)&&(themeStyle=themeStyles[dataType]||themeStyles.others);return{styles:themeStyle,lodLevels:formattedLodLevels}},filterItemMapByType=(itemMap,type)=>{const filteredMap=new Map;return itemMap.forEach(((value,key)=>{value.type===type&&filteredMap.set(key,value)})),filteredMap},groupVirtualEdges=pairs=>{const groupedVirtualEdges=new Map;pairs.forEach((edge=>{const{source,target}=edge,key=`${source}_${target}`,group=groupedVirtualEdges.get(key)||{edges:[],source,target};group.edges.push(edge),groupedVirtualEdges.set(key,group)}));const virtualEdges=[];return groupedVirtualEdges.forEach((group=>{const{source,target,edges}=group;virtualEdges.push({id:`virtual-${unique_id()}`,source,target,data:{_virtual:!0,keyShape:{lineWidth:edges.length}}})})),virtualEdges},proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),comlink_isObject=val=>"object"==typeof val&&null!==val||"function"==typeof val,transferHandlers=new Map([["proxy",{canHandle:val=>comlink_isObject(val)&&val[proxyMarker],serialize(obj){const{port1,port2}=new MessageChannel;return expose(obj,port1),[port2,[port2]]},deserialize:port=>(port.start(),wrap(port))}],["throw",{canHandle:value=>comlink_isObject(value)&&throwMarker in value,serialize({value}){let serialized;return serialized=value instanceof Error?{isError:!0,value:{message:value.message,name:value.name,stack:value.stack}}:{isError:!1,value},[serialized,[]]},deserialize(serialized){if(serialized.isError)throw Object.assign(new Error(serialized.value.message),serialized.value);throw serialized.value}}]]);function expose(obj,ep=globalThis,allowedOrigins=["*"]){ep.addEventListener("message",(function callback(ev){if(!ev||!ev.data)return;if(!function isAllowedOrigin(allowedOrigins,origin){for(const allowedOrigin of allowedOrigins){if(origin===allowedOrigin||"*"===allowedOrigin)return!0;if(allowedOrigin instanceof RegExp&&allowedOrigin.test(origin))return!0}return!1}(allowedOrigins,ev.origin))return void console.warn(`Invalid origin '${ev.origin}' for comlink proxy`);const{id,type,path}=Object.assign({path:[]},ev.data),argumentList=(ev.data.argumentList||[]).map(fromWireValue);let returnValue;try{const parent=path.slice(0,-1).reduce(((obj,prop)=>obj[prop]),obj),rawValue=path.reduce(((obj,prop)=>obj[prop]),obj);switch(type){case"GET":returnValue=rawValue;break;case"SET":parent[path.slice(-1)[0]]=fromWireValue(ev.data.value),returnValue=!0;break;case"APPLY":returnValue=rawValue.apply(parent,argumentList);break;case"CONSTRUCT":returnValue=function proxy(obj){return Object.assign(obj,{[proxyMarker]:!0})}(new rawValue(...argumentList));break;case"ENDPOINT":{const{port1,port2}=new MessageChannel;expose(obj,port2),returnValue=function transfer(obj,transfers){return transferCache.set(obj,transfers),obj}(port1,[port1])}break;case"RELEASE":returnValue=void 0;break;default:return}}catch(value){returnValue={value,[throwMarker]:0}}Promise.resolve(returnValue).catch((value=>({value,[throwMarker]:0}))).then((returnValue=>{const[wireValue,transferables]=toWireValue(returnValue);ep.postMessage(Object.assign(Object.assign({},wireValue),{id}),transferables),"RELEASE"===type&&(ep.removeEventListener("message",callback),closeEndPoint(ep),finalizer in obj&&"function"==typeof obj[finalizer]&&obj[finalizer]())})).catch((error=>{const[wireValue,transferables]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});ep.postMessage(Object.assign(Object.assign({},wireValue),{id}),transferables)}))})),ep.start&&ep.start()}function closeEndPoint(endpoint){(function isMessagePort(endpoint){return"MessagePort"===endpoint.constructor.name})(endpoint)&&endpoint.close()}function wrap(ep,target){return createProxy(ep,[],target)}function throwIfProxyReleased(isReleased){if(isReleased)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(ep){return requestResponseMessage(ep,{type:"RELEASE"}).then((()=>{closeEndPoint(ep)}))}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry((ep=>{const newCount=(proxyCounter.get(ep)||0)-1;proxyCounter.set(ep,newCount),0===newCount&&releaseEndpoint(ep)}));function createProxy(ep,path=[],target=function(){}){let isProxyReleased=!1;const proxy=new Proxy(target,{get(_target,prop){if(throwIfProxyReleased(isProxyReleased),prop===releaseProxy)return()=>{!function unregisterProxy(proxy){proxyFinalizers&&proxyFinalizers.unregister(proxy)}(proxy),releaseEndpoint(ep),isProxyReleased=!0};if("then"===prop){if(0===path.length)return{then:()=>proxy};const r=requestResponseMessage(ep,{type:"GET",path:path.map((p=>p.toString()))}).then(fromWireValue);return r.then.bind(r)}return createProxy(ep,[...path,prop])},set(_target,prop,rawValue){throwIfProxyReleased(isProxyReleased);const[value,transferables]=toWireValue(rawValue);return requestResponseMessage(ep,{type:"SET",path:[...path,prop].map((p=>p.toString())),value},transferables).then(fromWireValue)},apply(_target,_thisArg,rawArgumentList){throwIfProxyReleased(isProxyReleased);const last=path[path.length-1];if(last===createEndpoint)return requestResponseMessage(ep,{type:"ENDPOINT"}).then(fromWireValue);if("bind"===last)return createProxy(ep,path.slice(0,-1));const[argumentList,transferables]=processArguments(rawArgumentList);return requestResponseMessage(ep,{type:"APPLY",path:path.map((p=>p.toString())),argumentList},transferables).then(fromWireValue)},construct(_target,rawArgumentList){throwIfProxyReleased(isProxyReleased);const[argumentList,transferables]=processArguments(rawArgumentList);return requestResponseMessage(ep,{type:"CONSTRUCT",path:path.map((p=>p.toString())),argumentList},transferables).then(fromWireValue)}});return function registerProxy(proxy,ep){const newCount=(proxyCounter.get(ep)||0)+1;proxyCounter.set(ep,newCount),proxyFinalizers&&proxyFinalizers.register(proxy,ep,proxy)}(proxy,ep),proxy}function processArguments(argumentList){const processed=argumentList.map(toWireValue);return[processed.map((v=>v[0])),(arr=processed.map((v=>v[1])),Array.prototype.concat.apply([],arr))];var arr}const transferCache=new WeakMap;function toWireValue(value){for(const[name,handler]of transferHandlers)if(handler.canHandle(value)){const[serializedValue,transferables]=handler.serialize(value);return[{type:"HANDLER",name,value:serializedValue},transferables]}return[{type:"RAW",value},transferCache.get(value)||[]]}function fromWireValue(value){switch(value.type){case"HANDLER":return transferHandlers.get(value.name).deserialize(value.value);case"RAW":return value.value}}function requestResponseMessage(ep,msg,transfers){return new Promise((resolve=>{const id=function generateUUID(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}();ep.addEventListener("message",(function l(ev){ev.data&&ev.data.id&&ev.data.id===id&&(ep.removeEventListener("message",l),resolve(ev.data))})),ep.start&&ep.start(),ep.postMessage(Object.assign({id},msg),transfers)}))}var Supervisor=function(_super){function Supervisor(graph,layout,options){var _this=_super.call(this)||this;return _this.graph=graph,_this.layout=layout,_this.options=options,_this.spawnWorker(),_this}return(0,tslib_es6.C6)(Supervisor,_super),Supervisor.prototype.spawnWorker=function(){this.proxy=wrap(new Worker(new URL(__webpack_require__.p+__webpack_require__.u(73062),__webpack_require__.b),{type:void 0})),this.running&&(this.running=!1,this.execute())},Supervisor.prototype.execute=function(){var _a;return(0,tslib_es6.sH)(this,void 0,void 0,(function(){var _b,rest,noFunctionOptions,payload,arraybufferWithNodesEdges,_c;return(0,tslib_es6.YH)(this,(function(_d){switch(_d.label){case 0:return this.running?[2,this]:(this.running=!0,_b=this.layout.options,_b.onTick,rest=(0,tslib_es6.Tt)(_b,["onTick"]),noFunctionOptions={},Object.keys(rest).forEach((function(name){(0,is_function.A)(rest[name])||(noFunctionOptions[name]=rest[name])})),payload={layout:{id:this.layout.id,options:noFunctionOptions,iterations:null===(_a=this.options)||void 0===_a?void 0:_a.iterations},nodes:this.graph.getAllNodes(),edges:this.graph.getAllEdges()},arraybufferWithNodesEdges=new Float32Array([0]),[4,this.proxy.calculateLayout(payload,[arraybufferWithNodesEdges])]);case 1:return _c=tslib_es6.zs.apply(void 0,[_d.sent(),1]),[2,_c[0]]}}))}))},Supervisor.prototype.stop=function(){return this.running=!1,this.proxy.stopLayout(),this},Supervisor.prototype.kill=function(){this.proxy[releaseProxy]()},Supervisor.prototype.isRunning=function(){return this.running},Supervisor}(esm.A),types=__webpack_require__("./node_modules/@antv/layout/lib/types.js");var layout_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},layout_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class LayoutController{constructor(graph){this.extensions={},this.layoutOnce=(layoutData,nodeSize,width,height,center,options,params,layoutGraphCore,nodesWithPosition)=>layout_awaiter(this,void 0,void 0,(function*(){let positions;const{graphCore,animate=!0}=params,{nodes:layoutNodes}=layoutData,{type="grid",animated=!1,animationEffectTiming={duration:1e3},iterations=300}=options,rest=layout_rest(options,["type","animated","animationEffectTiming","iterations"]);let{workerEnabled=!1}=options;const layoutCtor=stdLib.layouts[type]||registry.useLib.layouts[type];if(!layoutCtor)throw new Error(`Unknown layout algorithm: ${type}`);if(isTreeLayout(options))return void(yield this.handleTreeLayout(type,Object.assign({nodeSize,width,height,center},rest),animationEffectTiming,graphCore,layoutData,animate));const useCache=layoutCtor===Extensions.DagreLayout,layout=new layoutCtor(Object.assign({nodeSize,width,height,center,getMass:this.genericGetMass(options,nodesWithPosition),preset:useCache?layoutNodes.map((node=>{var _a;const{x,y,z}=node.data;if(isNaN(x)||isNaN(y))return;const presetNode={x,y,z},otherProps=(null===(_a=this.previousNodes)||void 0===_a?void 0:_a.get(node.id))||{};return["_order","layer"].forEach((field=>{presetNode[field]=node.data.hasOwnProperty(field)?node.data[field]:otherProps[field]})),{id:node.id,data:Object.assign(Object.assign({},otherProps),presetNode)}})).filter(Boolean):void 0},rest));if(this.currentLayout=layout,function isLayoutWorkerized(options){return["circular","random","grid","mds","concentric","radial","fruchterman","fruchtermanGPU","d3force","force","gforce","forceAtlas2"].indexOf(options.type)>-1}(options)||(workerEnabled=!1),workerEnabled){const supervisor=new Supervisor(layoutGraphCore,layout,{iterations});this.currentSupervisor=supervisor,positions=yield supervisor.execute()}else(0,types.L)(layout)?animated?positions=yield layout.execute(layoutGraphCore,{onTick:positionsOnTick=>{this.updateNodesPosition(positionsOnTick,!1),this.graph.emit("tick",positionsOnTick)}}):(layout.execute(layoutGraphCore),layout.stop(),positions=layout.tick(iterations)):(positions=yield layout.execute(layoutGraphCore),animated&&(yield this.animateLayoutWithoutIterations(positions,animationEffectTiming)));return positions})),this.presetLayout=(layoutData,nodeSize,width,height,center,presetLayout,params,layoutGraphCore)=>layout_awaiter(this,void 0,void 0,(function*(){if(null==presetLayout?void 0:presetLayout.type){return void(yield this.layoutOnce(layoutData,nodeSize,width,height,center,presetLayout,params,layoutGraphCore)).nodes.forEach((node=>{layoutGraphCore.mergeNodeData(node.id,{x:node.data.x,y:node.data.y})}))}const nodeWithPostions=new Map,initNaNPositions={nodes:[],edges:[]};return layoutData.nodes.forEach((node=>{const{x,y}=node.data;if(isNaN(x)||isNaN(y)){const meanCenter={x:0,y:0,z:0,count:0};layoutGraphCore.getNeighbors(node.id).forEach((neighbor=>{const{x:nx,y:ny,z:nz}=neighbor.data;isNaN(nx)||isNaN(ny)||(meanCenter.x+=nx,meanCenter.y+=ny,meanCenter.z+=nz,meanCenter.count++)})),meanCenter.count&&(node.data.x=meanCenter.x/meanCenter.count+Math.random(),node.data.y=meanCenter.y/meanCenter.count+Math.random(),node.data.z=meanCenter.z/meanCenter.count+Math.random(),initNaNPositions.nodes.push(node))}else nodeWithPostions.set(node.id,1)})),initNaNPositions.nodes.length&&this.updateNodesPosition(initNaNPositions,!1,!1),nodeWithPostions})),this.genericGetMass=(options,nodesWithPosition)=>{const{getMass:propGetMass}=options;return node=>{const propGetMassVal=null==propGetMass?void 0:propGetMass(node);if(!isNaN(propGetMassVal))return propGetMassVal;const{x,y,mass}=node.data;return isNaN(mass)?(null==nodesWithPosition?void 0:nodesWithPosition.get(node.id))?10:nodesWithPosition||isNaN(x)||isNaN(y)?1:10:mass}},this.graph=graph,this.animatedDisplayObject=new DisplayObject({}),this.tap()}tap(){this.graph.hooks.layout.tap(this.onLayout.bind(this)),this.graph.hooks.destroy.tap(this.onDestroy.bind(this))}onLayout(params){return layout_awaiter(this,void 0,void 0,(function*(){let positions;this.stopLayout();const{graphCore,options,animate=!0}=params;let layoutNodes=graphCore.getAllNodes();(options=>{const{type}=options;return!!["comboCombined","comboForce"].includes(type)||!("dagre"!==type||!options.sortByCombo)})(options)||(layoutNodes=layoutNodes.filter((node=>this.graph.getItemVisible(node.id)&&!node.data._isCombo)));const layoutNodesIdMap={};layoutNodes.forEach((node=>layoutNodesIdMap[node.id]=!0));const layoutData={nodes:layoutNodes,edges:graphCore.getAllEdges().filter((edge=>layoutNodesIdMap[edge.source]&&layoutNodesIdMap[edge.target]))},layoutGraphCore=new graph.T(layoutData);graphCore.hasTreeStructure("combo")&&(layoutGraphCore.attachTreeStructure("combo"),layoutNodes.forEach((node=>{const parent=graphCore.getParent(node.id,"combo");parent&&layoutGraphCore.hasNode(parent.id)&&layoutGraphCore.setParent(node.id,parent.id,"combo")})));const[width,height]=this.graph.getSize(),center=[width/2,height/2],nodeSize=((options,defaultSize=32)=>options.nodeSize?options.nodeSize:node=>{const{size,keyShape}=node.data;if((0,is_array.A)(size))return Math.max(...size);if((0,is_number.A)(size))return size;if(!keyShape)return defaultSize;const{r,width,height}=keyShape;if(!isNaN(r))return 2*r;const widthValid=!isNaN(width),heightValid=!isNaN(height);return widthValid&&heightValid?Math.max(width,height):widthValid?width:heightValid?height:defaultSize})(options,32);if(function isImmediatelyInvokedLayoutOptions(options){return!!options.execute}(options)){const{animated=!1,animationEffectTiming={duration:1e3},presetLayout,execute}=options,rest=layout_rest(options,["animated","animationEffectTiming","presetLayout","execute"]),nodesWithPosition=yield this.presetLayout(layoutData,nodeSize,width,height,center,presetLayout,params,layoutGraphCore);positions=yield execute(layoutGraphCore,Object.assign({nodeSize,width,height,center,getMass:this.genericGetMass(options,nodesWithPosition),preset:layoutNodes.map((node=>{var _a;const{x,y,z}=node.data;if(isNaN(x)||isNaN(y))return;const presetNode={x,y,z},otherProps=(null===(_a=this.previousNodes)||void 0===_a?void 0:_a.get(node.id))||{};return["_order","layer"].forEach((field=>{presetNode[field]=node.data.hasOwnProperty(field)?node.data[field]:otherProps[field]})),{id:node.id,data:Object.assign(Object.assign({},otherProps),presetNode)}}))},rest)),animated&&(yield this.animateLayoutWithoutIterations(positions,animationEffectTiming))}else{const{presetLayout}=options,nodesWithPosition=yield this.presetLayout(layoutData,nodeSize,width,height,center,presetLayout,params,layoutGraphCore);positions=yield this.layoutOnce(layoutData,nodeSize,width,height,center,options,params,layoutGraphCore,nodesWithPosition)}this.updateNodesPosition(positions,animate)}))}handleTreeLayout(type,options,animationEffectTiming,graphCore,layoutData,animate){return layout_awaiter(this,void 0,void 0,(function*(){const{animated=!1,rootIds=[],begin=[0,0],radial}=options,nodePositions=[],nodeMap=new Map;graphCore.getRoots("tree").filter((node=>!node.data._isCombo)).map((node=>({id:node.id,children:[]}))).forEach((tree=>{nodeMap.set(tree.id,tree),graphCore.dfsTree(tree.id,(node=>{nodeMap.get(node.id).children=graphCore.getChildren(node.id,"tree").filter((node=>!node.data._isCombo)).map((child=>(nodeMap.set(child.id,{id:child.id,children:[]}),nodeMap.get(child.id))))}),"tree"),((treeData,layoutType,layoutOptions,nodeMap,nodePositions,begin=[0,0])=>{const{treeGap=50}=layoutOptions,isHorizontal=((type,options)=>{const{direction}=options;switch(type){case"compactBox":case"dendrogram":return"TB"!==direction&&" BT"!==direction&&" V"!==direction;case"indented":return!0;case"mindmap":return"V"!==direction}})(layoutType,layoutOptions),layoutData=hierarchy_default()[layoutType](treeData,layoutOptions),range=[1/0,-1/0],treeNodeIds=[];traverse(layoutData,(child=>{const{id,x,y}=child;treeNodeIds.push(id);const dim=isHorizontal?"y":"x";range[0]>child[dim]&&(range[0]=child[dim]),range[1]<child[dim]&&(range[1]=child[dim]),nodeMap.get(id).data={x,y}}));const diff=begin[isHorizontal?1:0]-range[0];treeNodeIds.forEach((id=>{const{x,y}=nodeMap.get(id).data;nodePositions.push({id,data:isHorizontal?{x,y:y+diff}:{x:x+diff,y}})})),begin[isHorizontal?1:0]+=range[1]+diff+treeGap})(tree,type,options,nodeMap,nodePositions,begin),radial&&(nodePositions.forEach((pos=>nodeMap.set(pos.id,pos))),((tree,nodeMap,layout)=>{const min={x:1/0,y:1/0},max={x:-1/0,y:-1/0};let rScale="x",radScale="y";layout&&["V","TB","BT"].indexOf(layout)>=0&&(radScale="x",rScale="y");let count=0;traverse(tree,(child=>{count++;const{x,y}=nodeMap.get(child.id).data;x>max.x&&(max.x=x),x<min.x&&(min.x=x),y>max.y&&(max.y=y),y<min.y&&(min.y=y)}));const avgRad=2*Math.PI/count,radDiff=max[radScale]-min[radScale];if(0===radDiff)return;const root=nodeMap.get(tree.id);traverse(tree,(child=>{const node=nodeMap.get(child.id),radial=(node.data[radScale]-min[radScale])/radDiff*(2*Math.PI-avgRad)+avgRad,r=Math.abs(node.data[rScale]-root.data[rScale]);return node.data.x=r*Math.cos(radial),node.data.y=r*Math.sin(radial),!0}))})(tree,nodeMap))})),animated&&(yield this.animateLayoutWithoutIterations({nodes:nodePositions,edges:[]},animationEffectTiming)),this.updateNodesPosition({nodes:nodePositions,edges:[]},animated||animate)}))}stopLayout(){this.currentLayout&&(0,types.L)(this.currentLayout)&&(this.currentLayout.stop(),this.currentLayout=null),this.currentSupervisor&&(this.currentSupervisor.stop(),this.currentSupervisor=null),this.currentAnimation&&(this.currentAnimation.finish(),this.currentAnimation=null)}getCurrentAnimation(){return this.currentAnimation}onDestroy(){this.stopLayout(),this.currentSupervisor&&this.currentSupervisor.kill()}updateNodesPosition(positions,animate=!0,cache=!0){if(!positions)return;const{nodes,edges}=positions;cache&&(this.previousNodes=new Map);const nodePositions=nodes.map((node=>{const _a=node.data,{x,y,z}=_a,others=layout_rest(_a,["x","y","z"]);cache&&this.previousNodes.set(node.id,others);const data=isNaN(z)?{x,y}:{x,y,z};return{id:node.id,data}}));this.graph.updateNodePosition(nodePositions,void 0,!animate);const edgeToUpdate=edges.filter((edge=>{var _a;return null===(_a=edge.data)||void 0===_a?void 0:_a.controlPoints})).map((edge=>({id:edge.id,data:{keyShape:{controlPoints:edge.data.controlPoints}}})));edgeToUpdate.length&&this.graph.updateData("edge",edgeToUpdate)}animateLayoutWithoutIterations(positions,animationEffectTiming){return layout_awaiter(this,void 0,void 0,(function*(){animationEffectTiming.iterations=1;const initialPositions=positions.nodes.map((node=>Object.assign({},this.graph.getNodeData(`${node.id}`))));this.animatedDisplayObject.isConnected||(yield this.graph.canvas.ready,this.graph.canvas.appendChild(this.animatedDisplayObject)),this.currentAnimation=this.animatedDisplayObject.animate([{opacity:0},{opacity:1}],animationEffectTiming),this.currentAnimation.onframe=e=>{const progress=e.target.effect.getComputedTiming().progress,interpolatedNodesPosition=initialPositions.map((({id,data},i)=>{const{x:fromX=0,y:fromY=0}=data,{x:toX,y:toY}=positions.nodes[i].data;return{id,data:{x:fromX+(toX-fromX)*progress,y:fromY+(toY-fromY)*progress}}}));this.updateNodesPosition({nodes:interpolatedNodesPosition,edges:[]})},yield this.currentAnimation.finished}))}}var viewport_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};let landmarkCounter=0;class ViewportController{constructor(graph){this.graph=graph,this.tap()}tap(){this.graph.hooks.viewportchange.tap(this.onViewportChange.bind(this))}onViewportChange({transform,effectTiming}){var _a;return viewport_awaiter(this,void 0,void 0,(function*(){const camera=this.graph.canvas.getCamera(),transientCamera=this.graph.transientCanvas.getCamera();(null===(_a=camera.landmarks)||void 0===_a?void 0:_a.length)&&(camera.cancelLandmarkAnimation(),transientCamera.cancelLandmarkAnimation(),this.graph.emit("cancelviewportanimation"));const{translate,rotate,zoom,origin=this.graph.getViewportCenter()}=transform,currentZoom=camera.getZoom();if(effectTiming){this.graph.emit("beforeviewportanimation",transform);const{duration=1e3,easing="linear",easingFunction}=effectTiming,landmarkOptions={};if(translate){const[px,py,pz]=camera.getPosition(),[fx,fy,fz]=camera.getFocalPoint(),{dx=0,dy=0,dz=0,targetX,targetY,targetZ}=translate,animateTargetPosition=[targetX,targetY,targetZ],animateTargetFocal=[targetX,targetY,targetZ];isNaN(targetX)&&(animateTargetPosition[0]=px-dx,animateTargetFocal[0]=fx-dx),isNaN(targetY)&&(animateTargetPosition[1]=py-dy,animateTargetFocal[1]=fy-dy),isNaN(targetZ)&&(animateTargetPosition[2]=pz-dz,animateTargetFocal[2]=fz-dz),landmarkOptions.position=animateTargetPosition,landmarkOptions.focalPoint=animateTargetFocal}if(zoom){const{ratio}=zoom;landmarkOptions.zoom=currentZoom*ratio}if(rotate){const{angle}=rotate;landmarkOptions.roll=camera.getRoll()+angle}const landmark=camera.createLandmark("mark"+landmarkCounter++,landmarkOptions),transientLandmark=transientCamera.createLandmark(`mark${landmarkCounter}`,landmarkOptions);return new Promise((resolve=>{transientCamera.gotoLandmark(transientLandmark,{duration:Number(duration),easing,easingFunction}),camera.gotoLandmark(landmark,{duration:Number(duration),easing,easingFunction,onfinish:()=>{this.graph.emit("afterviewportanimation",transform),resolve(void 0)}})}))}if(translate){const{dx=0,dy=0}=translate;camera.pan(-dx/currentZoom,-dy/currentZoom),transientCamera.pan(-dx/currentZoom,-dy/currentZoom)}if(rotate){const{angle}=rotate,[x,y]=camera.getPosition();origin&&(camera.setPosition(origin.x,origin.y),camera.setFocalPoint(origin.x,origin.y),transientCamera.setPosition(origin.x,origin.y),transientCamera.setFocalPoint(origin.x,origin.y)),camera.rotate(0,0,angle),transientCamera.rotate(0,0,angle),origin&&(camera.pan(x-origin.x,y-origin.y),transientCamera.pan(x-origin.x,y-origin.y))}if(zoom){const{ratio}=zoom;camera.setZoomByViewportPoint(currentZoom*ratio,[origin.x,origin.y]),transientCamera.setZoomByViewportPoint(currentZoom*ratio,[origin.x,origin.y])}}))}destroy(){}}class ThemeController{constructor(graph){this.graph=graph,this.tap()}tap(){this.extension=this.getExtension(),this.themes=this.getThemes(),this.graph.hooks.init.tap(this.onInit.bind(this)),this.graph.hooks.themechange.tap(this.onThemeChange.bind(this))}getExtension(){const{theme={}}=this.graph.getSpecification();return this.themeConfig=theme,theme?getExtension(theme,stdlib.useLib,"themeSolver"):void 0}getThemes(){return stdlib.useLib[`${"theme"}s`]}onInit({canvases}){if(this.extension&&(this.solver=new this.extension(this.themeConfig,this.themes),this.specification=this.solver.specification,this.specification)){const{canvas}=this.specification,dom=canvases.background.getContextService().getDomElement();dom&&dom.style&&Object.keys(canvas).forEach((key=>dom.style[key]=canvas[key]))}}onThemeChange({canvases}){canvases&&(this.extension=this.getExtension(),this.onInit({canvases}))}}const REQUIRED_PLUGINS=[{key:"lod-controller",type:"lod-controller",pluginClass:LodController}];class PluginController{constructor(graph){this.extensions=[],this.pluginMap=new Map,this.listenersMap={},this.addListeners=(key,plugin,initWithGraph=!0)=>{const events=plugin.getEvents();this.listenersMap[key]={},Object.keys(events).forEach((eventName=>{const listener=((type,eventName,listener)=>event=>{try{listener(event)}catch(error){throw console.error(`G6: Error occurred in "${eventName}" phase of the plugin "${type}"!`),error}})(key,eventName,events[eventName].bind(plugin));this.graph.on(eventName,listener),this.listenersMap[key][eventName]=listener,!initWithGraph&&["afterrender","afterlayout"].includes(eventName)&&listener({})}))},this.removeListeners=key=>{const listeners=this.listenersMap[key];Object.keys(listeners).forEach((eventName=>{const listener=listeners[eventName];listener&&this.graph.off(eventName,listener)}))},this.graph=graph,this.tap()}tap(){this.graph.hooks.init.tap(this.onPluginInit.bind(this)),this.graph.hooks.pluginchange.tap(this.onPluginChange.bind(this)),this.graph.hooks.destroy.tap(this.onDestroy.bind(this))}onPluginInit(){this.pluginMap.clear();const{graph}=this,pluginConfigs=graph.getSpecification().plugins||[],plugins=[...pluginConfigs];REQUIRED_PLUGINS.forEach((required=>{pluginConfigs.find((plugin=>plugin===required.type||plugin.type===required.type||plugin instanceof required.pluginClass))||(plugins.push(required.type),this.graph.specification.plugins||(this.graph.specification.plugins=[]),this.graph.specification.plugins.push(required))})),plugins.forEach(this.initPlugin.bind(this)),this.listenersMap={},this.pluginMap.forEach(((item,key)=>{const{plugin}=item;this.addListeners(key,plugin)}))}initPlugin(config){var _a,_b;const{graph}=this;if("function"==typeof config.init&&config.options){config.init(graph);const key=config.key||(null===(_a=config.options)||void 0===_a?void 0:_a.key)||`plugin-${unique_id()}`;return this.pluginMap.set(key,{type:key,plugin:config}),{key,plugin:config}}const Plugin=getExtension(config,stdlib.useLib,"plugin"),options="string"==typeof config?{}:config,type="string"==typeof config?config:config.type,key="string"==typeof config?config:config.key||(null===(_b=config.options)||void 0===_b?void 0:_b.key)||type;if(!Plugin)throw new Error(`Plugin ${type} not found, please make sure you have registered it first`);const plugin=new Plugin(Object.assign(Object.assign({},options),{key}));return plugin.init(graph),this.pluginMap.set(key,{type,plugin}),{key,type,plugin}}pluginIsRequired(config){if("function"==typeof config.init&&config.options)return config.required;const Plugin=getExtension(config,stdlib.useLib,"plugin");return null==Plugin?void 0:Plugin.required}onPluginChange(params){const{action,plugins:pluginCfgs}=params;"add"!==action?"remove"!==action?"update"!==action||pluginCfgs.forEach(this.updatePlugin.bind(this)):pluginCfgs.forEach((config=>{if(this.removePlugin(config),this.pluginIsRequired(config)){const pluginType="string"==typeof config?config:config.type,{key,plugin}=this.initPlugin(pluginType);this.addListeners(key,plugin,!1)}})):pluginCfgs.forEach((config=>{if(this.pluginIsRequired(config))return void this.updatePlugin(config);const{key,plugin}=this.initPlugin(config);this.addListeners(key,plugin,!1)}))}removePlugin(config){var _a;const key=("string"==typeof config?config:config.key)||(null===(_a=config.options)||void 0===_a?void 0:_a.key)||config.type,item=this.pluginMap.get(key);if(!item)return;const{plugin}=item;this.removeListeners(key),plugin.destroy(),this.pluginMap.delete(key)}updatePlugin(config){if("string"==typeof config)return;const key=config.key||config.type,item=this.pluginMap.get(key);if(!item)return;const{plugin}=item;plugin.updateCfgs(config),this.removeListeners(key),this.addListeners(key,plugin,!1)}hasPlugin(pluginKey){return this.pluginMap.has(pluginKey)}getPlugin(pluginKey){const{plugin}=this.pluginMap.get(pluginKey);if(!plugin)throw new Error("Plugin not found for key: "+pluginKey);return plugin}onDestroy(){this.pluginMap.forEach((item=>{const{plugin}=item;plugin.destroy()}))}destroy(){}}var hooks_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};class Hook{constructor(cfg){this.listeners=[];const{name}=cfg;this.name=name}tap(listener){this.listeners.push(listener)}unTap(listener){const idx=this.listeners.indexOf(listener);idx>-1&&this.listeners.splice(idx,1)}emit(param){this.listeners.forEach((listener=>listener(param)))}emitLinearAsync(param){return hooks_awaiter(this,void 0,void 0,(function*(){for(const listener of this.listeners)yield listener(param)}))}}var graph_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},graph_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class Graph extends esm.A{constructor(spec){super(),this.destroyed=!1,this.defaultSpecification={theme:{type:"spec",base:"light"},enableStack:!0},this.executeWithNoStack=callback=>{const history=this.getHistoryPlugin();null==history||history.pauseStack();try{callback()}finally{null==history||history.resumeStack()}},this.specification=Object.assign({},this.defaultSpecification,this.formatSpecification(spec)),this.initHooks(),this.initCanvas(),this.initControllers(),this.initHistory(),this.hooks.init.emit({canvases:{background:this.backgroundCanvas,main:this.canvas,label:this.labelCanvas,transient:this.transientCanvas,transientLabel:this.transientLabelCanvas}});const{data}=spec;data&&this.read(data)}initControllers(){this.dataController=new DataController(this),this.interactionController=new InteractionController(this),this.layoutController=new LayoutController(this),this.themeController=new ThemeController(this),this.viewportController=new ViewportController(this),this.itemController=new ItemController(this),this.pluginController=new PluginController(this)}initCanvas(){const{renderer,container,width,height}=this.specification;let pixelRatio;if(renderer&&!(0,is_string.A)(renderer)?(this.rendererType=renderer.type||"canvas",pixelRatio=renderer.pixelRatio):this.rendererType=renderer||"canvas",container)this.container=container;else{const containerDOM=(0,is_string.A)(container)?document.getElementById(container):container;if(!containerDOM)return console.error(`Create graph failed. The container for graph ${containerDOM} is not exist.`),void this.destroy();this.container=containerDOM}["backgroundCanvas","canvas","labelCanvas","transientCanvas","transientLabelCanvas"].forEach((name=>{this[name]=this.specification[name]||createCanvas(["labelCanvas","transientLabelCanvas"].includes(name)?"canvas":this.rendererType,this.container,null!=width?width:this.container.scrollWidth,null!=height?height:this.container.scrollHeight,pixelRatio,void 0,"canvas"===name?[]:["dom-interaction"])})),Promise.all([this.backgroundCanvas,this.canvas,this.labelCanvas,this.transientCanvas,this.transientLabelCanvas].map((canvas=>canvas.ready))).then((()=>{[this.backgroundCanvas,this.canvas,this.labelCanvas,this.transientCanvas,this.transientLabelCanvas].forEach(((canvas,i)=>{const $domElement=canvas.getContextService().getDomElement();$domElement&&$domElement.style&&($domElement.style.position="absolute",$domElement.style.outline="none",$domElement.tabIndex=1,1!==i&&($domElement.style.pointerEvents="none"))})),this.canvasReady=!0}))}initHistory(){const{enableStack,stackCfg}=this.specification;if(enableStack){const history={type:"history",key:"history",enableStack,stackCfg};this.specification.plugins||(this.specification.plugins=[]),this.specification.plugins.push(history)}}changeRenderer(type){this.rendererType=type||"canvas",((rendererType,canvas)=>{let renderer;switch(rendererType.toLowerCase()){case"svg":renderer=new index_esm_Renderer;break;case"webgl-3d":case"webgl":renderer=new dist_index_esm_Renderer,renderer.registerPlugin(new g_plugin_3d_dist_index_esm_Plugin);break;default:renderer=new Renderer}renderer.registerPlugin(new g_plugin_dragndrop_dist_index_esm_Plugin),canvas.setRenderer(renderer)})(this.rendererType,this.canvas)}initHooks(){this.hooks={init:new Hook({name:"init"}),datachange:new Hook({name:"datachange"}),itemchange:new Hook({name:"itemchange"}),render:new Hook({name:"render"}),layout:new Hook({name:"layout"}),viewportchange:new Hook({name:"viewport"}),modechange:new Hook({name:"modechange"}),behaviorchange:new Hook({name:"behaviorchange"}),itemstatechange:new Hook({name:"itemstatechange"}),itemstateconfigchange:new Hook({name:"itemstateconfigchange"}),itemvisibilitychange:new Hook({name:"itemvisibilitychange"}),itemzindexchange:new Hook({name:"itemzindexchange"}),transientupdate:new Hook({name:"transientupdate"}),pluginchange:new Hook({name:"pluginchange"}),themechange:new Hook({name:"themechange"}),mapperchange:new Hook({name:"mapperchange"}),treecollapseexpand:new Hook({name:"treecollapseexpand"}),destroy:new Hook({name:"destroy"})}}formatSpecification(spec){var _a;return Object.assign(Object.assign(Object.assign({},this.specification),spec),{optimize:Object.assign(Object.assign({tileBehavior:2e3,tileBehaviorSize:1e3,tileFirstRender:1e4,tileFirstRenderSize:1e3},null===(_a=this.specification)||void 0===_a?void 0:_a.optimize),spec.optimize)})}updateSpecification(spec){const{node,edge,combo,theme,nodeState,edgeState,comboState}=spec,others=graph_rest(spec,["node","edge","combo","theme","nodeState","edgeState","comboState"]);node&&this.updateMapper("node",node),edge&&this.updateMapper("edge",edge),combo&&this.updateMapper("combo",combo),theme&&this.updateTheme(theme),nodeState&&this.updateStateConfig("node",nodeState,"replace"),edgeState&&this.updateStateConfig("edge",edgeState,"replace"),comboState&&this.updateStateConfig("combo",comboState,"replace");return Object.assign(this.specification,this.formatSpecification(others))}updateTheme(theme){this.specification.theme=theme,this.hooks.themechange.emit({canvases:{background:this.backgroundCanvas,main:this.canvas,transient:this.transientCanvas}}),this.hooks.themechange.emit({theme:this.themeController.specification})}updateMapper(type,mapper){switch(type){case"node":this.specification.node=mapper;break;case"edge":this.specification.edge=mapper;break;case"combo":this.specification.combo=mapper}this.hooks.mapperchange.emit({type,mapper})}updateStateConfig(itemType,stateConfig,updateType="mergeReplace"){if(is_empty(stateConfig))return;const stateField=`${itemType}State`;if("mergeReplace"===updateType){const config=Object.assign(Object.assign({},this.specification[stateField]),stateConfig);this.specification[itemType]=config,this.hooks.itemstateconfigchange.emit({itemType,stateConfig:config})}else this.specification[itemType]=stateConfig,this.hooks.itemstateconfigchange.emit({itemType,stateConfig})}getSpecification(){return this.specification}read(data){return graph_awaiter(this,void 0,void 0,(function*(){const{tileFirstRender,tileFirstRenderSize}=this.specification.optimize||{};this.hooks.datachange.emit({data,type:"replace"});const emitRender=()=>graph_awaiter(this,void 0,void 0,(function*(){yield this.hooks.render.emitLinearAsync({graphCore:this.dataController.graphCore,theme:this.themeController.specification,transientCanvas:this.transientCanvas,transientLabelCanvas:this.transientLabelCanvas,tileOptimize:{tileFirstRender,tileFirstRenderSize}}),this.emit("afterrender"),this.once("afterlayout",(()=>graph_awaiter(this,void 0,void 0,(function*(){const{autoFit}=this.specification;if(autoFit)if("view"===autoFit)yield this.fitView({rules:{boundsType:"layout"}});else if("center"===autoFit)yield this.fitCenter("layout");else{const{type,effectTiming}=autoFit,others=graph_rest(autoFit,["type","effectTiming"]);if("view"===type){const{padding,rules}=others;yield this.fitView({padding,rules:Object.assign(Object.assign({},rules),{boundsType:"layout"})},effectTiming)}else"center"===type?yield this.fitCenter("layout",effectTiming):"position"===type&&(yield this.translateTo(others.position,effectTiming))}})))),yield this.layout()}));this.canvasReady||(yield Promise.all([this.backgroundCanvas,this.canvas,this.labelCanvas,this.transientCanvas,this.transientLabelCanvas].map((canvas=>canvas.ready)))),yield emitRender()}))}changeData(data,type="mergeReplace",relayout=!0){return graph_awaiter(this,void 0,void 0,(function*(){const{tileFirstRender,tileFirstRenderSize}=this.specification.optimize||{};this.hooks.datachange.emit({data,type}),this.hooks.render.emit({graphCore:this.dataController.graphCore,theme:this.themeController.specification,transientCanvas:this.transientCanvas,transientLabelCanvas:this.transientLabelCanvas,tileOptimize:{tileFirstRender,tileFirstRenderSize}}),this.emit("afterrender"),relayout&&(yield this.layout())}))}clear(){this.startHistoryBatch(),this.removeData("edge",this.getAllEdgesData().map((edge=>edge.id))),this.removeData("node",this.getAllNodesData().map((node=>node.id))),this.removeData("combo",this.getAllCombosData().map((combo=>combo.id))),this.stopHistoryBatch()}getViewportCenter(){const{width,height}=this.canvas.getConfig();return{x:width/2,y:height/2}}transform(options,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){if(((graph,excludeInvisible=!1)=>{const nodes=graph.getAllNodesData(),combos=graph.getAllCombosData();if(0===nodes.length&&0===combos.length)return!0;if(excludeInvisible){const edges=graph.getAllEdgesData();return!nodes.find((node=>graph.getItemVisible(node.id)))&&!edges.find((edge=>graph.getItemVisible(edge.id)))&&!combos.find((combo=>graph.getItemVisible(combo.id)))}return!1})(this,!0))return;const{tileLodSize}=this.specification.optimize||{};yield this.hooks.viewportchange.emitLinearAsync({transform:options,effectTiming,tileLodSize}),this.emit("viewportchange",options)}))}stopTransformTransition(){this.canvas.getCamera().cancelLandmarkAnimation()}translate(distance,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){const{x:cx,y:cy}=this.getViewportCenter(),{dx,dy,dz}=distance;yield this.transform({translate:{dx,dy,dz,targetX:cx-dx,targetY:cy-dy}},effectTiming)}))}translateTo({x,y},effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){const{x:cx,y:cy}=this.getViewportCenter(),canvasPoint=this.canvas.viewport2Canvas({x,y});yield this.transform({translate:{dx:cx-x,dy:cy-y,targetX:canvasPoint.x,targetY:canvasPoint.y}},effectTiming)}))}zoom(ratio,origin,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){yield this.transform({zoom:{ratio},origin},effectTiming)}))}zoomTo(zoom,origin,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){yield this.zoom(zoom/this.canvas.getCamera().getZoom(),origin,effectTiming)}))}getZoom(){return this.canvas.getCamera().getZoom()}rotate(angle,origin,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){yield this.transform({rotate:{angle},origin},effectTiming)}))}rotateTo(angle,origin,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){yield this.rotate(angle-this.canvas.getCamera().getRoll(),origin,effectTiming)}))}fitView(options,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){const{padding,rules}=options||{},[top,right,bottom,left]=padding?formatPadding(padding):[0,0,0,0],{direction="both",ratioRule="min",boundsType="render",onlyOutOfViewport=!1,onlyZoomAtLargerThanViewport=!1}=rules||{},{min,max,center:[graphCenterX,graphCenterY],halfExtents}="render"===boundsType?getCombinedCanvasesBounds([this.canvas,this.labelCanvas]):getLayoutBounds(this),origin=this.canvas.canvas2Viewport({x:graphCenterX,y:graphCenterY}),{width:viewportWidth,height:viewportHeight}=this.canvas.getConfig(),graphWidth=2*halfExtents[0],graphHeight=2*halfExtents[1],tlInCanvas=this.canvas.viewport2Canvas({x:left,y:top}),brInCanvas=this.canvas.viewport2Canvas({x:viewportWidth-right,y:viewportHeight-bottom}),isOutOfView=min[0]<tlInCanvas.x||min[1]<tlInCanvas.y||max[0]>brInCanvas.x||max[1]>brInCanvas.y;if(onlyOutOfViewport&&!isOutOfView)return;const wRatio=(brInCanvas.x-tlInCanvas.x)/graphWidth,hRatio=(brInCanvas.y-tlInCanvas.y)/graphHeight;let ratio;ratio="x"===direction?wRatio:"y"===direction?hRatio:"max"===ratioRule?Math.max(wRatio,hRatio):Math.min(wRatio,hRatio),onlyZoomAtLargerThanViewport&&ratio>1&&(ratio=1),yield this.transform({translate:{dx:viewportWidth/2-origin.x,dy:viewportHeight/2-origin.y,targetX:graphCenterX,targetY:graphCenterY},zoom:{ratio}},effectTiming)}))}fitCenter(boundsType="render",effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){const{center:[graphCenterX,graphCenterY]}="render"===boundsType?getCombinedCanvasesBounds([this.canvas,this.labelCanvas]):getLayoutBounds(this);yield this.translateTo(this.canvas.canvas2Viewport({x:graphCenterX,y:graphCenterY}),effectTiming)}))}focusItem(id,effectTiming){return graph_awaiter(this,void 0,void 0,(function*(){let bounds=null;for(const itemId of(0,is_array.A)(id)?id:[id]){const item=this.getItemById(itemId);if(item){const itemBounds=item.group.getBounds();bounds?bounds.add(itemBounds):bounds=itemBounds}}if(bounds){const{center:[itemCenterX,itemCenterY]}=bounds;yield this.translateTo(this.canvas.canvas2Viewport({x:itemCenterX,y:itemCenterY}),effectTiming)}}))}getItemById(id){return this.itemController.getItemById(id)}getSize(){const{width=500,height=500}=this.specification;return[width,height]}setSize(size){if(!(0,is_array.A)(size)||size.length<2)return void console.warn(`Failed to setSize. The parameter size: ${size} is invalid. It must be an array with 2 number elements.`);const oldSize=[this.specification.width,this.specification.height];this.emit("beforesetsize",{oldSize,size}),this.specification.width=size[0],this.specification.height=size[1],[this.canvas,this.labelCanvas,this.transientCanvas,this.transientLabelCanvas,this.backgroundCanvas].forEach((canvas=>{canvas.resize(size[0],size[1])})),this.emit("aftersetsize",{oldSize,size})}getCanvasRange(){const[width,height]=this.getSize(),leftTop=this.getCanvasByViewport({x:0,y:0}),rightBottom=this.getCanvasByViewport({x:width,y:height});return{min:[leftTop.x,leftTop.y,leftTop.z],max:[rightBottom.x,rightBottom.y,rightBottom.z],center:[(leftTop.x+rightBottom.x)/2,(leftTop.y+rightBottom.y)/2,(leftTop.z+rightBottom.z)/2],halfExtents:[(rightBottom.x-leftTop.x)/2,(rightBottom.y-leftTop.y)/2,(rightBottom.z-leftTop.z)/2]}}getCanvasByViewport(viewportPoint){return this.canvas.viewport2Canvas(viewportPoint)}getViewportByCanvas(canvasPoint){return this.canvas.canvas2Viewport(canvasPoint)}getClientByCanvas(canvasPoint){const viewportPoint=this.canvas.canvas2Viewport(canvasPoint);return this.canvas.viewport2Client(viewportPoint)}getCanvasByClient(clientPoint){const viewportPoint=this.canvas.client2Viewport(clientPoint);return this.canvas.viewport2Canvas(viewportPoint)}getNodeData(condition){var _a;const conds=(0,is_string.A)(condition)||(0,is_number.A)(condition)?[condition]:condition;return null===(_a=this.dataController.findData("node",conds))||void 0===_a?void 0:_a[0]}getEdgeData(condition){var _a;const conds=(0,is_string.A)(condition)||(0,is_number.A)(condition)||(0,is_number.A)(condition)?[condition]:condition;return null===(_a=this.dataController.findData("edge",conds))||void 0===_a?void 0:_a[0]}getComboData(condition){var _a;const conds=(0,is_string.A)(condition)||(0,is_number.A)(condition)?[condition]:condition;return null===(_a=this.dataController.findData("combo",conds))||void 0===_a?void 0:_a[0]}getAllNodesData(){return this.dataController.findAllData("node")}getAllEdgesData(){return this.dataController.findAllData("edge")}getAllCombosData(){return this.dataController.findAllData("combo")}getRelatedEdgesData(nodeId,direction="both"){return this.dataController.findRelatedEdges(nodeId,direction)}getNearEdgesData(nodeId,shouldBegin){const transientItem=this.itemController.getTransientItem(nodeId),itemMap=this.itemController.getItemMap();return this.dataController.findNearEdges(nodeId,itemMap,transientItem,shouldBegin)}getNeighborNodesData(nodeId,direction="both"){return this.dataController.findNeighborNodes(nodeId,direction)}getComboChildrenData(comboId){return this.dataController.findChildren(comboId,"combo")}getTypeById(id){var _a;return null===(_a=this.itemController.getItemById(id))||void 0===_a?void 0:_a.getType()}getDisplayModel(id){return this.itemController.findDisplayModel(id)}findIdByState(itemType,state,value=!0,additionalFilter){let ids=this.itemController.findIdByState(itemType,state,value);if(additionalFilter){let getDataFunc=this.getEdgeData;"node"===itemType?getDataFunc=this.getNodeData:"combo"===itemType&&(getDataFunc=this.getComboData),ids=ids.filter((id=>additionalFilter(getDataFunc(id))))}return ids}addData(itemType,models){const{graphCore}=this.dataController,{specification}=this.themeController,modelArr=(0,is_array.A)(models)?models:[models];graphCore.once("changed",(event=>{if(!event.changes.length)return;const changes=event.changes,timingParameters={type:itemType,action:"add",models:modelArr,apiName:"addData",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type:itemType,changes:graphCore.reduceChanges(event.changes),graphCore,theme:specification}),this.emit("afteritemchange",timingParameters)}));const data={nodes:[],edges:[],combos:[]};data[`${itemType}s`]=modelArr,this.hooks.datachange.emit({data,type:"union"});const dataList=this.dataController.findData(itemType,modelArr.map((model=>model.id)));return(0,is_array.A)(models)?dataList:dataList[0]}removeData(itemType,ids){const idArr=(0,is_array.A)(ids)?ids:[ids],data={nodes:[],edges:[],combos:[]},{graphCore}=this.dataController,{specification}=this.themeController,getItem="edge"===itemType?graphCore.getEdge:graphCore.getNode,hasItem="edge"===itemType?graphCore.hasEdge:graphCore.hasNode;data[`${itemType}s`]=idArr.map((id=>{if(hasItem.bind(graphCore)(id))return getItem.bind(graphCore)(id);console.warn(`The ${itemType} data with id ${id} does not exist. It will be ignored`)})).filter(Boolean),graphCore.once("changed",(event=>{if(!event.changes.length)return;const changes=event.changes,timingParameters={type:itemType,action:"remove",ids:idArr,apiName:"removeData",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type:itemType,changes:event.changes,graphCore,theme:specification}),this.emit("afteritemchange",timingParameters)})),this.hooks.datachange.emit({data,type:"remove"})}extendChanges(changes){return changes.map((change=>{const{id,propertyName,oldValue,newValue}=change;if(!oldValue||!newValue)return change;if(propertyName)return oldValue!==newValue&&change;const displayData=this.getItemById(id).displayModel.data,oldFields=Object.keys(oldValue),newFields=Object.keys(newValue);return[...new Set([...oldFields,...newFields])].forEach((field=>{Object.prototype.hasOwnProperty.call(oldValue,field)||(oldValue[field]=displayData[field]),Object.prototype.hasOwnProperty.call(newValue,field)||(newValue[field]=displayData[field])})),void 0!==oldValue.x&&!Number.isNaN(oldValue.x)||oldValue._isCombo||(oldValue.x=0),void 0!==oldValue.y&&!Number.isNaN(oldValue.x)||oldValue._isCombo||(oldValue.y=0),Number.isNaN(newValue.x)&&delete newValue.x,Number.isNaN(newValue.y)&&delete newValue.y,!is_equal(newValue,oldValue)&&Object.assign(Object.assign({},change),{newValue,oldValue})})).filter(Boolean)}updateData(itemType,models){const modelArr=(0,is_array.A)(models)?models:[models],data={nodes:[],edges:[],combos:[]};data[`${itemType}s`]=modelArr;const{graphCore}=this.dataController,{specification}=this.themeController;graphCore.once("changed",(event=>{const changes=this.extendChanges(cloneJSON(event.changes)),timingParameters={type:itemType,action:"update",models:modelArr,apiName:"updateData",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type:itemType,changes:event.changes,graphCore,theme:specification}),this.emit("afteritemchange",timingParameters)})),this.hooks.datachange.emit({data,type:"update"});const dataList=this.dataController.findData(itemType,modelArr.map((model=>model.id)));return(0,is_array.A)(models)?dataList:dataList[0]}updateNodePosition(models,upsertAncestors,disableAnimate=!1,callback){return this.updatePosition("node",models,upsertAncestors,disableAnimate,callback)}updateComboPosition(models,upsertAncestors,disableAnimate=!1,callback){return this.updatePosition("combo",models,upsertAncestors,disableAnimate,callback)}getHistoryPlugin(){if(this.specification.enableStack&&this.pluginController.hasPlugin("history"))return this.pluginController.getPlugin("history");console.error("The history plugin is not loaded or initialized.")}updatePosition(type,models,upsertAncestors,disableAnimate=!1,callback){const modelArr=(0,is_array.A)(models)?models:[models],{graphCore}=this.dataController,{specification}=this.themeController;null==graphCore||graphCore.once("changed",(event=>{if(!event.changes.length)return;const changes=event.changes.filter((change=>!is_equal(change.newValue,change.oldValue))),timingParameters={type,action:"updatePosition",upsertAncestors,models:modelArr,apiName:"updatePosition",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type,changes:event.changes,graphCore,theme:specification,upsertAncestors,action:"updatePosition",animate:!disableAnimate,callback}),this.emit("afteritemchange",timingParameters)})),this.hooks.datachange.emit({data:{nodes:"node"===type?modelArr:[],edges:[],combos:"combo"===type?modelArr:[]},type:"updatePosition"});const dataList=this.dataController.findData(type,modelArr.map((model=>model.id)));return(0,is_array.A)(models)?dataList:dataList[0]}getItemPreviousVisibility(ids){const objs=ids.map((id=>({id,visible:this.getItemVisible(id)}))),groupedByVisible=group_by(objs,"visible"),values=[];for(const visible in groupedByVisible)values.push({ids:lodash_map(groupedByVisible[visible],(item=>item.id)),visible:"true"===visible});return values}showItem(ids,options){const{disableAnimate=!1,shapeIds}=options||{},idArr=(0,is_array.A)(ids)?ids:[ids];if(is_empty(idArr))return;let changes;if(null==shapeIds?void 0:shapeIds.length){const shapeIdsArr=(0,is_array.A)(shapeIds)?shapeIds:[shapeIds];changes={newValue:[{ids:idArr,visible:!0,shapeIds:shapeIdsArr}],oldValue:this.getItemPreviousVisibility(idArr)},this.hooks.itemvisibilitychange.emit({ids:idArr,value:!0,graphCore:this.dataController.graphCore,animate:!disableAnimate,shapeIds:shapeIdsArr})}else changes={newValue:[{ids:idArr,visible:!0}],oldValue:this.getItemPreviousVisibility(idArr)},this.hooks.itemvisibilitychange.emit({ids:idArr,value:!0,graphCore:this.dataController.graphCore,animate:!disableAnimate});this.emit("afteritemvisibilitychange",{ids:idArr,value:!0,animate:!disableAnimate,action:"updateVisibility",apiName:"showItem",changes})}hideItem(ids,options){const{disableAnimate=!1,keepKeyShape=!1,keepRelated=!1,shapeIds}=options||{},idArr=(0,is_array.A)(ids)?ids:[ids];if(is_empty(idArr))return;let changes;if(null==shapeIds?void 0:shapeIds.length){const shapeIdsArr=(0,is_array.A)(shapeIds)?shapeIds:[shapeIds];changes={newValue:[{ids:idArr,visible:!1,shapeIds:shapeIdsArr}],oldValue:this.getItemPreviousVisibility(idArr)},this.hooks.itemvisibilitychange.emit({ids:idArr,value:!1,graphCore:this.dataController.graphCore,animate:!disableAnimate,shapeIds:shapeIdsArr})}else changes={newValue:[{ids:idArr,visible:!1}],oldValue:this.getItemPreviousVisibility(idArr)},this.hooks.itemvisibilitychange.emit({ids:idArr,value:!1,graphCore:this.dataController.graphCore,animate:!disableAnimate,keepKeyShape,keepRelated});this.emit("afteritemvisibilitychange",{ids:idArr,value:!1,animate:!disableAnimate,action:"updateVisibility",apiName:"hideItem",keepKeyShape,changes})}frontItem(ids){const idArr=(0,is_array.A)(ids)?ids:[ids];this.hooks.itemzindexchange.emit({ids:idArr,action:"front",graphCore:this.dataController.graphCore}),this.emit("afteritemzindexchange",{ids:idArr,action:"front",apiName:"frontItem"})}backItem(ids){const idArr=(0,is_array.A)(ids)?ids:[ids];this.hooks.itemzindexchange.emit({ids:idArr,action:"back",graphCore:this.dataController.graphCore}),this.emit("afteritemzindexchange",{ids:idArr,action:"back",apiName:"backItem"})}getItemPreviousStates(stateOption){const{ids,states}=stateOption,idArr=Array.isArray(ids)?ids:[ids],stateArr=Array.isArray(states)?states:[states];if(!is_empty(idArr))return idArr.flatMap((id=>stateArr.map((state=>({ids:id,states:state,value:this.getItemState(id,state)})))))}setItemState(ids,states,value){const idArr=(0,is_array.A)(ids)?ids:[ids];if(void 0===ids||!idArr.length)return;const stateArr=(0,is_array.A)(states)?states:[states],stateOption={ids:idArr,states:stateArr,value},changes={newValue:[stateOption],oldValue:this.getItemPreviousStates(stateOption)};this.hooks.itemstatechange.emit({ids:idArr,states:stateArr,value}),this.emit("afteritemstatechange",{ids:idArr,itemTypes:idArr.map((id=>this.getTypeById(id))),states,value,action:"updateState",apiName:"setItemState",changes})}getItemState(id,state){return this.itemController.getItemState(id,state)}getItemAllStates(id){return this.itemController.getItemAllStates(id)}clearItemState(ids,states){const idArr=(0,is_array.A)(ids)?ids:[ids],stateOptions={ids:idArr,states,value:!1},changes={newValue:[stateOptions],oldValue:this.getItemPreviousStates(stateOptions)};this.hooks.itemstatechange.emit({ids:idArr,states,value:!1}),this.emit("afteritemstatechange",{ids:idArr,states,value:!1,action:"updateState",apiName:"clearItemState",changes})}getRenderBBox(id,onlyKeyShape=!1,isTransient=!1){return id?this.itemController.getItemBBox(id,onlyKeyShape,isTransient):this.canvas.getRoot().getRenderBounds()}getItemVisible(id){return this.itemController.getItemVisible(id)}getItemVisibleShapeIds(id){return this.itemController.getItemVisibleShapeIds(id)}addCombo(model,childrenIds){const{graphCore}=this.dataController,{specification}=this.themeController;graphCore.once("changed",(event=>{if(!event.changes.length)return;const changes=event.changes,timingParameters={type:"combo",action:"add",models:[model],apiName:"addCombo",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type:"combo",changes:graphCore.reduceChanges(event.changes),graphCore,theme:specification}),this.emit("afteritemchange",timingParameters)}));const data={nodes:[],edges:[],combos:[Object.assign(Object.assign({},model),{data:Object.assign(Object.assign({},model.data),{_children:childrenIds})})]};return this.hooks.datachange.emit({data,type:"addCombo"}),this.dataController.findData("combo",[model.id])[0]}collapseCombo(comboIds){const ids=(0,is_array.A)(comboIds)?comboIds:[comboIds];this.executeWithNoStack((()=>{this.updateData("combo",ids.map((id=>({id,data:{collapsed:!0}}))))})),this.emit("aftercollapsecombo",{type:"combo",action:"collapseCombo",ids:comboIds,apiName:"collapseCombo"})}expandCombo(comboIds){const ids=(0,is_array.A)(comboIds)?comboIds:[comboIds];this.executeWithNoStack((()=>{this.updateData("combo",ids.map((id=>({id,data:{collapsed:!1}}))))})),this.emit("afterexpandcombo",{type:"combo",action:"expandCombo",ids:comboIds,apiName:"expandCombo"})}moveCombo(ids,dx,dy,upsertAncestors,callback){const idArr=(0,is_array.A)(ids)?ids:[ids],{graphCore}=this.dataController,{specification}=this.themeController;return graphCore.once("changed",(event=>{if(!event.changes.length)return;const changes=this.extendChanges((0,lodash_clone.A)(event.changes)),timingParameters={type:"combo",ids:idArr,dx,dy,action:"updatePosition",upsertAncestors,apiName:"moveCombo",changes};this.emit("beforeitemchange",timingParameters),this.hooks.itemchange.emit({type:"combo",changes:event.changes,graphCore,theme:specification,upsertAncestors,action:"updatePosition",callback}),this.emit("afteritemchange",timingParameters)})),this.hooks.datachange.emit({data:{nodes:[],edges:[],combos:idArr.map((id=>({id,data:{dx,dy}})))},type:"moveCombo"}),this.dataController.findData("combo",idArr)}layout(options,disableAnimate=!1){return graph_awaiter(this,void 0,void 0,(function*(){this.emit("beforelayout");const{graphCore}=this.dataController,formattedOptions=Object.assign(Object.assign({},this.getSpecification().layout),options);this.updateSpecification({layout:formattedOptions});if(!options&&!this.getSpecification().layout||!Object.keys(formattedOptions).length){graphCore.getAllNodes().every((node=>(0,is_nil.A)(node.data.x)&&(0,is_nil.A)(node.data.y)))?formattedOptions.type="grid":formattedOptions.execute=graph=>graph_awaiter(this,void 0,void 0,(function*(){return{nodes:graph.getAllNodes().map((node=>({id:node.id,data:{x:Number(node.data.x)||0,y:Number(node.data.y)||0}}))),edges:[]}}))}yield this.hooks.layout.emitLinearAsync({graphCore,options:formattedOptions,animate:!disableAnimate}),this.emit("afterlayout")}))}stopLayout(){this.layoutController.stopLayout()}getLayoutCurrentAnimation(){return this.layoutController.getCurrentAnimation()}setMode(mode){this.hooks.modechange.emit({mode})}getMode(){return this.interactionController.getMode()}setCursor(cursor){this.canvas.setCursor(cursor),this.labelCanvas.setCursor(cursor),this.transientCanvas.setCursor(cursor),this.transientLabelCanvas.setCursor(cursor)}addBehaviors(behaviors,modes){const modesArr=(0,is_array.A)(modes)?modes:[modes],behaviorsArr=(0,is_array.A)(behaviors)?behaviors:[behaviors];this.hooks.behaviorchange.emit({action:"add",modes:modesArr,behaviors:behaviorsArr}),modesArr.forEach((mode=>{this.specification.modes[mode]=(this.specification.modes[mode]||[]).concat(behaviorsArr)}))}removeBehaviors(behaviorKeys,modes){const modesArr=(0,is_array.A)(modes)?modes:[modes];this.hooks.behaviorchange.emit({action:"remove",modes:modesArr,behaviors:behaviorKeys}),modesArr.forEach((mode=>{behaviorKeys.forEach((key=>{if(!this.specification.modes[mode])return;const oldBehavior=this.specification.modes[mode].find((behavior=>(0,is_object.A)(behavior)&&behavior.key===key)),indexOfOldBehavior=this.specification.modes[mode].indexOf(oldBehavior);this.specification.modes[mode].splice(indexOfOldBehavior,1)}))}))}updateBehavior(behavior,mode){this.hooks.behaviorchange.emit({action:"update",modes:[mode],behaviors:[behavior]})}addPlugins(pluginCfgs){const pluginsArr=(0,is_array.A)(pluginCfgs)?pluginCfgs:[pluginCfgs];this.specification.plugins||(this.specification.plugins=[]);const oldPlugins=this.specification.plugins,validPlugins=[];pluginsArr.forEach((config=>{oldPlugins.find((oldPlugin=>"string"!=typeof oldPlugin&&"string"!=typeof config&&oldPlugin.key===config.key))?console.warn(`Add plugin with key ${config.key} failed, the key is duplicated to the existing plugins on the graph.`):validPlugins.push(config)})),this.specification.plugins=oldPlugins.concat(validPlugins),this.hooks.pluginchange.emit({action:"add",plugins:validPlugins})}removePlugins(pluginKeys){const pluginArr=(0,is_array.A)(pluginKeys)?pluginKeys:[pluginKeys];this.hooks.pluginchange.emit({action:"remove",plugins:pluginArr});const{plugins}=this.specification;this.specification.plugins=null==plugins?void 0:plugins.filter((plugin=>(0,is_object.A)(plugin)?!(pluginArr.includes(plugin.key)||pluginArr.includes(plugin)):!pluginArr.includes(plugin)))}updatePlugin(plugin){const{plugins}=this.specification,{key,type}=plugin;if(key||console.warn(`The key for the plugin is not found. G6 will update the first plugin with type ${type}`),!plugins)return void console.warn("Update plugin failed, the plugin to be updated does not exist.");const oldPlugin=null==plugins?void 0:plugins.find((p=>"string"==typeof p?p===key||p===type:p.key===key||p.type===type));if(!oldPlugin)return void console.warn(`Update plugin failed, the plugin with key ${key} or type ${type} is not found.`);const idx=plugins.indexOf(oldPlugin);plugins[idx]=Object.assign(Object.assign({},oldPlugin),plugin),this.hooks.pluginchange.emit({action:"update",plugins:[plugin]})}drawTransient(type,id,config,canvas){return this.hooks.transientupdate.emit({type,id,config,canvas:canvas||this.transientCanvas,graphCore:this.dataController.graphCore}),this.itemController.getTransient(String(id))}toDataURL(type){return graph_awaiter(this,void 0,void 0,(function*(){const{backgroundCanvas,canvas,transientCanvas,labelCanvas,rendererType}=this,pixelRatio="undefined"!=typeof window?window.devicePixelRatio:1,[width,height]=this.getSize(),vContainerDOM=createDOM('<div id="virtual-image"></div>'),camera=canvas.getCamera(),vCanvas=createCanvas(rendererType,vContainerDOM,width,height,pixelRatio);yield vCanvas.ready;const backgroundClonedGroup=backgroundCanvas.getRoot().cloneNode(!0),clonedGroup=canvas.getRoot().cloneNode(!0),transientClonedGroup=transientCanvas.getRoot().cloneNode(!0),labelClonedGroup=labelCanvas.getRoot().cloneNode(!0),originViewportLTCanvas=vCanvas.viewport2Canvas({x:0,y:0}),currentViewportLTCanvas=canvas.viewport2Canvas({x:0,y:0});labelClonedGroup.translate([currentViewportLTCanvas.x-originViewportLTCanvas.x,currentViewportLTCanvas.y-originViewportLTCanvas.y]),labelClonedGroup.scale(1/canvas.getCamera().getZoom()),labelClonedGroup.children[0].children.forEach((childGroup=>{childGroup.children.forEach((shape=>{shape.getAttribute("data-is-label-background")&&shape.style.transform&&shape.remove()}))})),vCanvas.appendChild(backgroundClonedGroup),vCanvas.appendChild(clonedGroup),vCanvas.appendChild(labelClonedGroup),vCanvas.appendChild(transientClonedGroup);const vCamera=vCanvas.getCamera();vCamera.setZoom(camera.getZoom()),vCamera.setPosition(camera.getPosition()),vCamera.setFocalPoint(camera.getFocalPoint());const vCanvasContextService=vCanvas.getContextService();let bgRect;if("svg"!==rendererType){const backPositionCanvas=canvas.viewport2Canvas({x:0,y:0});bgRect=new Rect({style:Object.assign(Object.assign({},backPositionCanvas),{z:-1,width:vCanvasContextService.getDomElement().width,height:vCanvasContextService.getDomElement().height,fill:backgroundCanvas.getContextService().getDomElement().style["background-color"],zIndex:-10})}),vCanvas.appendChild(bgRect)}type||(type="image/png");let dataURL="";return new Promise((resolve=>{setTimeout((()=>{vCanvasContextService.toDataURL({type}).then((url=>{dataURL=url,resolve(dataURL)}))}),50)}))}))}toFullDataURL(type,imageConfig){return graph_awaiter(this,void 0,void 0,(function*(){const{backgroundCanvas,canvas,transientCanvas,labelCanvas,rendererType}=this,backgroundRoot=backgroundCanvas.getRoot(),root=canvas.getRoot(),transientRoot=transientCanvas.getRoot(),labelRoot=labelCanvas.getRoot(),backgroundBBox=backgroundRoot.getRenderBounds(),BBox=root.getRenderBounds(),transientBBox=transientRoot.getRenderBounds(),labelBBox=labelRoot.getRenderBounds();let padding=imageConfig?imageConfig.padding:void 0;padding?(0,is_number.A)(padding)&&(padding=[padding,padding,padding,padding]):padding=[0,0,0,0];const left=Math.min(backgroundBBox.min[0]||1/0,BBox.min[0]||1/0,transientBBox.min[0]||1/0,labelBBox.min[0]||1/0)-padding[3],right=Math.max(backgroundBBox.max[0]||-1/0,BBox.max[0]||-1/0,transientBBox.max[0]||-1/0,labelBBox.max[0]||-1/0)-padding[1],top=Math.min(backgroundBBox.min[1]||1/0,BBox.min[1]||1/0,transientBBox.min[1]||1/0,labelBBox.min[1]||1/0)-padding[0],bottom=Math.max(backgroundBBox.max[1]||-1/0,BBox.max[1]||-1/0,transientBBox.max[1]||-1/0,labelBBox.max[1]||-1/0)-padding[2],graphCenterX=(left+right)/2,graphCenterY=(top+bottom)/2,halfX=(right-left)/2,halfY=(bottom-top)/2,pixelRatio="undefined"!=typeof window?window.devicePixelRatio:1,vWidth=2*halfX,vHeight=2*halfY,vContainerDOM=createDOM('<div id="virtual-image"></div>'),vCanvas=createCanvas(rendererType,vContainerDOM,vWidth,vHeight,pixelRatio);yield vCanvas.ready;const vCanvasContextService=vCanvas.getContextService();if("svg"!==rendererType){const bgRect=new Rect({style:{x:0,y:0,z:-1,width:vCanvasContextService.getDomElement().width,height:vCanvasContextService.getDomElement().height,fill:backgroundCanvas.getContextService().getDomElement().style["background-color"]}});vCanvas.appendChild(bgRect)}const backgroundClonedGroup=backgroundRoot.cloneNode(!0),clonedGroup=root.cloneNode(!0),transientClonedGroup=transientRoot.cloneNode(!0),labelClonedGroup=labelRoot.cloneNode(!0),transPosition=[-graphCenterX+halfX,-graphCenterY+halfY];backgroundClonedGroup.setPosition(transPosition),clonedGroup.setPosition(transPosition),transientClonedGroup.setPosition(transPosition);const currentViewportLTCanvas=canvas.viewport2Canvas({x:0,y:0}),labelTransPosition=[transPosition[0]+currentViewportLTCanvas.x,transPosition[1]+currentViewportLTCanvas.y];labelClonedGroup.setPosition(labelTransPosition),labelClonedGroup.scale(1/canvas.getCamera().getZoom()),labelClonedGroup.children[0].children.forEach((childGroup=>{childGroup.children.forEach((shape=>{shape.getAttribute("data-is-label-background")&&shape.style.transform&&shape.remove()}))})),vCanvas.appendChild(backgroundClonedGroup),vCanvas.appendChild(clonedGroup),vCanvas.appendChild(labelClonedGroup),vCanvas.appendChild(transientClonedGroup),type||(type="image/png");let dataURL="";return new Promise((resolve=>{setTimeout((()=>{vCanvasContextService.toDataURL({type}).then((url=>{dataURL=url,resolve(dataURL)}))}),50)}))}))}dataURLToImage(dataURL,renderer,link,fileName){if(dataURL&&"data:"!==dataURL){if("undefined"!=typeof window)if(window.Blob&&window.URL&&"svg"!==renderer){const arr=dataURL.split(",");let mime="";if(arr&&arr.length>0){const match=arr[0].match(/:(.*?);/);match&&match.length>=2&&(mime=match[1])}const bstr=atob(arr[1]);let n=bstr.length;const u8arr=new Uint8Array(n);for(;n--;)u8arr[n]=bstr.charCodeAt(n);const blobObj=new Blob([u8arr],{type:mime});window.navigator.msSaveBlob?window.navigator.msSaveBlob(blobObj,fileName):link.addEventListener("click",(()=>{link.download=fileName,link.href=window.URL.createObjectURL(blobObj)}))}else link.addEventListener("click",(()=>{link.download=fileName,link.href=dataURL}))}else console.error("Download image failed. The graph is too large or there is invalid attribute values in graph items")}downloadImage(name,type){const rendererType=this.rendererType;type||(type="image/png");const fileName=(name||"graph")+("svg"===rendererType?".svg":type.split("/")[1]),link=document.createElement("a");this.asyncToDataUrl(type,(dataURL=>{this.dataURLToImage(dataURL,rendererType,link,fileName);const e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),link.dispatchEvent(e)}))}downloadFullImage(name,type,imageConfig){const rendererType=this.rendererType;type||(type="image/png");const fileName=(name||"graph")+("svg"===rendererType?".svg":type.split("/")[1]),link=document.createElement("a");this.asyncToFullDataUrl(type,imageConfig,(dataURL=>{this.dataURLToImage(dataURL,rendererType,link,fileName);const e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),link.dispatchEvent(e)}))}asyncToDataUrl(type,callback){let dataURL="";type||(type="image/png"),setTimeout((()=>graph_awaiter(this,void 0,void 0,(function*(){yield this.toDataURL(type).then((url=>{dataURL=url})),callback&&callback(dataURL)}))),16)}asyncToFullDataUrl(type,imageConfig,callback){let dataURL="";type||(type="image/png"),setTimeout((()=>graph_awaiter(this,void 0,void 0,(function*(){yield this.toFullDataURL(type,imageConfig).then((url=>{dataURL=url})),callback&&callback(dataURL)}))),16)}isHistoryEnabled(){const history=this.getHistoryPlugin();return null==history?void 0:history.isEnable()}pushStack(cmd,stackType,isNew){const history=this.getHistoryPlugin();return null==history?void 0:history.push(cmd,stackType,isNew)}pauseStack(){const history=this.getHistoryPlugin();return null==history?void 0:history.pauseStack()}resumeStack(){const history=this.getHistoryPlugin();return null==history?void 0:history.resumeStack()}getUndoStack(){const history=this.getHistoryPlugin();return null==history?void 0:history.getUndoStack()}getRedoStack(){const history=this.getHistoryPlugin();return null==history?void 0:history.getRedoStack()}getStack(){const history=this.getHistoryPlugin();return null==history?void 0:history.getStack()}undo(){const history=this.getHistoryPlugin();null==history||history.undo()}redo(){const history=this.getHistoryPlugin();null==history||history.redo()}canUndo(){const history=this.getHistoryPlugin();return null==history?void 0:history.canUndo()}canRedo(){const history=this.getHistoryPlugin();return null==history?void 0:history.canRedo()}startHistoryBatch(){const history=this.getHistoryPlugin();null==history||history.startHistoryBatch()}stopHistoryBatch(){const history=this.getHistoryPlugin();null==history||history.stopHistoryBatch()}historyBatch(callback){const history=this.getHistoryPlugin();null==history||history.historyBatch(callback)}cleanHistory(stackType){const history=this.getHistoryPlugin();return stackType?"undo"===stackType?null==history?void 0:history.clearUndoStack():null==history?void 0:history.clearRedoStack():null==history?void 0:history.clear()}collapse(ids,disableAnimate=!1){this.hooks.treecollapseexpand.emit({ids:(0,is_array.A)(ids)?ids:[ids],action:"collapse",animate:!disableAnimate,graphCore:this.dataController.graphCore})}expand(ids,disableAnimate=!1){this.hooks.treecollapseexpand.emit({ids:(0,is_array.A)(ids)?ids:[ids],action:"expand",animate:!disableAnimate,graphCore:this.dataController.graphCore})}destroy(callback){var _a;const camera=this.canvas.getCamera(),transientCamera=this.transientCanvas.getCamera();(null===(_a=camera.landmarks)||void 0===_a?void 0:_a.length)&&(camera.cancelLandmarkAnimation(),transientCamera.cancelLandmarkAnimation(),this.emit("cancelviewportanimation")),this.canvas.destroy(),this.labelCanvas.destroy(),this.backgroundCanvas.destroy(),this.transientCanvas.destroy(),this.transientLabelCanvas.destroy(),this.cleanHistory(),null==callback||callback(),this.hooks.destroy.emit({}),this.destroyed=!0}}const util_extend_extend=(GraphClass,extendLibrary)=>(Object.keys(extendLibrary).forEach((cat=>{registry.useLib[cat]=Object.assign({},registry.useLib[cat],extendLibrary[cat]||{}),Object.keys(registry.useLib[cat]).forEach((type=>{registry.useLib[cat][type].type=type}))})),GraphClass),mock=nodeCount=>{const nodeIds=[],nodes=Array.from({length:nodeCount}).map(((node,index)=>{const id=`node-${index}`;return nodeIds.push(id),{id,data:{}}})),fullEdges=[];for(let i=0;i<nodeCount;i+=1)for(let j=0;j<nodeCount-1;j+=1)fullEdges.push({source:`node-${i}`,target:`node-${j}`,id:unique_id("edge_id_"),data:{}});return{circle:(centerId="")=>{let id=centerId;-1===nodeIds.indexOf(id)&&(id="node-0");const edges=fullEdges.filter((edge=>edge.source===id||edge.target===id));return{nodes,edges}},random:(ratio=.5)=>{const length=parseInt(String(nodeCount*ratio)),randomArray=nodeIds.sort((()=>Math.random()-.5)).slice(0,length),edges=fullEdges.filter((edge=>-1!==randomArray.indexOf(edge.target))).sort((()=>Math.random()-.5)).slice(0,length);return{nodes,edges}}}};function leftTranslate(out,a,v){const transMat=[0,0,0,0,0,0,0,0,0];return function mat3_fromTranslation(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=v[0],out[7]=v[1],out[8]=1,out}(transMat,v),mat3_multiply(out,transMat,a)}function leftRotate(out,a,rad){const rotateMat=[0,0,0,0,0,0,0,0,0];return function mat3_fromRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=-s,out[4]=c,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}(rotateMat,rad),mat3_multiply(out,rotateMat,a)}function leftScale(out,a,v){const scaleMat=[0,0,0,0,0,0,0,0,0];return function mat3_fromScaling(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=v[1],out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}(scaleMat,v),mat3_multiply(out,scaleMat,a)}function transform(m,actions){const matrix=m?[].concat(m):[1,0,0,0,1,0,0,0,1];for(let i=0,len=actions.length;i<len;i++){const action=actions[i];switch(action[0]){case"t":leftTranslate(matrix,matrix,[action[1],action[2]]);break;case"s":leftScale(matrix,matrix,[action[1],action[2]]);break;case"r":leftRotate(matrix,matrix,action[1]);break;case"m":out=matrix,a=matrix,a1=action[1],mat3_multiply(out,a1,a)}}var out,a,a1;return matrix}runtime.enableCSSParsing=!1;const g6_esm={Graph:util_extend_extend(Graph,stdLib),Util:esm_util_namespaceObject,stdLib,Extensions,extend:util_extend_extend,version:"5.0.0"}},"./node_modules/@antv/hierarchy/build/hierarchy.js":function(module){!function webpackUniversalModuleDefinition(root,factory){module.exports=factory()}("undefined"!=typeof self&&self,(function(){return function(modules){var installedModules={};function __nested_webpack_require_578__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__nested_webpack_require_578__),module.l=!0,module.exports}return __nested_webpack_require_578__.m=modules,__nested_webpack_require_578__.c=installedModules,__nested_webpack_require_578__.d=function(exports,name,getter){__nested_webpack_require_578__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__nested_webpack_require_578__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __nested_webpack_require_578__.d(getter,"a",getter),getter},__nested_webpack_require_578__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__nested_webpack_require_578__.p="",__nested_webpack_require_578__(__nested_webpack_require_578__.s=36)}([function(module,__nested_webpack_exports__,__nested_webpack_require_2868__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_2868__(3);__nested_webpack_exports__.a=function(value){return Array.isArray?Array.isArray(value):Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Array")}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){return null!==value&&"function"!=typeof value&&isFinite(value.length)}},function(module,__nested_webpack_exports__,__nested_webpack_require_3732__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_3732__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Function")}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var toString={}.toString;__nested_webpack_exports__.a=function(value,type){return toString.call(value)==="[object "+type+"]"}},function(module,__nested_webpack_exports__,__nested_webpack_require_4461__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_4461__(3);__nested_webpack_exports__.a=function(str){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(str,"String")}},function(module,__nested_webpack_exports__,__nested_webpack_require_4823__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_4823__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Number")}},function(module,exports,__nested_webpack_require_5246__){var mix=__nested_webpack_require_5246__(38).mix;module.exports={assign:mix,getHeight:function getHeight(preNode,node,align,heightField){return void 0===heightField&&(heightField="height"),"center"===align?(preNode[heightField]+node[heightField])/2:preNode.height}}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){return null==value}},function(module,__nested_webpack_exports__,__nested_webpack_require_6444__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_6444__(0),__WEBPACK_IMPORTED_MODULE_1__is_object__=__nested_webpack_require_6444__(12);__nested_webpack_exports__.a=function each(elements,func){if(elements)if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(elements))for(var i=0,len=elements.length;i<len&&!1!==func(elements[i],i);i++);else if(Object(__WEBPACK_IMPORTED_MODULE_1__is_object__.a)(elements))for(var k in elements)if(elements.hasOwnProperty(k)&&!1===func(elements[k],k))break}},function(module,__nested_webpack_exports__,__nested_webpack_require_7385__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_7385__(7);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(value)?"":value.toString()}},function(module,__nested_webpack_exports__,__nested_webpack_require_7775__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_object_like__=__nested_webpack_require_7775__(14),__WEBPACK_IMPORTED_MODULE_1__is_type__=__nested_webpack_require_7775__(3);__nested_webpack_exports__.a=function(value){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_object_like__.a)(value)||!Object(__WEBPACK_IMPORTED_MODULE_1__is_type__.a)(value,"Object"))return!1;if(null===Object.getPrototypeOf(value))return!0;for(var proto=value;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(value)===proto}},function(module,exports,__nested_webpack_require_8779__){var hierarchy=__nested_webpack_require_8779__(18),Layout=function(){function Layout(root,options){void 0===options&&(options={});this.options=options,this.rootNode=hierarchy(root,options)}return Layout.prototype.execute=function execute(){throw new Error("please override this method")},Layout}();module.exports=Layout},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){var type=typeof value;return null!==value&&"object"===type||"function"===type}},function(module,__nested_webpack_exports__,__nested_webpack_require_9721__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_9721__(1);__nested_webpack_exports__.a=function(arr,value){return!!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr)&&arr.indexOf(value)>-1}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){return"object"==typeof value&&null!==value}},function(module,__nested_webpack_exports__,__nested_webpack_require_10593__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__each__=__nested_webpack_require_10593__(8),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_10593__(2),values=Object.values?function(obj){return Object.values(obj)}:function(obj){var result=[];return Object(__WEBPACK_IMPORTED_MODULE_0__each__.a)(obj,(function(value,key){Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(obj)&&"prototype"===key||result.push(value)})),result};__nested_webpack_exports__.a=values},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";function _mix(dist,obj){for(var key in obj)obj.hasOwnProperty(key)&&"constructor"!==key&&void 0!==obj[key]&&(dist[key]=obj[key])}__nested_webpack_exports__.a=function mix(dist,src1,src2,src3){src1&&_mix(dist,src1);src2&&_mix(dist,src2);src3&&_mix(dist,src3);return dist}},function(module,exports,__nested_webpack_require_11878__){var separateTree=__nested_webpack_require_11878__(35),VALID_DIRECTIONS=["LR","RL","TB","BT","H","V"],HORIZONTAL_DIRECTIONS=["LR","RL","H"],DEFAULT_DIRECTION=VALID_DIRECTIONS[0];module.exports=function(root,options,layoutAlgrithm){var direction=options.direction||DEFAULT_DIRECTION;if(options.isHorizontal=function isHorizontal(direction){return HORIZONTAL_DIRECTIONS.indexOf(direction)>-1}(direction),direction&&-1===VALID_DIRECTIONS.indexOf(direction))throw new TypeError("Invalid direction: "+direction);if(direction===VALID_DIRECTIONS[0])layoutAlgrithm(root,options);else if(direction===VALID_DIRECTIONS[1])layoutAlgrithm(root,options),root.right2left();else if(direction===VALID_DIRECTIONS[2])layoutAlgrithm(root,options);else if(direction===VALID_DIRECTIONS[3])layoutAlgrithm(root,options),root.bottom2top();else if(direction===VALID_DIRECTIONS[4]||direction===VALID_DIRECTIONS[5]){var _separateTree=separateTree(root,options),left=_separateTree.left,right=_separateTree.right;layoutAlgrithm(left,options),layoutAlgrithm(right,options),options.isHorizontal?left.right2left():left.bottom2top(),right.translate(left.x-right.x,left.y-right.y),root.x=left.x,root.y=right.y;var bb=root.getBoundingBox();options.isHorizontal?bb.top<0&&root.translate(0,-bb.top):bb.left<0&&root.translate(-bb.left,0)}var fixedRoot=options.fixedRoot;return void 0===fixedRoot&&(fixedRoot=!0),fixedRoot&&root.translate(-(root.x+root.width/2+root.hgap),-(root.y+root.height/2+root.vgap)),root}},function(module,exports,__nested_webpack_require_14181__){var util=__nested_webpack_require_14181__(6),DEFAULT_OPTIONS={getId:function getId(d){return d.id||d.name},getPreH:function getPreH(d){return d.preH||0},getPreV:function getPreV(d){return d.preV||0},getHGap:function getHGap(d){return d.hgap||18},getVGap:function getVGap(d){return d.vgap||18},getChildren:function getChildren(d){return d.children},getHeight:function getHeight(d){return d.height||36},getWidth:function getWidth(d){var label=d.label||" ";return d.width||18*label.split("").length}};function Node(data,options){var me=this;if(me.vgap=me.hgap=0,data instanceof Node)return data;me.data=data;var hgap=options.getHGap(data),vgap=options.getVGap(data);return me.preH=options.getPreH(data),me.preV=options.getPreV(data),me.width=options.getWidth(data),me.height=options.getHeight(data),me.width+=me.preH,me.height+=me.preV,me.id=options.getId(data),me.x=me.y=0,me.depth=0,me.children||(me.children=[]),me.addGap(hgap,vgap),me}util.assign(Node.prototype,{isRoot:function isRoot(){return 0===this.depth},isLeaf:function isLeaf(){return 0===this.children.length},addGap:function addGap(hgap,vgap){this.hgap+=hgap,this.vgap+=vgap,this.width+=2*hgap,this.height+=2*vgap},eachNode:function eachNode(callback){for(var current,nodes=[this];current=nodes.shift();)callback(current),nodes=current.children.concat(nodes)},DFTraverse:function DFTraverse(callback){this.eachNode(callback)},BFTraverse:function BFTraverse(callback){for(var current,nodes=[this];current=nodes.shift();)callback(current),nodes=nodes.concat(current.children)},getBoundingBox:function getBoundingBox(){var bb={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode((function(node){bb.left=Math.min(bb.left,node.x),bb.top=Math.min(bb.top,node.y),bb.width=Math.max(bb.width,node.x+node.width),bb.height=Math.max(bb.height,node.y+node.height)})),bb},translate:function translate(tx,ty){void 0===tx&&(tx=0),void 0===ty&&(ty=0),this.eachNode((function(node){node.x+=tx,node.y+=ty,node.x+=node.preH,node.y+=node.preV}))},right2left:function right2left(){var bb=this.getBoundingBox();this.eachNode((function(node){node.x=node.x-2*(node.x-bb.left)-node.width})),this.translate(bb.width,0)},bottom2top:function bottom2top(){var bb=this.getBoundingBox();this.eachNode((function(node){node.y=node.y-2*(node.y-bb.top)-node.height})),this.translate(0,bb.height)}}),module.exports=function hierarchy(data,options,isolated){void 0===options&&(options={});var node,root=new Node(data,options=util.assign({},DEFAULT_OPTIONS,options)),nodes=[root];if(!isolated&&!data.collapsed)for(;node=nodes.shift();)if(!node.data.collapsed){var children=options.getChildren(node.data),length=children?children.length:0;if(node.children=new Array(length),children&&length)for(var i=0;i<length;i++){var child=new Node(children[i],options);node.children[i]=child,nodes.push(child),child.parent=node,child.depth=node.depth+1}}return root}},function(module,__nested_webpack_exports__,__nested_webpack_require_19088__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_19088__(1);__nested_webpack_exports__.a=function(arr,func){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr))return arr;for(var result=[],index=0;index<arr.length;index++){var value=arr[index];func(value,index)&&result.push(value)}return result}},function(module,__nested_webpack_exports__,__nested_webpack_require_19683__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_19683__(7),__WEBPACK_IMPORTED_MODULE_1__keys__=__nested_webpack_require_19683__(21);__nested_webpack_exports__.a=function isMatch(obj,attrs){var _keys=Object(__WEBPACK_IMPORTED_MODULE_1__keys__.a)(attrs),length=_keys.length;if(Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(obj))return!length;for(var i=0;i<length;i+=1){var key=_keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0}},function(module,__nested_webpack_exports__,__nested_webpack_require_20433__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__each__=__nested_webpack_require_20433__(8),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_20433__(2),keys=Object.keys?function(obj){return Object.keys(obj)}:function(obj){var result=[];return Object(__WEBPACK_IMPORTED_MODULE_0__each__.a)(obj,(function(value,key){Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(obj)&&"prototype"===key||result.push(key)})),result};__nested_webpack_exports__.a=keys},function(module,__nested_webpack_exports__,__nested_webpack_require_21154__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_21154__(0);__nested_webpack_exports__.a=function(arr){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr))return arr.reduce((function(prev,curr){return Math.max(prev,curr)}),arr[0])}},function(module,__nested_webpack_exports__,__nested_webpack_require_21982__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_21982__(0);__nested_webpack_exports__.a=function(arr){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr))return arr.reduce((function(prev,curr){return Math.min(prev,curr)}),arr[0])}},function(module,__nested_webpack_exports__,__nested_webpack_require_22810__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_22810__(1),splice=Array.prototype.splice;__nested_webpack_exports__.a=function pullAt(arr,indexes){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr))return[];for(var length=arr?indexes.length:0,last=length-1;length--;){var previous=void 0,index=indexes[length];length!==last&&index===previous||(previous=index,splice.call(arr,index,1))}return arr}},function(module,__nested_webpack_exports__,__nested_webpack_require_23545__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__each__=__nested_webpack_require_23545__(8),__WEBPACK_IMPORTED_MODULE_1__is_array__=__nested_webpack_require_23545__(0),__WEBPACK_IMPORTED_MODULE_2__is_plain_object__=__nested_webpack_require_23545__(10);__nested_webpack_exports__.a=function(arr,fn,init){if(!Object(__WEBPACK_IMPORTED_MODULE_1__is_array__.a)(arr)&&!Object(__WEBPACK_IMPORTED_MODULE_2__is_plain_object__.a)(arr))return arr;var result=init;return Object(__WEBPACK_IMPORTED_MODULE_0__each__.a)(arr,(function(data,i){result=fn(result,data,i)})),result}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function uniq(arr,cache){void 0===cache&&(cache=new Map);var r=[];if(Array.isArray(arr))for(var i=0,len=arr.length;i<len;i++){var item=arr[i];cache.has(item)||(r.push(item),cache.set(item,!0))}return r}},function(module,__nested_webpack_exports__,__nested_webpack_require_24901__){"use strict";__nested_webpack_exports__.a=function groupToMap(data,condition){if(!condition)return{0:data};if(!Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(condition)){var paramscondition_1=Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(condition)?condition:condition.replace(/\s+/g,"").split("*");condition=function(row){for(var unique="_",i=0,l=paramscondition_1.length;i<l;i++)unique+=row[paramscondition_1[i]]&&row[paramscondition_1[i]].toString();return unique}}return Object(__WEBPACK_IMPORTED_MODULE_2__group_by__.a)(data,condition)};var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_24901__(0),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_24901__(2),__WEBPACK_IMPORTED_MODULE_2__group_by__=__nested_webpack_require_24901__(28)},function(module,__nested_webpack_exports__,__nested_webpack_require_26190__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_26190__(0),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_26190__(2),hasOwnProperty=Object.prototype.hasOwnProperty;__nested_webpack_exports__.a=function groupBy(data,condition){if(!condition||!Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(data))return{};for(var key,result={},predicate=Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(condition)?condition:function(item){return item[condition]},i=0;i<data.length;i++){var item=data[i];key=predicate(item),hasOwnProperty.call(result,key)?result[key].push(item):result[key]=[item]}return result}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(obj,key){return obj.hasOwnProperty(key)}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var toString={}.toString;__nested_webpack_exports__.a=function(value){return toString.call(value).replace(/^\[object /,"").replace(/]$/,"")}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var objectProto=Object.prototype;__nested_webpack_exports__.a=function(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}},function(module,__nested_webpack_exports__,__nested_webpack_require_28123__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_function__=__nested_webpack_require_28123__(2);__nested_webpack_exports__.a=function(f,resolver){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_function__.a)(f))throw new TypeError("Expected a function");var memoized=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=f.apply(this,args);return cache.set(key,result),result};return memoized.cache=new Map,memoized}},function(module,__nested_webpack_exports__,__nested_webpack_require_29147__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_object_like__=__nested_webpack_require_29147__(14),__WEBPACK_IMPORTED_MODULE_1__is_array_like__=__nested_webpack_require_29147__(1),__WEBPACK_IMPORTED_MODULE_2__is_string__=__nested_webpack_require_29147__(4),isEqual=function(value,other){if(value===other)return!0;if(!value||!other)return!1;if(Object(__WEBPACK_IMPORTED_MODULE_2__is_string__.a)(value)||Object(__WEBPACK_IMPORTED_MODULE_2__is_string__.a)(other))return!1;if(Object(__WEBPACK_IMPORTED_MODULE_1__is_array_like__.a)(value)||Object(__WEBPACK_IMPORTED_MODULE_1__is_array_like__.a)(other)){if(value.length!==other.length)return!1;for(var rst=!0,i=0;i<value.length&&(rst=isEqual(value[i],other[i]));i++);return rst}if(Object(__WEBPACK_IMPORTED_MODULE_0__is_object_like__.a)(value)||Object(__WEBPACK_IMPORTED_MODULE_0__is_object_like__.a)(other)){var valueKeys=Object.keys(value),otherKeys=Object.keys(other);if(valueKeys.length!==otherKeys.length)return!1;for(rst=!0,i=0;i<valueKeys.length&&(rst=isEqual(value[valueKeys[i]],other[valueKeys[i]]));i++);return rst}return!1};__nested_webpack_exports__.a=isEqual},function(module,__nested_webpack_exports__,__nested_webpack_require_30879__){"use strict";var ctx,__WEBPACK_IMPORTED_MODULE_0_tslib__=__nested_webpack_require_30879__(116),__WEBPACK_IMPORTED_MODULE_1__values__=__nested_webpack_require_30879__(15),__WEBPACK_IMPORTED_MODULE_2__memoize__=__nested_webpack_require_30879__(32),__WEBPACK_IMPORTED_MODULE_3__is_string__=__nested_webpack_require_30879__(4);__nested_webpack_exports__.a=Object(__WEBPACK_IMPORTED_MODULE_2__memoize__.a)((function(text,font){void 0===font&&(font={});var fontSize=font.fontSize,fontFamily=font.fontFamily,fontWeight=font.fontWeight,fontStyle=font.fontStyle,fontVariant=font.fontVariant;return ctx||(ctx=document.createElement("canvas").getContext("2d")),ctx.font=[fontStyle,fontVariant,fontWeight,fontSize+"px",fontFamily].join(" "),ctx.measureText(Object(__WEBPACK_IMPORTED_MODULE_3__is_string__.a)(text)?text:"").width}),(function(text,font){return void 0===font&&(font={}),Object(__WEBPACK_IMPORTED_MODULE_0_tslib__.a)([text],Object(__WEBPACK_IMPORTED_MODULE_1__values__.a)(font)).join("")}))},function(module,exports,__nested_webpack_require_32256__){var hierarchy=__nested_webpack_require_32256__(18);module.exports=function(root,options){for(var left=hierarchy(root.data,options,!0),right=hierarchy(root.data,options,!0),treeSize=root.children.length,rightTreeSize=Math.round(treeSize/2),getSide=options.getSide||function(child,index){return index<rightTreeSize?"right":"left"},i=0;i<treeSize;i++){var child=root.children[i];"right"===getSide(child,i)?right.children.push(child):left.children.push(child)}return left.eachNode((function(node){node.isRoot()||(node.side="left")})),right.eachNode((function(node){node.isRoot()||(node.side="right")})),{left,right}}},function(module,exports,__nested_webpack_require_33359__){var hierarchy={compactBox:__nested_webpack_require_33359__(37),dendrogram:__nested_webpack_require_33359__(120),indented:__nested_webpack_require_33359__(122),mindmap:__nested_webpack_require_33359__(124)};module.exports=hierarchy},function(module,exports,__nested_webpack_require_33638__){function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var TreeLayout=__nested_webpack_require_33638__(11),nonLayeredTidyTree=__nested_webpack_require_33638__(119),doTreeLayout=__nested_webpack_require_33638__(17),util=__nested_webpack_require_33638__(6),CompactBoxTreeLayout=function(_TreeLayout){function CompactBoxTreeLayout(){return _TreeLayout.apply(this,arguments)||this}return function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}(CompactBoxTreeLayout,_TreeLayout),CompactBoxTreeLayout.prototype.execute=function execute(){return doTreeLayout(this.rootNode,this.options,nonLayeredTidyTree)},CompactBoxTreeLayout}(TreeLayout),DEFAULT_OPTIONS={};module.exports=function compactBoxLayout(root,options){return options=util.assign({},DEFAULT_OPTIONS,options),new CompactBoxTreeLayout(root,options).execute()}},function(module,__nested_webpack_exports__,__nested_webpack_require_34951__){"use strict";Object.defineProperty(__nested_webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__contains__=__nested_webpack_require_34951__(13);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"contains",(function(){return __WEBPACK_IMPORTED_MODULE_0__contains__.a})),__nested_webpack_require_34951__.d(__nested_webpack_exports__,"includes",(function(){return __WEBPACK_IMPORTED_MODULE_0__contains__.a}));var __WEBPACK_IMPORTED_MODULE_1__difference__=__nested_webpack_require_34951__(39);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"difference",(function(){return __WEBPACK_IMPORTED_MODULE_1__difference__.a}));var __WEBPACK_IMPORTED_MODULE_2__find__=__nested_webpack_require_34951__(40);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"find",(function(){return __WEBPACK_IMPORTED_MODULE_2__find__.a}));var __WEBPACK_IMPORTED_MODULE_3__find_index__=__nested_webpack_require_34951__(41);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"findIndex",(function(){return __WEBPACK_IMPORTED_MODULE_3__find_index__.a}));var __WEBPACK_IMPORTED_MODULE_4__first_value__=__nested_webpack_require_34951__(42);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"firstValue",(function(){return __WEBPACK_IMPORTED_MODULE_4__first_value__.a}));var __WEBPACK_IMPORTED_MODULE_5__flatten__=__nested_webpack_require_34951__(43);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"flatten",(function(){return __WEBPACK_IMPORTED_MODULE_5__flatten__.a}));var __WEBPACK_IMPORTED_MODULE_6__flatten_deep__=__nested_webpack_require_34951__(44);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"flattenDeep",(function(){return __WEBPACK_IMPORTED_MODULE_6__flatten_deep__.a}));var __WEBPACK_IMPORTED_MODULE_7__get_range__=__nested_webpack_require_34951__(45);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"getRange",(function(){return __WEBPACK_IMPORTED_MODULE_7__get_range__.a}));var __WEBPACK_IMPORTED_MODULE_8__pull__=__nested_webpack_require_34951__(46);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"pull",(function(){return __WEBPACK_IMPORTED_MODULE_8__pull__.a}));var __WEBPACK_IMPORTED_MODULE_9__pull_at__=__nested_webpack_require_34951__(24);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"pullAt",(function(){return __WEBPACK_IMPORTED_MODULE_9__pull_at__.a}));var __WEBPACK_IMPORTED_MODULE_10__reduce__=__nested_webpack_require_34951__(25);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"reduce",(function(){return __WEBPACK_IMPORTED_MODULE_10__reduce__.a}));var __WEBPACK_IMPORTED_MODULE_11__remove__=__nested_webpack_require_34951__(47);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"remove",(function(){return __WEBPACK_IMPORTED_MODULE_11__remove__.a}));var __WEBPACK_IMPORTED_MODULE_12__sort_by__=__nested_webpack_require_34951__(48);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"sortBy",(function(){return __WEBPACK_IMPORTED_MODULE_12__sort_by__.a}));var __WEBPACK_IMPORTED_MODULE_13__union__=__nested_webpack_require_34951__(49);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"union",(function(){return __WEBPACK_IMPORTED_MODULE_13__union__.a}));var __WEBPACK_IMPORTED_MODULE_14__uniq__=__nested_webpack_require_34951__(26);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"uniq",(function(){return __WEBPACK_IMPORTED_MODULE_14__uniq__.a}));var __WEBPACK_IMPORTED_MODULE_15__values_of_key__=__nested_webpack_require_34951__(50);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"valuesOfKey",(function(){return __WEBPACK_IMPORTED_MODULE_15__values_of_key__.a}));var __WEBPACK_IMPORTED_MODULE_16__head__=__nested_webpack_require_34951__(51);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"head",(function(){return __WEBPACK_IMPORTED_MODULE_16__head__.a}));var __WEBPACK_IMPORTED_MODULE_17__last__=__nested_webpack_require_34951__(52);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"last",(function(){return __WEBPACK_IMPORTED_MODULE_17__last__.a}));var __WEBPACK_IMPORTED_MODULE_18__starts_with__=__nested_webpack_require_34951__(53);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"startsWith",(function(){return __WEBPACK_IMPORTED_MODULE_18__starts_with__.a}));var __WEBPACK_IMPORTED_MODULE_19__ends_with__=__nested_webpack_require_34951__(54);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"endsWith",(function(){return __WEBPACK_IMPORTED_MODULE_19__ends_with__.a}));var __WEBPACK_IMPORTED_MODULE_20__filter__=__nested_webpack_require_34951__(19);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"filter",(function(){return __WEBPACK_IMPORTED_MODULE_20__filter__.a}));var __WEBPACK_IMPORTED_MODULE_21__every__=__nested_webpack_require_34951__(55);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"every",(function(){return __WEBPACK_IMPORTED_MODULE_21__every__.a}));var __WEBPACK_IMPORTED_MODULE_22__some__=__nested_webpack_require_34951__(56);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"some",(function(){return __WEBPACK_IMPORTED_MODULE_22__some__.a}));var __WEBPACK_IMPORTED_MODULE_23__group__=__nested_webpack_require_34951__(57);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"group",(function(){return __WEBPACK_IMPORTED_MODULE_23__group__.a}));var __WEBPACK_IMPORTED_MODULE_24__group_by__=__nested_webpack_require_34951__(28);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"groupBy",(function(){return __WEBPACK_IMPORTED_MODULE_24__group_by__.a}));var __WEBPACK_IMPORTED_MODULE_25__group_to_map__=__nested_webpack_require_34951__(27);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"groupToMap",(function(){return __WEBPACK_IMPORTED_MODULE_25__group_to_map__.a}));var __WEBPACK_IMPORTED_MODULE_26__get_wrap_behavior__=__nested_webpack_require_34951__(58);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"getWrapBehavior",(function(){return __WEBPACK_IMPORTED_MODULE_26__get_wrap_behavior__.a}));var __WEBPACK_IMPORTED_MODULE_27__wrap_behavior__=__nested_webpack_require_34951__(59);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"wrapBehavior",(function(){return __WEBPACK_IMPORTED_MODULE_27__wrap_behavior__.a}));var __WEBPACK_IMPORTED_MODULE_28__number2color__=__nested_webpack_require_34951__(60);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"number2color",(function(){return __WEBPACK_IMPORTED_MODULE_28__number2color__.a}));var __WEBPACK_IMPORTED_MODULE_29__parse_radius__=__nested_webpack_require_34951__(61);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"parseRadius",(function(){return __WEBPACK_IMPORTED_MODULE_29__parse_radius__.a}));var __WEBPACK_IMPORTED_MODULE_30__clamp__=__nested_webpack_require_34951__(62);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"clamp",(function(){return __WEBPACK_IMPORTED_MODULE_30__clamp__.a}));var __WEBPACK_IMPORTED_MODULE_31__fixed_base__=__nested_webpack_require_34951__(63);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"fixedBase",(function(){return __WEBPACK_IMPORTED_MODULE_31__fixed_base__.a}));var __WEBPACK_IMPORTED_MODULE_32__is_decimal__=__nested_webpack_require_34951__(64);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isDecimal",(function(){return __WEBPACK_IMPORTED_MODULE_32__is_decimal__.a}));var __WEBPACK_IMPORTED_MODULE_33__is_even__=__nested_webpack_require_34951__(65);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isEven",(function(){return __WEBPACK_IMPORTED_MODULE_33__is_even__.a}));var __WEBPACK_IMPORTED_MODULE_34__is_integer__=__nested_webpack_require_34951__(66);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isInteger",(function(){return __WEBPACK_IMPORTED_MODULE_34__is_integer__.a}));var __WEBPACK_IMPORTED_MODULE_35__is_negative__=__nested_webpack_require_34951__(67);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isNegative",(function(){return __WEBPACK_IMPORTED_MODULE_35__is_negative__.a}));var __WEBPACK_IMPORTED_MODULE_36__is_number_equal__=__nested_webpack_require_34951__(68);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isNumberEqual",(function(){return __WEBPACK_IMPORTED_MODULE_36__is_number_equal__.a}));var __WEBPACK_IMPORTED_MODULE_37__is_odd__=__nested_webpack_require_34951__(69);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isOdd",(function(){return __WEBPACK_IMPORTED_MODULE_37__is_odd__.a}));var __WEBPACK_IMPORTED_MODULE_38__is_positive__=__nested_webpack_require_34951__(70);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isPositive",(function(){return __WEBPACK_IMPORTED_MODULE_38__is_positive__.a}));var __WEBPACK_IMPORTED_MODULE_39__max__=__nested_webpack_require_34951__(22);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"max",(function(){return __WEBPACK_IMPORTED_MODULE_39__max__.a}));var __WEBPACK_IMPORTED_MODULE_40__max_by__=__nested_webpack_require_34951__(71);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"maxBy",(function(){return __WEBPACK_IMPORTED_MODULE_40__max_by__.a}));var __WEBPACK_IMPORTED_MODULE_41__min__=__nested_webpack_require_34951__(23);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"min",(function(){return __WEBPACK_IMPORTED_MODULE_41__min__.a}));var __WEBPACK_IMPORTED_MODULE_42__min_by__=__nested_webpack_require_34951__(72);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"minBy",(function(){return __WEBPACK_IMPORTED_MODULE_42__min_by__.a}));var __WEBPACK_IMPORTED_MODULE_43__mod__=__nested_webpack_require_34951__(73);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"mod",(function(){return __WEBPACK_IMPORTED_MODULE_43__mod__.a}));var __WEBPACK_IMPORTED_MODULE_44__to_degree__=__nested_webpack_require_34951__(74);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"toDegree",(function(){return __WEBPACK_IMPORTED_MODULE_44__to_degree__.a}));var __WEBPACK_IMPORTED_MODULE_45__to_integer__=__nested_webpack_require_34951__(75);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"toInteger",(function(){return __WEBPACK_IMPORTED_MODULE_45__to_integer__.a}));var __WEBPACK_IMPORTED_MODULE_46__to_radian__=__nested_webpack_require_34951__(76);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"toRadian",(function(){return __WEBPACK_IMPORTED_MODULE_46__to_radian__.a}));var __WEBPACK_IMPORTED_MODULE_47__for_in__=__nested_webpack_require_34951__(77);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"forIn",(function(){return __WEBPACK_IMPORTED_MODULE_47__for_in__.a}));var __WEBPACK_IMPORTED_MODULE_48__has__=__nested_webpack_require_34951__(29);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"has",(function(){return __WEBPACK_IMPORTED_MODULE_48__has__.a}));var __WEBPACK_IMPORTED_MODULE_49__has_key__=__nested_webpack_require_34951__(78);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"hasKey",(function(){return __WEBPACK_IMPORTED_MODULE_49__has_key__.a}));var __WEBPACK_IMPORTED_MODULE_50__has_value__=__nested_webpack_require_34951__(79);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"hasValue",(function(){return __WEBPACK_IMPORTED_MODULE_50__has_value__.a}));var __WEBPACK_IMPORTED_MODULE_51__keys__=__nested_webpack_require_34951__(21);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"keys",(function(){return __WEBPACK_IMPORTED_MODULE_51__keys__.a}));var __WEBPACK_IMPORTED_MODULE_52__is_match__=__nested_webpack_require_34951__(20);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isMatch",(function(){return __WEBPACK_IMPORTED_MODULE_52__is_match__.a}));var __WEBPACK_IMPORTED_MODULE_53__values__=__nested_webpack_require_34951__(15);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"values",(function(){return __WEBPACK_IMPORTED_MODULE_53__values__.a}));var __WEBPACK_IMPORTED_MODULE_54__lower_case__=__nested_webpack_require_34951__(80);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"lowerCase",(function(){return __WEBPACK_IMPORTED_MODULE_54__lower_case__.a}));var __WEBPACK_IMPORTED_MODULE_55__lower_first__=__nested_webpack_require_34951__(81);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"lowerFirst",(function(){return __WEBPACK_IMPORTED_MODULE_55__lower_first__.a}));var __WEBPACK_IMPORTED_MODULE_56__substitute__=__nested_webpack_require_34951__(82);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"substitute",(function(){return __WEBPACK_IMPORTED_MODULE_56__substitute__.a}));var __WEBPACK_IMPORTED_MODULE_57__upper_case__=__nested_webpack_require_34951__(83);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"upperCase",(function(){return __WEBPACK_IMPORTED_MODULE_57__upper_case__.a}));var __WEBPACK_IMPORTED_MODULE_58__upper_first__=__nested_webpack_require_34951__(84);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"upperFirst",(function(){return __WEBPACK_IMPORTED_MODULE_58__upper_first__.a}));var __WEBPACK_IMPORTED_MODULE_59__get_type__=__nested_webpack_require_34951__(30);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"getType",(function(){return __WEBPACK_IMPORTED_MODULE_59__get_type__.a}));var __WEBPACK_IMPORTED_MODULE_60__is_arguments__=__nested_webpack_require_34951__(85);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isArguments",(function(){return __WEBPACK_IMPORTED_MODULE_60__is_arguments__.a}));var __WEBPACK_IMPORTED_MODULE_61__is_array__=__nested_webpack_require_34951__(0);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isArray",(function(){return __WEBPACK_IMPORTED_MODULE_61__is_array__.a}));var __WEBPACK_IMPORTED_MODULE_62__is_array_like__=__nested_webpack_require_34951__(1);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isArrayLike",(function(){return __WEBPACK_IMPORTED_MODULE_62__is_array_like__.a}));var __WEBPACK_IMPORTED_MODULE_63__is_boolean__=__nested_webpack_require_34951__(86);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isBoolean",(function(){return __WEBPACK_IMPORTED_MODULE_63__is_boolean__.a}));var __WEBPACK_IMPORTED_MODULE_64__is_date__=__nested_webpack_require_34951__(87);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isDate",(function(){return __WEBPACK_IMPORTED_MODULE_64__is_date__.a}));var __WEBPACK_IMPORTED_MODULE_65__is_error__=__nested_webpack_require_34951__(88);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isError",(function(){return __WEBPACK_IMPORTED_MODULE_65__is_error__.a}));var __WEBPACK_IMPORTED_MODULE_66__is_function__=__nested_webpack_require_34951__(2);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isFunction",(function(){return __WEBPACK_IMPORTED_MODULE_66__is_function__.a}));var __WEBPACK_IMPORTED_MODULE_67__is_finite__=__nested_webpack_require_34951__(89);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isFinite",(function(){return __WEBPACK_IMPORTED_MODULE_67__is_finite__.a}));var __WEBPACK_IMPORTED_MODULE_68__is_nil__=__nested_webpack_require_34951__(7);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isNil",(function(){return __WEBPACK_IMPORTED_MODULE_68__is_nil__.a}));var __WEBPACK_IMPORTED_MODULE_69__is_null__=__nested_webpack_require_34951__(90);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isNull",(function(){return __WEBPACK_IMPORTED_MODULE_69__is_null__.a}));var __WEBPACK_IMPORTED_MODULE_70__is_number__=__nested_webpack_require_34951__(5);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isNumber",(function(){return __WEBPACK_IMPORTED_MODULE_70__is_number__.a}));var __WEBPACK_IMPORTED_MODULE_71__is_object__=__nested_webpack_require_34951__(12);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isObject",(function(){return __WEBPACK_IMPORTED_MODULE_71__is_object__.a}));var __WEBPACK_IMPORTED_MODULE_72__is_object_like__=__nested_webpack_require_34951__(14);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isObjectLike",(function(){return __WEBPACK_IMPORTED_MODULE_72__is_object_like__.a}));var __WEBPACK_IMPORTED_MODULE_73__is_plain_object__=__nested_webpack_require_34951__(10);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isPlainObject",(function(){return __WEBPACK_IMPORTED_MODULE_73__is_plain_object__.a}));var __WEBPACK_IMPORTED_MODULE_74__is_prototype__=__nested_webpack_require_34951__(31);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isPrototype",(function(){return __WEBPACK_IMPORTED_MODULE_74__is_prototype__.a}));var __WEBPACK_IMPORTED_MODULE_75__is_reg_exp__=__nested_webpack_require_34951__(91);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isRegExp",(function(){return __WEBPACK_IMPORTED_MODULE_75__is_reg_exp__.a}));var __WEBPACK_IMPORTED_MODULE_76__is_string__=__nested_webpack_require_34951__(4);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isString",(function(){return __WEBPACK_IMPORTED_MODULE_76__is_string__.a}));var __WEBPACK_IMPORTED_MODULE_77__is_type__=__nested_webpack_require_34951__(3);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isType",(function(){return __WEBPACK_IMPORTED_MODULE_77__is_type__.a}));var __WEBPACK_IMPORTED_MODULE_78__is_undefined__=__nested_webpack_require_34951__(92);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isUndefined",(function(){return __WEBPACK_IMPORTED_MODULE_78__is_undefined__.a}));var __WEBPACK_IMPORTED_MODULE_79__is_element__=__nested_webpack_require_34951__(93);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isElement",(function(){return __WEBPACK_IMPORTED_MODULE_79__is_element__.a}));var __WEBPACK_IMPORTED_MODULE_80__request_animation_frame__=__nested_webpack_require_34951__(94);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"requestAnimationFrame",(function(){return __WEBPACK_IMPORTED_MODULE_80__request_animation_frame__.a}));var __WEBPACK_IMPORTED_MODULE_81__clear_animation_frame__=__nested_webpack_require_34951__(95);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"clearAnimationFrame",(function(){return __WEBPACK_IMPORTED_MODULE_81__clear_animation_frame__.a}));var __WEBPACK_IMPORTED_MODULE_82__augment__=__nested_webpack_require_34951__(96);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"augment",(function(){return __WEBPACK_IMPORTED_MODULE_82__augment__.a}));var __WEBPACK_IMPORTED_MODULE_83__clone__=__nested_webpack_require_34951__(97);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"clone",(function(){return __WEBPACK_IMPORTED_MODULE_83__clone__.a}));var __WEBPACK_IMPORTED_MODULE_84__debounce__=__nested_webpack_require_34951__(98);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"debounce",(function(){return __WEBPACK_IMPORTED_MODULE_84__debounce__.a}));var __WEBPACK_IMPORTED_MODULE_85__memoize__=__nested_webpack_require_34951__(32);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"memoize",(function(){return __WEBPACK_IMPORTED_MODULE_85__memoize__.a}));var __WEBPACK_IMPORTED_MODULE_86__deep_mix__=__nested_webpack_require_34951__(99);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"deepMix",(function(){return __WEBPACK_IMPORTED_MODULE_86__deep_mix__.a}));var __WEBPACK_IMPORTED_MODULE_87__each__=__nested_webpack_require_34951__(8);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"each",(function(){return __WEBPACK_IMPORTED_MODULE_87__each__.a}));var __WEBPACK_IMPORTED_MODULE_88__extend__=__nested_webpack_require_34951__(100);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"extend",(function(){return __WEBPACK_IMPORTED_MODULE_88__extend__.a}));var __WEBPACK_IMPORTED_MODULE_89__index_of__=__nested_webpack_require_34951__(101);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"indexOf",(function(){return __WEBPACK_IMPORTED_MODULE_89__index_of__.a}));var __WEBPACK_IMPORTED_MODULE_90__is_empty__=__nested_webpack_require_34951__(102);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isEmpty",(function(){return __WEBPACK_IMPORTED_MODULE_90__is_empty__.a}));var __WEBPACK_IMPORTED_MODULE_91__is_equal__=__nested_webpack_require_34951__(33);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isEqual",(function(){return __WEBPACK_IMPORTED_MODULE_91__is_equal__.a}));var __WEBPACK_IMPORTED_MODULE_92__is_equal_with__=__nested_webpack_require_34951__(103);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"isEqualWith",(function(){return __WEBPACK_IMPORTED_MODULE_92__is_equal_with__.a}));var __WEBPACK_IMPORTED_MODULE_93__map__=__nested_webpack_require_34951__(104);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"map",(function(){return __WEBPACK_IMPORTED_MODULE_93__map__.a}));var __WEBPACK_IMPORTED_MODULE_94__map_values__=__nested_webpack_require_34951__(105);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"mapValues",(function(){return __WEBPACK_IMPORTED_MODULE_94__map_values__.a}));var __WEBPACK_IMPORTED_MODULE_95__mix__=__nested_webpack_require_34951__(16);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"mix",(function(){return __WEBPACK_IMPORTED_MODULE_95__mix__.a})),__nested_webpack_require_34951__.d(__nested_webpack_exports__,"assign",(function(){return __WEBPACK_IMPORTED_MODULE_95__mix__.a}));var __WEBPACK_IMPORTED_MODULE_96__get__=__nested_webpack_require_34951__(106);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"get",(function(){return __WEBPACK_IMPORTED_MODULE_96__get__.a}));var __WEBPACK_IMPORTED_MODULE_97__set__=__nested_webpack_require_34951__(107);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"set",(function(){return __WEBPACK_IMPORTED_MODULE_97__set__.a}));var __WEBPACK_IMPORTED_MODULE_98__pick__=__nested_webpack_require_34951__(108);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"pick",(function(){return __WEBPACK_IMPORTED_MODULE_98__pick__.a}));var __WEBPACK_IMPORTED_MODULE_99__omit__=__nested_webpack_require_34951__(109);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"omit",(function(){return __WEBPACK_IMPORTED_MODULE_99__omit__.a}));var __WEBPACK_IMPORTED_MODULE_100__throttle__=__nested_webpack_require_34951__(110);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"throttle",(function(){return __WEBPACK_IMPORTED_MODULE_100__throttle__.a}));var __WEBPACK_IMPORTED_MODULE_101__to_array__=__nested_webpack_require_34951__(111);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"toArray",(function(){return __WEBPACK_IMPORTED_MODULE_101__to_array__.a}));var __WEBPACK_IMPORTED_MODULE_102__to_string__=__nested_webpack_require_34951__(9);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"toString",(function(){return __WEBPACK_IMPORTED_MODULE_102__to_string__.a}));var __WEBPACK_IMPORTED_MODULE_103__unique_id__=__nested_webpack_require_34951__(112);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"uniqueId",(function(){return __WEBPACK_IMPORTED_MODULE_103__unique_id__.a}));var __WEBPACK_IMPORTED_MODULE_104__noop__=__nested_webpack_require_34951__(113);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"noop",(function(){return __WEBPACK_IMPORTED_MODULE_104__noop__.a}));var __WEBPACK_IMPORTED_MODULE_105__identity__=__nested_webpack_require_34951__(114);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"identity",(function(){return __WEBPACK_IMPORTED_MODULE_105__identity__.a}));var __WEBPACK_IMPORTED_MODULE_106__size__=__nested_webpack_require_34951__(115);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"size",(function(){return __WEBPACK_IMPORTED_MODULE_106__size__.a}));var __WEBPACK_IMPORTED_MODULE_107__measure_text_width__=__nested_webpack_require_34951__(34);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"measureTextWidth",(function(){return __WEBPACK_IMPORTED_MODULE_107__measure_text_width__.a}));var __WEBPACK_IMPORTED_MODULE_108__get_ellipsis_text__=__nested_webpack_require_34951__(117);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"getEllipsisText",(function(){return __WEBPACK_IMPORTED_MODULE_108__get_ellipsis_text__.a}));var __WEBPACK_IMPORTED_MODULE_109__cache__=__nested_webpack_require_34951__(118);__nested_webpack_require_34951__.d(__nested_webpack_exports__,"Cache",(function(){return __WEBPACK_IMPORTED_MODULE_109__cache__.a}))},function(module,__nested_webpack_exports__,__nested_webpack_require_63451__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__filter__=__nested_webpack_require_63451__(19),__WEBPACK_IMPORTED_MODULE_1__contains__=__nested_webpack_require_63451__(13);__nested_webpack_exports__.a=function(arr,values){return void 0===values&&(values=[]),Object(__WEBPACK_IMPORTED_MODULE_0__filter__.a)(arr,(function(value){return!Object(__WEBPACK_IMPORTED_MODULE_1__contains__.a)(values,value)}))}},function(module,__nested_webpack_exports__,__nested_webpack_require_64359__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_function__=__nested_webpack_require_64359__(2),__WEBPACK_IMPORTED_MODULE_1__is_match__=__nested_webpack_require_64359__(20),__WEBPACK_IMPORTED_MODULE_2__is_array__=__nested_webpack_require_64359__(0),__WEBPACK_IMPORTED_MODULE_3__is_plain_object__=__nested_webpack_require_64359__(10);__nested_webpack_exports__.a=function find(arr,predicate){if(!Object(__WEBPACK_IMPORTED_MODULE_2__is_array__.a)(arr))return null;var _predicate;if(Object(__WEBPACK_IMPORTED_MODULE_0__is_function__.a)(predicate)&&(_predicate=predicate),Object(__WEBPACK_IMPORTED_MODULE_3__is_plain_object__.a)(predicate)&&(_predicate=function(a){return Object(__WEBPACK_IMPORTED_MODULE_1__is_match__.a)(a,predicate)}),_predicate)for(var i=0;i<arr.length;i+=1)if(_predicate(arr[i]))return arr[i];return null}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function findIndex(arr,predicate,fromIndex){void 0===fromIndex&&(fromIndex=0);for(var i=fromIndex;i<arr.length;i++)if(predicate(arr[i],i))return i;return-1}},function(module,__nested_webpack_exports__,__nested_webpack_require_65970__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_65970__(7),__WEBPACK_IMPORTED_MODULE_1__is_array__=__nested_webpack_require_65970__(0);__nested_webpack_exports__.a=function(data,name){for(var rst=null,i=0;i<data.length;i++){var value=data[i][name];if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(value)){rst=Object(__WEBPACK_IMPORTED_MODULE_1__is_array__.a)(value)?value[0]:value;break}}return rst}},function(module,__nested_webpack_exports__,__nested_webpack_require_66792__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_66792__(0);__nested_webpack_exports__.a=function(arr){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr))return[];for(var rst=[],i=0;i<arr.length;i++)rst=rst.concat(arr[i]);return rst}},function(module,__nested_webpack_exports__,__nested_webpack_require_67519__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_67519__(0),flattenDeep=function(arr,result){if(void 0===result&&(result=[]),Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr))for(var i=0;i<arr.length;i+=1)flattenDeep(arr[i],result);else result.push(arr);return result};__nested_webpack_exports__.a=flattenDeep},function(module,__nested_webpack_exports__,__nested_webpack_require_68373__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_68373__(0),__WEBPACK_IMPORTED_MODULE_1__max__=__nested_webpack_require_68373__(22),__WEBPACK_IMPORTED_MODULE_2__min__=__nested_webpack_require_68373__(23);__nested_webpack_exports__.a=function(values){var filterValues=values.filter((function(v){return!isNaN(v)}));if(!filterValues.length)return{min:0,max:0};if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(values[0])){for(var tmp=[],i=0;i<values.length;i++)tmp=tmp.concat(values[i]);filterValues=tmp}var max=Object(__WEBPACK_IMPORTED_MODULE_1__max__.a)(filterValues);return{min:Object(__WEBPACK_IMPORTED_MODULE_2__min__.a)(filterValues),max}}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var arrPrototype=Array.prototype,splice=arrPrototype.splice,indexOf=arrPrototype.indexOf;__nested_webpack_exports__.a=function(arr){for(var values=[],_i=1;_i<arguments.length;_i++)values[_i-1]=arguments[_i];for(var i=0;i<values.length;i++)for(var value=values[i],fromIndex=-1;(fromIndex=indexOf.call(arr,value))>-1;)splice.call(arr,fromIndex,1);return arr}},function(module,__nested_webpack_exports__,__nested_webpack_require_70127__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_70127__(1),__WEBPACK_IMPORTED_MODULE_1__pull_at__=__nested_webpack_require_70127__(24);__nested_webpack_exports__.a=function(arr,predicate){var result=[];if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr))return result;for(var i=-1,indexes=[],length=arr.length;++i<length;){var value=arr[i];predicate(value,i,arr)&&(result.push(value),indexes.push(i))}return Object(__WEBPACK_IMPORTED_MODULE_1__pull_at__.a)(arr,indexes),result}},function(module,__nested_webpack_exports__,__nested_webpack_require_71125__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_71125__(0),__WEBPACK_IMPORTED_MODULE_1__is_string__=__nested_webpack_require_71125__(4),__WEBPACK_IMPORTED_MODULE_2__is_function__=__nested_webpack_require_71125__(2);__nested_webpack_exports__.a=function sortBy(arr,key){var comparer;if(Object(__WEBPACK_IMPORTED_MODULE_2__is_function__.a)(key))comparer=function(a,b){return key(a)-key(b)};else{var keys_1=[];Object(__WEBPACK_IMPORTED_MODULE_1__is_string__.a)(key)?keys_1.push(key):Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(key)&&(keys_1=key),comparer=function(a,b){for(var i=0;i<keys_1.length;i+=1){var prop=keys_1[i];if(a[prop]>b[prop])return 1;if(a[prop]<b[prop])return-1}return 0}}return arr.sort(comparer),arr}},function(module,__nested_webpack_exports__,__nested_webpack_require_72342__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__uniq__=__nested_webpack_require_72342__(26);__nested_webpack_exports__.a=function(){for(var sources=[],_i=0;_i<arguments.length;_i++)sources[_i]=arguments[_i];return Object(__WEBPACK_IMPORTED_MODULE_0__uniq__.a)([].concat.apply([],sources))}},function(module,__nested_webpack_exports__,__nested_webpack_require_72838__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_72838__(0),__WEBPACK_IMPORTED_MODULE_1__is_nil__=__nested_webpack_require_72838__(7);__nested_webpack_exports__.a=function(data,name){for(var rst=[],tmpMap={},i=0;i<data.length;i++){var value=data[i][name];if(!Object(__WEBPACK_IMPORTED_MODULE_1__is_nil__.a)(value)){Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(value)||(value=[value]);for(var j=0;j<value.length;j++){var val=value[j];tmpMap[val]||(rst.push(val),tmpMap[val]=!0)}}}return rst}},function(module,__nested_webpack_exports__,__nested_webpack_require_73775__){"use strict";__nested_webpack_exports__.a=function head(o){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(o))return o[0];return};var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_73775__(1)},function(module,__nested_webpack_exports__,__nested_webpack_require_74187__){"use strict";__nested_webpack_exports__.a=function last(o){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(o)){return o[o.length-1]}return};var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_74187__(1)},function(module,__nested_webpack_exports__,__nested_webpack_require_74631__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_74631__(0),__WEBPACK_IMPORTED_MODULE_1__is_string__=__nested_webpack_require_74631__(4);__nested_webpack_exports__.a=function startsWith(arr,e){return!(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr)&&!Object(__WEBPACK_IMPORTED_MODULE_1__is_string__.a)(arr))&&arr[0]===e}},function(module,__nested_webpack_exports__,__nested_webpack_require_75202__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_75202__(0),__WEBPACK_IMPORTED_MODULE_1__is_string__=__nested_webpack_require_75202__(4);__nested_webpack_exports__.a=function endsWith(arr,e){return!(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr)&&!Object(__WEBPACK_IMPORTED_MODULE_1__is_string__.a)(arr))&&arr[arr.length-1]===e}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(arr,func){for(var i=0;i<arr.length;i++)if(!func(arr[i],i))return!1;return!0}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(arr,func){for(var i=0;i<arr.length;i++)if(func(arr[i],i))return!0;return!1}},function(module,__nested_webpack_exports__,__nested_webpack_require_76509__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__group_to_map__=__nested_webpack_require_76509__(27);__nested_webpack_exports__.a=function(data,condition){if(!condition)return[data];var groups=Object(__WEBPACK_IMPORTED_MODULE_0__group_to_map__.a)(data,condition),array=[];for(var i in groups)array.push(groups[i]);return array}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function getWrapBehavior(obj,action){return obj["_wrap_"+action]}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function wrapBehavior(obj,action){if(obj["_wrap_"+action])return obj["_wrap_"+action];var method=function(e){obj[action](e)};return obj["_wrap_"+action]=method,method}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var numColorCache={};__nested_webpack_exports__.a=function numberToColor(num){var color=numColorCache[num];if(!color){for(var str=num.toString(16),i=str.length;i<6;i++)str="0"+str;color="#"+str,numColorCache[num]=color}return color}},function(module,__nested_webpack_exports__,__nested_webpack_require_78457__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_78457__(0);__nested_webpack_exports__.a=function parseRadius(radius){var r1=0,r2=0,r3=0,r4=0;return Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(radius)?1===radius.length?r1=r2=r3=r4=radius[0]:2===radius.length?(r1=r3=radius[0],r2=r4=radius[1]):3===radius.length?(r1=radius[0],r2=r4=radius[1],r3=radius[2]):(r1=radius[0],r2=radius[1],r3=radius[2],r4=radius[3]):r1=r2=r3=r4=radius,{r1,r2,r3,r4}}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(a,min,max){return a<min?min:a>max?max:a}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(v,base){var str=base.toString(),index=str.indexOf(".");if(-1===index)return Math.round(v);var length=str.substr(index+1).length;return length>20&&(length=20),parseFloat(v.toFixed(length))}},function(module,__nested_webpack_exports__,__nested_webpack_require_80125__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_80125__(5);__nested_webpack_exports__.a=function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num%1!=0}},function(module,__nested_webpack_exports__,__nested_webpack_require_80526__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_80526__(5);__nested_webpack_exports__.a=function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num%2==0}},function(module,__nested_webpack_exports__,__nested_webpack_require_80921__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_80921__(5),isInteger=Number.isInteger?Number.isInteger:function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num%1==0};__nested_webpack_exports__.a=isInteger},function(module,__nested_webpack_exports__,__nested_webpack_require_81360__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_81360__(5);__nested_webpack_exports__.a=function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num<0}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function isNumberEqual(a,b,precision){void 0===precision&&(precision=PRECISION);return Math.abs(a-b)<precision};var PRECISION=1e-5},function(module,__nested_webpack_exports__,__nested_webpack_require_82150__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_82150__(5);__nested_webpack_exports__.a=function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num%2!=0}},function(module,__nested_webpack_exports__,__nested_webpack_require_82543__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_82543__(5);__nested_webpack_exports__.a=function(num){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(num)&&num>0}},function(module,__nested_webpack_exports__,__nested_webpack_require_82940__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_82940__(0),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_82940__(2);__nested_webpack_exports__.a=function(arr,fn){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr)){for(var maxItem,max=-1/0,i=0;i<arr.length;i++){var item=arr[i],v=Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(fn)?fn(item):item[fn];v>max&&(maxItem=item,max=v)}return maxItem}}},function(module,__nested_webpack_exports__,__nested_webpack_require_84050__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_84050__(0),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_84050__(2);__nested_webpack_exports__.a=function(arr,fn){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(arr)){for(var minItem,min=1/0,i=0;i<arr.length;i++){var item=arr[i],v=Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(fn)?fn(item):item[fn];v<min&&(minItem=item,min=v)}return minItem}}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(n,m){return(n%m+m)%m}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var DEGREE=180/Math.PI;__nested_webpack_exports__.a=function(radian){return DEGREE*radian}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=parseInt},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var RADIAN=Math.PI/180;__nested_webpack_exports__.a=function(degree){return RADIAN*degree}},function(module,__nested_webpack_exports__,__nested_webpack_require_86079__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__each__=__nested_webpack_require_86079__(8);__nested_webpack_exports__.a=__WEBPACK_IMPORTED_MODULE_0__each__.a},function(module,__nested_webpack_exports__,__nested_webpack_require_86384__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__has__=__nested_webpack_require_86384__(29);__nested_webpack_exports__.a=__WEBPACK_IMPORTED_MODULE_0__has__.a},function(module,__nested_webpack_exports__,__nested_webpack_require_86688__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__contains__=__nested_webpack_require_86688__(13),__WEBPACK_IMPORTED_MODULE_1__values__=__nested_webpack_require_86688__(15);__nested_webpack_exports__.a=function(obj,value){return Object(__WEBPACK_IMPORTED_MODULE_0__contains__.a)(Object(__WEBPACK_IMPORTED_MODULE_1__values__.a)(obj),value)}},function(module,__nested_webpack_exports__,__nested_webpack_require_87215__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__to_string__=__nested_webpack_require_87215__(9);__nested_webpack_exports__.a=function(str){return Object(__WEBPACK_IMPORTED_MODULE_0__to_string__.a)(str).toLowerCase()}},function(module,__nested_webpack_exports__,__nested_webpack_require_87613__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__to_string__=__nested_webpack_require_87613__(9);__nested_webpack_exports__.a=function(value){var str=Object(__WEBPACK_IMPORTED_MODULE_0__to_string__.a)(value);return str.charAt(0).toLowerCase()+str.substring(1)}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function substitute(str,o){return str&&o?str.replace(/\\?\{([^{}]+)\}/g,(function(match,name){return"\\"===match.charAt(0)?match.slice(1):void 0===o[name]?"":o[name]})):str}},function(module,__nested_webpack_exports__,__nested_webpack_require_88500__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__to_string__=__nested_webpack_require_88500__(9);__nested_webpack_exports__.a=function(str){return Object(__WEBPACK_IMPORTED_MODULE_0__to_string__.a)(str).toUpperCase()}},function(module,__nested_webpack_exports__,__nested_webpack_require_88898__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__to_string__=__nested_webpack_require_88898__(9);__nested_webpack_exports__.a=function(value){var str=Object(__WEBPACK_IMPORTED_MODULE_0__to_string__.a)(value);return str.charAt(0).toUpperCase()+str.substring(1)}},function(module,__nested_webpack_exports__,__nested_webpack_require_89348__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_89348__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Arguments")}},function(module,__nested_webpack_exports__,__nested_webpack_require_89822__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_89822__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Boolean")}},function(module,__nested_webpack_exports__,__nested_webpack_require_90290__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_90290__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Date")}},function(module,__nested_webpack_exports__,__nested_webpack_require_90676__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_90676__(3);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(value,"Error")}},function(module,__nested_webpack_exports__,__nested_webpack_require_91138__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_number__=__nested_webpack_require_91138__(5);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_number__.a)(value)&&isFinite(value)}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){return null===value}},function(module,__nested_webpack_exports__,__nested_webpack_require_91788__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_type__=__nested_webpack_require_91788__(3);__nested_webpack_exports__.a=function(str){return Object(__WEBPACK_IMPORTED_MODULE_0__is_type__.a)(str,"RegExp")}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(value){return void 0===value}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(o){return o instanceof Element||o instanceof HTMLDocument}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function requestAnimationFrame(fn){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(f){return setTimeout(f,16)})(fn)}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function cancelAnimationFrame(handler){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(handler)}},function(module,__nested_webpack_exports__,__nested_webpack_require_93675__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__mix__=__nested_webpack_require_93675__(16),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_93675__(2);__nested_webpack_exports__.a=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];for(var c=args[0],i=1;i<args.length;i++){var obj=args[i];Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(obj)&&(obj=obj.prototype),Object(__WEBPACK_IMPORTED_MODULE_0__mix__.a)(c.prototype,obj)}}},function(module,__nested_webpack_exports__,__nested_webpack_require_94452__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_94452__(0),clone=function(obj){if("object"!=typeof obj||null===obj)return obj;var rst;if(Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(obj)){rst=[];for(var i=0,l=obj.length;i<l;i++)"object"==typeof obj[i]&&null!=obj[i]?rst[i]=clone(obj[i]):rst[i]=obj[i]}else for(var k in rst={},obj)"object"==typeof obj[k]&&null!=obj[k]?rst[k]=clone(obj[k]):rst[k]=obj[k];return rst};__nested_webpack_exports__.a=clone},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout((function(){timeout=null,immediate||func.apply(context,args)}),wait),callNow&&func.apply(context,args)}}},function(module,__nested_webpack_exports__,__nested_webpack_require_95923__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array__=__nested_webpack_require_95923__(0),__WEBPACK_IMPORTED_MODULE_1__is_plain_object__=__nested_webpack_require_95923__(10);function _deepMix(dist,src,level,maxLevel){for(var key in level=level||0,maxLevel=maxLevel||5,src)if(src.hasOwnProperty(key)){var value=src[key];null!==value&&Object(__WEBPACK_IMPORTED_MODULE_1__is_plain_object__.a)(value)?(Object(__WEBPACK_IMPORTED_MODULE_1__is_plain_object__.a)(dist[key])||(dist[key]={}),level<maxLevel?_deepMix(dist[key],value,level+1,maxLevel):dist[key]=src[key]):Object(__WEBPACK_IMPORTED_MODULE_0__is_array__.a)(value)?(dist[key]=[],dist[key]=dist[key].concat(value)):void 0!==value&&(dist[key]=value)}}__nested_webpack_exports__.a=function(rst){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var i=0;i<args.length;i+=1)_deepMix(rst,args[i]);return rst}},function(module,__nested_webpack_exports__,__nested_webpack_require_97397__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__mix__=__nested_webpack_require_97397__(16),__WEBPACK_IMPORTED_MODULE_1__is_function__=__nested_webpack_require_97397__(2);__nested_webpack_exports__.a=function(subclass,superclass,overrides,staticOverrides){Object(__WEBPACK_IMPORTED_MODULE_1__is_function__.a)(superclass)||(overrides=superclass,superclass=subclass,subclass=function(){});var create=Object.create?function(proto,c){return Object.create(proto,{constructor:{value:c}})}:function(proto,c){function Tmp(){}Tmp.prototype=proto;var o=new Tmp;return o.constructor=c,o},superObj=create(superclass.prototype,subclass);return subclass.prototype=Object(__WEBPACK_IMPORTED_MODULE_0__mix__.a)(superObj,subclass.prototype),subclass.superclass=create(superclass.prototype,superclass),Object(__WEBPACK_IMPORTED_MODULE_0__mix__.a)(superObj,overrides),Object(__WEBPACK_IMPORTED_MODULE_0__mix__.a)(subclass,staticOverrides),subclass}},function(module,__nested_webpack_exports__,__nested_webpack_require_98818__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_98818__(1);__nested_webpack_exports__.a=function(arr,obj){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr))return-1;var m=Array.prototype.indexOf;if(m)return m.call(arr,obj);for(var index=-1,i=0;i<arr.length;i++)if(arr[i]===obj){index=i;break}return index}},function(module,__nested_webpack_exports__,__nested_webpack_require_99451__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_99451__(7),__WEBPACK_IMPORTED_MODULE_1__is_array_like__=__nested_webpack_require_99451__(1),__WEBPACK_IMPORTED_MODULE_2__get_type__=__nested_webpack_require_99451__(30),__WEBPACK_IMPORTED_MODULE_3__is_prototype__=__nested_webpack_require_99451__(31),hasOwnProperty=Object.prototype.hasOwnProperty;__nested_webpack_exports__.a=function isEmpty(value){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(value))return!0;if(Object(__WEBPACK_IMPORTED_MODULE_1__is_array_like__.a)(value))return!value.length;var type=Object(__WEBPACK_IMPORTED_MODULE_2__get_type__.a)(value);if("Map"===type||"Set"===type)return!value.size;if(Object(__WEBPACK_IMPORTED_MODULE_3__is_prototype__.a)(value))return!Object.keys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}},function(module,__nested_webpack_exports__,__nested_webpack_require_100911__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_function__=__nested_webpack_require_100911__(2),__WEBPACK_IMPORTED_MODULE_1__is_equal__=__nested_webpack_require_100911__(33);__nested_webpack_exports__.a=function(value,other,fn){return Object(__WEBPACK_IMPORTED_MODULE_0__is_function__.a)(fn)?!!fn(value,other):Object(__WEBPACK_IMPORTED_MODULE_1__is_equal__.a)(value,other)}},function(module,__nested_webpack_exports__,__nested_webpack_require_102109__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_102109__(1);__nested_webpack_exports__.a=function(arr,func){if(!Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(arr))return arr;for(var result=[],index=0;index<arr.length;index++){var value=arr[index];result.push(func(value,index))}return result}},function(module,__nested_webpack_exports__,__nested_webpack_require_102692__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_102692__(7),__WEBPACK_IMPORTED_MODULE_1__is_object__=__nested_webpack_require_102692__(12),identity=function(v){return v};__nested_webpack_exports__.a=function(object,func){void 0===func&&(func=identity);var r={};return Object(__WEBPACK_IMPORTED_MODULE_1__is_object__.a)(object)&&!Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(object)&&Object.keys(object).forEach((function(key){r[key]=func(object[key],key)})),r}},function(module,__nested_webpack_exports__,__nested_webpack_require_103470__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_string__=__nested_webpack_require_103470__(4);__nested_webpack_exports__.a=function(obj,key,defaultValue){for(var p=0,keyArr=Object(__WEBPACK_IMPORTED_MODULE_0__is_string__.a)(key)?key.split("."):key;obj&&p<keyArr.length;)obj=obj[keyArr[p++]];return void 0===obj||p<keyArr.length?defaultValue:obj}},function(module,__nested_webpack_exports__,__nested_webpack_require_104144__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_object__=__nested_webpack_require_104144__(12),__WEBPACK_IMPORTED_MODULE_1__is_string__=__nested_webpack_require_104144__(4),__WEBPACK_IMPORTED_MODULE_2__is_number__=__nested_webpack_require_104144__(5);__nested_webpack_exports__.a=function(obj,path,value){var o=obj,keyArr=Object(__WEBPACK_IMPORTED_MODULE_1__is_string__.a)(path)?path.split("."):path;return keyArr.forEach((function(key,idx){idx<keyArr.length-1?(Object(__WEBPACK_IMPORTED_MODULE_0__is_object__.a)(o[key])||(o[key]=Object(__WEBPACK_IMPORTED_MODULE_2__is_number__.a)(keyArr[idx+1])?[]:{}),o=o[key]):o[key]=value})),obj}},function(module,__nested_webpack_exports__,__nested_webpack_require_105237__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__each__=__nested_webpack_require_105237__(8),__WEBPACK_IMPORTED_MODULE_1__is_plain_object__=__nested_webpack_require_105237__(10),hasOwnProperty=Object.prototype.hasOwnProperty;__nested_webpack_exports__.a=function(object,keys){if(null===object||!Object(__WEBPACK_IMPORTED_MODULE_1__is_plain_object__.a)(object))return{};var result={};return Object(__WEBPACK_IMPORTED_MODULE_0__each__.a)(keys,(function(key){hasOwnProperty.call(object,key)&&(result[key]=object[key])})),result}},function(module,__nested_webpack_exports__,__nested_webpack_require_106013__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__reduce__=__nested_webpack_require_106013__(25);__nested_webpack_exports__.a=function(obj,keys){return Object(__WEBPACK_IMPORTED_MODULE_0__reduce__.a)(obj,(function(r,curr,key){return keys.includes(key)||(r[key]=curr),r}),{})}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(func,wait,options){var timeout,context,args,result,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:Date.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)},throttled=function(){var now=Date.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result};return throttled.cancel=function(){clearTimeout(timeout),previous=0,timeout=context=args=null},throttled}},function(module,__nested_webpack_exports__,__nested_webpack_require_107679__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_array_like__=__nested_webpack_require_107679__(1);__nested_webpack_exports__.a=function(value){return Object(__WEBPACK_IMPORTED_MODULE_0__is_array_like__.a)(value)?Array.prototype.slice.call(value):[]}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var map={};__nested_webpack_exports__.a=function(prefix){return map[prefix=prefix||"g"]?map[prefix]+=1:map[prefix]=1,prefix+map[prefix]}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(){}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function(v){return v}},function(module,__nested_webpack_exports__,__nested_webpack_require_108796__){"use strict";__nested_webpack_exports__.a=function size(o){if(Object(__WEBPACK_IMPORTED_MODULE_0__is_nil__.a)(o))return 0;if(Object(__WEBPACK_IMPORTED_MODULE_1__is_array_like__.a)(o))return o.length;return Object.keys(o).length};var __WEBPACK_IMPORTED_MODULE_0__is_nil__=__nested_webpack_require_108796__(7),__WEBPACK_IMPORTED_MODULE_1__is_array_like__=__nested_webpack_require_108796__(1)},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";__nested_webpack_exports__.a=function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r};Object.create;Object.create},function(module,__nested_webpack_exports__,__nested_webpack_require_125362__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__is_string__=__nested_webpack_require_125362__(4),__WEBPACK_IMPORTED_MODULE_1__to_string__=__nested_webpack_require_125362__(9),__WEBPACK_IMPORTED_MODULE_2__measure_text_width__=__nested_webpack_require_125362__(34);__nested_webpack_exports__.a=function(text,maxWidth,font,str){void 0===str&&(str="...");var currentText,currentWidth,PLACEHOLDER_WIDTH=Object(__WEBPACK_IMPORTED_MODULE_2__measure_text_width__.a)(str,font),leftText=Object(__WEBPACK_IMPORTED_MODULE_0__is_string__.a)(text)?text:Object(__WEBPACK_IMPORTED_MODULE_1__to_string__.a)(text),leftWidth=maxWidth,r=[];if(Object(__WEBPACK_IMPORTED_MODULE_2__measure_text_width__.a)(text,font)<=maxWidth)return text;for(;currentText=leftText.substr(0,16),!((currentWidth=Object(__WEBPACK_IMPORTED_MODULE_2__measure_text_width__.a)(currentText,font))+PLACEHOLDER_WIDTH>leftWidth&&currentWidth>leftWidth);)if(r.push(currentText),leftWidth-=currentWidth,!(leftText=leftText.substr(16)))return r.join("");for(;currentText=leftText.substr(0,1),!((currentWidth=Object(__WEBPACK_IMPORTED_MODULE_2__measure_text_width__.a)(currentText,font))+PLACEHOLDER_WIDTH>leftWidth);)if(r.push(currentText),leftWidth-=currentWidth,!(leftText=leftText.substr(1)))return r.join("");return""+r.join("")+str}},function(module,__nested_webpack_exports__,__webpack_require__){"use strict";var default_1=function(){function default_1(){this.map={}}return default_1.prototype.has=function(key){return void 0!==this.map[key]},default_1.prototype.get=function(key,def){var v=this.map[key];return void 0===v?def:v},default_1.prototype.set=function(key,value){this.map[key]=value},default_1.prototype.clear=function(){this.map={}},default_1.prototype.delete=function(key){delete this.map[key]},default_1.prototype.size=function(){return Object.keys(this.map).length},default_1}();__nested_webpack_exports__.a=default_1},function(module,exports){function WrappedTree(w,h,y,c){void 0===c&&(c=[]);var me=this;me.w=w||0,me.h=h||0,me.y=y||0,me.x=0,me.c=c||[],me.cs=c.length,me.prelim=0,me.mod=0,me.shift=0,me.change=0,me.tl=null,me.tr=null,me.el=null,me.er=null,me.msel=0,me.mser=0}function moveRight(node,move,isHorizontal){isHorizontal?node.y+=move:node.x+=move,node.children.forEach((function(child){moveRight(child,move,isHorizontal)}))}function getMin(node,isHorizontal){var res=isHorizontal?node.y:node.x;return node.children.forEach((function(child){res=Math.min(getMin(child,isHorizontal),res)})),res}function normalize(node,isHorizontal){moveRight(node,-getMin(node,isHorizontal),isHorizontal)}function convertBack(converted,root,isHorizontal){isHorizontal?root.y=converted.x:root.x=converted.x,converted.c.forEach((function(child,i){convertBack(child,root.children[i],isHorizontal)}))}function layer(node,isHorizontal,d){void 0===d&&(d=0),isHorizontal?(node.x=d,d+=node.width):(node.y=d,d+=node.height),node.children.forEach((function(child){layer(child,isHorizontal,d)}))}WrappedTree.fromNode=function(root,isHorizontal){if(!root)return null;var children=[];return root.children.forEach((function(child){children.push(WrappedTree.fromNode(child,isHorizontal))})),isHorizontal?new WrappedTree(root.height,root.width,root.x,children):new WrappedTree(root.width,root.height,root.y,children)},module.exports=function(root,options){void 0===options&&(options={});var isHorizontal=options.isHorizontal;function setExtremes(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function separate(t,i,ih){for(var sr=t.c[i-1],mssr=sr.mod,cl=t.c[i],mscl=cl.mod;null!==sr&&null!==cl;){bottom(sr)>ih.low&&(ih=ih.nxt);var dist=mssr+sr.prelim+sr.w-(mscl+cl.prelim);dist>0&&(mscl+=dist,moveSubtree(t,i,ih.index,dist));var sy=bottom(sr),cy=bottom(cl);sy<=cy&&null!==(sr=nextRightContour(sr))&&(mssr+=sr.mod),sy>=cy&&null!==(cl=nextLeftContour(cl))&&(mscl+=cl.mod)}!sr&&cl?function setLeftThread(t,i,cl,modsumcl){var li=t.c[0].el;li.tl=cl;var diff=modsumcl-cl.mod-t.c[0].msel;li.mod+=diff,li.prelim-=diff,t.c[0].el=t.c[i].el,t.c[0].msel=t.c[i].msel}(t,i,cl,mscl):sr&&!cl&&function setRightThread(t,i,sr,modsumsr){var ri=t.c[i].er;ri.tr=sr;var diff=modsumsr-sr.mod-t.c[i].mser;ri.mod+=diff,ri.prelim-=diff,t.c[i].er=t.c[i-1].er,t.c[i].mser=t.c[i-1].mser}(t,i,sr,mssr)}function moveSubtree(t,i,si,dist){t.c[i].mod+=dist,t.c[i].msel+=dist,t.c[i].mser+=dist,function distributeExtra(t,i,si,dist){if(si!==i-1){var nr=i-si;t.c[si+1].shift+=dist/nr,t.c[i].shift-=dist/nr,t.c[i].change-=dist-dist/nr}}(t,i,si,dist)}function nextLeftContour(t){return 0===t.cs?t.tl:t.c[0]}function nextRightContour(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function bottom(t){return t.y+t.h}function updateIYL(low,index,ih){for(;null!==ih&&low>=ih.low;)ih=ih.nxt;return{low,index,nxt:ih}}layer(root,isHorizontal);var wt=WrappedTree.fromNode(root,isHorizontal);return function firstWalk(t){if(0!==t.cs){firstWalk(t.c[0]);for(var ih=updateIYL(bottom(t.c[0].el),0,null),i=1;i<t.cs;++i){firstWalk(t.c[i]);var min=bottom(t.c[i].er);separate(t,i,ih),ih=updateIYL(min,i,ih)}!function positionRoot(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(t),setExtremes(t)}else setExtremes(t)}(wt),function secondWalk(t,modsum){modsum+=t.mod,t.x=t.prelim+modsum,function addChildSpacing(t){for(var d=0,modsumdelta=0,i=0;i<t.cs;i++)modsumdelta+=(d+=t.c[i].shift)+t.c[i].change,t.c[i].mod+=modsumdelta}(t);for(var i=0;i<t.cs;i++)secondWalk(t.c[i],modsum)}(wt,0),convertBack(wt,root,isHorizontal),normalize(root,isHorizontal),root}},function(module,exports,__nested_webpack_require_134345__){function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var TreeLayout=__nested_webpack_require_134345__(11),dendrogram=__nested_webpack_require_134345__(121),doTreeLayout=__nested_webpack_require_134345__(17),util=__nested_webpack_require_134345__(6),DendrogramLayout=function(_TreeLayout){function DendrogramLayout(){return _TreeLayout.apply(this,arguments)||this}return function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}(DendrogramLayout,_TreeLayout),DendrogramLayout.prototype.execute=function execute(){return this.rootNode.width=0,doTreeLayout(this.rootNode,this.options,dendrogram)},DendrogramLayout}(TreeLayout),DEFAULT_OPTIONS={};module.exports=function dendrogramLayout(root,options){return options=util.assign({},DEFAULT_OPTIONS,options),new DendrogramLayout(root,options).execute()}},function(module,exports,__nested_webpack_require_135634__){var util=__nested_webpack_require_135634__(6);function WrappedTree(height,children){void 0===height&&(height=0),void 0===children&&(children=[]);var me=this;me.x=me.y=0,me.leftChild=me.rightChild=null,me.height=0,me.children=children}var DEFAULT_OPTIONS={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};function convertBack(converted,root,isHorizontal){isHorizontal?(root.x=converted.x,root.y=converted.y):(root.x=converted.y,root.y=converted.x),converted.children.forEach((function(child,i){convertBack(child,root.children[i],isHorizontal)}))}module.exports=function(root,options){void 0===options&&(options={}),options=util.assign({},DEFAULT_OPTIONS,options);var prevLeaf,maxDepth=0;var wt=function wrappedTreeFromNode(n){if(!n)return null;n.width=0,n.depth&&n.depth>maxDepth&&(maxDepth=n.depth);var children=n.children,childrenCount=children.length,t=new WrappedTree(n.height,[]);return children.forEach((function(child,i){var childWT=wrappedTreeFromNode(child);t.children.push(childWT),0===i&&(t.leftChild=childWT),i===childrenCount-1&&(t.rightChild=childWT)})),t.originNode=n,t.isLeaf=n.isLeaf(),t}(root);return function getDrawingDepth(t){if(t.isLeaf||0===t.children.length)t.drawingDepth=maxDepth;else{var depths=t.children.map((function(child){return getDrawingDepth(child)})),minChildDepth=Math.min.apply(null,depths);t.drawingDepth=minChildDepth-1}return t.drawingDepth}(wt),function position(t){t.x=t.drawingDepth*options.rankSep,t.isLeaf?(t.y=0,prevLeaf&&(t.y=prevLeaf.y+prevLeaf.height+options.nodeSep,t.originNode.parent!==prevLeaf.originNode.parent&&(t.y+=options.subTreeSep)),prevLeaf=t):(t.children.forEach((function(child){position(child)})),t.y=(t.leftChild.y+t.rightChild.y)/2)}(wt),convertBack(wt,root,options.isHorizontal),root}},function(module,exports,__nested_webpack_require_138523__){function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var TreeLayout=__nested_webpack_require_138523__(11),indentedTree=__nested_webpack_require_138523__(123),separateTree=__nested_webpack_require_138523__(35),util=__nested_webpack_require_138523__(6),VALID_DIRECTIONS=["LR","RL","H"],DEFAULT_DIRECTION=VALID_DIRECTIONS[0],IndentedLayout=function(_TreeLayout){function IndentedLayout(){return _TreeLayout.apply(this,arguments)||this}return function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}(IndentedLayout,_TreeLayout),IndentedLayout.prototype.execute=function execute(){var options=this.options,root=this.rootNode;options.isHorizontal=!0;var _options$indent=options.indent,indent=void 0===_options$indent?20:_options$indent,_options$dropCap=options.dropCap,dropCap=void 0===_options$dropCap||_options$dropCap,_options$direction=options.direction,direction=void 0===_options$direction?DEFAULT_DIRECTION:_options$direction,align=options.align;if(direction&&-1===VALID_DIRECTIONS.indexOf(direction))throw new TypeError("Invalid direction: "+direction);if(direction===VALID_DIRECTIONS[0])indentedTree(root,indent,dropCap,align);else if(direction===VALID_DIRECTIONS[1])indentedTree(root,indent,dropCap,align),root.right2left();else if(direction===VALID_DIRECTIONS[2]){var _separateTree=separateTree(root,options),left=_separateTree.left,right=_separateTree.right;indentedTree(left,indent,dropCap,align),left.right2left(),indentedTree(right,indent,dropCap,align);var bbox=left.getBoundingBox();right.translate(bbox.width,0),root.x=right.x-root.width/2}return root},IndentedLayout}(TreeLayout),DEFAULT_OPTIONS={};module.exports=function indentedLayout(root,options){return options=util.assign({},DEFAULT_OPTIONS,options),new IndentedLayout(root,options).execute()}},function(module,exports,__nested_webpack_require_141256__){var util=__nested_webpack_require_141256__(6);module.exports=function(root,indent,dropCap,align){var previousNode=null;root.eachNode((function(node){!function positionNode(node,previousNode,indent,dropCap,align){var displacementX="function"==typeof indent?indent(node):indent*node.depth;if(!dropCap)try{if(node.id===node.parent.children[0].id)return node.x+=displacementX,void(node.y=previousNode?previousNode.y:0)}catch(e){}if(node.x+=displacementX,previousNode){if(node.y=previousNode.y+util.getHeight(previousNode,node,align),previousNode.parent&&node.parent.id!==previousNode.parent.id){var prevParent=previousNode.parent,preY=prevParent.y+util.getHeight(prevParent,node,align);node.y=preY>node.y?preY:node.y}}else node.y=0}(node,previousNode,indent,dropCap,align),previousNode=node}))}},function(module,exports,__nested_webpack_require_142549__){function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var TreeLayout=__nested_webpack_require_142549__(11),mindmap=__nested_webpack_require_142549__(125),doTreeLayout=__nested_webpack_require_142549__(17),util=__nested_webpack_require_142549__(6),MindmapLayout=function(_TreeLayout){function MindmapLayout(){return _TreeLayout.apply(this,arguments)||this}return function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}(MindmapLayout,_TreeLayout),MindmapLayout.prototype.execute=function execute(){return doTreeLayout(this.rootNode,this.options,mindmap)},MindmapLayout}(TreeLayout),DEFAULT_OPTIONS={};module.exports=function mindmapLayout(root,options){return options=util.assign({},DEFAULT_OPTIONS,options),new MindmapLayout(root,options).execute()}},function(module,exports,__nested_webpack_require_143781__){var util=__nested_webpack_require_143781__(6);function secondWalk(node,options){var totalHeight=0;return node.children.length?node.children.forEach((function(c){totalHeight+=secondWalk(c,options)})):totalHeight=node.height,node._subTreeSep=options.getSubTreeSep(node.data),node.totalHeight=Math.max(node.height,totalHeight)+2*node._subTreeSep,node.totalHeight}function thirdWalk(node){var children=node.children,len=children.length;if(len){children.forEach((function(c){thirdWalk(c)}));var first=children[0],last=children[len-1],childrenHeight=last.y-first.y+last.height,childrenTotalHeight=0;if(children.forEach((function(child){childrenTotalHeight+=child.totalHeight})),childrenHeight>node.height)node.y=first.y+childrenHeight/2-node.height/2;else if(1!==children.length||node.height>childrenTotalHeight){var offset=node.y+(node.height-childrenHeight)/2-first.y;children.forEach((function(c){c.translate(0,offset)}))}else node.y=(first.y+first.height/2+last.y+last.height/2)/2-node.height/2}}var DEFAULT_OPTIONS={getSubTreeSep:function getSubTreeSep(){return 0}};module.exports=function(root,options){void 0===options&&(options={}),options=util.assign({},DEFAULT_OPTIONS,options),root.parent={x:0,width:0,height:0,y:0},root.BFTraverse((function(node){node.x=node.parent.x+node.parent.width})),root.parent=null,secondWalk(root,options),root.startY=0,root.y=root.totalHeight/2-root.height/2,root.eachNode((function(node){var children=node.children,len=children.length;if(len){var first=children[0];if(first.startY=node.startY+node._subTreeSep,1===len)first.y=node.y+node.height/2-first.height/2;else{first.y=first.startY+first.totalHeight/2-first.height/2;for(var i=1;i<len;i++){var c=children[i];c.startY=children[i-1].startY+children[i-1].totalHeight,c.y=c.startY+c.totalHeight/2-c.height/2}}}})),thirdWalk(root)}}])}))},"./node_modules/color-string/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var colorNames=__webpack_require__("./node_modules/color-name/index.js"),swizzle=__webpack_require__("./node_modules/simple-swizzle/index.js"),hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs=module.exports={to:{},get:{}};function clamp(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=Math.round(num).toString(16).toUpperCase();return str.length<2?"0"+str:str}cs.get=function(string){var val,model;switch(string.substring(0,3).toLowerCase()){case"hsl":val=cs.get.hsl(string),model="hsl";break;case"hwb":val=cs.get.hwb(string),model="hwb";break;default:val=cs.get.rgb(string),model="rgb"}return val?{model,value:val}:null},cs.get.rgb=function(string){if(!string)return null;var match,i,hexAlpha,rgb=[0,0,0,1];if(match=string.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(hexAlpha=match[2],match=match[1],i=0;i<3;i++){var i2=2*i;rgb[i]=parseInt(match.slice(i2,i2+2),16)}hexAlpha&&(rgb[3]=parseInt(hexAlpha,16)/255)}else if(match=string.match(/^#([a-f0-9]{3,4})$/i)){for(hexAlpha=(match=match[1])[3],i=0;i<3;i++)rgb[i]=parseInt(match[i]+match[i],16);hexAlpha&&(rgb[3]=parseInt(hexAlpha+hexAlpha,16)/255)}else if(match=string.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)rgb[i]=parseInt(match[i+1],0);match[4]&&(match[5]?rgb[3]=.01*parseFloat(match[4]):rgb[3]=parseFloat(match[4]))}else{if(!(match=string.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(match=string.match(/^(\w+)$/))?"transparent"===match[1]?[0,0,0,0]:hasOwnProperty.call(colorNames,match[1])?((rgb=colorNames[match[1]])[3]=1,rgb):null:null;for(i=0;i<3;i++)rgb[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&&(match[5]?rgb[3]=.01*parseFloat(match[4]):rgb[3]=parseFloat(match[4]))}for(i=0;i<3;i++)rgb[i]=clamp(rgb[i],0,255);return rgb[3]=clamp(rgb[3],0,1),rgb},cs.get.hsl=function(string){if(!string)return null;var match=string.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs.get.hwb=function(string){if(!string)return null;var match=string.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs.to.hex=function(){var rgba=swizzle(arguments);return"#"+hexDouble(rgba[0])+hexDouble(rgba[1])+hexDouble(rgba[2])+(rgba[3]<1?hexDouble(Math.round(255*rgba[3])):"")},cs.to.rgb=function(){var rgba=swizzle(arguments);return rgba.length<4||1===rgba[3]?"rgb("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+")":"rgba("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+", "+rgba[3]+")"},cs.to.rgb.percent=function(){var rgba=swizzle(arguments),r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return rgba.length<4||1===rgba[3]?"rgb("+r+"%, "+g+"%, "+b+"%)":"rgba("+r+"%, "+g+"%, "+b+"%, "+rgba[3]+")"},cs.to.hsl=function(){var hsla=swizzle(arguments);return hsla.length<4||1===hsla[3]?"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)":"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+hsla[3]+")"},cs.to.hwb=function(){var hwba=swizzle(arguments),a="";return hwba.length>=4&&1!==hwba[3]&&(a=", "+hwba[3]),"hwb("+hwba[0]+", "+hwba[1]+"%, "+hwba[2]+"%"+a+")"},cs.to.keyword=function(rgb){return reverseNames[rgb.slice(0,3)]}},"./node_modules/color/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{const colorString=__webpack_require__("./node_modules/color-string/index.js"),convert=__webpack_require__("./node_modules/color-convert/index.js"),skippedModels=["keyword","gray","hex"],hashedModelKeys={};for(const model of Object.keys(convert))hashedModelKeys[[...convert[model].labels].sort().join("")]=model;const limiters={};function Color(object,model){if(!(this instanceof Color))return new Color(object,model);if(model&&model in skippedModels&&(model=null),model&&!(model in convert))throw new Error("Unknown model: "+model);let i,channels;if(null==object)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(object instanceof Color)this.model=object.model,this.color=[...object.color],this.valpha=object.valpha;else if("string"==typeof object){const result=colorString.get(object);if(null===result)throw new Error("Unable to parse color from string: "+object);this.model=result.model,channels=convert[this.model].channels,this.color=result.value.slice(0,channels),this.valpha="number"==typeof result.value[channels]?result.value[channels]:1}else if(object.length>0){this.model=model||"rgb",channels=convert[this.model].channels;const newArray=Array.prototype.slice.call(object,0,channels);this.color=zeroArray(newArray,channels),this.valpha="number"==typeof object[channels]?object[channels]:1}else if("number"==typeof object)this.model="rgb",this.color=[object>>16&255,object>>8&255,255&object],this.valpha=1;else{this.valpha=1;const keys=Object.keys(object);"alpha"in object&&(keys.splice(keys.indexOf("alpha"),1),this.valpha="number"==typeof object.alpha?object.alpha:0);const hashedKeys=keys.sort().join("");if(!(hashedKeys in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(object));this.model=hashedModelKeys[hashedKeys];const{labels}=convert[this.model],color=[];for(i=0;i<labels.length;i++)color.push(object[labels[i]]);this.color=zeroArray(color)}if(limiters[this.model])for(channels=convert[this.model].channels,i=0;i<channels;i++){const limit=limiters[this.model][i];limit&&(this.color[i]=limit(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Color.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(places){let self=this.model in colorString.to?this:this.rgb();self=self.round("number"==typeof places?places:1);const args=1===self.valpha?self.color:[...self.color,this.valpha];return colorString.to[self.model](args)},percentString(places){const self=this.rgb().round("number"==typeof places?places:1),args=1===self.valpha?self.color:[...self.color,this.valpha];return colorString.to.rgb.percent(args)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const result={},{channels}=convert[this.model],{labels}=convert[this.model];for(let i=0;i<channels;i++)result[labels[i]]=this.color[i];return 1!==this.valpha&&(result.alpha=this.valpha),result},unitArray(){const rgb=this.rgb().color;return rgb[0]/=255,rgb[1]/=255,rgb[2]/=255,1!==this.valpha&&rgb.push(this.valpha),rgb},unitObject(){const rgb=this.rgb().object();return rgb.r/=255,rgb.g/=255,rgb.b/=255,1!==this.valpha&&(rgb.alpha=this.valpha),rgb},round(places){return places=Math.max(places||0,0),new Color([...this.color.map(roundToPlace(places)),this.valpha],this.model)},alpha(value){return void 0!==value?new Color([...this.color,Math.max(0,Math.min(1,value))],this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,(value=>(value%360+360)%360)),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(95.047)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(108.833)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword(value){return void 0!==value?new Color(value):convert[this.model].keyword(this.color)},hex(value){return void 0!==value?new Color(value):colorString.to.hex(this.rgb().round().color)},hexa(value){if(void 0!==value)return new Color(value);const rgbArray=this.rgb().round().color;let alphaHex=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===alphaHex.length&&(alphaHex="0"+alphaHex),colorString.to.hex(rgbArray)+alphaHex},rgbNumber(){const rgb=this.rgb().color;return(255&rgb[0])<<16|(255&rgb[1])<<8|255&rgb[2]},luminosity(){const rgb=this.rgb().color,lum=[];for(const[i,element]of rgb.entries()){const chan=element/255;lum[i]=chan<=.04045?chan/12.92:((chan+.055)/1.055)**2.4}return.2126*lum[0]+.7152*lum[1]+.0722*lum[2]},contrast(color2){const lum1=this.luminosity(),lum2=color2.luminosity();return lum1>lum2?(lum1+.05)/(lum2+.05):(lum2+.05)/(lum1+.05)},level(color2){const contrastRatio=this.contrast(color2);return contrastRatio>=7?"AAA":contrastRatio>=4.5?"AA":""},isDark(){const rgb=this.rgb().color;return(2126*rgb[0]+7152*rgb[1]+722*rgb[2])/1e4<128},isLight(){return!this.isDark()},negate(){const rgb=this.rgb();for(let i=0;i<3;i++)rgb.color[i]=255-rgb.color[i];return rgb},lighten(ratio){const hsl=this.hsl();return hsl.color[2]+=hsl.color[2]*ratio,hsl},darken(ratio){const hsl=this.hsl();return hsl.color[2]-=hsl.color[2]*ratio,hsl},saturate(ratio){const hsl=this.hsl();return hsl.color[1]+=hsl.color[1]*ratio,hsl},desaturate(ratio){const hsl=this.hsl();return hsl.color[1]-=hsl.color[1]*ratio,hsl},whiten(ratio){const hwb=this.hwb();return hwb.color[1]+=hwb.color[1]*ratio,hwb},blacken(ratio){const hwb=this.hwb();return hwb.color[2]+=hwb.color[2]*ratio,hwb},grayscale(){const rgb=this.rgb().color,value=.3*rgb[0]+.59*rgb[1]+.11*rgb[2];return Color.rgb(value,value,value)},fade(ratio){return this.alpha(this.valpha-this.valpha*ratio)},opaquer(ratio){return this.alpha(this.valpha+this.valpha*ratio)},rotate(degrees){const hsl=this.hsl();let hue=hsl.color[0];return hue=(hue+degrees)%360,hue=hue<0?360+hue:hue,hsl.color[0]=hue,hsl},mix(mixinColor,weight){if(!mixinColor||!mixinColor.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mixinColor);const color1=mixinColor.rgb(),color2=this.rgb(),p=void 0===weight?.5:weight,w=2*p-1,a=color1.alpha()-color2.alpha(),w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1;return Color.rgb(w1*color1.red()+w2*color2.red(),w1*color1.green()+w2*color2.green(),w1*color1.blue()+w2*color2.blue(),color1.alpha()*p+color2.alpha()*(1-p))}};for(const model of Object.keys(convert)){if(skippedModels.includes(model))continue;const{channels}=convert[model];Color.prototype[model]=function(...args){return this.model===model?new Color(this):args.length>0?new Color(args,model):new Color([...(value=convert[this.model][model].raw(this.color),Array.isArray(value)?value:[value]),this.valpha],model);var value},Color[model]=function(...args){let color=args[0];return"number"==typeof color&&(color=zeroArray(args,channels)),new Color(color,model)}}function roundToPlace(places){return function(number){return function roundTo(number,places){return Number(number.toFixed(places))}(number,places)}}function getset(model,channel,modifier){model=Array.isArray(model)?model:[model];for(const m of model)(limiters[m]||(limiters[m]=[]))[channel]=modifier;return model=model[0],function(value){let result;return void 0!==value?(modifier&&(value=modifier(value)),result=this[model](),result.color[channel]=value,result):(result=this[model]().color[channel],modifier&&(result=modifier(result)),result)}}function maxfn(max){return function(v){return Math.max(0,Math.min(max,v))}}function zeroArray(array,length){for(let i=0;i<length;i++)"number"!=typeof array[i]&&(array[i]=0);return array}module.exports=Color},"./node_modules/earcut/src/earcut.js":module=>{"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)outerNode=eliminateHole(queue[i],outerNode);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function indexCurve(start,minX,minY,invSize){var p=start;do{0===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p=c.next;p!==a;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim|0),triangles.push(p.i/dim|0),triangles.push(b.i/dim|0),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize,0),void earcutLinked(c,triangles,dim,minX,minY,invSize,0)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next,x===hx))return m}p=p.next}while(p!==outerNode);if(!m)return null;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m;do{hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan)),p=p.next}while(p!==stop);return m}(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-minX)*invSize|0)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-minY)*invSize|0)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2)),o2=sign(area(p1,q1,q2)),o3=sign(area(p2,q2,p1)),o4=sign(area(p2,q2,q1));return o1!==o2&&o3!==o4||(!(0!==o1||!onSegment(p1,p2,q1))||(!(0!==o2||!onSegment(p1,q2,q1))||(!(0!==o3||!onSegment(p2,p1,q2))||!(0!==o4||!onSegment(p2,q1,q2)))))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}},"./node_modules/insert-css/index.js":module=>{var containers=[],styleElements=[];function insertCss(css,options){if(options=options||{},void 0===css)throw new Error("insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).");var styleElement,position=!0===options.prepend?"prepend":"append",container=void 0!==options.container?options.container:document.querySelector("head"),containerId=containers.indexOf(container);return-1===containerId&&(containerId=containers.push(container)-1,styleElements[containerId]={}),void 0!==styleElements[containerId]&&void 0!==styleElements[containerId][position]?styleElement=styleElements[containerId][position]:(styleElement=styleElements[containerId][position]=function createStyleElement(){var styleElement=document.createElement("style");return styleElement.setAttribute("type","text/css"),styleElement}(),"prepend"===position?container.insertBefore(styleElement,container.childNodes[0]):container.appendChild(styleElement)),65279===css.charCodeAt(0)&&(css=css.substr(1,css.length)),styleElement.styleSheet?styleElement.styleSheet.cssText+=css:styleElement.textContent+=css,styleElement}module.exports=insertCss,module.exports.insertCss=insertCss},"./node_modules/memoize-one/dist/memoize-one.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>memoizeOne});var safeIsNaN=Number.isNaN||function ponyfill(value){return"number"==typeof value&&value!=value};function areInputsEqual(newInputs,lastInputs){if(newInputs.length!==lastInputs.length)return!1;for(var i=0;i<newInputs.length;i++)if(first=newInputs[i],second=lastInputs[i],!(first===second||safeIsNaN(first)&&safeIsNaN(second)))return!1;var first,second;return!0}function memoizeOne(resultFn,isEqual){void 0===isEqual&&(isEqual=areInputsEqual);var cache=null;function memoized(){for(var newArgs=[],_i=0;_i<arguments.length;_i++)newArgs[_i]=arguments[_i];if(cache&&cache.lastThis===this&&isEqual(newArgs,cache.lastArgs))return cache.lastResult;var lastResult=resultFn.apply(this,newArgs);return cache={lastResult,lastArgs:newArgs,lastThis:this},lastResult}return memoized.clear=function clear(){cache=null},memoized}},"./node_modules/simple-swizzle/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isArrayish=__webpack_require__("./node_modules/simple-swizzle/node_modules/is-arrayish/index.js"),concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle=module.exports=function swizzle(args){for(var results=[],i=0,len=args.length;i<len;i++){var arg=args[i];isArrayish(arg)?results=concat.call(results,slice.call(arg)):results.push(arg)}return results};swizzle.wrap=function(fn){return function(){return fn(swizzle(arguments))}}},"./node_modules/simple-swizzle/node_modules/is-arrayish/index.js":module=>{module.exports=function isArrayish(obj){return!(!obj||"string"==typeof obj)&&(obj instanceof Array||Array.isArray(obj)||obj.length>=0&&(obj.splice instanceof Function||Object.getOwnPropertyDescriptor(obj,obj.length-1)&&"String"!==obj.constructor.name))}},"./node_modules/tslib/tslib.es6.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C6:()=>__extends,Cl:()=>__assign,Ju:()=>__values,Tt:()=>__rest,YH:()=>__generator,aN:()=>__spreadArrays,fX:()=>__spreadArray,gn:()=>__classPrivateFieldGet,sH:()=>__awaiter,zs:()=>__read});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}Object.create;function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}Object.create;function __classPrivateFieldGet(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)}"function"==typeof SuppressedError&&SuppressedError}}]);