"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[3078],{"./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>f,b:()=>v});var _views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js"),_views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js"),_views_3d_webgl_engine_lib_TransparencyPassType_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TransparencyPassType.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js");function v(v){const f=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_8__.kG,{vertex:u,fragment:m}=f;return(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_5__.Sv)(u,v),f.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_2__.w,v),f.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_11__.T.POSITION,"vec3"),f.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_11__.T.UV0,"vec2"),f.varyings.add("vpos","vec3"),v.hasMultipassTerrain&&f.varyings.add("depth","float"),u.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H`
    void main(void) {
      vpos = position;
      ${v.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),f.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_1__.f5,v),f.include(_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_3__.l,v),m.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_9__.A("tex",(e=>e.texture)),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_6__.p("opacity",(e=>e.opacity))),f.varyings.add("vTexCoord","vec2"),v.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_0__.H.Alpha?m.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H`
    void main() {
      discardBySlice(vpos);
      ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture(tex, vTexCoord).a * opacity;
      if (alpha  < ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H.float(_views_3d_webgl_engine_core_shaderLibrary_util_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_12__.F)}) {
        discard;
      }

      fragColor = vec4(alpha);
    }
    `):(m.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_4__.Y),m.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H`
    void main() {
      discardBySlice(vpos);
      ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H.float(_views_3d_webgl_engine_core_shaderLibrary_util_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_12__.F)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${v.transparencyPassType===_views_3d_webgl_engine_lib_TransparencyPassType_js__WEBPACK_IMPORTED_MODULE_10__.A.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    }
    `)),f}const f=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/LaserlinePath.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{L:()=>w,b:()=>v});var _mat4_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),_mat4f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_vec2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),_vec2f64_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),_views_3d_webgl_engine_core_shaderLibrary_Laserline_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_Matrix4PassUniform_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js");function v(i){const r=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_9__.kG;r.include(_views_3d_webgl_engine_core_shaderLibrary_Laserline_glsl_js__WEBPACK_IMPORTED_MODULE_4__.j,i);const{vertex:v,fragment:w}=r;return v.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Matrix4PassUniform_js__WEBPACK_IMPORTED_MODULE_8__.g("modelView",((i,o)=>(0,_mat4_js__WEBPACK_IMPORTED_MODULE_0__.w)(m,o.camera.viewMatrix,i.origin))),new _views_3d_webgl_engine_core_shaderModules_Matrix4PassUniform_js__WEBPACK_IMPORTED_MODULE_8__.g("proj",((e,i)=>i.camera.projectionMatrix)),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_6__.p("glowWidth",((e,i)=>e.glowWidth*i.camera.pixelRatio)),new _views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_5__.A("pixelToNDC",((e,i)=>(0,_vec2_js__WEBPACK_IMPORTED_MODULE_2__.s)(p,2/i.camera.fullViewport[2],2/i.camera.fullViewport[3])))),r.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_10__.T.START,"vec3"),r.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_10__.T.END,"vec3"),r.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_10__.T.UP,"vec3"),r.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_10__.T.EXTRUDE,"vec2"),r.varyings.add("uv","vec2"),r.varyings.add("vViewStart","vec3"),r.varyings.add("vViewEnd","vec3"),r.varyings.add("vViewPlane","vec4"),v.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),w.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_6__.p("perScreenPixelRatio",((e,i)=>i.camera.perScreenPixelRatio))),w.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_7__.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),r}const p=(0,_vec2f64_js__WEBPACK_IMPORTED_MODULE_3__.a)(),m=(0,_mat4f64_js__WEBPACK_IMPORTED_MODULE_1__.c)(),w=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/Laserlines.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{L:()=>_,b:()=>A,d:()=>C});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_vec2_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),_vec2f64_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),_vec3_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_vec4_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),_vec4f64_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),_geometry_support_lineSegment_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/lineSegment.js"),_geometry_support_plane_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/plane.js"),_sphere_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/sphere.js"),_views_3d_webgl_engine_core_shaderLibrary_Laserline_glsl_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_ScreenSpacePass_glsl_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js");const C=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Vl)(6);function A(e){const i=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_17__.kG;i.include(_views_3d_webgl_engine_core_shaderLibrary_ScreenSpacePass_glsl_js__WEBPACK_IMPORTED_MODULE_11__.k),i.include(_views_3d_webgl_engine_core_shaderLibrary_Laserline_glsl_js__WEBPACK_IMPORTED_MODULE_10__.j,e);const t=i.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.p("maxPixelDistance",((i,t)=>e.heightManifoldEnabled?2*t.camera.computeScreenPixelSizeAt(i.heightManifoldTarget):2*t.camera.computeScreenPixelSizeAt(i.lineVerticalPlaneSegment.origin)))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,i,t)=>(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(e,i.heightManifoldTarget,t.camera.viewMatrix),i=(e,i)=>(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(e,[0,0,0],i.camera.viewMatrix);t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_14__.N("heightManifoldOrigin",((t,r)=>(e(T,t,r),i(U,r),(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.b)(U,U,T),(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.n)(R,U),R[3]=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.l)(U),R))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("globalOrigin",((e,t)=>i(T,t))),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.p("cosSphericalAngleThreshold",((e,i)=>1-Math.max(2,(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.i)(i.camera.eye,e.heightManifoldTarget)*i.camera.perRenderPixelRatio)/(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.l)(e.heightManifoldTarget)))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.p("maxPixelDistance",((e,i)=>2*i.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.p("perScreenPixelRatio",((e,i)=>i.camera.perScreenPixelRatio))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled){t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_12__.A("angleCutoff",(e=>V(e))),new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_14__.N("heightPlane",((e,i)=>z(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,T),i.camera.viewMatrix))));const i=e.spherical?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`normalize(globalOrigin - pos)`:_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`heightPlane.xyz`;t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${i})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return e.pointDistanceEnabled&&(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_12__.A("angleCutoff",(e=>V(e))),new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_14__.N("pointDistanceSphere",((e,i)=>function j(e,i){return(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(H,e.pointDistanceOrigin,i.camera.viewMatrix),H[3]=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.i)(e.pointDistanceOrigin,e.pointDistanceTarget),H}(e,i)))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_12__.A("angleCutoff",(e=>V(e))),new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_14__.N("lineVerticalPlane",((e,i)=>function y(e,i){const t=(0,_geometry_support_lineSegment_js__WEBPACK_IMPORTED_MODULE_7__.KU)(e.lineVerticalPlaneSegment,.5,T),n=e.renderCoordsHelper.worldUpAtPosition(t,G),o=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.n)(U,e.lineVerticalPlaneSegment.vector),r=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.f)(R,n,o);return(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.n)(r,r),z(e.lineVerticalPlaneSegment.origin,r,i.camera.viewMatrix)}(e,i))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("lineVerticalStart",((e,i)=>function O(e,i){const t=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.c)(T,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(t,0),(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(t,t,i.camera.viewMatrix)}(e,i))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("lineVerticalEnd",((e,i)=>function E(e,i){const t=(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.a)(T,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(t,0),(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(t,t,i.camera.viewMatrix)}(e,i)))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(t.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_12__.A("angleCutoff",(e=>V(e))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("intersectsLineStart",((e,i)=>(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(T,e.lineStartWorld,i.camera.viewMatrix))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("intersectsLineEnd",((e,i)=>(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(T,e.lineEndWorld,i.camera.viewMatrix))),new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_13__.J("intersectsLineDirection",((e,i)=>((0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.c)(R,e.intersectsLineSegment.vector),R[3]=0,(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.n)(T,(0,_vec4_js__WEBPACK_IMPORTED_MODULE_5__.t)(R,R,i.camera.viewMatrix))))),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_15__.p("intersectsLineRadius",(e=>e.intersectsLineRadius))),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),t.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_16__.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),i}function V(t){return(0,_vec2_js__WEBPACK_IMPORTED_MODULE_1__.s)(I,Math.cos(t.angleCutoff),Math.cos(Math.max(0,t.angleCutoff-(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Vl)(2))))}function z(e,i,t){return(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.m)(F,e,t),(0,_vec3_js__WEBPACK_IMPORTED_MODULE_3__.c)(R,i),R[3]=0,(0,_vec4_js__WEBPACK_IMPORTED_MODULE_5__.t)(R,R,t),(0,_geometry_support_plane_js__WEBPACK_IMPORTED_MODULE_8__.Yq)(F,R,W)}const I=(0,_vec2f64_js__WEBPACK_IMPORTED_MODULE_2__.a)(),T=(0,_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.c)(),R=(0,_vec4f64_js__WEBPACK_IMPORTED_MODULE_6__.c)(),G=(0,_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.c)(),U=(0,_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.c)(),F=(0,_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.c)(),W=(0,_geometry_support_plane_js__WEBPACK_IMPORTED_MODULE_8__.Ue)(),H=(0,_sphere_js__WEBPACK_IMPORTED_MODULE_9__.c)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:A,defaultAngleCutoff:C},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/ShadedColorMaterial.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>h,b:()=>p});var _vec4f64_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),_views_3d_webgl_engine_core_shaderLibrary_ScreenSizeScaling_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff.js"),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js"),_views_3d_webgl_engine_lib_TransparencyPassType_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TransparencyPassType.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js");function p(e){const p=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_11__.kG,b=e.hasMultipassTerrain&&(e.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__.H.Color||e.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__.H.Alpha);p.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_4__.w,e),p.include(_views_3d_webgl_engine_core_shaderLibrary_ScreenSizeScaling_glsl_js__WEBPACK_IMPORTED_MODULE_1__.A,e),p.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_3__.f5,e);const{vertex:h,fragment:C}=p;return C.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_6__.Y),(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_7__.Sv)(h,e),C.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_9__.N("uColor",(e=>e.color))),p.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_13__.T.POSITION,"vec3"),p.varyings.add("vWorldPosition","vec3"),b&&p.varyings.add("depth","float"),e.screenSizeEnabled&&p.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_13__.T.OFFSET,"vec3"),e.shadingEnabled&&((0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_7__._8)(h),p.attributes.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_13__.T.NORMAL,"vec3"),p.varyings.add("vViewNormal","vec3")),h.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&h.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),h.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`
    ${b?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),b&&p.include(_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_5__.l,e),C.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${b?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?(C.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_8__.J("shadingDirection",(e=>e.shadingDirection))),C.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_9__.N("shadedColor",(e=>w(e.shadingTint,e.color)))),C.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):C.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`vec4 finalColor = uColor;`),C.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`
      ${e.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__.H.ObjectAndLayerIdColor?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H.float(_views_3d_webgl_engine_core_shaderLibrary_util_AlphaCutoff_js__WEBPACK_IMPORTED_MODULE_14__.b)}) {
        discard;
      }
      ${e.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__.H.Alpha?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`fragColor = vec4(finalColor.a);`:""}

      ${e.output===_views_3d_webgl_engine_core_shaderLibrary_ShaderOutput_js__WEBPACK_IMPORTED_MODULE_2__.H.Color?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_10__.H`fragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===_views_3d_webgl_engine_lib_TransparencyPassType_js__WEBPACK_IMPORTED_MODULE_12__.A.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    }
    `),p}function w(e,o){const r=1-e[3],i=e[3]+o[3]*r;return 0===i?(b[3]=i,b):(b[0]=(e[0]*e[3]+o[0]*o[3]*r)/i,b[1]=(e[1]*e[3]+o[1]*o[3]*r)/i,b[2]=(e[2]*e[3]+o[2]*o[3]*r)/i,b[3]=o[3],b)}const b=(0,_vec4f64_js__WEBPACK_IMPORTED_MODULE_0__.c)(),h=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/SlicePlaneMaterial.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>g,b:()=>t});var _views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js"),_views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js"),_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js");function t(t){const g=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_4__.kG,{vertex:l,fragment:s,attributes:n,varyings:c}=g;return(0,_views_3d_webgl_engine_core_shaderLibrary_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_0__.Sv)(l,t),n.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_5__.T.POSITION,"vec3"),n.add(_views_3d_webgl_engine_lib_VertexAttribute_js__WEBPACK_IMPORTED_MODULE_5__.T.UV0,"vec2"),c.add("vUV","vec2"),l.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),s.uniforms.add(new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_1__.N("backgroundColor",(e=>e.backgroundColor)),new _views_3d_webgl_engine_core_shaderModules_Float4PassUniform_js__WEBPACK_IMPORTED_MODULE_1__.N("gridColor",(e=>e.gridColor)),new _views_3d_webgl_engine_core_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_2__.p("gridWidth",(e=>e.gridWidth))),s.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),g}const g=Object.freeze(Object.defineProperty({__proto__:null,build:t},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/chunks/vec4f32.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function n(){return new Float32Array(4)}function t(n){const t=new Float32Array(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function r(n,t,r,e){const a=new Float32Array(4);return a[0]=n,a[1]=t,a[2]=r,a[3]=e,a}function a(){return n()}function o(){return r(1,1,1,1)}function u(){return r(1,0,0,0)}function s(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function i(){return r(0,0,0,1)}__webpack_require__.d(__webpack_exports__,{c:()=>t,f:()=>r});const f=a(),l=o(),_=u(),y=s(),w=c(),N=i();Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_W:N,UNIT_X:_,UNIT_Y:y,UNIT_Z:w,ZEROS:f,clone:t,create:n,createView:function e(n,t){return new Float32Array(n,t,4)},fromValues:r,ones:o,unitW:i,unitX:u,unitY:s,unitZ:c,zeros:a},Symbol.toStringTag,{value:"Module"}))},"./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>g});var _multiOriginJSONSupportUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js"),_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),_uuid_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/uuid.js"),_metadata_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/metadata.js"),_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js"),_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/portal/support/resourceExtension.js"),_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/chunks/persistableUrlUtils.js");function g(t){const r=t?.origins??[void 0];return(e,o)=>{const s=function h(t,r,e){if("resource"===t?.type)return function v(o,s,n){const p=(0,_metadata_js__WEBPACK_IMPORTED_MODULE_2__.Oe)(s,n);return{type:String,read:(t,r,e)=>{const o=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.r)(t,r,e);return p.type===String?o:"function"==typeof p.type?new p.type({url:o}):void 0},write:{writer(s,i,u,c){if(!c||!c.resources)return"string"==typeof s?void(i[u]=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.t)(s,c)):void(i[u]=s.write({},c));const y=function x(t){return null==t?null:"string"==typeof t?t:t.url}(s),d=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.t)(y,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.M.NO),g=p.type!==String&&(!(0,_multiOriginJSONSupportUtils_js__WEBPACK_IMPORTED_MODULE_7__.l)(this)||c&&c.origin&&this.originIdOf(n)>(0,_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_3__.M9)(c.origin)),h={object:this,propertyName:n,value:s,targetUrl:d,dest:i,targetPropertyName:u,context:c,params:o};c&&c.portalItem&&d&&!(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.YP)(d)?g?function w(t){const{context:r,targetUrl:e,params:o,value:n,dest:i,targetPropertyName:a}=t;if(!r.portalItem)return;const p=r.portalItem.resourceFromPath(e),c=N(n,e,r),l=(0,_portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_5__.B)(c),m=(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ml)(p.path),f=o?.compress??!1;l===m?(r.resources&&I({...t,resource:p,content:c,compress:f,updates:r.resources.toUpdate}),i[a]=e):U(t)}(h):function j({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}(h):c&&c.portalItem&&(null==d||null!=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.i)(d)||(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.jc)(d)||g)?U(h):i[u]=d}}}}(t,r,e);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:r}=_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.a;return{read:t,write:r}}}}(t,e,o);for(const t of r){const r=(0,_property_js__WEBPACK_IMPORTED_MODULE_4__.CJ)(e,t,o);for(const t in s)r[t]=s[t]}}}function U(t){const{targetUrl:r,params:s,value:i,context:a,dest:p,targetPropertyName:c}=t;if(!a.portalItem)return;const l=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_6__.p)(r),m=l?.filename??(0,_uuid_js__WEBPACK_IMPORTED_MODULE_1__.D)(),f=s?.prefix??l?.prefix,d=N(i,r,a),g=(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.v_)(f,m),h=`${g}.${(0,_portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_5__.B)(d)}`,v=a.portalItem.resourceFromPath(h);(0,_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.jc)(r)&&a.resources&&a.resources.pendingOperations.push(async function P(t){const r=(await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/request.js"))).default,{data:e}=await r(t,{responseType:"blob"});return e}(r).then((t=>{v.path=`${g}.${(0,_portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_5__.B)(t)}`,p[c]=v.itemRelativeUrl})).catch((()=>{})));const U=s?.compress??!1;a.resources&&I({...t,resource:v,content:d,compress:U,updates:a.resources.toAdd}),p[c]=v.itemRelativeUrl}function I({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){e.push({resource:o,content:s,compress:n,finish:e=>{!function O(t,r,e){"string"==typeof t[r]?t[r]=e.url:t[r].url=e.url}(t,r,e)}})}function N(t,r,e){return"string"==typeof t?{url:r}:new Blob([JSON.stringify(t.toJSON(e))],{type:"application/json"})}},"./node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function i(i){return i&&"getAtOrigin"in i&&"originOf"in i}__webpack_require__.d(__webpack_exports__,{l:()=>i})},"./node_modules/@arcgis/core/geometry/support/MeshTransform.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>N});var v,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_chunks_quat_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js"),_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/quatf64.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/axisAngleDegrees.js");let b=v=class extends _core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_0__.wq{constructor(t){super(t),this.translation=(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.c)(),this.rotationAxis=(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.g)(_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.UP),this.rotationAngle=0,this.scale=(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.f)(1,1,1)}get rotation(){return(0,_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.uT)(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.a)((0,_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.ZZ)(t)),this.rotationAngle=(0,_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.EU)(t)}get localMatrix(){const t=(0,_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_7__.c)();return(0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_8__.s)(M,(0,_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.ZZ)(this.rotation),(0,_axisAngleDegrees_js__WEBPACK_IMPORTED_MODULE_12__.WH)(this.rotation)),(0,_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_6__.g)(t,M,this.translation,this.scale),t}get localMatrixInverse(){return(0,_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_6__.a)((0,_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_7__.c)(),this.localMatrix)}applyLocal(t,o){return(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_10__.m)(o,t,this.localMatrix)}applyLocalInverse(t,o){return(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_10__.m)(o,t,this.localMatrixInverse)}equals(t){return this===t||null!=t&&(0,_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_6__.h)(this.localMatrix,t.localMatrix)}clone(){const t={translation:(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.a)(this.translation),rotationAxis:(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.a)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_11__.a)(this.scale)};return new v(t)}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"translation",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAxis",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAngle",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],b.prototype,"rotation",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],b.prototype,"localMatrix",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],b.prototype,"localMatrixInverse",null),b=v=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.geometry.support.MeshTransform")],b);const M=(0,_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_9__.a)(),N=b},"./node_modules/@arcgis/core/geometry/support/axisAngleDegrees.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EU:()=>b,UP:()=>z,Ue:()=>h,WH:()=>w,ZZ:()=>x,qC:()=>g,qw:()=>l,uT:()=>U});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_chunks_quat_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js"),_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/quatf64.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js");function h(n=z){return[n[0],n[1],n[2],n[3]]}function U(n,r,t=h()){return(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_3__.c)(t,n),t[3]=r,t}function g(r,s,c=h()){return(0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_1__.s)(A,r,w(r)),(0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_1__.s)(B,s,w(s)),(0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_1__.m)(A,B,A),function y(n,r){return n[3]=r,n}(c,(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.BV)((0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_1__.g)(c,A)))}function l(n,r,t,u=h()){return U(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.d,n,D),U(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.e,r,E),U(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_4__.U,t,F),g(D,E,D),g(D,F,u),u}function x(n){return n}function b(n){return n[3]}function w(n){return(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.Vl)(n[3])}const z=[0,0,1,0],A=(0,_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_2__.a)(),B=(0,_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_2__.a)(),D=(h(),h()),E=h(),F=h()},"./node_modules/@arcgis/core/portal/support/resourceExtension.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>t});var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js");function t(i){return o[function p(i){return i instanceof Blob?i.type:function n(t){const p=(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ml)(t);return g[p]||a}(i.url)}(i)]||e}const o={},a="text/plain",e=o[a],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const c in g)o[g[c]]=c},"./node_modules/@arcgis/core/views/3d/interactive/editingTools.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DrawGraphicTool3D:()=>DrawGraphicTool3D_T,ExtentTransformTool:()=>ExtentTransformTool_It,GraphicMoveTool:()=>GraphicMoveTool_q,GraphicReshapeTool:()=>GraphicReshapeTool_g,GraphicTransformTool:()=>GraphicTransformTool_X});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),handleUtils=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),ensureType=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),elevationInfoUtils=__webpack_require__("./node_modules/@arcgis/core/support/elevationInfoUtils.js"),ElevationInfo=__webpack_require__("./node_modules/@arcgis/core/symbols/support/ElevationInfo.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),Accessor=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js")),analysisThemeUtils=__webpack_require__("./node_modules/@arcgis/core/core/analysisThemeUtils.js"),asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),quantityFormatUtils=__webpack_require__("./node_modules/@arcgis/core/core/quantityFormatUtils.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),coordsUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/coordsUtils.js"),messages=__webpack_require__("./node_modules/@arcgis/core/intl/messages.js"),getDefaultUnitForView=__webpack_require__("./node_modules/@arcgis/core/support/getDefaultUnitForView.js"),Color=__webpack_require__("./node_modules/@arcgis/core/Color.js");__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projection.js");let h_e=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),h_r=(t,o,n)=>{for(let l=0,i=o.length;l<i;l++){let i=o[l];Array.isArray(i)?h_r(t,i,n):null!=i&&!1!==i&&("string"==typeof i&&(i=h_e(i)),n.push(i))}};__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projector.js");const TextOverlayItem_l={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let TextOverlayItem_n=class extends Accessor.Z{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const t=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${t}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new Color.Z([0,0,0,.6]),this.textColor=new Color.Z([255,255,255]),this._textShadowSize=1}render(){return function h_t(e,t,o){if(Array.isArray(t))o=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||o&&("string"==typeof o||o.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let n,l;return o&&1===o.length&&"string"==typeof o[0]?n=o[0]:o&&(l=[],h_r(e,o,l),0===l.length&&(l=void 0)),{vnodeSelector:e,properties:t,children:l,text:""===n?void 0:n,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const o=this._padding,i=this._borderRadius,r=t.measureText(this.text).width,s=this.fontSize,l=TextOverlayItem_h[this.anchor];t.textAlign="center",t.textBaseline="middle";const n=r+2*o,a=s+2*o,x=this.x+l.x*n,p=this.y+l.y*a;this._roundedRect(t,x,p,n,a,i),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();const d=this.x+(l.x+.5)*n,c=this.y+(l.y+.5)*a;this._renderTextShadow(t,this.text,d,c),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,d,c)}_renderTextShadow(t,e,o,i){t.lineJoin="miter",t.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/TextOverlayItem_a.length})`;const r=this._textShadowSize;for(const[s,l]of TextOverlayItem_a)t.fillText(e,o+r*s,i+r*l)}_roundedRect(t,e,o,i,r,s){t.beginPath(),t.moveTo(e,o+s),t.arcTo(e,o,e+s,o,s),t.lineTo(e+i-s,o),t.arcTo(e+i,o,e+i,o+s,s),t.lineTo(e+i,o+r-s),t.arcTo(e+i,o+r,e+i-s,o+r,s),t.lineTo(e+s,o+r),t.arcTo(e,o+r,e,o+r-s,s),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};let e;for(e in TextOverlayItem_l)t[TextOverlayItem_l[e]]=this.anchor===e;return t}};(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"x",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"y",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"position",null),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"text",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"fontSize",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"anchor",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"visible",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"backgroundColor",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"textColor",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"_textShadowSize",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"_textShadowColor",null),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"_textShadow",null),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"_padding",null),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_n.prototype,"_borderRadius",null),TextOverlayItem_n=(0,tslib_es6._)([(0,subclass.j)("esri.views.overlay.TextOverlayItem")],TextOverlayItem_n);const TextOverlayItem_h={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},TextOverlayItem_a=[];{const t=16;for(let e=0;e<360;e+=360/t)TextOverlayItem_a.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}const TextOverlayItem_x=TextOverlayItem_n;var automaticLengthMeasurementUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/automaticLengthMeasurementUtils.js");const SegmentLabels_S={default:15,far:25};let SegmentLabels_w=class extends Accessor.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,asyncUtils.vr)((async e=>{const t=await(0,messages.ME)("esri/core/t9n/Units");(0,promiseUtils.k_)(e),this._messagesUnits=t}));this.addHandles([(0,reactiveUtils.YP)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,reactiveUtils.on)((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),(0,handleUtils.kB)((()=>e.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return SegmentLabels_S[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if(null==e)return void this._destroyUnusedLabels();const{components:t,geometry:s,coordinateHelper:o}=e.editGeometryOperations.data;if(!s)return void this._destroyUnusedLabels();const i=t.length;for(let r=0;r<i;++r){const n=[];if(t[r].iterateVertices((e=>{n.push(o.toXYZ(e.pos))})),0===r&&null!=this.stagedVertex&&n.push(o.toXYZ(this.stagedVertex)),n.length<2)continue;const a=n[0],l=n[n.length-1];"polygon"===s.type&&n.length>2&&!(0,vec3.F)(a,l)&&n.push(a);const p=1===i&&!(0,coordsUtils.bu)(n,!1,!1);let c=SegmentLabels_C,h=SegmentLabels_P;this.toScreenPointArray(e,a,c);for(let t=1;t<n.length;++t){const s=n[t-1],o=n[t];this.toScreenPointArray(e,o,h),this._addLabel(e,s,c,o,h,p),[c,h]=[h,c]}}this._destroyUnusedLabels()}_addLabel(e,t,s,o,i,r){const{label:n}=this._getOrCreateLabel(e);if(!this.visible||(0,vec2.k)(s,i)<3025)return void(n.visible=!1);const l=null!=e.graphicState?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,elevationInfoUtils.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:p}=e.editGeometryOperations.data,c=(0,automaticLengthMeasurementUtils.MU)(t,o,p,l),h=this._messagesUnits,d=(0,getDefaultUnitForView.R)(e.view);n.text=null!=h&&null!=c?(0,quantityFormatUtils.N9)(h,c,d):"",n.visible=!0;const x=i[0]-s[0],y=i[1]-s[1];r?(0,vec2.s)(SegmentLabels_V,-y,x):(0,vec2.s)(SegmentLabels_V,y,-x),(0,vec2.e)(SegmentLabels_V,SegmentLabels_V),(0,vec2.a)(SegmentLabels_V,SegmentLabels_V,this._edgeDistancePixels),(0,vec2.l)(SegmentLabels_k,s,i,.5),(0,vec2.i)(SegmentLabels_k,SegmentLabels_k,SegmentLabels_V),n.position=[SegmentLabels_k[0],SegmentLabels_k[1]],Math.abs(SegmentLabels_V[0])>Math.abs(SegmentLabels_V[1])?n.anchor=SegmentLabels_V[0]>0?"left":"right":n.anchor=-SegmentLabels_V[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new TextOverlayItem_x({anchor:"center",fontSize:10,textColor:(0,analysisThemeUtils.uu)(),backgroundColor:(0,analysisThemeUtils.hU)(.6)});e.view.overlay?.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}};(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"context",void 0),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"stagedVertex",void 0),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"visible",void 0),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"edgeDistance",void 0),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"_messagesUnits",void 0),(0,tslib_es6._)([(0,property.Cb)()],SegmentLabels_w.prototype,"_edgeDistancePixels",null),SegmentLabels_w=(0,tslib_es6._)([(0,subclass.j)("esri.views.interactive")],SegmentLabels_w);const SegmentLabels_V=(0,vec2f64.a)(),SegmentLabels_k=(0,vec2f64.a)(),SegmentLabels_C=(0,screenUtils.s1)(),SegmentLabels_P=(0,screenUtils.s1)();var viewUtils=__webpack_require__("./node_modules/@arcgis/core/views/interactive/support/viewUtils.js");let SegmentLabels3D_a=class extends SegmentLabels_w{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:o},s,a=(0,screenUtils.s1)()){const{spatialReference:m}=o.data.coordinateHelper;return(0,viewUtils.RS)(s,m,t,e,SegmentLabels3D_c),e.state.camera.projectToScreen(SegmentLabels3D_c,a),a}};SegmentLabels3D_a=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.SegmentLabels3D")],SegmentLabels3D_a);const SegmentLabels3D_c=(0,vec3f64.c)();var geometry_projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),vec4=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),vec4f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f32.js"),clipRay=__webpack_require__("./node_modules/@arcgis/core/geometry/support/clipRay.js"),frustum=__webpack_require__("./node_modules/@arcgis/core/geometry/support/frustum.js"),lineSegment=__webpack_require__("./node_modules/@arcgis/core/geometry/support/lineSegment.js"),ray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/ray.js"),Identifiable=__webpack_require__("./node_modules/@arcgis/core/core/Identifiable.js"),interfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/interfaces.js"),ModelDirtyTypes=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/ModelDirtyTypes.js"),UpdatePolicy=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/UpdatePolicy.js");class DrapedVisualElementResources_a{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=interfaces.eZ.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const r=this._resources?.layerView;r&&(r.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),r=new DrapedVisualElementResources_d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),s=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new DrapedVisualElementResources_d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(r)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources&&null!=this._resources.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ModelDirtyTypes.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources&&null!=this._resources.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ModelDirtyTypes.T.UPDATE),this._resources.geometriesAdded=!0))}}let DrapedVisualElementResources_d=class extends((0,Identifiable.IG)(Accessor.Z)){constructor(e){super(e),this.drapeSourceType=interfaces.Lw.Features,this.updatePolicy=UpdatePolicy.j.SYNC,this.renderGroup=interfaces.eZ.Outline}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],DrapedVisualElementResources_d.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],DrapedVisualElementResources_d.prototype,"drapeSourceType",void 0),(0,tslib_es6._)([(0,property.Cb)()],DrapedVisualElementResources_d.prototype,"renderGroup",void 0),DrapedVisualElementResources_d=(0,tslib_es6._)([(0,subclass.j)("DrapedVisualElementLayerView")],DrapedVisualElementResources_d);class VisualElement_t{constructor(t){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this._handle=(0,reactiveUtils.YP)((()=>this.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const s in e)s in this?"attached"===s?t=e[s]:this[s]=e[s]:console.error("Cannot set unknown property",s);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var ContentObjectType=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/ContentObjectType.js"),Object3D=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3D.js"),Texture=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js"),WebGLLayer=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/WebGLLayer.js");class VisualElementResources_a{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const s=this._resources.object;this._resources.external.forEach((s=>{s.type!==ContentObjectType.U.Mesh&&s.type!==ContentObjectType.U.Line&&s.type!==ContentObjectType.U.Point||e.remove(s)})),s.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,s,this._resources.layer),this._resources.external.forEach((s=>{s.type!==ContentObjectType.U.Mesh&&s.type!==ContentObjectType.U.Line&&s.type!==ContentObjectType.U.Point||e.add(s)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const r=this._resourceFactory,a=r.view,h=a._stage;if(!h)return;const u=new WebGLLayer.F(h,{pickable:!1,updatePolicy:UpdatePolicy.j.SYNC}),l=new Object3D.T({castShadow:!1}),n=r.createResources(l,u);n.forEach((e=>{h.add(e),e instanceof Texture.x&&h.loadImmediate(e)})),h.add(l),u.add(l);const _=r.cameraChanged,y=_?(0,reactiveUtils.YP)((()=>a.state.camera),(e=>_(e)),reactiveUtils.nn):null;this._resources={layer:u,object:l,external:n,cameraHandle:y},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((s=>e.remove(s)))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class EngineVisualElement_t extends VisualElement_t{constructor({view:s,isDraped:t}){super(s),this._isDraped=!1,this.object3dResources=new VisualElementResources_a(this.createObject3DResourceFactory(s)),this.drapedResources=new DrapedVisualElementResources_a(this.createDrapedResourceFactory(s)),this.isDraped=t??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var ViewingMode=__webpack_require__("./node_modules/@arcgis/core/views/ViewingMode.js"),DoubleArray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/DoubleArray.js"),glUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/buffer/glUtil.js"),InterleavedLayout=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/buffer/InterleavedLayout.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexArrayObject.js"),VertexAttribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/VertexAttribute.js"),ReloadableShaderModule=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule.js"),ShaderTechnique=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique.js"),Program=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Program.js"),LaserlinePath_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/LaserlinePath.glsl.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),renderState=__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js");class LaserlinePathTechnique_m extends ShaderTechnique.A{initializeProgram(e){return new Program.$(e.rctx,LaserlinePathTechnique_m.shader.get().build(this.configuration),LaserlinePathTechnique_h)}initializePipeline(){return(0,renderState.sm)({blending:(0,renderState.if)(enums.zi.ONE,enums.zi.ONE_MINUS_SRC_ALPHA),colorWrite:renderState.BK})}}LaserlinePathTechnique_m.shader=new ReloadableShaderModule.J(LaserlinePath_glsl.L,(()=>__webpack_require__.e(5277).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LaserlinePath.glsl.js"))));const LaserlinePathTechnique_h=new Map([[VertexAttribute.T.START,0],[VertexAttribute.T.END,1],[VertexAttribute.T.UP,2],[VertexAttribute.T.EXTRUDE,3]]);var BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js");class LaserlinePathData_c{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,vec3f64.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,DoubleArray.bg)(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}set buffers(t){if(this._buffers=t,this._buffers.length>0){const t=this._buffers[0],r=3*Math.floor(t.length/3/2);(0,vec3.s)(this._origin,t[r],t[r+1],t[r+2])}else(0,vec3.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(enums.MX.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const r=this._createDataBuffer(t);return this._dirty=!1,new VertexArrayObject.U(e,LaserlinePathTechnique_h,{data:(0,glUtil.K)(LaserlinePathData_b)},{data:BufferObject.f.createVertex(e,enums.l1.STATIC_DRAW,r)})}_ensureVertexData(e,t){if(!this._dirty)return;const r=this._createDataBuffer(t);e.vertexBuffers.data?.setData(r),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(r){const s=r.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=s;const i=LaserlinePathData_b.createBuffer(s),o=this._origin;let n=0,u=0;for(const f of r){for(let r=0;r<f.length;r+=3){const s=(0,vec3.s)(LaserlinePathData_d,f[r],f[r+1],f[r+2]);0===r?u=this._renderCoordsHelper.getAltitude(s):this._renderCoordsHelper.setAltitude(s,u);const a=this._renderCoordsHelper.worldUpAtPosition(s,LaserlinePathData_),l=n+2*r,h=(0,vec3.b)(LaserlinePathData_d,s,o);if(r<f.length-3){i.up.setVec(l,a),i.up.setVec(l+3,a),i.up.setVec(l+5,a);for(let e=0;e<6;e++)i.start.setVec(l+e,h);i.extrude.setValues(l,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(r>0){i.up.setVec(l-2,a),i.up.setVec(l-4,a),i.up.setVec(l-5,a);for(let e=-6;e<0;e++)i.end.setVec(l+e,h)}}n+=this._numberOfRenderVertices(f)}return i.buffer}}const LaserlinePathData_=(0,vec3f64.c)(),LaserlinePathData_d=(0,vec3f64.c)(),LaserlinePathData_b=(0,InterleavedLayout.U$)().vec3f(VertexAttribute.T.START).vec3f(VertexAttribute.T.END).vec3f(VertexAttribute.T.UP).vec2f(VertexAttribute.T.EXTRUDE);var glUtil3D=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/glUtil3D.js"),RenderSlot=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderSlot.js"),MaterialUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/MaterialUtil.js"),ShaderTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration.js");class LaserlinePathTechniqueConfiguration_e extends ShaderTechniqueConfiguration.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlinePathTechniqueConfiguration_e.prototype,"contrastControlEnabled",void 0);var mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),shaderModules_interfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),DefaultVertexAttributeLocations=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations.js"),Laserlines_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/Laserlines.glsl.js");class LaserlineTechnique_f extends shaderModules_interfaces.K{constructor(){super(...arguments),this.innerColor=(0,vec3f64.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,vec3f64.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,mathUtils.Vl)(6),this.pointDistanceOrigin=(0,vec3f64.c)(),this.pointDistanceTarget=(0,vec3f64.c)(),this.lineVerticalPlaneSegment=(0,lineSegment.Ue)(),this.intersectsLineSegment=(0,lineSegment.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,vec3f64.c)(),this.lineStartWorld=(0,vec3f64.c)(),this.lineEndWorld=(0,vec3f64.c)()}}class LaserlineTechnique_p extends ShaderTechnique.A{initializeProgram(e){return new Program.$(e.rctx,LaserlineTechnique_p.shader.get().build(this.configuration),DefaultVertexAttributeLocations.i)}initializePipeline(){return(0,renderState.sm)({blending:(0,renderState.if)(enums.zi.ONE,enums.zi.ONE_MINUS_SRC_ALPHA),colorWrite:renderState.BK})}}LaserlineTechnique_p.shader=new ReloadableShaderModule.J(Laserlines_glsl.L,(()=>__webpack_require__.e(1070).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/Laserlines.glsl.js"))));class LaserlineTechniqueConfiguration_n extends LaserlinePathTechniqueConfiguration_e{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlineTechniqueConfiguration_n.prototype,"heightManifoldEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlineTechniqueConfiguration_n.prototype,"pointDistanceEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlineTechniqueConfiguration_n.prototype,"lineVerticalPlaneEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlineTechniqueConfiguration_n.prototype,"intersectsLineEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],LaserlineTechniqueConfiguration_n.prototype,"spherical",void 0);class LaserLineRenderer_V{constructor(e,t={contrastControlEnabled:!1}){this._config=t,this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=ViewingMode.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._passParameters=(0,MaterialUtil.Uf)(e,new LaserlineTechnique_f)}get renderSlots(){return[this._config.contrastControlEnabled?RenderSlot.r.LASERLINES_CONTRAST_CONTROL:RenderSlot.r.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,vec3.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,vec3.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,vec3.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,lineSegment.JG)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,lineSegment.JG)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new LaserlinePathData_c(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new LaserlinePathData_c(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,MaterialUtil.LO)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=(0,glUtil3D.ow)(t),this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new LaserlineTechniqueConfiguration_n;const i=new LaserlinePathTechniqueConfiguration_e;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(LaserlinePathTechnique_m,i)}uninitializeRenderContext(){this._quadVAO=(0,maybe.M2)(this._quadVAO),this._technique=(0,maybe.RY)(this._technique),this._pathVerticalPlaneData=(0,maybe.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,maybe.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===ViewingMode.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(LaserlineTechnique_p,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,this._passParameters,e.bindParameters),i.bindVAO(this._quadVAO),i.drawArrays(enums.MX.TRIANGLE_STRIP,0,4)}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,clipRay.iL)((0,ray.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),LaserLineRenderer_R),LaserLineRenderer_R.c0=-Number.MAX_VALUE,!(0,frustum.zq)(t.frustum,LaserLineRenderer_R))return;(0,clipRay.Ws)(LaserLineRenderer_R,this._passParameters.lineStartWorld),(0,clipRay.S$)(LaserLineRenderer_R,this._passParameters.lineEndWorld)}else(0,vec3.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,vec3.a)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}}const LaserLineRenderer_R=(0,clipRay.Ue)();class LaserlineVisualElement_c extends VisualElement_t{constructor(e){super(e.view),this._angleCutoff=Laserlines_glsl.d,this._style={},this._heightManifoldTarget=(0,vec3f64.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,lineSegment.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(t){null!=t?((0,vec3.c)(this._heightManifoldTarget,t),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,LaserlineVisualElement_);this.intersectsLine=(0,lineSegment.al)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,lineSegment.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,lineSegment.JG)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,vec3f64.a)(e.origin),target:e.target?(0,vec3f64.a)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new LaserLineRenderer_V({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const LaserlineVisualElement_=(0,vec3f64.c)();var OverlayRenderer=__webpack_require__("./node_modules/@arcgis/core/views/3d/terrain/OverlayRenderer.js"),GeometryUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GeometryUtil.js"),Material=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Material.js"),RenderGeometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderGeometry.js"),RibbonLineMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/RibbonLineMaterial.js");class ExtendedLineVisualElement_G extends EngineVisualElement_t{constructor(e){super(e),this._ray=(0,ray.Ue)(),this._isWorldDown=!1,this._start=(0,vec3f64.c)(),this._end=(0,vec3f64.f)(1,0,0),this._width=1,this._color=(0,vec4f32.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,vec4f32.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=ExtendedLineVisualElement_V.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Material.yD.OccludeAndTransparent,this._fadedExtensions=ExtendedLineVisualElement_T,this._laserline=new LaserlineVisualElement_c({view:this.view}),this.applyProps(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(r){this._isWorldDown=!0,(0,vec3.c)(this._start,r),this.view.renderCoordsHelper.worldUpAtPosition(r,this._end),(0,vec3.b)(this._end,r,this._end),(0,ray.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(t){this._isWorldDown=!1,(0,vec3.k)(this._start,t)||((0,vec3.c)(this._start,t),(0,ray.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(t){this._isWorldDown=!1,(0,vec3.k)(this._end,t)||((0,vec3.c)(this._end,t),(0,ray.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,vec4.g)(e,this._innerColor)||((0,vec4.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,vec4.g)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,vec4f32.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Material.yD.OccludeAndTransparentStencil?Material.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??ExtendedLineVisualElement_T,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new RibbonLineMaterial.U(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e)}}}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){const s=this._createGeometry(e);r.push(s),t.addGeometry(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new RibbonLineMaterial.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new RenderGeometry.z(t)}_createGeometry(e){const t=this.extensionType===ExtendedLineVisualElement_V.FADED,r=t?[(0,vec3f64.c)(),(0,vec3f64.c)(),(0,vec3f64.c)(),(0,vec3f64.c)()]:[(0,vec3f64.c)(),(0,vec3f64.c)()];return(0,GeometryUtil.rh)(e,r,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===ExtendedLineVisualElement_V.FADED?this._updateLineSegmentFinite(ExtendedLineVisualElement_S):this._updateLineSegmentInfinite(this._extensionType,ExtendedLineVisualElement_S)}_updateLineSegmentFinite(e){return(0,lineSegment.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const r=this.view.state.camera;switch((0,clipRay.iL)(this._ray,ExtendedLineVisualElement_x),e){case ExtendedLineVisualElement_V.LINE:ExtendedLineVisualElement_x.c0=-Number.MAX_VALUE;break;case ExtendedLineVisualElement_V.RAY:case ExtendedLineVisualElement_V.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,r=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&r<t&&(0,vec3.o)(ExtendedLineVisualElement_x.ray.direction,ExtendedLineVisualElement_x.ray.direction),this._extensionType===ExtendedLineVisualElement_V.GROUND_RAY&&null!=t&&(ExtendedLineVisualElement_x.c1=Math.abs(r-t));break}}if(!(0,frustum.zq)(r.frustum,ExtendedLineVisualElement_x))return this._updateLineSegmentFinite(t);const i=(0,clipRay.Ws)(ExtendedLineVisualElement_x,ExtendedLineVisualElement_P),n=(0,clipRay.S$)(ExtendedLineVisualElement_x,ExtendedLineVisualElement_v);return(0,lineSegment.zk)(i,n,t)}_updateVertexAttributesObject3D(e,t){const r=e.geometries[0].getMutableAttribute(VertexAttribute.T.POSITION)?.data;if(!r)return;let s=0;for(const i of this._lineVertices(t))r[s++]=i[0],r[s++]=i[1],r[s++]=i[2];e.geometryVertexAttrsUpdated(e.geometries[0])}_updateVertexAttributesDraped(e,t){const r=e.getMutableAttribute(VertexAttribute.T.POSITION)?.data;if(!r)return;let s=0;for(const i of this._lineVertices(t))r[s++]=i[0],r[s++]=i[1],r[s++]=OverlayRenderer.Rn;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===ExtendedLineVisualElement_V.FADED?(yield(0,lineSegment.KU)(e,-this.fadedExtensions.start,ExtendedLineVisualElement_P),yield(0,lineSegment.KU)(e,0,ExtendedLineVisualElement_P),yield(0,lineSegment.KU)(e,1,ExtendedLineVisualElement_P),yield(0,lineSegment.KU)(e,1+this.fadedExtensions.end,ExtendedLineVisualElement_P)):(yield(0,lineSegment.KU)(e,0,ExtendedLineVisualElement_P),yield(0,lineSegment.KU)(e,1,ExtendedLineVisualElement_P))}}const ExtendedLineVisualElement_x=(0,clipRay.Ue)(),ExtendedLineVisualElement_P=(0,vec3f64.c)(),ExtendedLineVisualElement_v=(0,vec3f64.c)(),ExtendedLineVisualElement_S=(0,lineSegment.Ue)();var ExtendedLineVisualElement_V;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(ExtendedLineVisualElement_V||(ExtendedLineVisualElement_V={}));const ExtendedLineVisualElement_T={start:.3333333333333333,end:.3333333333333333};var dehydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js");class ParallelLineVisualElement_x extends EngineVisualElement_t{constructor(e){super(e),this._location=(0,vec3f64.c)(),this._direction=(0,vec3f64.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,vec4f32.f)(1,0,1,1),this._renderOccluded=Material.yD.OccludeAndTransparent,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,vec3.k)(this._location,e)||((0,vec3.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,vec3.k)(this._direction,e)||((0,vec3.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,vec3.n)(this._direction,(0,vec3.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new RibbonLineMaterial.U(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0,e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){const[s,i]=this._createGeometries(e);t.addGeometry(s),t.addGeometry(i),r.push(s),r.push(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const t=new RibbonLineMaterial.U(this.materialParameters),r=(0,reactiveUtils.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:t,geometries:this._createDrapedGeometry(t),pixelRatioHandle:r}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new RenderGeometry.z(e)))}_createGeometries(e){return[(0,GeometryUtil.rh)(e,[(0,vec3f64.c)(),(0,vec3f64.c)()]),(0,GeometryUtil.rh)(e,[(0,vec3f64.c)(),(0,vec3f64.c)()])]}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,ParallelLineVisualElement_S),(0,vec3.a)(ParallelLineVisualElement_V,this.location,this.direction),t.projectToScreen(ParallelLineVisualElement_V,ParallelLineVisualElement_k),(0,vec2.e)(ParallelLineVisualElement_k,(0,vec2.c)(ParallelLineVisualElement_k,ParallelLineVisualElement_k,ParallelLineVisualElement_S)),this._updateVertexAttributesObject3D(t,e,0,ParallelLineVisualElement_S,ParallelLineVisualElement_k,1),this._updateVertexAttributesObject3D(t,e,1,ParallelLineVisualElement_S,ParallelLineVisualElement_k,-1)}_updateVertexAttributesObject3D(e,r,s,i,o,a){const c=r.geometries[s],n=c.getMutableAttribute(VertexAttribute.T.POSITION)?.data;if(!n)return;const{start:d,end:h}=this._computeStartEnd(o,i,a,this.offset,this.width,this.length);e.unprojectFromScreen((0,screenUtils.c$)(d),ParallelLineVisualElement_V),n[0]=ParallelLineVisualElement_V[0],n[1]=ParallelLineVisualElement_V[1],n[2]=ParallelLineVisualElement_V[2],e.unprojectFromScreen((0,screenUtils.c$)(h),ParallelLineVisualElement_V),n[3]=ParallelLineVisualElement_V[0],n[4]=ParallelLineVisualElement_V[1],n[5]=ParallelLineVisualElement_V[2],r.geometryVertexAttrsUpdated(c)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{location:s,width:i,length:o,offset:a}=this,c=E;c.spatialReference=t.renderer.spatialReference,c.x=s[0],c.y=s[1];const n=t.overlayPixelSizeInMapUnits(c)*r,d=i*n,h=o*n,m=a*n;this._updateVertexAttributesDraped(e[0],d,h,m,-1),this._updateVertexAttributesDraped(e[1],d,h,m,1)}_updateVertexAttributesDraped(e,t,r,s,i){const o=e.getMutableAttribute(VertexAttribute.T.POSITION)?.data;if(!o)return;const{location:a,direction:c}=this,{start:n,end:d}=this._computeStartEnd(c,a,i,s,t,r);o[0]=n[0],o[1]=n[1],o[2]=OverlayRenderer.Rn,o[3]=d[0],o[4]=d[1],o[5]=OverlayRenderer.Rn,e.invalidateBoundingInfo()}_computeStartEnd(e,t,r,s,i,n){const d=(0,vec2.a)(ParallelLineVisualElement_P,(0,vec2.s)(ParallelLineVisualElement_P,e[1]*r,e[0]*-r),s+i/2),h=(0,vec2.i)(ParallelLineVisualElement_A,(0,vec2.i)(ParallelLineVisualElement_A,(0,vec2.i)(ParallelLineVisualElement_A,t,(0,vec2.a)(ParallelLineVisualElement_A,e,n/2)),d),d);return{start:h,end:(0,vec2.i)(ParallelLineVisualElement_M,h,(0,vec2.a)(ParallelLineVisualElement_M,e,-n))}}}const ParallelLineVisualElement_V=(0,vec3f64.c)(),ParallelLineVisualElement_P=(0,vec2f64.a)(),ParallelLineVisualElement_A=(0,vec2f64.a)(),ParallelLineVisualElement_M=(0,vec2f64.a)(),ParallelLineVisualElement_S=(0,screenUtils.s1)(),ParallelLineVisualElement_k=(0,screenUtils.s1)(),E=(0,dehydratedFeatures.Tx)(0,0,void 0,null);var vec4f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),aaBoundingBox=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),vectorStacks=__webpack_require__("./node_modules/@arcgis/core/geometry/support/vectorStacks.js"),elevationAlignmentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignmentUtils.js"),ElevationContext=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/ElevationContext.js"),sdfPrimitives=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/engineContent/sdfPrimitives.js"),HUDMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/HUDMaterial.js");class PointVisualElement_y{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,vec4f64.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,vec4f64.f)(1,1,1,1),this._elevationInfo=null,this._resources=new VisualElementResources_a({view:e.view,createResources:e=>this._createResources(e),destroyResources:e=>this._destroyResources(e),recreateGeometry:(e,t)=>{e.geometry=this._recreateGeometry(t,e.material)}});let t=!0;for(const r in e)r in this?"attached"===r?t=e[r]??!1:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?null!=this._resources&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,null!=this._resources&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,vec4.g)(e,this._outlineColor)||((0,vec4.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;null!=e&&e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if(null==e||null==t)return;const r=e.geometry;if(null==r)return;const i=r.getMutableAttribute(VertexAttribute.T.SIZE).data,s=this._geometrySize;i[0]=s,i[1]=s,t.geometryVertexAttrsUpdated(t.geometries[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:PointVisualElement_S,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/PointVisualElement_v}_recreateGeometry(e,t){const r=this._createRenderGeometry(t);return null!=r&&e.addGeometry(r),r}_createResources(e){const t=(0,sdfPrimitives.cU)(this._primitive,this._preferredTextureSize),r=new HUDMaterial.A(this._materialParameters(t.id)),i=this._recreateGeometry(e,r);return{material:r,texture:t,geometry:i,forEach(e){e(t),e(r),null!=this.geometry&&e(this.geometry)}}}_destroyResources(e){e.geometry=null,e.material.dispose(),e.texture.dispose()}get _preferredTextureSize(){return(0,mathUtils.uZ)((0,mathUtils.Sf)(2*this._geometrySize),16,128)}calculateMapBounds(e){if(null==this._resources.resources||null==this._resources.resources.geometry)return!1;const t=this._resources.resources.geometry.vertexAttributes.get(VertexAttribute.T.POSITION);return(0,geometry_projection.projectVectorToVector)(t.data,this.view.renderCoordsHelper.spatialReference,PointVisualElement_b,this.view.spatialReference),(0,aaBoundingBox.G1)(e,PointVisualElement_b),!0}_createRenderGeometry(e){const t=this.geometry;if(null==t)return null;const{renderCoordsHelper:i,elevationProvider:s}=this.view,o=(0,elevationAlignmentUtils.w7)(t,s,ElevationContext.o.fromElevationInfo(this.elevationInfo),i),n=(0,vec3.s)(vectorStacks.WM.get(),t.x,t.y,o),a=vectorStacks.WM.get();(0,geometry_projection.projectVectorToVector)(n,t.spatialReference,a,i.spatialReference);const c=this._geometrySize;return(0,GeometryUtil.dV)(e,null,a,null,[c,c],[0,0,0,1])}}const PointVisualElement_v=sdfPrimitives.Ns,PointVisualElement_S=[PointVisualElement_v/2,PointVisualElement_v/2,1-PointVisualElement_v/2,1-PointVisualElement_v/2],PointVisualElement_b=(0,vec3f64.c)();var mat4=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),mat4f64=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),Attribute=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Attribute.js"),Geometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Geometry.js"),ColorMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ColorMaterial.js");class RightAngleQuadVisualElement_P extends EngineVisualElement_t{constructor(e){super(e),this._maxSize=0,this._position=(0,vec3f64.c)(),this._up=(0,vec3f64.c)(),this._right=(0,vec3f64.c)(),this._renderOccluded=Material.yD.OccludeAndTransparent,this._color=(0,vec4f64.f)(1,0,0,1),this._outlineColor=(0,vec4f64.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Material.yD.Opaque,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,vec4.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,vec4.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:r}){this._maxSize=Math.min((0,vec3.i)(t,e),(0,vec3.i)(t,r))/3,(0,vec3.n)(this._up,(0,vec3.b)(this._up,e,t)),(0,vec3.n)(this._right,(0,vec3.b)(this._right,r,t)),(0,vec3.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new ColorMaterial.E(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new RibbonLineMaterial.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r,forEach:e=>{e(t),r&&e(r)}}}_destroyObject3DResources(e){e.quadMaterial.dispose(),e.outlineMaterial?.dispose()}_createObject3DGeometries(e,t,r){if((0,vec3.k)(this._up,vec3f64.Z)&&(0,vec3.k)(this._right,vec3f64.Z))return;const i=this._createGeometries(t,r);for(const s of i)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const t=new ColorMaterial.E(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new RibbonLineMaterial.U(this._outlineMaterialParameters),i=this._createGeometries(t,r).map((e=>new RenderGeometry.z(e)));return this._setTransformDraped(i),{quadMaterial:t,outlineMaterial:r,geometries:i,pixelRatioHandle:(0,reactiveUtils.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.outlineMaterial?.dispose(),e.quadMaterial.dispose()}_createGeometries(e,t){const{up:r,right:i,corner:s}=this._getVertices(),a=this._quadGeometryData(r,i,s,e);return t?[a,(0,GeometryUtil.rh)(t,[r,s,i])]:[a]}_getVertices(){let e=this._up,t=this._right;const r=(0,vec3.a)(vectorStacks.WM.get(),e,t);return this.isDraped&&(e=(0,vec3.c)(vectorStacks.WM.get(),e),t=(0,vec3.c)(vectorStacks.WM.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const i=this.view.state.camera,s=this._size*i.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,s);(0,mat4.f)(RightAngleQuadVisualElement_v,this._position),(0,mat4.k)(RightAngleQuadVisualElement_v,RightAngleQuadVisualElement_v,[a,a,a]),e.transformation=RightAngleQuadVisualElement_v}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:s},state:{contentPixelRatio:a}}}=this,{_position:o,_size:n}=this,c=(0,vec3.c)(vectorStacks.WM.get(),o);c[2]=OverlayRenderer.Rn;const l=RightAngleQuadVisualElement_S;l.spatialReference=s.renderer.spatialReference,l.x=c[0],l.y=c[1];const d=n*(s.overlayPixelSizeInMapUnits(l)*a),h=Math.min(this._maxSize,d);(0,mat4.f)(RightAngleQuadVisualElement_v,c),(0,mat4.k)(RightAngleQuadVisualElement_v,RightAngleQuadVisualElement_v,[h,h,1]);for(const t of e)t.updateTransformation((e=>{(0,mat4.c)(e,RightAngleQuadVisualElement_v)}))}_quadGeometryData(e,t,r,i){return new Geometry.Z(i,[[VertexAttribute.T.POSITION,new Attribute.a([0,0,0,...t,...e,...r],3,!0)]],[[VertexAttribute.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const RightAngleQuadVisualElement_v=(0,mat4f64.c)(),RightAngleQuadVisualElement_S=(0,dehydratedFeatures.Tx)(0,0,void 0,null);var Settings=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/Settings.js"),SnappingDomain=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/SnappingDomain.js"),SnappingPoint=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/SnappingPoint.js"),snappingUtils=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/snappingUtils.js"),SnappingVisualizer=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/SnappingVisualizer.js"),LineSnappingHint=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/hints/LineSnappingHint.js");class SnappingVisualizer3D_O extends SnappingVisualizer.a{sortUniqueHints(e){return e.sort(((e,n)=>(n instanceof LineSnappingHint.w?n.length:0)-(e instanceof LineSnappingHint.w?e.length:0)))}visualizeIntersectionPoint(e,n){const{spatialReference:t,view:r}=n,o=SnappingVisualizer3D_R();return(0,handleUtils.ed)(new PointVisualElement_y({view:r,primitive:"circle",geometry:(0,SnappingPoint.SH)(e.intersectionPoint,t),elevationInfo:e.isDraped?elevationInfoUtils.tR:elevationInfoUtils.jG,size:20,outlineSize:2,color:o.intersectionPointColor,outlineColor:o.intersectionPointOutlineColor,pixelSnappingEnabled:!1}))}visualizePoint(e,n){const{view:t,spatialReference:r}=n,o=SnappingVisualizer3D_R(),l=SnappingVisualizer3D_A(e.point,e.domain,n);return(0,handleUtils.ed)(new PointVisualElement_y({view:t,primitive:"circle",geometry:(0,SnappingPoint.SH)(l,r),elevationInfo:SnappingVisualizer3D_H(e,n),size:20,outlineSize:2,color:o.pointColor,outlineColor:o.pointOutlineColor,pixelSnappingEnabled:!1}))}visualizeLine(e,n){const{view:t,spatialReference:r}=n,o=SnappingVisualizer3D_R(),l=SnappingVisualizer3D_A(e.lineStart,e.domain,n),a=SnappingVisualizer3D_A(e.lineEnd,e.domain,n);return(0,handleUtils.ed)(this._createLineSegmentHint(e.type,l,a,r,SnappingVisualizer3D_H(e,n),t,o,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,n){const{view:r,spatialReference:o}=n,l=SnappingVisualizer3D_R(),{isDraped:a}=e,s=SnappingVisualizer3D_H(e,n),p=SnappingVisualizer3D_A(e.lineStart,e.domain,n),d=SnappingVisualizer3D_A(e.lineEnd,e.domain,n),u=SnappingVisualizer3D_z(p,o,s,r,a),v=SnappingVisualizer3D_z(d,o,s,r,a),h=(0,vec3.h)(v,u,v,.5),E=new ParallelLineVisualElement_x({view:r,attached:!1,offset:Settings.c.parallelLineHintOffset,length:Settings.c.parallelLineHintLength,width:Settings.c.parallelLineHintWidth,color:l.parallelSignColor,location:h,renderOccluded:a?Material.yD.OccludeAndTransparent:Material.yD.Opaque,isDraped:a,renderGroup:interfaces.eZ.SnappingHint});return E.setDirectionFromPoints(u,h),E.attached=!0,(0,handleUtils.ed)(E)}visualizeRightAngleQuad(e,n){const{view:t,spatialReference:r}=n,o=SnappingVisualizer3D_R(),l=SnappingVisualizer3D_H(e,n),{isDraped:a}=e,s=SnappingVisualizer3D_A(e.previousVertex,e.domain,n),p=SnappingVisualizer3D_A(e.centerVertex,e.domain,n),c=SnappingVisualizer3D_A(e.nextVertex,e.domain,n),d=SnappingVisualizer3D_z(s,r,l,t,a),v=SnappingVisualizer3D_z(p,r,l,t,a),h=SnappingVisualizer3D_z(c,r,l,t,a);return(0,handleUtils.ed)(new RightAngleQuadVisualElement_P({view:t,attached:!0,color:a?o.rightAngleColorDraped:o.rightAngleColor,renderOccluded:a?Material.yD.OccludeAndTransparent:Material.yD.Transparent,outlineRenderOccluded:a?Material.yD.OccludeAndTransparent:Material.yD.Opaque,outlineColor:o.rightAngleOutlineColor,outlineSize:Settings.c.rightAngleHintOutlineSize,size:Settings.c.rightAngleHintSize,isDraped:a,geometry:{previous:d,center:v,next:h},renderGroup:interfaces.eZ.SnappingHint}))}_createLineSegmentHint(e,n,i,t,r,o,l,a=!1,c=!0,d=!0){const u=SnappingVisualizer3D_z(n,t,r,o,a),v=SnappingVisualizer3D_z(i,t,r,o,a),h=new ExtendedLineVisualElement_G({view:o,extensionType:ExtendedLineVisualElement_V.FADED,start:u,end:v,isDraped:a,color:l.lineColor,renderOccluded:a?Material.yD.OccludeAndTransparent:Material.yD.Opaque,renderGroup:interfaces.eZ.SnappingHint});switch(e){case snappingUtils.ze.TARGET:h.width=Settings.c.lineHintWidthTarget,h.fadedExtensions={start:0,end:Settings.c.lineHintFadedExtensions};break;case snappingUtils.ze.REFERENCE_EXTENSION:h.width=Settings.c.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case snappingUtils.ze.REFERENCE:h.width=Settings.c.lineHintWidthReference,h.fadedExtensions={start:c?Settings.c.lineHintFadedExtensions:0,end:d?Settings.c.lineHintFadedExtensions:0}}return h.attached=!0,h}}function SnappingVisualizer3D_R(i){const t=Color.Z.toUnitRGBA((0,analysisThemeUtils.e9)()),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:t,pointColor:r,pointOutlineColor:t,lineColor:t,lineOutlineColor:void 0,parallelSignColor:t,rightAngleColor:t,rightAngleColorDraped:Color.Z.toUnitRGBA((0,analysisThemeUtils.e9)(.5)),rightAngleOutlineColor:t}}function SnappingVisualizer3D_A(e,n,i){const t=SnappingVisualizer3D_x(n,i);return null==t?e:(0,SnappingPoint.$G)(e[0],e[1],t)}function SnappingVisualizer3D_H(e,n){return null!=SnappingVisualizer3D_x(e.domain,n)?n.selfSnappingZ.elevationInfo:e.isDraped?elevationInfoUtils.tR:elevationInfoUtils.jG}function SnappingVisualizer3D_x(e,{selfSnappingZ:n}){return e===SnappingDomain.B.SELF&&null!=n?n.value:null}function SnappingVisualizer3D_z(e,n,i,t,l,a=(0,vec3f64.c)()){if(l){const i=t.basemapTerrain.overlayManager.renderer.spatialReference;(0,geometry_projection.projectVectorToVector)(e,n,a,i)}else(0,viewUtils.RS)(e,n,i,t,a);return a}var sources_interfaces=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/sources/interfaces.js");function meshFastUpdateUtils_o(n){const{graphic:o}=n;return[(0,reactiveUtils.YP)((()=>n.displaying),(e=>{e?function meshFastUpdateUtils_s(e){const{geometry:t}=e;meshFastUpdateUtils_a(t)&&e.notifyMeshTransformChanged({action:sources_interfaces.u.EnableFastUpdates})}(o):meshFastUpdateUtils_i(o)}),{...reactiveUtils.tX}),(0,handleUtils.kB)((()=>meshFastUpdateUtils_i(o)))]}function meshFastUpdateUtils_i(e){const{geometry:t}=e;meshFastUpdateUtils_a(t)&&e.notifyMeshTransformChanged({action:sources_interfaces.u.DisableFastUpdates})}function meshFastUpdateUtils_a(e){return"mesh"===e?.type&&!e.vertexSpace.isGeoreferenced}function memoize_t(t){let r,e,i=[],u=!1;return function f(...f){return u&&r===this&&function memoize_n(t,n){if(t.length!==n.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==n[r])return!1;return!0}(f,i)||(e=t.apply(this,f),r=this,i=f,u=!0),e}}var lineStippleUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/lineStippleUtils.js"),colorUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/colorUtils.js");const settings_a=memoize_t((i=>({accent:(0,analysisThemeUtils.e9)(),contrast:(0,analysisThemeUtils.RN)(),selected:new Color.Z([255,255,255]),selectedOutline:new Color.Z([255,255,255]),staged:new Color.Z([12,207,255]),outline:new Color.Z([0,0,0,.5])})));function settings_p(e,t){t&&Object.assign(e,t)}class settings_u{constructor({theme:e,...t}){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=Material.yD.Opaque,this.color=settings_a(e).accent,settings_p(this,t)}}class settings_g{constructor({theme:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9;const o=settings_a(e);this.color=o.accent,this.outlineColor=o.outline,this.renderOccluded=Material.yD.Opaque,this.hoverOutlineColor=o.selectedOutline,settings_p(this,t)}apply(e,t){const o=this[e];t.setParameters({color:(0,colorUtils.O)(o),transparent:"color"!==e||o.a<1,renderOccluded:this.renderOccluded})}}class settings_m{constructor({theme:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=Material.yD.Transparent,this.minSquaredEdgeLength=900;const o=settings_a(e);this.color=(0,colorUtils.G)(o.accent,.5),this.hoverColor=o.accent,settings_p(this,t)}apply(e,t){const o=this[e];t.setParameters({color:(0,colorUtils.O)(o),transparent:o.a<1,renderOccluded:this.renderOccluded})}}class settings_w{constructor({theme:e}){const t=settings_a(e);this.vertex=new settings_g({theme:e,color:t.accent,outlineColor:t.outline}),this.edge=new settings_g({theme:e,color:(0,colorUtils.vG)((0,colorUtils.G)(t.accent,2/3),.5),outlineColor:(0,colorUtils.G)(t.outline,.5),size:8,collisionPadding:8}),this.selected=new settings_g({theme:e,color:t.selected,outlineColor:t.outline}),this.edgeOffset=new settings_m({theme:e})}}class settings_f{constructor({theme:e,...t}){this.width=1.5,this.stipplePattern=(0,lineStippleUtils.z5)(5),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=Material.yD.OccludeAndTransparent;const o=settings_a(e);this.color=o.selected,this.stippleOffColor=o.outline,this.innerColor=o.selected,settings_p(this,t)}apply(e){e.color=(0,colorUtils.O)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,colorUtils.O)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,colorUtils.O)(this.innerColor),e.renderOccluded=this.renderOccluded}}class settings_C{constructor({theme:e,...t}){this.size=4,this.outlineSize=1,this.shape="square";const o=settings_a(e);this.color=o.selected,this.outlineColor=o.outline,settings_p(this,t)}apply(e){e.color=(0,colorUtils.O)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,colorUtils.O)(this.outlineColor),e.primitive=this.shape}}class settings_O{constructor({theme:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3;const o=settings_a(e);this.innerColor=o.selected,this.glowColor=o.accent,this.heightFillColor=o.accent,settings_p(this,t)}apply(t,o=1){const i={glowColor:Color.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:Color.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*o,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in t?t.style=i:t.laserlineStyle=i}}class settings_W{constructor({theme:e,...t}){const o=settings_a(e);this.outline=new settings_f({theme:e,color:o.outline,renderOccluded:Material.yD.OccludeAndTransparentStencil,stippleOffColor:o.selected,stipplePattern:(0,lineStippleUtils.z5)(5),width:1.5,innerWidth:0}),this.staged=new settings_f({theme:e,color:o.selected,renderOccluded:Material.yD.OccludeAndTransparentStencil,innerColor:o.staged,stippleOffColor:o.outline,stipplePattern:(0,lineStippleUtils.z5)(5),width:1.5}),this.shadowStyle=new settings_O({theme:e,globalAlpha:.3,glowColor:o.accent,glowFalloff:8,glowWidth:8,innerColor:o.selected,innerWidth:1}),settings_p(this,t)}}class settings_A{constructor({theme:e,...t}){const o=settings_a(e);this.outline=new settings_C({theme:e,color:o.selected,outlineColor:o.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new settings_O({theme:e,globalAlpha:.3,glowColor:o.accent,glowFalloff:1.5,glowWidth:6,innerColor:o.selected,innerWidth:1,radius:2}),settings_p(this,t)}}class settings_z extends settings_f{constructor({theme:e,...t}){super({theme:e}),this.extensionType=ExtendedLineVisualElement_V.GROUND_RAY,settings_p(this,t)}}class settings_b{constructor({theme:e}){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20;const t=settings_a(e);this.lineGraphics=new settings_W({theme:e}),this.pointGraphics=new settings_A({theme:e}),this.heightPlane=new settings_O({theme:e,globalAlpha:.3,glowColor:t.accent,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:1}),this.heightBox=new settings_O({theme:e,globalAlpha:.3,glowColor:t.accent,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:0,heightFillColor:t.accent}),this.zVerticalLine=new settings_z({theme:e,color:(0,colorUtils.G)(t.accent,.5),falloff:2,innerColor:(0,colorUtils.G)(t.selected,0),renderOccluded:Material.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ExtendedLineVisualElement_V.GROUND_RAY})}}class settings_y{constructor(e){this.colors=settings_a(e.theme),this.visualElements=new settings_b(e),this.manipulators=new settings_w(e),this.zManipulator=new settings_u(e)}}const settings_P=memoize_t((e=>new settings_y({theme:e})));var Evented=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),line=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/engineContent/line.js"),renderInfoUtils_line=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/renderInfoUtils/line.js");class OutlineVisualElement_j extends EngineVisualElement_t{constructor(t){super(t),this._attachmentOrigin=(0,dehydratedFeatures.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Evented.Z,this._geometry=null,this._width=1,this._color=(0,vec4f32.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,vec4f32.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Material.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new LaserlineVisualElement_c({view:t.view}),this.applyProps(t),this.attached=t.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,vec4.g)(e,this._innerColor)||((0,vec4.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,vec4.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,vec4f32.c)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,vec3.s)(OutlineVisualElement_E,0,0,0);let s=0;for(const t of e)t.computeAttachmentOrigin(OutlineVisualElement_P)&&((0,vec3.a)(OutlineVisualElement_E,OutlineVisualElement_E,OutlineVisualElement_P),s++);return 0===s?null:((0,vec3.g)(OutlineVisualElement_E,OutlineVisualElement_E,1/s),this.view.renderCoordsHelper.fromRenderCoords(OutlineVisualElement_E,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Material.yD.OccludeAndTransparentStencil?Material.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const i of r)e.addGeometry(i);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_createObject3DResources(e){const t=new RibbonLineMaterial.U(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e)}}}_createDrapedResources(){const e=new RibbonLineMaterial.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,i=r.basemapTerrain.spatialReference;return null==t||null==i?[]:(0,renderInfoUtils_line.r)(t,i).lines.map((({position:t})=>{const s={overlayInfo:{spatialReference:i,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new RenderGeometry.z((0,line.Y)(e,s))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const i=r.vertexAttributes.get(VertexAttribute.T.POSITION),s=(0,DoubleArray.bg)(i.data.length);(0,geometry_projection.projectBuffer)(i.data,t.spatialReference,0,s,this.view.spatialReference,0,i.data.length/3),(0,aaBoundingBox.G1)(e,s)}return!0}_createRenderGeometries(e,t){const r=this.geometry;if(null==r)return;const i=(0,renderInfoUtils_line.V)(r,this.view.elevationProvider,this.view.renderCoordsHelper,ElevationContext.o.fromElevationInfo(this.elevationInfo??new ElevationInfo.Z({mode:(0,elevationInfoUtils.VW)(r,null)}))),s=new Array;for(const{position:n,mapPositions:a}of i.lines){const r={mapPositions:a,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,line.Y)(e,r)),s.push(n)}this._laserline.pathVerticalPlane=s}}const OutlineVisualElement_P=(0,vec3f64.c)(),OutlineVisualElement_E=(0,vec3f64.c)();class Object3DVisualElement_a extends VisualElement_t{constructor(e){super(e.view),this._resources=null,this._transform=(0,mat4f64.c)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(s){(0,mat4.c)(this._transform,s),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,s=this.view._stage;s.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,s.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const s=new WebGLLayer.F(e,{pickable:!1,updatePolicy:UpdatePolicy.j.SYNC}),r=new Object3D.T({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial((s=>e.add(s))),e.add(r),s.add(r),r.visible=this.visible,this._resources={layer:s,object:r}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((s=>{e.remove(s),s.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var basicInterfaces=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/basicInterfaces.js"),BufferView=__webpack_require__("./node_modules/@arcgis/core/geometry/support/buffer/BufferView.js"),ShaderOutput=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js"),GLMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GLMaterial.js"),Util=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Util.js"),bufferWriterUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/bufferWriterUtils.js"),OrderIndependentTransparency=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/OrderIndependentTransparency.js"),TransparencyPassType=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TransparencyPassType.js"),DefaultTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration.js"),ShadedColorMaterial_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/ShadedColorMaterial.glsl.js");class ShadedColorMaterialTechnique_g extends ShaderTechnique.A{initializeProgram(e){return new Program.$(e.rctx,ShadedColorMaterialTechnique_g.shader.get().build(this.configuration),ShadedColorMaterialTechnique_v)}_setPipelineState(e){const r=this.configuration,o=e===TransparencyPassType.A.NONE,i=e===TransparencyPassType.A.FrontFace;return(0,renderState.sm)({blending:r.output!==ShaderOutput.H.Color&&r.output!==ShaderOutput.H.Alpha||!r.transparent?null:o?OrderIndependentTransparency.wu:(0,OrderIndependentTransparency.j7)(e),culling:(0,renderState.zp)(r.cullFace),depthTest:{func:i?enums.wb.LESS:r.shadingEnabled?enums.wb.LEQUAL:enums.wb.LESS},depthWrite:o?r.writeDepth?renderState.LZ:null:(0,OrderIndependentTransparency.K5)(e),colorWrite:renderState.BK,polygonOffset:o||i?null:OrderIndependentTransparency.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}ShadedColorMaterialTechnique_g.shader=new ReloadableShaderModule.J(ShadedColorMaterial_glsl.S,(()=>__webpack_require__.e(5316).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadedColorMaterial.glsl.js"))));class ShadedColorMaterialTechnique_j extends DefaultTechniqueConfiguration.W{constructor(){super(...arguments),this.output=ShaderOutput.H.Color,this.cullFace=basicInterfaces.Vr.None,this.transparencyPassType=TransparencyPassType.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:ShaderOutput.H.COUNT})],ShadedColorMaterialTechnique_j.prototype,"output",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:basicInterfaces.Vr.COUNT})],ShadedColorMaterialTechnique_j.prototype,"cullFace",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:TransparencyPassType.A.COUNT})],ShadedColorMaterialTechnique_j.prototype,"transparencyPassType",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"hasSlicePlane",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"writeDepth",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"screenSizeEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"shadingEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"hasMultipassTerrain",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ShadedColorMaterialTechnique_j.prototype,"cullAboveGround",void 0);const ShadedColorMaterialTechnique_v=new Map([[VertexAttribute.T.POSITION,0],[VertexAttribute.T.NORMAL,1],[VertexAttribute.T.OFFSET,2]]);class ShadedColorMaterial_v extends Material.F5{constructor(e){super(e,new ShadedColorMaterial_O),this.supportsEdges=!0,this._configuration=new ShadedColorMaterialTechnique_j,this._vertexAttributeLocations=ShadedColorMaterialTechnique_v}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,s,a,c,l,u){if(this.parameters.screenSizeEnabled){const s=e.vertexAttributes.get(VertexAttribute.T.OFFSET),h={applyToVertex:(e,n,o,c)=>{const l=(0,vec3.s)(ShadedColorMaterial_w,s.data[3*c],s.data[3*c+1],s.data[3*c+2]),u=(0,vec3.s)(ShadedColorMaterial_z,e,n,o);return(0,vec3.g)(l,l,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(l)),(0,vec3.a)(u,u,l),[u[0],u[1],u[2]]},applyToAabb:e=>{const t=(0,aaBoundingBox.be)(e,ShadedColorMaterial_w);return(0,aaBoundingBox.bA)(e,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(t))}};(0,MaterialUtil.Bw)(e,a,c,l,h,u)}else(0,MaterialUtil.Bw)(e,a,c,l,void 0,u)}requiresSlot(e,t){if(t===ShaderOutput.H.Highlight)return e===RenderSlot.r.OPAQUE_MATERIAL;if(t===ShaderOutput.H.Color||t===ShaderOutput.H.Alpha||t===ShaderOutput.H.ObjectAndLayerIdColor){let t=RenderSlot.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(t=this.parameters.writeDepth?RenderSlot.r.TRANSPARENT_MATERIAL:RenderSlot.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===RenderSlot.r.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new ShadedColorMaterial_j(e)}createBufferWriter(){return new ShadedColorMaterial_x(this.parameters.screenSizeEnabled)}}class ShadedColorMaterial_j extends GLMaterial.Z{beginSlot(e){return this.ensureTechnique(ShadedColorMaterialTechnique_g,e)}}class ShadedColorMaterial_O extends Material.Mt{constructor(){super(...arguments),this.color=(0,vec4f64.f)(1,1,1,1),this.shadingTint=(0,vec4f64.f)(0,0,0,.25),this.shadingDirection=(0,vec3.n)((0,vec3f64.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=basicInterfaces.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class ShadedColorMaterial_x{constructor(e){this.screenSizeEnabled=e;const t=(0,InterleavedLayout.U$)().vec3f(VertexAttribute.T.POSITION).vec3f(VertexAttribute.T.NORMAL);this.screenSizeEnabled&&t.vec3f(VertexAttribute.T.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.indices.get(VertexAttribute.T.POSITION).length}write(e,t,r,i,s){if((0,bufferWriterUtils.NK)(r,this.vertexBufferLayout,e,t,i,s),this.screenSizeEnabled){if(!r.vertexAttributes.has(VertexAttribute.T.OFFSET))throw new Error(`${VertexAttribute.T.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=r.vertexAttributes.get(VertexAttribute.T.OFFSET),a=r.indices.get(VertexAttribute.T.OFFSET);(0,Util.hu)(3===e.size);const n=i.getField(VertexAttribute.T.OFFSET,BufferView.ct);if(!n)throw new Error("unable to acquire view for "+VertexAttribute.T.OFFSET);(0,bufferWriterUtils.ho)(a,e.data,t,n,s)}}}}const ShadedColorMaterial_w=(0,vec3f64.c)(),ShadedColorMaterial_z=(0,vec3f64.c)();class VerticesVisualElement_ extends Object3DVisualElement_a{constructor(e){super(e),this.view=null,this._renderOccluded=Material.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,vec4f64.b)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,vec4f64.b)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,vec4.g)(e,this._outlineColor)||((0,vec4.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if(null==t||0===t.length)return[];const s=function point_o(o,n,r,s,i){const l=(0,DoubleArray.bg)(3*o.length),p=(0,DoubleArray.bg)(l.length);o.forEach(((t,e)=>{l[3*e]=t[0],l[3*e+1]=t[1],l[3*e+2]=t.length>2?t[2]:0}));const c=(0,elevationAlignmentUtils.rR)(l,n,0,p,0,l,0,l.length/3,r,s,i),m=null!=c;return{numVertices:o.length,position:l,mapPositions:p,projectionSuccess:m,sampledElevation:c}}(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ElevationContext.o.fromElevationInfo(this.elevationInfo)),a=[],o=s.numVertices,c=s.position;for(let l=0;l<o;++l){const t=(0,vec3.s)(VerticesVisualElement_d,c[3*l],c[3*l+1],c[3*l+2]),s=VerticesVisualElement_m(this._vertexMaterial,.5,t),n=VerticesVisualElement_m(this._vertexOutlineMaterial,.5,t);a.push({vertexGeometry:s,vertexOutlineGeometry:n})}return a}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:r,vertexOutlineGeometry:i}of t)e.addGeometry(r),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new ShadedColorMaterial_v({...this._vertexMaterialParameters,writeDepth:!0,cullFace:basicInterfaces.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new ShadedColorMaterial_v({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:basicInterfaces.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const VerticesVisualElement_d=(0,vec3f64.c)();function VerticesVisualElement_m(e,t,r){return(0,GeometryUtil.PI)(e,t,16,16,{offset:r})}let GraphicState_e=class extends Evented.Z.EventedAccessor{constructor(r){super(r),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],GraphicState_e.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicState_e.prototype,"tracking",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicState_e.prototype,"displaying",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicState_e.prototype,"isDraped",void 0),GraphicState_e=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.graphics.GraphicState")],GraphicState_e);var DrawGraphicTool=__webpack_require__("./node_modules/@arcgis/core/views/draw/DrawGraphicTool.js"),DrawOperation=__webpack_require__("./node_modules/@arcgis/core/views/draw/DrawOperation.js"),drawSurfaces=__webpack_require__("./node_modules/@arcgis/core/views/draw/drawSurfaces.js");let DrawGraphicTool3D_T=class extends DrawGraphicTool.T2{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new ElevationInfo.Z({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,elevationInfoUtils.mF)(t)}}return e}initializeGraphic(e){const{view:i}=this,r=this._createGraphicState=new GraphicState_e({graphic:e});return(0,handleUtils.AL)([i.maskOccludee(e),i.trackGraphicState(r),(0,reactiveUtils.YP)((()=>({element:this._outlineVisualElement,isDraped:r.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),reactiveUtils.tX),this._setupLoadingIndicator(r),...meshFastUpdateUtils_o(r)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new DrawOperation.w({view:this.view,manipulators:this.manipulators,geometryType:(0,DrawGraphicTool.IJ)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new drawSurfaces.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new drawSurfaces.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new SnappingVisualizer3D_O,segmentLabels:t?new SegmentLabels3D_a:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,elevationInfoUtils.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){const{view:t}=this,s=settings_P(t);if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null;const n=s.manipulators,a=n.vertex;this._activeVertexVisualElement=new VerticesVisualElement_({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,color:(0,colorUtils.O)(a.color),size:a.size,outlineColor:(0,colorUtils.O)(a.outlineColor),outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=(0,colorUtils.O)(n.selected.color),this._activeVertexVisualElement.attached=!0;const o=s.visualElements.zVerticalLine;return this._verticalLineVisualElement=new ExtendedLineVisualElement_G({view:t,extensionType:o.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Material.yD.OccludeAndTransparent}),o.apply(this._verticalLineVisualElement),(0,handleUtils.kB)((()=>{this._activeVertexVisualElement=(0,maybe.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,maybe.SC)(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:i,elevationProvider:r}=this.view;(0,vec3.s)(DrawGraphicTool3D_b,e[0],e[1],e[2]),DrawGraphicTool3D_z.setFromElevationInfo(this.elevationInfo),DrawGraphicTool3D_b[2]=(0,elevationAlignmentUtils.w7)(DrawGraphicTool3D_b,r,DrawGraphicTool3D_z,i),i.toRenderCoords(DrawGraphicTool3D_b,this.view.spatialReference,DrawGraphicTool3D_b)?(t.setStartEndFromWorldDownAtLocation(DrawGraphicTool3D_b),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo,{view:s}=this,n=settings_P(s);return this._outlineVisualElement=new OutlineVisualElement_j({view:s,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,elevationInfoUtils.Zz)(this.hasZ,t),attached:!1}),n.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),n.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,handleUtils.kB)((()=>{this._outlineVisualElement=(0,maybe.SC)(this._outlineVisualElement)}))}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,null;const{view:t}=this,s=settings_P(t).manipulators.vertex;return this._verticesVisualElement=new VerticesVisualElement_({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,color:(0,colorUtils.O)(s.color),size:s.size,outlineColor:(0,colorUtils.O)(s.outlineColor),outlineSize:s.outlineSize,renderOccluded:s.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,handleUtils.kB)((()=>{this._verticesVisualElement=(0,maybe.SC)(this._verticesVisualElement)}))}_updateGraphicGeometry(e,t){if("mesh"===this.geometryType&&"point"===t?.type){const i=this.geometryToPlace;return i&&i.centerAt(t),void(i&&e.geometry===i?i.vertexSpace.isGeoreferenced?e.notifyGeometryChanged():e.notifyMeshTransformChanged():e.geometry=i)}super._updateGraphicGeometry(e,t)}_setupLoadingIndicator(e){const{drawOperation:r}=this;if(!this.geometryToPlace)return r.loading=!1,null;r.loading=!0;const s=(0,handleUtils.kB)((()=>{r.loading=!1}));let o;const l=()=>o&&cancelAnimationFrame(o);return(0,handleUtils.AL)([(0,reactiveUtils.gx)((()=>e.displaying),(()=>{l(),o=requestAnimationFrame((()=>s.remove()))}),{...reactiveUtils.tX,once:!0}),(0,handleUtils.kB)(l),s])}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],DrawGraphicTool3D_T.prototype,"elevationInfo",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],DrawGraphicTool3D_T.prototype,"geometryType",void 0),(0,tslib_es6._)([(0,property.Cb)()],DrawGraphicTool3D_T.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],DrawGraphicTool3D_T.prototype,"view",void 0),DrawGraphicTool3D_T=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],DrawGraphicTool3D_T);const DrawGraphicTool3D_z=new ElevationContext.o,DrawGraphicTool3D_b=(0,vec3f64.c)();var Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),HandleOwner=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),quantityUtils=__webpack_require__("./node_modules/@arcgis/core/core/quantityUtils.js"),hydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/hydratedFeatures.js"),compilerUtils=(__webpack_require__("./node_modules/@arcgis/core/geometry.js"),__webpack_require__("./node_modules/@arcgis/core/core/compilerUtils.js")),utils=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/utils.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f64.js"),ellipsoidUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/ellipsoidUtils.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),plane=__webpack_require__("./node_modules/@arcgis/core/geometry/support/plane.js"),ElevationProvider=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/ElevationProvider.js");function ray_i(r,n,o){return function ray_s(o,t,i){const s=(0,screenUtils.Wv)((0,vec2.j)(vectorStacks.WM.get(),t));if(s[2]=0,!o.unprojectFromRenderScreen(s,i.origin))return null;const u=(0,screenUtils.Wv)((0,vec2.j)(vectorStacks.WM.get(),t));u[2]=1;const g=o.unprojectFromRenderScreen(u,vectorStacks.WM.get());return null==g?null:((0,vec3.b)(i.direction,g,i.origin),i)}(r,r.screenToRender(n,(0,screenUtils.Wv)(vectorStacks.WM.get())),o)}var Camera=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Camera.js"),interactive_interfaces=__webpack_require__("./node_modules/@arcgis/core/views/interactive/interfaces.js"),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js");class Manipulator3D_${constructor(e){this.metadata=void 0,this._camera=new Camera.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,mat4f64.c)(),this._worldFrame=null,this._renderLocation=(0,vec3f64.c)(),this._renderLocationDirty=!0,this._location=new Point.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new Point.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=interactive_interfaces.jg.None,this._focused=!1,this.events=new Evented.Z.EventEmitter,this._screenLocation={screenPointArray:(0,screenUtils.s1)(),renderScreenPointArray:(0,screenUtils.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const i=this.view.state?.camera;i&&this._camera.copyFrom(i)}destroy(){this._applyObjectTransform=fe,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,utils.IH)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){ee(e)&&(this._screenLocationDirty=!0),(0,mat4.c)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,mat4f64.c)()),function te(e,t,s){switch(e.viewingMode){case"local":return(0,mat4.i)(s),!0;case"global":{const n=(0,ellipsoidUtils.Iu)(e.renderCoordsHelper.spatialReference);return(0,geometry_projection.sphericalPCPFtoLonLatElevation)(t,0,le,0,n.radius),(0,geometry_projection.computeENUToSphericalPCPFLocalRotation)((0,mathUtils.Vl)(le[0]),(0,mathUtils.Vl)(le[1]),s),!0}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,hydratedFeatures.WG)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,hydratedFeatures.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,hydratedFeatures.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,ee(this._modelTransform)){const t=this._calculateModelTransformOffset(ge);e=(0,vec3.a)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(t,i){if(!this.available)return null;const s=(0,screenUtils.md)(t,ie),n=this._getCollisionRadius(i),o=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,vec2.k)(this.screenLocation.screenPointArray,s)<n*n)return this.screenLocation.renderScreenPointArray[2]+o;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ae),r=n*this.screenLocation.pixelSize,c=ray_i(this._camera,s,ne);if(null==c)return null;for(const s of e){if(0===s.length)continue;const e=(0,vec3.m)(le,s[0],i);for(let t=1;t<s.length;t++){const n=(0,vec3.m)(he,s[t],i),l=(0,lineSegment.Gr)((0,lineSegment.zk)(e,n,se),c);if(null!=l&&l<r*r){const t=(0,vec3.a)(vectorStacks.WM.get(),e,n);(0,vec3.g)(t,t,.5);const i=(0,screenUtils.So)(vectorStacks.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+o}(0,vec3.c)(e,n)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??vec3f64.Z,i=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(i,ae),a=n*this.screenLocation.pixelSize,c=ray_i(this._camera,s,ne);if(null==c)return null;const h=(0,mat3.f)(oe,r),d=(0,vec3.t)(_e,e,h),_=(0,vec3.m)(ue,t,r);(0,plane.Yq)(_,d,ce);const u=de;if((0,plane.BR)(ce,c,u)&&(0,vec3.d)(u,_)<a*a)return this.screenLocation.renderScreenPointArray[2]+o;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,i=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(i,ae),c=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),h=ray_i(this._camera,s,ne);if(null==h)return null;const d=(0,mat3.f)(oe,r),_=(0,vec3.t)(_e,t,d),u=this._calculateModelTransformPosition(ue);(0,plane.Yq)(u,_,ce);const g=de;if(!(0,plane.BR)(ce,h,g))break;for(const s of e){if(0===s.length)continue;const e=(0,vec3.m)(le,s[0],r);for(let t=1;t<s.length;t++){const i=(0,vec3.m)(he,s[t],r),n=(0,lineSegment.Jk)((0,lineSegment.zk)(e,i,se),g);if(null!=n&&n<c*c){const t=(0,vec3.a)(vectorStacks.WM.get(),e,i);(0,vec3.g)(t,t,.5);const s=(0,screenUtils.So)(vectorStacks.WM.get());return this._camera.projectToRenderScreen(t,s),s[2]+o}(0,vec3.c)(e,i)}}break}default:(0,compilerUtils.Bg)(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new WebGLLayer.F(t,{pickable:!1,updatePolicy:UpdatePolicy.j.SYNC}),i.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,geometry_projection.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Point.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;this._removeResourcesFromStage(),i&&(t.engineLayerId=null,(0,maybe.SC)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,geometry_projection.projectPoint)(this.location,me,e.spatialReference)&&(0,aaBoundingRect.Qn)(e.extent,me)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const i=this.elevationInfo.offset??0;switch(this.elevationInfo.mode){case"on-the-ground":e=(0,ElevationProvider.KO)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=((0,ElevationProvider.KO)(this.view.elevationProvider,this.location,"ground")??0)+i;break;case"relative-to-scene":t=((0,ElevationProvider.KO)(this.view.elevationProvider,this.location,"scene")??0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ae;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?interactive_interfaces.Q9.Focused:interactive_interfaces.Q9.Unfocused)|(this.selected?interactive_interfaces.Q9.Selected:interactive_interfaces.Q9.Unselected),n=this._noDisplayCount>0;for(const{stateMask:o,objects:r}of i){if(n){for(const e of r)e.visible=!1;continue}const e=(o&interactive_interfaces.Q9.All)!==interactive_interfaces.Q9.None,i=(o&interactive_interfaces.jg.All)!==interactive_interfaces.jg.None,a=!e||(s&o)==(o&interactive_interfaces.Q9.All),c=!i||(this.state&o)==(o&interactive_interfaces.jg.All);if(a&&c)for(const s of r)s.visible=!0,s.transformation=t;else for(const t of r)t.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{i.has(e)||(t.push(e),i.add(e))}));const s=new Map;this._renderObjects.forEach((e=>{const t=new Object3D.T({castShadow:!1,geometries:[e.geometry]}),i=s.get(e.stateMask)||[];i.push(t),s.set(e.stateMask,i)}));const n=[];s.forEach(((e,t)=>n.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;s.forEach((t=>{const i=this._materialIdReferences,s=i.get(t.id)||0;0===s&&e.add(t),i.set(t.id,s+1)})),t.forEach((({objects:t})=>{i.addMany(t),e.addMany(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;t.forEach((({objects:t})=>{i.removeMany(t),e.removeMany(t)})),s.forEach((t=>{const i=this._materialIdReferences,s=i.get(t.id);1===s?(e.remove(t),i.delete(t.id)):i.set(t.id,s-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,re);return(0,vec3.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,vec3.b)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,mat4.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,mat4.m)(t,t,this._worldFrame),(0,mat4.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){let e=!1;if(null!=this._engineResources)for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function ee(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const ie=(0,screenUtils.s1)(),se=(0,lineSegment.Ue)(),ne=(0,ray.Ue)(),oe=(0,mat3f64.c)(),re=(0,mat4f64.c)(),ae=(0,mat4f64.c)(),ce=(0,plane.Ue)(),le=(0,vec3f64.c)(),he=(0,vec3f64.c)(),de=(0,vec3f64.c)(),_e=(0,vec3f64.c)(),ue=(0,vec3f64.c)(),ge=(0,vec3f64.c)(),me=new Point.Z({x:0,y:0,z:0,spatialReference:null}),fe=()=>{};class RenderObject_e{constructor(e,s=interactive_interfaces.Q9.None){this.geometry=e,this.stateMask=s}}var graphicUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/graphicUtils.js"),GLTextureMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/GLTextureMaterial.js"),DefaultBufferWriter=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultBufferWriter.js"),DefaultLayouts=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultLayouts.js"),TriangleMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/TriangleMaterial.js"),StencilUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/StencilUtils.js"),ImageMaterial_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js");class ImageMaterialTechnique_ extends ShaderTechnique.A{initializeProgram(e){return new Program.$(e.rctx,ImageMaterialTechnique_.shader.get().build(this.configuration),DefaultVertexAttributeLocations.i)}_setPipelineState(e,r){const i=this.configuration,s=e===TransparencyPassType.A.NONE,o=e===TransparencyPassType.A.FrontFace;return(0,renderState.sm)({blending:i.output!==ShaderOutput.H.Color&&i.output!==ShaderOutput.H.Alpha||!i.transparent?null:s?ImageMaterialTechnique_C:(0,OrderIndependentTransparency.j7)(e),culling:(0,renderState.zp)(i.cullFace),depthTest:{func:(0,OrderIndependentTransparency.Bh)(e)},depthWrite:s?i.writeDepth?renderState.LZ:null:(0,OrderIndependentTransparency.K5)(e),colorWrite:renderState.BK,stencilWrite:i.hasOccludees?StencilUtils.s3:null,stencilTest:i.hasOccludees?r?StencilUtils.eD:StencilUtils.RY:null,polygonOffset:s||o?null:(0,OrderIndependentTransparency.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}ImageMaterialTechnique_.shader=new ReloadableShaderModule.J(ImageMaterial_glsl.I,(()=>__webpack_require__.e(9356).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterial.glsl.js"))));const ImageMaterialTechnique_C=(0,renderState.if)(enums.zi.ONE,enums.zi.ONE_MINUS_SRC_ALPHA);class ImageMaterialTechnique_w extends DefaultTechniqueConfiguration.W{constructor(){super(...arguments),this.output=ShaderOutput.H.Color,this.cullFace=basicInterfaces.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=TransparencyPassType.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:ShaderOutput.H.COUNT})],ImageMaterialTechnique_w.prototype,"output",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:basicInterfaces.Vr.COUNT})],ImageMaterialTechnique_w.prototype,"cullFace",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"hasSlicePlane",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"enableOffset",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"writeDepth",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"hasOccludees",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:TransparencyPassType.A.COUNT})],ImageMaterialTechnique_w.prototype,"transparencyPassType",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"hasMultipassTerrain",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],ImageMaterialTechnique_w.prototype,"cullAboveGround",void 0);class ImageMaterial_c extends TriangleMaterial.c{constructor(e){super(e,new ImageMaterial_m),this.supportsEdges=!0,this._configuration=new ImageMaterialTechnique_w}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<OrderIndependentTransparency.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,r){return(r===ShaderOutput.H.Color||r===ShaderOutput.H.Alpha||r===ShaderOutput.H.Highlight)&&(t===RenderSlot.r.DRAPED_MATERIAL||(r===ShaderOutput.H.Highlight?t===RenderSlot.r.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?RenderSlot.r.TRANSPARENT_MATERIAL:RenderSlot.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:RenderSlot.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new ImageMaterial_p(e)}createBufferWriter(){return new DefaultBufferWriter.G(DefaultLayouts.W1)}}class ImageMaterial_p extends GLTextureMaterial.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ImageMaterialTechnique_,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(t){return this._output!==ShaderOutput.H.Color&&this._output!==ShaderOutput.H.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class ImageMaterial_m extends Material.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=basicInterfaces.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}var NativeLineMaterial=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/materials/NativeLineMaterial.js");function manipulatorUtils_F(e,t=Material.yD.OccludeAndTransparent,r=!0){const n=(0,vec4f64.f)(e[0],e[1],e[2],e.length>3?e[3]:1),o=e[3]<1,a=!o;return r?new ShadedColorMaterial_v({color:n,transparent:o,writeDepth:a,cullFace:basicInterfaces.Vr.Back,renderOccluded:t}):new ColorMaterial.E({color:n,transparent:o,writeDepth:a,cullFace:basicInterfaces.Vr.Back,renderOccluded:t})}function manipulatorUtils_k(e,t=Material.yD.OccludeAndTransparent){const r=(0,vec4f64.f)(e[0],e[1],e[2],4===e.length?e[3]:1);return new ColorMaterial.E({color:r,transparent:!0,writeDepth:!0,cullFace:basicInterfaces.Vr.Front,renderOccluded:t})}const manipulatorUtils_I=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1});function manipulatorUtils_R(e,t){const r=new Manipulator3D_$({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:t.metadata});return function manipulatorUtils_L(e,t){const r=t.material??new ImageMaterial_c({transparent:!0,writeDepth:!1,textureId:t.texture?.id,renderOccluded:Material.yD.Opaque}),n=t.focusMultiplier??manipulatorUtils_I.focusMultiplier,o=t.calloutLength??manipulatorUtils_I.calloutLength,i=manipulatorUtils_I.discRadius*(t.discScale??1),a=i*n,c=(e,t)=>{const r=[0,1,2,2,3,0];return new Geometry.Z(t,[[VertexAttribute.T.POSITION,new Attribute.a([o-e,-e,0,o+e,-e,0,o+e,e,0,o-e,e,0],3,!0)],[VertexAttribute.T.UV0,new Attribute.a([0,0,1,0,1,1,0,1],2,!0)]],[[VertexAttribute.T.POSITION,r],[VertexAttribute.T.UV0,r]])},l=t.calloutWidth??manipulatorUtils_I.calloutWidth,s=new(l>1?RibbonLineMaterial.U:NativeLineMaterial.Y)({width:l,color:t.calloutColor,renderOccluded:Material.yD.OccludeAndTransparent}),m=(0,GeometryUtil.rh)(s,[[0,0,0],[o-i,0,0]]),p=(0,GeometryUtil.rh)(s,[[0,0,0],[o-a,0,0]]),w=t.customStateMask??interactive_interfaces.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[o,0,0]},e.focusMultiplier=n,e.metadata=t.metadata,e.radius=i,e.renderObjects=[new RenderObject_e(c(i,r),interactive_interfaces.Q9.Unfocused|w),new RenderObject_e(m,interactive_interfaces.Q9.Unfocused|w),new RenderObject_e(c(a,r),interactive_interfaces.Q9.Focused|w),new RenderObject_e(p,interactive_interfaces.Q9.Focused|w)]}(r,t),r}const U=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function D(o,i,l,s){const u=(0,vec3.b)(vectorStacks.WM.get(),o,l),m=manipulatorUtils_N(u,(0,vec3.f)(vectorStacks.WM.get(),s,u),l,vectorStacks.MP.get());(0,mat4.a)(m,m);const d=(0,vec3.m)(vectorStacks.WM.get(),i,m);return Math.atan2(d[1],d[0])}function manipulatorUtils_N(e,t,n,i){const c=(0,vec3.n)(vectorStacks.WM.get(),e),l=(0,vec3.n)(vectorStacks.WM.get(),t),s=(0,vec3.f)(vectorStacks.WM.get(),c,l);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=0,i[4]=l[0],i[5]=l[1],i[6]=l[2],i[7]=0,i[8]=s[0],i[9]=s[1],i[10]=s[2],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function manipulatorUtils_x(e,t){const r=e.getViewForGraphic(t);return null!=r&&"computeAttachmentOrigin"in r?r.computeAttachmentOrigin(t,e.spatialReference):null}function manipulatorUtils_V(e,t,r){const n=manipulatorUtils_x(e,r);null==n?function manipulatorUtils_z(e,t){if(null==t)return;const r="mesh"===t.type?t.anchor:(0,graphicUtils.zE)(t);null!=r&&(e.location=(0,hydratedFeatures.kB)(r))}(t,r.geometry):t.elevationAlignedLocation=n}var GrabbingState_N,ManipulatorType_A,isSupportedGraphicUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/interactive/editingTools/isSupportedGraphicUtils.js");function manipulatorUtils_n(n,o=(0,elevationInfoUtils.RL)(n)){return"on-the-ground"!==o.mode&&!(null==n.geometry||!n.geometry.hasZ)}!function(N){N[N.NONE=0]="NONE",N[N.ANY=1]="ANY",N[N.Z=2]="Z",N[N.XY=4]="XY"}(GrabbingState_N||(GrabbingState_N={})),function(A){A[A.TRANSLATE_Z=0]="TRANSLATE_Z",A[A.TRANSLATE_XY=1]="TRANSLATE_XY",A[A.SCALE=2]="SCALE",A[A.ROTATE=3]="ROTATE",A[A.SCALE_ROTATE=4]="SCALE_ROTATE"}(ManipulatorType_A||(ManipulatorType_A={}));class ManipulatorState_a{constructor(){this.grabbingState=GrabbingState_N.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(a){this.grabbingState=GrabbingState_N.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,a.forEachManipulator(((a,s)=>{if(s===ManipulatorType_A.TRANSLATE_Z&&(this.zManipulator=a),a instanceof Manipulator3D_$&&(a.selected&&(0===this.numSelected&&(this.firstSelected=a),this.numSelected++),null==this.firstGrabbedXY&&a.grabbing&&s===ManipulatorType_A.TRANSLATE_XY&&(this.firstGrabbedXY=a)),a.grabbing)switch(this.grabbingState|=GrabbingState_N.ANY,s){case ManipulatorType_A.TRANSLATE_Z:this.grabbingState|=GrabbingState_N.Z;break;case ManipulatorType_A.TRANSLATE_XY:this.grabbingState|=GrabbingState_N.XY}}))}}function lineGraphicVisualElementUtils_w(t){const{view:n,graphic:a}=t,i=new GraphicState_e({graphic:a}),r=function lineGraphicVisualElementUtils_b(n,a){const{view:r,graphic:o}=n,l=new OutlineVisualElement_j({view:r,geometry:lineGraphicVisualElementUtils_G(o)?o.geometry:null,elevationInfo:(0,elevationInfoUtils.RL)(o),attached:!1}),s=settings_P(r).visualElements.lineGraphics;s.shadowStyle.apply(l);const c=()=>{l.attached=a.displaying};s.outline.apply(l);const m=[(0,reactiveUtils.YP)((()=>a.displaying),c),(0,reactiveUtils.YP)((()=>a.isDraped),(e=>{l.isDraped=e})),a.on("changed",(()=>l.geometry=lineGraphicVisualElementUtils_G(o)?o.geometry:null)),(0,handleUtils.ed)(l)];return c(),{visualElement:l,remove:()=>(0,handleUtils.AL)(m).remove()}}(t,i),o=[r,lineGraphicVisualElementUtils_j(t,r.visualElement,i),n.maskOccludee(a),n.trackGraphicState(i)];return{visualElement:r.visualElement,remove:()=>(0,handleUtils.AL)(o).remove()}}function lineGraphicVisualElementUtils_j(r,o,l){const{graphic:s,view:c}=r,d=[],y=(0,elevationInfoUtils.RL)(s),v="on-the-ground"===y.mode||!y.offset&&"absolute-height"!==y.mode,w=new ManipulatorState_a,b=settings_P(c).visualElements,j=new ExtendedLineVisualElement_G({view:c,extensionType:b.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Material.yD.OccludeAndTransparent});b.pointGraphics.shadowStyle.apply(j);const L=(0,mathUtils.Vl)(b.heightPlaneAngleCutoff),T=new LaserlineVisualElement_c({view:c,attached:!1,angleCutoff:L});b.heightPlane.apply(T);let A=1,D=1;const C=()=>{if(w.update(r),!l.displaying||v&&(l.isDraped||!lineGraphicVisualElementUtils_G(s)||!s.geometry.hasZ))return o.laserlineEnabled=!1,j.attached=!1,void(T.attached=!1);o.laserlineEnabled=!0;const e=w.grabbingState&GrabbingState_N.XY?b.laserlineAlphaMultiplier:1;e!==A&&(A=e,b.lineGraphics.shadowStyle.apply(o,e),b.pointGraphics.shadowStyle.apply(j,e));const t=w.grabbingState&GrabbingState_N.Z?b.laserlineAlphaMultiplier:1;t!==D&&(D=t,b.heightPlane.apply(T,t)),function lineGraphicVisualElementUtils_S(e,t){const n=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=n?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(j,w),function lineGraphicVisualElementUtils_M(e,t,n,a){if(a.numSelected>0){(0,vec3.s)(lineGraphicVisualElementUtils_L,0,0,0);let t=0;e.forEachManipulator(((e,n)=>{n===ManipulatorType_A.TRANSLATE_XY&&e.selected&&e instanceof Manipulator3D_$&&((0,vec3.a)(lineGraphicVisualElementUtils_L,lineGraphicVisualElementUtils_L,e.renderLocation),t++)})),t>0?(n.heightManifoldTarget=(0,vec3.g)(lineGraphicVisualElementUtils_L,lineGraphicVisualElementUtils_L,1/t),n.attached=!0):n.attached=!1}else{const a=t.attachmentOrigin;null!=a&&e.view.renderCoordsHelper.toRenderCoords(a,lineGraphicVisualElementUtils_L)?(n.heightManifoldTarget=lineGraphicVisualElementUtils_L,n.attached=!0):n.attached=!1}}(r,o,T,w)};b.zVerticalLine.apply(j),d.push(l.on("changed",C),(0,reactiveUtils.YP)((()=>l.displaying),C),o.events.on("attachment-origin-changed",C),(0,handleUtils.ed)(j),(0,handleUtils.ed)(T));const O=[],V=()=>{(0,handleUtils.AL)(O).remove(),O.length=0,r.forEachManipulator((e=>O.push(e.events.on("grab-changed",C)))),r.forEachManipulator((e=>O.push(e.events.on("select-changed",C)))),C()};return V(),d.push(r.onManipulatorsChanged(V),(0,handleUtils.iU)((()=>(0,handleUtils.AL)(O)))),(0,handleUtils.AL)(d)}function lineGraphicVisualElementUtils_G(e){return null!=e.geometry&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const lineGraphicVisualElementUtils_L=(0,vec3f64.c)();function originGraphicVisualElementUtils_A(t){const{view:n,graphic:i}=t,o=new GraphicState_e({graphic:i}),a=[],r=function originGraphicVisualElementUtils_M(e,n,i){const{view:o,graphic:a}=e,r=new PointVisualElement_y({view:o,geometry:originGraphicVisualElementUtils_P(a),elevationInfo:(0,elevationInfoUtils.RL)(a),attached:!1});return function originGraphicVisualElementUtils_C(e,t,n,i){const r=()=>t.attached=n.displaying;(function originGraphicVisualElementUtils_G(e,t,i,o){const{view:a,graphic:r}=e;let s=null;const l=e=>{null!=s&&(s.remove(),s=null),i.isDraped&&null!=e&&(s=function originGraphicVisualElementUtils_R(e,t,n){const i=e.elevationProvider.spatialReference;(0,geometry_projection.projectPointToVector)(t,originGraphicVisualElementUtils_U,i);const o=originGraphicVisualElementUtils_U[0],a=originGraphicVisualElementUtils_U[1];return e.elevationProvider.on("elevation-change",(e=>{(0,aaBoundingRect.jE)(e.extent,o,a)&&n()}))}(a,e,(()=>{t.geometry=e})))},p=()=>{const e=originGraphicVisualElementUtils_P(r);l(e),t.geometry=e};o.push(i.on("changed",p),(0,handleUtils.iU)((()=>s))),p()})(e,t,n,i),settings_P(e.view).visualElements.pointGraphics.outline.apply(t),i.push((0,reactiveUtils.YP)((()=>n.displaying),r,reactiveUtils.nn))}(e,r,n,i),i.push((0,handleUtils.ed)(r)),r}(t,o,a);return function originGraphicVisualElementUtils_L(e,n,a,s){const{view:p,graphic:c}=e,h=settings_P(p),j=new ExtendedLineVisualElement_G({view:p,extensionType:h.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Material.yD.OccludeAndTransparent});h.visualElements.zVerticalLine.apply(j);const S=new LaserlineVisualElement_c({view:p,intersectsLineInfinite:!0,attached:!1});h.visualElements.pointGraphics.shadowStyle.apply(S);const A=(0,mathUtils.Vl)(h.visualElements.heightPlaneAngleCutoff),L=new LaserlineVisualElement_c({view:p,attached:!1,angleCutoff:A});h.visualElements.heightPlane.apply(L);const M=(0,elevationInfoUtils.RL)(e.graphic),C=ElevationContext.o.fromElevationInfo(M),G="on-the-ground"===M.mode||!M.offset&&"absolute-height"!==M.mode,R=new ManipulatorState_a;let V=1,B=1;const I=()=>{R.update(e);const t=originGraphicVisualElementUtils_P(c),i=G&&(n.isDraped||null==t||!t.hasZ);let o=!0;if(i||null==t)o=!1;else{const e=(0,elevationAlignmentUtils.w7)(t,p.elevationProvider,C,p.renderCoordsHelper);(0,vec3.s)(originGraphicVisualElementUtils_U,t.x,t.y,e),(0,geometry_projection.projectVectorToVector)(originGraphicVisualElementUtils_U,t.spatialReference,originGraphicVisualElementUtils_U,p.renderCoordsHelper.spatialReference),j.setStartEndFromWorldDownAtLocation(originGraphicVisualElementUtils_U),S.intersectsWorldUpAtLocation=originGraphicVisualElementUtils_U}const a=R.grabbingState&GrabbingState_N.Z?h.visualElements.laserlineAlphaMultiplier:1;a!==V&&(V=a,h.visualElements.heightPlane.apply(L,a));const d=(0,aaBoundingBox.cS)(originGraphicVisualElementUtils_D);!i&&n.displaying&&s.calculateMapBounds(d)&&(0,geometry_projection.projectVectorToVector)((0,aaBoundingBox.KE)(d,originGraphicVisualElementUtils_U),p.spatialReference,originGraphicVisualElementUtils_U,p.renderCoordsHelper.spatialReference)?(L.heightManifoldTarget=originGraphicVisualElementUtils_U,L.attached=!0):L.attached=!1;const g=R.grabbingState&GrabbingState_N.XY?h.visualElements.laserlineAlphaMultiplier:1;g!==B&&(B=g,h.visualElements.pointGraphics.shadowStyle.apply(S,g));const v=o&&n.displaying&&!i;S.attached=v,j.attached=v};a.push((0,reactiveUtils.YP)((()=>[n.displaying,n.isDraped]),I),n.on("changed",I)),e.forEachManipulator((e=>{a.push(e.events.on("grab-changed",I))})),a.push((0,handleUtils.ed)(S)),a.push((0,handleUtils.ed)(j)),a.push((0,handleUtils.ed)(L)),I()}(t,o,a,r),a.push(n.trackGraphicState(o)),{visualElement:r,remove(){(0,handleUtils.AL)(a).remove()}}}function originGraphicVisualElementUtils_P(e){const t=e.geometry;return null==t?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const originGraphicVisualElementUtils_U=(0,vec3f64.c)(),originGraphicVisualElementUtils_D=(0,aaBoundingBox.Ue)();function visualElementUtils_i(i){switch(i.graphic.geometry.type){case"point":case"mesh":return originGraphicVisualElementUtils_A(i);case"polygon":case"polyline":return lineGraphicVisualElementUtils_w(i);default:return null}}const config_o=Math.ceil(70/3*2),config_x=5*Math.PI/12,config_b=1*Math.PI/3;var Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js");class Manipulation_t{constructor(){this._available=!0}set location(a){this._forEachManipulator3D((t=>t.location=a))}set elevationAlignedLocation(a){this._forEachManipulator3D((t=>t.elevationAlignedLocation=a))}set elevationInfo(a){this._forEachManipulator3D((t=>t.elevationInfo=a))}get renderLocation(){let a;return this._forEachManipulator3D((t=>{a||(a=t.renderLocation)})),a}get available(){return this._available}set available(a){this._available=a,this._forEachManipulator3D((t=>t.available=a))}get hovering(){return this.someManipulator((a=>a.hovering))}get grabbing(){return this.someManipulator((a=>a.grabbing))}get dragging(){return this.someManipulator((a=>a.dragging))}hasManipulator(a){return this.someManipulator((t=>t===a))}someManipulator(a){let t=!1;return this.forEachManipulator((i=>{!t&&a(i)&&(t=!0)})),t}_forEachManipulator3D(t){this.forEachManipulator(((i,o)=>{i instanceof Manipulator3D_$&&t(i,o)}))}}var dragEventPipeline3D_G,vector=__webpack_require__("./node_modules/@arcgis/core/geometry/support/vector.js"),dragEventPipeline=(__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Intersector.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/IntersectorInterfaces.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/verticalOffsetUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/interactive/dragEventPipeline.js"));function dragEventPipeline3D_H(e,n){return dragEventPipeline3D_O(e,(()=>n))}function dragEventPipeline3D_O(r,t){const o=(0,vec3f64.c)(),l=(0,vec3f64.c)();let s=!1;return c=>{const u=t(c);if("start"===c.action){const t=(0,screenUtils.md)(c.screenStart,(0,screenUtils.c$)(vectorStacks.qW.get())),l=ray_i(r.state.camera,t,B);null!=l&&(s=(0,plane.BR)(u,l,o))}if(!s)return null;const i=(0,screenUtils.md)(c.screenEnd,(0,screenUtils.c$)(vectorStacks.qW.get())),a=ray_i(r.state.camera,i,B);return null==a?null:(0,plane.BR)(u,a,l)?{...c,renderStart:o,renderEnd:l,plane:u,ray:a}:null}}function dragEventPipeline3D_T(e,n,r,t=null,o=null){return function dragEventPipeline3D_C(e,n,t=0,o=null,l=null){let s=null;return c=>{if("start"===c.action&&(s=e.sceneIntersectionHelper.intersectElevationFromScreen((0,screenUtils.s1)(c.screenStart.x,c.screenStart.y),n,t,l),null!=s&&null!=o&&!(0,geometry_projection.projectPoint)(s,s,o)))return null;if(null==s)return null;const u=e.sceneIntersectionHelper.intersectElevationFromScreen((0,screenUtils.s1)(c.screenEnd.x,c.screenEnd.y),n,t,l);return null==u||null!=o&&!(0,geometry_projection.projectPoint)(u,u,o)?null:{...c,mapStart:s,mapEnd:u}}}(e,r,(0,elevationInfoUtils.Ou)(n,e,r),t,o)}function dragEventPipeline3D_D(e,n,r,t=null,o=null){return dragEventPipeline3D_T(e,r,(0,elevationInfoUtils.RL)(n),t,o)}function dragEventPipeline3D_P(e,n,r){let t=null;const o=new dragEventPipeline.hM;return o.next(dragEventPipeline3D_H(e,function dragEventPipeline3D_N(e,n){const r=dragEventPipeline3D_q,t=dragEventPipeline3D_z,o=(0,plane.Ue)();e.renderCoordsHelper.worldUpAtPosition(n,r);const c=(0,vec3.f)(o,r,(0,vec3.b)(t,n,e.state.camera.eye));return(0,vec3.f)(c,c,r),(0,plane.Yq)(n,c,o)}(e,n))).next(function dragEventPipeline3D_h(e,n){const r=(0,vec3f64.c)(),l=(0,vec3.l)(n);e.renderCoordsHelper.worldUpAtPosition(n,r);const p=(0,vec3f64.c)(),d=(0,vec3f64.c)(),m=o=>((0,vec3.b)(o,o,n),(0,vector.nF)(r,o,o),"global"===e.viewingMode&&(0,vec3.l)(o)*Math.sign((0,vec3.e)(r,o))<.001-l&&(0,vec3.b)(o,(0,vec3.g)(o,r,.001),n),(0,vec3.a)(o,o,n),o);return e=>(e.renderStart=m((0,vec3.c)(p,e.renderStart)),e.renderEnd=m((0,vec3.c)(d,e.renderEnd)),e)}(e,n)).next(dragEventPipeline3D_k(e,r)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,t=e})),e=>(t=null,o.execute(e),t)}function dragEventPipeline3D_k(e,n){const r=e.renderCoordsHelper;return e=>{const t=r.fromRenderCoords(e.renderStart,n),o=r.fromRenderCoords(e.renderEnd,n);return null!=t&&null!=o?{...e,mapStart:t,mapEnd:o}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(dragEventPipeline3D_G||(dragEventPipeline3D_G={}));const dragEventPipeline3D_q=(0,vec3f64.c)(),dragEventPipeline3D_z=(0,vec3f64.c)(),B=(0,ray.Ue)();function moveUtils_e(e,a,r,c){const i=e.graphic,s=(t,n)=>a({action:t,graphic:i,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY});return r(((e,a,r)=>(a.next((t=>("start"===t.action&&s("start",t),t))).next((0,dragEventPipeline.a9)(i,c)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&s("update",t);break;case"end":s("end",t)}return t})),{steps:a,cancel:r=r.next((0,dragEventPipeline.bD)(i)).next((t=>(s("end",{screenDeltaX:0,screenDeltaY:0}),t)))})))}function moveUtils_a(t){if(null==t||"polyline"!==t.type&&"polygon"!==t.type)return 0;const n=("polyline"===t.type?t.paths:t.rings)[0];if(!n||n.length<2)return 0;const e=n[0],a=n[1];return Math.atan2(a[1]-e[1],a[0]-e[0])}function moveUtils_r(t){if(null==t||null==t.axis)return 1;const{mapStart:n,mapEnd:e,axis:a}=t,r=[e.x-n.x,e.y-n.y];return r[0]*a[0]+r[1]*a[1]>0?1:-1}class MoveXYAxisManipulation_q extends Manipulation_t{constructor(t){super(),this._handles=new Handles.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new Evented.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t)}destroy(){this._handles=(0,maybe.SC)(this._handles),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:a}of this._arrowManipulatorInfos)t(a,ManipulatorType_A.TRANSLATE_XY)}createGraphicDragPipeline(t,a,r){const e=a.graphic,i=(0,elevationInfoUtils.RL)(e),o=e.geometry.spatialReference;return moveUtils_e(a,r,(a=>this.createDragPipeline(((r,e,i,o,s)=>(({steps:e,cancel:i}=t(r,e,i,o,s)),a(r,e,i))),i,o,e)),this._view.state.viewingMode)}createDragPipeline(t,a,r,i){return(0,handleUtils.AL)(this._arrowManipulatorInfos.map((({manipulator:e},o)=>(0,dragEventPipeline.Xd)(e,((e,s,n,l,p)=>{const u=s.next((t=>({...t,manipulatorType:ManipulatorType_A.TRANSLATE_XY}))).next((0,dragEventPipeline.kY)(this._view,e.elevationAlignedLocation)).next(dragEventPipeline3D_T(this._view,e.elevationAlignedLocation,a,r,i)).next((0,dragEventPipeline.M2)(e.location,this.angle+(o+1)*Math.PI*.5)).next((0,dragEventPipeline.zh)());t(e,u,n,l,p)})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:a},r){const e=this._radius/70,i=54*e,l=i*Math.sqrt(3)/2,p=(0,GeometryUtil.DA)(this._opaqueMaterial,l,i/2,i/2,.02);(0,GeometryUtil.mx)(p,(0,mat4.f)(vectorStacks.MP.get(),(0,vec3.s)(vectorStacks.WM.get(),0,-l/3,0))),t.renderObjects=[new RenderObject_e(p,interactive_interfaces.Q9.Focused),new RenderObject_e(p.instantiate({material:this._transparentMaterial}),interactive_interfaces.Q9.Unfocused)],t.radius=l/3*2*1.2;const u=(0,mat4.b)(vectorStacks.MP.get(),r*Math.PI/2),m=(0,mat4.f)(vectorStacks.MP.get(),(0,vec3.s)(vectorStacks.WM.get(),0,100*e,0));(0,mat4.m)(a,u,m)}_createManipulators(){for(let t=0;t<4;t++){const a=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(a)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,a=(0,mat4.d)(vectorStacks.MP.get(),t,(0,vec3f64.f)(0,0,1));if(null==a)return;const r=(0,mat4.E)(vectorStacks.MP.get(),(0,vec3.s)(vectorStacks.WM.get(),this.displayScale,this.displayScale,this.displayScale)),e=(0,mat4.m)(vectorStacks.MP.get(),r,a);for(const i of this._arrowManipulatorInfos){const t=(0,mat4.m)(vectorStacks.MP.get(),e,i.transform);i.manipulator.modelTransform=t}}_createArrowManipulator(t){const a=new Manipulator3D_$({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,vec3f64.f)(0,0,1)}}),r={manipulator:a,transform:(0,mat4f64.c)()};return this._updateArrowManipulator(r,t),this._handles.add(a.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),r}_createMaterial(a=1){const r=settings_P(this._view),e=Color.Z.toUnitRGBA(r.colors.accent);return e[3]*=a,new ColorMaterial.E({color:e,transparent:1!==a,cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}class SnapToScene_e{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent&&null!=this._next){const n=this._lastDragEvent.mapEnd,e=this._snap(this._lastDragEvent.screenEnd);if(null!=e){const s={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?e:n,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(s)}}this._enabled=t}_snap(n){const e=null!=this._view?this._view.toMap(n,{exclude:[]}):null;return null!=e&&null!=this._view&&(e.z=(0,elevationInfoUtils.Ou)(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){this._view=t,this._elevationInfo=e,this._lastDragEvent=null;const s=new dragEventPipeline.hM;return this._next=s,[t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const n=this._snap(t.screenEnd);return null!=n?{action:t.action,mapStart:t.mapStart,mapEnd:n,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}},s]}}class MoveXYDiscManipulation_A extends Manipulation_t{constructor(t){super(),this._snapToScene=new SnapToScene_e,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,ManipulatorType_A.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,r=(0,elevationInfoUtils.RL)(a),s=a.geometry.spatialReference;return moveUtils_e(e,i,(e=>this.createDragPipeline(((i,a,r,s,o)=>(({steps:a,cancel:r}=t(i,a,r,s,o)),e(i,a,r))),r,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const r=this._view;return(0,dragEventPipeline.Xd)(this._manipulator,((s,o,n,l,p)=>{const m=o.next((0,dragEventPipeline.kY)(r,s.elevationAlignedLocation)).next(dragEventPipeline3D_T(r,s.elevationAlignedLocation,e,i,a)).next(...this._snapToScene.createDragEventPipelineStep(r,e)).next((t=>({...t,manipulatorType:ManipulatorType_A.TRANSLATE_XY}))).next((0,dragEventPipeline.zh)());t(s,m,n,l,p)}))}_updateManipulatorTransform(){const t=(0,mat4.E)(vectorStacks.MP.get(),(0,vec3.s)(vectorStacks.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new Manipulator3D_$({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,vec3f64.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=(0,GeometryUtil.nb)(this._discMaterial,.02,1,128,(0,vec3f64.f)(0,0,1),(0,vec3f64.f)(0,0,0));t.transformation=(0,mat4.E)((0,mat4f64.c)(),(0,vec3f64.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new RenderObject_e(t,interactive_interfaces.Q9.Focused),new RenderObject_e(t.instantiate({material:this._discMaterialTransparent}),interactive_interfaces.Q9.Unfocused)],this._manipulator.radius=this._radius/70*80}_createMaterial(e=1){const i=settings_P(this._view),a=Color.Z.toUnitRGBA(i.colors.accent);return a[3]*=e,new ColorMaterial.E({color:a,transparent:1!==e,cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class MoveZManipulation_R extends Manipulation_t{constructor(t){super(),this._radius=70,this.events=new Evented.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._manipulator.applyObjectTransform=MoveZManipulation_S,this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,ManipulatorType_A.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const r=e.graphic.geometry.spatialReference;return moveUtils_e(e,i,(e=>this.createDragPipeline(((i,r,a,o,s)=>(({steps:r,cancel:a}=t(i,r,a,o,s)),e(i,r,a))),r)),this._view.state.viewingMode)}createDragPipeline(t,e){const i=this._view;return(0,dragEventPipeline.Xd)(this._manipulator,((r,a,o,s,n)=>{const l=a.next((t=>({...t,manipulatorType:ManipulatorType_A.TRANSLATE_Z}))).next(dragEventPipeline3D_P(i,r.renderLocation,e)).next((0,dragEventPipeline.zh)());t(r,l,o,s,n)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const e=this._radius/70,i=settings_P(this._view),n=i.zManipulator.height*e,l=i.zManipulator.coneHeight*e,p=i.zManipulator.coneWidth*e,u=i.zManipulator.width*e,c=[(0,vec3f64.f)(0,0,0),(0,vec3f64.f)(0,0,n)],m=[(0,vec3f64.f)(0,0,0),(0,vec3f64.f)(0,0,n+l)],f=(t=>{const e=(0,mat4f64.c)();if((0,mat4.w)(e,e,[0,0,n]),(0,mat4.r)(e,e,Math.PI/2),t){const i=1+2*t/p;(0,mat4.k)(e,e,[i,i,i])}return e})(0),w=(e,r)=>{const a=(0,colorUtils._j)(i.zManipulator.color,r);return a.a*=e,Color.Z.toUnitRGBA(a)},M=manipulatorUtils_F(w(1,.25),Material.yD.Occlude),y=manipulatorUtils_F(w(1,0),Material.yD.Occlude),b=manipulatorUtils_F(w(.7,0),i.zManipulator.renderOccluded),P=manipulatorUtils_F(w(.85,0),i.zManipulator.renderOccluded),T=(0,GeometryUtil.PD)(M,c,u/2,16,!1),R=(0,GeometryUtil.QL)(M,l,p/2,16,!1);R.transformation=f,this._manipulator.renderObjects=[new RenderObject_e(R,interactive_interfaces.Q9.Unfocused),new RenderObject_e(T,interactive_interfaces.Q9.Unfocused),new RenderObject_e(R.instantiate({material:y}),interactive_interfaces.Q9.Focused),new RenderObject_e(T.instantiate({material:y}),interactive_interfaces.Q9.Focused),new RenderObject_e(R.instantiate({material:b}),interactive_interfaces.Q9.Unfocused),new RenderObject_e(T.instantiate({material:b}),interactive_interfaces.Q9.Unfocused),new RenderObject_e(R.instantiate({material:P}),interactive_interfaces.Q9.Focused),new RenderObject_e(T.instantiate({material:P}),interactive_interfaces.Q9.Focused)],this._manipulator.radius=u/2+2,this._manipulator.collisionType={type:"line",paths:[m]}}_createManipulator(){const t=this._view,e=settings_P(t),r=new Manipulator3D_$({view:t,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});r.applyObjectTransform=r=>{const a=t.state.camera,o=MoveZManipulation_x;t.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,o);const s=(0,vec3.j)(a.eye,o),d=a.computeRenderPixelSizeAtDist(s),h=(0,vec3.b)(MoveZManipulation_D,o,a.eye);(0,vec3.n)(h,h);const f=MoveZManipulation_k;t.renderCoordsHelper.worldUpAtPosition(MoveZManipulation_x,f);const _=Math.abs((0,vec3.e)(h,f)),j=(0,vec3.f)(MoveZManipulation_D,h,f),w=(0,vec3.f)(MoveZManipulation_D,j,f),M=(0,mathUtils.uZ)(_,.01,1),v=1-Math.sqrt(1-M*M)/M/a.fullWidth,y=this._radius/70,b=e.zManipulator.width*y;(0,vec3.g)(w,(0,vec3.n)(w,w),(1/v-1)*s+d*b),r[12]-=MoveZManipulation_D[0],r[13]-=MoveZManipulation_D[1],r[14]-=MoveZManipulation_D[2]},this._manipulator=r,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const MoveZManipulation_x=(0,vec3f64.c)(),MoveZManipulation_D=(0,vec3f64.c)(),MoveZManipulation_k=(0,vec3f64.c)(),MoveZManipulation_S=()=>{};class MoveManipulation_u extends Manipulation_t{constructor(a){super(),this._handles=new Handles.Z,this._interactive=!0;const{tool:t,view:n,snapToScene:e,radius:s}=a;this._view=n,this.xyManipulation=new MoveXYDiscManipulation_A({tool:t,view:n,snapToScene:e,radius:s}),this.xyAxisManipulation=new MoveXYAxisManipulation_q({tool:t,view:n,radius:s}),this.zManipulation=new MoveZManipulation_R({tool:t,view:n,radius:s}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((i=>this._handles.add(i.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(i,t,n){return(0,handleUtils.AL)([this.xyManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.XY,a,t,n,e,s)),t,n),this.xyAxisManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.XY_AXIS,a,t,n,e,s)),t,n),this.zManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.Z,a,t,n,e,s)),t,n)])}createDragPipeline(i,t,n,e){return(0,handleUtils.AL)([this.xyManipulation.createDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.XY,a,t,n,e,s)),t,n,e),this.xyAxisManipulation.createDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.XY_AXIS,a,t,n,e,s)),t,n,e),this.zManipulation.createDragPipeline(((a,t,n,e,s)=>i(MoveManipulation_c.Z,a,t,n,e,s)),n)])}set snapToScene(i){this.xyManipulation.snapToScene=i}set angle(i){this.xyAxisManipulation.angle=i}set interactive(i){this._interactive!==i&&(this._interactive=i,this._updateManipulatorInteractivity())}set radius(i){this.xyAxisManipulation.radius=i,this.xyManipulation.radius=i,this.zManipulation.radius=i}set displayScale(i){this.xyManipulation.displayScale=i,this.xyAxisManipulation.displayScale=i}forEachManipulator(i){this.xyManipulation.forEachManipulator((a=>i(a,ManipulatorType_A.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((a=>i(a,ManipulatorType_A.TRANSLATE_XY))),this.zManipulation.forEachManipulator((a=>i(a,ManipulatorType_A.TRANSLATE_Z)))}get _xyAxisVisible(){const i=this.xyManipulation.someManipulator((i=>i.focused))||this.xyAxisManipulation.someManipulator((i=>i.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||i}_autoHideXYAxis(){const i=this.xyAxisManipulation,a=this.xyManipulation;if((0,has.Z)("esri-mobile"))return;const n=[];a.forEachManipulator((i=>n.push(i))),i.forEachManipulator((i=>n.push(i)));const e=()=>{const a=[];this._xyAxisVisible||i.forEachManipulator((i=>a.push(i.disableDisplay()))),this._handles.remove(MoveManipulation_h),this._handles.add(a,MoveManipulation_h)};for(const t of n)this._handles.add(t.events.on("focus-changed",e));this._view.inputManager&&this._handles.add((0,reactiveUtils.gx)((()=>this._view.inputManager?.latestPointerType),e)),e()}_updateManipulatorInteractivity(){const i=this.grabbing;this.forEachManipulator((a=>{a.interactive=!i&&this._interactive||a.grabbing}))}static radiusForSymbol(i){const a=null!=i&&"point-3d"===i.type&&i.symbolLayers;return a&&a.length>0&&a.some((i=>"icon"===i.type))?config_o:70}}const MoveManipulation_h="disable-xy-axis-display";var MoveManipulation_c;!function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z"}(MoveManipulation_c||(MoveManipulation_c={}));var GraphicManipulator=__webpack_require__("./node_modules/@arcgis/core/views/interactive/GraphicManipulator.js");class MoveXYGraphicManipulation_l extends Manipulation_t{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,ManipulatorType_A.TRANSLATE_XY)}createGraphicDragPipeline(t){return moveUtils_e(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(i){const e=this._view,r=this._graphicState.graphic,n=null!=r.geometry?r.geometry.spatialReference:null;return(0,dragEventPipeline.Xd)(this._manipulator,((a,l,p,h,c)=>{const u=l.next(function dragEventPipeline3D_M(e,n,r,t){const o=n.toMap(e.screenStart,{include:[r]});return null!=o?dragEventPipeline3D_D(n,r,o,t):null}(c,e,r,n)).next((0,dragEventPipeline.AN)()).next((0,dragEventPipeline.zh)());i(a,u,p,h,c)}))}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new GraphicManipulator.L({graphic:i,view:t,selectable:!0,cursor:"move"})}}var isSupportedGraphic=__webpack_require__("./node_modules/@arcgis/core/views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic.js"),InteractiveToolBase=__webpack_require__("./node_modules/@arcgis/core/views/interactive/InteractiveToolBase.js"),EditGeometryOperations=__webpack_require__("./node_modules/@arcgis/core/views/interactive/editGeometry/EditGeometryOperations.js"),SketchTooltipOptions=__webpack_require__("./node_modules/@arcgis/core/views/interactive/sketch/SketchTooltipOptions.js"),SnappingContext=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/SnappingContext.js"),SnappingDragPipelineStep=__webpack_require__("./node_modules/@arcgis/core/views/interactive/snapping/SnappingDragPipelineStep.js"),Tooltip=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/Tooltip.js"),TranslateTooltipInfos=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/TranslateTooltipInfos.js"),euclideanLengthMeasurementUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/euclideanLengthMeasurementUtils.js");class GraphicMoveTool_C{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class GraphicMoveTool_V{constructor(t,i,e){this.dx=t,this.dy=i,this.allGraphics=e,this.type="graphic-move"}}class GraphicMoveTool_L{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let GraphicMoveTool_q=class extends((0,HandleOwner.p)(Evented.Z.EventedMixin(InteractiveToolBase.m))){constructor(t){super(t),this._infos=new Map,this.graphics=new Collection.Z,this.enableZ=!0,this.tooltipOptions=new SketchTooltipOptions.Z,this.type="move-3d",this._moveManipulation=null,this._tooltip=null}initialize(){const{view:t}=this;this.addHandles([this.graphics.on("change",(t=>{t.removed.forEach((t=>this.removeHandles(t))),this._updateGraphicInfos(t),this._setupFastTransformUpdates(t.added),this._refreshManipulators()})),(0,reactiveUtils.YP)((()=>this.tooltipOptions.enabled),(i=>{this._tooltip=i?new Tooltip.u({view:t}):(0,maybe.SC)(this._tooltip)}),reactiveUtils.tX)]);const i=this.graphics.toArray();this._updateGraphicInfos({added:i,removed:[]}),this._setupFastTransformUpdates(i),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,maybe.SC)(this._tooltip),this._moveManipulation=(0,maybe.SC)(this._moveManipulation),this.removeAllHandles(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_updateGraphicInfos({added:t,removed:i}){for(const e of t){if((0,isSupportedGraphic.P)(e)!==isSupportedGraphicUtils.e.SUPPORTED)continue;const t=new GraphicMoveTool_B(e),i=this.view.trackGraphicState(t.state);this._infos.set(t.graphic,{info:t,handle:i})}for(const e of i)this._infos.get(e)?.handle.remove(),this._infos.delete(e)}_setupFastTransformUpdates(t){for(const i of t){const{info:t}=this._infos.get(i);this.addHandles(meshFastUpdateUtils_o(t.state),i)}}_refreshManipulators(){if(this.removeHandles("manipulators"),this._moveManipulation=(0,maybe.SC)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const t=Array.from(this._infos.values(),(({info:t})=>t));this._createManipulators(t),this._createVisualElements(t),this._updateMoveManipulation(t)}_createManipulators(t){for(const i of t){const e=i.state;i.manipulationXY=new MoveXYGraphicManipulation_l({tool:this,view:this.view,graphicState:e}),i.manipulationXY.forEachManipulator((t=>this.addHandles([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(({action:t})=>{const{tooltipOptions:i,_tooltip:e}=this;null!=e&&("start"===t?e.info=new TranslateTooltipInfos.$E({tooltipOptions:i}):e.clear())}))],"manipulators"))),this.addHandles(i.manipulationXY.createDragPipeline(((i,e,o,a)=>this._buildDragEventPipeline(t,MoveManipulation_c.XY,i,e,o,a))),"manipulators")}this._createMoveManipulation(t)}_createMoveManipulation(t){const i=new MoveManipulation_u({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?MoveManipulation_u.radiusForSymbol(t[0].graphic.symbol):70});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((t=>{this.addHandles(t.events.on("immediate-click",(e=>{i.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...e,graphic:this.graphics.at(0)}),e.stopPropagation()})),"manipulators")}));const e=i=>e=>{this.addHandles(e.events.on("focus-changed",(({action:e})=>{const o=this._tooltip;null!=o&&("focus"===e?this._updateMoveTooltip(t,i):o.clear())})),"manipulators")};this._moveManipulation.xyManipulation.forEachManipulator(e(MoveManipulation_c.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(e(MoveManipulation_c.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(e(MoveManipulation_c.Z));const o=()=>this._updateMoveManipulation(t);for(const n of t)this.addHandles([n.state.on("changed",o),(0,reactiveUtils.YP)((()=>n.state.displaying),o)],"manipulators");const a=t[t.length-1];this.addHandles(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a))),"manipulators"),this.addHandles(i.createDragPipeline(((i,e,o,a,n)=>this._buildDragEventPipeline(t,i,e,o,a,n)),(0,elevationInfoUtils.RL)(a.graphic),a.graphic.geometry.spatialReference,a.graphic),"manipulators"),this._updateMoveManipulationAngle(a)}_createVisualElements(t){for(const i of t){const e=i.graphic,o=visualElementUtils_i({view:this.view,graphic:e,forEachManipulator:t=>{i.manipulationXY?.forEachManipulator(t),this._moveManipulation?.forEachManipulator(t)},onManipulatorsChanged:()=>(0,handleUtils.kB)()});null!=o&&(i.geometryRepresentation=o.visualElement,i.geometryRepresentation instanceof OutlineVisualElement_j&&this.addHandles([i.geometryRepresentation.events.on("attachment-origin-changed",(()=>{i.state.isDraped||this._updateMoveManipulation(t)})),(0,reactiveUtils.YP)((()=>i.state.isDraped),(()=>this._updateMoveManipulation(t)))],"manipulators"),this.addHandles(o,"manipulators"))}}_updateMoveManipulationAngle(t){this._moveManipulation&&(this._moveManipulation.angle=moveUtils_a(t.graphic.geometry))}_updateMoveManipulation(t){const i=(0,dehydratedFeatures.Tx)(0,0,0,this.view.spatialReference);let e=0,o=!1;const a=this._moveManipulation;if(a){for(const a of t){if(!a.state.displaying)continue;const t=a.state.graphic;this.enableZ&&manipulatorUtils_n(t)&&(o=!0);const n=a.geometryRepresentation instanceof OutlineVisualElement_j&&!a.state.isDraped?a.geometryRepresentation.attachmentOrigin:manipulatorUtils_x(this.view,t);if(null!=n){const{x:t,y:o,z:a}=n;i.x+=t,i.y+=o,a&&(i.z??=0,i.z+=a),e++}}e>0?(i.x/=e,i.y/=e,i.z??=0,i.z/=e,a.location=i,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=o):a.available=!1}}_buildDragEventPipeline(t,i,e,o,a,n){const s=[],r=[];let p=null,l=null;const c=()=>{for(const t of s)t.dragging=!1;s.length=0,r.length=0,p=null,l=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===t.length&&i===MoveManipulation_c.XY){const i=t[0].graphic;({steps:o,cancel:a}=this._buildSnappingPipelineSteps(i,(0,elevationInfoUtils.RL)(i),o,a,n))}return a=a.next((t=>l?.(t))).next((()=>(this.emit("graphic-move-stop",new GraphicMoveTool_L(r)),this.destroyed||c(),null))),{steps:o=o.next((i=>{if("start"===i.action){s.length=0,r.length=0;for(const i of t)i.dragging||!i.manipulationXY?.hasManipulator(e)&&i.manipulationXY?.grabbing||(s.push(i),r.push(i.graphic),i.dragging=!0);if(0!==r.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),p=(0,dragEventPipeline.oq)(r,this.view.state.viewingMode),l=(0,dragEventPipeline.QY)(r),this.emit("graphic-move-start",new GraphicMoveTool_C(r)),this.destroyed))return null}return 0!==r.length?i:null})).next((t=>p?.(t))).next((e=>(this._updateMoveTooltip(t,i,e),e))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const i=this.view.toScreen(t.mapStart),e=this.view.toScreen(t.mapEnd),o=e.x-i.x,a=e.y-i.y;if(this.emit("graphic-move",new GraphicMoveTool_V(o,a,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new GraphicMoveTool_L(r)),this.destroyed)return null;c()}return null})),cancel:a}}_updateMoveTooltip(t,i,e){const{tooltipOptions:o,_tooltip:a}=this;if(null==a)return;a.clear();const n=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(i){case MoveManipulation_c.XY:a.info=new TranslateTooltipInfos.$E({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>(0,automaticLengthMeasurementUtils.GQ)(t,i,n)));break;case MoveManipulation_c.XY_AXIS:a.info=new TranslateTooltipInfos.in({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const o=(0,automaticLengthMeasurementUtils.GQ)(t,i,n);return(0,quantityUtils.bA)(o,moveUtils_r(e))}));break;case MoveManipulation_c.Z:a.info=new TranslateTooltipInfos.QW({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,euclideanLengthMeasurementUtils._e)}}_updateMoveTooltipDistance(t,i,e){if(null!=i&&"end"!==i.action){const{mapStart:o,mapEnd:a}=i,n=e(o,a);t.distance=null!=n?n:quantityUtils.yP}}_buildSnappingPipelineSteps(t,i,e,o,a){const n=t.geometry;if(null==n||"point"!==n.type&&"mesh"!==n.type)return{steps:e,cancel:o};const s=("point"===n.type?n:n.anchor).clone(),r=new SnappingContext.N({elevationInfo:i,pointer:a,editGeometryOperations:EditGeometryOperations.c.fromGeometry(s,this.view.state.viewingMode),visualizer:new SnappingVisualizer3D_O,excludeFeature:t}),p=this.snappingManager,{snappingStep:l,cancelSnapping:c}=(0,SnappingDragPipelineStep.W)({snappingContext:r,snappingManager:p,updatingHandles:this.updatingHandles});return o=o.next(c),{steps:e=e.next((i=>(s.z=(0,elevationInfoUtils.vQ)(this.view,s,(0,elevationInfoUtils.RL)(t),{mode:"absolute-height",offset:0}),{...i,snapOrigin:r.coordinateHelper.pointToVector(s)}))).next(...l),cancel:o}}get test(){return{tooltip:this._tooltip}}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicMoveTool_q.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicMoveTool_q.prototype,"graphics",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicMoveTool_q.prototype,"enableZ",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,type:SketchTooltipOptions.Z})],GraphicMoveTool_q.prototype,"tooltipOptions",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],GraphicMoveTool_q.prototype,"snappingManager",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicMoveTool_q.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicMoveTool_q.prototype,"updating",null),GraphicMoveTool_q=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],GraphicMoveTool_q);class GraphicMoveTool_B{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new GraphicState_e({graphic:t})}get graphic(){return this.state.graphic}}var reshapeGraphic_isSupportedGraphic=__webpack_require__("./node_modules/@arcgis/core/views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),Polyline=__webpack_require__("./node_modules/@arcgis/core/geometry/Polyline.js"),support_utils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/utils.js"),OffsetEdgeVertex=__webpack_require__("./node_modules/@arcgis/core/views/interactive/editGeometry/operations/OffsetEdgeVertex.js");function edgeOffsetUtils_a(e,r,o){const n="on-the-ground"===o.mode?OffsetEdgeVertex.v.XY:OffsetEdgeVertex.v.XYZ;return new OffsetEdgeVertex.A(e,n,r,0)}function edgeOffsetUtils_m(e,r,n){const t=(0,vec3f64.c)();if(!e.renderCoordsHelper.toRenderCoords(r,t))return null;const s=edgeOffsetUtils_j(e,r,(0,plane.mJ)(n.plane)),l=edgeOffsetUtils_j(e,r,n.edgeDirection);if(null==s||null==l)return null;const f=(0,vec3.f)((0,vec3f64.c)(),s,l);return(0,plane.Yq)(t,f,(0,plane.Ue)())}function edgeOffsetUtils_j(e,r,o){const t=(0,dehydratedFeatures.Tx)(r.x+o[0],r.y+o[1],r.z+o[2],r.spatialReference),s=(0,vec3f64.c)(),u=(0,vec3f64.c)();return e.renderCoordsHelper.toRenderCoords(r,s)&&e.renderCoordsHelper.toRenderCoords(t,u)?(0,vec3.r)(u,s,u):null}var IViewEvents=__webpack_require__("./node_modules/@arcgis/core/views/input/IViewEvents.js"),editGeometry_interfaces=__webpack_require__("./node_modules/@arcgis/core/views/interactive/editGeometry/interfaces.js"),SketchTooltipInfo=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/SketchTooltipInfo.js");let ReshapeTooltipInfos_p=class extends SketchTooltipInfo.h{constructor(o){super(o),this.type="reshape-edge-offset",this.distance=quantityUtils.yP,this.area=null,this.totalLength=null}};(0,tslib_es6._)([(0,property.Cb)()],ReshapeTooltipInfos_p.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],ReshapeTooltipInfos_p.prototype,"distance",void 0),(0,tslib_es6._)([(0,property.Cb)()],ReshapeTooltipInfos_p.prototype,"area",void 0),(0,tslib_es6._)([(0,property.Cb)()],ReshapeTooltipInfos_p.prototype,"totalLength",void 0),ReshapeTooltipInfos_p=(0,tslib_es6._)([(0,subclass.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],ReshapeTooltipInfos_p);var automaticAreaMeasurementUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/automaticAreaMeasurementUtils.js"),geodesicLengthMeasurementUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/geodesicLengthMeasurementUtils.js"),SpatialReference=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js");let Ue=class extends(Evented.Z.EventedMixin(HandleOwner.r)){constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new Handles.Z,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Xe.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null;const t=settings_P(e.tool.view).manipulators,i=t.vertex;this._vertexManipulatorMaterial=manipulatorUtils_F((0,colorUtils.O)(i.color),i.renderOccluded),this._vertexManipulatorOutlineMaterial=manipulatorUtils_k((0,colorUtils.O)(i.outlineColor),i.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=manipulatorUtils_k((0,colorUtils.O)(i.hoverOutlineColor),i.renderOccluded);const a=t.edge;this._edgeManipulatorMaterial=manipulatorUtils_F((0,colorUtils.O)(a.color),a.renderOccluded),this._edgeManipulatorOutlineMaterial=manipulatorUtils_k((0,colorUtils.O)(a.outlineColor),a.renderOccluded);const o=t.edgeOffset;this._edgeOffsetManipulatorMaterial=manipulatorUtils_F((0,colorUtils.O)(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=manipulatorUtils_F((0,colorUtils.O)(o.hoverColor),o.renderOccluded,!1);const r=t.selected;this._selectedManipulatorMaterial=manipulatorUtils_F((0,colorUtils.O)(r.color),r.renderOccluded),this._selectedManipulatorOutlineMaterial=manipulatorUtils_k((0,colorUtils.O)(r.outlineColor),r.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=manipulatorUtils_k((0,colorUtils.O)(r.hoverOutlineColor),r.renderOccluded)}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new GraphicState_e({graphic:e});this._tooltip=new Tooltip.u({view:t}),this.addHandles([(0,reactiveUtils.YP)((()=>i.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,reactiveUtils.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:i})=>{null!=e&&(e.visible=t,e.edgeDistance=i?"far":"default")}),reactiveUtils.nn),(0,reactiveUtils.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),reactiveUtils.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,maybe.SC)(this._segmentLabels),this._tooltip=(0,maybe.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,maybe.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,maybe.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._editGeometryOperations)return;const t=(0,elevationInfoUtils.RL)(this.graphic);for(const i of this._editGeometryOperations.data.components){const a=e?.byComponentIndex.get(i.index);for(const e of i.vertices){const i=a?.has(e.index);this._createVertexOrEdgeManipulator(e,t,i)}for(const e of i.edges)this._createVertexOrEdgeManipulator(e,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const e=this._editGeometryOperations.redo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const e=this._editGeometryOperations.undo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if(null!=e&&null!=this.inputGeometry&&(0,coordsUtils.Pt)(e,this.inputGeometry))for(const a of this._manipulatorInfos)if("vertex"===a.type&&a.manipulator.selected){const{index:e,component:{index:i}}=a.handle,{byComponentIndex:n}=t,o=n.get(i)||new Set;o.add(e),n.set(i,o)}if(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,maybe.SC)(this._editGeometryOperations),this._segmentLabels=(0,maybe.SC)(this._segmentLabels),null==e)return void(this._recreatingManipulators=!1);const i="mesh"===e.type?e.anchor:e;this._editGeometryOperations=EditGeometryOperations.c.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new SegmentLabels3D_a({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,elevationInfoUtils.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const a=[],n=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),o=e===Ze.SELECTED_OR_ALL&&n;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.grabbing||o&&!r.manipulator.selected||a.push(r),i++);if(0===a.length)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(Xe.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Xe.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Xe.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const n=[];for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected&&!o.manipulator.grabbing||o===e.info)&&n.push(o);this._moveVertices(n,e,editGeometry_interfaces.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Xe.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Xe.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Xe.MOVING:switch(this._reshapeEventState){case Xe.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Xe.RESHAPING:switch(this._reshapeEventState){case Xe.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Xe.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new MoveXYGraphicManipulation_l({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=this._editGeometryOperations.createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(Ze.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(MoveManipulation_c.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=(0,maybe.hw)(e))})),a.next((()=>this._onDragCancel(!0,(()=>e=(0,maybe.hw)(e)))))}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))))}_createMoveManipulation(e){const{graphic:t,handles:i,tool:a,view:n}=this,o=this._graphicState;this._moveManipulation=new MoveManipulation_u({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&manipulatorUtils_n(t),snapToScene:!1,radius:MoveManipulation_u.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>i.add([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const r=e=>t=>{i.add(t.events.on("focus-changed",(({action:t})=>{"focus"===t&&this._tooltipOptions.enabled?this._updateTranslateTooltip(e):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(r(MoveManipulation_c.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(MoveManipulation_c.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(MoveManipulation_c.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const s=t.geometry.spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,n,o,r,s)=>{const{snappingStep:l,cancelSnapping:p}=(0,SnappingDragPipelineStep.W)({predicate:e=>!!e.info,snappingManager:a.snappingManager,snappingContext:new SnappingContext.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:e,pointer:s,excludeFeature:t,visualizer:new SnappingVisualizer3D_O}),updatingHandles:this.updatingHandles,useZ:!1});return r=r.next((e=>(this._onDragCancel(),e))).next(p),{steps:o=o.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===ManipulatorType_A.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,dragEventPipeline.BS)(this.view,e,t)).next(...l).next((0,dragEventPipeline.AN)()).next((e=>this._perGraphicManipulatorDragAction(Ze.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e))),cancel:r}}),e,s,t),(0,reactiveUtils.YP)((()=>o.displaying),(()=>this._updateMoveManipulationPosition()),reactiveUtils.nn),o.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,reactiveUtils.YP)((()=>o.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):i.remove(t)}),reactiveUtils.nn)])}_createVisualElements(){const{graphic:e,view:t}=this,i=visualElementUtils_i({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,ManipulatorType_A.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof OutlineVisualElement_j?i.visualElement:null),null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=(0,elevationInfoUtils.RL)(this.graphic)){const i=settings_P(this.view).manipulators.edgeOffset,a=i.size/2,n=a+i.collisionPadding,r=a/n,s=r*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,GeometryUtil.DA)(this._edgeOffsetManipulatorMaterial,s,r/2,r/2,i.height,i.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,GeometryUtil.DA)(this._edgeOffsetManipulatorMaterial,-s,r/2,r/2,i.height,-i.offset));const l=[new RenderObject_e(this._edgeOffsetManipulatorGeometryInside.instantiate(),interactive_interfaces.Q9.Unfocused),new RenderObject_e(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),interactive_interfaces.Q9.Focused),new RenderObject_e(this._edgeOffsetManipulatorGeometryOutside.instantiate(),interactive_interfaces.Q9.Unfocused),new RenderObject_e(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),interactive_interfaces.Q9.Focused)],p=new Manipulator3D_$({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==t.mode||(0,support_utils.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:n,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:(0,vec3f64.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new Manipulator3D_$({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),d={manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);const u=[];for(const o of[d.handle.leftVertex,d.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(o);null!=e&&u.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d))))}d.locationUpdateHandle=(0,handleUtils.AL)(u),this._manipulatorHandles.add(d.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(h,!0)],p),this._manipulatorHandles.add((0,dragEventPipeline.Xd)(p,this._createEdgeOffsetPipeline(d,t)),p),this._manipulatorHandles.add((0,dragEventPipeline.Xd)(h,((e,i,a,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(d,t)(e,i,a);else if(this.enableMoveGraphic){const n=this.graphic,o=null!=n.geometry?n.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next((0,dragEventPipeline.kY)(this.view,e.elevationAlignedLocation)).next(dragEventPipeline3D_T(this.view,e.elevationAlignedLocation,t,o,n)).next((0,dragEventPipeline.zh)()).next((0,dragEventPipeline.AN)()).next((e=>this._perGraphicManipulatorDragAction(Ze.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(MoveManipulation_c.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),p);const c=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",c),h.events.on("immediate-click",c),p.events.on("focus-changed",(({action:e})=>{const t=this._tooltipOptions;if("focus"===e&&t.enabled){const e=this._tooltip.info=new ReshapeTooltipInfos_p({tooltipOptions:t});this._updateTooltipAreaOrTotalLength(e)}else this._tooltip.clear()}))],p),this._manipulatorInfos.push(d),this.manipulators.add(p),this.manipulators.add(h),this.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,n=()=>{e.visibilityHandle=(0,maybe.hw)(e.visibilityHandle);const n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex),s=null!=n&&null!=r&&function edgeOffsetUtils_C(r,o,n){const c=n.projectToRenderScreen(r,(0,screenUtils.J$)()),u=n.projectToRenderScreen(o,(0,screenUtils.J$)());return null!=c&&null!=u?(0,vec3.p)((0,vec3.b)(c,c,u)):0}(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||s)&&(i.grabbable=!s,a.grabbable=!s,e.visibilityHandle=(0,handleUtils.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",n),a.events.on("focus-changed",n),{remove:()=>{(0,maybe.hw)(e.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],i),n()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._editGeometryOperations.data,i=edgeOffsetUtils_m(this.view,e.manipulator.elevationAlignedLocation,edgeOffsetUtils_a(t,e.handle,e.manipulator.elevationInfo)),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==a||null==n)return;const o=a.manipulator.renderLocation,r=n.manipulator.renderLocation,s=null!=i?function edgeOffsetUtils_h(e,t,s){const i=(0,plane.mJ)(e),d=(0,vec3.r)((0,vec3f64.c)(),t,s),l=(0,vec3.f)((0,vec3f64.c)(),d,i),f=(0,vec3.f)((0,vec3f64.c)(),d,l);return(0,mat4f64.f)(d[0],d[1],d[2],0,l[0],l[1],l[2],0,f[0],f[1],f[2],0,0,0,0,1)}(i,o,r):mat4f64.I;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const l=(0,vec3.l)((0,vec3.b)(Re,o,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,n)=>{this._clearSelection();const{step:o,cleanup:r}=this._initializeEdgeOffset(e,t);a.next((e=>this._trackNumDragging(e))).next((0,dragEventPipeline.kY)(this.view,i.elevationAlignedLocation)).next(o).next(function dragEventPipeline3D_U(e){return dragEventPipeline3D_O(e,(e=>e.plane))}(this.view)).next(dragEventPipeline3D_k(this.view,this._editGeometryOperations.data.spatialReference)).next((0,dragEventPipeline.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&r()})),n.next((()=>{i.metadata.deleting||(r(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t){const{view:i}=this,a=this._editGeometryOperations,n=edgeOffsetUtils_a(a.data.coordinateHelper,e.handle,t),s=a.createUndoGroup(),p=edgeOffsetUtils_m(i,e.manipulator.elevationAlignedLocation,n);if(n.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(n.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}const h=()=>new Polyline.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:a.data.spatialReference}),d=settings_P(i),c=new OutlineVisualElement_j({view:i,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:d.visualElements.lineGraphics.outline.width,color:(0,colorUtils.O)(d.colors.accent),attached:!0});let m;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(e),m=(0,maybe.hw)(m)},_=this.on("undo",g);return m=(0,handleUtils.AL)([(0,handleUtils.ed)(c),(0,reactiveUtils.YP)((()=>this._graphicState.isDraped),(e=>c.isDraped=e)),this._graphicState.on("changed",(()=>c.geometry=h())),s,_]),{step:e=>null==n||null==p?(g(),null):{...e,operation:n,plane:p},cleanup:g}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||null==t.operation)return t;this._updateEventState(Xe.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=t;return(i||a||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return null==t||null==i?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,n=this._tooltip,o=this._tooltipOptions;if(!o.enabled||null==i)return n.clear(),e;let r=n.info;null!=r&&"reshape-edge-offset"===r.type||(r=n.info=new ReshapeTooltipInfos_p({tooltipOptions:o}));const{coordinateHelper:s}=this._editGeometryOperations.data;return r.distance="end"===e.action?quantityUtils.yP:function Ce(e,t,i,a,n){if(e){const e=n.toXYZ(n.pointToVector(i)),o=(0,plane.nF)(a,e,vectorStacks.WM.get()),r=(0,geodesicLengthMeasurementUtils.FB)(o,e,n.spatialReference);if(null!=r)return(0,quantityUtils.yG)(r.value*Math.sign(t),r.unit)}return(0,quantityUtils.yG)(t*(0,unitUtils.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,t,a.plane,s),this._updateTooltipAreaOrTotalLength(r),e}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,a=e.handle.rightVertex.rightEdge?.rightVertex,n=e.handle.rightVertex,o=this._editGeometryOperations.data.coordinateHelper,r=[];if(t&&o.distance(t.pos,i.pos)<Fe){const e=this._getManipulatorInfoFromHandle(i);null!=e&&r.push(e)}if(o.distance(i.pos,n.pos)<Fe||a&&o.distance(a.pos,n.pos)<Fe){const e=this._getManipulatorInfoFromHandle(n);null!=e&&r.push(e)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=(0,elevationInfoUtils.RL)(this.graphic),i=!1){const{view:a}=this,n=settings_P(a);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(n.manipulators.vertex);this._vertexManipulatorGeometry=(0,GeometryUtil.PI)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,GeometryUtil.PI)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(n.manipulators.edge);this._edgeManipulatorGeometry=(0,GeometryUtil.PI)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,GeometryUtil.PI)(this._edgeManipulatorOutlineMaterial,t,16,16)}const{geometry:r}=this.graphic,s=r?.type,p="point"===s||"mesh"===s?[]:[new RenderObject_e(this._vertexManipulatorGeometry.instantiate(),ze.Vertex|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._vertexManipulatorOutlineGeometry.instantiate(),ze.Vertex|interactive_interfaces.Q9.Unfocused|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ze.Vertex|interactive_interfaces.Q9.Focused|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),interactive_interfaces.Q9.Selected),new RenderObject_e(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),interactive_interfaces.Q9.Selected|interactive_interfaces.Q9.Unfocused),new RenderObject_e(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),interactive_interfaces.Q9.Selected|interactive_interfaces.Q9.Focused)];this.enableMidpoints&&p.push(new RenderObject_e(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ze.Edge|interactive_interfaces.Q9.Focused|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ze.Edge|interactive_interfaces.Q9.Focused|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._edgeManipulatorGeometry.instantiate(),ze.Edge|interactive_interfaces.Q9.Unfocused|interactive_interfaces.Q9.Unselected),new RenderObject_e(this._edgeManipulatorOutlineGeometry.instantiate(),ze.Edge|interactive_interfaces.Q9.Unfocused|interactive_interfaces.Q9.Unselected));const h=new Manipulator3D_$({view:a,renderObjects:p,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});h.selected=i,this._setTypeSpecificManipulatorSettings(h,e,t);const d="edge"===e.type?{manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(h),this._updateManipulatorPosition(d),"edge"===d.type){const e=[];for(const t of[d.handle.leftVertex,d.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);null!=i&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(d))))}d.locationUpdateHandle=(0,handleUtils.AL)(e),this._manipulatorHandles.add(d.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);const u=(0,dragEventPipeline.Xd)(h,((e,i,a,n)=>{let o=null;const{snappingStep:r,cancelSnapping:s}=(0,SnappingDragPipelineStep.W)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new SnappingContext.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new SnappingVisualizer3D_O}),updatingHandles:this.updatingHandles,useZ:!1});a=a.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>o=(0,maybe.hw)(o))),t))).next(s),i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=this._editGeometryOperations.createUndoGroup()),"edge"===d.type){const t=this._splitEdgeManipulator(d);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:d,snapOrigin:d.handle.pos}})).next((0,dragEventPipeline.kY)(this.view,e.elevationAlignedLocation)).next(dragEventPipeline3D_D(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next((0,dragEventPipeline.BS)(this.view,t,this.graphic)).next(...r).next((0,dragEventPipeline.AN)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(o=(0,maybe.hw)(o)),this._updateTranslateVertexTooltip(e,MoveManipulation_c.XY,t)}))}));return this._manipulatorHandles.add([u,h.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,d))),h.events.on("select-changed",(()=>{d.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),h.events.on("focus-changed",(({action:e})=>{"focus"===e&&"edge"!==d.type?this._updateTranslateVertexTooltip(h,MoveManipulation_c.XY):this._tooltip.clear()}))],h),this.emit("manipulators-changed"),d}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Xe.NONE:break;case Xe.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(Xe.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){const{graphic:a,view:n}=this,o=settings_P(n);switch(t.type){case"vertex":{e.state=ze.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:n}=o.manipulators.vertex;e.radius=t/2+n,e.elevationInfo=i;const{geometry:r}=a,s=r?.type;e.interactive=null!=s&&"point"!==s&&"mesh"!==s;break}case"edge":{e.state=ze.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:n}=o.manipulators.edge;e.radius=t/2+n,e.elevationInfo="on-the-ground"!==i.mode||(0,support_utils.YW)(a.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i,a="mouse"){if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Xe.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,{geometry:i}=this.graphic,a=i?.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=a&&"point"!==a&&"mesh"!==a,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,arrayUtils.e$)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(null==e)return;const t=this._editGeometryOperations;if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ke),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==a)return;const n=i.manipulator,o=a.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=n.location,a=o.location,r=.5,s=i.x+r*(a.x-i.x),l=i.y+r*(a.y-i.y),p=i.hasZ&&a.hasZ?0:void 0;e.manipulator.location=(0,dehydratedFeatures.Tx)(s,l,p,t.data.spatialReference)}else(0,vec3.h)(Re,n.renderLocation,o.renderLocation,.5),e.manipulator.renderLocation=Re}}_splitEdgeManipulator(e,t=.5){const i=this._editGeometryOperations,a=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,maybe.hw)(e.locationUpdateHandle);const n=(0,elevationInfoUtils.RL)(this.graphic);let o;this.enableEdgeOffset?(this._removeManipulator(e),o=this._createVertexOrEdgeManipulator(a)):(o=e,o.handle=a,o.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(o),this.enableEdgeOffset||this._updateTranslateVertexTooltip(o.manipulator,MoveManipulation_c.XY),this._updateSelection(e.manipulator);const r=this._updateEventState(Xe.RESHAPING),s=i.data.coordinateHelper.vectorToArray(o.handle.pos),p=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:p,vertexIndex:a.index}],added:s}),r&&this._updateEventState(Xe.NONE),o}_updateMoveManipulationPosition(){const e=(0,vec3.s)(Re,0,0,0);let t=0,i=!1,a=null,n=null;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected?(t++,(0,vec3.a)(e,e,o.manipulator.renderLocation),null==a||o.selectedIndex>a.selectedIndex?(n=a,a=o):(null==n||o.selectedIndex>n.selectedIndex)&&(n=o)):i=!0);if(0===t){const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&manipulatorUtils_n(this.graphic),this._moveManipulation.angle=moveUtils_a(this.graphic.geometry),this._moveManipulation.radius=MoveManipulation_u.radiusForSymbol(this.graphic.symbol)}else{const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&manipulatorUtils_n(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let i=0;if(null!=a){const e=a.handle.pos,t=null!=n?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,o=null==n&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;t&&o?this._moveManipulation.xyAxisManipulation.available=!1:t?i=Ne(t,e):o&&(i=Ne(e,o))}this._moveManipulation.angle=i,this._moveManipulation.radius=config_o}0!==t&&i?((0,vec3.g)(e,e,1/t),ke.spatialReference=this._editGeometryOperations.data.spatialReference,ke.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ke),this._moveManipulation.elevationAlignedLocation=ke):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?manipulatorUtils_V(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,i=this._editGeometryOperations;for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=i.removeVertices([a.handle]),n=e.removedVertices?.[0].createdEdge;n&&this._createVertexOrEdgeManipulator(n)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(Xe.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(Xe.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?editGeometry_interfaces.O.NEW_STEP:editGeometry_interfaces.O.ACCUMULATE_STEPS)){const a=this._editGeometryOperations;a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(null==t.operation||null==t.signedDistance)return;const i=this._editGeometryOperations,a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===IViewEvents.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===IViewEvents.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case MoveManipulation_c.XY:this._tooltip.info=new TranslateTooltipInfos.$E({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,t)=>(0,automaticLengthMeasurementUtils.GQ)(e,t,a)));break;case MoveManipulation_c.XY_AXIS:this._tooltip.info=new TranslateTooltipInfos.in({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,i)=>{const n=(0,automaticLengthMeasurementUtils.GQ)(e,i,a);return(0,quantityUtils.bA)(n,moveUtils_r(t))}));break;case MoveManipulation_c.Z:this._tooltip.info=new TranslateTooltipInfos.QW({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,euclideanLengthMeasurementUtils._e)}}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;let n;const o=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case MoveManipulation_c.XY:n=new TranslateTooltipInfos.nk({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((e,t)=>(0,automaticLengthMeasurementUtils.GQ)(e,t,o))),this._updateTooltipAreaOrTotalLength(n);break;case MoveManipulation_c.XY_AXIS:n=new TranslateTooltipInfos.c1({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((e,t)=>{const a=(0,automaticLengthMeasurementUtils.GQ)(e,t,o);return(0,quantityUtils.bA)(a,moveUtils_r(i))})),this._updateTooltipAreaOrTotalLength(n);break;case MoveManipulation_c.Z:n=new TranslateTooltipInfos.j({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,euclideanLengthMeasurementUtils._e)}const r=(0,euclideanLengthMeasurementUtils.g1)(e.elevationAlignedLocation);null!=r&&(n.elevation={mode:"absolute-height",...r}),this._tooltip.info=n}_updateTranslateTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:a,mapEnd:n}=t,o=i(a,n);e.distance=null!=o?o:quantityUtils.yP}}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(null==t)return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,automaticAreaMeasurementUtils.k)(t,i):null,e.totalLength="polyline"===t.type?(0,automaticLengthMeasurementUtils.Ul)(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Ne(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"_editGeometryOperations",void 0),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"_segmentLabels",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],Ue.prototype,"tool",void 0),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"_tooltip",void 0),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"inputGeometry",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"outputGeometry",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Ue.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"manipulators",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"view",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"graphic",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"enableZShape",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"enableZVertex",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"enableMoveGraphic",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"enableMidpoints",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"enableEdgeOffset",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"_labelOptions",null),(0,tslib_es6._)([(0,property.Cb)()],Ue.prototype,"_tooltipOptions",null),Ue=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ue);const ke=(0,dehydratedFeatures.Tx)(0,0,void 0,SpatialReference.Z.WGS84),Re=(0,vec3f64.c)(),Fe=1e-6;var ze,Xe,Ze;!function(e){e.Vertex=interactive_interfaces.jg.Custom1,e.Edge=interactive_interfaces.jg.Custom2}(ze||(ze={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Xe||(Xe={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ze||(Ze={}));var SketchLabelOptions=__webpack_require__("./node_modules/@arcgis/core/views/interactive/sketch/SketchLabelOptions.js");let GraphicReshapeTool_g=class extends(Evented.Z.EventedMixin(InteractiveToolBase.m)){constructor(e){super(e),this._handles=new Handles.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new SketchLabelOptions.Z,this.tooltipOptions=new SketchTooltipOptions.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new Ue({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation())),(0,reactiveUtils.YP)((()=>this.graphic),(()=>this._updateGraphic()),reactiveUtils.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,maybe.SC)(this._handles),this._reshapeOperation=(0,maybe.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=(0,reshapeGraphic_isSupportedGraphic.b)(this.graphic);this._reshapeOperation.inputGeometry=null!=e?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,reshapeGraphic_isSupportedGraphic.P)(this.graphic)!==isSupportedGraphicUtils.e.SUPPORTED)return;const e=(0,reactiveUtils.YP)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),reactiveUtils.Z_);this._handles.add(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0;const{graphic:t}=this,{geometry:o}=t;"mesh"===o?.type&&"point"===e.type?(t.geometry=o.centerAt(e),t.notifyGeometryChanged()):t.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;null!=this.graphic&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,tslib_es6._)([(0,property.Cb)()],GraphicReshapeTool_g.prototype,"_reshapeOperation",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],GraphicReshapeTool_g.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"enableZShape",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"enableZVertex",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"enableMoveGraphic",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"enableMidpoints",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicReshapeTool_g.prototype,"enableEdgeOffset",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicReshapeTool_g.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,type:SketchLabelOptions.Z})],GraphicReshapeTool_g.prototype,"labelOptions",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,type:SketchTooltipOptions.Z})],GraphicReshapeTool_g.prototype,"tooltipOptions",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],GraphicReshapeTool_g.prototype,"snappingManager",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicReshapeTool_g.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],GraphicReshapeTool_g.prototype,"automaticManipulatorSelection",void 0),GraphicReshapeTool_g=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],GraphicReshapeTool_g);var Cyclical=__webpack_require__("./node_modules/@arcgis/core/core/Cyclical.js"),scheduling=__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js");let TransformTooltipInfos_r=class extends SketchTooltipInfo.h{constructor(o){super(o),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"rotation",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"rotationPrecision",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"orientation",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"orientationPrecision",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_r.prototype,"rotationType",void 0),TransformTooltipInfos_r=(0,tslib_es6._)([(0,subclass.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],TransformTooltipInfos_r);let TransformTooltipInfos_s=class extends SketchTooltipInfo.h{constructor(o){super(o),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_s.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_s.prototype,"scale",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_s.prototype,"size",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_s.prototype,"sizeUnit",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_s.prototype,"sizePrecision",void 0),TransformTooltipInfos_s=(0,tslib_es6._)([(0,subclass.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],TransformTooltipInfos_s);let TransformTooltipInfos_p=class extends SketchTooltipInfo.h{constructor(o){super(o),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};var Mt,vt;(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"orientation",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"orientationPrecision",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"rotationType",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"size",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"sizePrecision",void 0),(0,tslib_es6._)([(0,property.Cb)()],TransformTooltipInfos_p.prototype,"sizeUnit",void 0),TransformTooltipInfos_p=(0,tslib_es6._)([(0,subclass.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],TransformTooltipInfos_p),function(t){t.ScaleIn=interactive_interfaces.jg.Custom2,t.ScaleOut=interactive_interfaces.jg.Custom3,t.RotateLeft=interactive_interfaces.jg.Custom4,t.RotateRight=interactive_interfaces.jg.Custom5,t.Unlocked=interactive_interfaces.jg.Custom7,t.DelayedFocused=interactive_interfaces.jg.Custom8,t.TouchInput=interactive_interfaces.jg.Custom12}(Mt||(Mt={}));class yt{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}constructor({adapter:t,tooltipOptions:i,mode:o,tool:s}){this._mode=null,this._handles=new Handles.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new Evented.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this._adapter.scale:1,this.tool=s,this._mode=o,this._adapter=t,this._tooltipOptions=i,this._tooltip=new Tooltip.u({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,reactiveUtils.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),reactiveUtils.nn))}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this._handles=(0,maybe.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,maybe.SC)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=(0,scheduling.A)({update:({deltaTime:e})=>{t.update(e)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,maybe.SC)(this._activeAnimation)}forEachManipulator(t){t(this._ringManipulator,ManipulatorType_A.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const a=this.tool.graphicState.graphic,s=(0,dragEventPipeline.Xd)(e,((e,s,n)=>{this._scaleRotateDragData=null;const r=this._adapter.startInteraction(),l={mode:"none",origin:(0,vec3f64.a)(e.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=l,this._updateDragState();const c=vectorStacks.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,c),s.next(dragEventPipeline3D_H(this.tool.view,(0,plane.Yq)(e.renderLocation,c,(0,plane.Ue)()))).next((e=>{const s=(0,plane.mJ)(e.plane),n=D(e.renderStart,e.renderEnd,l.origin,s),c=Cyclical.Q4.shortestSignedDiff(l.angle,n);l.angleDir=(0,mathUtils.uZ)(l.angleDir+c,-.3,.3),l.angle=n;const h=function GraphicScaleRotateTransform_wt(t,e){const a=(0,vec3.b)(vectorStacks.WM.get(),e.renderStart,t.origin),i=(0,vec3.b)(vectorStacks.WM.get(),e.renderEnd,t.origin),o=(0,vec3.l)(a),s=(0,vec3.l)(i);return 0===o?0:s/o}(l,e),p=h-this._adapter.scale;if(l.scaleDir=(0,mathUtils.uZ)(l.scaleDir+p,-.2,.2),this._onScaleChanged(),"none"===l.mode){const t=this._mode||function bt(t,e,a,i){const{renderStart:o,renderEnd:s}=t,n=GraphicScaleRotateTransform_Tt(o,i,vectorStacks.WM.get()),r=GraphicScaleRotateTransform_Tt(s,i,vectorStacks.WM.get());if((0,vec3.d)(n,r)<100)return null;const l=(0,vec3.b)(vectorStacks.WM.get(),o,a),c=(0,vec3.f)(vectorStacks.WM.get(),l,(0,plane.mJ)(e)),h=o,p=(0,vec3.a)(vectorStacks.WM.get(),h,c),d=GraphicScaleRotateTransform_Tt(a,i,vectorStacks.WM.get()),u=n,g=GraphicScaleRotateTransform_Tt(p,i,vectorStacks.WM.get()),m=(0,vec3.b)(vectorStacks.WM.get(),g,u),_=(0,vec3.b)(vectorStacks.WM.get(),n,d),f=(0,ray.re)(u,m),D=(0,ray.re)(d,_);return(0,ray.Jk)(f,r)<(0,ray.Jk)(D,r)?"rotate":"scale"}(e,e.plane,l.origin,this.tool.view.state.camera);if(null!=t){switch(t){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:a,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:a,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}l.mode=t}}switch(l.mode){case"rotate":r.state.angle=l.initialAngle+n;break;case"scale":r.state.scale=h,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:a,angle:(0,mathUtils.BV)(l.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:a,xScale:h,yScale:h})}break;case"end":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:(0,mathUtils.BV)(l.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:h,yScale:h})}}return"end"===e.action&&(this.startAnimation(Rt(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),r.done()),e})).next(this._updateTooltipPipelineStep(l)),n.next((()=>{if(r.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1})}this.startAnimation(Rt(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([s,e.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function GraphicScaleRotateTransform_jt(t,e,a){let i=0,o=null;const s=()=>!1;return{start:()=>{o=t.getFocused,t.getFocused=s,i=0,e()},update:t=>(i+=t,!o?.()||i>=a.delayMs?vt.STOP:vt.CONTINUE),destroy:()=>{o&&(t.getFocused=o),e()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(t=>{t.stopPropagation()})),(0,reactiveUtils.YP)((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),reactiveUtils.nn)])}_updateTooltipPipelineStep(t){return e=>{const a=this._tooltipOptions;if(!a.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const i=this._tooltip,o=this._tooltipOptions.visualVariables;switch(t.mode){case"scale":{const{size:t,scale:e}=this._adapter,s=o?.size;i.info=new TransformTooltipInfos_s({tooltipOptions:a,scale:{value:e},size:null!=t?(0,quantityUtils.yG)(t,"meters"):void 0,sizePrecision:GraphicScaleRotateTransform_Ot(s?.valueType),sizeUnit:s?.unit});break}case"rotate":{const{orientationClockwise:t,relativeAngleClockwise:e}=this._adapter,s=o?.rotation,r=GraphicScaleRotateTransform_Ot(s?.valueType);i.info=new TransformTooltipInfos_r({tooltipOptions:a,rotation:null!=e?(0,quantityUtils.GJ)(e,"radians","geographic"):void 0,rotationPrecision:r,rotationType:s?.rotationType??"geographic",orientation:null!=t?(0,quantityUtils.GJ)(t,"radians","geographic"):void 0,orientationPrecision:r})}}return e}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=t?.rotation,a=t?.size,i=this._mode,{size:o,orientationClockwise:s}=this._adapter,l=null!=s&&(null==i||"rotate"===i),c=null!=o&&(null==i||"scale"===i);this._tooltip.info=new TransformTooltipInfos_p({tooltipOptions:this._tooltipOptions,orientation:l?(0,quantityUtils.GJ)(s,"radians","geographic"):void 0,orientationPrecision:GraphicScaleRotateTransform_Ot(e?.valueType),rotationType:e?.rotationType??"geographic",size:c?(0,quantityUtils.yG)(o,"meters"):void 0,sizeUnit:a?.unit,sizePrecision:GraphicScaleRotateTransform_Ot(a?.valueType)})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Mt.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Mt.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Mt.ScaleIn|Mt.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Mt.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Mt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Mt.RotateLeft|Mt.RotateRight,!1),this._ringManipulator.updateStateEnabled(Mt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Mt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Mt.ScaleIn|Mt.ScaleOut|Mt.RotateLeft|Mt.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,mat4.d)(vectorStacks.MP.get(),this._adapter.angle,(0,vec3f64.f)(0,0,1));if(null==t)return;const e=this.getScale(),a=(0,mat4.E)(vectorStacks.MP.get(),(0,vec3.s)(vectorStacks.WM.get(),e,e,e));this._ringManipulator.modelTransform=(0,mat4.m)(vectorStacks.MP.get(),a,t)}_createRingManipulator(){const t=(t,e,a)=>{const i=[],o=Math.ceil(128*(e-t)/(2*Math.PI));for(let s=0;s<o+1;s++){const n=t+s*(e-t)/o;i.push((0,vec3f64.f)(a*Math.cos(n),a*Math.sin(n),0))}return i},e=e=>t(0,2*Math.PI,e),i=this._createMaterial(1),o=(t,e,o=i)=>(0,GeometryUtil.x2)(o,(t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]])(e),t,[],[],!1),s=e(160),n=o(s,24),r={left:new Array,right:new Array},l=[];for(let R=0;R<2;R++){const e=R*Math.PI-Math.PI/4,a=Math.PI/2-config_x,s=e+a,n=e+Math.PI/2-a,c=t(s,n,190),h=o(c,9);l.push(c),l.push(t(s,n,201)),r.left.push(h),r.right.push(h.instantiate());for(let t=0;t<2;t++){const e=0===t,a=(0,mat4f64.c)();if(e){(0,mat4.k)(a,a,[1,-1,1]),(0,mat4.e)(a,a,-s,[0,0,1]);const t=Math.round(.2*(c.length-1));a[12]=c[t][0],a[13]=c[t][1],a[14]=c[t][2]}else{(0,mat4.e)(a,a,n,[0,0,1]);const t=Math.round(.8*(c.length-1));a[12]=c[t][0],a[13]=c[t][1],a[14]=c[t][2]}const o=(0,GeometryUtil.DA)(i,60,0,23,.5);(0,GeometryUtil.mx)(o,a),(e?r.left:r.right).push(o)}}const c=[];for(let _=0;_<2;_++){const e=_*Math.PI-Math.PI/4,a=Math.PI/2-config_b,i=e+a,s=e+Math.PI/2-a,n=t(i,s,213);c.push(o(n,9))}const h=this._createMaterial(.66),p=this._createMaterial(.5),d=this._createMaterial(.33),u=e(190),g=e(213),m=o(u,9,h),S=o(g,9,d),M=e(130),v=e(107),y=o(M,9,h),w=o(v,9,d);let b=[new RenderObject_e(n,Mt.DelayedFocused),new RenderObject_e(n.instantiate({material:p}),interactive_interfaces.Q9.None)];this._mode&&"scale"!==this._mode||(b=b.concat([...c.map((t=>new RenderObject_e(t,Mt.DelayedFocused|Mt.Unlocked))),new RenderObject_e(m,Mt.DelayedFocused|Mt.ScaleIn),new RenderObject_e(S,Mt.DelayedFocused|Mt.ScaleIn),new RenderObject_e(y,Mt.DelayedFocused|Mt.ScaleOut),new RenderObject_e(w,Mt.DelayedFocused|Mt.ScaleOut)])),this._mode&&"rotate"!==this._mode||(b=b.concat([...r.right.map((t=>new RenderObject_e(t.instantiate(),Mt.DelayedFocused|Mt.Unlocked))),...r.left.map((t=>new RenderObject_e(t,Mt.DelayedFocused|Mt.RotateLeft))),...r.right.map((t=>new RenderObject_e(t,Mt.DelayedFocused|Mt.RotateRight)))]));const T=[s,...l];return new Manipulator3D_$({view:this.tool.view,renderObjects:b,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,elevationInfoUtils.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:T,direction:(0,vec3f64.f)(0,0,1)}})}_createMaterial(t){const e=settings_P(this.tool.view).colors.accent.clone();return e.a=t,new ColorMaterial.E({color:(0,colorUtils.O)(e),transparent:1!==t,cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}}function GraphicScaleRotateTransform_Tt(t,e,a){return e.projectToScreen(t,It),(0,vec3.s)(a,It[0],It[1],0)}function Rt(t,e){let a=null,i=1;const o=()=>i;return{start:()=>{i=t.getScale(),a=t.getScale,t.getScale=o,e()},update:t=>(i+=((i+1)/2-i)*Math.min(3*t,1),e(),Math.abs(i-1)<.01?vt.STOP:vt.CONTINUE),destroy:()=>{a&&(t.getScale=a),e()}}}function GraphicScaleRotateTransform_Ot(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(vt||(vt={}));const It=(0,screenUtils.s1)();var axisAngleDegrees=__webpack_require__("./node_modules/@arcgis/core/geometry/support/axisAngleDegrees.js"),MeshTransform=__webpack_require__("./node_modules/@arcgis/core/geometry/support/MeshTransform.js");function undoRecords_t(e){return null!=e.geometry&&"mesh"===e.geometry.type?function undoRecords_r(e){return e.vertexSpace.isRelative?function undoRecords_o(t,r,n){let o=r?.clone(),i=(0,vec3f64.a)(n.origin),u=null,s=null;return{undo:r=>{u=t.transform?.clone(),s=(0,vec3f64.a)(n.origin),t.transform=o,t.vertexSpace.origin=i,r.notifyMeshTransformChanged()},redo:r=>{o=t.transform?.clone(),i=(0,vec3f64.a)(n.origin),t.transform=u,t.vertexSpace.origin=s,r.notifyMeshTransformChanged()}}}(e,e.transform,e.vertexSpace):function undoRecords_i(e){let t,r=e.vertexAttributes.clonePositional();return{undo:n=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=r,n.notifyGeometryChanged()},redo:n=>{r=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function undoRecords_n(e){let t=e.geometry,r=null;return{undo(e){r=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=r}}}(e)}let ScaleRotateMeshAdapter_f=class extends HandleOwner.r{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([(0,reactiveUtils.gx)((()=>{const t=this._interactionState;return t&&t.angle!==t.previousAngle?{interactionState:t,angle:t.state.angle}:null}),(({interactionState:t})=>{this._updateMeshRotation(t)}),reactiveUtils.Z_),(0,reactiveUtils.gx)((()=>{const t=this._interactionState;return t&&t.scale!==t.previousScale?{interactionState:t,scale:t.state.scale}:null}),(({interactionState:t})=>{this._updateMeshSize(t)}),reactiveUtils.Z_)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const t=this.geometry.transform;if(null==t)return this._interactionState?.angle??0;const e=(0,axisAngleDegrees.ZZ)(t.rotation)[2];return Math.abs(e)>.999999?(0,mathUtils.Vl)((0,axisAngleDegrees.EU)(t.rotation))*Math.sign(e):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const t=new ScaleRotateMeshAdapter_S({angle:this.angle});this._interactionState=t;const e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return undoRecords_t(this.graphic)}_updateMeshRotation(t){const{angle:e,previousAngle:o}=t;t.previousAngle=e;const{geometry:r}=this,{vertexSpace:n}=r,s=(0,mathUtils.BV)(e-o);if(n.isGeoreferenced){const t=!n.isRelative&&this.viewingMode===ViewingMode.JY.Global,e=this.geometry.anchor;this.geometry.rotate(0,0,s,{origin:e,geographic:t}),this.graphic.notifyGeometryChanged()}else{r.transform??=new MeshTransform.Z;const{transform:t}=r,e=(0,axisAngleDegrees.qw)(0,0,s,ScaleRotateMeshAdapter_A);t.rotation=(0,axisAngleDegrees.qC)(t.rotation,e,t.rotation),this.graphic.notifyMeshTransformChanged()}}_updateMeshSize(t){const{scale:e,previousScale:o}=t;t.previousScale=e;const{geometry:r}=this,{vertexSpace:i}=r,n=e/o;if(i.isGeoreferenced){const t=!i.isRelative&&this.viewingMode===ViewingMode.JY.Global,e=this.geometry.anchor;this.geometry.scale(n,{origin:e,geographic:t}),this.graphic.notifyGeometryChanged()}else{r.transform??=new MeshTransform.Z;const{transform:t}=r;t.scale=(0,vec3.g)(t.scale,t.scale,n),this.graphic.notifyMeshTransformChanged()}}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateMeshAdapter_f.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateMeshAdapter_f.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateMeshAdapter_f.prototype,"viewingMode",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"initialAngle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"angle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"angleClockwise",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"relativeAngle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"relativeAngleClockwise",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"scale",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_f.prototype,"_interactionState",void 0),ScaleRotateMeshAdapter_f=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],ScaleRotateMeshAdapter_f);let ScaleRotateMeshAdapter_S=class extends Accessor.Z{get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"angle",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"initialAngle",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"previousAngle",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"previousScale",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"scale",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateMeshAdapter_S.prototype,"state",null),ScaleRotateMeshAdapter_S=(0,tslib_es6._)([(0,subclass.j)("InteractionState")],ScaleRotateMeshAdapter_S);const ScaleRotateMeshAdapter_A=(0,axisAngleDegrees.Ue)();let ScaleRotateObjectSymbol3DAdapter_c=class extends HandleOwner.r{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,reactiveUtils.gx)((()=>null!=this._interactionState?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),reactiveUtils.Z_))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function ScaleRotateObjectSymbol3DAdapter_h(t){return-(0,mathUtils.Vl)(t)}(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const t=this._sizeReferenceSymbolLayer;if(null==t)return null;const e=this.findLayerView(),i=this._graphicSymbol;if(null==e||null==i||"point-3d"!==i.type)return null;const l=e.getSymbolLayerSize(i,t);if("size"in l&&null!=l.size)return l.size;const n=this.sizeAxis;return!("width"in l)||null==l.width||null!=n&&"width"!==n&&"all"!==n&&"width-and-depth"!==n?!("depth"in l)||null==t.depth||null!=n&&"depth"!==n&&"all"!==n&&"width-and-depth"!==n?!("height"in l)||null==t.height||null!=n&&"height"!==n&&"all"!==n?null:l.height:l.depth:l.width}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&null!=t.heading))}get _graphicSymbol(){return null!=this.graphic&&null!=this.graphic.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(null!=this._interactionState||null==t||null==e)return ScaleRotateObjectSymbol3DAdapter_p;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),l=t.clone(),n=this.angle,o=new ScaleRotateObjectSymbol3DAdapter_y({originalSymbol:l,angle:n,initialSizes:i});this._interactionState=o;const r=()=>{this._interactionState=null};return{state:o,done:r,cancel:()=>{this._graphicSymbol=l,r()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:n}){const o=this._graphicSymbol;if(null==o||"point-3d"!==o.type)return;const r=o.clone(),s=-(0,mathUtils.BV)(e-this.initialAngle);let a=!1;this._forEachObjectSymbolLayerPair(i,r,((e,i,l)=>{const o=(e.heading??0)+s;i.heading!==o&&(i.heading=o,a=!0);const r=n[l];if(null!=r&&"width"in r){r.width=this.sizeFilter(r.width),r.height=this.sizeFilter(r.height),r.depth=this.sizeFilter(r.depth);const e=r.width*t;i.width!==e&&(i.width=e,a=!0);const l=r.depth*t;i.depth!==l&&(i.depth=l,a=!0);const n=r.height*t;i.height!==n&&(i.height=n,a=!0)}})),a&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,l)=>{const n=e.symbolLayers.at(l);"object"===t.type&&"object"===n.type&&i(t,n,l)}))}};(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"initialAngle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"angle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"angleClockwise",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"orientation",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"orientationClockwise",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"relativeAngle",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"relativeAngleClockwise",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"scale",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"size",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"sizeAxis",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateObjectSymbol3DAdapter_c.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"_interactionState",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateObjectSymbol3DAdapter_c.prototype,"findLayerView",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],ScaleRotateObjectSymbol3DAdapter_c.prototype,"sizeFilter",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"_sizeReferenceSymbolLayer",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"_orientationReferenceSymbolLayer",null),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_c.prototype,"_graphicSymbol",null),ScaleRotateObjectSymbol3DAdapter_c=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],ScaleRotateObjectSymbol3DAdapter_c);const ScaleRotateObjectSymbol3DAdapter_p={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let ScaleRotateObjectSymbol3DAdapter_y=class extends Accessor.Z{get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:l,initialSizes:n}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:l,initialSizes:n}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"originalSymbol",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"angle",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"initialAngle",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"initialSizes",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"scale",void 0),(0,tslib_es6._)([(0,property.Cb)()],ScaleRotateObjectSymbol3DAdapter_y.prototype,"state",null),ScaleRotateObjectSymbol3DAdapter_y=(0,tslib_es6._)([(0,subclass.j)("InteractionState")],ScaleRotateObjectSymbol3DAdapter_y);let GraphicTransformTool_X=class extends((0,HandleOwner.p)(Evented.Z.EventedMixin(InteractiveToolBase.m))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new SketchTooltipOptions.Z,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:t,view:e}=this;this.graphicState=new GraphicState_e({graphic:t}),this.addHandles((0,reactiveUtils.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new Tooltip.u({view:e}):(0,maybe.SC)(this._tooltip)}),reactiveUtils.tX)),this._moveManipulation=new MoveManipulation_u({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&manipulatorUtils_n(t),radius:MoveManipulation_u.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const i=t=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const i=this._tooltip;null!=i&&("focus"===e?this._updateMoveTooltip(t):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(MoveManipulation_c.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(MoveManipulation_c.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(MoveManipulation_c.Z));const n=(0,elevationInfoUtils.RL)(t);this._moveManipulation.elevationInfo=n,this.addHandles(meshFastUpdateUtils_o(this.graphicState));const{geometry:s}=t;if(this._moveManipulation.createGraphicDragPipeline(((i,a,o,r,l)=>{if(null!=s&&i===MoveManipulation_c.XY){const{snappingStep:i,cancelSnapping:a}=(0,SnappingDragPipelineStep.W)({snappingContext:new SnappingContext.N({elevationInfo:n,pointer:l,editGeometryOperations:EditGeometryOperations.c.fromGeometry(new Point.Z({spatialReference:s.spatialReference}),e.state.viewingMode),visualizer:new SnappingVisualizer3D_O,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});r=r.next(a),o=o.next((0,dragEventPipeline.Mz)(this.view,n)).next(...i)}return{steps:o=o.next((t=>(this._updateMoveTooltip(i,t),t))),cancel:r}}),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:o}=t,n={graphic:i,dxScreen:a,dyScreen:o};switch(e){case"start":this.emit("graphic-translate-start",n),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,reactiveUtils.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new yt({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([visualElementUtils_i({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,handleUtils.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,reactiveUtils.YP)((()=>e.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof Manipulator3D_$&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,maybe.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,maybe.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,maybe.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return null!=this.graphic.geometry&&"mesh"===this.graphic.geometry.type?new ScaleRotateMeshAdapter_f({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new ScaleRotateObjectSymbol3DAdapter_c({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:this.tooltipOptions?.visualVariables?.size?.axis??null})}_forEachManipulator(t){this._moveManipulation?.forEachManipulator(t),this._scaleRotate?.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return(0,reactiveUtils.YP)((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&manipulatorUtils_n(this.graphic)}))}_createGeometryUndoRecord(){return undoRecords_t(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,this._scaleRotate&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===ViewingMode.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){manipulatorUtils_V(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if(null==a)return;a.clear();const o=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case MoveManipulation_c.XY:a.info=new TranslateTooltipInfos.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>(0,automaticLengthMeasurementUtils.GQ)(t,e,o)));break;case MoveManipulation_c.XY_AXIS:a.info=new TranslateTooltipInfos.in({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=(0,automaticLengthMeasurementUtils.GQ)(t,i,o);return(0,quantityUtils.bA)(a,moveUtils_r(e))}));break;case MoveManipulation_c.Z:a.info=new TranslateTooltipInfos.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,euclideanLengthMeasurementUtils._e)}}_updateMoveTooltipDistance(t,e,i){if(null!=e&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=null!=n?n:quantityUtils.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:null!=this._scaleRotate?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:t=>null!=this._scaleRotate?this._scaleRotate.test.setRingIndicatorDelayMs(t):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicTransformTool_X.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicTransformTool_X.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],GraphicTransformTool_X.prototype,"enableZ",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicTransformTool_X.prototype,"enableRotation",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicTransformTool_X.prototype,"enableScaling",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,type:SketchTooltipOptions.Z})],GraphicTransformTool_X.prototype,"tooltipOptions",void 0),(0,tslib_es6._)([(0,property.Cb)()],GraphicTransformTool_X.prototype,"graphicState",void 0),(0,tslib_es6._)([(0,property.Cb)({value:!1})],GraphicTransformTool_X.prototype,"snapToScene",null),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],GraphicTransformTool_X.prototype,"snappingManager",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],GraphicTransformTool_X.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],GraphicTransformTool_X.prototype,"updating",null),GraphicTransformTool_X=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],GraphicTransformTool_X);var boundedPlane=__webpack_require__("./node_modules/@arcgis/core/chunks/boundedPlane.js"),Clonable=__webpack_require__("./node_modules/@arcgis/core/core/Clonable.js"),JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),cast=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/cast.js"),persistable=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js");let SlicePlane_c=class extends((0,Clonable.J)(JSONSupport.wq)){constructor(o){super(o),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(o){return this.heading===o.heading&&this.tilt===o.tilt&&(0,maybe._W)(this.position,o.position)&&this.width===o.width&&this.height===o.height}};(0,tslib_es6._)([(0,property.Cb)({readOnly:!0,json:{read:!1,write:!0}})],SlicePlane_c.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Point.Z}),(0,persistable.B)()],SlicePlane_c.prototype,"position",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,persistable.B)(),(0,cast.p)((o=>Cyclical.BV.normalize((0,ensureType.q9)(o),0,!0)))],SlicePlane_c.prototype,"heading",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,persistable.B)(),(0,cast.p)((o=>Cyclical.BV.normalize((0,ensureType.q9)(o),0,!0)))],SlicePlane_c.prototype,"tilt",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,nonNullable:!0}),(0,persistable.B)()],SlicePlane_c.prototype,"width",void 0),(0,tslib_es6._)([(0,property.Cb)({type:Number,nonNullable:!0}),(0,persistable.B)()],SlicePlane_c.prototype,"height",void 0),SlicePlane_c=(0,tslib_es6._)([(0,subclass.j)("esri.analysis.SlicePlane")],SlicePlane_c);var quat=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js");__webpack_require__("./node_modules/@arcgis/core/geometry/support/Axis.js");class settings_r{constructor(){this.color=(0,analysisThemeUtils.e9)()}}class settings_c{constructor(){this.color=new Color.Z([0,0,0,.04]),this.gridColor=(0,analysisThemeUtils.e9)(.5),this.outlineColor=(0,analysisThemeUtils.e9)(.7)}}class settings_i{constructor(){this.color=(0,analysisThemeUtils.e9)()}}class settings_l{constructor(){this.color=(0,analysisThemeUtils.e9)(.5),this.contrastColor=(0,analysisThemeUtils.RN)()}}class settings_n{constructor(){this.color=(0,analysisThemeUtils.RN)(),this.outlineColor=(0,analysisThemeUtils.e9)()}}class settings_e{constructor(){this.callouts=new settings_r,this.plane=new settings_c,this.resizeManipulators=new settings_i,this.rotateManipulators=new settings_l,this.shiftManipulator=new settings_n}}new settings_e;(0,has.Z)("mac");const sliceToolConfig_a=1.15,sliceToolConfig_c=1.15,sliceToolConfig_l=(Math.cos((0,mathUtils.Vl)(45)),Math.cos((0,mathUtils.Vl)(5)),3),sliceToolConfig_n=11,sliceToolConfig_x=22.5,sliceToolConfig_g=.3;(0,mat4f64.c)();var SlicePlaneMaterial_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/SlicePlaneMaterial.glsl.js");class SlicePlaneMaterialTechnique_u extends ShaderTechnique.A{initializeProgram(e){return new Program.$(e.rctx,SlicePlaneMaterialTechnique_u.shader.get().build(this.configuration),DefaultVertexAttributeLocations.i)}initializePipeline(){return(0,renderState.sm)({blending:(0,renderState.wK)(enums.zi.ONE,enums.zi.ONE,enums.zi.ONE_MINUS_SRC_ALPHA,enums.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:enums.wb.LESS},colorWrite:renderState.BK})}}SlicePlaneMaterialTechnique_u.shader=new ReloadableShaderModule.J(SlicePlaneMaterial_glsl.S,(()=>__webpack_require__.e(4166).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/SlicePlaneMaterial.glsl.js"))));__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js");__webpack_require__("./node_modules/@arcgis/core/geometry/spatialReferenceEllipsoidUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/sphere.js");(0,vec3f64.c)();(0,vec3f64.c)();var Yt;__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");function Zt(t,e){switch(e){case Yt.POSITIVE_X:return{basis:t.basis1,direction:1,position:(0,vec3.a)(vectorStacks.WM.get(),t.origin,t.basis1),edge:e};case Yt.POSITIVE_Y:return{basis:t.basis2,direction:1,position:(0,vec3.a)(vectorStacks.WM.get(),t.origin,t.basis2),edge:e};case Yt.NEGATIVE_X:return{basis:t.basis1,direction:-1,position:(0,vec3.b)(vectorStacks.WM.get(),t.origin,t.basis1),edge:e};case Yt.NEGATIVE_Y:return{basis:t.basis2,direction:-1,position:(0,vec3.b)(vectorStacks.WM.get(),t.origin,t.basis2),edge:e}}}function qt(t){const e=(0,vec3.l)(t.basis1),n=(0,vec3.l)(t.basis2);return sliceToolConfig_g*Math.min(e,n)}function zt(t){return qt(t)}function $t(t){return 0!==t.direction[0]&&0!==t.direction[1]}function Jt(e,n){const o=n.offsetMode===Oe.CENTER_ON_CALLOUT?40:0,i=[(0,vec3f64.f)(o,0,-24),(0,vec3f64.f)(o,0,24)],r=function sliceToolUtils_ie(t,e){const n=(0,vec3.b)((0,vec3f64.c)(),t[t.length-1],t[t.length-2]);if((0,vec3.n)(n,n),(0,vec3.g)(n,n,sliceToolConfig_x),(0,vec3.a)(n,n,t[t.length-1]),e){const e=(0,vec3.b)((0,vec3f64.c)(),t[0],t[1]);return(0,vec3.n)(e,e),(0,vec3.g)(e,e,sliceToolConfig_x),(0,vec3.a)(e,e,t[0]),[e,...t,n]}return[...t,n]}(i,!0),s=(t,e)=>function sliceToolUtils_ne(e,n,o,i){const r=Color.Z.blendColors(i.color,i.outlineColor,.4),s=Color.Z.blendColors(i.color,i.outlineColor,.14),a=new ColorMaterial.E({color:Color.Z.toUnitRGBA(i.color),cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Opaque}),u=new ColorMaterial.E({color:Color.Z.toUnitRGBA(r),cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Opaque}),h=new ColorMaterial.E({color:Color.Z.toUnitRGBA(s),cullFace:basicInterfaces.Vr.Back,renderOccluded:Material.yD.Opaque}),T=new ColorMaterial.E({color:Color.Z.toUnitRGBA(i.outlineColor),transparent:!0,writeDepth:!1,cullFace:basicInterfaces.Vr.Front,renderOccluded:Material.yD.Transparent}),w=t=>{const i=e.slice(0),r=(0,vec3.b)(vectorStacks.WM.get(),i[0],i[1]);(0,vec3.n)(r,r);const s=(0,vec3.b)(vectorStacks.WM.get(),i[i.length-1],i[i.length-2]);if((0,vec3.n)(s,s),n>0){const t=(0,vec3.g)((0,vec3f64.c)(),s,-n);i[i.length-1]=(0,vec3.a)(t,t,i[i.length-1]);const e=(0,vec3.g)((0,vec3f64.c)(),r,-n);i[0]=(0,vec3.a)(e,e,i[0])}const w=t?sliceToolConfig_c:1,R=sliceToolConfig_x*w,j=sliceToolConfig_n*w,C=(0,mat4.i)(vectorStacks.MP.get());if(n>0){const t=R/4,e=(0,vec3.s)(vectorStacks.WM.get(),0,t,0),o=1+n/t;(0,mat4.w)(C,C,e),(0,mat4.k)(C,C,(0,vec3.s)(vectorStacks.WM.get(),o,o,o)),(0,mat4.w)(C,C,(0,vec3.g)(e,e,-1/o))}const L=(0,mat4.i)((0,mat4f64.c)()),M=(0,vec3f64.f)(0,1,0),P=(0,mat4.F)((0,mat4f64.c)(),(0,quat.r)(vectorStacks.vD.get(),M,s));P[12]=i[i.length-1][0],P[13]=i[i.length-1][1],P[14]=i[i.length-1][2],(0,mat4.m)(P,P,C);const v=function sliceToolUtils_oe(t,e,n){const o=[],i=12;for(let r=0;r<i;r++){const e=r/i*2*Math.PI;o.push([Math.cos(e)*t,Math.sin(e)*t])}return(0,GeometryUtil.x2)(n,o,e,[],[],!1)}(sliceToolConfig_l*(t?sliceToolConfig_a:1)+n,i,o?T:h);v.transformation=L;const N=[v],V=(0,GeometryUtil.QL)(o?T:a,R,j,24,!1,!1,!0);V.transformation=P,N.push(V);const y=(0,GeometryUtil.QL)(o?T:u,R,j,24,!1,!0,!1);y.transformation=P,N.push(y);const S=(0,mat4.F)((0,mat4f64.c)(),(0,quat.r)(vectorStacks.vD.get(),M,r));return S[12]=i[0][0],S[13]=i[0][1],S[14]=i[0][2],(0,mat4.m)(S,S,C),N.push(V.instantiate({transformation:S})),N.push(y.instantiate({transformation:S})),N};return{normal:w(!1),focused:w(!0)}}(i,t,e,n),a=s(0,!1),c=s(2.25,!0),l=new NativeLineMaterial.Y({color:Color.Z.toUnitRGBA(n.calloutColor),renderOccluded:Material.yD.OccludeAndTransparent}),u=(0,GeometryUtil.rh)(l,[[o,0,0],[o-40,0,0]]),d=(0,GeometryUtil.rh)(l,[[o,0,0],[o-40,0,0]]);return new Manipulator3D_$({view:e,renderObjects:[...a.normal.map((t=>new RenderObject_e(t,interactive_interfaces.Q9.Unfocused|sliceToolUtils_me))),...c.normal.map((t=>new RenderObject_e(t,interactive_interfaces.Q9.Unfocused|sliceToolUtils_me))),new RenderObject_e(u,interactive_interfaces.Q9.Unfocused|sliceToolUtils_me|sliceToolUtils_fe),...a.focused.map((t=>new RenderObject_e(t,interactive_interfaces.Q9.Focused|sliceToolUtils_me))),...c.focused.map((t=>new RenderObject_e(t,interactive_interfaces.Q9.Focused|sliceToolUtils_me))),new RenderObject_e(d,interactive_interfaces.Q9.Focused|sliceToolUtils_me|sliceToolUtils_fe)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[r]},collisionPriority:1,radius:sliceToolConfig_n,state:sliceToolUtils_me})}function sliceToolUtils_ee(e,n,o){const i=$t(n),r=i?[(0,vec3f64.f)(1,0,0),(0,vec3f64.f)(0,0,0),(0,vec3f64.f)(0,1,0)]:[(0,vec3f64.f)(1,0,0),(0,vec3f64.f)(-1,0,0)],s=Color.Z.toUnitRGBA(o.color),l=i?4:1,u=2*l,m=t=>t>1?(t=>new RibbonLineMaterial.U({color:s,width:t,renderOccluded:Material.yD.OccludeAndTransparent}))(t):new NativeLineMaterial.Y({color:s,renderOccluded:Material.yD.OccludeAndTransparent}),p=[new RenderObject_e((0,GeometryUtil.rh)(m(l),r),interactive_interfaces.Q9.Unfocused|Te),new RenderObject_e((0,GeometryUtil.rh)(m(u),r),interactive_interfaces.Q9.Focused|Te),new RenderObject_e((0,GeometryUtil.rh)(m(1),r),we)],g=new Manipulator3D_$({view:e,renderObjects:p,collisionType:{type:"line",paths:[r]},radius:i?6:4,...U});return g.state=Te,g}function sliceToolUtils_ae(t,e){return(0,vector.cp)(e,t.basis2,t.basis1)+sliceToolUtils_he}!function(t){t[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y"}(Yt||(Yt={}));const sliceToolUtils_me=interactive_interfaces.jg.Custom1;var pe,sliceToolUtils_ge;!function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"}(pe||(pe={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(sliceToolUtils_ge||(sliceToolUtils_ge={}));const sliceToolUtils_fe=interactive_interfaces.jg.Custom2,sliceToolUtils_he=((0,ray.Ue)(),Math.PI/2),Te=interactive_interfaces.jg.Custom1,we=interactive_interfaces.jg.Custom2;var Oe;!function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Oe||(Oe={}));const generateTextures_t="theme-style";function generateTextures_e(t,e){return function generateTextures_a(t,e){const n=new Image(e,e);return n.src=t,n}(function generateTextures_r(t){const e=(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;base64,${btoa(e)}`}(function generateTextures_n(e,{accentColor:n,contrastColor:o}){const r=n.toHex(),a=n.a,s=o.toHex(),i=o.a,c=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(generateTextures_t);return c&&(c.innerHTML=`\n      .contrast-fill { fill: ${s}; fill-opacity: ${i}; }\n      .contrast-stroke { stroke: ${s}; stroke-opacity: ${i};  }\n      .accent-fill { fill: ${r}; fill-opacity: ${a}; }\n      .accent-stroke { stroke: ${r}; stroke-opacity:  ${a}; }`),e}(function generateTextures_o(t){const e=t.split(",")[1],n=atob(e);return(new DOMParser).parseFromString(n,"image/svg+xml")}(t),e)),e.size)}class PreserveAspectRatio_e{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent&&null!=this._next){const a={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(a),this._next.execute(a)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new dragEventPipeline.hM;return this._next=t,[t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),t]}_adjustScaleFactors(a){const e=$t(a.handle)?Math.max(Math.abs(a.factor1),Math.abs(a.factor2)):0===a.handle.direction[0]?Math.abs(a.factor2):Math.abs(a.factor1);a.factor1=a.factor1<0?-e:e,a.factor2=a.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}var UpdateVertices=__webpack_require__("./node_modules/@arcgis/core/views/interactive/editGeometry/operations/UpdateVertices.js"),editPlaneUtils=__webpack_require__("./node_modules/@arcgis/core/views/interactive/editGeometry/support/editPlaneUtils.js"),ExtentTooltipInfos=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/ExtentTooltipInfos.js");let ExtentTransformTool_It=class extends(Evented.Z.EventedMixin(InteractiveToolBase.m)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new SketchTooltipOptions.Z,this._preserveAspectRatio=new PreserveAspectRatio_e,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new Handles.Z,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,boundedPlane.a)(),this._mapBoundsStart=(0,boundedPlane.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,boundedPlane.a)(),this._displayBoundsStart=(0,boundedPlane.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,vec2f64.a)(),this._endScale=(0,vec2f64.a)()}initialize(){const{view:t,graphic:e,manipulators:i,_handles:s}=this,o=settings_P(t).colors,p=this._graphicState=new GraphicState_e({graphic:e}),l=e.geometry;this._editGeometryOperations=EditGeometryOperations.c.fromGeometry(l,t.state.viewingMode),this._graphicMoveManipulation=new MoveXYGraphicManipulation_l({tool:this,view:t,graphicState:p}),this._moveZManipulator=Jt(t,{offsetMode:Oe.CENTER_ON_CALLOUT,calloutColor:o.accent,color:o.contrast,outlineColor:o.accent}),this._moveZManipulator.state|=sliceToolUtils_fe,s.add([this._createMoveXYGraphicDragPipeline(),(0,reactiveUtils.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,ManipulatorType_A.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=sliceToolUtils_ee(t,e,{color:o.accent});return s.add([(0,reactiveUtils.YP)((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,ManipulatorType_A.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),i.addMany(this._resizeManipulators);const h=!this.view._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._rotateManipulatorTexture=function Factory_n(r,n){const{accentColor:l,contrastColor:c,preMultiplyAlpha:i}=n;return r.fromData(`heading-rotate:[accent:${l},contrast:${c},size:64]`,(()=>new Texture.x(generateTextures_e("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NnoiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3LTEzLjE3IDEuNHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",{accentColor:l,contrastColor:c,size:64}),{mipmap:!0,preMultiplyAlpha:i})))}(t.toolViewManager.textures,{accentColor:(0,colorUtils.G)(o.accent,.5),contrastColor:o.contrast,preMultiplyAlpha:h}),this._rotateManipulator=manipulatorUtils_R(t,{calloutColor:(0,colorUtils.O)(o.accent),texture:this._rotateManipulatorTexture.texture}),s.add([(0,reactiveUtils.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,ManipulatorType_A.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const c=visualElementUtils_i({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,handleUtils.kB)()});null!=c&&(this._outlineVisualElement=c.visualElement instanceof OutlineVisualElement_j?c.visualElement:null),null!=this._outlineVisualElement&&s.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),s.add(c),s.add([p.on("changed",(()=>this._onGeometryChanged())),(0,reactiveUtils.YP)((()=>p.displaying),(()=>this._updateAllManipulatorAvailability())),(0,reactiveUtils.YP)((()=>p.isDraped),(()=>this._graphicDrapedChanged()),reactiveUtils.nn),t.trackGraphicState(p)]);const u=t.pointsOfInterest;s.add((0,reactiveUtils.YP)((()=>u?.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));this._forEachManipulator((t=>{s.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((t,i)=>{s.add(t.events.on("immediate-click",(t=>{i===ManipulatorType_A.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new Tooltip.u({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{(0,vec2.s)(this._startScale,t.xScale,t.yScale),(0,vec2.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{(0,vec2.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{(0,vec2.s)(this._startScale,0,0),(0,vec2.s)(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo??=new TranslateTooltipInfos.$E({tooltipOptions:this.tooltipOptions})}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo??=new TranslateTooltipInfos.QW({tooltipOptions:this.tooltipOptions}),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=(0,euclideanLengthMeasurementUtils.Cr)(e,i,this.view.spatialReference);if(null==a)return null;t.distance=a}else t.distance=(0,quantityUtils.yG)(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo??=new ExtentTooltipInfos.c({tooltipOptions:this.tooltipOptions});return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if(null==t)return null;const e=this._scaleTooltipInfo??=new ExtentTooltipInfos.p({tooltipOptions:this.tooltipOptions}),i=(0,editPlaneUtils.NI)(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return null==i?null:(e.xSize=i[0],e.ySize=i[1],null!=this._sizeStart&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(ExtentTransformTool_Zt),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{null!=this._attachmentOrigin&&(0,aaBoundingRect.jE)(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),ExtentTransformTool_Zt)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof Manipulator3D_$){const a=this._graphicState.displaying,s=this.enableZ&&manipulatorUtils_n(this.graphic);switch(e){case ManipulatorType_A.ROTATE:t.available=a&&this.enableRotation;break;case ManipulatorType_A.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||s),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?Te:we;break;case ManipulatorType_A.TRANSLATE_Z:t.available=a&&s;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,ManipulatorType_A.SCALE))),t(this._rotateManipulator,ManipulatorType_A.ROTATE),t(this._moveZManipulator,ManipulatorType_A.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return(0,unitUtils.j5)(this.view.spatialReference)??"meters"}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=(0,vec2.c)(vectorStacks.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,vec2.e)(a,a);const s=manipulatorUtils_x(this.view,this.graphic)??t.extent?.center;let o=s?ExtentTransformTool_kt*this.view.pixelSizeAt(s):0;const r=this.view.spatialReference,n=t.spatialReference;r.equals(n)||(o*=(0,unitUtils.c9)(r)/(0,unitUtils.c9)(n)),(0,editPlaneUtils.lv)(a,e,o,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos)??0;i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:t}=this.graphic;if(null==t)return;const{extent:e}=t;if(!e)return;const i=null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?manipulatorUtils_x(this.view,this.graphic):this._outlineVisualElement.attachmentOrigin;this._attachmentOrigin=i??e.center;const a=null!=i?i.z:(0,elevationAlignmentUtils.w7)(this._mapBounds.origin,this.view.elevationProvider,ElevationContext.o.fromElevationInfo((0,elevationInfoUtils.RL)(this.graphic)),this.view.renderCoordsHelper),s=(0,boundedPlane.c)(this._mapBounds);s.origin[2]=a??0,(0,editPlaneUtils.ny)(s,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent?.center;return e?Ct*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,MoveManipulation_c.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return(0,dragEventPipeline.Xd)(this._moveZManipulator,((i,a,s)=>{const o=(0,vec3f64.a)(i.renderLocation),r=a.next(dragEventPipeline3D_P(t,o,e)).next((0,dragEventPipeline.zh)());this._applyGraphicMoveSteps(r,s,MoveManipulation_c.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next((0,dragEventPipeline.AN)()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||(t.mapEnd.z??0)-(t.mapStart.z??0))&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{null!=this.inputState&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){(0,boundedPlane.c)(this._displayBounds,this._displayBoundsStart),(0,boundedPlane.c)(this._mapBounds,this._mapBoundsStart),null!=this.graphic.geometry?this._sizeStart=(0,editPlaneUtils.NI)(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped):this._sizeStart=null}_moveDragUpdateGeometry(){return t=>{if(null==this.inputState||"move"!==this.inputState.type)return t;const e=[];for(const s of this._editGeometryOperations.data.components)e.push(...s.vertices);const i="start"===t.action?editGeometry_interfaces.O.NEW_STEP:editGeometry_interfaces.O.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return(0,editPlaneUtils.nn)(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===MoveManipulation_c.XY||e===MoveManipulation_c.XY_AXIS){const e=(0,automaticLengthMeasurementUtils.GQ)(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");null!=e&&null!=this._moveXYTooltipInfo&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=this._calculatePickRay(e);(0,plane.BR)(this._displayBounds.plane,i,vectorStacks.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return(0,dragEventPipeline.Xd)(t,((t,i,a)=>{null!=this.inputState&&(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(dragEventPipeline3D_H(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{null!=this.inputState&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,o=(0,vec3.c)(vectorStacks.WM.get(),e.origin);(0,vec3.A)(o,o,e.basis1,-i[0]),(0,vec3.A)(o,o,e.basis2,-i[1]);const r=(0,vec3.b)(vectorStacks.WM.get(),t.renderEnd,o),n=(0,vec3.b)(vectorStacks.WM.get(),t.renderStart,o),p=$t(t.handle),l=zt(e),h=zt(this._displayBounds)/l,c=(t,e)=>{if(0===t)return 1;let i=(0,vec3.l)(e),o=.5*t*(0,vec3.e)(e,r)/i;const l=o<0?-1:1;p&&(o+=(i-.5*t*(0,vec3.e)(e,n)/i)*l*h);const c=i<1.5*s?1:Lt;return i=Math.max(i-s,Lt),l>0&&(o-=a),l*Math.max(l*(o/i),c)};return{...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=(0,vec3.c)((0,vec3f64.c)(),this._mapBoundsStart.origin);(0,vec3.A)(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),(0,vec3.A)(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=(0,vec2.s)((0,vec2f64.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,vec2.e)(i,i);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s="start"===t.action?editGeometry_interfaces.O.NEW_STEP:editGeometry_interfaces.O.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,s,UpdateVertices.w.REPLACE);return(0,boundedPlane.c)(this._mapBoundsStart,this._mapBounds),(0,editPlaneUtils.nn)(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=function Ht(t,e,n,o){const i=e.worldUpAtPosition(t.origin,vectorStacks.WM.get()),r=vectorStacks.WM.get();switch(n){case pe.HEADING:(0,vec3.c)(r,i);break;case pe.TILT:(0,vec3.c)(r,t.basis1)}return(0,plane.Yq)(t.origin,r,o)}(this._displayBounds,this.view.renderCoordsHelper,pe.HEADING,(0,plane.Ue)()),a=this._calculatePickRay(e);(0,plane.BR)(i,a,vectorStacks.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}_createRotateDragPipeline(t){return(0,dragEventPipeline.Xd)(t,((t,e,i)=>{const a=this.inputState;null!=a&&(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(dragEventPipeline3D_H(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:(0,mathUtils.BV)(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{null!=this.inputState&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=(0,plane.mJ)(t.rotatePlane),a=D(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=(0,vec3.c)((0,vec3f64.c)(),this._mapBoundsStart.origin),i=[];for(const o of this._editGeometryOperations.data.components)i.push(...o.vertices);const a="start"===t.action?editGeometry_interfaces.O.NEW_STEP:editGeometry_interfaces.O.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,UpdateVertices.w.REPLACE);return(0,boundedPlane.c)(this._mapBoundsStart,this._mapBounds),(0,editPlaneUtils.nn)(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=(0,ray.Ue)(),i=(0,screenUtils.md)(t);return ray_i(this.view.state.camera,i,e),(0,vec3.n)(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=function kt(t,e){return manipulatorUtils_N(t.basis1,t.basis2,t.origin,e)}(this._displayBounds,vectorStacks.MP.get());(function Xt(t,e,n,o){const i=o.worldUpAtPosition(n.origin,vectorStacks.WM.get()),r=Zt(n,Yt.POSITIVE_X),s=(0,mat4.b)(vectorStacks.MP.get(),r.edge*Math.PI/2);(0,mat4.r)(s,s,-sliceToolUtils_ae(n,i)),(0,mat4.m)(s,e,s),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=r.position})(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{!function Ft(t,e,n,o){const i=(0,vec3.l)(o.basis1),r=(0,vec3.l)(o.basis2),s=qt(o),u=zt(o),d=(0,vec3.s)(vectorStacks.WM.get(),0,0,0);(0,vec3.a)(d,(0,vec3.g)(vectorStacks.WM.get(),o.basis1,e.direction[0]),(0,vec3.g)(vectorStacks.WM.get(),o.basis2,e.direction[1])),(0,vec3.a)(d,o.origin,d);let m=0,p=1;if($t(e))1===e.direction[0]&&-1===e.direction[1]?m=sliceToolUtils_he:1===e.direction[0]&&1===e.direction[1]?m=Math.PI:-1===e.direction[0]&&1===e.direction[1]&&(m=3*Math.PI/2),p=u;else{const t=0!==e.direction[0]?1:2;m=1===t?sliceToolUtils_he:0,p=(1===t?r:i)-s}const g=(0,mat4.b)(vectorStacks.MP.get(),m);(0,mat4.k)(g,g,(0,vec3.s)(vectorStacks.WM.get(),p,p,p)),(0,mat4.m)(g,n,g),g[12]=0,g[13]=0,g[14]=0,t.modelTransform=g,t.renderLocation=d}(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:(0,vec3.b)(vectorStacks.WM.get(),i.origin,i.basis1),edge:2},s=vectorStacks.MP.get();(0,mat4.o)(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;null!=t&&(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,editPlaneUtils.mO)(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,editPlaneUtils.mO)(t,this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,editPlaneUtils.nn)(t,this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],ExtentTransformTool_It.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],ExtentTransformTool_It.prototype,"graphic",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,nonNullable:!0})],ExtentTransformTool_It.prototype,"enableZ",void 0),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"enableRotation",void 0),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"enableScaling",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0,type:SketchTooltipOptions.Z})],ExtentTransformTool_It.prototype,"tooltipOptions",void 0),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"preserveAspectRatio",null),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"grabbing",void 0),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"inputState",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],ExtentTransformTool_It.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],ExtentTransformTool_It.prototype,"_moveUnit",null),ExtentTransformTool_It=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],ExtentTransformTool_It);const ExtentTransformTool_Zt="draped-elevation-changes",Ct=10,ExtentTransformTool_kt=80,Lt=1e-6},"./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>d});var _output_ReadLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js"),_util_CameraSpace_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl.js"),_shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js"),_shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js"),_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js");function d(d,i){const s=d.fragment;s.include(_output_ReadLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_0__.S),d.include(_util_CameraSpace_glsl_js__WEBPACK_IMPORTED_MODULE_1__.G),s.uniforms.add(new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.p("globalAlpha",(o=>o.globalAlpha)),new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.J("glowColor",(o=>o.glowColor)),new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.p("glowWidth",((o,e)=>o.glowWidth*e.camera.pixelRatio)),new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.p("glowFalloff",(o=>o.glowFalloff)),new _shaderModules_Float3PassUniform_js__WEBPACK_IMPORTED_MODULE_3__.J("innerColor",(o=>o.innerColor)),new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.p("innerWidth",((o,e)=>o.innerWidth*e.camera.pixelRatio)),new _shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_6__.A("depthMap",((o,e)=>e.linearDepthTexture)),new _shaderModules_Float2PassUniform_js__WEBPACK_IMPORTED_MODULE_2__.A("nearFar",((o,e)=>e.camera.nearFar)),new _shaderModules_Texture2DPassUniform_js__WEBPACK_IMPORTED_MODULE_6__.A("frameColor",((o,e)=>e.mainColorTexture))),s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),i.contrastControlEnabled?(s.uniforms.add(new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_4__.p("globalAlphaContrastBoost",(o=>null!=o.globalAlphaContrastBoost?o.globalAlphaContrastBoost:1))),s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):s.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_5__.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},"./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>o});var _util_View_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js"),_shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js"),_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js");function o(o,c){if(!c.screenSizeEnabled)return;const n=o.vertex;(0,_util_View_glsl_js__WEBPACK_IMPORTED_MODULE_0__.hY)(n,c),n.uniforms.add(new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_1__.p("perScreenPixelRatio",((e,i)=>i.camera.perScreenPixelRatio)),new _shaderModules_FloatPassUniform_js__WEBPACK_IMPORTED_MODULE_1__.p("screenSizeScale",(e=>e.screenSizeScale))),n.code.add(_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_2__.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},"./node_modules/@arcgis/core/views/interactive/tooltip/ExtentTooltipInfos.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>i,p:()=>p});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/quantityUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),_SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/SketchTooltipInfo.js");let i=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="extent-rotate",this.angle=0}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],i.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],i.prototype,"angle",void 0),i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],i);let p=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP,this.ySize=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"xScale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"yScale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"xSize",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"ySize",void 0),p=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],p)},"./node_modules/@arcgis/core/views/interactive/tooltip/TranslateTooltipInfos.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$E:()=>r,QW:()=>p,c1:()=>c,in:()=>a,j:()=>l,nk:()=>n});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/quantityUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),_SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/interactive/tooltip/SketchTooltipInfo.js");let r=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-graphic",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],r.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],r.prototype,"distance",void 0),r=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],r);let p=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-graphic-z",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],p.prototype,"distance",void 0),p=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],p);let a=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-graphic-xy",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],a.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],a.prototype,"distance",void 0),a=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],a);let n=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-vertex",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],n.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],n.prototype,"distance",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],n.prototype,"elevation",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],n.prototype,"area",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],n.prototype,"totalLength",void 0),n=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],n);let l=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-vertex-z",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP,this.elevation=null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],l.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],l.prototype,"distance",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],l.prototype,"elevation",void 0),l=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],l);let c=class extends _SketchTooltipInfo_js__WEBPACK_IMPORTED_MODULE_3__.h{constructor(t){super(t),this.type="translate-vertex-xy",this.distance=_core_quantityUtils_js__WEBPACK_IMPORTED_MODULE_0__.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],c.prototype,"type",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],c.prototype,"distance",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],c.prototype,"elevation",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],c.prototype,"area",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.Cb)()],c.prototype,"totalLength",void 0),c=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_4__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_2__.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],c)}}]);
//# sourceMappingURL=3078.239c0758.iframe.bundle.js.map