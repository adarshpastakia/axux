"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[9877],{"./node_modules/@arcgis/core/views/2d/engine/Bitmap.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{JZ:()=>w,RL:()=>b,eY:()=>T});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),_DisplayObject_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),_ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js"),_webgl_contextUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/contextUtils.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),_webgl_Texture_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),_webgl_TextureDescriptor_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/TextureDescriptor.js");function w(t){return t&&"render"in t}function b(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.render(e.getContext("2d")),e}class T extends _DisplayObject_js__WEBPACK_IMPORTED_MODULE_4__.s{constructor(t=null,e=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){null==t&&null==this._source||(this._source=t,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}async setSourceAsync(t,i){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const r=new AbortController,h=(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.hh)();return(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.$F)(i,(()=>r.abort())),(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.$F)(r,(t=>h.reject(t))),this._uploadStatus={controller:r,resolver:h},this.source=t,h.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(t,e){t>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(t,e)}setTransform(t){const e=(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.transforms.dvs),[s,i]=t.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/t.resolution,l=n*this.width,c=n*this.height,_=Math.PI*this.rotation/180;(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(s,i)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(l/2,c/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.r)(e,e,-_),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(-l/2,-c/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.l)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(l,c)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.m)(this.transforms.dvs,t.displayViewMat3,e)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}async updateTexture({context:t,painter:e}){if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(t)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const s=function v(e){return w(e)?e instanceof _ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__.Z?(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.yw)(e.getRenderedRasterPixels(),(t=>t.renderedRasterPixels)):b(e):e}(this.source);try{if(null!=this._uploadStatus){const{controller:t,resolver:i}=this._uploadStatus,r={signal:t.signal},{width:h,height:o}=this,u=this._texture,a=e.textureUploadManager;await a.enqueueTextureUpdate({data:s,texture:u,width:h,height:o},r),i.resolve(),this._uploadStatus=null}else this._texture.setData(s);this.ready()}catch(r){(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.H9)(r)}}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.c)()}}_createTexture(t){const e=this.immutable&&t.type===_webgl_contextUtils_js__WEBPACK_IMPORTED_MODULE_5__.zO.WEBGL2,s=new _webgl_TextureDescriptor_js__WEBPACK_IMPORTED_MODULE_8__.X;return s.internalFormat=e?_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.lP.RGBA8:_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.VI.RGBA,s.wrapMode=_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.e8.CLAMP_TO_EDGE,s.isImmutable=e,s.width=this._sourceWidth,s.height=this._sourceHeight,new _webgl_Texture_js__WEBPACK_IMPORTED_MODULE_7__.x(t,s)}}},"./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>a});var _brushes_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/brushes.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js");class a extends _webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__.Z{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(r){const a=r.registerRenderPass({name:"bitmap",brushes:[_brushes_js__WEBPACK_IMPORTED_MODULE_0__.U.bitmap],target:()=>this.children,drawPhase:_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__.jx.MAP});return[...super.prepareRenderPasses(r),a]}_manageFade(){this.children.reduce(((e,s)=>e+(s.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},"./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>o});var promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),Queue=__webpack_require__("./node_modules/@arcgis/core/core/Queue.js"),AttributeStoreView=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AttributeStoreView.js"),TileContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),lengthUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),Technique=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/Technique.js"),utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/utils.js"),capabilities=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities.js");function n(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}class v{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=Technique.v}getSizeVVFieldStops(e){const t=this._vvSizeFieldStops;if(t)switch(t.type){case"static":return t;case"level-dependent":return t.levels[e]??(()=>{let i=1/0,s=0;for(const o in t.levels){const t=parseFloat(o),a=Math.abs(e-t);a<i&&(i=a,s=t)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const a=2**((e-s)/2),l=t.levels[s],r=new Float32Array(l.values);return r[2]*=a,r[3]*=a,{sizes:l.sizes,values:r}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){this._updateEffects(i),this._vvInfo=t,this._technique=(0,utils.EJ)(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,capabilities.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(e){this.outsideLabelsVisible=null!=e&&e.excludedLabelsVisible}_updateVisualVariables(l,r){const o=this._vvMaterialParameters;if(o.vvOpacityEnabled=!1,o.vvSizeEnabled=!1,o.vvColorEnabled=!1,o.vvRotationEnabled=!1,!l)return;const v=l.size;if(v){if(o.vvSizeEnabled=!0,v.minMaxValue){const t=v.minMaxValue;let i,l;if((0,Utils.$K)(t.minSize)&&(0,Utils.$K)(t.maxSize))if((0,Utils.hj)(t.minSize)&&(0,Utils.hj)(t.maxSize))i=(0,screenUtils.F2)(t.minSize),l=(0,screenUtils.F2)(t.maxSize);else{const s=r.scale;i=(0,screenUtils.F2)(n(s,t.minSize.stops)),l=(0,screenUtils.F2)(n(s,t.maxSize.stops))}this.vvSizeMinMaxValue.set([t.minDataValue,t.maxDataValue,i,l])}if(v.scaleStops&&(this.vvSizeScaleStopsValue=(0,screenUtils.F2)(n(r.scale,v.scaleStops.stops))),v.unitValue){const e=(0,unitUtils.c9)(r.spatialReference)/lengthUtils.a[v.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/r.resolution}v.fieldStops&&(this._vvSizeFieldStops=v.fieldStops)}const u=l.color;u&&(o.vvColorEnabled=!0,this.vvColorValues.set(u.values),this.vvColors.set(u.colors));const c=l.opacity;c&&(o.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));const h=l.rotation;h&&(o.vvRotationEnabled=!0,o.vvRotationType=h.type)}}class o extends TileContainer.Z{constructor(e){super(e),this._rendererInfo=new v,this._materialItemsRequestQueue=new Queue.Z,this.attributeView=new AttributeStoreView.H((()=>this.onAttributeStoreUpdate()))}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return[];const s=(0,promiseUtils.hh)();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}updateTransforms(e){if(this.children.some((e=>e.hasData)))for(const t of this.children)t.setTransform(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,a=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(a).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}},"./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>l});class l{constructor(l,e,t){this.pixelBlock=l,this.extent=e,this.originalPixelBlock=t}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(l){const e=this.pixelBlock;if(null==e)return;const t=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??e});if(null==t.pixelBlock)return;t.pixelBlock.maskIsAlpha&&(t.pixelBlock.premultiplyAlpha=!0);const i=t.pixelBlock.getAsRGBA(),h=l.createImageData(t.pixelBlock.width,t.pixelBlock.height);h.data.set(i),l.putImageData(h,0,0)}getRenderedRasterPixels(){const l=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==l.pixelBlock?null:(l.pixelBlock.maskIsAlpha&&(l.pixelBlock.premultiplyAlpha=!0),{width:l.pixelBlock.width,height:l.pixelBlock.height,renderedRasterPixels:new Uint8Array(l.pixelBlock.getAsRGBA().buffer)})}}},"./node_modules/@arcgis/core/views/2d/layers/ImageryLayerView2D.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>b});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),GraphicsCollection=__webpack_require__("./node_modules/@arcgis/core/support/GraphicsCollection.js"),FlowView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/flow/FlowView2D.js"),LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),GraphicsView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),HighlightGraphicContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),pixelUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/rasterFunctions/pixelUtils.js"),BitmapContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js"),Container=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Container.js"),ImageryBitmapSource=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js"),ExportStrategy=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js");let m=class extends Accessor.Z{constructor(){super(...arguments),this.attached=!1,this.container=new Container.W,this.updateRequested=!1,this.type="imagery",this._bitmapView=new BitmapContainer.c}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(t){this.strategy.update(t).catch((t=>{(0,promiseUtils.D_)(t)||Logger.Z.getLogger(this).error(t)}))}hitTest(t){return new Graphic.Z({attributes:{},geometry:t.clone(),layer:this.layer})}attach(){this.container.addChild(this._bitmapView);const t=this.layer.version>=10,e=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new ExportStrategy.Z({container:this._bitmapView,imageNormalizationSupported:t,imageMaxHeight:e,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}redraw(){this.strategy.updateExports((async t=>{const{source:e}=t;if(!e||e instanceof ImageBitmap)return;const i=await this.layer.applyRenderer({extent:e.extent,pixelBlock:e.originalPixelBlock??e.pixelBlock});e.filter=t=>this.layer.pixelFilter?this.layer.applyFilter(t):{...i,extent:e.extent}})).catch((t=>{(0,promiseUtils.D_)(t)||Logger.Z.getLogger(this).error(t)}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const t=this.strategy.bitmaps;if(1===t.length&&t[0].source)return{extent:t[0].source.extent,pixelBlock:t[0].source.originalPixelBlock};if(t.length>1){const e=this.view.extent,i=t.map((t=>t.source)).filter((t=>t.extent&&t.extent.intersects(e))).map((t=>({extent:t.extent,pixelBlock:t.originalPixelBlock}))),r=(0,pixelUtils.Kh)(i,e);return null!=r?{extent:r.extent,pixelBlock:r.pixelBlock}:null}return null}async _fetchImage(t,e,i,r){(r=r||{}).timeExtent=this.timeExtent,r.requestAsImageElement=!0,r.returnImageBitmap=!0;const s=await this.layer.fetchImage(t,e,i,r);if(s.imageBitmap)return s.imageBitmap;const a=await this.layer.applyRenderer(s.pixelData,{signal:r.signal}),o=new ImageryBitmapSource.Z(a.pixelBlock,a.extent?.clone(),s.pixelData.pixelBlock);return o.filter=t=>this.layer.applyFilter(t),o}};(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"attached",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"strategy",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"timeExtent",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"updateRequested",void 0),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],m.prototype,"type",void 0),m=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.imagery.ImageryView2D")],m);const u=m;var request=__webpack_require__("./node_modules/@arcgis/core/request.js"),HandleOwner=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),rasterProjectionHelper=__webpack_require__("./node_modules/@arcgis/core/layers/support/rasterFunctions/rasterProjectionHelper.js"),vectorFieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/rasterFunctions/vectorFieldUtils.js"),BrushVectorField=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/imagery/BrushVectorField.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),WGLContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js");class t extends WGLContainer.Z{constructor(){super(...arguments),this.symbolTypes=["triangle"]}get requiresDedicatedFBO(){return!1}prepareRenderPasses(s){const t=s.registerRenderPass({name:"imagery (vf)",brushes:[BrushVectorField.Z],target:()=>this.children,drawPhase:enums.jx.MAP});return[...super.prepareRenderPasses(s),t]}doRender(e){this.visible&&e.drawPhase===enums.jx.MAP&&this.symbolTypes.forEach((r=>{e.renderPass=r,super.doRender(e)}))}}var RasterVFDisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFDisplayObject.js");let c=class extends Accessor.Z{constructor(e){super(e),this._loading=null,this.update=(0,promiseUtils.Ds)(((e,t)=>this._update(e,t).catch((e=>{(0,promiseUtils.D_)(e)||Logger.Z.getLogger(this).error(e)}))))}get updating(){return!!this._loading}redraw(e){if(!this.container.children.length)return;const t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}async _update(e,t,r){if(!e.stationary)return;const{extent:i,spatialReference:s}=e.state,o=new Extent.Z({xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax,spatialReference:s}),[a,l]=e.state.size;this._loading=this.fetchPixels(o,a,l,r);const c=await this._loading;this._addToDisplay(c,t,e.state),this._loading=null}_addToDisplay(e,t,r){if(null==e.pixelBlock)return this.container.children.forEach((e=>e.destroy())),void this.container.removeAllChildren();const{extent:i,pixelBlock:s}=e,o=new RasterVFDisplayObject.F(s);o.offset=[0,0],o.symbolizerParameters=t,o.rawPixelData=e,o.invalidateVAO(),o.x=i.xmin,o.y=i.ymax,o.pixelRatio=r.pixelRatio,o.rotation=r.rotation,o.resolution=r.resolution,o.width=s.width*t.symbolTileSize,o.height=s.height*t.symbolTileSize,this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(o)}};(0,tslib_es6._)([(0,property.Cb)()],c.prototype,"fetchPixels",void 0),(0,tslib_es6._)([(0,property.Cb)()],c.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],c.prototype,"_loading",void 0),(0,tslib_es6._)([(0,property.Cb)()],c.prototype,"updating",null),c=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.imagery.ImageryVFStrategy")],c);const p=c;let VectorFieldView2D_u=class extends HandleOwner.r{constructor(){super(...arguments),this.attached=!1,this.container=new t,this.type="imageryVF",this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""},this._fetchpixels=async(t,e,r,i)=>{const s=await this._projectFullExtentPromise,{symbolTileSize:a}=this.layer.renderer,{extent:o,width:n,height:l}=(0,vectorFieldUtils.BH)(t,e,r,a,s);if(null!=s&&!s.intersects(t))return{extent:o,pixelBlock:null};const c={bbox:`${o.xmin}, ${o.ymin}, ${o.xmax}, ${o.ymax}`,exportParametersVersion:this.layer.exportImageServiceParameters.version,symbolTileSize:a,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(c)){const t=this.getPixelData();if(null!=t&&`${t.extent.xmin}, ${t.extent.ymin}, ${t.extent.xmax}, ${t.extent.ymax}`===c.bbox)return t}const{pixelData:h}=await this.layer.fetchImage(o,n,l,{timeExtent:this.timeExtent,requestAsImageElement:!1,signal:i});this._dataParameters=c;const y=h?.pixelBlock;return null==y?{extent:o,pixelBlock:null}:{extent:o,pixelBlock:"vector-uv"===this.layer.rasterInfo.dataType?(0,vectorFieldUtils.KC)(y,"vector-uv"):y}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference),this._strategy=new p({container:this.container,fetchPixels:this._fetchpixels}),this.handles.add((0,reactiveUtils.YP)((()=>this.layer.renderer),(t=>this._updateSymbolizerParams(t)),reactiveUtils.tX),"attach")}detach(){this._strategy.destroy(),this.container.children.forEach((t=>t.destroy())),this.container.removeAllChildren(),this.handles.remove("attach"),this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const t=this.container.children[0]?.rawPixelData;if(this.updating||!t)return null;const{extent:e,pixelBlock:r}=t;return{extent:e,pixelBlock:r}}hitTest(t){return new Graphic.Z({attributes:{},geometry:t.clone(),layer:this.layer})}update(t){this._strategy.update(t,this._symbolizerParams)}redraw(){const{renderer:t}=this.layer;t&&(this._updateSymbolizerParams(t),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(t){const e=this._dataParameters.exportParametersVersion===t.exportParametersVersion,r=this._dataParameters.time===t.time,i=this._dataParameters.symbolTileSize===t.symbolTileSize,s=this._dataParameters.bbox===t.bbox;return e&&r&&i&&s}async _getProjectedFullExtent(t){try{return await(0,rasterProjectionHelper.tB)(this.layer.fullExtent,t)}catch(e){try{const e=(await(0,request.default)(this.layer.url,{query:{option:"footprints",outSR:t.wkid||JSON.stringify(t.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return e?Extent.Z.fromJSON(e):null}catch{return null}}}_updateSymbolizerParams(t){"vector-field"===t.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}};(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"attached",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"timeExtent",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)()],VectorFieldView2D_u.prototype,"updating",null),VectorFieldView2D_u=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.imagery.VectorFieldView2D")],VectorFieldView2D_u);const d=VectorFieldView2D_u;var Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),commonProperties=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),popupUtils=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js");const n=n=>{let u=class extends n{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)throw new Error.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o});const{popupEnabled:p}=o,n=(0,popupUtils.V5)(o,t);if(!p||null==n)throw new Error.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:n});const u=await n.getRequiredFields(),l=new Query.Z;l.timeExtent=this.timeExtent,l.geometry=e,l.outFields=u,l.outSpatialReference=e.spatialReference;const{resolution:m,spatialReference:c}=this.view,y="2d"===this.view.type?new Point.Z(m,m,c):new Point.Z(.5*m,.5*m,c),{returnTopmostRaster:d,showNoDataRecords:h}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:y,showNoDataRecords:h,signal:null!=t?t.signal:null};return o.queryVisibleRasters(l,w).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,tslib_es6._)([(0,property.Cb)()],u.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],u.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)(commonProperties.qG)],u.prototype,"timeExtent",void 0),(0,tslib_es6._)([(0,property.Cb)()],u.prototype,"view",void 0),u=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.ImageryLayerView")],u),u};var LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),RefreshableLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js");let g=class extends(n((0,RefreshableLayerView.Z)((0,LayerView2D.y)(LayerView.Z)))){constructor(){super(...arguments),this._exportImageVersion=-1,this._highlightGraphics=new GraphicsCollection.J,this._highlightView=void 0,this.layer=null,this.subview=null}get pixelData(){const{subview:e}=this;return this.updating||!e?null:"getPixelData"in e?e.getPixelData():null}async hitTest(e,t){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(e),layer:this.layer,mapPoint:e}]:null}update(e){this.subview?.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.view&&(this._highlightView=new GraphicsView2D.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new HighlightGraphicContainer.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container)),this.addAttachHandles([(0,reactiveUtils.YP)((()=>this.layer.blendMode??"normal"),(e=>this.subview&&(this.subview.container.blendMode=e)),reactiveUtils.tX),(0,reactiveUtils.YP)((()=>this.layer.effect??null),(e=>this.subview&&(this.subview.container.effect=e)),reactiveUtils.tX),(0,reactiveUtils.YP)((()=>this.layer.exportImageServiceParameters.version),(e=>{e&&this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),reactiveUtils.Z_),(0,reactiveUtils.YP)((()=>this.timeExtent),(e=>{const{subview:t}=this;t&&(t.timeExtent=e,"redraw"in t?this.requestUpdate():t.redrawOrRefetch())}),reactiveUtils.Z_),this.layer.on("redraw",(()=>{const{subview:e}=this;e&&("redraw"in e?e.redraw():e.redrawOrRefetch())})),(0,reactiveUtils.YP)((()=>this.layer.renderer),(()=>this._setSubView()))])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.container.removeAllChildren(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null,this._highlightView?.destroy(),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,r){if(!((Array.isArray(e)?e[0]:Collection.Z.isCollection(e)?e.at(0):e)instanceof Graphic.Z))return{remove:()=>{}};let s=[];return Array.isArray(e)||Collection.Z.isCollection(e)?s=e.map((e=>e.clone())):e instanceof Graphic.Z&&(s=[e.clone()]),this._highlightGraphics.addMany(s),{remove:()=>{this._highlightGraphics.removeMany(s)}}}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||this.subview.updating}_setSubView(){if(!this.view)return;const e=this.layer.renderer?.type;let t="imagery";if("vector-field"===e?t="imageryVF":"flow"===e&&(t="flow"),this.subview){const{type:e}=this.subview;if(e===t)return this._attachSubview(this.subview),void("flow"===e?this.subview.redrawOrRefetch():"imagery"===e&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate());this._detachSubview(this.subview),this.subview?.destroy()}this.subview="imagery"===t?new u({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===t?new d({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new FlowView2D.Z({layer:this.layer,layerView:this}),this._attachSubview(this.subview),this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}};(0,tslib_es6._)([(0,property.Cb)()],g.prototype,"pixelData",null),(0,tslib_es6._)([(0,property.Cb)()],g.prototype,"subview",void 0),g=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.ImageryLayerView2D")],g);const b=g},"./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>n});var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),FeatureContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),vec2f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),vec3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js");const v=Math.PI/180;class b extends DisplayObject.s{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,mat3f32.c)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,maybe.M2)(this._program)}doRender(t){const{context:e}=t,r=this._getBounds();if(r.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,r),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(enums.zi.ONE,enums.zi.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const s=this._program;e.bindVAO(this._vao),e.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(enums.MX.LINES,8*r.length,enums.g.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{dvs:(0,mat3f32.c)()}}_createShaderProgram(t){if(this._program)return;this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",y().attributes)}_updateMatricesAndLocalOrigin(t){const{state:a}=t,{displayMat3:u,size:_,resolution:c,pixelRatio:h,rotation:m,viewpoint:d}=a,p=v*m,{x:g,y:x}=d.targetGeometry,b=(0,normalizeUtils.or)(g,a.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const y=h*_[0],B=h*_[1],M=c*y,j=c*B,A=(0,mat3.g)(this._dvsMat3);(0,mat3.m)(A,A,u),(0,mat3.h)(A,A,(0,vec2f32.f)(y/2,B/2)),(0,mat3.d)(A,A,(0,vec3f32.f)(_[0]/M,-B/j,1)),(0,mat3.r)(A,A,-p)}_updateBufferData(t,e){const{x:r,y:s}=this._localOrigin,i=8*e.length,o=new Float32Array(i),a=new Uint32Array(8*e.length);let n=0,f=0;for(const l of e)l&&(o[2*n]=l[0]-r,o[2*n+1]=l[1]-s,o[2*n+2]=l[0]-r,o[2*n+3]=l[3]-s,o[2*n+4]=l[2]-r,o[2*n+5]=l[3]-s,o[2*n+6]=l[2]-r,o[2*n+7]=l[1]-s,a[f]=n+0,a[f+1]=n+3,a[f+2]=n+3,a[f+3]=n+2,a[f+4]=n+2,a[f+5]=n+1,a[f+6]=n+1,a[f+7]=n+0,n+=4,f+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=BufferObject.f.createVertex(t,enums.l1.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=BufferObject.f.createIndex(t,enums.l1.DYNAMIC_DRAW,a),!this._vao){const e=y();this._vao=new VertexArrayObject.U(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const y=()=>(0,Utils.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:enums.g.FLOAT}]});let n=class extends FeatureContainer.T{constructor(e){super(e),this.hasHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,maybe.SC)(this._boundsRenderer)}enableRenderingBounds(e){this._boundsRenderer=new b(e),this.requestRender()}get hasLabels(){return!1}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(const r of this.children)r.isReady&&r.hasData&&(r.commit(e),e.context.setStencilFunction(enums.wb.EQUAL,r.stencilRef,255),r.getDisplayList().replay(e,r,t))}}},"./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>n});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");let i=class extends _BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_7__.Z{doRender(e){e.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.jx.HIGHLIGHT&&super.doRender(e)}renderChildren(e){if(this.attributeView.update(),!this.children.some((e=>e.hasData)))return;this.attributeView.bindTextures(e.context),super.renderChildren(e);const{painter:r}=e,s=r.effects.highlight;s.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(_webgl_enums_js__WEBPACK_IMPORTED_MODULE_8__.lk.COLOR_BUFFER_BIT),this._renderChildren(e,s.defines.concat(["highlightAll"])),s.draw(e),s.unbind()}};i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],i);const n=i},"./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>v});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),promiseUtils=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js")),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),TileInfo=__webpack_require__("./node_modules/@arcgis/core/layers/support/TileInfo.js");const t=Math.PI/180;function n(n){return n*t}function o(t,o){const a=n(o.rotation),r=Math.abs(Math.cos(a)),s=Math.abs(Math.sin(a)),[u,c]=o.size;return t[0]=Math.round(c*s+u*r),t[1]=Math.round(c*r+u*s),t}var Bitmap=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Bitmap.js"),TileInfoView=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),TileKey=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js");const y=(0,aaBoundingRect.Ue)(),x=[0,0],S=new TileKey.Z(0,0,0,0),__imageMaxWidth=2048,__imageMaxHeight=2048,__imageRotationSupported=!1,__imageNormalizationSupported=!1,__hidpi=!1;let w=class extends Accessor.Z{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=__hidpi,this.imageMaxWidth=__imageMaxWidth,this.imageMaxHeight=__imageMaxHeight,this.imageRotationSupported=__imageRotationSupported,this.imageNormalizationSupported=__imageNormalizationSupported,this.update=(0,promiseUtils.Ds)((async(t,e)=>{if((0,promiseUtils.k_)(e),!t.stationary||this.destroyed)return;const i=t.state,s=(0,spatialReferenceUtils.C5)(i.spatialReference),a=this.hidpi?t.pixelRatio:1,p=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0],n=this.imageMaxWidth??0,m=this.imageMaxHeight??0;p?(x[0]=i.worldScreenWidth,x[1]=i.size[1]):this.imageRotationSupported?(x[0]=i.size[0],x[1]=i.size[1]):o(x,i);const h=Math.floor(x[0]*a)>n||Math.floor(x[1]*a)>m,c=s&&(i.extent.xmin<s.valid[0]||i.extent.xmax>s.valid[1]),u=!this.imageNormalizationSupported&&c,g=!h&&!u,f=this.imageRotationSupported?i.rotation:0,y=this.container.children.slice();if(g){const t=p?i.paddedViewState.center:i.center;this._imagePromise&&console.error("Image promise was not defined!"),this._imagePromise=this._singleExport(i,x,t,i.resolution,f,a,e)}else{let t=Math.min(n,m);u&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,a,e)}try{const t=await this._imagePromise??[];(0,promiseUtils.k_)(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t;for(const e of y)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(S){this._imagePromise=null,(0,promiseUtils.r9)(S)}}),5e3),this.updateExports=(0,promiseUtils.Ds)((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,promiseUtils.as)(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,r,s,a){const p=await this.fetchSource(t,Math.floor(e*s),Math.floor(i*s),{rotation:r,pixelRatio:s,signal:a});(0,promiseUtils.k_)(a);const n=new Bitmap.eY(null,!0);return n.x=t.xmin,n.y=t.ymax,n.resolution=t.width/e,n.rotation=r,n.pixelRatio=s,n.opacity=0,this.container.addChild(n),await n.setSourceAsync(p,a),(0,promiseUtils.k_)(a),n}async _singleExport(t,e,i,o,r,s,a){!function viewStateUtils_a(t,n,o,a){const[r,s]=n,[u,c]=a,h=.5*o;return t[0]=r-h*u,t[1]=s-h*c,t[2]=r+h*u,t[3]=s+h*c,t}(y,i,o,e);const p=(0,aaBoundingRect.HH)(y,t.spatialReference);return[await this._export(p,e[0],e[1],r,s,a)]}_tiledExport(t,e,i,o){const r=TileInfo.Z.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),s=new TileInfoView.Z(r),a=s.getTileCoverage(t);if(!a)return null;const p=[];return a.forEach(((r,a,n,l)=>{S.set(r,a,n,0),s.getTileBounds(y,S);const h=(0,aaBoundingRect.HH)(y,t.spatialReference);p.push(this._export(h,e,e,0,i,o).then((t=>(0!==l&&(S.set(r,a,n,l),s.getTileBounds(y,S),t.x=y[0],t.y=y[3]),t))))})),Promise.all(p)}};(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"_imagePromise",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"bitmaps",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"fetchSource",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"hidpi",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"imageMaxWidth",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"imageMaxHeight",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"imageRotationSupported",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"imageNormalizationSupported",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"requestUpdate",void 0),(0,tslib_es6._)([(0,property.Cb)()],w.prototype,"updating",null),w=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.support.ExportStrategy")],w);const v=w}}]);