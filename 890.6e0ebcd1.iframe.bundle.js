"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[890],{"./node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>I});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_85__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/support/GraphicsCollection.js"),_graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_62__=(__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),__webpack_require__("./node_modules/@arcgis/core/request.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/index2.js"),__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/index3.js"),__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/HighlightGradient.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/BufferPool.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/BrushBitmap.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BackgroundPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/context-util.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/core/RandomLCG.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/materialKey/MaterialKey.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/Technique.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/dotDensity/TechniqueDotDensity.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/heatmap/TechniqueHeatmap.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/pieChart/TechniquePieChart.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushHeatmap.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DefaultVertexAttributeLayouts.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/TileInfoPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker.js"),__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/style/StyleDefinition.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/sources/resolver.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BitBlitPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/sources/resolver.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TextureManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/StencilPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/effects/BlendEffect.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/HighlightPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Profiler.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js"),__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/OrderIndependentTransparency.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/webgl-debug.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/LabelManager.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js")),_BitmapTileLayerView2D_js__WEBPACK_IMPORTED_MODULE_73__=(__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AttributeStoreView.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/navigation/MapViewNavigation.js"),__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/MagnifierPrograms.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js")),_LayerView2D_js__WEBPACK_IMPORTED_MODULE_74__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),_graphics_HighlightGraphicContainer_js__WEBPACK_IMPORTED_MODULE_75__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js"),_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_84__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js"),_tiling_TileInfoView_js__WEBPACK_IMPORTED_MODULE_76__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js"),_tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_77__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js"),_tiling_TileQueue_js__WEBPACK_IMPORTED_MODULE_78__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileQueue.js"),_tiling_TileStrategy_js__WEBPACK_IMPORTED_MODULE_79__=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileStrategy.js"),_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_80__=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),_layers_RefreshableLayerView_js__WEBPACK_IMPORTED_MODULE_81__=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"),_layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_82__=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/MapServiceLayerViewHelper.js"),_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_83__=__webpack_require__("./node_modules/@arcgis/core/views/support/drapedUtils.js");const T=[0,0];let v=class extends((0,_layers_RefreshableLayerView_js__WEBPACK_IMPORTED_MODULE_81__.Z)((0,_BitmapTileLayerView2D_js__WEBPACK_IMPORTED_MODULE_73__.Y)((0,_LayerView2D_js__WEBPACK_IMPORTED_MODULE_74__.y)(_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_80__.Z)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new _support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_8__.J,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this._highlightView?.processUpdate(e)}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null;if(this._tileInfoView=new _tiling_TileInfoView_js__WEBPACK_IMPORTED_MODULE_76__.Z(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new _tiling_TileQueue_js__WEBPACK_IMPORTED_MODULE_78__.Z({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,i)=>this.fetchTile(e,i)}),this._tileStrategy=new _tiling_TileStrategy_js__WEBPACK_IMPORTED_MODULE_79__.Z({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),(0,_layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_82__.Uf)(this,this.layer)){const e=this._highlightView=new _graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_62__.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _graphics_HighlightGraphicContainer_js__WEBPACK_IMPORTED_MODULE_75__.Z(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new _layers_support_MapServiceLayerViewHelper_js__WEBPACK_IMPORTED_MODULE_82__.VF({createFetchPopupFeaturesQueryGeometry:(e,i)=>(0,_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_83__.K)(e,i,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(i,t)=>{e.graphicUpdateHandler({graphic:i,property:t})},layerView:this,updatingHandles:this.updatingHandles})}this.requestUpdate(),this.addAttachHandles((0,_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__.YP)((()=>this.resampling),(()=>{this.doRefresh()}))),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._popupHighlightHelper?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}async fetchPopupFeatures(e,i){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(e,i):[]}highlight(e){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(e):{remove(){}}}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_7__.fS)(this.layer.tileInfo?.spatialReference,e)}async doRefresh(){!this.attached||this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))))}isUpdating(){return this._fetchQueue?.updating??!1}acquireTile(e){const i=this._bitmapView.createTile(e),t=i.bitmap;return[t.x,t.y]=this._tileInfoView.getTileCoords(T,i.key),t.resolution=this._tileInfoView.getTileResolution(i.key),[t.width,t.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(i),this._bitmapView.addChild(i),this.requestUpdate(),i}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i={}){const r="tilemapCache"in this.layer?this.layer.tilemapCache:null,{signal:s,resamplingLevel:o=0}=i;if(!r)try{return await this._fetchImage(e,s)}catch(a){if(!(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_1__.D_)(a)&&!this.resampling)return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_84__.V)(this._tileInfoView.tileInfo.size);if(o<3){const t=this._tileInfoView.getTileParentId(e.id);if(t){const r=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_77__.Z(t),s=await this.fetchTile(r,{...i,resamplingLevel:o+1});return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_84__.i)(this._tileInfoView,s,r,e)}}throw a}const l=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_77__.Z(0,0,0,0);let h;try{if(await r.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:s}),l.level!==e.level&&!this.resampling)return(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_84__.V)(this._tileInfoView.tileInfo.size);h=await this._fetchImage(l,s)}catch(a){if((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_1__.D_)(a))throw a;h=await this._fetchImage(e,s)}return this.resampling?(0,_support_imageUtils_js__WEBPACK_IMPORTED_MODULE_84__.i)(this._tileInfoView,h,l,e):h}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const i=await this._fetchQueue.push(e.key);e.bitmap.source=i,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once("attach",(()=>this.requestUpdate()))}catch(r){(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_1__.D_)(r)||_core_Logger_js__WEBPACK_IMPORTED_MODULE_0__.Z.getLogger(this.declaredClass).error(r)}this.requestUpdate()}}async _fetchImage(e,i){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:i})}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_85__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],v.prototype,"_fetchQueue",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_85__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],v.prototype,"resampling",null),v=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_85__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.j)("esri.views.2d.layers.TileLayerView2D")],v);const I=v}}]);