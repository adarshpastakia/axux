/*! For license information please see 71455.3e45429f.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[71455],{"./packages/data/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{oq:()=>AxTreePanel,Iz:()=>AxVirtualItem,ZR:()=>AxVirtualList});var dist=__webpack_require__("./packages/core/dist/index.js");const ar_namespaceObject=JSON.parse('{"label":{"noRecords":"لا تسجيلات"},"tree":{"noItems":"لا توجد عناصر","error":"خطأ في تحميل العناصر","loading":"تحميل العناصر…"},"datagrid":{"empty":"لا توجد سجلات متاحة"},"json":{"empty":"لا توجد خصائص بيانات","true":"نعم","false":"رقم"},"checkList":{"empty":"لا توجد عناصر قائمة"},"histogram":{"empty":"لا توجد رسوم بيانية"},"action":{"find":"تجد…","copy":"قيمة النسخ","filter":"منقي…","showShortcuts":"اختصارات لوحة المفاتيح…","collapseAll":"انهيار جميع","expandAll":"توسيع الكل","checkAll":"تحقق من الكل","uncheckAll":"الغاءالكل","addFilter":"أضف عامل تصفية","addFilterNot":"إضافة لا تصفية"}}'),en_namespaceObject=JSON.parse('{"label":{"noRecords":"No Records"},"tree":{"noItems":"No items","error":"Error loading items","loading":"Loading items..."},"datagrid":{"empty":"No records available"},"json":{"empty":"No data properties","true":"Yes","false":"No"},"checkList":{"empty":"No list items"},"histogram":{"empty":"No histograms"},"action":{"find":"Find...","copy":"Copy Value","filter":"Filter...","showShortcuts":"Keyboard shortcuts...","collapseAll":"Collapse All","expandAll":"Expand All","checkAll":"Check All","uncheckAll":"Uncheck All","addFilter":"Add Filter","addFilterNot":"Add not Filter"}}'),graph_ar_namespaceObject=JSON.parse('{"action":{"brushSelect":"حدد الفرشاة","cancel":"يلغي","clear":"رسم بياني واضح","delete":"يمسح","expand":"قم بتوسيع العقدة","fitView":"صالح للعرض","hilight":"اتصالات هايلايت","lassoSelect":"حدد لاسو","layoutAuto":"تخطيط تلقائي","layoutGrid":"تخطيط الشبكة","layoutHierarchy":"تخطيط التسلسل الهرمي","layoutRadial":"تخطيط شعاعي","neighbors":"حدد الجيران","selectAll":"اختر الكل","startSelect":"ابدأ بالاختيار","zoomin":"تكبير","zoomout":"تصغير"}}'),graph_en_namespaceObject=JSON.parse('{"action":{"brushSelect":"Brush select","cancel":"Cancel","clear":"Clear graph","delete":"Delete","expand":"Expand node","fitView":"Fit to view","hilight":"Hilight connections","lassoSelect":"Lasso select","layoutAuto":"Auto layout","layoutGrid":"Grid layout","layoutHierarchy":"Hierarchy layout","layoutRadial":"Radial layout","neighbors":"Select neighbors","selectAll":"Select all","startSelect":"Start select","zoomin":"Zoom in","zoomout":"Zoom out"}}');(0,dist.Rp)("data",{en:en_namespaceObject,ar:ar_namespaceObject}),(0,dist.Rp)("graph",{en:graph_en_namespaceObject,ar:graph_ar_namespaceObject});var react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),hooks_useBadge=__webpack_require__("./packages/core/dist/hooks/useBadge.js"),appIcons=__webpack_require__("./packages/core/dist/types/appIcons.js"),utilities_dist=__webpack_require__("./packages/utilities/dist/index.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js");var animations=__webpack_require__("./packages/core/dist/animations/index.js"),handlers=__webpack_require__("./packages/utilities/dist/handlers.js"),date_dist=__webpack_require__("./packages/date/dist/index.js");const DatagridContext=(0,react.createContext)({}),DatagridProvider=({children,columns=[],data=[],className,isSelectable,onRowSelect,sort,onSort,onRowExpand,datagridRef,lastScroll,onScroll,canExpand,...props})=>{const ghostRef=(0,react.useRef)(null),[widths,setWidths]=(0,react.useState)(new Map),refBody=(0,react.useRef)(null);(0,react.useEffect)((()=>{refBody.current?.scrollTo({top:0,behavior:"auto"})}),[data]),(0,react.useImperativeHandle)(datagridRef,(()=>({hilight:row=>{refBody.current?.querySelectorAll(".ax-datagrid__row.hilight").forEach((el=>el?.classList.remove("hilight")));const el=refBody.current?.querySelector(`[data-row="${row}"]`);el?.scrollIntoView({behavior:"smooth",block:"center"}),el?.classList.add("hilight")},unhilight:()=>{refBody.current?.querySelectorAll(".ax-datagrid__row.hilight").forEach((el=>el?.classList.remove("hilight")))},scrollTo:row=>{const el=refBody.current?.querySelector(`[data-row="${row}"]`);el?.scrollIntoView({behavior:"smooth"})}})),[]),(0,react.useEffect)((()=>{setWidths(new Map(columns.map((({name,width,minWidth=0,maxWidth=999})=>[name.toString(),width??Math.min(Math.max(180,minWidth),maxWidth)]))))}),[columns]);const startResize=(0,react.useCallback)((e=>{const colEl=e.currentTarget.closest(".ax-datagrid__header--cell");colEl&&null!=ghostRef.current&&((colEl,ghostEl,callback)=>{const placeholder=ghostEl.firstElementChild,isRtl="rtl"===getComputedStyle(colEl).direction,onResize=evt=>{const box=colEl.getBoundingClientRect(),x=isRtl?box.left-evt.clientX:evt.clientX-box.right;placeholder.style.width=`${colEl.offsetWidth+x}px`},onResizeEnd=()=>{callback(placeholder.offsetWidth),ghostEl.style.display="none",document.removeEventListener("mousemove",onResize),document.removeEventListener("mouseup",onResizeEnd)},box=colEl.getBoundingClientRect();if(null!=colEl.parentElement){const parentBox=colEl.parentElement?.getBoundingClientRect();isRtl?(placeholder.style.left="unset",placeholder.style.right=parentBox.right-box.right+"px"):(placeholder.style.right="unset",placeholder.style.left=parentBox.left-box.left+"px")}placeholder.style.width=`${colEl.offsetWidth}px`,placeholder.style.minWidth=colEl.style.minWidth||"48px",placeholder.style.maxWidth=colEl.style.maxWidth||"75vw",ghostEl.style.display="block",document.addEventListener("mousemove",onResize),document.addEventListener("mouseup",onResizeEnd)})(colEl,ghostRef.current,(width=>{setWidths(new Map(widths.set(colEl.dataset.name??"",width)))}))}),[widths]);return(0,react.useEffect)((()=>{refBody?.current?.scrollTo({top:lastScroll,behavior:"auto"})}),[]),(0,jsx_runtime.jsx)(DatagridContext.Provider,{value:{columns,data,widths,startResize,onRowExpand,isSelectable,onRowSelect,canExpand,sort,onSort},children:(0,jsx_runtime.jsxs)("div",{className:`ax-datagrid ${className??""}`,children:[(0,jsx_runtime.jsx)("div",{className:`ax-datagrid__wrapper ${className??""}`,onScroll:e=>onScroll?.(e.currentTarget.scrollTop),ref:refBody,children}),(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__resize--ghost",ref:ghostRef,children:(0,jsx_runtime.jsx)("div",{})})]})})},useDatagridContext=()=>(0,react.useContext)(DatagridContext),BodyCell=(0,react.memo)((({row,name,minWidth,maxWidth,type,align,format,valueMap,render,record})=>{const{widths}=useDatagridContext(),width=(0,react.useMemo)((()=>widths.get(name.toString())??180),[widths,name]),content=(0,react.useMemo)((()=>{const value=(0,utilities_dist.getByPath)(record,name.toString());if(null!=render)return render(value,record,row);if("boolean"===type){return(valueMap??{true:"Yes",false:"no"})[""+((0,utilities_dist.isTrue)(value)?"true":"false")]}return null!=valueMap&&"string"===type&&value in valueMap?valueMap[value]:"date"===type?(0,jsx_runtime.jsx)(date_dist.u1,{date:value,format}):"number"===type?utilities_dist.Format.number(value,format):value??""}),[name,record,render,format,row,type,valueMap]);return(0,jsx_runtime.jsx)("div",{"data-name":name,"data-align":align,className:"ax-datagrid__body--cell",style:{minWidth,maxWidth,width},children:content})}));BodyCell.displayName="AxDatagrid.BodyCell";const BodyRow=(0,react.memo)((({row,record})=>{const{columns,isSelectable,onRowSelect,onRowExpand,canExpand}=useDatagridContext(),[expandedNode,setExpandedNode]=(0,react.useState)();(0,react.useEffect)((()=>{setExpandedNode(void 0)}),[record]);const handleExpand=(0,react.useCallback)((()=>{if(expandedNode)return setExpandedNode(void 0);const node=onRowExpand?.(record);setExpandedNode(node)}),[expandedNode,record,onRowExpand]),[start,end,cols]=(0,react.useMemo)((()=>[columns.filter((col=>!0===col.isLocked||"start"===col.isLocked)),columns.filter((col=>"end"===col.isLocked)),columns.filter((col=>!col.isLocked))]),[columns]);return(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__row","data-row":row,children:[(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__row--flex","data-selectable":isSelectable,onClick:isSelectable?(0,handlers.hC)((()=>onRowSelect?.(record))):void 0,children:[(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__fixStart",children:[!(null==onRowExpand)&&(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__body--cell "+(!1!==canExpand?.(record)?"cursor-pointer":"opacity-30 pointer-events-none"),onClick:(0,handlers.hC)(handleExpand,{stopPropagation:!0}),children:(0,jsx_runtime.jsx)(dist.T3,{icon:expandedNode?appIcons.m.iconCollapseMinus:appIcons.m.iconExpandPlus})}),start.map(((props,column)=>(0,jsx_runtime.jsx)(BodyCell,{...props,record,row},column)))]}),cols.map(((props,column)=>(0,jsx_runtime.jsx)(BodyCell,{...props,record,row},column))),(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__fixEnd",children:end.map(((props,column)=>(0,jsx_runtime.jsx)(BodyCell,{...props,record,row},column)))})]}),expandedNode]})}));BodyRow.displayName="AxDatagrid.BodyRow";const EmptyRow=()=>{const{columns,widths,onRowExpand}=useDatagridContext(),[start,end,cols]=(0,react.useMemo)((()=>[columns.filter((col=>!0===col.isLocked||"start"===col.isLocked)),columns.filter((col=>"end"===col.isLocked)),columns.filter((col=>!col.isLocked))]),[columns]);return(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__row flex-1 pointer-events-none",children:(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__row--flex min-h-full",children:[(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__fixStart",children:[!(null==onRowExpand)&&(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__body--cell",children:(0,jsx_runtime.jsx)(dist.T3,{icon:""})}),start.map((({minWidth,maxWidth,name},column)=>(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__body--cell",style:{minWidth,maxWidth,width:widths.get(name.toString())??180}},column)))]}),cols.map((({name,minWidth,maxWidth},column)=>(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__body--cell",style:{minWidth,maxWidth,width:widths.get(name.toString())??180}},column))),(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__fixEnd",children:end.map((({minWidth,maxWidth,name},column)=>(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__body--cell",style:{minWidth,maxWidth,width:widths.get(name.toString())??180}},column)))})]})})},Body=(0,react.memo)((()=>{const{data}=useDatagridContext();return(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__body",children:[data.map(((record,row)=>(0,jsx_runtime.jsx)(BodyRow,{record,row},row))),(0,jsx_runtime.jsx)(EmptyRow,{})]})}));Body.displayName="AxDatagrid.Body";const HeaderCell=(0,react.memo)((({icon,name,isPrimary,isResizeable,isSortable,tooltip,rtlFlip,label,minWidth,maxWidth})=>{const{startResize,widths,sort,onSort}=useDatagridContext(),width=(0,react.useMemo)((()=>widths.get(name.toString())??180),[widths,name]),tooltipContent=(0,react.useMemo)((()=>tooltip?`${isPrimary?"🔑":""}${!0!==tooltip?tooltip:label}`:""),[isPrimary,label,tooltip]),handleSort=(0,react.useCallback)((()=>{onSort?.(name.toString(),sort?.name===name&&"asc"===sort.order?"desc":"asc")}),[onSort,name,sort]);return(0,jsx_runtime.jsxs)("div",{"data-name":name,className:"ax-datagrid__header--cell",style:{minWidth,maxWidth,width},children:[(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__header--label","data-sortable":isSortable,"data-centered":!label&&!!icon,onClick:(0,handlers.hC)(handleSort),"data-tooltip":tooltipContent,"data-tooltip-placement":"bottom-start",children:[icon&&(0,jsx_runtime.jsx)(dist.T3,{icon,rtlFlip}),isPrimary&&(0,jsx_runtime.jsx)(dist.T3,{rtlFlip:!0,icon:"M4 6.5C4 4 6 2 8.5 2S13 4 13 6.5C13 8.46 11.75 10.13 10 10.74V15H13V18H10V22H7V10.74C5.25 10.13 4 8.46 4 6.5M7 6.5C7 7.33 7.67 8 8.5 8S10 7.33 10 6.5 9.33 5 8.5 5 7 5.67 7 6.5"}),(0,jsx_runtime.jsx)("label",{children:label}),isSortable&&(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__header--sort","data-sort":sort?.name===name&&sort?.order,children:[(0,jsx_runtime.jsx)("span",{children:"▼"}),(0,jsx_runtime.jsx)("span",{children:"▲"})]})]}),isResizeable&&(0,jsx_runtime.jsx)("div",{onMouseDown:startResize,className:"ax-datagrid__header--resize"})]})}));HeaderCell.displayName="AxDatagrid.HeaderCell";const Header=(0,react.memo)((()=>{const{columns,onRowExpand}=useDatagridContext(),[start,end,cols]=(0,react.useMemo)((()=>[columns.filter((col=>!0===col.isLocked||"start"===col.isLocked)),columns.filter((col=>"end"===col.isLocked)),columns.filter((col=>!col.isLocked))]),[columns]);return(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__header",children:[(0,jsx_runtime.jsxs)("div",{className:"ax-datagrid__fixStart",children:[!(null==onRowExpand)&&(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__header--cell px-2",children:(0,jsx_runtime.jsx)(dist.T3,{icon:""})}),start.map(((props,index)=>(0,jsx_runtime.jsx)(HeaderCell,{...props},index)))]}),cols.map(((props,index)=>(0,jsx_runtime.jsx)(HeaderCell,{...props},index))),(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__fixEnd",children:end.map(((props,index)=>(0,jsx_runtime.jsx)(HeaderCell,{...props},index)))})]})}));Header.displayName="AxDatagrid.Header";const AxDatagridComponent=({data=[],emptyDisplay,children,isLoading,...props})=>{const{t}=(0,es.Bd)("data");return(0,jsx_runtime.jsxs)(DatagridProvider,{...props,data,onRowExpand:children,children:[(0,jsx_runtime.jsx)(Header,{}),data.length>0&&(0,jsx_runtime.jsx)(Body,{}),isLoading&&(0,jsx_runtime.jsx)("div",{className:"ax-datagrid__loader",children:(0,jsx_runtime.jsx)(animations.C1,{})}),!isLoading&&0===data.length&&(0,jsx_runtime.jsx)(react.Fragment,{children:emptyDisplay&&!(0,utilities_dist.isString)(emptyDisplay)?emptyDisplay:(0,jsx_runtime.jsx)(dist.N_.Empty,{size:"sm",message:emptyDisplay??t("datagrid.empty")})})]})};AxDatagridComponent.displayName="AxDatagrid";(0,react.memo)(AxDatagridComponent);var form_dist=__webpack_require__("./packages/form/dist/index.js");const AxVirtualItem=(0,react.memo)((({index,children,isLast,updateSize,isSticky,...rest})=>{const itemRef=(0,react.useRef)(null);return(0,react.useLayoutEffect)((()=>{const child=itemRef.current?.firstElementChild;if(child){const ob=new ResizeObserver((()=>{null!=child&&updateSize(index,child.offsetWidth,child.offsetHeight)}));return ob.observe(child),()=>{ob.unobserve(child),ob.disconnect()}}}),[]),(0,jsx_runtime.jsx)("div",{...rest,ref:itemRef,"data-index":index,"data-sticky":isSticky,"data-last-child":isLast,className:"ax-virtual__item",children})}),utilities_dist.isEqual);AxVirtualItem.displayName="AxVirtualItem";var memoize_one_esm=__webpack_require__("./node_modules/memoize-one/dist/memoize-one.esm.js");const createItemList=(0,memoize_one_esm.A)((items=>items)),VirtualList=({items,children,fullWidth,padding="md",orientation="vertical",height=48,width=48,hideScroller,isLoading,onLoadMore,onScroll,isSticky,listRef})=>{const count=(0,react.useDeferredValue)(items.length),itemList=createItemList(items.map(((item,idx)=>({index:idx,data:item,isSticky:!0===isSticky?.(idx),isLast:idx+1===items.length})))),{scrollerRef,scrollSize,pageIndex,startIndex,endIndex,springSize,scrollActive,handleScroll,updateCache,scrollToItem,scrollActions}=(({orientation="vertical",height=64,width=64,count=0})=>{const scrollerRef=(0,react.useRef)(null),sizeCache=(0,react.useRef)([]),ignoreScrollChange=(0,react.useRef)(!1),[pageCount,setPageCount]=(0,react.useState)(0),[pageIndex,setPageIndex]=(0,react.useState)(0),[scrollSize,setScrollSize]=(0,react.useState)(0),[scrollOffset,setScrollOffset]=(0,react.useState)(0);(0,react.useEffect)((()=>{sizeCache.current=new Array(count).fill([width,height]).map(((h,i)=>[Math.max(h[0],sizeCache.current[i]?.[0]??width),Math.max(h[1],sizeCache.current[i]?.[1]??height)])),setScrollSize(sizeCache.current.reduce(((t,h,i)=>t+(h["vertical"===orientation?1:0]??0)),0)+64)}),[count,height,width,orientation]),(0,react.useEffect)((()=>{let idx=0;for(let tot=0;idx<count&&(tot+=sizeCache.current[idx]["vertical"===orientation?1:0],!(tot>=scrollOffset));idx++);setPageIndex(idx)}),[count,orientation,scrollOffset]);const[startIndex,endIndex,springSize]=(0,react.useMemo)((()=>{const index=Math.max(0,pageIndex-pageCount);return[index,pageIndex+pageCount+pageCount,new Array(index).fill(0).reduce(((t,_,i)=>t+sizeCache.current[i]["vertical"===orientation?1:0]),0)]}),[pageCount,pageIndex,orientation]);(0,react.useEffect)((()=>{if(scrollerRef.current){const el=scrollerRef.current,size="vertical"===orientation?height:width,handler=()=>{const scrollerSize="vertical"===orientation?scrollerRef.current?.offsetHeight:scrollerRef.current?.offsetWidth;setPageCount(Math.max(10,Math.round(Math.max(1e3,scrollerSize??0)/size)))},ob=new ResizeObserver(handler);return handler(),ob.observe(el),()=>{ob.unobserve(el),ob.disconnect()}}}),[scrollerRef.current,orientation,height,width]);const updateCache=(0,react.useCallback)(((index,width,height)=>{const oldSize=sizeCache.current[index];oldSize&&(width!==oldSize[0]&&(sizeCache.current[index][0]=width),height!==oldSize[1]&&(sizeCache.current[index][1]=height),setScrollSize(sizeCache.current.reduce(((t,h,i)=>t+(h["vertical"===orientation?1:0]??0)),0)+64))}),[orientation]),scrollActive=(0,react.useMemo)((()=>{const{scrollTop=0,scrollLeft=0,scrollWidth=0,scrollHeight=0,offsetWidth=0,offsetHeight=0}=scrollerRef.current??{};if("vertical"===orientation){if(scrollHeight===offsetHeight)return 0;if(0===scrollTop)return 1;if(scrollTop>=scrollHeight-offsetHeight-64)return 2}if("horizontal"===orientation){if(scrollWidth===offsetWidth)return 0;if(0===Math.abs(scrollLeft))return 1;if(Math.abs(scrollLeft)>=scrollWidth-offsetWidth-64)return 2}return 3}),[count,orientation,scrollOffset,scrollSize]),handleScroll=(0,react.useCallback)((evt=>{const{scrollTop,scrollLeft,scrollHeight,scrollWidth,offsetWidth,offsetHeight}=evt.currentTarget;return ignoreScrollChange.current||setScrollOffset("vertical"===orientation?scrollTop:Math.abs(scrollLeft)),"vertical"===orientation&&Math.ceil(+scrollTop+ +offsetHeight)>=+scrollHeight||"horizontal"===orientation&&Math.ceil(Math.abs(+scrollLeft)+ +offsetWidth)>=+scrollWidth}),[orientation]),scrollToItem=(0,react.useCallback)((index=>{ignoreScrollChange.current=!0,setPageIndex(index),setTimeout((()=>{scrollerRef.current?.querySelector(`[data-index="${index}"]`)?.scrollIntoView({behavior:"auto",block:"start"}),setTimeout((()=>ignoreScrollChange.current=!1),10)}),100)}),[]),scrollActions=(0,react.useMemo)((()=>({first(){scrollerRef.current?.scrollTo({top:0,left:0,behavior:"auto"})},pgup(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollTop??0)-scrollerRef.current?.offsetHeight??0,left:(scrollerRef.current?.scrollLeft??0)-scrollerRef.current?.offsetWidth??0,behavior:"smooth"})},pgdn(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollTop??0)+scrollerRef.current?.offsetHeight??0,left:(scrollerRef.current?.scrollLeft??0)+scrollerRef.current?.offsetWidth??0,behavior:"smooth"})},last(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollHeight??0)-(scrollerRef.current?.offsetHeight??0)-64,left:(scrollerRef.current?.scrollWidth??0)-(scrollerRef.current?.offsetWidth??0)-64,behavior:"auto"})}})),[orientation]);return{scrollerRef,pageIndex,startIndex,endIndex,springSize,scrollSize,scrollOffset,scrollActive,handleScroll,updateCache,scrollToItem,scrollActions}})({orientation,height,width,count}),scrollCallback=(0,react.useRef)((0,utilities_dist.debounce)((idx=>onScroll?.(idx))));(0,react.useEffect)((()=>{scrollCallback.current(pageIndex)}),[pageIndex]);const[stickiesStart,pagedList]=(0,react.useMemo)((()=>[itemList.slice(0,pageIndex).filter((item=>item.isSticky)),itemList.slice(startIndex,endIndex)]),[itemList,startIndex,endIndex]);return(0,react.useImperativeHandle)(listRef,(()=>({hilight(index){scrollerRef.current?.querySelector(".hilight")?.classList.remove("hilight"),scrollerRef.current?.querySelector(`[data-index="${index}"]`)?.classList.add("hilight"),setTimeout((()=>{scrollerRef.current?.querySelector(`[data-index="${index}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}),100)},unhilight(){scrollerRef.current?.querySelector(".hilight")?.classList.remove("hilight")},scrollToItem(index){scrollToItem(index)}})),[]),(0,jsx_runtime.jsx)("div",{className:"ax-virtual-list",ref:scrollerRef,onScroll:evt=>handleScroll(evt)&&onLoadMore?.(),"data-padding":padding,"data-orientation":orientation,children:(0,jsx_runtime.jsxs)("div",{className:"ax-virtual__container",children:[(0,jsx_runtime.jsxs)("div",{className:"ax-virtual__scroller "+(fullWidth?"flex-1":""),style:"vertical"===orientation?{minHeight:scrollSize,minWidth:width}:{minWidth:scrollSize,minHeight:height},children:[(0,jsx_runtime.jsx)("div",{style:"vertical"===orientation?{height:springSize}:{width:springSize,display:"inline-block"}}),(0,jsx_runtime.jsx)("div",{className:"ax-virtual__sticky",children:stickiesStart.map((({index,data,isSticky,isLast})=>children({data,index,key:index,isLast,isSticky,updateSize:updateCache})))}),pagedList.map((({index,data,isSticky,isLast})=>children({data,index,isLast,isSticky,key:index,updateSize:updateCache}))),onLoadMore&&(0,jsx_runtime.jsx)("div",{className:"ax-virtual__placeholder",children:isLoading&&(0,jsx_runtime.jsx)(dist.Qo.Card,{showIcon:!0})})]}),!hideScroller&&(0,jsx_runtime.jsx)("div",{className:"ax-virtual__tools",children:(0,jsx_runtime.jsxs)(dist.MR.Group,{isVertical:"vertical"===orientation,variant:"flat",children:[(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll to top",icon:appIcons.m.iconChevronUp,isDisabled:0==(2&scrollActive),onClick:()=>scrollActions.first()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll up",icon:appIcons.m.iconCaretUp,isDisabled:0==(2&scrollActive),onClick:()=>scrollActions.pgup()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll down",icon:appIcons.m.iconCaretDown,isDisabled:scrollActive%2==0,onClick:()=>scrollActions.pgdn()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll to bottom",icon:appIcons.m.iconChevronDown,isDisabled:scrollActive%2==0,onClick:()=>scrollActions.last()})]})})]})})};VirtualList.displayName="AxVirtualList";const AxVirtualList=(0,react.memo)(VirtualList),TreeNode=(0,react.memo)((({style,isCheckable,isSelectable,checkLevel=0,onToggleCheck,onToggleExpand,nodesSelectable,onSelect,node,...props})=>{const{t}=(0,es.Bd)("data"),BadgeEl=(0,hooks_useBadge.L)(node.badge),borders=(0,react.useMemo)((()=>props.lines.map(((l,i)=>(0,jsx_runtime.jsx)("span",{className:"ax-tree__spacer","data-border":l},i)))),[props.lines]),placeholder=(0,react.useMemo)((()=>props.isEmpty?props.isError?(0,jsx_runtime.jsx)("div",{className:"ax-tree__label","data-error":"true",children:t("tree.error")}):props.isLoading?(0,jsx_runtime.jsxs)("div",{className:"ax-tree__label","data-empty":"true",children:[(0,jsx_runtime.jsx)(dist.Qo.Spinner,{className:"text-base"})," ",t("tree.loading")]}):(0,jsx_runtime.jsx)("div",{className:"ax-tree__label","data-empty":"true",children:t("tree.noItems")}):null),[props.isEmpty,props.isLoading]);return(0,jsx_runtime.jsxs)("div",{style,className:"ax-tree__node",children:[borders,!props.isLeaf&&(0,jsx_runtime.jsx)("div",{className:"ax-tree__spacer",onClick:onToggleExpand,children:(0,jsx_runtime.jsx)(dist.T3,{icon:props.isOpen?node.iconOpen??appIcons.m.iconFolderOpen:node.iconClosed??appIcons.m.iconFolderClosed})}),placeholder,null==placeholder&&(0,jsx_runtime.jsxs)("div",{...node.props??{},className:`ax-tree__label ${node.labelClassName??""}`,onClick:()=>isCheckable?onToggleCheck(node.id):props.isLeaf||nodesSelectable?isSelectable&&onSelect(node.id):onToggleExpand(node.id),onDoubleClick:onToggleExpand,"data-selected":!isCheckable&&props.isSelected,"data-disabled":node.isDisabled,"data-child-selected":props.childSelected,children:[isCheckable&&props.level>=checkLevel&&(0,jsx_runtime.jsx)(dist.T3,{icon:2===props.isChecked?appIcons.m.iconCheckboxInt:1===props.isChecked?appIcons.m.iconCheckboxOn:appIcons.m.iconCheckboxOff}),node.icon&&(0,jsx_runtime.jsx)(dist.T3,{icon:node.icon??""}),(0,jsx_runtime.jsx)("div",{children:node.label}),BadgeEl]})]})}));TreeNode.displayName="AxTree.Node";const TreeTools=(0,react.memo)((({title,onExpand,onCollapse,onCheckAll,onUncheckAll,isCheckable})=>{const{t}=(0,es.Bd)("data");return(0,jsx_runtime.jsxs)("div",{className:"ax-tree__tools",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 self-center px-2 truncate",children:title}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",onClick:onExpand,icon:appIcons.m.iconExpandAll,tooltip:t("action.expandAll")}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",onClick:onCollapse,icon:appIcons.m.iconCollapseAll,tooltip:t("action.collapseAll")}),isCheckable&&(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)(dist.nZ,{vertical:!0,size:"xs"}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",onClick:onUncheckAll,icon:appIcons.m.iconCheckboxOff,tooltip:t("action.uncheckAll")}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",onClick:onCheckAll,icon:appIcons.m.iconCheckAll,tooltip:t("action.checkAll")})]})]})}));TreeTools.displayName="AxTree.Tools";const sorter=(a,b)=>!!a.isLeaf!=!!b.isLeaf?a.isLeaf?1:-1:(0,utilities_dist.compareValues)()(a.label,b.label),refactorNode=({node:{children,...node},index=0,isLast=!1,parent="",parentQuery="",level=0,lines=[],sortable=!0,...rest})=>{const internalId=`${parent}.${index}`,query=`${parentQuery}~${node.label}`,innerChildren=sortable?children?.sort(sorter):children,newLines=[...lines,isLast?0:1];return{internalId,parent,node,level,query,...rest,lines:newLines,isLeaf:!!node.isLeaf,isSelected:!1,childSelected:!1,isOpen:!!node.isOpen,isChecked:0,children:innerChildren?.map(((child,idx)=>refactorNode({node:child,index:idx,lines:newLines,isLast:idx+1===innerChildren.length,parent:internalId,parentQuery:query,level:level+1,sortable})))}},createTreeMap=nodes=>{const map=new Map,makeMap=nodes=>{nodes.forEach((node=>{map.set(node.internalId,node),null!=node.children&&makeMap(node.children)}))};return makeMap(nodes),map},createIdMap=nodes=>{const map=new Map,makeMap=nodes=>{nodes.forEach((node=>{node.node.id&&map.set(node.node.id,node.internalId),null!=node.children&&makeMap(node.children)}))};return makeMap(nodes),map},createNodeList=(nodes,sortable)=>{const list=[];return nodes.forEach((node=>{!1!==node.isFiltered&&list.push(node),node.isOpen&&(null!=node.children&&node.children.length>0?list.push(...createNodeList(node.children,sortable)):void 0!==node.isFiltered||node.isLeaf||list.push(refactorNode({node:{isLeaf:!0},index:0,isLast:!0,isEmpty:!0,isLoading:node.isLoading,isError:node.isError,lines:node.lines,parent:node.internalId,level:node.level+1,sortable})))})),list},toggleProperty=(nodes,prop,value,checkChildren=!1)=>{nodes.forEach((node=>{prop in node&&(!checkChildren||checkChildren&&node.children?.length>0)&&(node[prop]=value),null!=node.children&&toggleProperty(node.children,prop,value,checkChildren)}))},getNodeById=(state,id)=>state.treeMap.get(state.idMap.get(id??"")??""),toggleExpand=(state,id,canLoad=!1,isSortable=!0,force)=>{const parent=getNodeById(state,id);if(parent){const index=state.items.indexOf(parent);parent.isOpen=force??!parent.isOpen,parent.isOpen?(0,utilities_dist.isNil)(parent.children)?(parent.isLoading=canLoad,state.items.splice(index+1,0,refactorNode({node:{isLeaf:!0},index:0,isLast:!0,isEmpty:!0,isLoading:canLoad,isError:parent.isError,lines:parent.lines,parent:parent.internalId,level:parent.level+1}))):state.items.splice(index+1,0,...createNodeList(parent.children,isSortable)):state.items=state.items.filter((item=>!(item.internalId!==parent.internalId&&item.internalId.startsWith(parent.internalId))))}return{...state}},AxTreePanel=(0,react.memo)((({className,data,title,actions,selected,nodesSelectable,isSortable=!0,isSearchable,isCheckable,isSelectable,checkLevel=0,onChange,onLoad,onSelect,treeRef:ref,...rest})=>{const listRef=(0,react.useRef)(null),panelRef=(0,react.useRef)(null),[,startTransition]=(0,react.useTransition)(),initState=(0,react.useCallback)(((data=[])=>{const treeData=(nodes=data,((sortable=isSortable)?nodes.sort(sorter):nodes).map(((node,index)=>refactorNode({node,index,isLast:index+1===nodes.length,sortable}))));var nodes,sortable;return{treeData,treeMap:createTreeMap(treeData),idMap:createIdMap(treeData),items:createNodeList(treeData,isSortable),autoScroll:!1}}),[]),fireCheckChange=(0,react.useCallback)((items=>{const checkList=items.map((node=>1===node.isChecked&&node.isLeaf?node.node.id:void 0)).filter(Boolean);onChange?.(checkList)}),[onChange]),reducer=(0,react.useCallback)(((state,action)=>{if(state.autoScroll=!1,"init"===action.type&&action.newState)return{...action.newState};if("toggleExpand"===action.type)return toggleExpand(state,action.id,!(null==onLoad),isSortable);if("open"===action.type)return toggleExpand(state,action.id,!(null==onLoad),isSortable,!0);if("toggleCheck"===action.type){const newState=((state,id)=>{const node=getNodeById(state,id);if(node){node.isChecked=0===node.isChecked?1:0,null!=node.children&&toggleProperty(node.children,"isChecked",node.isChecked);let parent=state.treeMap.get(node.parent??"");const parentCheck=parent?.children?.some((n=>n.isChecked!==node.isChecked))?2:node.isChecked;for(;null!=parent;)parent.isChecked=parentCheck,parent=state.treeMap.get(parent.parent??"")}return{...state}})(state,action.id);return startTransition((()=>fireCheckChange?.(Array.from(newState.treeMap.values())))),newState}if("loadItems"===action.type){const parent=getNodeById(state,action.id);if(parent){parent.isLoading=!1,parent.isError=!1;const index=state.items.indexOf(parent);((parent,children,sortable)=>{const list=sortable?children.sort(sorter):children;parent.children=list.map(((child,idx)=>refactorNode({node:child,index:idx,lines:parent.lines,isLast:idx+1===children.length,parent:parent.internalId,level:parent.level+1})))})(parent,action.items??[],isSortable),state.idMap=createIdMap(state.treeData),state.treeMap=createTreeMap(state.treeData),state.items.splice(index+1,1,...((parent,sortable)=>null!=parent.children&&parent.children?.length>0?createNodeList(parent.children,sortable):[refactorNode({node:{isLeaf:!0},index:0,isLast:!0,isEmpty:!0,isLoading:parent.isLoading,isError:parent.isError,lines:parent.lines,parent:parent.internalId,level:parent.level+1,sortable})])(parent,isSortable))}}if("loadError"===action.type){const parent=getNodeById(state,action.id);if(parent){const index=state.items.indexOf(parent),item=state.items[index+1];item&&(item.isLoading=!1,item.isError=!0),parent.isLoading=!1,parent.isError=!0}}return"expandAll"===action.type&&(toggleProperty(state.treeData,"isOpen",!0,!0),state.items=createNodeList(state.treeData,isSortable)),"collapseAll"===action.type&&(toggleProperty(state.treeData,"isOpen",!1),state.items=createNodeList(state.treeData,isSortable)),"checkAll"===action.type&&(toggleProperty(state.treeData,"isChecked",1),setTimeout((()=>startTransition((()=>fireCheckChange?.(Array.from(state.treeMap.values()))))),100)),"uncheckAll"===action.type&&(toggleProperty(state.treeData,"isChecked",0),setTimeout((()=>startTransition((()=>fireCheckChange?.(Array.from(state.treeMap.values()))))),100)),"select"===action.type&&(state.autoScroll=!0,((state,id,isSortable=!0,scroll=!1)=>{const node=getNodeById(state,id);if(node){Array.from(state.treeMap.values()).forEach((n=>{n.isSelected=!1,n.childSelected=!1})),node.isSelected=!0;let parent=state.treeMap.get(node.parent??"");for(;null!=parent;)parent.isOpen=!0,parent.childSelected=!0,parent=state.treeMap.get(parent.parent??"");return state.items=createNodeList(state.treeData,isSortable),state.autoScroll=scroll,!node.isLeaf}})(state,action.id,isSortable,action.propChange),!action.propChange&&setTimeout((()=>startTransition((()=>{action.id&&onSelect?.(action.id)}))),100)),"search"===action.type&&(Array.from(state.treeMap.values()).forEach((item=>{if(item.isFiltered=action.search?(0,utilities_dist.matchString)(item.query,action.search):void 0,item.parent&&item.isFiltered){let parent=state.treeMap.get(item.parent);for(;null!=parent;)!action.search&&(parent.isOpen=!1),parent.isFiltered=item.isFiltered,parent=state.treeMap.get(parent.parent??"")}})),state.autoScroll=!0,state.items=createNodeList(state.treeData,isSortable)),{...state}}),[onLoad,onSelect,fireCheckChange,isSortable]),[state,dispatch]=(0,react.useReducer)(reducer,{treeData:[],treeMap:new Map,idMap:new Map,items:[],autoScroll:!1},(()=>initState()));(0,react.useEffect)((()=>{dispatch({type:"init",newState:initState(data)})}),[data]);const itemHeight=(0,react.useCallback)((el=>{const h=null!=el?1.5*parseInt(getComputedStyle(el).fontSize??"16"):0;return isNaN(h)?0:h}),[state.items]);(0,react.useEffect)((()=>{selected&&dispatch({type:"select",id:selected,propChange:!0})}),[data,selected]);const loadNodes=(0,react.useCallback)((id=>{startTransition((()=>{if(id){const ret=onLoad?.(id)??[];Promise.resolve(ret).then((resp=>{dispatch({type:"loadItems",id,items:resp??[]})})).catch((()=>dispatch({type:"loadError",id})))}}))}),[onLoad]),handleExpand=(0,react.useCallback)((index=>{const parent=state.items[index];dispatch({type:"toggleExpand",id:parent.node.id}),!parent.isOpen&&(0,utilities_dist.isNil)(parent.children)&&loadNodes(parent.node.id)}),[state,loadNodes]);return(0,react.useImperativeHandle)(ref,(()=>({select:id=>dispatch({type:"select",id,propChange:!0}),open:id=>{dispatch({type:"open",id,propChange:!0});const parent=state.treeMap.get(state.idMap.get(id)??"");parent&&(0,utilities_dist.isNil)(parent?.children)&&loadNodes(parent.node.id)}})),[state,loadNodes]),(0,react.useLayoutEffect)((()=>{state.autoScroll&&startTransition((()=>{const item=Array.from(state.treeMap.values()).find((n=>n.isSelected));if(null!=item){const focusIndex=state.items.indexOf(item);focusIndex>-1&&listRef.current?.scrollToItem(focusIndex)}}))}),[state]),(0,jsx_runtime.jsxs)("div",{...rest,ref:panelRef,className:`ax-tree__panel ${className??""}`,children:[(0,jsx_runtime.jsx)(TreeTools,{title,isCheckable,onExpand:()=>dispatch({type:"expandAll"}),onCollapse:()=>dispatch({type:"collapseAll"}),onCheckAll:()=>dispatch({type:"checkAll"}),onUncheckAll:()=>dispatch({type:"uncheckAll"})}),isSearchable&&(0,jsx_runtime.jsx)(form_dist.w.Search,{isPlain:!0,onChange:search=>dispatch({type:"search",search}),className:"ax-tree__search"}),(0,jsx_runtime.jsx)(AxVirtualList,{fullWidth:!0,hideScroller:!0,listRef,items:state.items,height:itemHeight(panelRef.current),children:({data,...props})=>(0,jsx_runtime.jsx)(AxVirtualItem,{...props,children:(0,jsx_runtime.jsx)(TreeNode,{...data,checkLevel,isCheckable,isSelectable,nodesSelectable,onSelect:id=>dispatch({type:"select",id}),onToggleCheck:id=>dispatch({type:"toggleCheck",id}),onToggleExpand:()=>handleExpand(props.index)})})})]})}));AxTreePanel.displayName="AxTree.Panel";const Gallery_createItemList=(0,memoize_one_esm.A)((items=>items)),VirtualGallery=({items,children,padding="md",height=48,width=64,columns,hideScroller,isLoading,onLoadMore,onScroll,listRef})=>{const count=(0,react.useDeferredValue)(items.length),itemList=Gallery_createItemList(items.map(((item,idx)=>({index:idx,data:item,isLast:idx+1===items.length})))),{columnCount,scrollerRef,scrollSize,pageIndex,startIndex,endIndex,springSize,scrollActive,handleScroll,updateCache,scrollToItem,scrollActions}=(({columns=0,height=64,width=64,count=0})=>{const scrollerRef=(0,react.useRef)(null),sizeCache=(0,react.useRef)([]),rowsizeCache=(0,react.useRef)([]),ignoreScrollChange=(0,react.useRef)(!1),[pageCount,setPageCount]=(0,react.useState)(0),[pageIndex,setPageIndex]=(0,react.useState)(0),[scrollSize,setScrollSize]=(0,react.useState)(0),[columnCount,setColumnCount]=(0,react.useState)(1),[scrollOffset,setScrollOffset]=(0,react.useState)(0);(0,react.useEffect)((()=>{sizeCache.current=new Array(count).fill([width,height]).map(((h,i)=>[Math.max(h[0],sizeCache.current[i]?.[0]??width),Math.max(h[1],sizeCache.current[i]?.[1]??height)])),rowsizeCache.current=new Array(Math.ceil(count/columnCount)).fill(height).map(((h,i)=>Math.max(h,...sizeCache.current.slice(i*columnCount,i*columnCount+columnCount).map((s=>s?.[1])).filter(Boolean)))),setScrollSize(rowsizeCache.current.reduce(((t,h)=>t+h+8),0)+64)}),[count,columnCount,height,width]),(0,react.useEffect)((()=>{let idx=0;for(let tot=0;idx<rowsizeCache.current.length&&(tot+=rowsizeCache.current[idx]+8,!(tot>=scrollOffset));idx++);setPageIndex(idx)}),[count,columnCount,scrollOffset]);const[startIndex,endIndex,springSize]=(0,react.useMemo)((()=>{const index=Math.max(0,pageIndex-pageCount);return[index*columnCount,(pageIndex+pageCount+pageCount)*columnCount,new Array(index).fill(0).reduce(((t,_,i)=>t+rowsizeCache.current[i]+8),0)]}),[pageCount,columnCount,pageIndex]);(0,react.useEffect)((()=>{if(scrollerRef.current){const el=scrollerRef.current,handler=()=>{setPageCount(Math.max(10,Math.round(Math.max(1e3,el?.offsetHeight??0)/height))),setColumnCount(columns||Math.max(1,Math.floor(((el?.offsetWidth??800)-32)/(width+16))))},ob=new ResizeObserver(handler);return handler(),ob.observe(el),()=>{ob.unobserve(el),ob.disconnect()}}}),[scrollerRef.current,columns,count,height,width]);const updateCache=(0,react.useCallback)(((index,width,height)=>{const oldSize=sizeCache.current[index];oldSize&&(width!==oldSize[0]&&(sizeCache.current[index][0]=width),height!==oldSize[1]&&(sizeCache.current[index][1]=height),rowsizeCache.current=new Array(Math.ceil(count/columnCount)).fill(height).map(((h,i)=>Math.max(h,...sizeCache.current.slice(i*columnCount,i*columnCount+columnCount).map((s=>s?.[1])).filter(Boolean)))),setScrollSize(rowsizeCache.current.reduce(((t,h)=>t+h+8),0)+64))}),[count,columnCount]),scrollActive=(0,react.useMemo)((()=>{const{scrollTop=0,scrollHeight=0,offsetHeight=0}=scrollerRef.current??{};return scrollSize===offsetHeight?0:0===scrollTop?1:scrollTop>=scrollHeight-offsetHeight-64?2:3}),[count,scrollOffset,scrollSize]),handleScroll=(0,react.useCallback)((evt=>{const{scrollTop,scrollHeight,offsetHeight}=evt.currentTarget;return ignoreScrollChange.current||setScrollOffset(scrollTop),Math.ceil(+scrollTop+ +offsetHeight)>=+scrollHeight}),[]),scrollToItem=(0,react.useCallback)((index=>{ignoreScrollChange.current=!0,setPageIndex(index),setTimeout((()=>{scrollerRef.current?.querySelector(`[data-index="${index*columnCount}"]`)?.scrollIntoView({behavior:"auto",block:"start"}),setTimeout((()=>ignoreScrollChange.current=!1),10)}),100)}),[columnCount]),scrollActions=(0,react.useMemo)((()=>({first(){scrollerRef.current?.scrollTo({top:0,behavior:"auto"})},pgup(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollTop??0)-scrollerRef.current?.offsetHeight??0,behavior:"smooth"})},pgdn(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollTop??0)+scrollerRef.current?.offsetHeight??0,behavior:"smooth"})},last(){scrollerRef.current?.scrollTo({top:(scrollerRef.current?.scrollHeight??0)-(scrollerRef.current?.offsetHeight??0)-64,behavior:"auto"})}})),[]);return{columnCount,scrollerRef,pageIndex,startIndex,endIndex,springSize,scrollSize,scrollOffset,scrollActive,handleScroll,updateCache,scrollToItem,scrollActions}})({columns,height,width,count}),scrollCallback=(0,react.useRef)((0,utilities_dist.debounce)((idx=>onScroll?.(idx))));(0,react.useEffect)((()=>{scrollCallback.current(pageIndex)}),[pageIndex]);const pagedList=(0,react.useMemo)((()=>itemList.slice(startIndex,endIndex)),[itemList,startIndex,endIndex]);return(0,react.useImperativeHandle)(listRef,(()=>({hilight(index){scrollerRef.current?.querySelector(".hilight")?.classList.remove("hilight"),scrollerRef.current?.querySelector(`[data-index="${index}"]`)?.classList.add("hilight"),setTimeout((()=>{scrollerRef.current?.querySelector(`[data-index="${index}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}),100)},unhilight(){scrollerRef.current?.querySelector(".hilight")?.classList.remove("hilight")},scrollToItem(index){scrollToItem(index)}})),[scrollToItem]),(0,jsx_runtime.jsx)("div",{className:"ax-virtual-list",ref:scrollerRef,onScroll:evt=>handleScroll(evt)&&onLoadMore?.(),"data-padding":padding,"data-orientation":"vertical",children:(0,jsx_runtime.jsxs)("div",{className:"ax-virtual__container",children:[(0,jsx_runtime.jsxs)("div",{className:"ax-virtual__scroller",style:{minHeight:scrollSize},children:[(0,jsx_runtime.jsx)("div",{style:{height:springSize}}),(0,jsx_runtime.jsx)("div",{className:"ax-virtual__gallery",style:{gridTemplateColumns:`repeat(${columnCount}, ${width}px)`,maxWidth:columns?void 0:(width+8)*columnCount},children:pagedList.map((({index,data,isLast})=>children({data,index,isLast,key:index,updateSize:updateCache})))}),onLoadMore&&(0,jsx_runtime.jsx)("div",{className:"ax-virtual__placeholder",children:isLoading&&(0,jsx_runtime.jsx)(dist.Qo.Card,{showIcon:!0})})]}),!hideScroller&&(0,jsx_runtime.jsx)("div",{className:"ax-virtual__tools",children:(0,jsx_runtime.jsxs)(dist.MR.Group,{isVertical:!0,variant:"flat",children:[(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll to top",icon:appIcons.m.iconChevronUp,isDisabled:0==(2&scrollActive),onClick:()=>scrollActions.first()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll up",icon:appIcons.m.iconCaretUp,isDisabled:0==(2&scrollActive),onClick:()=>scrollActions.pgup()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll down",icon:appIcons.m.iconCaretDown,isDisabled:scrollActive%2==0,onClick:()=>scrollActions.pgdn()}),(0,jsx_runtime.jsx)(dist.MR,{size:"sm",variant:"link",className:"flush","aria-label":"scroll to bottom",icon:appIcons.m.iconChevronDown,isDisabled:scrollActive%2==0,onClick:()=>scrollActions.last()})]})})]})})};VirtualGallery.displayName="AxVirtualGallery";(0,react.memo)(VirtualGallery);var GraphIcons,client=__webpack_require__("./node_modules/react-dom/client.js"),react_dom=__webpack_require__("./node_modules/react-dom/index.js");!function(GraphIcons){GraphIcons.zoomOut="M19,13H5V11H19V13Z",GraphIcons.zoomIn="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",GraphIcons.zoomReset="M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z",GraphIcons.selectLasso="M22 9C22 5.13 17.5 2 12 2C6.5 2 2 5.13 2 9C2 9.00843 2.00002 9.01685 2.00006 9.02527C2.00952 10.8953 3.06771 12.5956 4.78 13.85C4.78103 13.847 4.78207 13.844 4.7831 13.841C5.18858 14.1369 5.63069 14.408 6.10419 14.6507C6.03614 14.9227 6 15.2072 6 15.5C6 16.76 6.67 17.87 7.67 18.5C7.46 19.11 6.97 20.96 8.3 22.05C9.91 23.38 11.66 22.97 12.56 22.69C12.8116 22.6126 13.0655 22.5076 13.3395 22.3944C14.0563 22.0981 14.9105 21.7451 16.22 21.68C17.6764 21.5995 18.9321 21.8104 19.5651 21.9167C19.7188 21.9425 19.8358 21.9622 19.91 21.97C19.91 21.97 20.86 21.97 20.97 21.04C21.08 20.1 20.03 19.97 20.03 19.97C20.03 19.97 18.43 19.7 16.39 19.71C14.9823 19.7145 13.7447 20.1595 12.703 20.5341C11.4434 20.987 10.4704 21.3368 9.83 20.68C9.18 20 9.39 19.36 9.6 19C11.3416 18.9542 12.7471 17.6481 12.9693 15.9673C13.4921 15.9319 14.0034 15.8699 14.5 15.78C18.6753 15.0244 21.7995 12.4293 21.9907 9.30406C21.9969 9.20324 22 9.10187 22 9ZM20 9C20 10.2554 19.2572 11.4047 18.032 12.2843C16.6998 13.2393 14.7966 13.8752 12.6542 13.9835C12.0881 12.8109 10.887 12 9.5 12C8.57261 12 7.72834 12.3625 7.10143 12.9533C6.61638 12.7181 6.17578 12.4489 5.78883 12.1513L5.79 12.15C4.6875 11.3034 4.02105 10.2243 4.00049 9.05571C4.00016 9.03717 4 9.01859 4 9C4 6.24 7.58 4 12 4C16.42 4 20 6.24 20 9ZM10.9988 15.5603C10.9933 15.6993 10.9689 15.8333 10.9281 15.96C10.7345 16.5641 10.1694 17 9.5 17C8.67 17 8 16.33 8 15.5C8 15.4718 8.00078 15.4437 8.00231 15.4159C8.04595 14.6266 8.69981 14 9.5 14C10.3284 14 11 14.6716 11 15.5C11 15.5202 10.9996 15.5403 10.9988 15.5603Z",GraphIcons.selectRect="M14,17H17V14H19V17H22V19H19V22H17V19H14V17M12,17V19H9V17H12M7,17V19H3V15H5V17H7M3,13V10H5V13H3M3,8V4H7V6H5V8H3M9,4H12V6H9V4M15,4H19V8H17V6H15V4M19,10V12H17V10H19Z",GraphIcons.toolExpand="M22.587 17.491c-1.169-0.675-2.573-0.408-3.429 0.467l-1.95-1.126c1.485-3.38-0.879-7.399-4.501-7.797v-2.252c1.217-0.314 2.119-1.422 2.119-2.736-0.155-3.748-5.495-3.746-5.65 0 0 1.314 0.902 2.421 2.119 2.735v2.252c-3.623 0.398-5.986 4.417-4.501 7.797l-1.95 1.126c-0.858-0.877-2.263-1.14-3.429-0.467-1.352 0.781-1.815 2.507-1.034 3.859 0.775 1.343 2.504 1.816 3.859 1.034 1.138-0.657 1.646-1.991 1.31-3.203l1.953-1.127c2.266 2.98 6.73 2.983 8.998 0l1.953 1.127c-0.336 1.211 0.172 2.546 1.31 3.203v0c1.357 0.784 3.085 0.306 3.859-1.034 0.781-1.352 0.318-3.078-1.034-3.859zM3.532 21.161c-0.675 0.389-1.54 0.157-1.929-0.517-0.39-0.676-0.159-1.539 0.517-1.929 0.678-0.391 1.54-0.158 1.929 0.517s0.158 1.54-0.517 1.929zM10.588 4.048c0-0.779 0.634-1.412 1.412-1.412 1.874 0.078 1.873 2.748 0 2.825-0.779 0-1.412-0.634-1.412-1.412zM12 10.404c3.473-0.018 5.479 4.042 3.389 6.778-0.258-0.881-0.85-1.619-1.629-2.069 0.942-1.38-0.077-3.307-1.76-3.297-1.683-0.010-2.702 1.917-1.76 3.297-0.779 0.45-1.371 1.189-1.629 2.069-2.090-2.737-0.083-6.797 3.389-6.778zM11.294 13.935c0-0.389 0.317-0.706 0.706-0.706 0.937 0.039 0.937 1.374 0 1.412-0.389 0-0.706-0.317-0.706-0.706zM9.886 18.313c-0.081-1.233 0.9-2.259 2.114-2.259 1.212 0 2.194 1.024 2.114 2.259-1.305 0.754-2.92 0.755-4.227 0zM22.397 20.644c-0.389 0.675-1.255 0.906-1.929 0.517s-0.906-1.255-0.517-1.929c0.39-0.676 1.253-0.907 1.929-0.517s0.907 1.253 0.517 1.929z",GraphIcons.toolDelete="M18 7v13c0 0.276-0.111 0.525-0.293 0.707s-0.431 0.293-0.707 0.293h-10c-0.276 0-0.525-0.111-0.707-0.293s-0.293-0.431-0.293-0.707v-13zM17 5v-1c0-0.828-0.337-1.58-0.879-2.121s-1.293-0.879-2.121-0.879h-4c-0.828 0-1.58 0.337-2.121 0.879s-0.879 1.293-0.879 2.121v1h-4c-0.552 0-1 0.448-1 1s0.448 1 1 1h1v13c0 0.828 0.337 1.58 0.879 2.121s1.293 0.879 2.121 0.879h10c0.828 0 1.58-0.337 2.121-0.879s0.879-1.293 0.879-2.121v-13h1c0.552 0 1-0.448 1-1s-0.448-1-1-1zM9 5v-1c0-0.276 0.111-0.525 0.293-0.707s0.431-0.293 0.707-0.293h4c0.276 0 0.525 0.111 0.707 0.293s0.293 0.431 0.293 0.707v1zM9 11v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1zM13 11v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1z",GraphIcons.toolErase="M16.24 3.56l4.95 4.94c0.78 0.79 0.78 2.050 0 2.84l-9.19 9.19c-1.56 1.56-4.090 1.56-5.66 0l-3.53-3.53c-0.78-0.79-0.78-2.050 0-2.84l10.6-10.6c0.79-0.78 2.050-0.78 2.83 0zM4.22 15.58l3.54 3.53c0.78 0.79 2.040 0.79 2.83 0l3.53-3.53-4.95-4.95-4.95 4.95z",GraphIcons.toolHilight="M18.5 1.15c-0.53 0-1.040 0.19-1.43 0.58l-5.81 5.82 5.65 5.65 5.82-5.81c0.77-0.78 0.77-2.040 0-2.83l-2.84-2.83c-0.39-0.39-0.89-0.58-1.39-0.58zM10.3 8.5l-5.96 5.96c-0.78 0.78-0.78 2.040 0.020 2.85-1.22 1.23-2.46 2.46-3.69 3.69h5.66l0.86-0.86c0.78 0.76 2.030 0.75 2.81-0.020l5.95-5.96z",GraphIcons.toolPath="M768 490.656h-135.68c-17.92 49.504-64.864 85.344-120.32 85.344s-102.4-35.84-120.32-85.344h-135.68c-14.080 0-85.344 4.256-85.344 85.344v42.656c0 78.080 65.696 85.344 85.344 85.344h434.336c17.92-49.504 64.864-85.344 120.32-85.344 70.816 0 128 57.184 128 128s-57.184 128-128 128c-55.456 0-102.4-35.84-120.32-85.344h-434.336c-68.704 0-170.656-45.216-170.656-170.656v-42.656c0-125.44 101.984-170.656 170.656-170.656h135.68c17.92-49.504 64.864-85.344 120.32-85.344s102.4 35.84 120.32 85.344h135.68c14.080 0 85.344-4.256 85.344-85.344v-42.656c0-78.080-65.696-85.344-85.344-85.344h-434.336c-17.92 49.504-64.864 85.344-120.32 85.344-70.816 0-128-57.184-128-128s57.184-128 128-128c55.456 0 102.4 35.84 120.32 85.344h434.336c68.704 0 170.656 45.664 170.656 170.656v42.656c0 125.024-101.984 170.656-170.656 170.656zM810.656 789.344c23.456 0 42.656-19.2 42.656-42.656s-19.2-42.656-42.656-42.656c-23.456 0-42.656 19.2-42.656 42.656s19.2 42.656 42.656 42.656zM213.344 106.656c-23.456 0-42.656 19.2-42.656 42.656s19.2 42.656 42.656 42.656c23.456 0 42.656-19.2 42.656-42.656s-19.2-42.656-42.656-42.656z",GraphIcons.layoutAuto="M7.527 5.638l-2.485 1.392 1.392-2.485-1.392-2.485 2.485 1.392 2.485-1.392-1.392 2.485 1.392 2.485-2.485-1.392zM19.455 15.38l2.485-1.392-1.392 2.485 1.392 2.485-2.485-1.392-2.485 1.392 1.392-2.485-1.392-2.485 2.485 1.392zM21.941 2.059l-1.392 2.485 1.392 2.485-2.485-1.392-2.485 1.392 1.392-2.485-1.392-2.485 2.485 1.392 2.485-1.392zM13.332 12.775l2.425-2.425-2.107-2.107-2.425 2.425 2.107 2.107zM14.356 7.318l2.326 2.326c0.388 0.368 0.388 1.014 0 1.402l-11.601 11.601c-0.388 0.388-1.034 0.388-1.402 0l-2.326-2.326c-0.388-0.368-0.388-1.014 0-1.402l11.601-11.601c0.388-0.388 1.034-0.388 1.402 0z",GraphIcons.layoutRadial="M20.7 15.263c-0.576 0-1.098 0.228-1.49 0.598l-5.144-3.208c0.065-0.207 0.109-0.424 0.109-0.652s-0.043-0.446-0.109-0.652l5.133-3.208c0.402 0.37 0.924 0.598 1.501 0.598 1.196 0 2.175-0.979 2.175-2.175s-0.979-2.175-2.175-2.175-2.175 0.979-2.175 2.175c0 0.228 0.043 0.446 0.109 0.652l-5.144 3.219c-0.261-0.25-0.587-0.435-0.946-0.522v-4.513c0.935-0.239 1.631-1.088 1.631-2.099 0-1.196-0.979-2.175-2.175-2.175s-2.175 0.979-2.175 2.175c0 1.011 0.696 1.86 1.631 2.099v4.502c-0.359 0.098-0.685 0.283-0.946 0.522l-5.144-3.208c0.065-0.207 0.109-0.424 0.109-0.652 0-1.196-0.979-2.175-2.175-2.175s-2.175 0.979-2.175 2.175c0 1.196 0.979 2.175 2.175 2.175 0.576 0 1.098-0.228 1.49-0.598l5.144 3.208c-0.065 0.207-0.109 0.424-0.109 0.652s0.044 0.446 0.109 0.652l-5.133 3.208c-0.402-0.37-0.924-0.598-1.501-0.598-1.196 0-2.175 0.979-2.175 2.175s0.979 2.175 2.175 2.175 2.175-0.979 2.175-2.175c0-0.228-0.043-0.446-0.109-0.652l5.144-3.219c0.261 0.25 0.587 0.435 0.946 0.522v4.502c-0.935 0.25-1.631 1.098-1.631 2.11 0 1.196 0.979 2.175 2.175 2.175s2.175-0.979 2.175-2.175c0-1.011-0.696-1.86-1.631-2.099v-4.502c0.359-0.098 0.685-0.283 0.946-0.522l5.144 3.219c-0.065 0.196-0.109 0.413-0.109 0.642 0 1.196 0.979 2.175 2.175 2.175s2.175-0.979 2.175-2.175c0-1.196-0.979-2.175-2.175-2.175z",GraphIcons.layoutGrid="M5.7 3.6c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM14.1 3.6c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM22.5 3.6c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM22.5 12c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM22.5 20.4c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM14.1 20.4c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM5.7 20.4c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM5.7 12c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1zM14.1 12c0 1.16-0.94 2.1-2.1 2.1s-2.1-0.94-2.1-2.1c0-1.16 0.94-2.1 2.1-2.1s2.1 0.94 2.1 2.1z",GraphIcons.layoutHierarchial="M20.925 18.374v-4.347c0.903-0.231 1.575-1.050 1.575-2.027 0-1.155-0.945-2.1-2.1-2.1-0.977 0-1.795 0.672-2.027 1.575h-4.347c-0.189-0.735-0.767-1.312-1.501-1.501v-4.347c0.903-0.231 1.575-1.050 1.575-2.027 0-1.155-0.945-2.1-2.1-2.1s-2.1 0.945-2.1 2.1c0 0.976 0.672 1.795 1.575 2.027v4.347c-0.735 0.189-1.312 0.767-1.501 1.501h-4.347c-0.231-0.903-1.050-1.575-2.027-1.575-1.155 0-2.1 0.945-2.1 2.1 0 0.976 0.672 1.795 1.575 2.027v4.347c-0.903 0.231-1.575 1.050-1.575 2.027 0 1.155 0.945 2.1 2.1 2.1s2.1-0.945 2.1-2.1c0-0.977-0.672-1.795-1.575-2.027v-4.347c0.735-0.189 1.312-0.767 1.501-1.501h4.347c0.189 0.735 0.767 1.312 1.501 1.501v4.347c-0.903 0.231-1.575 1.050-1.575 2.027 0 1.155 0.945 2.1 2.1 2.1s2.1-0.945 2.1-2.1c0-0.977-0.672-1.795-1.575-2.027v-4.347c0.735-0.189 1.312-0.767 1.501-1.501h4.347c0.189 0.735 0.767 1.312 1.501 1.501v4.347c-0.903 0.231-1.575 1.050-1.575 2.027 0 1.155 0.945 2.1 2.1 2.1s2.1-0.945 2.1-2.1c0-0.977-0.672-1.795-1.575-2.027z"}(GraphIcons||(GraphIcons={}));const ContextMenuComponent=({item,custom})=>{const{t}=(0,es.Bd)("graph"),{graph,handleExpand,renderDetail}=useGraphInternal(),items=(0,react.useMemo)((()=>{const menu=[];if("edge"===item.type&&menu.push([{id:"neighbors",label:"action.neighbors"}]),"node"===item.type){const selectMenu=[],deleteMenu=[];selectMenu.push({id:"neighbors",label:"action.neighbors"}),selectMenu.push({id:"expand",icon:GraphIcons.toolExpand,label:"action.expand"}),2===graph.selectedItems.length&&selectMenu.push({id:"hilight",icon:GraphIcons.toolHilight,label:"action.hilight"}),deleteMenu.push({id:"delete",className:"text-danger",icon:GraphIcons.toolDelete,label:"action.delete"}),menu.push(selectMenu,deleteMenu)}return"canvas"===item.type&&menu.push([{id:"selectAll",label:"action.selectAll"}],[{id:"clear",className:"text-danger",icon:GraphIcons.toolErase,label:"action.clear"}]),menu}),[item,graph.selectedItems]),handleMenu=(0,react.useCallback)((id=>{if("hilight"===id&&graph.hilightPath(),"expand"===id&&handleExpand(graph.selectedItems),"delete"===id&&graph.removeSelected(),"clear"===id&&graph.ref?.clear(),"toggleDetail"===id){const nodes=graph.selectedItems.map((({id,data:{type,data,...rest}})=>({id,data:type?data:{type:"react-node",data:rest,x:rest.x,y:rest.y,renderDetail}}))),edges=graph.selectedItems.map((({id})=>graph.ref?.getRelatedEdgesData(id))).flat().filter(Boolean);graph.ref?.removeData("node",graph.selectedItems.map((({id})=>id))),graph.ref?.addData("node",nodes),edges?.length&&graph.ref?.addData("edge",edges)}}),[graph,handleExpand,renderDetail]);return(0,jsx_runtime.jsx)(dist.BT,{className:"ax-graph__menu",onClick:handleMenu,children:items.map(((list,idx)=>(0,jsx_runtime.jsxs)(react.Fragment,{children:[idx>0&&(0,jsx_runtime.jsx)(dist.nZ,{size:"xs"},idx),custom?.[idx]?.map?.(((item,cdx)=>(0,jsx_runtime.jsx)(dist.BT.Item,{id:item.id,label:item.label,icon:item.icon,className:item.className,isDisabled:item.isDisabled,onClick:()=>item.handler(graph.selectedItems)},`${idx}-custom-${cdx}`))),list.map(((item,jdx)=>(0,jsx_runtime.jsx)(dist.BT.Item,{id:item.id,label:t(item.label,item.label,{}),icon:item.icon,className:item.className},`${idx}-${jdx}`)))]},idx)))})},ContextMenu=({root,custom,...item})=>(0,react_dom.createPortal)((0,jsx_runtime.jsx)(ContextMenuComponent,{item,custom}),root);var algorithm_es=__webpack_require__("./node_modules/@antv/algorithm/es/index.js"),esm=__webpack_require__("./node_modules/@antv/g6/esm/index.js"),g6_react_node_dist=__webpack_require__("./node_modules/@antv/g6-react-node/dist/index.js");class AutoCombo extends esm.Ay.Extensions.CircleCombo{getMergedStyles(model){const ret=super.getMergedStyles(model);return model.data.childCount=this.graph.getComboChildrenData(model.id).length,ret.keyShape&&(model.data.collapsed&&(ret.keyShape.r=48),ret.keyShape.lineWidth=4,ret.keyShape.zIndex=4,ret.keyShape.fill=ret.keyShape.fillColor,ret.keyShape.stroke=ret.keyShape.strokeColor),ret.iconShape&&(ret.iconShape.text=void 0,ret.iconShape.zIndex=5,ret.iconShape.width=48,ret.iconShape.height=48),ret}drawBadgeShapes(model,shapeMap,diffData,diffState){const shapes={},keyShapeBBox=shapeMap.keyShape.getGeometryBounds();if(model.data.isImportant){const xl=keyShapeBBox.min[0],xr=keyShapeBBox.max[0],y=keyShapeBBox.min[1],bgHeight=32,pos={xl:xl-.25*xl,xr:xr-.25*xr,y:y-.25*y};shapes.topRightBadgeShape=this.upsertShape("text","topRightBadgeShape",Object.assign(Object.assign({text:"★",fill:"#fff",fontSize:24,x:pos.xr,y:pos.y+bgHeight/2}),{textAlign:"center",textBaseline:"middle",zIndex:5}),{shapeMap,model,diffData,diffState}),shapes.topRightBadgeBackgroundShape=this.upsertShape("rect","topRightBadgeBackgroundShape",Object.assign({fill:"#fc0",height:bgHeight,width:bgHeight,radius:bgHeight/2,zIndex:4,x:pos.xr-bgHeight/2,y:pos.y}),{shapeMap,model,diffData,diffState}),shapes.topLeftBadgeShape=this.upsertShape("text","topLeftBadgeShape",Object.assign(Object.assign({text:model.data.childCount?.toString()??"0",fill:"#fff",fontSize:24,x:pos.xl,y:pos.y+bgHeight/2}),{textAlign:"center",textBaseline:"middle",zIndex:5}),{shapeMap,model,diffData,diffState}),shapes.topLeftBadgeBackgroundShape=this.upsertShape("rect","topLeftBadgeBackgroundShape",Object.assign({fill:"#64748b",height:bgHeight,width:bgHeight,radius:bgHeight/2,zIndex:4,x:pos.xl-bgHeight/2,y:pos.y}),{shapeMap,model,diffData,diffState})}return shapes}drawOtherShapes(model,shapeMap,diffData,diffState){const{data}=model,keyShapeBBox=shapeMap.keyShape.getLocalBounds();return{markerShape:this.upsertShape("path","markerShape",{cursor:"pointer",stroke:"#64748b",lineWidth:1,zIndex:9,fill:shapeMap.keyShape?.config.style.fill,path:data.collapsed?esm.DX.markers.expand(keyShapeBBox.center[0],keyShapeBBox.max[1],16):esm.DX.markers.collapse(keyShapeBBox.center[0],keyShapeBBox.max[1],16)},{model,shapeMap,diffData,diffState})}}}class ManualCombo extends esm.Ay.Extensions.RectCombo{getMergedStyles(model){const ret=super.getMergedStyles(model);return model.data.childCount=this.graph.getComboChildrenData(model.id).length,ret.keyShape&&(model.data.collapsed&&(ret.keyShape.width=96,ret.keyShape.height=96,ret.keyShape.x=-48,ret.keyShape.y=-48),ret.keyShape.lineWidth=4,ret.keyShape.zIndex=4,ret.keyShape.fill=ret.keyShape.fillColor,ret.keyShape.stroke=ret.keyShape.strokeColor),ret.iconShape&&(ret.iconShape.text=void 0,ret.iconShape.src=`data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>folder-open</title><path fill="#1e293b" d="M19,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10L12,6H19A2,2 0 0,1 21,8H21L4,8V18L6.14,10H23.21L20.93,18.5C20.7,19.37 19.92,20 19,20Z" /></svg>')}`,ret.iconShape.zIndex=5,ret.iconShape.width=48,ret.iconShape.height=48),ret}drawBadgeShapes(model,shapeMap,diffData,diffState){const shapes={},keyShapeBBox=shapeMap.keyShape.getRenderBounds();if(model.data.isImportant){const bgHeight=32,pos={xl:keyShapeBBox.min[0]-keyShapeBBox.center[0],xr:keyShapeBBox.max[0]-keyShapeBBox.center[0],y:keyShapeBBox.min[1]-keyShapeBBox.center[1]-bgHeight/2};shapes.topRightBadgeShape=this.upsertShape("text","topRightBadgeShape",Object.assign(Object.assign({text:"★",fill:"#fff",fontSize:24,x:pos.xr,y:pos.y+bgHeight/2}),{textAlign:"center",textBaseline:"middle",zIndex:5}),{shapeMap,model,diffData,diffState}),shapes.topRightBadgeBackgroundShape=this.upsertShape("rect","topRightBadgeBackgroundShape",Object.assign({fill:"#fc0",height:bgHeight,width:bgHeight,radius:bgHeight/2,zIndex:4,x:pos.xr-bgHeight/2,y:pos.y}),{shapeMap,model,diffData,diffState}),shapes.topLeftBadgeShape=this.upsertShape("text","topLeftBadgeShape",Object.assign(Object.assign({text:model.data.childCount?.toString()??"0",fill:"#fff",fontSize:24,x:pos.xl,y:pos.y+bgHeight/2}),{textAlign:"center",textBaseline:"middle",zIndex:5}),{shapeMap,model,diffData,diffState}),shapes.topLeftBadgeBackgroundShape=this.upsertShape("rect","topLeftBadgeBackgroundShape",Object.assign({fill:"#475569",height:bgHeight,width:bgHeight,radius:bgHeight/2,zIndex:4,x:pos.xl-bgHeight/2,y:pos.y}),{shapeMap,model,diffData,diffState})}return shapes}drawOtherShapes(model,shapeMap,diffData,diffState){const{data}=model,keyShapeBBox=shapeMap.keyShape.getLocalBounds();return{markerShape:this.upsertShape("path","markerShape",{cursor:"pointer",stroke:"#666",lineWidth:1,zIndex:5,fill:shapeMap.keyShape?.config.style.fill,path:data.collapsed?esm.DX.markers.expand(keyShapeBBox.center[0],keyShapeBBox.max[1],16):esm.DX.markers.collapse(keyShapeBBox.center[0],keyShapeBBox.max[1],16)},{model,shapeMap,diffData,diffState})}}}const layoutSpec=(layout="auto",useWorker=!1)=>{let type={type:"force-layout",center:[0,0],nodeSize:196,presetLayout:{type:"circular-layout",nodeSize:32,nodeSpacing:120,linkDistance:120,preventOverlap:!0},kr:20,kg:.1,preventOverlap:!0,sortByCombo:!0,animated:!0,workerEnabled:useWorker};return"grid"===layout&&(type={type:"grid-layout",center:[0,0],nodeSize:120,gravity:.1,linkDistance:120,preventOverlap:!0,sortByCombo:!0,animated:!0,workerEnabled:useWorker}),"circular"===layout&&(type={type:"circular-layout",center:[0,0],nodeSize:32,nodeSpacing:120,linkDistance:120,sortByCombo:!0,preventOverlap:!0,animated:!0,workerEnabled:useWorker}),"radial"===layout&&(type={type:"radial-layout",center:[0,0],nodeSize:32,unitRadius:240,nodeSpacing:120,linkDistance:240,sortBy:"combo",sortByCombo:!0,preventOverlap:!0,animated:!0,workerEnabled:useWorker}),"hierarchy"===layout&&(type={type:"hierarchy-layout",nodeSize:32,nodesep:100,ranksep:70,sortByCombo:!0,align:void 0,preventOverlap:!0,animated:!0,workerEnabled:useWorker}),type},makeSvg=(path="",color="#333")=>`data:image/svg+xml,${encodeURIComponent(`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="${color}" d="${path}"></path></svg>`)}`,styleSpec=(bgColor,styleMap={})=>({combo:{type:{fields:["id","isManualGroup"],formatter:model=>model.data.isManualGroup?"manual-combo":"auto-combo"},keyShape:{strokeColor:{fields:["id","nodeType","color"],formatter:model=>model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color},fillColor:{fields:["id","nodeType","color"],formatter:model=>((hexColor,magnitude)=>{if(6===(hexColor=hexColor.replace("#","")).length){const decimalColor=parseInt(hexColor,16);let r=(decimalColor>>16)+magnitude;r>255&&(r=255),r<0&&(r=0);let g=(255&decimalColor)+magnitude;g>255&&(g=255),g<0&&(g=0);let b=(decimalColor>>8&255)+magnitude;return b>255&&(b=255),b<0&&(b=0),`#${(g|b<<8|r<<16).toString(16).padStart(6,"0")}`}return hexColor})(model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color,"#ffffff"===bgColor?88:-88)}},labelShape:{text:{fields:["id","nodeType","label"],formatter:model=>model.data.label??styleMap?.[model.data.nodeType]?.label??styleMap?.defaultNode?.label},dy:4,fontSize:12,maxWidth:"110%",position:"bottom"},labelBackgroundShape:{},iconShape:{width:38,height:38,cursor:"pointer",pointerEvents:"none",clipCfg:{type:"circle",r:16,cx:16,cy:16,show:!0,fill:"#f00"},src:{fields:["id","nodeType","avatar","color"],formatter:model=>model.data.avatar?model.data.avatar:makeSvg(model.data.iconPath??styleMap?.[model.data.nodeType]?.iconPath??styleMap?.defaultNode?.iconPath,model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color??"#94a3b8")}},badgeShapes:[],otherShapes:{},animates:{buildIn:[{fields:["opacity"],duration:500,delay:500+500*Math.random()}],buildOut:[{fields:["opacity"],duration:200}],update:[{fields:["lineWidth","r"],shapeId:"keyShape"},{fields:["opacity"],shapeId:"haloShape"}]}},node:{type:{fields:["id","nodeType"],formatter:model=>styleMap?.[model.data.nodeType]?.shape?`${styleMap?.[model.data.nodeType]?.shape??""}-node`:"donut-node"},keyShape:{r:32,zIndex:2,lineWidth:6,cursor:"pointer",stroke:{fields:["id","nodeType","color"],formatter:model=>model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color??"#94a3b8"},lineDash:{fields:["id","nodeType","strokeType"],formatter:model=>"dashed"===(model.data.strokeType??styleMap?.[model.data.nodeType]?.strokeType??styleMap?.defaultNode?.strokeType)?[8,4]:"dotted"===(model.data.strokeType??styleMap?.[model.data.nodeType]?.strokeType??styleMap?.defaultNode?.strokeType)?[4,4]:[]},fill:{fields:["id","nodeType","fill"],formatter:model=>model.data.fill??styleMap?.[model.data.nodeType]?.fill??styleMap?.defaultNode?.fill??bgColor}},badgeShapes:{fields:["id","isImportant"],formatter:model=>{const ret=[];return model.data.isImportant&&ret.push({position:"topRight",text:"★",fontSize:18,r:24,color:"#f59e0b",textColor:"#fff"}),ret}},labelShape:{text:{fields:["id","nodeType","label"],formatter:model=>model.data.label??styleMap?.[model.data.nodeType]?.label??styleMap?.defaultNode?.label},dy:4,fontSize:12,maxWidth:"110%",position:"bottom"},labelBackgroundShape:{},iconShape:{width:38,height:38,zIndex:5,cursor:"pointer",pointerEvents:"none",clipCfg:{type:"circle",r:16,cx:16,cy:16,show:!0,fill:"#f00"},src:{fields:["id","nodeType","avatar","color"],formatter:model=>model.data.avatar?model.data.avatar:makeSvg(model.data.iconPath??styleMap?.[model.data.nodeType]?.iconPath??styleMap?.defaultNode?.iconPath,model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color??"#94a3b8")}},donutShapes:{innerSize:.8,cursor:"pointer",attrs:{fields:["id","colorMap"],formatter:model=>model.data.colorMap?.map((()=>100/model.data.colorMap.length))},colorMap:{fields:["id","colorMap"],formatter:model=>model.data.colorMap?.sort()}}},nodeState:{selected:{keyShape:{r:36,stroke:"#f00"},haloShape:{r:42,stroke:"#f00"}},active:{haloShape:{r:42,opacity:.5,lineWidth:6,stroke:{fields:["id","nodeType","color"],formatter:model=>model.data.color??styleMap?.[model.data.nodeType]?.color??styleMap?.defaultNode?.color??"#94a3b8"}}},focus:{keyShape:{opacity:.9},iconShape:{opacity:.9},donutShapes:{innerSize:.8}},blur:{keyShape:{opacity:.1},iconShape:{opacity:.1},labelShape:{opacity:.1},donutShapes:{innerSize:1}},islocked:{anchorShapes:[{position:[0,0],r:8}]}},edge:{keyShape:{lineWidth:6,lineDash:{fields:["id","edgeType","strokeType"],formatter:model=>"dashed"===(model.data.strokeType??styleMap?.[model.data.edgeType]?.strokeType??styleMap?.defaultEdge?.strokeType)?[8,4]:"dotted"===(model.data.strokeType??styleMap?.[model.data.edgeType]?.strokeType??styleMap?.defaultEdge?.strokeType)?[4,4]:void 0},cursor:"pointer",stroke:{fields:["id","edgeType","color"],formatter:model=>model.data.color??styleMap?.[model.data.edgeType]?.color??styleMap?.defaultEdge?.color??"#6b7280"}},labelShape:{text:{fields:["id","edgeType","label"],formatter:model=>model.data.label??styleMap?.[model.data.edgeType]?.label??styleMap?.defaultEdge?.label},dy:-8,fontSize:12,maxWidth:"110%",position:"top"}},edgeState:{active:{keyShape:{lineWidth:6},haloShape:{lineWidth:22}},hilight:{haloShape:{opacity:.5,lineWidth:12,stroke:"#f00"}},blur:{keyShape:{opacity:.1,stroke:"#8888"}}}}),ExtGraph=esm.Ay.extend(esm.Ay.Graph,{combos:{"auto-combo":AutoCombo,"manual-combo":ManualCombo},nodes:{"donut-node":esm.Ay.Extensions.DonutNode,"react-node":(0,g6_react_node_dist.Sw)((({model})=>model.data.renderDetail({id:model.id,data:model.data.data})))},edges:{"quadratic-edge":esm.Ay.Extensions.QuadraticEdge},layouts:{"force-layout":esm.Ay.Extensions.ForceAtlas2Layout,"circular-layout":esm.Ay.Extensions.ConcentricLayout,"radial-layout":esm.Ay.Extensions.RadialLayout,"hierarchy-layout":esm.Ay.Extensions.DagreLayout,"grid-layout":esm.Ay.Extensions.GridLayout,"combo-layout":esm.Ay.Extensions.ComboCombinedLayout},transforms:{"process-parallel-edges":esm.Ay.Extensions.ProcessParallelEdges},behaviors:{"lasso-select":esm.Ay.Extensions.LassoSelect,"brush-select":esm.Ay.Extensions.BrushSelect,"hover-state":esm.Ay.Extensions.HoverActivate,"activate-relations":esm.Ay.Extensions.ActivateRelations},plugins:{legend:esm.Ay.Extensions.Legend,tooltip:esm.Ay.Extensions.Tooltip,contextmenu:esm.Ay.Extensions.Menu}}),GraphContext=(0,react.createContext)({}),GraphProvider=({data,styleMap,defaultLayout="auto",readOnly,useWorker,children,graphRef,renderTooltip:TooltipEl,renderDetail:DetailEl,onDataLoad,onClear,onNodeExpand,onNodeSelected,onContextMenu})=>{const[container,setContainer]=(0,react.useState)(null),graph=((container,opts)=>{const[graph,setGraph]=(0,react.useState)(),[isClear,setClear]=(0,react.useState)(!0),[selectedItems,setSelectedItems]=(0,react.useState)([]),styleMap=(0,react.useRef)(),bgColor=(0,react.useRef)("#ffffff"),{message}=(0,dist.w2)(),isDark=(0,dist.Yf)(),options=Object.assign({useWorker:!1,onClear:void 0,onNodeSelected:void 0},opts),clearHilights=(0,react.useCallback)((g=>{g.clearItemState(g.getAllEdgesData().map((edge=>edge.id)),["hilight"])}),[]);(0,react.useEffect)((()=>{if(container){const readonlyMode=[{key:"zoom",type:"zoom-canvas",optimize:!0,minZoom:.2,maxZoom:18},{key:"drag",type:"drag-canvas",optimize:!0,scalableRange:0},{key:"relations",type:"activate-relations",trigger:"pointerenter",activeState:"focus"},{key:"hover",type:"hover-state",activateState:"active"}],graph=new ExtGraph({container,renderer:"canvas",autoFit:"view",modes:{default:readonlyMode,edit:[...readonlyMode,{type:"drag-node",enableTransient:!1},{type:"drag-combo",enableTransient:!1},{key:"click",type:"click-select",itemTypes:["node"],eventName:"select"},{key:"brush",type:"brush-select",itemTypes:["node"],selectSetMode:"latest",trigger:"shift",eventName:"dragZoom",selectedState:"__zoom__"},{key:"lasso",type:"lasso-select",itemTypes:["node"],eventName:"brush-select",trigger:"ctrl",selectSetMode:"union"}],brush:[{key:"brush",type:"brush-select",itemTypes:["node"],eventName:"brush-select",trigger:"drag",selectSetMode:"union"}],lasso:[{key:"lasso",type:"lasso-select",itemTypes:["node"],eventName:"brush-select",trigger:"drag",selectSetMode:"union"}]},plugins:[],transforms:[{type:"process-parallel-edges",multiEdgeType:"quadratic-edge"}],...getStyleSpec()}),handleEnter=(0,utilities_dist.debounce)((e=>{const{itemId}=e,allNodesId=graph.getAllNodesData().map((node=>node.id)),allEdgesIds=graph.getAllEdgesData().map((edge=>edge.id)),highlightIds=[itemId];graph.setItemState(itemId,"blur",!1),graph.getAllEdgesData().forEach((edge=>{const sourceId=edge.source,targetId=edge.target;sourceId===itemId?(graph.setItemState([sourceId,edge.id],"blur",!1),highlightIds.push(targetId,edge.id)):targetId===itemId&&(graph.setItemState([targetId,edge.id],"blur",!1),highlightIds.push(sourceId,edge.id))})),graph.setItemState([...allNodesId,...allEdgesIds].filter((id=>!highlightIds.includes(id))),"blur",!0)}),500);graph.on("node:pointerenter",handleEnter),graph.on("node:pointerleave",(()=>{handleEnter.cancel();const allNodesIds=graph.getAllNodesData().map((node=>node.id)),allEdgesIds=graph.getAllEdgesData().map((edge=>edge.id));graph.setItemState([...allNodesIds,...allEdgesIds],"blur",!1)})),graph.on("dragZoom",(e=>{e.selectedIds.nodes.length&&graph.focusItem(e.selectedIds.nodes)}));const doSelectEdge=(action,edgeId)=>{const edgeData=graph.getEdgeData(edgeId);edgeData&&graph.setItemState([edgeData.source,edgeData.target],"selected","select"===action)},doSelectCombo=(action,comboId)=>{const nodes=graph.getComboChildrenData(comboId).map((node=>node.id));nodes.length&&graph.setItemState(nodes,"selected","select"===action)};graph.on("select",(e=>{clearHilights(graph),"edge"===e.itemType&&doSelectEdge(e.action,e.itemId),"combo"===e.itemType&&doSelectCombo(e.action,e.itemId)})),graph.on("brush-select",(e=>{clearHilights(graph),e.selectedIds?.edges.forEach((edgeId=>doSelectEdge(e.action,edgeId))),e.selectedIds?.combos.forEach((comboId=>doSelectEdge(e.action,comboId))),e.deselectedIds?.edges.forEach((edgeId=>doSelectEdge(e.action,edgeId))),e.deselectedIds?.combos.forEach((comboId=>doSelectEdge(e.action,comboId)))})),graph.on("combo:click",(event=>{const{itemId,target}=event;if("markerShape"===target?.id){const model=graph.getComboData(itemId);model?.data.collapsed?graph.expandCombo(itemId):graph.collapseCombo(itemId)}})),graph.on("node:click",(event=>{const{itemId,target}=event;if("collapseMarker"===target?.id){const model=graph.getComboData(itemId);model?.data.collapsed?graph.expandCombo(itemId):graph.collapseCombo(itemId)}})),graph.on("afteritemstatechange",(0,utilities_dist.debounce)((e=>{const selectedItemsRef=graph?.getAllNodesData().filter((node=>graph?.getItemState(node.id,"selected")))??[];setSelectedItems(selectedItemsRef)}))),container.addEventListener("contextmenu",(e=>(e.stopPropagation(),e.preventDefault(),!1)));const ob=new ResizeObserver((()=>{graph.setSize([container.offsetWidth,container.offsetHeight]),resetView()}));return ob.observe(container),setGraph(graph),window.graph=graph,()=>{ob.disconnect()}}}),[container]),(0,react.useEffect)((()=>{bgColor.current=isDark?"#222222":"#ffffff",graph?.updateTheme({type:"spec",base:isDark?"dark":"light"}),graph?.updateSpecification(getStyleSpec())}),[isDark,graph]),(0,react.useEffect)((()=>{if(graph){const handler=(0,utilities_dist.debounce)((()=>{clearHilights(graph);const cleared=0===graph.getAllNodesData().length;setClear(cleared),cleared&&options.onClear?.()}));return graph?.on("afteritemchange",handler),()=>{graph?.off("afteritemchange",handler)}}}),[graph,options.onClear]),(0,react.useEffect)((()=>{if(graph){const handler=e=>{if("updateState"===e.action&&e.states?.includes("selected")){const selectedItemsRef=graph?.getAllNodesData().filter((node=>graph?.getItemState(node.id,"selected")))??[];setSelectedItems(selectedItemsRef),options.onNodeSelected?.(selectedItemsRef)}};return graph?.on("afteritemstatechange",handler),()=>{graph?.off("afteritemstatechange",handler)}}}),[graph,options.onNodeSelected]);const loadData=(0,react.useCallback)((({nodes,edges,combos})=>{graph?.read({nodes,edges,combos}).then((()=>{resetView(),graph.emit("dataloaded")}))}),[graph]),addData=(0,react.useCallback)((({nodes,edges,combos})=>{combos&&graph?.addData("combo",combos),nodes&&graph?.addData("node",nodes),edges&&graph?.addData("edge",edges),graph?.layout().then((()=>{resetView(),graph.emit("dataloaded")}))}),[graph]),removeSelected=(0,react.useCallback)((()=>{const edges=[],items=graph?.findIdByState("node","selected",!0)??[];items.forEach((id=>{edges.push(...graph?.getRelatedEdgesData(id)?.map((ed=>ed.id))??[])})),graph?.setItemState([...edges,...items],"selected",!1),edges.length&&graph?.removeData("edge",(0,utilities_dist.dedupe)(edges)),items.length&&graph?.removeData("node",(0,utilities_dist.dedupe)(items))}),[graph]),selectByProp=(0,react.useCallback)(((prop,value)=>{const ids=graph?.getAllNodesData().filter((node=>node.data?.[prop]===value)).map((node=>node.id));ids?.length&&graph?.setItemState(ids,"selected",!0)}),[graph]),resetView=(0,react.useCallback)((()=>{graph?.fitView({padding:24,rules:{boundsType:"layout"}})}),[graph]),resetLayout=(0,react.useCallback)((layout=>{graph?.updateSpecification({layout:layoutSpec(layout,options.useWorker)})}),[graph,options.useWorker]),applyLayout=(0,react.useCallback)((layout=>{graph?.once("afterlayout",(()=>resetView())),graph?.layout(layoutSpec(layout,options.useWorker))}),[graph,options.useWorker]),hilightNode=(0,react.useCallback)(((nodeId,hilight=!0)=>{graph?.setItemState(nodeId,"hilight",hilight)}),[graph]),selectNode=(0,react.useCallback)(((nodeId,selected=!0)=>{graph?.setItemState(nodeId,"selected",selected)}),[graph]),updateSelectedList=(0,react.useCallback)((()=>{const selectedItemsRef=graph?.getAllNodesData().filter((node=>graph?.getItemState(node.id,"selected")))??[];setSelectedItems(selectedItemsRef)}),[graph]),hilightPath=(0,react.useCallback)((()=>{if(2===selectedItems.length){const{path=[]}=(0,algorithm_es.Lg)({nodes:graph?.getAllNodesData(),edges:graph?.getAllEdgesData()},selectedItems[0].id.toString(),selectedItems[1].id.toString());graph&&clearHilights(graph);const edges=(graph?.getAllEdgesData().filter((edge=>path.includes(edge.source)&&path.includes(edge.target)))??[]).map((edge=>edge.id));edges.length&&(graph?.setItemState(path,"selected",!0),graph?.setItemState(edges,"hilight",!0),graph?.frontItem([...path,...edges])),0===edges.length&&message("Path between nodes not found")}}),[graph,selectedItems]),restyle=(0,react.useCallback)((map=>{styleMap.current=map}),[]),getStyleSpec=(0,react.useCallback)((()=>styleSpec(bgColor.current,styleMap.current)),[]),exportImage=(0,react.useCallback)((async()=>await(graph?.toFullDataURL("image/png",{padding:[0,0,-24,0]}))),[graph]);return{ref:graph,isClear,selectedItems,loadData,addData,removeSelected,restyle,resetView,applyLayout,resetLayout,selectNode,selectByProp,hilightNode,hilightPath,exportImage,updateSelectedList}})(container,{useWorker,onClear,onNodeSelected}),{message}=(0,dist.w2)();(0,react.useImperativeHandle)(graphRef,(()=>graph),[graph]),(0,react.useEffect)((()=>{graph.restyle(styleMap)}),[graph.restyle,styleMap]),(0,react.useEffect)((()=>{graph.resetLayout(defaultLayout)}),[graph.resetLayout,defaultLayout]),(0,react.useEffect)((()=>{graph.ref?.setMode(readOnly?"default":"edit")}),[graph.ref,readOnly]),(0,react.useEffect)((()=>{data&&graph.loadData(data)}),[graph.loadData,data]),(0,react.useEffect)((()=>(graph.ref?.on("dataloaded",(()=>{graph.ref&&onDataLoad?.(graph.ref)})),()=>{graph.ref?.off("dataloaded")})),[graph.ref,onDataLoad]);const changeMode=(0,react.useCallback)((mode=>{graph.ref?.setMode(mode??(readOnly?"default":"edit")),container&&(container.dataset.brush=mode?"true":"false")}),[graph.ref,container,readOnly]),handleExpand=(0,react.useCallback)((nodes=>{onNodeExpand?.(nodes).then((newData=>{graph.addData(newData)})).catch((()=>{message({message:"Unable to fetch node data",color:"danger"})}))}),[graph.ref,onNodeExpand]),[contextMenu,setContextMenu]=(0,react.useState)();(0,react.useEffect)((()=>{if(graph.ref)return graph.ref?.addPlugins([{key:"default-contextmenu",type:"contextmenu",trigger:"contextmenu",offsetX:-1*(container?.offsetLeft??0),className:"ax-graph__menu-container",itemTypes:["node","edge","canvas","combo"],shouldBegin:()=>!!graph.ref?.getAllNodesData()?.length,onHide:()=>{container?.querySelector(".ax-graph__menu-portal")?.remove()},getContent:e=>{let item={type:"canvas"};if("node"===e.itemType&&(item=graph.ref?.getNodeData(e.itemId)),"edge"===e.itemType&&(item=graph.ref?.getEdgeData(e.itemId)),"combo"===e.itemType&&(item=graph.ref?.getComboData(e.itemId)),e.itemId&&!graph.ref?.getItemState(e.itemId,"selected")){const nodes=graph.ref?.findIdByState("node","selected",!0)??[],edges=graph.ref?.findIdByState("edge","selected",!0)??[],combos=graph.ref?.findIdByState("combo","selected",!0)??[];nodes?.length&&graph.ref?.setItemState([...nodes,...edges,...combos],"selected",!1)}return e.itemId&&graph.ref?.setItemState(e.itemId,"selected",!0),graph.updateSelectedList(),setTimeout((()=>{setContextMenu({type:e.itemType,...item})}),100),"<div class='ax-graph__menu-portal'/>"}}]),()=>{try{graph.ref?.removePlugins(["default-contextmenu"])}catch{}}}),[graph.ref,container]);const timerRef=(0,react.useRef)();(0,react.useEffect)((()=>{if(TooltipEl&&container)return graph.ref?.addPlugins([{key:"default-tooltip",type:"tooltip",className:"ax-graph__tooltip-container",itemTypes:["node","edge","combo"],shouldBegin:e=>!!graph.ref?.getAllNodesData()?.length,getContent:e=>{let item;return clearTimeout(timerRef.current),"node"===e.itemType&&(item=graph.ref?.getNodeData(e.itemId)),"edge"===e.itemType&&(item=graph.ref?.getEdgeData(e.itemId),item={...item,source:item.source&&graph.ref?.getNodeData(item.source),target:item.target&&graph.ref?.getNodeData(item.target)},item.source&&(item.source.style=styleMap?.[item.source.data?.nodeType]??styleMap?.defaultNode??{color:"#6b7280"}),item.target&&(item.target.style=styleMap?.[item.target.data?.nodeType]??styleMap?.defaultNode??{color:"#6b7280"})),"combo"===e.itemType&&(item=graph.ref?.getComboData(e.itemId)),item&&(timerRef.current=setTimeout((()=>{(0,client.createRoot)(container.querySelector(".ax-graph__tooltip-portal")).render((0,jsx_runtime.jsx)(TooltipEl,{item,itemType:e.itemType,style:styleMap?.[item.data?.nodeType??item.data?.edgeType]??styleMap?.["edge"===e.itemType?"defaultEdge":"defaultNode"]??{color:"#6b7280"}}))}),200)),container.querySelector(".ax-graph__tooltip-portal")?.remove(),`<div class='ax-graph__tooltip-portal' data-id="${e.itemId}"></div>`}}]),()=>{try{graph.ref?.removePlugins(["default-tooltip"])}catch{}}}),[graph.ref,container,styleMap,TooltipEl]);const renderDetail=(0,react.useCallback)((item=>DetailEl?(0,jsx_runtime.jsx)(DetailEl,{item,style:styleMap?.[item.data?.nodeType??"defaultNode"]??styleMap?.defaultNode??{color:"#6b7280"}}):(0,jsx_runtime.jsx)("div",{className:"border rounded p-2",children:"No renderer available"})),[styleMap,DetailEl]);return(0,jsx_runtime.jsxs)(GraphContext.Provider,{value:{graph,changeMode,onNodeExpand,handleExpand,renderDetail},children:[(0,jsx_runtime.jsxs)("div",{className:"ax-graph-viewer",children:[(0,jsx_runtime.jsx)("div",{className:"ax-graph__container",ref:setContainer}),children]}),contextMenu&&(0,jsx_runtime.jsx)(ContextMenu,{root:container?.querySelector(".ax-graph__menu-portal"),custom:onContextMenu?.({type:contextMenu.type}),...contextMenu})]})},useGraphInternal=()=>(0,react.useContext)(GraphContext),AxGraph=props=>(0,jsx_runtime.jsx)(GraphProvider,{...props});AxGraph.Toolbar=({children})=>(0,jsx_runtime.jsx)(dist.A$,{width:"auto",className:"graph-toolbar",children:(0,jsx_runtime.jsx)(dist.N_,{padding:"none",className:"flex flex-col gap-1 bg-none no-scrollbars",children})}),AxGraph.Legend=()=>{const{graph}=useGraphInternal();return(0,react.useEffect)((()=>(!graph.isClear&&graph.ref?.addPlugins([{key:"default-legend",type:"legend",className:"ax-graph__legend",size:[250,"fit-content"],node:{enable:!0,padding:[20,20],title:"node-legend",typeField:"nodeType",cols:4,labelStyle:{spacing:8,color:"#333"}},edge:{enable:!0,padding:[10,20],title:"edge-legend",typeField:"edgeType",cols:4,labelStyle:{spacing:8,color:"#333"}}}]),()=>{graph.ref?.removePlugins(["default-legend"]),graph.ref?.container.querySelector(".ax-graph__legend")?.remove()})),[graph.ref,graph.isClear]),null},AxGraph.ActionGroup=({children})=>(0,jsx_runtime.jsx)(dist.MR.Group,{isVertical:!0,variant:"flat",children}),AxGraph.ActionBrush=()=>{const{t}=(0,es.Bd)("graph"),{changeMode,graph}=useGraphInternal(),[enabled,setEnabled]=(0,react.useState)(),enableBrush=(0,react.useCallback)((mode=>{changeMode(mode),setEnabled(mode)}),[changeMode]);return(0,jsx_runtime.jsxs)(react.Fragment,{children:[enabled&&(0,jsx_runtime.jsxs)(dist.MR.Group,{variant:"flat",className:"m-0 fixed z-10 bg-base",children:[(0,jsx_runtime.jsx)(dist.MR,{className:"flush m-0",variant:"lasso"===enabled?"solid":"link",icon:GraphIcons.selectLasso,onClick:()=>enableBrush("lasso"),tooltip:{content:t("action.lassoSelect"),placement:"bottom"}}),(0,jsx_runtime.jsx)(dist.MR,{className:"flush m-0",variant:"brush"===enabled?"solid":"link",icon:GraphIcons.selectRect,onClick:()=>enableBrush("brush"),tooltip:{content:t("action.brushSelect"),placement:"bottom"}}),(0,jsx_runtime.jsx)(dist.MR,{variant:"link",className:"flush",onClick:()=>enableBrush(void 0),children:t("action.cancel")})]}),(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.selectLasso,isDisabled:graph.isClear,onClick:()=>enableBrush("lasso"),tooltip:{content:t("action.startSelect"),placement:"right"}})]})},AxGraph.ActionClear=()=>{const{t}=(0,es.Bd)("graph"),{graph}=useGraphInternal();return(0,jsx_runtime.jsx)(dist.MR.Confirm,{color:"danger",placement:"right",actionType:"danger",isDisabled:graph.isClear,message:(0,jsx_runtime.jsx)("div",{className:"text-center",children:"Clear graph?"}),icon:GraphIcons.toolErase,onClick:b=>b&&graph.ref?.clear(),tooltip:{content:t("action.clear"),placement:"right"}})},AxGraph.ActionHilight=()=>{const{t}=(0,es.Bd)("graph"),{graph}=useGraphInternal();return(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.toolHilight,isDisabled:graph.isClear||2!==graph.selectedItems.length,onClick:()=>{graph.hilightPath()},tooltip:{content:t("action.hilight"),placement:"right"}})},AxGraph.ActionDelete=()=>{const{t}=(0,es.Bd)("graph"),{graph}=useGraphInternal();return(0,react.useEffect)((()=>(graph.ref?.on("keydown",(e=>{"Delete"===e.key&&graph.removeSelected()})),()=>{graph.ref?.off("keydown")})),[graph.ref]),(0,jsx_runtime.jsx)(react.Fragment,{children:(0,jsx_runtime.jsx)(dist.MR,{color:"danger",icon:GraphIcons.toolDelete,isDisabled:graph.isClear||!graph.selectedItems.length,onClick:graph.removeSelected,tooltip:{content:t("action.delete"),placement:"right"}})})},AxGraph.ActionExpand=()=>{const{t}=(0,es.Bd)("graph"),{graph,handleExpand}=useGraphInternal();return(0,react.useEffect)((()=>(graph.ref?.on("node:dblclick",(e=>{const node=graph.ref?.getNodeData(e.itemId);node&&handleExpand([node])})),()=>{graph.ref?.off("node:dblclick")})),[graph.ref]),(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.toolExpand,isDisabled:graph.isClear||!graph.selectedItems.length,onClick:()=>{handleExpand(graph.selectedItems)},tooltip:{content:t("action.expand"),placement:"right"}})},AxGraph.ActionLayout=()=>{const{t}=(0,es.Bd)("graph"),{graph}=useGraphInternal();return(0,jsx_runtime.jsxs)(dist.MR.Group,{isVertical:!0,variant:"flat",children:[(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.layoutAuto,isDisabled:graph.isClear,onClick:()=>graph.applyLayout("auto"),tooltip:{content:t("action.layoutAuto"),placement:"right"}}),(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.layoutRadial,isDisabled:graph.isClear,onClick:()=>graph.applyLayout("radial"),tooltip:{content:t("action.layoutRadial"),placement:"right"}}),(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.layoutGrid,isDisabled:graph.isClear,onClick:()=>graph.applyLayout("grid"),tooltip:{content:t("action.layoutGrid"),placement:"right"}}),(0,jsx_runtime.jsx)(dist.MR,{icon:GraphIcons.layoutHierarchial,isDisabled:graph.isClear,onClick:()=>graph.applyLayout("hierarchy"),tooltip:{content:t("action.layoutHierarchy"),placement:"right"}})]})},AxGraph.ActionZoom=()=>{const{t}=(0,es.Bd)("graph"),{graph}=useGraphInternal(),[zoom,setZoom]=(0,react.useState)(0);return(0,react.useEffect)((()=>(graph.ref?.on("viewportchange",(()=>{const zoom=graph.ref?.getZoom()??1;setZoom(zoom<=.25?-1:zoom>=15?1:0)})),()=>{graph.ref?.off("viewportchange")})),[graph.ref]),(0,jsx_runtime.jsxs)(dist.MR.Group,{isVertical:!0,variant:"flat",children:[(0,jsx_runtime.jsx)(dist.MR,{className:"flush",icon:GraphIcons.zoomIn,isDisabled:graph.isClear||1===zoom,onClick:()=>graph.ref?.zoom(1.5),tooltip:{content:t("action.zoomin"),placement:"right"}}),(0,jsx_runtime.jsx)(dist.MR,{className:"flush",icon:GraphIcons.zoomOut,isDisabled:graph.isClear||-1===zoom,onClick:()=>graph.ref?.zoom(.5),tooltip:{content:t("action.zoomout"),placement:"right"}}),(0,jsx_runtime.jsx)(dist.MR,{className:"flush",icon:GraphIcons.zoomReset,isDisabled:graph.isClear,onClick:graph.resetView,tooltip:{content:t("action.fitView"),placement:"right"}})]})},AxGraph.EmptyIcon=()=>(0,jsx_runtime.jsxs)("svg",{version:"1.1",className:"text-8xl",viewBox:"0 0 504.32 504.32",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsxs)("g",{transform:"translate(1 3)",children:[(0,jsx_runtime.jsx)("path",{className:"fill-primary-500/50",d:"M472.6,172.36c14.507,0,25.6,11.093,25.6,25.6c0,14.507-11.093,25.6-25.6,25.6\n\t\tc-14.507,0-25.6-11.093-25.6-25.6C447,183.453,458.093,172.36,472.6,172.36z M250.733,18.76c14.507,0,25.6,11.093,25.6,25.6\n\t\ts-11.093,25.6-25.6,25.6c-14.507,0-25.6-11.093-25.6-25.6S236.227,18.76,250.733,18.76z M387.267,428.36\n\t\tc14.507,0,25.6,11.093,25.6,25.6s-11.093,25.6-25.6,25.6c-14.507,0-25.6-11.093-25.6-25.6c0-8.533,4.267-16.213,10.24-20.48\n\t\tC376.173,430.067,381.293,428.36,387.267,428.36z M28.867,172.36c14.507,0,25.6,11.093,25.6,25.6c0,14.507-11.093,25.6-25.6,25.6\n\t\ts-25.6-11.093-25.6-25.6C3.267,183.453,14.36,172.36,28.867,172.36z M114.2,428.36c14.507,0,25.6,11.093,25.6,25.6\n\t\ts-11.093,25.6-25.6,25.6s-25.6-11.093-25.6-25.6S99.693,428.36,114.2,428.36z"}),(0,jsx_runtime.jsx)("circle",{className:"fill-primary-500/20",cx:"250.733",cy:"266.227",r:"119.067"})]}),(0,jsx_runtime.jsx)("path",{className:"fill-bw-500/50",d:"M388.267,486.827c-16.213,0-29.867-13.653-29.867-29.867c0-8.533,3.413-15.36,8.533-20.48\n\tl-16.213-18.773c-0.853-0.853-0.853-1.707-0.853-2.56c0-0.853,0.853-2.56,1.707-3.413c1.707-1.707,4.267-1.707,5.973,0.853\n\tl16.213,19.627c4.267-2.56,9.387-3.413,14.507-3.413c16.213,0,29.867,13.653,29.867,29.867S404.48,486.827,388.267,486.827z\n\t M375.467,439.893c-5.12,4.267-8.533,10.24-8.533,17.067c0,11.947,9.387,21.333,21.333,21.333c11.947,0,21.333-9.387,21.333-21.333\n\tc0-11.947-9.387-21.333-21.333-21.333C383.147,435.627,378.88,437.333,375.467,439.893L375.467,439.893z M115.2,486.827\n\tc-16.213,0-29.867-13.653-29.867-29.867s13.653-29.867,29.867-29.867c5.12,0,9.387,0.853,13.653,3.413l17.067-19.627\n\tc1.707-1.707,4.267-1.707,5.973,0c0.853,0.853,1.707,1.707,1.707,3.413c0,0.853,0,1.707-0.853,2.56L135.68,436.48\n\tc5.973,5.12,9.387,12.8,9.387,21.333C145.067,473.173,131.413,486.827,115.2,486.827z M115.2,435.627\n\tc-11.947,0-21.333,9.387-21.333,21.333c0,11.947,9.387,21.333,21.333,21.333s21.333-9.387,21.333-21.333\n\tC136.533,445.013,127.147,435.627,115.2,435.627z M251.733,418.56L251.733,418.56L251.733,418.56L251.733,418.56L251.733,418.56\n\tL251.733,418.56c-82.773,0-149.333-67.413-149.333-149.333c0-2.56,0-5.973,0-8.533c0-2.56,2.56-4.267,4.267-4.267\n\tc2.56,0,4.267,2.56,4.267,4.267c0,2.56,0,5.12,0,8.533c0,73.387,56.32,133.973,128,139.947\n\tc-16.213-14.507-47.787-46.08-61.44-93.013h-29.867c-2.56,0-4.267-1.707-4.267-4.267s1.707-4.267,4.267-4.267h28.16\n\tc-2.56-11.947-4.267-24.747-4.267-38.4c0-13.653,1.707-26.453,4.267-38.4h-62.293h-0.853c-0.853,0-0.853,0-1.707-0.853\n\tc-0.853,0-0.853-0.853-1.707-0.853c0-0.853-0.853-0.853-0.853-1.707c0-0.853,0-0.853,0-1.707v-0.853\n\tc18.773-63.147,76.8-104.96,142.507-104.96l0,0l0,0l0,0l0,0l0,0l0,0l0,0l0,0c81.92,0,149.333,67.413,149.333,149.333\n\tc0,2.56,0,5.973,0,8.533c0,2.56-2.56,4.267-4.267,4.267c-2.56,0-4.267-2.56-4.267-4.267c0-2.56,0-5.12,0-8.533\n\tc0-73.387-56.32-133.973-128-139.947c16.213,14.507,47.787,46.08,61.44,93.013h29.867c2.56,0,4.267,1.707,4.267,4.267\n\tc0,2.56-1.707,4.267-4.267,4.267h-28.16c2.56,11.947,4.267,24.747,4.267,38.4s-1.707,26.453-4.267,38.4h62.293h0.853\n\tc0.853,0,0.853,0,1.707,0.853c0.853,0,0.853,0.853,1.707,0.853c0,0.853,0.853,0.853,0.853,1.707c0,0.853,0,0.853,0,1.707v0.853\n\tC375.467,375.893,318.293,418.56,251.733,418.56L251.733,418.56L251.733,418.56L251.733,418.56z M325.973,316.16\n\tc-13.653,46.933-45.227,79.36-61.44,93.013C320,404.053,366.08,368.213,384,316.16H325.973z M256,316.16v89.6\n\tc14.507-11.093,46.933-41.813,61.44-89.6H256z M186.027,316.16c14.507,46.933,46.933,77.653,61.44,89.6v-89.6H186.027z M256,307.627\n\th64c2.56-11.947,4.267-24.747,4.267-38.4c0-13.653-1.707-26.453-4.267-38.4h-64V307.627z M183.467,307.627h64v-76.8h-64\n\tc-2.56,11.947-4.267,24.747-4.267,38.4C179.2,282.88,180.907,295.68,183.467,307.627z M256,222.293h61.44\n\tc-14.507-46.933-46.933-77.653-61.44-89.6V222.293z M186.027,222.293h61.44v-89.6C232.96,144.64,200.533,175.36,186.027,222.293z\n\t M118.613,222.293h58.027c13.653-46.933,45.227-79.36,61.44-93.013C183.467,133.547,137.387,170.24,118.613,222.293z M473.6,230.827\n\tc-11.093,0-21.333-6.827-26.453-16.213l-18.773,7.68c-2.56,0.853-4.267,0-5.12-2.56c0-0.853,0-0.853,0-1.707\n\tc0-1.707,0.853-3.413,2.56-4.267l19.627-7.68c0-1.707-0.853-4.267-0.853-5.973c0-16.213,13.653-29.867,29.867-29.867\n\ts29.867,13.653,29.867,29.867S489.813,230.827,473.6,230.827z M453.12,208.64c2.56,8.533,11.093,13.653,20.48,13.653\n\tc11.947,0,21.333-9.387,21.333-21.333c0-11.947-9.387-21.333-21.333-21.333c-11.947,0-21.333,9.387-21.333,21.333\n\tC452.267,203.52,452.267,206.08,453.12,208.64C453.12,207.787,453.12,207.787,453.12,208.64\n\tC453.12,207.787,453.12,207.787,453.12,208.64z M29.867,230.827C13.653,230.827,0,217.173,0,200.96s13.653-29.867,29.867-29.867\n\ts29.867,13.653,29.867,29.867c0,1.707,0,4.267-0.853,5.973l19.627,7.68c1.707,0.853,2.56,2.56,2.56,4.267c0,0.853,0,0.853,0,1.707\n\tc-0.853,2.56-3.413,3.413-5.12,2.56l-19.627-7.68C51.2,224,40.96,230.827,29.867,230.827z M29.867,179.627\n\tc-11.947,0-21.333,9.387-21.333,21.333c0,11.947,9.387,21.333,21.333,21.333c9.387,0,17.067-5.973,20.48-13.653l0,0l0,0\n\tc0.853-2.56,0.853-4.267,0.853-6.827C51.2,189.013,41.813,179.627,29.867,179.627z M251.733,98.56c-2.56,0-4.267-1.707-4.267-4.267\n\tV77.227c-14.507-1.707-25.6-14.507-25.6-29.867c0-16.213,13.653-29.867,29.867-29.867S281.6,31.147,281.6,47.36\n\tc0,15.36-11.093,27.307-25.6,29.867v17.067C256,96.853,254.293,98.56,251.733,98.56z M251.733,26.027\n\tc-11.947,0-21.333,9.387-21.333,21.333s9.387,21.333,21.333,21.333c11.947,0,21.333-9.387,21.333-21.333\n\tS263.68,26.027,251.733,26.027z"})]})}}]);