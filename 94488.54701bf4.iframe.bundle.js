"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[94488],{"./node_modules/@arcgis/core/geohash/geohashUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Hq:()=>X,PF:()=>b,Qj:()=>p,x5:()=>Y});const c=new Float64Array(2),f=new Float64Array(2),i="0123456789bcdefghjkmnpqrstuvwxyz";function g(t){return i[t]}function A(t){return(t[0]+t[1])/2}function d(t,n,o){return t[0]=n,t[1]=o,t}function M(t,n){const o=A(t),e=n,r=!n;t[0]=r*t[0]+e*o,t[1]=r*o+e*t[1]}function w(t,n){const o=n>A(t);return M(t,o),o}function X(t,n){let o=-90,e=90,r=-180,c=180;for(let f=0;f<n;f++){const n=Math.ceil((f+1)/2),l=Math.floor((f+1)/2),u=1-f%2,h=30-(3*n+2*l),s=30-(2*n+3*l),i=3*u+2*(1-u),a=2*u+3*(1-u),g=3*u+7*(1-u)<<s,A=(7*u+3*(1-u)<<h&t.geohashX)>>h,d=(g&t.geohashY)>>s;for(let t=i-1;t>=0;t--){const n=(r+c)/2,o=A&1<<t?1:0;r=(1-o)*r+o*n,c=(1-o)*n+o*c}for(let t=a-1;t>=0;t--){const n=(o+e)/2,r=d&1<<t?1:0;o=(1-r)*o+r*n,e=(1-r)*n+r*e}}return[r,o,c,e]}function Y(t,n,o,e){e%2&&(e+=1);let r=0,c=0,f=-90,l=90,u=-180,h=180;for(let s=0;s<e/2;s++){for(let t=0;t<5;t++){const n=(u+h)/2,e=o>n?1:0;r|=e<<29-(t+5*s),u=(1-e)*u+e*n,h=(1-e)*n+e*h}for(let t=0;t<5;t++){const o=(f+l)/2,e=n>o?1:0;c|=e<<29-(t+5*s),f=(1-e)*f+e*o,l=(1-e)*o+e*l}}t.geohashX=r,t.geohashY=c}function b(t,n,o,e,r){r%2&&(r+=1);let c=0,f=0,l=-90,u=90,h=-180,s=180;for(let i=0;i<r/2;i++){for(let t=0;t<5;t++){const n=(h+s)/2,o=e>n?1:0;c|=o<<29-(t+5*i),h=(1-o)*h+o*n,s=(1-o)*n+o*s}for(let t=0;t<5;t++){const n=(l+u)/2,e=o>n?1:0;f|=e<<29-(t+5*i),l=(1-e)*l+e*n,u=(1-e)*n+e*u}}t[2*n]=c,t[2*n+1]=f}function p(t,n,o){let e="";const r=d(c,-90,90),l=d(f,-180,180);for(let c=0;c<o;c++){let o=0;c%2?(o|=w(r,t)<<4,o|=w(l,n)<<3,o|=w(r,t)<<2,o|=w(l,n)<<1,o|=w(r,t)<<0):(o|=w(l,n)<<4,o|=w(r,t)<<3,o|=w(l,n)<<2,o|=w(r,t)<<1,o|=w(l,n)<<0),e+=g(o)}return e}},"./node_modules/@arcgis/core/layers/LinkChartLayer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>LinkChartLayer_P});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Collection=(__webpack_require__("./node_modules/@arcgis/core/geometry.js"),__webpack_require__("./node_modules/@arcgis/core/core/Collection.js")),core_Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),has=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js")),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),geohashUtils=__webpack_require__("./node_modules/@arcgis/core/geohash/geohashUtils.js"),Layer=__webpack_require__("./node_modules/@arcgis/core/layers/Layer.js"),featureConversionUtils=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),OptimizedGeometry=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedGeometry.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),MapUtils=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js"),sql=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),Polygon=__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js"),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),OptimizedFeature=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedFeature.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js");class SessionMemoryStorage_o{constructor(){this._featureLookup=new Map}static getInstance(){return SessionMemoryStorage_o.instance||(SessionMemoryStorage_o.instance=new SessionMemoryStorage_o),SessionMemoryStorage_o.instance}static resetInstance(){SessionMemoryStorage_o.instance&&(SessionMemoryStorage_o.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(o,n,p){const a=[];return o.forEach((o=>{if(!o?.id)return;o.properties||(o.properties=[]);let u,c=null;if(p&&o.properties[p]&&(c=(0,featureConversionUtils.Ux)(o.properties[p])),"originId"in o&&"destinationId"in o&&(o.properties.ESRI__ORIGIN_ID=o.originId,o.properties.ESRI__DESTINATION_ID=o.destinationId),o.properties[n]=o.id,o.id&&this._featureLookup.has(o.id)&&this._featureLookup.get(o.id).attributes){const e=this._featureLookup.get(o.id),i=JSON.parse(JSON.stringify(Object.assign(e.attributes,o.properties)));p&&o.properties[p]&&(i[p]=(0,jsonUtils.rS)(o.properties[p])),u=new OptimizedFeature.Om(c?JSON.parse(JSON.stringify(c)):e?.geometry?JSON.parse(JSON.stringify(e.geometry)):null,i,null,o.properties[n])}else u=new OptimizedFeature.Om(c?JSON.parse(JSON.stringify(c)):null,o.properties,null,o.properties[n]);this._featureLookup.set(o.id,u),a.push(u)})),a}}var kernel=__webpack_require__("./node_modules/@arcgis/core/kernel.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js");let t=class extends Accessor.A{constructor(r){super(r),this.resultRows=[]}};(0,tslib_es6._)([(0,property.MZ)()],t.prototype,"resultRows",void 0),t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphQueryResult")],t);const GraphQueryResult_c=t;let GraphQueryStreamingResult_t=class extends Accessor.A{constructor(r){super(r),this.resultRowsStream=new ReadableStream}};(0,tslib_es6._)([(0,property.MZ)()],GraphQueryStreamingResult_t.prototype,"resultRowsStream",void 0),GraphQueryStreamingResult_t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphQueryResult")],GraphQueryStreamingResult_t);const c=GraphQueryStreamingResult_t;var JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),SpatialReference=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js");let FieldIndex_s=class extends JSONSupport.oY{constructor(o){super(o),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],FieldIndex_s.prototype,"name",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],FieldIndex_s.prototype,"unique",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],FieldIndex_s.prototype,"ascending",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],FieldIndex_s.prototype,"description",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[String],json:{write:!0}})],FieldIndex_s.prototype,"fieldNames",void 0),FieldIndex_s=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.FieldIndex")],FieldIndex_s);const FieldIndex_i=FieldIndex_s;let GraphProperty_i=class extends JSONSupport.oY{constructor(t){super(t),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphProperty_i.prototype,"name",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphProperty_i.prototype,"alias",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphProperty_i.prototype,"fieldType",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphProperty_i.prototype,"geometryType",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"hasM",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"hasZ",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"nullable",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"editable",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"required",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"defaultVisibility",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphProperty_i.prototype,"systemMaintained",void 0),(0,tslib_es6._)([(0,property.MZ)()],GraphProperty_i.prototype,"role",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Object,json:{type:String,write:{writer:(t,e)=>{e.defaultValue=null!=t?t.toString():null}}}})],GraphProperty_i.prototype,"defaultValue",void 0),GraphProperty_i=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphProperty")],GraphProperty_i);const GraphProperty_s=GraphProperty_i;let GraphObjectType_i=class extends JSONSupport.oY{constructor(r){super(r),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphObjectType_i.prototype,"name",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphObjectType_i.prototype,"alias",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphObjectType_i.prototype,"role",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],GraphObjectType_i.prototype,"strict",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[GraphProperty_s],json:{write:!0}})],GraphObjectType_i.prototype,"properties",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[FieldIndex_i],json:{write:!0}})],GraphObjectType_i.prototype,"fieldIndexes",void 0),GraphObjectType_i=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphObjectType")],GraphObjectType_i);const l=GraphObjectType_i;let e=class extends l{constructor(r){super(r)}};e=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.EntityType")],e);const EntityType_t=e;let RelationshipType_t=class extends l{constructor(r){super(r),this.endPoints=[]}};(0,tslib_es6._)([(0,property.MZ)()],RelationshipType_t.prototype,"endPoints",void 0),RelationshipType_t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.RelationshipType")],RelationshipType_t);const p=RelationshipType_t;let DataModel_l=class extends JSONSupport.oY{constructor(t){super(t),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,tslib_es6._)([(0,property.MZ)({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.timestamp=t?.getTime()}}}})],DataModel_l.prototype,"timestamp",void 0),(0,tslib_es6._)([(0,property.MZ)({type:SpatialReference.A,json:{write:!0}})],DataModel_l.prototype,"spatialReference",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],DataModel_l.prototype,"strict",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],DataModel_l.prototype,"objectIdField",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],DataModel_l.prototype,"globalIdField",void 0),(0,tslib_es6._)([(0,property.MZ)()],DataModel_l.prototype,"arcgisManaged",void 0),(0,tslib_es6._)([(0,property.MZ)()],DataModel_l.prototype,"identifierInfo",void 0),(0,tslib_es6._)([(0,property.MZ)()],DataModel_l.prototype,"searchIndexes",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[EntityType_t],json:{write:!0}})],DataModel_l.prototype,"entityTypes",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[p],json:{write:!0}})],DataModel_l.prototype,"relationshipTypes",void 0),DataModel_l=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.DataModel")],DataModel_l);const DataModel_n=DataModel_l;let ServiceDefinition_i=class extends JSONSupport.oY{constructor(t){super(t),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,tslib_es6._)([(0,property.MZ)({type:[String],json:{write:!0}})],ServiceDefinition_i.prototype,"capabilities",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],ServiceDefinition_i.prototype,"supportsSearch",void 0),(0,tslib_es6._)([(0,property.MZ)({type:[String],json:{write:!0}})],ServiceDefinition_i.prototype,"supportedQueryFormats",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],ServiceDefinition_i.prototype,"allowGeometryUpdates",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,json:{write:!0}})],ServiceDefinition_i.prototype,"searchMaxRecordCount",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Object,json:{write:!0}})],ServiceDefinition_i.prototype,"serviceCapabilities",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,json:{write:!0}})],ServiceDefinition_i.prototype,"maxRecordCount",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],ServiceDefinition_i.prototype,"description",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],ServiceDefinition_i.prototype,"copyrightText",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],ServiceDefinition_i.prototype,"units",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Object,json:{write:!0}})],ServiceDefinition_i.prototype,"spatialReference",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Number,json:{write:!0}})],ServiceDefinition_i.prototype,"currentVersion",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Object,json:{write:!0}})],ServiceDefinition_i.prototype,"dateFieldsTimeReference",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],ServiceDefinition_i.prototype,"serviceItemId",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],ServiceDefinition_i.prototype,"supportsDocuments",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],ServiceDefinition_i.prototype,"dataEditingNotSupported",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Boolean,json:{write:!0}})],ServiceDefinition_i.prototype,"schemaEditingNotSupported",void 0),ServiceDefinition_i=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.ServiceDefinition")],ServiceDefinition_i);const ServiceDefinition_s=ServiceDefinition_i;let KnowledgeGraph_p=class extends JSONSupport.oY{constructor(o){super(o),this.dataModel=null,this.serviceDefinition=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],KnowledgeGraph_p.prototype,"url",void 0),(0,tslib_es6._)([(0,property.MZ)({type:DataModel_n,json:{write:!0}})],KnowledgeGraph_p.prototype,"dataModel",void 0),(0,tslib_es6._)([(0,property.MZ)({type:ServiceDefinition_s,json:{write:!0}})],KnowledgeGraph_p.prototype,"serviceDefinition",void 0),KnowledgeGraph_p=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.KnowledgeGraph")],KnowledgeGraph_p);const KnowledgeGraph_c=KnowledgeGraph_p;var assets=__webpack_require__("./node_modules/@arcgis/core/assets.js");const knowledgeWasmAccess_t="esri/rest/knowledgeGraph/wasmInterface/";let knowledgeWasmAccess_s,knowledgeWasmAccess_n=null;async function knowledgeWasmAccess_r(){const e=knowledgeWasmAccess_n??knowledgeWasmAccess_s;if(e)return e;const t=(0,has.A)("wasm-simd");return knowledgeWasmAccess_s=async function o(s){if(s){const{default:s}=await __webpack_require__.e(5853).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/chunks/arcgis-knowledge-client-core-simd.js")).then((e=>e.a));return s({locateFile:s=>(0,assets.s)(knowledgeWasmAccess_t+s)})}const{default:n}=await __webpack_require__.e(24811).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/chunks/arcgis-knowledge-client-core.js")).then((e=>e.a));return n({locateFile:s=>(0,assets.s)(knowledgeWasmAccess_t+s)})}(t),knowledgeWasmAccess_s}var Multipoint=__webpack_require__("./node_modules/@arcgis/core/geometry/Multipoint.js"),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),Polyline=__webpack_require__("./node_modules/@arcgis/core/geometry/Polyline.js"),Geometry=__webpack_require__("./node_modules/@arcgis/core/geometry/Geometry.js");function queryToWasmEncodedFactories_a(e,t){const n=new t.ArrayValue;return n.deleteLater(),e.forEach((e=>{n.add_value(m(e,t))})),n}function queryToWasmEncodedFactories_l(e,t){const n=new t.ObjectValue;n.deleteLater();for(const[o,r]of Object.entries(e))n.set_key_value(o,m(r,t));return n}function queryToWasmEncodedFactories_s(i,a){if(i instanceof Multipoint.A)return function f(e,t){const n=new t.GeometryValue;n.deleteLater(),n.geometry_type=n.geometry_type=t.esriGeometryType.esriGeometryMultipoint,n.has_z=e.hasZ,n.has_m=e.hasM;const o=[],r=[];r[0]=e.points.length;let i=0;return e.points.forEach((e=>{e.forEach((e=>{o[i]=e,i++}))})),n.coords=new Float64Array(o),n.lengths=new Uint32Array(r),n}(i,a);if(i instanceof Point.A)return function g(e,t){const n=new t.GeometryValue;n.deleteLater(),n.geometry_type=t.esriGeometryType.esriGeometryPoint,n.has_z=e.hasZ,n.has_m=e.hasM;const o=[],r=[];r[0]=1,o[0]=e.x,o[1]=e.y;let i=2;return e.hasZ&&(o[i]=e.z,i++),e.hasM&&(o[i]=e.m,i++),n.coords=new Float64Array(o),n.lengths=new Uint32Array(r),n}(i,a);if(i instanceof Polyline.A||i instanceof Polygon.A)return function queryToWasmEncodedFactories_c(e,t){const n=new t.GeometryValue;n.deleteLater(),n.has_z=e.hasZ,n.has_m=e.hasM;const i=[],a=[];let l=[];e instanceof Polyline.A?(n.geometry_type=t.esriGeometryType.esriGeometryPolyline,l=e.paths):e instanceof Polygon.A&&(n.geometry_type=t.esriGeometryType.esriGeometryPolygon,l=e.rings);let s=0,u=0;return l.forEach((e=>{let t=0;e.forEach((e=>{t++,e.forEach((e=>{i[u]=e,u++}))})),a[s]=t,s++})),n.coords=new Float64Array(i),n.lengths=new Uint32Array(a),n}(i,a);throw new core_Error.A("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:i})}function m(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof Geometry.A)return queryToWasmEncodedFactories_s(e,t);if(Array.isArray(e)){const n=new t.ArrayValue;return n.deleteLater(),e.forEach((e=>{n.add_value(m(e,t))})),n}return queryToWasmEncodedFactories_l(e,t)}let GraphObject_t=class extends JSONSupport.oY{constructor(r){super(r),this.properties=null}};(0,tslib_es6._)([(0,property.MZ)({json:{write:!0}})],GraphObject_t.prototype,"properties",void 0),GraphObject_t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphObject")],GraphObject_t);const GraphObject_p=GraphObject_t;let GraphNamedObject_s=class extends GraphObject_p{constructor(r){super(r),this.typeName=null,this.id=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphNamedObject_s.prototype,"typeName",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],GraphNamedObject_s.prototype,"id",void 0),GraphNamedObject_s=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphNamedObject")],GraphNamedObject_s);const GraphNamedObject_p=GraphNamedObject_s;let Entity_p=class extends GraphNamedObject_p{constructor(r){super(r),this.layoutGeometry=null}};(0,tslib_es6._)([(0,property.MZ)({type:Point.A,json:{write:!0}})],Entity_p.prototype,"layoutGeometry",void 0),Entity_p=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.Entity")],Entity_p);const Entity_c=Entity_p;let Relationship_i=class extends GraphNamedObject_p{constructor(o){super(o),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],Relationship_i.prototype,"originId",void 0),(0,tslib_es6._)([(0,property.MZ)({type:String,json:{write:!0}})],Relationship_i.prototype,"destinationId",void 0),(0,tslib_es6._)([(0,property.MZ)({type:Polyline.A,json:{write:!0}})],Relationship_i.prototype,"layoutGeometry",void 0),Relationship_i=(0,tslib_es6._)([(0,subclass.$)("esri.rest.Relationship.Relationship")],Relationship_i);const Relationship_p=Relationship_i;function updateToWasmEncodedFactories_r(i,n){if(!i.typeName)throw new core_Error.A("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(i instanceof Entity_c){const e=new n.EntityValue;e.deleteLater(),e.type_name=i.typeName;for(const[t,o]of Object.entries(i.properties))e.set_key_value(t,updateToWasmEncodedFactories_a(o,n));return i.id&&e.set_id(i.id),e}if(i instanceof Relationship_p){const e=new n.RelationshipValue;e.deleteLater(),e.type_name=i.typeName;for(const[t,o]of Object.entries(i.properties))e.set_key_value(t,updateToWasmEncodedFactories_a(o,n));return i.id&&e.set_id(i.id),i.originId&&i.destinationId&&e.set_related_entity_ids(i.originId,i.destinationId),e}throw new core_Error.A("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function updateToWasmEncodedFactories_a(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof Geometry.A?queryToWasmEncodedFactories_s(e,t):""}let SearchIndex_t=class extends Accessor.A{constructor(r){super(r),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,tslib_es6._)([(0,property.MZ)()],SearchIndex_t.prototype,"name",void 0),(0,tslib_es6._)([(0,property.MZ)()],SearchIndex_t.prototype,"supportedCategory",void 0),(0,tslib_es6._)([(0,property.MZ)()],SearchIndex_t.prototype,"analyzers",void 0),(0,tslib_es6._)([(0,property.MZ)()],SearchIndex_t.prototype,"searchProperties",void 0),SearchIndex_t=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.SearchIndex")],SearchIndex_t);const SearchIndex_p=SearchIndex_t;var WasmDataModelWrapperInterfaces_e,WasmDataModelWrapperInterfaces_r,WasmDataModelWrapperInterfaces_i,WasmDataModelWrapperInterfaces_t,WasmDataModelWrapperInterfaces_o,WasmDataModelWrapperInterfaces_s,WasmDataModelWrapperInterfaces_y;function wasmToDataModelFactories_c(e){return e.deleteLater(),new EntityType_t(b(e))}function wasmToDataModelFactories_g(e){return e.deleteLater(),new FieldIndex_i({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:I(e.fields)})}function b(e){return{name:e.name,alias:e.alias,role:WasmDataModelWrapperInterfaces_e[e.role.value]?WasmDataModelWrapperInterfaces_e[e.role.value]:null,strict:e.strict,properties:T(e.properties),fieldIndexes:w(e.field_indexes)}}function v(e){return e.deleteLater(),new GraphProperty_s({alias:e.alias,name:e.name,fieldType:WasmDataModelWrapperInterfaces_r[e.field_type.value]?WasmDataModelWrapperInterfaces_r[e.field_type.value]:null,geometryType:WasmDataModelWrapperInterfaces_i[e.geometry_type.value]?WasmDataModelWrapperInterfaces_i[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:WasmDataModelWrapperInterfaces_s[e.role.value],defaultValue:e.default_value})}function z(e){e.deleteLater();const t=b(e),i=[];for(let n=0;n<e.end_points.size();n++){const t=e.end_points.get(n);i.push({originEntityType:t.origin_entity_type,destinationEntityType:t.dest_entity_type})}return new p(Object.assign({endPoints:i},t))}function j(e){const t=[];for(let i=0;i<e.size();i++)t.push(wasmToDataModelFactories_c(e.get(i)));return t}function I(e){const t=[];for(let i=0;i<e.size();i++)t.push(e.get(i));return t}function T(e){const t=[];for(let i=0;i<e.size();i++)t.push(v(e.get(i)));return t}function w(e){const t=[];for(let i=0;i<e.size();i++)t.push(wasmToDataModelFactories_g(e.get(i)));return t}function x(e){const t=[];for(let i=0;i<e.size();i++)t.push(z(e.get(i)));return t}function M(e){const t=[];for(let i=0;i<e.size();i++){const i=new SearchIndex_p,n=e.get(0);i.name=n.name,i.supportedCategory=WasmDataModelWrapperInterfaces_o[n.supported_category.value];const r=n.analyzers.size();for(let e=0;e<r;e++)i.analyzers.push({name:n.analyzers.get(e).name});for(let e=0;e<n.search_properties.keys().size();e++){const t=n.search_properties.keys().get(e),r=n.search_properties.get(t),a=[];for(let e=0;e<r.property_names.size();e++)a.push(r.property_names.get(e));i.searchProperties.set(t,{propertyNames:a})}t.push(i)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(WasmDataModelWrapperInterfaces_e||(WasmDataModelWrapperInterfaces_e={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(WasmDataModelWrapperInterfaces_r||(WasmDataModelWrapperInterfaces_r={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(WasmDataModelWrapperInterfaces_i||(WasmDataModelWrapperInterfaces_i={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(WasmDataModelWrapperInterfaces_t||(WasmDataModelWrapperInterfaces_t={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(WasmDataModelWrapperInterfaces_o||(WasmDataModelWrapperInterfaces_o={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(WasmDataModelWrapperInterfaces_s||(WasmDataModelWrapperInterfaces_s={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(WasmDataModelWrapperInterfaces_y||(WasmDataModelWrapperInterfaces_y={}));let ObjectValue_e=class extends GraphObject_p{constructor(r){super(r)}};ObjectValue_e=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.ObjectValue")],ObjectValue_e);const ObjectValue_t=ObjectValue_e;let Path_p=class extends JSONSupport.oY{constructor(r){super(r),this.path=null}};(0,tslib_es6._)([(0,property.MZ)({type:[GraphObject_p],json:{write:!0}})],Path_p.prototype,"path",void 0),Path_p=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.Path")],Path_p);const Path_c=Path_p;var E,WasmQueryWrapperInterfaces_T,A;function wasmToGeometryFactories_a(t){const e={},r=wasmToGeometryFactories_c(t,e),n=t.lengths,l=t.coords;let m="";if(t.geometry_type.value===E.ESRI_GEOMETRY_POLYGON)m="rings";else{if(t.geometry_type.value!==E.ESRI_GEOMETRY_POLYLINE)throw new core_Error.A("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");m="paths"}e[m]=[];let i=0;return n.forEach((o=>{const t=[];for(let e=0;e<o;e++){const o=[];for(let t=0;t<r;t++)o[t]=l[i],i++;t.push(o)}e[m].push(t)})),e}function wasmToGeometryFactories_c(o,t){let e=2;return o.has_z?(t.hasZ=o.has_z,e++):t.hasZ=!1,o.has_m?(t.hasM=o.has_m,e++):t.hasM=!1,e}!function(E){E[E.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",E[E.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",E[E.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",E[E.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",E[E.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",E[E.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",E[E.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",E[E.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(E||(E={})),function(T){T[T.OBJECT=0]="OBJECT",T[T.ENTITY=1]="ENTITY",T[T.RELATIONSHIP=2]="RELATIONSHIP",T[T.PATH=3]="PATH",T[T.ARRAY=4]="ARRAY"}(WasmQueryWrapperInterfaces_T||(WasmQueryWrapperInterfaces_T={})),function(T){T[T.view=0]="view",T[T.edit=1]="edit"}(A||(A={}));const wasmToQueryResponseObjFactories_=Logger.A.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),d={decodedWasmObjToQueryResponseObj:(e,t)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case E.ESRI_GEOMETRY_POINT:return function wasmToGeometryFactories_m(o){const t={};let r=2;wasmToGeometryFactories_c(o,t);const n=o.coords;return t.x=n[0],t.y=n[1],o.has_z&&(t.z=n[r],r++),o.has_m&&(t.m=n[r]),new Point.A(t)}(e);case E.ESRI_GEOMETRY_MULTIPOINT:return function wasmToGeometryFactories_l(o){const e={},r=wasmToGeometryFactories_c(o,e),n=o.lengths,s=o.coords,l=n[0];e.points=[];let m=0;for(let t=0;t<l;t++){const o=[];for(let t=0;t<r;t++)o[t]=s[m],m++;e.points.push(o)}return new Multipoint.A(e)}(e);case E.ESRI_GEOMETRY_POLYLINE:return function wasmToGeometryFactories_i(o){return new Polyline.A(wasmToGeometryFactories_a(o))}(e);case E.ESRI_GEOMETRY_POLYGON:return function wasmToGeometryFactories_f(o){return new Polygon.A(wasmToGeometryFactories_a(o))}(e);case E.ESRI_GEOMETRY_ENVELOPE:case E.ESRI_GEOMETRY_MULTI_PATCH:return wasmToQueryResponseObjFactories_.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case E.ESRI_GEOMETRY_NULL:case E.ESRI_GEOMETRY_ANY:default:return wasmToQueryResponseObjFactories_.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return wasmToQueryResponseObjFactories_.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case WasmQueryWrapperInterfaces_T.OBJECT:return function wasmToQueryResponseObjFactories_g(e,t){return new ObjectValue_t(O(e,t))}(e,t);case WasmQueryWrapperInterfaces_T.ENTITY:return wasmToQueryResponseObjFactories_f(e,t);case WasmQueryWrapperInterfaces_T.RELATIONSHIP:return wasmToQueryResponseObjFactories_j(e,t);case WasmQueryWrapperInterfaces_T.PATH:return function R(e,t){const n=e.entity_count(),r=e.relationship_count(),s=[];for(let o=0;o<n;o++)s.push(wasmToQueryResponseObjFactories_f(e.get_entity_at(o),t)),o<r&&s.push(wasmToQueryResponseObjFactories_j(e.get_relationship_at(o),t));return new Path_c({path:s})}(e,t);case WasmQueryWrapperInterfaces_T.ARRAY:return function wasmToQueryResponseObjFactories_m(e,t){const n=[],r=e.count();for(let o=0;o<r;o++){const r=e.get_value_at(o);n.push(wasmToQueryResponseObjFactories_E(r,t))}return n}(e,t);default:return wasmToQueryResponseObjFactories_.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function wasmToQueryResponseObjFactories_E(e,t){return d.decodedWasmObjToQueryResponseObj(e,t)}function wasmToQueryResponseObjFactories_f(e,n){const r=e.type_name,o=O(e,n),s=e.get_id();return new Entity_c(Object.assign({typeName:r,id:s},o))}function O(e,t){const n={},r=e.key_count();for(let o=0;o<r;o++)n[e.get_key_at(o)]=wasmToQueryResponseObjFactories_E(e.get_value_at(o),t);return{properties:n}}function wasmToQueryResponseObjFactories_j(e,t){const n=e.type_name,r=O(e,t);return new Relationship_p(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},r))}let GraphApplyEditsResult_e=class extends Accessor.A{constructor(r){super(r),this.hasError=null,this.error=null,this.editResults=[]}};(0,tslib_es6._)([(0,property.MZ)()],GraphApplyEditsResult_e.prototype,"hasError",void 0),(0,tslib_es6._)([(0,property.MZ)()],GraphApplyEditsResult_e.prototype,"error",void 0),(0,tslib_es6._)([(0,property.MZ)()],GraphApplyEditsResult_e.prototype,"editResults",void 0),GraphApplyEditsResult_e=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphApplyEdits")],GraphApplyEditsResult_e);const GraphApplyEditsResult_p=GraphApplyEditsResult_e;const k={fetchKnowledgeGraph:async e=>{const t=new KnowledgeGraph_c({url:e}),r=[];return r.push(S(t)),r.push(async function q(e){return k.refreshServiceDefinition(e)}(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await W(e)},refreshServiceDefinition:async e=>{const r=(await(0,request.A)(e.url,{query:{f:"json"}})).data;return r.capabilities=r?.capabilities?.split(","),r.supportedQueryFormats=r?.supportedQueryFormats?.split(","),e.serviceDefinition=new ServiceDefinition_s(r),e.serviceDefinition},executeQueryStreaming:async(e,t,a)=>{const n=`${e.url}/graph/query`;await knowledgeGraphService_A(e);const i=await knowledgeGraphService_R(n,a);i.data.body=await async function C(e,t){const a=await knowledgeWasmAccess_r(),n=new a.GraphQueryRequestEncoder;if(n.deleteLater(),n.output_spatial_reference=a.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[r,d]of Object.entries(e.bindParameters))knowledgeGraphService_j(r,d,n,a);if(e.bindGeometryQuantizationParameters)!function u(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await S(t),4326!==t.dataModel?.spatialReference?.wkid)throw new core_Error.A("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=a.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&function y(t,n,o){if(!t.extent)throw new core_Error.A("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",t.extent);if(!t.quantizeMode)throw new core_Error.A("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",t.quantizeMode);if(!t.tolerance)throw new core_Error.A("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",t.quantizeMode);n.output_quantization_parameters={extent:{xmax:t.extent.xmax,ymax:t.extent.ymax,xmin:t.extent.xmin,ymin:t.extent.ymin},quantize_mode:o.esriQuantizeMode[t.quantizeMode],tolerance:t.tolerance}}(e.outputQuantizationParameters,n,a);try{n.encode()}catch(i){throw new core_Error.A("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:i})}const o=n.get_encoding_result();if(0!==o.error.error_code)throw new core_Error.A("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return o.get_byte_buffer()}(t,e);const d=await Q(i.data.url,i.data);if(e.dataModel)return new c({resultRowsStream:await knowledgeGraphService_I(d,e.dataModel)});throw new core_Error.A("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,a)=>{if(e.serviceDefinition?.dataEditingNotSupported)throw new core_Error.A("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await knowledgeGraphService_A(e);const o=await knowledgeGraphService_R(n,a);return o.data.body=await async function D(e,t){if(t.dataModel||await S(t),!t.dataModel)throw new core_Error.A("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const a=await knowledgeWasmAccess_r(),n=!!e.options?.cascadeDelete,o=new a.GraphApplyEditsEncoder(a.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?function updateToWasmEncodedFactories_s(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.options?.inputQuantizationParameters):a.InputQuantizationUtil.WGS84_lossless());o.deleteLater(),o.cascade_delete=n;try{let t;e.entityAdds?.forEach((e=>{t=o.add_entity(updateToWasmEncodedFactories_r(e,a)),knowledgeGraphService_M(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),e.relationshipAdds?.forEach((e=>{if(!e.originId||!e.destinationId)throw new core_Error.A("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");t=o.add_relationship(updateToWasmEncodedFactories_r(e,a)),knowledgeGraphService_M(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),e.entityUpdates?.forEach((e=>{if(!e.id)throw new core_Error.A("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=o.update_entity(updateToWasmEncodedFactories_r(e,a)),knowledgeGraphService_M(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),e.relationshipUpdates?.forEach((e=>{if(!e.id)throw new core_Error.A("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=o.update_relationship(updateToWasmEncodedFactories_r(e,a)),knowledgeGraphService_M(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),e.entityDeletes?.forEach((e=>{if(!e.typeName)throw new core_Error.A("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const t=o.make_delete_helper(e.typeName,!0);t.deleteLater(),e.ids?.forEach((e=>{t.delete_by_id(e)}))})),e.relationshipDeletes?.forEach((e=>{if(!e.typeName)throw new core_Error.A("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const t=o.make_delete_helper(e.typeName,!1);e.ids?.forEach((e=>{t.delete_by_id(e)}))})),o.encode()}catch(d){throw new core_Error.A("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:d})}const i=o.get_encoding_result();return knowledgeGraphService_M(i.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),i.get_byte_buffer()}(t,e),async function P(e){const t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){const t=await e.arrayBuffer(),r=new((await knowledgeWasmAccess_r()).GraphApplyEditsDecoder);return r.deleteLater(),r.decode(new Uint8Array(t)),function wasmToUpdateResponseFactories_e(e){const o=new GraphApplyEditsResult_p;o.hasError=e.has_error(),o.hasError&&(o.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const t=e.get_edit_results_count();for(let r=0;r<t;r++){const t=e.get_edit_results_at(r),s=e.get_edit_results_type_name_at(r),_=[],d=[],a=[],u=t.get_add_results_count(),l=t.get_update_results_count(),g=t.get_delete_results_count();for(let r=0;r<u;r++){const e=t.get_add_result_at(r);_.push({id:e.id,error:{errorCode:e.error.error_code,errorMessage:e.error.error_message}})}for(let r=0;r<l;r++){const e=t.get_update_result_at(r);d.push({id:e.id,error:{errorCode:e.error.error_code,errorMessage:e.error.error_message}})}for(let r=0;r<g;r++){const e=t.get_delete_result_at(r);a.push({id:e.id,error:{errorCode:e.error.error_code,errorMessage:e.error.error_message}})}o.editResults.push({typeName:s,adds:_,updates:d,deletes:a})}return o}(r)}throw new core_Error.A("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}(await Q(o.data.url,o.data))},executeQuery:async(e,a,o)=>{const i=`${e.url}/graph/query`,d=await(0,request.A)(i,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:a.openCypherQuery,...o?.query},signal:o?.signal,timeout:o?.timeout}),p=d.getHeader?.("content-type"),c=d.data;if(p?.includes("application/x-protobuf")){const t=new((await knowledgeWasmAccess_r()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new GraphQueryResult_c({resultRows:L(t,c,e.dataModel)});throw new core_Error.A("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new core_Error.A("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:p,data:d.data})},executeSearch:async(e,a,o)=>{const i=a.typeCategoryFilter,d=`${e.url}/graph/search`,p=await(0,request.A)(d,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${a.searchQuery}"`,typeCategoryFilter:i,...o?.query},signal:o?.signal,timeout:o?.timeout}),c=p.getHeader?.("content-type"),l=p.data;if(c?.includes("application/x-protobuf")){const t=new((await knowledgeWasmAccess_r()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new GraphQueryResult_c({resultRows:L(t,l,e.dataModel)});throw new core_Error.A("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new core_Error.A("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:c,data:p.data})},executeSearchStreaming:async(e,t,a)=>{const n=`${e.url}/graph/search`;await knowledgeGraphService_A(e);const i=await knowledgeGraphService_R(n,a);i.data.body=await async function F(e){const t=await knowledgeWasmAccess_r(),a=new t.GraphSearchRequestEncoder;if(a.deleteLater(),a.search_query=e.searchQuery,a.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],!0===e.returnSearchContext&&(a.return_search_context=e.returnSearchContext),null!=e.start&&e.start>0&&(a.start_index=e.start),null!=e.num&&(a.max_num_results=e.num),null!=e.idsFilter&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{a.set_ids_filter(queryToWasmEncodedFactories_a(e.idsFilter,t))}catch(o){throw new core_Error.A("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:o})}e.namedTypesFilter?.forEach((e=>{a.add_named_type_filter(e)}));try{a.encode()}catch(o){throw new core_Error.A("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:o})}const n=a.get_encoding_result();if(0!==n.error.error_code)throw new core_Error.A("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:n.error.error_code,errorMessage:n.error.error_message});return n.get_byte_buffer()}(t);const d=await Q(i.data.url,i.data);if(e.dataModel)return new c({resultRowsStream:await knowledgeGraphService_I(d,e.dataModel)});throw new core_Error.A("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},_fetchWrapper:async(e,t)=>fetch(e,t)};async function knowledgeGraphService_x(e,t,r){return k.executeQueryStreaming(e,t,r)}async function S(e){return k.refreshDataModel(e)}async function Q(e,t){return k._fetchWrapper(e,t)}async function knowledgeGraphService_A(t){const r=kernel.id?.findCredential(t.url);r||(t.dataModel?await W(t):await S(t))}function knowledgeGraphService_M(e,t,a){if(0!==e.error_code)throw new core_Error.A(t,a,{errorCode:e.error_code,errorMessage:e.error_message})}function knowledgeGraphService_j(e,t,r,a){null==t?r.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?r.set_param_key_value(e,t):t instanceof Geometry.A?r.set_param_key_value(e,queryToWasmEncodedFactories_s(t,a)):t instanceof Array?r.set_param_key_value(e,queryToWasmEncodedFactories_a(t,a)):r.set_param_key_value(e,queryToWasmEncodedFactories_l(t,a))}async function knowledgeGraphService_R(e,r){return(0,request.A)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...r?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:r?.signal,timeout:r?.timeout})}function L(e,t,a){e.push_buffer(new Uint8Array(t));const n=[];let o=0;for(;e.next_row();){o||(o=e.get_header_keys().size());const t=new Array(o);for(let r=0;r<o;r++){const n=e.get_value(r);t[r]=wasmToQueryResponseObjFactories_E(n,a)}n.push(t)}if(e.has_error())throw new core_Error.A("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return n}async function knowledgeGraphService_I(e,t){const n=e.headers.get("content-type");if(e.headers.get("content-length")&&Logger.A.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),n?.includes("application/x-protobuf")){const a=e.body?.getReader(),n=new((await knowledgeWasmAccess_r()).GraphQueryDecoder);return n.deleteLater(),new ReadableStream({async start(e){try{return function o(){return a?.read().then((({done:i,value:d})=>{if(i){let t;if(n.has_error()&&(t=new core_Error.A("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:n.error.error_code,errorMessage:n.error.error_message})),a.releaseLock(),t)throw e.error(t),t;return void e.close()}const s=L(n,d,t);return s.length>0&&e.enqueue(s),o()}))}()}catch(i){a?.releaseLock(),e.error(new core_Error.A("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:i})),e.close()}}})}throw new core_Error.A("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:e.text()})}async function W(e){const a=`${e.url}/dataModel/queryDataModel`,n=await(0,request.A)(a,{responseType:"array-buffer",query:{f:"pbf"}}),o=n.getHeader?.("content-type"),i=n.data;if(o?.includes("application/x-protobuf")){const e=(await knowledgeWasmAccess_r()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!e)throw new core_Error.A("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function _(i){return i.deleteLater(),new DataModel_n({timestamp:i.timestamp,spatialReference:new SpatialReference.A(i.spatial_reference),strict:i.strict,objectIdField:i.objectid_property,globalIdField:i.globalid_property,arcgisManaged:i.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:WasmDataModelWrapperInterfaces_y[i.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:i.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:i.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:WasmDataModelWrapperInterfaces_t[i.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:M(i.search_indexes),entityTypes:j(i.entity_types),relationshipTypes:x(i.relationship_types)})}(e)}throw new core_Error.A("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:n.data})}let GraphQuery_p=class extends Accessor.A{constructor(r){super(r),this.openCypherQuery=""}};(0,tslib_es6._)([(0,property.MZ)()],GraphQuery_p.prototype,"openCypherQuery",void 0),GraphQuery_p=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphQuery")],GraphQuery_p);const GraphQuery_t=GraphQuery_p;let GraphQueryStreaming_s=class extends GraphQuery_t{constructor(r){super(r),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,tslib_es6._)([(0,property.MZ)()],GraphQueryStreaming_s.prototype,"bindParameters",void 0),(0,tslib_es6._)([(0,property.MZ)()],GraphQueryStreaming_s.prototype,"bindGeometryQuantizationParameters",void 0),(0,tslib_es6._)([(0,property.MZ)()],GraphQueryStreaming_s.prototype,"outputQuantizationParameters",void 0),GraphQueryStreaming_s=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],GraphQueryStreaming_s);const GraphQueryStreaming_a=GraphQueryStreaming_s;function supportUtils_e(n){if(!n.spatialReference.isWGS84)throw new core_Error.A("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let i;return i=n.xmax>180&&n.xmin<180?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[-180,n.ymin]]]:n.xmax>180&&n.xmin>180?[[[n.xmin-360,n.ymin],[n.xmin-360,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[n.xmin-360,n.ymin]]]:n.xmax>-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin+360,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[-180,n.ymin]]]:n.xmax<-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[n.xmax+360,n.ymax],[n.xmax+360,n.ymin],[n.xmin+360,n.ymin]]]:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]],i}var Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");const KnowledgeGraphLayerDataManager_k=Logger.A.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let KnowledgeGraphLayerDataManager_E=class extends Accessor.A{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return KnowledgeGraphLayerDataManager_k.warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const o=new Map;i.members?.forEach((e=>{this.memberIdTypeLookup.set(e.id,n);const t=this.getById(e.id);t&&o.set(e.id,t)})),this.sublayerCaches.set(n,o)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new core_Error.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(e);i.members||(i.members=new Map),i.members.set(t,{id:t}),this.memberIdTypeLookup.set(t,e)}}else{const i=new Map;i.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:i}),this.memberIdTypeLookup.set(t,e)}}))}getById(e){return SessionMemoryStorage_o.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new Query.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(t.objectType.name??""),o=n.outFields,s=n.geometry;let a="",r="";s&&s.extent&&(a=(0,geohashUtils.Qj)(s.extent.ymin,s.extent.xmin,12),r=(0,geohashUtils.Qj)(s.extent.ymax,s.extent.xmax,12)),o&&1===o.length&&"ESRI__ID"===o[0]&&"1=1"===n.where||await Promise.all(i??[]);const d=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],m=[];return d.forEach((i=>{if(i.geometry=e.linkChartDiagramLookup.get(i.attributes[t.objectIdField]),i.attributes.ESRI__LAYOUT_GEOMETRY=i.geometry,a&&r){const n=e.linkChartGeohashLookup.get(i.attributes[t.objectIdField]);n?n>=a&&n<=r&&m.push(i):m.push(i)}else m.push(i)})),m}return this.retrieveDataFromService(n,t,i)}async getConnectedRecordIds(e){const t=[],i=[],n=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){const t=this.memberIdTypeLookup.get(e);if(!this.entityTypeNames.has(t))return;n.has(t)?n.get(t)?.push(e):n.set(t,[e])}})),n.forEach(((e,n)=>{const o=`MATCH (n:${n})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,s=new Promise((i=>{(async()=>{const i=(await knowledgeGraphService_x(this.knowledgeGraph,new GraphQueryStreaming_a({openCypherQuery:o,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:n}=await i.read();if(e)break;for(let i=0;i<n.length;i++){const e=n[i];t.push({id:e[0],typeName:e[1]}),t.push({id:e[2],typeName:e[3]})}}}catch(n){if("AbortError"!==n.name)throw n;KnowledgeGraphLayerDataManager_k.info("Request aborted as expected")}})().then((()=>{i()}))}));i.push(s)})),await Promise.all(i),t}async refreshCacheContent(e,t,n,s=!0){const a=SessionMemoryStorage_o.getInstance(),r=[],p=new Map,d=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){const t=this.memberIdTypeLookup.get(e);p.has(t)?p.get(t)?.push(e):p.set(t,[e])}})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?p.set(t,null):e.members&&e.members.forEach((e=>{p.has(t)&&null!==p.get(t)?p.get(t)?.push(e.id):p.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&p.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&p.set(e.name,null)})));for(const[m,l]of p){const e=new Promise((e=>{(async()=>{const e=new Set,r=[];let p,h="",c=!1;if(t||d.get(m)?.properties?.forEach((t=>{t.name&&e.add(t.name)})),n&&this.geographicLookup.has(m)){const t=this.geographicLookup.get(m)?.name;t&&e.add(t)}if(this.entityTypeNames.has(m))h=`MATCH (n:${m}) ${l?"WHERE id(n) IN $ids ":""}return ID(n)`,e.forEach((e=>{h+=`, n.${e}`,r.push(e)}));else{if(!this.relationshipTypeNames.has(m))throw new core_Error.A("knowledge-graph:layer-data-manager",`The graph type of ${m} could not be determined. Was this type set in the KG data model and inclusion definition?`);c=!0,h=`MATCH ()-[n:${m}]->() ${l?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,e.forEach((e=>{h+=`, n.${e}`,r.push(e)}))}p=new GraphQueryStreaming_a(l?{openCypherQuery:h,bindParameters:{ids:l}}:{openCypherQuery:h});const y=(await knowledgeGraphService_x(this.knowledgeGraph,p)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await y.read();if(e)break;const i=[];for(let s=0;s<t.length;s++){const e=t[s];let n=0,a=0;const p={properties:{}};for(p.id=e[n],n++,a++,c&&(p.originId=e[n],n++,a++,p.destinationId=e[n],n++,a++,(0,MapUtils.tE)(this.nodeConnectionsLookup,p.originId,(()=>new Set)).add(p.id),(0,MapUtils.tE)(this.nodeConnectionsLookup,p.destinationId,(()=>new Set)).add(p.id));n<e.length;n++)p.properties[r[n-a]]=e[n];i.push(p)}const n=a.writeToStore(i,"ESRI__ID",this.geographicLookup.get(m)?.name);this.sublayerCaches.has(m)||this.sublayerCaches.set(m,new Map),s&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(m)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(m,{useAllData:!1,members:new Map}),s&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(m).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(m).members=new Map);const p=this.sublayerCaches.get(m);n.forEach((e=>{p?.set(e.attributes.ESRI__ID,e),s&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(m).members.has(e.attributes.ESRI__ID)&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(m).members.set(e.attributes.ESRI__ID,{id:e.attributes.ESRI__ID}),this.memberIdTypeLookup.set(e.attributes.ESRI__ID,m))}))}})().then((()=>{e(null)}))}));r.push(e),this._processingCacheUpdatesLookup.get(m)?.push(e)}await Promise.all(r)}removeFromLayer(e){const t=new Set,i=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),this.memberIdTypeLookup.delete(n.id),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,n)=>{i.has(n)&&this.sublayerCaches.get(e)?.delete(n)}))}))}async retrieveDataFromService(e,t,n){const o=SessionMemoryStorage_o.getInstance(),a=new Set,r=[];let p,g="",T=[];const D="relationship"===t.graphType,M=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,I=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let k=!M&&I?Array.from(I).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(k=e.objectIds);else if(null!=e.objectIds&&k&&k.length>0){const t=e.objectIds;e.objectIds=k.filter((e=>t.includes(e)))}else if(null!=e.objectIds)k=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=k}if(null!=e.outFields){const i=e.outFields;i.includes("*")?t.fields.forEach((e=>{a.add(e.name)})):i.forEach((e=>{"ESRI__ID"!==e&&e!==t.geometryFieldName&&a.add(e)}))}if(null!=e.geometry){const n=e.geometry;let o;const c=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,u=c?.spatialReference,b=c?.serviceCapabilities?.geometryCapabilities;let T=b?.geometryMaxBoundingRectangleSizeX,M=b?.geometryMaxBoundingRectangleSizeY;if(n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await(0,projection.initializeProjection)(n.extent.spatialReference,spatialReferenceUtils.w5),o=(0,projection.project)(n.extent,spatialReferenceUtils.w5)):o=n.extent,T&&M&&u){if(4326!==u.wkid){const e=new Extent.A({spatialReference:u,xmax:T,ymax:M}),t=(0,projection.project)(e,spatialReferenceUtils.w5);T=t.xmax,M=t.ymax}if(o.xmax-o.xmin>T)throw new core_Error.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${T}° latitude, limit exceeded`);if(o.ymax-o.ymin>M)throw new core_Error.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${M}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const i=await(0,sql.G)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&a.add(e.name)}))}g=D?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&a.add(t.geometryFieldName),a.forEach((e=>{g+=`, n.${e}`,r.push(e)})),p=new GraphQueryStreaming_a({openCypherQuery:g,bindParameters:{param_filter_geom:new Polygon.A({rings:supportUtils_e(o)})}})}else{let i="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,sql.G)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&a.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),r=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let p=!1;const d=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&r.has(e.operator))return`${d(e.left)} ${e.operator} ${d(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return p=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return p=!0,"";{let i=e.right.value;"%"===i.charAt(0)&&(i=i.slice(1)),"%"===i.charAt(i.length-1)&&(i=i.slice(0,-1)),t+=`'${i.toLowerCase()}')`}return t}return p=!0,""};i=d(n.parseTree),p&&(i="")}let n="";n=D?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;k&&(o=!0,n+=" WHERE ID(n) IN $ids"),i&&(n+=o?" AND":" WHERE",n+=` ${i}`),n+=" return ID(n)",D&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&a.add(t.geometryFieldName),a.forEach((e=>{n+=`, n.${e}`,r.push(e)})),p=new GraphQueryStreaming_a(k?{openCypherQuery:n,bindParameters:{ids:k}}:{openCypherQuery:n})}const E=(await knowledgeGraphService_x(t.parentCompositeLayer.dataManager.knowledgeGraph,p,n)).resultRowsStream.getReader();for(;;){const{done:e,value:i}=await E.read();if(e)break;const n=[];for(let t=0;t<i.length;t++){const e=i[t];let o=0,s=0;const a={properties:{}};for(a.id=e[o],o++,s++,D&&(a.originId=e[o],o++,s++,a.destinationId=e[o],o++,s++);o<e.length;o++)a.properties[r[o-s]]=e[o];n.push(a)}T=T.concat(o.writeToStore(n,"ESRI__ID",t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return T}};(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"knowledgeGraph",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"inclusionModeDefinition",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"entityTypeNames",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"relationshipTypeNames",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"geographicLookup",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"sublayerCaches",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"nodeConnectionsLookup",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphLayerDataManager_E.prototype,"memberIdTypeLookup",void 0),KnowledgeGraphLayerDataManager_E=(0,tslib_es6._)([(0,subclass.$)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],KnowledgeGraphLayerDataManager_E);var PopupTemplate=__webpack_require__("./node_modules/@arcgis/core/PopupTemplate.js"),support_jsonUtils=(__webpack_require__("./node_modules/@arcgis/core/renderers/ClassBreaksRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/DictionaryRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/DotDensityRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/HeatmapRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/PieChartRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/Renderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/SimpleRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/UniqueValueRenderer.js"),__webpack_require__("./node_modules/@arcgis/core/renderers/support/jsonUtils.js")),types=__webpack_require__("./node_modules/@arcgis/core/renderers/support/types.js"),FeatureStore=(__webpack_require__("./node_modules/@arcgis/core/core/workers/workers.js"),__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js")),QueryEngine=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/QueryEngine.js"),clientSideDefaults=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js");const KnowledgeGraphSublayerBase_t=(0,__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldProperties.js").p)(),KnowledgeGraphSublayerBase_p=o=>{let p=class extends o{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,tslib_es6._)([(0,property.MZ)(KnowledgeGraphSublayerBase_t.fields)],p.prototype,"fields",void 0),(0,tslib_es6._)([(0,property.MZ)(KnowledgeGraphSublayerBase_t.fieldsIndex)],p.prototype,"fieldsIndex",void 0),p=(0,tslib_es6._)([(0,subclass.$)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],p),p};var BlendLayer=__webpack_require__("./node_modules/@arcgis/core/layers/mixins/BlendLayer.js"),FeatureReductionLayer=__webpack_require__("./node_modules/@arcgis/core/layers/mixins/FeatureReductionLayer.js"),RefreshableLayer=__webpack_require__("./node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js"),ScaleRangeLayer=__webpack_require__("./node_modules/@arcgis/core/layers/mixins/ScaleRangeLayer.js"),Field=__webpack_require__("./node_modules/@arcgis/core/layers/support/Field.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),FeatureSet=__webpack_require__("./node_modules/@arcgis/core/rest/support/FeatureSet.js"),popupUtils=__webpack_require__("./node_modules/@arcgis/core/support/popupUtils.js"),RemoteClient=__webpack_require__("./node_modules/@arcgis/core/core/workers/RemoteClient.js"),typeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/typeUtils.js");let KnowledgeGraphSublayer_M=class extends((0,FeatureReductionLayer.J)(KnowledgeGraphSublayerBase_p((0,BlendLayer.d)((0,ScaleRangeLayer.j)((0,RefreshableLayer.J)(Layer.A)))))){constructor(e){if(super(e),this.capabilities=(0,clientSideDefaults.f)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField="ESRI__ID",this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new RemoteClient.A(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const r=Query.A.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName="ESRI__LAYOUT_GEOMETRY";else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&"esriGeometryNull"!==e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType){const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?typeUtils.g.fromJSON(t.geometryType):null;const r=t?.name,o=r?e.objectType.properties?.[r]:null;o?(this.hasM=o.hasM??!1,this.hasZ=o.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach((e=>{let r=e.fieldType;"esriFieldTypeOID"===r&&(r="esriFieldTypeInteger"),this.fields.push(Field.A.fromJSON({name:e.name,type:r,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),this.fields.push(Field.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?this.renderer=(0,support_jsonUtils.r)((0,clientSideDefaults.F0)(typeUtils.g.toJSON("polyline")).renderer):this.renderer=(0,support_jsonUtils.r)((0,clientSideDefaults.F0)(typeUtils.g.toJSON("point")).renderer):this.renderer=(0,support_jsonUtils.r)((0,clientSideDefaults.F0)(typeUtils.g.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,fieldUtils.yp)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,popupUtils.tn)(this,e)}createQuery(){return new Query.A({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:r,queryEngine:o}=await this._setupQueryObjects(e),s=FeatureSet.A.fromJSON(await o.executeQuery(r.toJSON(),t?.signal));return s.features.forEach((e=>{e.sourceLayer=this})),s}async queryFeaturesJSON(e,t){const{resolvedQuery:r,queryEngine:o}=await this._setupQueryObjects(e);return await o.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){const{resolvedQuery:r,queryEngine:o}=await this._setupQueryObjects(e);return o.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){const r={...e,returnGeometry:!0},{resolvedQuery:o,queryEngine:s}=await this._setupQueryObjects(r),i=await s.executeQueryForExtent(o.toJSON(),t?.signal);let a;return a=null!=i.extent?.xmin&&null!=i.extent?.xmax&&null!=i.extent?.ymin&&null!=i.extent?.ymax?new Extent.A(i.extent):new Extent.A,{count:i.count,extent:a}}async queryObjectIds(e,t){const r=Query.A.from(e);let o;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)o=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);o=this.loadQueryEngine(e)}return o.executeQueryForIds(r.toJSON(),t?.signal)}loadQueryEngine(e){const t=new FeatureStore.A({geometryType:typeUtils.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new QueryEngine.d({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:typeUtils.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new Query.A({where:"1=1",outFields:["ESRI__ID"]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){const r=Query.A.from(e),o=r.geometry;let s;if(o&&!o.spatialReference?.isWGS84&&(await(0,projection.initializeProjection)(o.spatialReference,spatialReferenceUtils.w5),r.geometry=(0,projection.project)(o instanceof Polygon.A||o instanceof Polyline.A?o:o.extent,spatialReferenceUtils.w5)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)s=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);s=this.loadQueryEngine(e)}return{resolvedQuery:r,queryEngine:s}}};(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"capabilities",void 0),(0,tslib_es6._)([(0,property.MZ)({readOnly:!0})],KnowledgeGraphSublayer_M.prototype,"defaultPopupTemplate",null),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"definitionExpression",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"displayField",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"elevationInfo",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"geometryType",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"geometryFieldName",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"graphType",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"hasM",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"hasZ",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"labelsVisible",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"labelingInfo",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"objectIdField",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"objectType",void 0),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"parentCompositeLayer",void 0),(0,tslib_es6._)([(0,property.MZ)({type:PopupTemplate.A,json:{name:"popupInfo",write:!0}})],KnowledgeGraphSublayer_M.prototype,"popupTemplate",void 0),(0,tslib_es6._)([(0,property.MZ)({types:types.H,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],KnowledgeGraphSublayer_M.prototype,"renderer",null),(0,tslib_es6._)([(0,property.MZ)()],KnowledgeGraphSublayer_M.prototype,"source",void 0),(0,tslib_es6._)([(0,property.MZ)({json:{read:!1}})],KnowledgeGraphSublayer_M.prototype,"type",void 0),KnowledgeGraphSublayer_M=(0,tslib_es6._)([(0,subclass.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],KnowledgeGraphSublayer_M);const KnowledgeGraphSublayer_C=KnowledgeGraphSublayer_M;let LinkChartLayout_e,LinkChartLayout_r=null;function LinkChartLayout_n(){return LinkChartLayout_e||(LinkChartLayout_e=__webpack_require__.e(19272).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/chunks/lclayout.js")).then((t=>t.l)).then((({default:e})=>e({locateFile:e=>(0,assets.s)(`esri/libs/linkchartlayout/${e}`)}))).then((t=>{!function LinkChartLayout_s(t){LinkChartLayout_r=t}(t)})),LinkChartLayout_e)}var LinkChartLayout_o;function LinkChartLayout_u(t,e,a,n,s,o){const u=a.length,y=s.length,l=Float64Array.BYTES_PER_ELEMENT,i=Uint32Array.BYTES_PER_ELEMENT,c=Uint8Array.BYTES_PER_ELEMENT,p=15+u*(c+2*l)+y*(2*i),f=LinkChartLayout_r._malloc(p);try{const c=f+16-f%16,p=c+u*l,b=p+u*l,A=b+y*i,P=A+y*i,_=()=>[LinkChartLayout_r.HEAPF64.subarray(c>>3,(c>>3)+u),LinkChartLayout_r.HEAPF64.subarray(p>>3,(p>>3)+u),LinkChartLayout_r.HEAPU32.subarray(b>>2,(b>>2)+y),LinkChartLayout_r.HEAPU32.subarray(A>>2,(A>>2)+y),LinkChartLayout_r.HEAPU8.subarray(P,P+u)],[C,H,d,m,F]=_();C.set(a),H.set(n),d.set(s),m.set(o),F.set(e);const h=t(u,P,c,p,y,b,A),[B,L,R,T,g]=_();return a.set(B),n.set(L),s.set(R),o.set(T),e.set(g),h}finally{LinkChartLayout_r._free(f)}}!function(t){t[t.None=0]="None",t[t.IsMovable=1]="IsMovable",t[t.IsGeographic=2]="IsGeographic",t[t.IsRoot=4]="IsRoot"}(LinkChartLayout_o||(LinkChartLayout_o={}));var LinkChartLayout_c,LinkChartLayout_E,LinkChartLayout_p,LinkChartLayout_f,LinkChartLayout_b,LinkChartLayout_A,LinkChartLayout_P,LinkChartLayout_;!function(t){t.getMinIdealEdgeLength=function e(){return LinkChartLayout_r.getMinIdealEdgeLength()},t.apply=function a(t,e,a,n,s,o=2,c=1,E=-1){return LinkChartLayout_u(((t,e,a,n,s,u,y)=>LinkChartLayout_r.applyForceDirectedLayout(t,e,a,n,s,u,y,o,c,E)),t,e,a,n,s)}}(LinkChartLayout_c||(LinkChartLayout_c={})),function(t){t.apply=function e(t,e,a,n,s,o=2,c=1,E=-1){return LinkChartLayout_u(((t,e,a,n,s,u,y)=>LinkChartLayout_r.applyCommunityLayout(t,e,a,n,s,u,y,o,c,E)),t,e,a,n,s)}}(LinkChartLayout_E||(LinkChartLayout_E={})),function(t){t.apply=function e(t,e,a,n,s){return LinkChartLayout_u(LinkChartLayout_r.applySimpleLayout,t,e,a,n,s)}}(LinkChartLayout_p||(LinkChartLayout_p={})),function(t){t.apply=function e(t,e,a,n,s){return LinkChartLayout_u(LinkChartLayout_r.applyHierarchicalLayout,t,e,a,n,s)}}(LinkChartLayout_f||(LinkChartLayout_f={})),function(t){t.apply=function e(t,e,a,n,s){return LinkChartLayout_u(LinkChartLayout_r.applyRadialTreeLayout,t,e,a,n,s)}}(LinkChartLayout_b||(LinkChartLayout_b={})),function(t){t.apply=function e(t,e,a,n,s){return LinkChartLayout_u(LinkChartLayout_r.applySmartTreeLayout,t,e,a,n,s)}}(LinkChartLayout_A||(LinkChartLayout_A={})),function(t){t[t.Undirected=0]="Undirected",t[t.Directed=1]="Directed",t[t.Reversed=2]="Reversed"}(LinkChartLayout_P||(LinkChartLayout_P={})),function(t){t[t.ByCC_Raw=0]="ByCC_Raw",t[t.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",t[t.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(LinkChartLayout_||(LinkChartLayout_={}));let LinkChartLayer_j=class extends((0,BlendLayer.d)((0,ScaleRangeLayer.j)(Layer.A))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new Collection.A,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new Extent.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new Collection.A,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new core_Error.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const t=new Set;let o=[],n=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new core_Error.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(o=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((a,s)=>{if(!this._graphTypeLookup.get(s))return Logger.A.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(s);this._graphTypeLookup.get(s)instanceof p||"strictOrigin"in this._graphTypeLookup.get(s)?t.has(s)||(t.add(s),n.push(this._graphTypeLookup.get(s))):this._graphTypeLookup.get(s)instanceof EntityType_t||"properties"in this._graphTypeLookup.get(s)?t.has(s)||(t.add(s),o.push(this._graphTypeLookup.get(s))):(Logger.A.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(s))})):(o=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]);const s=new KnowledgeGraphLayerDataManager_E({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=o,this.memberRelationshipTypes=n,this.dataManager=s}load(e){return this.addResolvingPromise(new Promise((t=>{(async function knowledgeGraphService_T(e){return k.fetchKnowledgeGraph(e)})(this.url).then((a=>{if(this._initializeLayerProperties({knowledgeGraph:a,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})})),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.useAllData=!1,e.members?.forEach((e=>{let t;t=e.linkChartLocation instanceof OptimizedGeometry.A?e.linkChartLocation:e.linkChartLocation?(0,featureConversionUtils.Ux)(e.linkChartLocation):null,this.linkChartDiagramLookup.set(e.id,t),t&&2===t.coords.length&&0===t.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,geohashUtils.Qj)(t.coords[1],t.coords[0],12)):this.linkChartGeohashLookup.set(e.id,"")})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{const t="GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode;this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,promiseUtils.Te)(e);const t=[],a=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let a=[];t?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(a=await async function supportUtils_a(m,e){const a=[],x=new Map,r=[];if(e.dataModel?.relationshipTypes)for(const n of e.dataModel.relationshipTypes)n.name&&x.set(n.name,[]);for(const n of m)x.has(n.typeName)&&x.get(n.typeName)?.push(n.id);for(const[t,y]of x){if(y.length<1)continue;const m=new GraphQueryStreaming_a({openCypherQuery:`MATCH (n)-[r:${t}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:y}});r.push(knowledgeGraphService_x(e,m).then((async m=>{const n=m.resultRowsStream.getReader();for(;;){const{done:m,value:i}=await n.read();if(m)break;for(const n of i)a.push({id:n[0],typeName:n[1]}),a.push({id:n[2],typeName:n[3]})}})))}return await Promise.all(r),a}(e,this.dataManager.knowledgeGraph));const i=e.concat(a).filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));await this._handleNewRecords(i)}async removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:a=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){let i=[];for(const n of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(n.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(n.typeName)?.members?.has(n.id)&&i.push(n);if(t){const e=new Set,t=[];for(const a of i)if(this.dataManager.nodeConnectionsLookup.has(a.id))for(const t of this.dataManager.nodeConnectionsLookup.get(a.id))e.add(t);for(const a of e)this.dataManager.memberIdTypeLookup.has(a)&&t.push({id:a,typeName:this.dataManager.memberIdTypeLookup.get(a)});i=i.concat(t)}this.dataManager.removeFromLayer(i);for(const n of i)this.sublayerIdsCache.get(n.typeName)?.delete(n.id),this.linkChartDiagramLookup.delete(n.id);a&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});const o=[];return this.layers.forEach((e=>{o.push(e.refreshCachedQueryEngine())})),await Promise.all(o),this._refreshNamedTypes(),i}async expand(e){const t=await this.dataManager.getConnectedRecordIds(e),a=t.filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));return await this._handleNewRecords(t),{records:a}}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach((e=>{const t=new KnowledgeGraphSublayer_C({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new KnowledgeGraphSublayer_C({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const a=((e,t,a)=>(e.has(t)||e.set(t,a()),e.get(t)))(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof OptimizedGeometry.A)this.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,geohashUtils.Qj)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],12)):this.linkChartGeohashLookup.set(e.id,"");else{const t=(0,featureConversionUtils.Ux)(e.linkChartLocation);this.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?this.linkChartGeohashLookup.set(e.id,(0,geohashUtils.Qj)(e.linkChartLocation.x,e.linkChartLocation.y,12)):this.linkChartGeohashLookup.set(e.id,"")}}))}))}async calculateLinkChartLayout(e="RADIAL_TREE",t){const o=[],n=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{o.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{n.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map;const s=new Map,h=new Map,c=new Map,d=new Map,g=new Uint8Array(o.length),k=new Float64Array(o.length),C=new Float64Array(o.length),L=new Uint32Array(n.length),N=new Uint32Array(n.length),I=[],S=t?.xScaleFactor??1,j=t?.yScaleFactor??1,P=new Extent.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let F,z="FORCE_DIRECTED",O=0,U=0;switch(z="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,z){case"FORCE_DIRECTED":F=LinkChartLayout_c.apply;break;case"COMMUNITY":F=LinkChartLayout_E.apply;break;case"HIERARCHICAL":F=LinkChartLayout_f.apply;break;case"RADIAL_TREE":F=LinkChartLayout_b.apply;break;case"SMART_TREE":F=LinkChartLayout_A.apply;break;default:F=LinkChartLayout_p.apply}o.forEach((({typeName:a,feature:i})=>{if(t?.lockedNodeLocations?.has(i.attributes.ESRI__ID)){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)?g[O]=LinkChartLayout_o.IsGeographic:g[O]=LinkChartLayout_o.None;const o=t.lockedNodeLocations.get(i.attributes.ESRI__ID);k[O]=o.x,C[O]=o.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)){g[O]=LinkChartLayout_o.IsGeographic;let e=null;const t=i.attributes[this.dataManager.geographicLookup.get(a).name],o=this.dataManager.geographicLookup.get(a)?.geometryType;switch(o){case"esriGeometryPoint":k[O]=t?.x,C[O]=t?.y;break;case"esriGeometryPolygon":e=t?.centroid,null!=e?.x&&null!=e?.y?(k[O]=e.x,C[O]=e.y):g[O]=LinkChartLayout_o.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=t?.extent?.center,null!=e?.x&&null!=e?.y?(k[O]=e.x,C[O]=e.y):g[O]=LinkChartLayout_o.IsMovable;break;default:g[O]=LinkChartLayout_o.IsMovable}(null==k[O]||null==C[O]||Number.isNaN(k[O])||Number.isNaN(C[O]))&&(g[O]=LinkChartLayout_o.IsMovable,k[O]=0,C[O]=0)}else g[O]=LinkChartLayout_o.IsMovable,k[O]=0,C[O]=0;d.set(i.attributes.ESRI__ID,O),I[O]={feature:i,typeName:a},O++}));let Q=!1;if(n.forEach((e=>{const t=d.get(e.feature.attributes.ESRI__ORIGIN_ID),a=d.get(e.feature.attributes.ESRI__DESTINATION_ID);void 0!==t&&void 0!==a?(L[U]=t,N[U]=a,U++):(Q=!0,this.linkChartDiagramLookup.set(e.feature.attributes.ESRI__ORIGIN_ID,null),this.linkChartGeohashLookup.set(e.feature.attributes.ESRI__ORIGIN_ID,null))})),Q&&Logger.A.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await LinkChartLayout_n(),!F(g,k,C,L,N))throw new core_Error.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let a=0;a<I.length;a++){if(g[a]===LinkChartLayout_o.IsMovable&&(k[a]=k[a]*S,C[a]=C[a]*j),C[a]>84.9999&&(C[a]=84.9999),C[a]<-84.9999&&(C[a]=-84.9999),k[a]>179.9999&&(k[a]=179.9999),k[a]<-179.9999&&(k[a]=-179.9999),I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY=new Point.A(k[a],C[a]),s.has(I[a].typeName)){const e=s.get(I[a].typeName);e?.set(I[a].feature.attributes.ESRI__ID,I[a].feature)}else{const e=new Map;e.set(I[a].feature.attributes.ESRI__ID,I[a].feature),s.set(I[a].typeName,e)}c.set(I[a].feature.attributes.ESRI__ID,I[a].feature);const e=(0,featureConversionUtils.Ux)(I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY);this.linkChartDiagramLookup.set(I[a].feature.attributes.ESRI__ID,I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY?e:null),this.linkChartGeohashLookup.set(I[a].feature.attributes.ESRI__ID,(0,geohashUtils.Qj)(I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.y,I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.x,12)),I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.x<P.xmin&&(P.xmin=I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.x),I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.x>P.xmax&&(P.xmax=I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.x),I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.y<P.ymin&&(P.ymin=I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.y),I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.y>P.ymax&&(P.ymax=I[a].feature.attributes.ESRI__LAYOUT_GEOMETRY.y)}return this.linkChartExtent.xmin=P.xmin,this.linkChartExtent.xmax=P.xmax,this.linkChartExtent.ymin=P.ymin,this.linkChartExtent.ymax=P.ymax,n.forEach((e=>{const t=I[d.get(e.feature.attributes.ESRI__ORIGIN_ID)]?.feature.attributes.ESRI__LAYOUT_GEOMETRY,a=I[d.get(e.feature.attributes.ESRI__DESTINATION_ID)]?.feature.attributes.ESRI__LAYOUT_GEOMETRY;if(!t||!a)return;const i=new Polyline.A({paths:[[t.x,t.y],[a.x,a.y]]});if(e.feature.attributes.ESRI__LAYOUT_GEOMETRY=i,h.has(e.typeName)){const t=h.get(e.typeName);t?.set(e.feature.attributes.ESRI__ID,e.feature)}else{const t=new Map;t.set(e.feature.attributes.ESRI__ID,e.feature),h.set(e.typeName,t)}c.set(e.feature.attributes.ESRI__ID,e.feature);const o=(0,featureConversionUtils.Ux)(e.feature.attributes.ESRI__LAYOUT_GEOMETRY);this.linkChartDiagramLookup.set(e.feature.attributes.ESRI__ID,e.feature.attributes.ESRI__LAYOUT_GEOMETRY?o:null),this.linkChartGeohashLookup.set(e.feature.attributes.ESRI__ID,"")})),this._currentLinkChartConfig={layoutMode:e,xScaleFactor:S,yScaleFactor:j},{nodes:s,links:h,idMap:c}}async applyNewLinkChartLayout(e="RADIAL_TREE",t){const a=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a),this._refreshNamedTypes()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t=>{t?.members?.forEach((t=>{const a=t.linkChartLocation;let i;const o=t.id;a&&(i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]},e.set(o,new Point.A({x:i.x,y:i.y})))}))})),e}async synchronizeInclusionListWithCache(){return new Promise((e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const a=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!a.has(e))).forEach((t=>{e.members?.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const a of e)this.sublayerIdsCache.has(a.typeName)||(this.sublayerIdsCache.set(a.typeName,new Set),t.push(a.typeName)),this.sublayerIdsCache.get(a.typeName).add(a.id);for(const a of t)if(this._graphTypeLookup.has(a)){const e=this._graphTypeLookup.get(a),t="endPoints"in e?"relationship":"entity",i=new KnowledgeGraphSublayer_C({objectType:e,parentCompositeLayer:this,graphType:t,title:a});"entity"===t?this.dataManager.entityTypeNames.add(a):this.dataManager.relationshipTypeNames.add(a),i.geometryType?this.layers.push(i):this.tables.push(i),this.dataManager.sublayerCaches.set(a,new Map)}await this.dataManager.refreshCacheContent(e.map((e=>e.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})}async _initializeDiagram(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e=>{e?.members?.forEach((e=>{const t=e.linkChartLocation;let a;const i=e.id;if(!t)return;a="x"in t?{x:t.x,y:t.y}:{x:t.coords[0],y:t.coords[1]};const o=(0,featureConversionUtils.Ux)(a);this.linkChartDiagramLookup.set(i,o),this.linkChartGeohashLookup.set(i,(0,geohashUtils.Qj)(a.x,a.y,12)),this.linkChartExtent.xmin>a.x&&(this.linkChartExtent.xmin=a.x),this.linkChartExtent.xmax<a.x&&(this.linkChartExtent.xmax=a.x),this.linkChartExtent.ymin>a.y&&(this.linkChartExtent.ymin=a.y),this.linkChartExtent.ymax<a.y&&(this.linkChartExtent.ymax=a.y)}))})),this.memberRelationshipTypes.forEach((e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach((e=>{const t=this.linkChartDiagramLookup.get(e.attributes.ESRI__ORIGIN_ID),a=this.linkChartDiagramLookup.get(e.attributes.ESRI__DESTINATION_ID);if(t&&a){const i=(0,featureConversionUtils.Ux)(new Polyline.A({paths:[[t.coords[0],t.coords[1]],[a.coords[0],a.coords[1]]]}));this.linkChartDiagramLookup.set(e.attributes.ESRI__ID,i)}else this.linkChartDiagramLookup.set(e.attributes.ESRI__ID,null);this.linkChartGeohashLookup.set(e.attributes.ESRI__ID,"")}))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"dataPreloadedInLocalCache",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"defaultLinkChartConfig",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"dataManager",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"knowledgeGraph",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"layers",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"linkChartDiagramLookup",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"linkChartExtent",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"linkChartGeohashLookup",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"memberEntityTypes",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"memberRelationshipTypes",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"sublayerIdsCache",void 0),(0,tslib_es6._)([(0,property.MZ)()],LinkChartLayer_j.prototype,"tables",void 0),(0,tslib_es6._)([(0,property.MZ)({json:{read:!1}})],LinkChartLayer_j.prototype,"type",void 0),LinkChartLayer_j=(0,tslib_es6._)([(0,subclass.$)("esri.layers.LinkChartLayer")],LinkChartLayer_j);const LinkChartLayer_P=LinkChartLayer_j},"./node_modules/@arcgis/core/layers/graphics/data/BoundsStore.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>o});var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_libs_rbush_PooledRBush_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/libs/rbush/PooledRBush.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js");const n={minX:0,minY:0,maxX:0,maxY:0};function e(i,s,d){(function t(i){n.minX=i[0],n.minY=i[1],n.maxX=i[2],n.maxY=i[3]})(s),i.search(n,d)}class o{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new _core_libs_rbush_PooledRBush_js__WEBPACK_IMPORTED_MODULE_1__.w(9,(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.A)("esri-csp-restrictions")?i=>({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const i=new Array(this._idByBounds.size);let s=0;this._idByBounds.forEach(((d,n)=>{i[s++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(i)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((i=>this._idByBounds.has(i)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const i=(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_2__.Ie)();for(const s of this._boundsById.values())s&&(i[0]=Math.min(s[0],i[0]),i[1]=Math.min(s[1],i[1]),i[2]=Math.max(s[2],i[2]),i[3]=Math.max(s[3],i[3]));return i}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(i){const s=this._boundsById.get(i);this._boundsById.delete(i),s&&(this._idByBounds.delete(s),this._indexInvalid||this._index.remove(s))}forEachInBounds(i,s){this._loadIndex(),e(this._index,i,(i=>s(this._idByBounds.get(i))))}get(i){return this._boundsById.get(i)}has(i){return this._boundsById.has(i)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(i,s){if(!this._indexInvalid){const s=this._boundsById.get(i);s&&(this._index.remove(s),this._idByBounds.delete(s))}this._boundsById.set(i,s),s&&(this._idByBounds.set(s,i),this._indexInvalid||(this._boundsToLoad.push(s),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},"./node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>m});var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_Evented_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),_BoundsStore_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/BoundsStore.js"),_geometryUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/geometryUtils.js"),_optimizedFeatureQueryEngineAdapter_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/optimizedFeatureQueryEngineAdapter.js");const f=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.vt)();class m{constructor(e){this.geometryInfo=e,this._boundsStore=new _BoundsStore_js__WEBPACK_IMPORTED_MODULE_7__.F,this._featuresById=new Map,this._markedIds=new Set,this.events=new _core_Evented_js__WEBPACK_IMPORTED_MODULE_2__.A,this.featureAdapter=_optimizedFeatureQueryEngineAdapter_js__WEBPACK_IMPORTED_MODULE_9__.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,s,o]=this.fullBounds;return{xmin:t,ymin:r,xmax:s,ymax:o,spatialReference:(0,_geometryUtils_js__WEBPACK_IMPORTED_MODULE_8__.ag)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(t){const r=t.map((e=>this._upsert(e)));return this._emitChanged(),r.filter(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t((0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.Jt)(f,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const r=e.objectId;if(null==r)return void _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.A("featurestore:invalid-feature","feature id is missing",{feature:e}));const o=this._featuresById.get(r);let i;if(this._markedIds.add(r),o?(e.displayId=o.displayId,i=this._boundsStore.get(r),this._boundsStore.delete(r)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(r,null),void this._featuresById.set(r,e);i=(0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_6__.jQ)(null!=i?i:(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_5__.vt)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=i&&this._boundsStore.set(r,i),this._featuresById.set(r,e)}_upsert(e){const r=e?.objectId;if(null==r)return _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const o=this._featuresById.get(r);if(!o)return this._add(e),e;this._markedIds.add(r);const{geometry:i,attributes:d}=e;for(const t in d)o.attributes[t]=d[t];return i&&(o.geometry=i,this._boundsStore.set(r,(0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_6__.jQ)((0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_5__.vt)(),i,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),o}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}}}]);