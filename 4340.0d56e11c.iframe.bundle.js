"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[4340,7710,2084],{"./node_modules/@arcgis/core/core/devEnvironmentUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function c(c){return c=c||globalThis.location.hostname,m.some((a=>null!=c?.match(a)))}function a(c,a){return c&&(a=a||globalThis.location.hostname)?null!=a.match(t)||null!=a.match(l)?c.replace("static.arcgis.com","staticdev.arcgis.com"):null!=a.match(s)||null!=a.match(i)?c.replace("static.arcgis.com","staticqa.arcgis.com"):c:c}__webpack_require__.d(__webpack_exports__,{XO:()=>c,pJ:()=>a});const t=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,l=/^[\w-]*\.mapsdevext.arcgis.com$/,i=/^[\w-]*\.mapsqa.arcgis.com$/,m=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,t,s,/^jsapps.esri.com$/,l,i]},"./node_modules/@arcgis/core/layers/effects/EffectView.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AM:()=>a});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_lang_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_parser_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/parser.js"),_utils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/utils.js");const l=-1;let a=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__.Z{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,_core_has_js__WEBPACK_IMPORTED_MODULE_1__.Z)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(h(t))}catch(e){this._transitionTo([]),_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&u(this._current,h(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&u(this._current,t,this.scale)?(this._final=t,this._to=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_2__.d9)(t),function _(t,e,s){const r=t.length>e.length?t:e,i=t.length>e.length?e:t,n=i[i.length-1],c=n?.scale??s,o=n?.effects??[];for(let f=i.length;f<r.length;f++)i.push({scale:c,effects:[...o]});for(let a=0;a<r.length;a++)i[a].scale=i[a].scale===l?s:i[a].scale,r[a].scale=r[a].scale===l?s:r[a].scale,(0,_utils_js__WEBPACK_IMPORTED_MODULE_8__.uF)(i[a].effects,r[a].effects)}(this._current,this._to,this.scale),this._from=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_2__.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_2__.d9)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],r=this._from[s],i=this._to[s];t.scale=p(r.scale,i.scale,e);for(let s=0;s<t.effects.length;s++){const n=t.effects[s],c=r.effects[s],o=i.effects[s];n.interpolate(c,o,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_2__.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let r,i,n=1;if(1===e.length||t>=e[0].scale)i=r=e[0].effects;else if(t<=e[s].scale)i=r=e[s].effects;else for(let c=0;c<s;c++){const s=e[c],o=e[c+1];if(s.scale>=t&&o.scale<=t){n=(t-s.scale)/(o.scale-s.scale),r=s.effects,i=o.effects;break}}for(let c=0;c<this.effects.length;c++)this.effects[c].interpolate(r[c],i[c],n)}};function h(t){const e=(0,_parser_js__WEBPACK_IMPORTED_MODULE_7__.Q)(t)||[];return function m(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:l,effects:e}]:e}function u(t,e,s){return!t[0]?.effects||!e[0]?.effects||!((t[0]?.scale===l||e[0]?.scale===l)&&(t.length>1||e.length>1)&&s<=0)&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_8__.AS)(t[0].effects,e[0].effects)}function p(t,e,s){return t+(e-t)*s}(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)()],a.prototype,"_to",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)()],a.prototype,"duration",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({value:""})],a.prototype,"effect",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({readOnly:!0})],a.prototype,"effects",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({readOnly:!0})],a.prototype,"hasEffects",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({value:0})],a.prototype,"scale",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({readOnly:!0})],a.prototype,"transitioning",null),a=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.j)("esri.layers.effects.EffectView")],a)},"./node_modules/@arcgis/core/layers/support/ExportImageParameters.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>c});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_sql_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_commonProperties_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");const m={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let c=class extends((0,_core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_1__.p)(_core_Accessor_js__WEBPACK_IMPORTED_MODULE_0__.Z)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__.f)(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,_sublayerUtils_js__WEBPACK_IMPORTED_MODULE_7__.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(m[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const s=(0,_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_8__.f)(this.floors,r),o=(0,_core_sql_js__WEBPACK_IMPORTED_MODULE_9__._)(s,r.definitionExpression);return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(o)&&(e[r.id]=o),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get("visibleSublayers");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"dynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)()],c.prototype,"floors",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"hasDynamicLayers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)()],c.prototype,"layer",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"layers",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"layerDefs",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({type:Number})],c.prototype,"scale",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)(_commonProperties_js__WEBPACK_IMPORTED_MODULE_6__.qG)],c.prototype,"timeExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"version",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.Cb)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.layers.mixins.ExportImageParameters")],c)},"./node_modules/@arcgis/core/layers/support/floorFilterUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function o(o){const n=o.layer;return"floorInfo"in n&&n.floorInfo?.floorField&&"floors"in o.view?l(o.view.floors,n.floorInfo.floorField):null}function n(o,n){return"floorInfo"in n&&n.floorInfo?.floorField?l(o,n.floorInfo.floorField):null}function l(o,n){if(!o?.length)return null;const l=o.filter((o=>""!==o)).map((o=>`'${o}'`));return l.push("''"),`${n} IN (${l.join(",")}) OR ${n} IS NULL`}__webpack_require__.d(__webpack_exports__,{c:()=>o,f:()=>n})},"./node_modules/@arcgis/core/layers/support/sublayerUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{FN:()=>i,QV:()=>n,ac:()=>t});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js");function n(r,e,n){const i=e.flatten((({sublayers:r})=>r)).length;return i!==r.length||(!!r.some((r=>r.originIdOf("minScale")>n||r.originIdOf("maxScale")>n||r.originIdOf("renderer")>n||r.originIdOf("labelingInfo")>n||r.originIdOf("opacity")>n||r.originIdOf("labelsVisible")>n||r.originIdOf("source")>n))||!o(r,e))}function i(n,i,t){return!!n.some((n=>{const i=n.source;return!(!i||"map-layer"===i.type&&i.mapLayerId===n.id&&((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.Wi)(i.gdbVersion)||i.gdbVersion===t))||n.originIdOf("renderer")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("labelingInfo")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("opacity")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE||n.originIdOf("labelsVisible")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.s3.SERVICE}))||!o(n,i)}function o(e,n){if(!e||!e.length||(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.Wi)(n))return!0;const i=n.slice().reverse().flatten((({sublayers:r})=>r&&r.toArray().reverse())).map((r=>r.id)).toArray();if(e.length>i.length)return!1;let o=0;const t=i.length;for(const{id:r}of e){for(;o<t&&i[o]!==r;)o++;if(o>=t)return!1}return!0}function t(r){return!!r&&r.some((r=>null!=r.minScale||r.layerDefinition&&null!=r.layerDefinition.minScale))}},"./node_modules/@arcgis/core/symbols/support/previewSymbol3D.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getPatternDescriptor:()=>W,getSizeFromOptions:()=>Q,getSymbolLayerFill:()=>T,previewSymbol3D:()=>ee});var _assets_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/assets.js"),_core_colorUtils_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/core/colorUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js")),_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),_gfxUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/gfxUtils.js"),_IconSymbol3DLayerResource_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/IconSymbol3DLayerResource.js"),_ObjectSymbol3DLayerResource_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/ObjectSymbol3DLayerResource.js"),_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/previewUtils.js"),_renderUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/renderUtils.js"),_utils_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/utils.js"),_webStyleSymbolUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/webStyleSymbolUtils.js");const C=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.b_.size,I=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.b_.maxSize,R=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.b_.maxOutlineSize,E=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.b_.lineWidth,Z=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.b_.tallSymbolWidth;function q(e){const t=e.outline,s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(e.material)?e.material.color:null,r=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(s)?s.toHex():null;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(t)||"pattern"in t&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(t.pattern)&&"style"===t.pattern.type&&"none"===t.pattern.style)return"fill"===e.type&&"#ffffff"===r?{color:"#bdc3c7",width:.75}:null;const a=(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(t.size)||0;return{color:"rgba("+((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(a,R),style:"pattern"in t&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(t.pattern)&&"style"===t.pattern.type?(0,_gfxUtils_js__WEBPACK_IMPORTED_MODULE_5__.Sp)(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function H(e,r=1){const a=e.a,o=(0,_core_colorUtils_js__WEBPACK_IMPORTED_MODULE_14__._Y)(e),n=o.h,l=o.s/r,i=100-(100-o.v)/r,{r:c,g:p,b:u}=(0,_core_colorUtils_js__WEBPACK_IMPORTED_MODULE_14__.xr)({h:n,s:l,v:i});return[c,p,u,a]}function N(e){return"water"===e.type?(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(e.color)?null:e.color:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(e.material)||(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(e.material.color)?null:e.material.color}function T(e,t=0){const s=N(e);if(!s){if("fill"===e.type)return null;const s=_gfxUtils_js__WEBPACK_IMPORTED_MODULE_5__.Ne.r,r=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.uH)(s,t);return[r,r,r,100]}const r=s.toRgba();for(let a=0;a<3;a++)r[a]=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.uH)(r[a],t);return r}async function W(t,s){const r=t.style;return"none"===r?null:{type:"pattern",x:0,y:0,src:await(0,_gfxUtils_js__WEBPACK_IMPORTED_MODULE_5__.Od)((0,_assets_js__WEBPACK_IMPORTED_MODULE_0__.V)(`esri/symbols/patterns/${r}.png`),s.toCss(!0)),width:5,height:5}}function $(e){return e.outline?q(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function B(e,t){const s=N(e);if(!s)return null;let r="rgba(";return r+=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.uH)(s.r,t)+",",r+=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.uH)(s.g,t)+",",r+=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.uH)(s.b,t)+",",r+s.a+");"}function F(e,t){const s=B(e,t);return s?"pattern"in e&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(e.pattern)&&"style"===e.pattern.type&&"none"===e.pattern.style?null:{color:s,width:Math.min(e.size?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(e.size):.75,R),style:"pattern"in e&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(e.pattern)&&"style"===e.pattern.type?(0,_gfxUtils_js__WEBPACK_IMPORTED_MODULE_5__.Sp)(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?"miter"===e.join?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(2):e.join:null}:{}}function G(e,t,s){const r=null!=s?.75*s:0;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function Q(e){const t="number"==typeof e?.size?e?.size:null;return t?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(t):null}function X(e,t){const s=Q(t),r=t?.maxSize?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(t.maxSize):null,o=t?.disableUpsampling??!1,n=e.symbolLayers,l=[];let p=0,u=0;const h=n.getItemAt(n.length-1);let m;return h&&"icon"===h.type&&(m=h.size&&(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(h.size)),n.forEach((a=>{if("icon"!==a.type&&"object"!==a.type)return;const n="icon"===a.type?a.size&&(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(a.size):0,i=s||n?Math.ceil(Math.min(s||n,r||I)):C;if(a&&a.resource&&a.resource.href){const t=function A(t,s){const r=s&&s.resource,a=r&&r.href;if(t.thumbnail&&t.thumbnail.url)return Promise.resolve(t.thumbnail.url);if(a&&"object"!==s.type)return Promise.resolve((0,_utils_js__WEBPACK_IMPORTED_MODULE_10__.nf)(t,s));const o=(0,_assets_js__WEBPACK_IMPORTED_MODULE_0__.V)("esri/images/Legend/legend3dsymboldefault.png");return t.styleOrigin&&(t.styleOrigin.styleName||t.styleOrigin.styleUrl)?(0,_webStyleSymbolUtils_js__WEBPACK_IMPORTED_MODULE_11__.resolveWebStyleSymbol)(t.styleOrigin,{portal:t.styleOrigin.portal},"webRef").catch((e=>e)).then((e=>e?.thumbnail?.url||o)):Promise.resolve(o)}(e,a).then((e=>{const t=a.get("material.color"),s=function V(e){return"icon"===e.type?"multiply":"tint"}(a);return(0,_renderUtils_js__WEBPACK_IMPORTED_MODULE_9__.r)(e,i,t,s,o)})).then((e=>{const t=e.width,s=e.height;return p=Math.max(p,t),u=Math.max(u,s),[{shape:{type:"image",x:0,y:0,width:t,height:s,src:e.url},fill:null,stroke:null}]}));l.push(t)}else{let e=i;"icon"===a.type&&m&&s&&(e=i*(n/m));const r="tall"===t?.symbolConfig||t?.symbolConfig?.isTall||"object"===a.type&&function J(e){const t=e.depth,s=e.height,r=e.width;return 0!==r&&0!==t&&0!==s&&r===t&&null!=r&&null!=s&&r<s}(a);p=Math.max(p,r?Z:e),u=Math.max(u,e),l.push(Promise.resolve(function K(e,t,s){const r=[];if(!e)return r;switch(e.type){case"icon":{const s=0,a=0,o=t,n=t;switch(e.resource&&e.resource.primitive||_IconSymbol3DLayerResource_js__WEBPACK_IMPORTED_MODULE_6__.S){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:T(e,0),stroke:q(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[s,n]},{command:"L",values:[s,a]},{command:"L",values:[o,a]},{command:"L",values:[o,n]},{command:"Z",values:[]}]},fill:T(e,0),stroke:q(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[s,n]},{command:"L",values:[.5*o,a]},{command:"L",values:[o,n]},{command:"Z",values:[]}]},fill:T(e,0),stroke:q(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*o,a]},{command:"L",values:[.5*o,n]},{command:"M",values:[s,.5*n]},{command:"L",values:[o,.5*n]}]},stroke:$(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[s,a]},{command:"L",values:[o,n]},{command:"M",values:[o,a]},{command:"L",values:[s,n]}]},stroke:$(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[s,.5*n]},{command:"L",values:[.5*o,a]},{command:"L",values:[o,.5*n]},{command:"L",values:[.5*o,n]},{command:"Z",values:[]}]},fill:T(e,0),stroke:q(e)})}break}case"object":switch(e.resource&&e.resource.primitive||_ObjectSymbol3DLayerResource_js__WEBPACK_IMPORTED_MODULE_7__.S){case"cone":{const a=G(T(e,0),T(e,-.6),s?Z:t),o=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.TE)(t,s);r.push({shape:o[0],fill:a}),r.push({shape:o[1],fill:a});break}case"inverted-cone":{const s=T(e,0),a=G(s,T(e,-.6),t),o=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.DY)(t);r.push({shape:o[0],fill:a}),r.push({shape:o[1],fill:s});break}case"cube":{const a=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.Pc)(t,s);r.push({shape:a[0],fill:T(e,0)}),r.push({shape:a[1],fill:T(e,-.3)}),r.push({shape:a[2],fill:T(e,-.5)});break}case"cylinder":{const a=G(T(e,0),T(e,-.6),s?Z:t),o=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.EB)(t,s);r.push({shape:o[0],fill:a}),r.push({shape:o[1],fill:a}),r.push({shape:o[2],fill:T(e,0)});break}case"diamond":{const s=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.XX)(t);r.push({shape:s[0],fill:T(e,-.3)}),r.push({shape:s[1],fill:T(e,0)}),r.push({shape:s[2],fill:T(e,-.3)}),r.push({shape:s[3],fill:T(e,-.7)});break}case"sphere":{const s=G(T(e,0),T(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.tp)(t);r.push({shape:s[0],fill:T(e,-.3)}),r.push({shape:s[1],fill:T(e,0)}),r.push({shape:s[2],fill:T(e,-.6)});break}}}return r}(a,e,r)))}})),(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_4__.as)(l).then((e=>{const s=[];return e.forEach((e=>{e.value?s.push(e.value):e.error&&_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__.Z.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.error)})),(0,_renderUtils_js__WEBPACK_IMPORTED_MODULE_9__.w)(s,[p,u],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}function ee(e,t){if(0===e.symbolLayers.length)return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return X(e,t);case"line-3d":return function Y(e,t){const s=e.symbolLayers,r=[],a=(0,_utils_js__WEBPACK_IMPORTED_MODULE_10__.YW)(e),n=Q(t),l=(t&&t.maxSize?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(t.maxSize):null)||R;let i,p=0,u=0;return s.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const s=[];switch(e.type){case"line":{const r=F(e,0);if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(r))break;const a=r&&r.width||0;0===t&&(i=a);const c=Math.min(n||a,l),h=0===t?c:n?c*(a/i):c,m=h>E/2?2*h:E;u=Math.max(u,h),p=Math.max(p,m),r.width=h,s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[p,.5*u]}]},stroke:r});break}case"path":{const t=Math.min(n||C,l),r=T(e,0),a=T(e,-.2),o=B(e,-.4),i=o?{color:o,width:1}:{};if("quad"===e.profile){const t=e.width,o=e.height,n=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.eb)(t&&o?t/o:1,0===o,0===t),l={...i,join:"bevel"};s.push({shape:n[0],fill:a,stroke:l}),s.push({shape:n[1],fill:a,stroke:l}),s.push({shape:n[2],fill:r,stroke:l})}else s.push({shape:_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.JZ.pathSymbol3DLayer[0],fill:a,stroke:i}),s.push({shape:_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.JZ.pathSymbol3DLayer[1],fill:r,stroke:i});u=Math.max(u,t),p=u}}r.push(s)})),Promise.resolve((0,_renderUtils_js__WEBPACK_IMPORTED_MODULE_9__.w)(r,[p,u],{node:t&&t.node,scale:a,opacity:t&&t.opacity}))}(e,t);case"polygon-3d":case"mesh-3d":return async function _(e,t){const s="mesh-3d"===e.type,r=e.symbolLayers,a=Q(t),i=t&&t.maxSize?(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_13__.F2)(t.maxSize):null,p=a||C,u=[];let h=0,m=0,f=!1;for(let c=0;c<r.length;c++){const e=r.getItemAt(c),t=[];if(s&&"fill"!==e.type)continue;const a=_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.JZ.fill[0];switch(e.type){case"fill":{const r=q(e),o=Math.min(p,i||I);h=Math.max(h,o),m=Math.max(m,o),f=!0;let n=T(e,0);const c="pattern"in e?e.pattern:null,u=N(e);!s&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(c)&&"style"===c.type&&"solid"!==c.style&&u&&(n=await W(c,u)),t.push({shape:a,fill:n,stroke:r});break}case"line":{const s=F(e,0);if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.Wi)(s))break;const r={stroke:s,shape:a};h=Math.max(h,C),m=Math.max(m,C),t.push(r);break}case"extrude":{const s={join:"round",width:1,...F(e,-.4)},r=T(e,0),a=T(e,-.2),o=Math.min(p,i||I),n=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.EV)(o);s.width=1,t.push({shape:n[0],fill:a,stroke:s}),t.push({shape:n[1],fill:a,stroke:s}),t.push({shape:n[2],fill:r,stroke:s});const l=C,c=.7*C+.5*o;h=Math.max(h,l),m=Math.max(m,c);break}case"water":{const s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.s3)(N(e)),r=H(s),a=H(s,2),o=H(s,3),l=(0,_previewUtils_js__WEBPACK_IMPORTED_MODULE_8__.ht)();f=!0,t.push({shape:l[0],fill:r}),t.push({shape:l[1],fill:a}),t.push({shape:l[2],fill:o});const c=Math.min(p,i||I);h=Math.max(h,c),m=Math.max(m,c);break}}u.push(t)}return(0,_renderUtils_js__WEBPACK_IMPORTED_MODULE_9__.w)(u,[h,m],{node:t&&t.node,scale:f,opacity:t&&t.opacity})}(e,t)}return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},"./node_modules/@arcgis/core/symbols/support/webStyleSymbolUtils.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{fetchSymbolFromStyle:()=>d,resolveWebStyleSymbol:()=>h});var _symbols_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/symbols.js"),_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/devEnvironmentUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),_portal_Portal_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/portal/Portal.js"),_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/chunks/persistableUrlUtils.js"),_jsonUtils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/jsonUtils.js"),_StyleOrigin_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/StyleOrigin.js"),_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/styleUtils.js"),_Thumbnail_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/symbols/support/Thumbnail.js");function h(t,e,r,n){return t.name?t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName?function U(t,e,r){const o=_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.wm.replace(/\{SymbolName\}/gi,t.name),l=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(e.portal)?e.portal:_portal_Portal_js__WEBPACK_IMPORTED_MODULE_4__.Z.getDefault();return(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.EJ)(o,r).then((t=>{const e=(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.KV)(t.data);return(0,_jsonUtils_js__WEBPACK_IMPORTED_MODULE_6__.im)(e,{portal:l,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.mN)((0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.Yd)(o)),origin:"portal-item"})}))}(t,e,n):(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.n2)(t,e,n).then((o=>d((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.s3)(o),t.name,e,r,n))):Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function d(l,f,g,h,d){const U=l.data,N=g&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(g.portal)?g.portal:_portal_Portal_js__WEBPACK_IMPORTED_MODULE_4__.Z.getDefault(),w={portal:N,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.mN)(l.baseUrl),origin:"portal-item"},S=U.items.find((t=>t.name===f));if(!S){const t=`The symbol name '${f}' could not be found`;return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("symbolstyleutils:symbol-name-not-found",t,{symbolName:f}))}let D=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_5__.f)((0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.v9)(S,h),w),O=S.thumbnail?.href??null;const P=S.thumbnail&&S.thumbnail.imageData;(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_1__.XO)()&&(D=(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_1__.pJ)(D)??"",O=(0,_core_devEnvironmentUtils_js__WEBPACK_IMPORTED_MODULE_1__.pJ)(O));const E={portal:N,url:(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.mN)((0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_3__.Yd)(D)),origin:"portal-item"};return(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.EJ)(D,d).then((e=>{const r="cimRef"===h?(0,_styleUtils_js__WEBPACK_IMPORTED_MODULE_8__.KV)(e.data):e.data,o=(0,_jsonUtils_js__WEBPACK_IMPORTED_MODULE_6__.im)(r,E);if(o&&(0,_symbols_js__WEBPACK_IMPORTED_MODULE_0__.dU)(o)){if(O){const t=(0,_chunks_persistableUrlUtils_js__WEBPACK_IMPORTED_MODULE_5__.f)(O,w);o.thumbnail=new _Thumbnail_js__WEBPACK_IMPORTED_MODULE_9__.p({url:t})}else P&&(o.thumbnail=new _Thumbnail_js__WEBPACK_IMPORTED_MODULE_9__.p({url:`data:image/png;base64,${P}`}));l.styleUrl?o.styleOrigin=new _StyleOrigin_js__WEBPACK_IMPORTED_MODULE_7__.Z({portal:g.portal,styleUrl:l.styleUrl,name:f}):l.styleName&&(o.styleOrigin=new _StyleOrigin_js__WEBPACK_IMPORTED_MODULE_7__.Z({portal:g.portal,styleName:l.styleName,name:f}))}return o}))}},"./node_modules/@arcgis/core/widgets/Legend.js":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Legend_w});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),cast=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/cast.js")),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),Widget=__webpack_require__("./node_modules/@arcgis/core/widgets/Widget.js"),Accessor=(__webpack_require__("./node_modules/@arcgis/core/intl.js"),__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js")),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),Color=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/Color.js")),kernel=__webpack_require__("./node_modules/@arcgis/core/kernel.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),symbols=__webpack_require__("./node_modules/@arcgis/core/symbols.js"),jsonMap=__webpack_require__("./node_modules/@arcgis/core/core/jsonMap.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),PropertyOrigin=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js"),EffectView=__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/layers/effects/jsonUtils.js"),ExportImageParameters=__webpack_require__("./node_modules/@arcgis/core/layers/support/ExportImageParameters.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),support_jsonUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/jsonUtils.js");__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/support/symbolConversion.js");function s(r){return(0,maybe.Wi)(r)||"simple"===r.type||"unique-value"===r.type||"class-breaks"===r.type||"dictionary"===r.type||"heatmap"===r.type}var SizeVariableLegendOptions=__webpack_require__("./node_modules/@arcgis/core/renderers/visualVariables/support/SizeVariableLegendOptions.js"),cimSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/cimSymbolUtils.js"),previewUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/previewUtils.js"),renderUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/renderUtils.js"),symbolUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/symbolUtils.js"),utils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/utils.js"),SizeVariable=__webpack_require__("./node_modules/@arcgis/core/renderers/visualVariables/SizeVariable.js");var colorRampUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/colorRampUtils.js"),heatmapRampUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/heatmapRampUtils.js"),gfxUtils=(__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),__webpack_require__("./node_modules/@arcgis/core/symbols/support/gfxUtils.js")),previewSymbol3D=__webpack_require__("./node_modules/@arcgis/core/symbols/support/previewSymbol3D.js");const relationshipRampUtils_s={HH:315,HL:45,LL:135,LH:225},relationshipRampUtils_l={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function relationshipRampUtils_n(t){if(!t)return;const{type:s}=t;if(s.includes("3d"))return(0,previewSymbol3D.getSymbolLayerFill)(t.symbolLayers.getItemAt(0));if("simple-line"===s){const o=(0,gfxUtils.mx)(t);return o&&o.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const o=(0,gfxUtils.mx)(t);return o&&o.color}return(0,gfxUtils._M)(t)}function H(t,e){const o=e.HH.label,r=e.LL.label,s=e.HL.label,l=e.LH.label;switch(t){case"HH":default:return{top:o,bottom:r,left:s,right:l};case"HL":return{top:s,bottom:l,left:r,right:o};case"LL":return{top:r,bottom:o,left:l,right:s};case"LH":return{top:l,bottom:s,left:o,right:r}}}function relationshipRampUtils_u(t){let e=relationshipRampUtils_s[t];return t&&null==e&&(e=relationshipRampUtils_s.HH),e||0}var numberUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/numberUtils.js"),support_utils=__webpack_require__("./node_modules/@arcgis/core/widgets/Legend/support/utils.js"),widgetUtils=__webpack_require__("./node_modules/@arcgis/core/widgets/support/widgetUtils.js"),themeUtils=__webpack_require__("./node_modules/@arcgis/core/support/themeUtils.js"),SimpleMarkerSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleMarkerSymbol.js"),SimpleLineSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleLineSymbol.js");const b=[255,255,255],h=[200,200,200],d=[128,128,128];async function k(e,l,o,s,n,a,u){const c=l.legendOptions,m=c&&c.customValues,f=u||await U(e,o),p=!!f,y=!!m,b=null!=l.minSize&&null!=l.maxSize,h=l.stops&&l.stops.length>1,d=!!l.target;if(!p||!y&&!(b||h&&!d))return;const w=(0,utils.YW)(f);let g=null,S=null,v=null;S=w&&!h?(0,numberUtils.NM)([l.minDataValue,l.maxDataValue]):m||await async function D(e,l,o,s){const n=(await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"))).getSizeRangeAtScale(e,o,s),i=n&&E(n);if(!n&&!i)return;let r=i.map((l=>function T(e,l,t){const o=t.minSize,s=t.maxSize,n=l.minDataValue,i=l.maxDataValue;let r=null;r=e<=o?n:e>=s?i:(e-o)/(s-o)*(i-n)+n;return r}(l,e,n)));r=(0,numberUtils.NM)(r);for(let t=1;t<r.length-1;t++){const n=await q(e,l,r[t],r[t-1],o,s);n&&(r[t]=n[0],i[t]=n[1])}return r}(l,f,s,n);const z=e?.authoringInfo,j="univariate-color-size"===z?.type,k=j&&"above-and-below"===z?.univariateTheme;if(!S&&h&&(S=l.stops.map((e=>e.value)),g=l.stops.some((e=>!!e.label)),"flow"===e.type&&(S=(0,numberUtils.NM)(S)),g&&(v=l.stops.map((e=>e.label)))),w&&S?.length>2&&!k&&(S=[S[0],S[S.length-1]]),!S)return null;j&&5!==S?.length&&(S=E({minSize:S[0],maxSize:S[S.length-1]}));const C=w?x(e,S):null,I=(0,utils.Y6)(f),M=g?null:function V(e,l){const t=e.length-1;return e.map(((e,o)=>(0,support_utils.MN)(e,o,t,l)))}(S,a);return(await Promise.all(S.map((async(t,o)=>{const i=w?C[o]:await B(l,f,t,s,n);return{value:t,symbol:P(k&&"class-breaks"===e.type?sizeRampUtils_L(e,o):f,i),label:g?v[o]:M[o],size:i,outlineSize:I}})))).reverse()}function x(e,l){const t=e?.authoringInfo,o="univariate-color-size"===t?.type;let s=[12,30];if(o){const e=l[0],t=l[l.length-1],o=12,n=30;s=l.map((l=>o+(l-e)/(t-e)*(n-o)))}return o&&"below"===t?.univariateTheme&&s.reverse(),s}function sizeRampUtils_L(e,l){const t=e.classBreakInfos,o=t.length,s=o<2||!(l>=2)?t[0].symbol.clone():t[o-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(s.type.includes("3d")?I(s):M(s)),s}async function U(e,l){if("flow"===e.type)return(0,support_utils.y$)(e,l);if("pie-chart"===e.type)return new SimpleMarkerSymbol.Z({color:null,outline:e.outline?.width?e.outline:new SimpleLineSymbol.Z});let t=null,o=null;if("simple"===e.type)t=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;t=l&&l[0]&&l[0].symbol,o=l.length>1}else if("unique-value"===e.type){const l=e.uniqueValueInfos;t=l&&l[0]&&l[0].symbol,o=l.length>1}return!t||function C(e){if(e)return(0,symbols.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):e.type.includes("fill");return!1}(t)?null:(t=t.clone(),(l||o)&&(t.type.includes("3d")?I(t):M(t)),t)}function I(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:d}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:h}:(e.material={color:b},e.outline={color:d,size:1.5})}))}function M(l){const t=(0,themeUtils.$o)();if("cim"===l.type)(0,cimSymbolUtils.ZB)(l,new Color.Z(h));else if(l.type.includes("line"))l.color=d;else if(l.color=t?d:b,"simple-marker"===l.type)if(l.outline){const e=l.outline?.color?.toHex();"#ffffff"===e&&(l.outline.color=d)}else l.outline={color:d,width:1.5}}function E(e){const l=e.minSize,s=(e.maxSize-l)/4,n=[];for(let i=0;i<5;i++)n.push(l+s*i);return n}async function q(e,l,n,i,r,a){const u=await B(e,l,n,r,a),c=await B(e,l,i,r,a),m=(0,numberUtils.D2)(n),f=m.fractional;let y=m.integer,b=null,h=null;n>0&&n<1&&(b=10**f,y=(0,numberUtils.D2)(n*=b).integer);for(let o=y-1;o>=0;o--){const i=10**o;let m=Math.floor(n/i)*i,f=Math.ceil(n/i)*i;null!=b&&(m/=b,f/=b);let y=(m+f)/2;[,y]=(0,numberUtils.NM)([m,y,f],{indexes:[1]});const d=await B(e,l,m,r,a),w=await B(e,l,f,r,a),g=await B(e,l,y,r,a),S=(0,numberUtils.f1)(u,d,c,null),v=(0,numberUtils.f1)(u,w,c,null),z=(0,numberUtils.f1)(u,g,c,null);let j=S.previous<=20,V=v.previous<=20;if(j&&V&&(S.previous<=v.previous?(j=!0,V=!1):(V=!0,j=!1)),j?h=[m,d]:V?h=[f,w]:z.previous<=20&&(h=[y,g]),h)break}return h}async function B(e,l,t,o,s){const{getSize:n}=await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"));return n(e,t,{scale:o,view:s,shape:"simple-marker"===l.type?l.style:null})}function P(e,t){const o=e.clone();if((0,symbols.dU)(o))(0,utils.YW)(o)||o.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function S(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(o))o.size=t;else if(function v(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(o)){const e=o.width,l=o.height;o.height=t,o.width=t*(e/l)}else!function z(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(o)?function j(e){return"esri.symbols.TextSymbol"===e.declaredClass}(o)&&o.font&&(o.font.size=t):o.width=t;return o}__webpack_require__("./node_modules/@arcgis/core/intl/date.js");var number=__webpack_require__("./node_modules/@arcgis/core/intl/number.js");__webpack_require__("./node_modules/@arcgis/core/renderers/support/utils.js");var SimpleFillSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleFillSymbol.js");const ne=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,ae=new jsonMap.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),oe={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ue=new SimpleMarkerSymbol.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),ce=new SimpleFillSymbol.Z({style:"solid"});function de(e){return"flow"===e.type}function ye(e){return"vector-field"===e.type}function he(e){return"raster-colormap"===e.type}function me(e){return"raster-stretch"===e.type}function fe(e){return"raster-shaded-relief"===e.type}function pe(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function ge(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function be(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function _e(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function ve(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function we(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ce(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Ee(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Ie(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Re(e,t){return pe(e)||ge(e)||be(e)||_e(e)||Ee(e)||Ie(e)?"2d"===t.type||s(e):me(e)||he(e)||fe(e)||ve(e)||we(e)||Ce(e)||ye(e)||de(e)}function Ve(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function je(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Pe(e){return"esri.layers.ImageryLayer"===e.declaredClass}function Me(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}const Ne=new SimpleMarkerSymbol.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let qe={},$e=class extends Accessor.Z{constructor(e){super(e),this._handles=new Handles.Z,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new Collection.Z,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([(0,reactiveUtils.on)((()=>this.children),"change",(t=>{const{added:s,removed:l}=t,r=this._handles;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add((0,reactiveUtils.YP)((()=>t.ready),e,reactiveUtils.nn),s)})),l.forEach((e=>r.remove(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(qe={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(qe=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new EffectView.AM,t.effect=e.effect,t.endTransitions(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,s=this.layer.parent,l=s&&"uid"in s?this._getParentLayerOpacity(s):null;return null!=t?t*e:null!=l?l*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(function Oe(e){return"esri.layers.FeatureLayer"===e.declaredClass}(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,s=t&&t.drawingInfo,l=s&&(0,support_jsonUtils.i)(s.renderer),r=ae.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:r}):(Logger.Z.getLogger(this.declaredClass).warn("drawingInfo not available!"),null)}return null}));try{const e=[];await(0,promiseUtils.as)(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)))})),this.legendElements=e,this.notifyChange("ready")}catch(s){Logger.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",s)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){Logger.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",t)}}async buildLegendElementsForFeatureReduction(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){Logger.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;if(function Te(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxellayer();else if(function xe(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function ze(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(function Fe(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}(e))await this._constructLegendElementsForBuildingSceneLayer();else if(je(e)||function De(e){return"esri.layers.TileLayer"===e.declaredClass}(e)||Ve(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let t="default";Pe(e)&&(t=(e?.renderingRule?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Pe(e)||Me(e)){const t=(0,reactiveUtils.YP)((()=>["renderingRule"in e&&e.renderingRule,e.bandIds]),(()=>(0,promiseUtils.Ds)((async()=>{qe.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this._handles.add(t,"imageryLayers-watcher")}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Pe(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready")}));await(0,promiseUtils.as)(s)})).catch((e=>{Logger.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(s||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,reactiveUtils.N1)((()=>!t.updating));const l=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return l.geometry=this.view.extent,0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(l):"queryFeatureCount"in e&&await e.queryFeatureCount(l))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e&&e.valueExpression;if(ne.test(t))return!0;const s="visualVariables"in e&&e.visualVariables;return!!s&&s.some((e=>this._isScaleDrivenSizeVariable(e)))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,s=t.minSize,l=t.maxSize;return"object"==typeof s&&s?this._isScaleDrivenSizeVariable(s):"object"==typeof l&&l?this._isScaleDrivenSizeVariable(l):!!t.expression||ne.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&je(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers)if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this._handles.remove("voxel-style-watcher"),this._handles.remove("voxel-current-variable");const e=this.layer;this._handles.add((0,reactiveUtils.YP)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-current-variable"),this._handles.add((0,reactiveUtils.YP)((()=>e.getVariableStyles()),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=(0,maybe.Wg)(e.getVariableStyle(null)),s=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new SimpleFillSymbol.Z({color:t.color,outline:null})})})),e.length&&s.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:l}=t.transferFunction,r=e.toArray().reverse(),i=l.map(((e,t)=>`${0===t?support_utils.zZ:support_utils.Eh} ${function utils_s(t){const i=Math.floor(Math.log10(Math.abs(t)))+1,e=i<4||i>6?4:i,a=Math.abs(t)>=1e6?"compact":"standard";return(0,number.uf)(t,{notation:a,minimumSignificantDigits:2,maximumSignificantDigits:e})}(e)}`)).reverse(),n=r.map((e=>({color:e.color,value:null,label:null})));n[0].label=i[0],n[n.length-1].label=i[1],s.push({type:"color-ramp",title:t.label,infos:n,preview:(0,symbolUtils.jT)(r.map((e=>e.color)))})}const l=e.opacity,r=s.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,l)));await(0,promiseUtils.as)(r),this.legendElements=s,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add((0,reactiveUtils.YP)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add((0,reactiveUtils.YP)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const l=e.toArray();for(const r of l){const e=(0,reactiveUtils.YP)((()=>[r.title,r.visible,r.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e&&e.infos.length&&s.unshift(e)}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let s=e.legendUrl;if(!s)return;const r={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(s=(0,urlUtils.fl)(s,t));let i=null;const n=e.layer?.opacity;try{i=(await(0,request.default)(s,{responseType:"image"})).data,i&&(i.style.opacity=n)}catch{}return r.infos.push({src:s,preview:i,opacity:n}),r}_getLegendLayers(e,t){const s=qe&&qe[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return qe[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Pe(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(s.renderingRule=JSON.stringify(e.rasterFunctionDefinition||e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:l,customParameters:r}=t;s={raster:e,viewId:l,...s,...r}}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend"}else{const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,request.default)(r,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,reactiveUtils.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Logger.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const l=e.toArray();for(const r of l){const e=(0,reactiveUtils.YP)((()=>["renderer"in r&&r.renderer,r.opacity,r.title,r.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=r&&null!=r.opacity?r.opacity:null,l=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,l);e.infos.push(...t),s=[e,...s]}else r.renderer&&(s=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...s])}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,reactiveUtils.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Logger.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,s){const l=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let i=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(i=this.sublayerIds.map((e=>l.findSublayerById(e))).filter(Boolean));for(const n of i){const e=(0,reactiveUtils.YP)((()=>[n.renderer,n.opacity,n.title,n.visible,n.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled&&this._isSublayerInScale(n)){const e=n&&null!=n.opacity?n.opacity:null,i=null!=e?e*t:t,a=!!Ve(l)||n.originIdOf("renderer")>PropertyOrigin.s3.SERVICE;if(n.renderer&&!n.sublayers&&a)await n.load(),r=[...await this._getRendererLegendElements(n.renderer,{title:n.title,opacity:i,sublayer:n}),...r];else{const e=await this._generateSymbolTableElementForSublayer(n,i,s);e&&r.unshift(e)}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,l=e.source;let r=null;if(l&&("map-layer"!==l.type||l.mapLayerId!==e.id||l.gdbVersion&&l.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>PropertyOrigin.s3.SERVICE||e.originIdOf("labelingInfo")>PropertyOrigin.s3.SERVICE||e.originIdOf("labelsVisible")>PropertyOrigin.s3.SERVICE){const e=new ExportImageParameters.R({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const i=r||`${t.uid}-default`;(await this._getLegendLayers(i,r)).forEach((e=>s.set(e.layerId,e)))}const l=s.get(e.id);if((!l||l?.subLayerIds&&l.defaultVisibility)&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return{type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const l=t?.renderer;let r=t?.title||e.layerName;if(l&&(!t||t?.originIdOf("renderer")>PropertyOrigin.s3.SERVICE)){const e=t?.title||this._getRendererTitle(l,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e)}const i={type:"symbol-table",title:r,legendType:e.legendType?e.legendType:null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups?.length>0?e.legendGroups.forEach((t=>{const l={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter((e=>e.groupId===t.id)),e.layerId,s)};l.infos?.length>0&&i.infos.push(l)})):i.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,s),i.infos.length>0?i:null}_generateSymbolTableElementInfosForLegendLayer(e,t,l){return e.map((e=>{let r=e.url;if(e.imageData&&e.imageData.length>0)r=`data:image/png;base64,${e.imageData}`;else{if(0===r.indexOf("http"))return null;r=(0,kernel.Dp)(`${this.layer.url}/${t}/images/${r}`)}return{label:e.label,src:r,opacity:l??this.opacity,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return!(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let l=null,r=null,i=!0;return!s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(l=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(l=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(l>0&&l<this.scale||r>this.scale)&&(i=!1),i}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const s=t.renderer,l=e.some((e=>e.values));let r=null,i=null;return l&&e.some(((e,t)=>(e.values||(r=t,i=e,i.label||(i.label="others")),null!=i))),s?"unique-value"===s.type?i&&(e.splice(r,1),e.push(i)):"class-breaks"===s.type&&(i&&e.splice(r,1),e.reverse(),i&&e.push(i)):i&&(e.splice(r,1),e.push(i)),e}async _getRendererLegendElements(e,t={}){if(!Re(e,this.view))return Logger.Z.getLogger(this.declaredClass).warn(`Renderer of type '${e.type}' not supported!`),[];if(function Se(e){return ve(e)||we(e)||Ce(e)||function Le(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e))return this._constructPointCloudRendererLegendElements(e,t);if(Ee(e))return this._constructDotDensityRendererLegendElements(e);const s=await this._loadRenderer(e);return Ie(s)?this._constructPieChartRendererLegendElements(s):this._constructRendererLegendElements(s,t)}async _getLegendElementsForFeatureReduction(e){let t=null;return"binning"===e.type?t=e.renderer:"cluster"===e.type&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const s=t.title,l=[];let r=null,i=null;if(ve(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(ue,e.color)})}));else if(we(e)){const t=e.stops;let l=null;if(t.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,s=t[t.length-1].value;null!=e&&null!=s&&(l=(0,colorRampUtils.QQ)(e+(s-e)/2,t))}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(ue,l||ue.color)}]};const n=(0,colorRampUtils.NA)(e.stops);i={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:n,preview:(0,symbolUtils.jT)(n.map((e=>e.color)))}}else Ce(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(ue,e.color)})})));r&&r.infos.length&&l.push(r),i&&i.infos.length&&l.push(i);const n=l.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return(0,promiseUtils.as)(n).then((()=>l))}_getElementInfoForDotDensity(e,t){const{backgroundColor:s,outline:l,dotSize:r}=e,i=this.effectList?.effects.map((e=>e.toJSON())),n=(0,jsonUtils.rM)(i),a=r+"-"+t+"-"+s+"-"+(l&&JSON.stringify(l.toJSON()))+"-"+n,o=this._dotDensityUrlCache,u=o.has(a)?o.get(a):(0,symbolUtils.k)(e,t);o.set(a,u);const c={shape:{type:"image",x:0,y:0,width:u.width,height:u.height,src:u.src},fill:null,stroke:null,offset:[0,0]},d=(0,renderUtils.w)([[c]],[u.width,u.height],{effectView:this.effectList});return{opacity:1,src:u.src,preview:d,width:u.width,height:u.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions&&e.legendOptions.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};return e.attributes.forEach((t=>{const s=this._getElementInfoForDotDensity(e,t.color);s.label=t.label||t.valueExpressionTitle||t.field,l.infos.push(s)})),Promise.resolve([l])}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,s=[],l="Others",r=e.outline;e.attributes.forEach((e=>{const t=new SimpleMarkerSymbol.Z({color:e.color,outline:r}),l=e.label||e.valueExpressionTitle||e.field;s.push({label:l,symbol:t})}));const i=s.length?[...s]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new SimpleMarkerSymbol.Z({color:e.othersCategory.color,outline:r});s.push({label:e.othersCategory.label||l,symbol:t})}if(e.defaultColor?.a){const t=new SimpleMarkerSymbol.Z({color:e.defaultColor,outline:r});s.push({label:e.defaultLabel,symbol:t})}const n=await this._getVisualVariableLegendElements(e,this.layer)||[];if(s.length){n.unshift({type:"symbol-table",title:null,infos:s});const t=i.filter((e=>e.label!==l)).map((e=>e.symbol.color)).filter(Boolean),a=(0,symbolUtils.LC)(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:r});n.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:s,preview:a})}const a=n.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await(0,promiseUtils.as)(a),n}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:l}=t,r=l||this.layer;this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const i=await this._getVisualVariableLegendElements(e,r)||[],n={type:"symbol-table",title:s||this._getRendererTitle(e,r),infos:[]};let a=null,o=!1;const c=new Set;if(de(e)&&!this._hasSizeRamp){const t=await(0,support_utils.y$)(e);n.infos.push({label:null,symbol:t})}else if(function Ue(e){return"univariate-color-size"===("authoringInfo"in e&&e?.authoringInfo)?.type}(e)){let t=s;const l=function ke(e){const t="authoringInfo"in e&&e?.authoringInfo;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",r=i.findIndex((e=>"color-ramp"===e.type)),n=-1!==r?i.splice(r,1)[0]:null,a=i.findIndex((e=>"size-ramp"===e.type)),o=-1!==a?i.splice(a,1)[0]:null,u=[];n&&(t=n.title,u.push(n)),o&&(t=o.title,u.push(o)),u.length>0&&i.push({type:l,title:t,infos:u})}else if(_e(e)){const t=(0,heatmapRampUtils.h)(e);i.push({type:"heatmap-ramp",title:s||this._getRendererTitle(e,r),infos:t,preview:(0,symbolUtils.jT)(t.map((e=>e.color)),{effectList:this.effectList})})}else if(be(e)){const t=e&&e.authoringInfo;if(t&&"relationship"===t.type){const{focus:s,numClasses:l,field1:a,field2:o}=t;if(l&&a&&o){const t=[a,o];let u=relationshipRampUtils_u(s)||0;for(const e of t){const{field:t,normalizationField:s,label:l}=e,i=l||{field:this._getFieldAlias(t,r),normField:s&&this._getFieldAlias(s,r)},a=Ne.clone();a.angle=u,n.infos.push({label:i,symbol:a}),c.add(a),u+=90}const d=function relationshipRampUtils_i(t){const{focus:e,infos:o,numClasses:r}=t,s=relationshipRampUtils_l[r],L={};o.forEach((t=>{L[t.value]={label:t.label,fill:relationshipRampUtils_n(t.symbol)}}));const i=[];for(let l=0;l<r;l++){const t=[];for(let e=0;e<r;e++){const o=L[s[l][e]];t.push(o.fill)}i.push(t)}return{type:"relationship-ramp",numClasses:r,focus:e,colors:i,labels:H(e,L),rotation:relationshipRampUtils_u(e)}}({focus:s,numClasses:l,infos:e.uniqueValueInfos});i.unshift(d)}}else if(Pe(this.layer)||Me(this.layer))e.uniqueValueInfos.forEach((e=>{e.symbol&&n.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})}));else{const{field:t,field2:s,field3:l,fieldDelimiter:i,valueExpression:a}=e,o=!(!t&&!a||!s&&!l),u=[];if(e.uniqueValueGroups.forEach((e=>{const n={type:"symbol-table",title:e.heading,infos:[]};e.classes.forEach((e=>{const{symbol:u,values:c}=e;if(u){const d=[],y=[];for(const e of c){const{value:n,value2:u,value3:c}=e,h=[],m=[];(t||a)&&(h.push(n),m.push(this._getDomainName(t,n,r))),s&&(h.push(u),m.push(this._getDomainName(s,u,r))),l&&(h.push(c),m.push(this._getDomainName(l,c,r))),d.push(o?h.join(i||""):h[0]),y.push(m.join(" - "))}const h=d.join(", ");let m=e.label;if(!m){const e=y.filter(Boolean);m=e.length?e.join(", "):h}n.infos.push({label:m,value:h,symbol:u})}})),n.infos.length&&u.push(n)})),u.length){const e=u[0];1===u.length&&"title"in e&&!e.title?n.infos.push(...e.infos):n.infos.push(...u)}}e.defaultSymbol&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),o=!0)}else if(ge(e))a=this._isUnclassedRenderer(e),(!a||!this._hasSizeRamp)&&(e.classBreakInfos.forEach((e=>{e.symbol&&n.infos.unshift({label:e.label||(a?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),a&&(n.title=null),this._updateInfosforClassedSizeRenderer(e,n.infos)),e.defaultSymbol&&!a&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),o=!0);else if(me(e))if(Me(this.layer)||function Ae(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const t=this._constructTileImageryStretchRendererElements(e);!function Be(e){return"stretch-ramp"===e.type}(t)?n.infos=t:i.push(t)}else{const t=this.layer;let s,l;e.statistics&&e.statistics.length&&(s=null!=e.statistics[0].min?e.statistics[0].min:e.statistics[0][0],l=null!=e.statistics[0].max?e.statistics[0].max:e.statistics[0][1]);let r=[];const a=(0,maybe.Wg)(t.renderingRule?await t.generateRasterInfo(t.renderingRule):t.serviceRasterInfo),o=a.keyProperties.BandProperties,c=oe[t.rasterInfo.pixelType.toLowerCase()];1===a.bandCount||t.bandIds&&1===t.bandIds.length?(s=null!=s?s:a.statistics?a.statistics[t.bandIds[0]].min:c[0],l=null!=l?l:a.statistics?a.statistics[t.bandIds[0]].max:c[1],s||l?i.push(this._getStretchLegendElements(e,{min:s,max:l})):this._getServerSideLegend()):a.bandCount>=3?o&&o.length>=a.bandCount?t.bandIds&&3===t.bandIds.length?(r=t.bandIds.map((e=>o[e].BandName)),n.infos=this._createSymbolTableElementMultiBand(r)):"lerc"===t.format?(r=[0,1,2].map((e=>o[e].BandName)),n.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():"lerc"===t.format?(r=["band1","band2","band3"],n.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():this._getServerSideLegend()}else if(he(e))e.colormapInfos.forEach((e=>{n.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(ce,e.color)})}));else if(pe(e)){let s=e.symbol;switch(t.geometryType){case"point":s="pointSymbol"in r&&r.pointSymbol;break;case"polyline":s="lineSymbol"in r&&r.lineSymbol;break;case"polygon":s="polygonSymbol"in r&&r.polygonSymbol}const l=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&l&&n.infos.push({label:e.label,symbol:s})}else if(ye(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),n.title=e.attributeField;const t=e.getClassBreakInfos();t?.length?t.forEach((e=>{n.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):n.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else fe(e)&&i.push(this._getStretchLegendElements(e,{min:0,max:255}));const y=e.defaultSymbol;!y||o||pe(e)||a&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||i.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:y}]}),n.infos.length&&i.unshift(n);const h=null==t.opacity?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in e&&e.visualVariables),f=Pe(this.layer)||Me(this.layer),p=i.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,h,{isDefault:e.symbol===y,applyScaleDrivenSize:!c.has(e.symbol),symbolConfig:{isTall:m,isSquareFill:f},effectList:c.has(e.symbol)?null:this.effectList})));return e=null,await(0,promiseUtils.as)(p),i}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){const t=this.layer,s=t.rasterInfo,l=s.bandCount||e.statistics.length;let r,i,n=[];const a=s.keyProperties&&s.keyProperties.BandProperties,o=e?.statistics?.length?e.statistics:s?.statistics;if(o)r=void 0!==o[0].min?o[0].min:o[0][0],i=o[0].max||o[0][1];else{const e=oe[t.rasterInfo.pixelType.toLowerCase()];r=e[0],i=e[1]}if(t.hasStandardTime()&&(r=t.getStandardTimeValue(r),i=t.getStandardTimeValue(i)),1===s.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:r,max:i});function u(e){const l=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return l.length<3?l.push(l[1]):l.length>3&&l.splice(3),l}return n=a&&a.length>=l?u(a):u(),this._createSymbolTableElementMultiBand(n)}_getStretchLegendElements(e,t){const s=e.colorRamp,l=(0,colorRampUtils.fD)(s,t);return{type:"stretch-ramp",title:"",infos:l,preview:(0,symbolUtils.jT)(l.map((e=>e.color)))}}_getClusterSymbol(){const e=this.layer,t="featureReduction"in e&&e.featureReduction,s=t&&"symbol"in t&&t.renderer;return s&&!0!==s?.authoringInfo?.isAutoGenerated?null:t&&"symbol"in t&&t.symbol}async _getSizeLegendElement(e,t,s,l){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await k(s,t,await(0,support_utils.jb)(s),this.scale,this.view.type,l,this._hasClusterSizeVariable?this._getClusterSymbol():null)}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach(((e,l)=>{t.push({label:{colorName:s[l],bandName:e},src:support_utils.uY[l],opacity:this.opacity??1})})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some((e=>(0,utils.YW)(e.symbol)));if(s&&l){const s=30,l=12,r=e.classBreakInfos.length,i=(s-l)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=s-i*t}))}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let l=0;l<e.length&&(!t||!s);l++){const r=e[l];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0))}return t&&s}async _getSymbolPreview(e,t,s){let l=!s?.isDefault&&null==e.size&&this._hasSizeRamp?(0,screenUtils.Wz)(previewUtils.b_.size):e.size;if(this._scaleDrivenSizeVariable&&s?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"));l=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return(0,symbolUtils.l3)(e.symbol,{size:l,opacity:t,scale:!1,symbolConfig:s?.symbolConfig,effectView:s?.effectList}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;const t="renderer"in this.layer&&this.layer.renderer,s=e.renderer?.clone()||t?.clone(),l=(0,maybe.Wg)(function clusterUtils_a(a,i){if(!a||!("visualVariables"in a)||!a.visualVariables)return null;const s=a.visualVariables.find((e=>"size"===e.type)),n=((e,l)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return l?.levels?l.levels[a]:null})(i,s);return n?new SizeVariable.Z({field:s.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}(this.layerView._effectiveRenderer,this.view));if(l&&"visualVariables"in s){const t=s.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!ne.test(e.valueExpression)));if(!t){if("clusterMinSize"in e&&"clusterMaxSize"in e){const{clusterMinSize:t,clusterMaxSize:s}=e;l.legendOptions=new SizeVariableLegendOptions.Z({showLegend:t!==s})}const t=s.visualVariables||[];s.visualVariables=t.concat([l]),this._hasClusterSizeVariable=!0}}return s}async _loadRenderer(e){const t=[],s=e.clone(),l=await(0,support_utils.jb)(s);if(ge(s)||be(s)){const e=(s.classBreakInfos||s.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,l).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,e)}return t.push(this._fetchSymbol(s.symbol||s.defaultSymbol,s.defaultSymbol?null:l).then((e=>{this._applySymbolToRenderer(s,e,pe(s))})).catch((()=>{this._applySymbolToRenderer(s,null,pe(s))}))),(0,promiseUtils.as)(t).then((()=>s))}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const s=this._webStyleSymbolCache;try{const l=await("2d"===this.view.type?e.fetchCIMSymbol({cache:s}):e.fetchSymbol({cache:s}));return this._getAppliedCloneSymbol(l,t)}catch{throw Logger.Z.getLogger(this.declaredClass).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,s){if(!e||!s)return e;const l=e.clone(),r=s&&s.toRgba();return l.type.includes("3d")?this._applyColorTo3dSymbol(l,r):"cim"===l.type?(0,cimSymbolUtils.ZB)(l,s):l.color&&(l.color=new Color.Z(r||l.color)),l}_applyColorTo3dSymbol(e,s){s&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new Color.Z(s))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,l=[],r=[],i=[];for(const c of s)"color"===c.type?l.push(c):"size"===c.type?r.push(c):"opacity"===c.type&&i.push(c);const n=[...l,...r,...i];let a,o;if(0===l.length&&ge(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];a=t&&t.symbol}if(0===l.length&&pe(e)&&(a=e.symbol),a)if(a.type.includes("3d")){const e=a.symbolLayers.getItemAt(0);"water"===e.type?(0,maybe.pC)(e.color)&&(o=e.color):(0,maybe.pC)(e.material)&&(0,maybe.pC)(e.material.color)&&(o=e.material.color)}else a.url||(o=a.color);const u=this.effectList;return(await Promise.all(n.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const l=de(e)?s.field:this._getRampTitle(s,t);let r=null;const i="getField"in t&&t.getField&&t.getField(s.field),n=i&&(0,fieldUtils.y2)(i);if("color"===s.type){const e=await(0,colorRampUtils.pO)(s,null,n);r={type:"color-ramp",title:l,infos:e,preview:(0,symbolUtils.jT)(e.map((e=>e.color)),{effectList:u})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length))}else if("size"===s.type&&"outline"!==s.target)ne.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r=await this._getSizeLegendElement(l,s,e,n),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await(0,colorRampUtils.pO)(s,o,n);r={type:"opacity-ramp",title:l,infos:e,preview:(0,symbolUtils.jT)(e.map((e=>e.color)),{effectList:u})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length))}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const l="getField"in s&&s.getField&&s.getField(e),r=l&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(l.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,r=l&&l.fieldInfos;if(r)for(const t of r)if(t.fieldName===s)return"cluster_count"===s?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let s=e.field,l=e.normalizationField,r=!1,i=!1,n=!1,a=null;s="function"==typeof s?null:s,l="function"==typeof l?null:l;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){i=!0;break}if("percent-of-total"===s.style){n=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:l&&this._getFieldAlias(l,t),ratio:r,ratioPercent:i,ratioPercentTotal:n}}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions&&s.legendOptions.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let l=s.field,r=null,i=null;if(ge(s)&&(r=s.normalizationField,i="percent-of-total"===s.normalizationType),l="function"==typeof l?null:l,r="function"==typeof r?null:r,be(s)){const{field2:e,field3:r,fieldDelimiter:i}=s;let n=l&&this._getFieldAlias(l,t);return e&&(n=`<${n}>${i}<${this._getFieldAlias(e,t)}>`,r&&(n=`${n}${i}<${this._getFieldAlias(r,t)}>`)),n}let n=null;return(l||r)&&(n={field:l&&this._getFieldAlias(l,t),normField:r&&this._getFieldAlias(r,t),normByPct:i}),n}_getFieldAlias(e,t){const s="popupTemplate"in t&&t.popupTemplate,l=s&&s.fieldInfos;let r=null;l&&l.some((t=>e===t.fieldName&&(r=t,!0)));let i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));let n=null;const a="featureReduction"in t&&t.featureReduction;a&&(!r&&"popupTemplate"in a&&a.popupTemplate&&a.popupTemplate.fieldInfos&&a.popupTemplate.fieldInfos.some((t=>e?.toLowerCase()===t.fieldName?.toLowerCase()&&(r=t,!0))),"fields"in a&&a.fields&&(n=a.fields.find((t=>t.name?.toLowerCase()===e?.toLowerCase()))));const o=r||i||n;let u=null;return o&&(u=r?.label||i?.alias||n?.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName),u}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return ge(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"children",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],$e.prototype,"effectList",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"layerView",void 0),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"legendElements",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],$e.prototype,"opacity",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"parent",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0,dependsOn:[]})],$e.prototype,"ready",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"hideLayersNotInCurrentView",void 0),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"keepCacheOnDestroy",void 0),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"respectLayerVisibility",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],$e.prototype,"scale",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"sublayerIds",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],$e.prototype,"isScaleDriven",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"title",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],$e.prototype,"version",null),(0,tslib_es6._)([(0,property.Cb)()],$e.prototype,"view",void 0),$e=(0,tslib_es6._)([(0,subclass.j)("esri.widgets.Legend.support.ActiveLayerInfo")],$e);const We=$e;var locale=__webpack_require__("./node_modules/@arcgis/core/intl/locale.js");const LegendViewModel_h_state="state",LegendViewModel_h_view="view",LegendViewModel_h_allLayerViews="all-layer-views",LegendViewModel_h_legendProperties="legend-properties",LegendViewModel_c=Collection.Z.ofType(We),LegendViewModel_L=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],_="view.groundView.layerViews",LegendViewModel_p=["view.basemapView.baseLayerViews",_,"view.layerViews","view.basemapView.referenceLayerViews"];let LegendViewModel_v=class extends Accessor.Z{constructor(e){super(e),this._handles=new Handles.Z,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new Collection.Z,this.activeLayerInfos=new LegendViewModel_c,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add((0,reactiveUtils.YP)((()=>this.view),(()=>this._viewHandles()),reactiveUtils.nn),LegendViewModel_h_view),this._handles.add((0,locale.qe)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(LegendViewModel_h_state),this.view&&this._handles.add((0,reactiveUtils.YP)((()=>this.state),(()=>this._stateHandles()),reactiveUtils.nn),LegendViewModel_h_state)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([LegendViewModel_h_allLayerViews,LegendViewModel_h_legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const i=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],i&&i.parent&&i.parent.children.remove(i)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",(e=>this._allLayerViewsChangeHandle(e))),LegendViewModel_h_allLayerViews),this._handles.add((0,reactiveUtils.YP)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),LegendViewModel_h_legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const i=[];e.forEach((r=>{if(!r.parent){const t=r.layer.parent,s=t&&"uid"in t&&this._layerViewByLayerId[t.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&e.includes(a)&&(i.push(r),r.parent=a,a.children.add(r),this._sortActiveLayerInfos(a.children))}})),e.removeMany(i);const r={};this.view.allLayerViews.forEach(((e,i)=>r[e.layer.uid]=i)),e.sort(((e,i)=>{const t=r[e.layer.uid]||0;return(r[i.layer.uid]||0)-t}))}_generateLayerViews(){const e=[];return LegendViewModel_p.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const i=!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===e||"view.basemapView.referenceLayerViews"===e),r=!this.groundLegendVisible&&e===_;return!i&&!r}_collectLayerViews(e,i){const r=t=>(t&&t.forEach((t=>{i.push(t),r(t[e])})),i);return r}_filterLayerViewsByLayerInfos(e){const i=this.layerInfos;return!i||!i.length||i.some((i=>this._hasLayerInfo(i,e)))}_hasLayerInfo(e,i){const r=this._isLayerUIDMatching(e.layer,i.layer.uid);return r&&(this._layerInfosByLayerViewId[i.uid]=e),r}_isLayerUIDMatching(e,i){return e&&(e.uid===i||this._hasLayerUID(e.layers,i))}_hasLayerUID(e,i){return e&&e.some((e=>this._isLayerUIDMatching(e,i)))}_isLayerViewSupported(e){return!!LegendViewModel_L.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,reactiveUtils.YP)((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){const i=e.layer,r=e.uid,t=this._layerInfosByLayerViewId[r];let o=this._activeLayerInfosByLayerViewId[r];if(!o){const s=t&&void 0!==t.title&&t.layer.uid===i.uid;o=new We({layer:i,layerView:e,title:s?t.title:i.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:t&&t.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=o}const l=i.parent&&"uid"in i.parent&&this._layerViewByLayerId[i.parent?.uid];if(o.parent=this._activeLayerInfosByLayerViewId[l?.uid],!this._handles.has(r)){const t=[(0,reactiveUtils.YP)((()=>i.title),(e=>this._titleHandle(e,o))),(0,reactiveUtils.YP)((()=>[i.opacity,"renderer"in i&&i.renderer,"pointSymbol"in i&&i.pointSymbol,"lineSymbol"in i&&i.lineSymbol,"polygonSymbol"in i&&i.polygonSymbol]),(()=>this._constructLegendElements(o))),(0,reactiveUtils.gx)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(o)),reactiveUtils.nn),(0,reactiveUtils.YP)((()=>e._effectiveRenderer),(()=>this._constructLegendElements(o))),(0,reactiveUtils.YP)((()=>"effect"in i&&i.effect),(()=>this._constructLegendElements(o)))];if(this.respectLayerVisibility){const r=(0,reactiveUtils.YP)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,o))),a=(0,reactiveUtils.YP)((()=>i.legendEnabled),(e=>this._legendEnabledHandle(e,o)));t.push(r,a)}this._handles.add(t,r)}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o)}_titleHandle(e,i){i.title=e,this._constructLegendElements(i)}_legendEnabledHandle(e,i){e?this._addActiveLayerInfo(i):this._removeActiveLayerInfo(i)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:i,layer:r}=e;if(this._isLayerActive(i)&&!this.activeLayerInfos.includes(e)){const i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{const i=this.layerInfos?.some((e=>e.layer.uid===r.uid));r.parent&&"uid"in r.parent&&!i?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((i=>{const r=i.layer.parent,t=r&&"uid"in r&&this._layerViewByLayerId[r?.uid],s=this._activeLayerInfosByLayerViewId[t?.uid];s&&(e.push(i),i.parent=s)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const i=e.parent;i?i.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const i=e.layer;"featureCollections"in i&&i.featureCollections?e.buildLegendElementsForFeatureCollections(i.featureCollections):"featureReduction"in i&&i.featureReduction&&"renderer"in i.featureReduction&&("binning"===i.featureReduction.type||"cluster"===i.featureReduction.type)?e.buildLegendElementsForFeatureReduction(i.featureReduction):"renderer"in i&&i.renderer&&!("sublayers"in i)?e.buildLegendElementsForRenderer(i.renderer):"url"in i&&i.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,tslib_es6._)([(0,property.Cb)({type:LegendViewModel_c})],LegendViewModel_v.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"basemapLegendVisible",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"groundLegendVisible",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"hideLayersNotInCurrentView",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"keepCacheOnDestroy",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"respectLayerVisibility",void 0),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"layerInfos",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],LegendViewModel_v.prototype,"state",null),(0,tslib_es6._)([(0,property.Cb)()],LegendViewModel_v.prototype,"view",void 0),LegendViewModel_v=(0,tslib_es6._)([(0,subclass.j)("esri.widgets.Legend.LegendViewModel")],LegendViewModel_v);const LegendViewModel_I=LegendViewModel_v;var svgUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/svgUtils.js"),jsxFactory=__webpack_require__("./node_modules/@arcgis/core/widgets/support/jsxFactory.js");const relationshipUtils_b_diamondContainer="esri-relationship-ramp--diamond__container",relationshipUtils_b_diamondLeftCol="esri-relationship-ramp--diamond__left-column",relationshipUtils_b_diamondRightCol="esri-relationship-ramp--diamond__right-column",relationshipUtils_b_diamondMidCol="esri-relationship-ramp--diamond__middle-column",relationshipUtils_b_diamondMidColLabel="esri-relationship-ramp--diamond__middle-column--label",relationshipUtils_b_diamondMidColRamp="esri-relationship-ramp--diamond__middle-column--ramp",relationshipUtils_b_squareTable="esri-relationship-ramp--square__table",relationshipUtils_b_squareTableRow="esri-relationship-ramp--square__table-row",relationshipUtils_b_squareTableCell="esri-relationship-ramp--square__table-cell",relationshipUtils_b_squareTableLabel="esri-relationship-ramp--square__table-label",relationshipUtils_b_squareTableLabelLeftBottom="esri-relationship-ramp--square__table-label--left-bottom",relationshipUtils_b_squareTableLabelRightBottom="esri-relationship-ramp--square__table-label--right-bottom",relationshipUtils_b_squareTableLabelLeftTop="esri-relationship-ramp--square__table-label--left-top",relationshipUtils_b_squareTableLabelRightTop="esri-relationship-ramp--square__table-label--right-top";function relationshipUtils_p(e,a,r,l){const{focus:t,labels:s}=e,i=!!t,o=function relationshipUtils_c(n,d,p,c,f=60){const{focus:q,numClasses:k,colors:T,rotation:_}=n,g=!!q,L=Math.sqrt(f**2+f**2)+(g?0:5),C=[],v=[],w=[],y=(f||75)/k;for(let s=0;s<k;s++){const i=s*y;for(let o=0;o<k;o++){const n=o*y,d=(0,svgUtils.jA)(T[s][o]),m=(0,svgUtils.kQ)(null),u={type:"rect",x:n,y:i,width:y,height:y};C.push((0,svgUtils.ch)(d)),v.push((0,svgUtils.vq)(u,d.fill,m,null)),w.push((0,svgUtils.A5)(u))}}const x=10,R=15,$=15,E=10;let M=null;g||(M="margin: -15px -15px -18px -15px");const S=relationshipUtils_h("left",q,d),j=relationshipUtils_h("right",q,d),B=(0,svgUtils.al)(w),H=(0,svgUtils.iL)(B,L,L,0,!1,_,!1),U=(0,svgUtils.iL)(B,L,L,0,!1,g?-45:null,!1),W={filter:(0,utils.wJ)(c),opacity:null==p?null:`${p}`};return(0,jsxFactory.u)("div",{styles:W,class:g?relationshipUtils_b_diamondMidColRamp:relationshipUtils_b_squareTableCell},(0,jsxFactory.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:L,height:L,style:M},(0,jsxFactory.u)("defs",null,(0,jsxFactory.u)("marker",{id:`${d}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,jsxFactory.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,jsxFactory.u)("marker",{id:`${d}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,jsxFactory.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),C),(0,jsxFactory.u)("g",{transform:H},v),(0,jsxFactory.u)("g",{transform:U},(0,jsxFactory.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":S.markerStart,"marker-end":S.markerEnd,x1:-x,y1:f-R,x2:-x,y2:R}),(0,jsxFactory.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":j.markerStart,"marker-end":j.markerEnd,x1:$,y1:f+E,x2:f-$,y2:f+E}))))}(e,a,r,l),p=(0,widgetUtils.dZ)();return i?(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondContainer,styles:{justifyContent:"center"}},(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondLeftCol},p?s.right:s.left),(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondMidCol},(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondMidColLabel},s.top),o,(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondMidColLabel},s.bottom)),(0,jsxFactory.u)("div",{class:relationshipUtils_b_diamondRightCol},p?s.left:s.right)):(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTable},(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableRow},(0,jsxFactory.u)("div",{class:(0,widgetUtils.Sh)(relationshipUtils_b_squareTableCell,relationshipUtils_b_squareTableLabel,relationshipUtils_b_squareTableLabelRightBottom)},p?s.top:s.left),(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableCell}),(0,jsxFactory.u)("div",{class:(0,widgetUtils.Sh)(relationshipUtils_b_squareTableCell,relationshipUtils_b_squareTableLabel,relationshipUtils_b_squareTableLabelLeftBottom)},p?s.left:s.top)),(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableRow},(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableCell}),o,(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableCell})),(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableRow},(0,jsxFactory.u)("div",{class:(0,widgetUtils.Sh)(relationshipUtils_b_squareTableCell,relationshipUtils_b_squareTableLabel,relationshipUtils_b_squareTableLabelRightTop)},p?s.right:s.bottom),(0,jsxFactory.u)("div",{class:relationshipUtils_b_squareTableCell}),(0,jsxFactory.u)("div",{class:(0,widgetUtils.Sh)(relationshipUtils_b_squareTableCell,relationshipUtils_b_squareTableLabel,relationshipUtils_b_squareTableLabelLeftTop)},p?s.bottom:s.right)))}function relationshipUtils_h(e,a,r){const l=`${r}_arrowStart`,t=`${r}_arrowEnd`,s="left"===e,i={markerStart:null,markerEnd:null};switch(a){case"HL":s?i.markerStart=`url(#${t})`:i.markerEnd=`url(#${l})`;break;case"LL":i.markerStart=`url(#${t})`;break;case"LH":s?i.markerEnd=`url(#${l})`:i.markerStart=`url(#${t})`;break;default:i.markerEnd=`url(#${l})`}return i}__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projection.js");const univariateUtils_n=(0,__webpack_require__("./node_modules/@arcgis/core/libs/maquette/projector.js").E)(),univariateUtils_c_univariateAboveAndBelowSymbol="esri-univariate-above-and-below-ramp__symbol",univariateUtils_c_colorRamp="esri-legend__color-ramp";function univariateUtils_f(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,jsxFactory.u)("svg",{height:"4",width:"10"},(0,jsxFactory.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,jsxFactory.u)("svg",{height:"10",width:"10"},(0,jsxFactory.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function univariateUtils_p(e,t="vertical"){const o=document.createElement("div");return o.style.height="20px",o.className=univariateUtils_c_univariateAboveAndBelowSymbol,null!=e&&(o.style.opacity=e.toString()),univariateUtils_n.append(o,univariateUtils_f.bind(null,t)),o}function univariateUtils_m(t,o,i="vertical",n){t.infos.forEach(((t,l)=>{if(n&&2===l)t.preview=univariateUtils_p(o,i);else{const o=(0,screenUtils.F2)(t.size)+("horizontal"===i?20:10),n="div"===t.preview.tagName.toLowerCase(),l=n?t.preview:document.createElement("div");l.className=univariateUtils_c_univariateAboveAndBelowSymbol,"horizontal"===i?l.style.width=`${o}px`:l.style.height=`${o}px`,n||l.appendChild(t.preview),t.preview=l}}))}function univariateUtils_u(t,o="classic"){const i=t.infos;return"classic"===o?((0,screenUtils.F2)(i[0].size)+10)/2:((0,screenUtils.F2)(i[0].size)-(0,screenUtils.F2)(i[i.length-1].size))/2}function univariateUtils_v(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),n=(0,symbolUtils.jT)("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return n.className=univariateUtils_c_colorRamp,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function univariateUtils_h(t,o,i,n="vertical"){let c=0;const f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p;for(let v=m;v<=u;v++)c+=i&&v===p?"horizontal"===n?10:20:(0,screenUtils.F2)(f[v].size)+("horizontal"===n?20:10);return Math.round(c)}function univariateUtils_y(t,o,i,n="vertical"){const c=univariateUtils_h(t,o,i,n),f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p,v="full"===o?f[m].size+f[u].size:"above"===o?f[m].size:f[u].size,y=i?"vertical"===n?20:10:0,d="vertical"===n?10*("full"===o?2:1):20*("full"===o?2:1);return Math.round(c-((0,screenUtils.F2)(v)/2+y/2+d/2))}function univariateUtils_d(e,t,o="vertical"){const i=e.infos;let n=i.find((({type:e})=>"size-ramp"===e)),l=i.find((({type:e})=>"color-ramp"===e));return n&&(n={...n},n.infos=[...n.infos],univariateUtils_m(n,t,o,!0)),l&&(l={...l},l.infos=[...l.infos]),"horizontal"===o&&(n?.infos.reverse(),l?.infos.reverse()),{sizeRampElement:n,colorRampElement:l}}function univariateUtils_b(e,t="vertical"){const o=e.infos;let i=o.find((({type:e})=>"size-ramp"===e)),n=o.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],univariateUtils_m(i,null,t,!1)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===t&&(i?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:i,colorRampElement:n}}var substitute=__webpack_require__("./node_modules/@arcgis/core/intl/substitute.js");function styleUtils_t(e){e.appendChild(this)}function styleUtils_r(t,r,i){if(!r)return;if("string"==typeof r||"number"==typeof r)return r;if("value"in r||"unit"in r)return(0,substitute.n)(t.dotValue,r);if("colorName"in r||"bandName"in r)return t[r.colorName]+": "+(t[r.bandName]||r.bandName);if("showCount"in r)return r.showCount?t.clusterCountTitle:null;let l=null;return function styleUtils_n(e,n){return n}(0,i)?l=r.ratioPercentTotal?"showRatioPercentTotal":r.ratioPercent?"showRatioPercent":r.ratio?"showRatio":r.normField?"showNormField":r.field?"showField":null:styleUtils_o(r,i)&&(l=r.normField?"showNormField":r.normByPct?"showNormPct":r.field?"showField":null),l?(0,substitute.n)("showField"===l?"{field}":t[l],{field:r.field,normField:r.normField}):null}function styleUtils_o(e,n){return!n}function styleUtils_i(e,n){return!!(n&&"Stretched"===n&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Heading=__webpack_require__("./node_modules/@arcgis/core/widgets/support/Heading.js"),accessibleHandler=__webpack_require__("./node_modules/@arcgis/core/widgets/support/decorators/accessibleHandler.js"),messageBundle=__webpack_require__("./node_modules/@arcgis/core/widgets/support/decorators/messageBundle.js");const R_activated="esri-legend--card__carousel-indicator--activated",R_base="esri-legend--card",R_stacked="esri-legend--stacked",R_carouselTitle="esri-legend--card__carousel-title",R_indicator="esri-legend--card__carousel-indicator",R_intervalSeparator="esri-legend--card__interval-separator",R_imageryLayerStretchedImage="esri-legend--card__imagery-layer-image--stretched",R_imageLabel="esri-legend--card__image-label",R_layerCaption="esri-legend--card__layer-caption",R_labelElement="esri-legend--card__label-element",R_layerRow="esri-legend--card__layer-row",R_labelCell="esri-legend--card__label-cell",R_message="esri-legend--card__message",R_rampLabel="esri-legend--card__ramp-label",R_section="esri-legend--card__section",R_serviceCaptionText="esri-legend--card__service-caption-text",R_serviceContent="esri-legend--card__service-content",R_service="esri-legend--card__service",R_groupLayer="esri-legend--card__group-layer",R_groupLayerChild="esri-legend--card__group-layer-child",R_symbol="esri-legend--card__symbol",R_sizeRampRow="esri-legend--card__size-ramp-row",R_symbolRow="esri-legend--card__symbol-row",R_symbolCell="esri-legend--card__symbol-cell",R_indicatorContainer="esri-legend--card__carousel-indicator-container",R_intervalSeparatorsContainer="esri-legend--card__interval-separators-container",R_relationshipLabelContainer="esri-legend--card__relationship-label-container",R_labelContainer="esri-legend--card__label-container",R_serviceCaptionContainer="esri-legend--card__service-caption-container",R_symbolContainer="esri-legend--card__symbol-container",R_sizeRampContainer="esri-legend--card__size-ramp-container",R_sizeRampPreview="esri-legend--card__size-ramp-preview",R_pieChartRampPreview="esri-legend--card__pie-chart-ramp-preview",R_sizeRampHorizontal="esri-legend__size-ramp--horizontal",R_rampLabelsContainer="esri-legend__ramp-labels",R_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info",R_univariateAboveAndBelowColorRamp="esri-univariate-above-and-below-ramp__color--card";var A;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(A||(A={}));const Card_j=window.devicePixelRatio;let Card_T=class extends Widget.Z{constructor(e,s){super(e,s),this._handles=new Handles.Z,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=A.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles((0,reactiveUtils.YP)((()=>this.activeLayerInfos),(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)})))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===A.Auto&&this.view.container.clientWidth<=768||this.layout===A.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,i=this._sectionNames.map(((e,t)=>{const i=(0,substitute.n)(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return(0,jsxFactory.u)("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(R_indicator,{[R_activated]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&s>1?(0,jsxFactory.u)("div",{class:R_indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[R_stacked]:this._hasIndicators};return(0,jsxFactory.u)("div",{class:this.classes(R_base,o)},a||(0,jsxFactory.u)("div",{class:R_message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),a=this._sectionNames;let o=null;-1!==r&&(a[r+s]?o=document.getElementById(a[r+s]):"ArrowLeft"===t?o=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(o=document.getElementById(a[0])),o&&o.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add((0,reactiveUtils.YP)((()=>e.version),(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,s){return`${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,jsxFactory.u)("div",{key:e.layer.uid,class:this.classes(R_service,R_groupLayer)},(0,jsxFactory.u)("div",{class:R_serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={[R_groupLayerChild]:!!e.parent};return(0,jsxFactory.u)("div",{key:e.layer.uid,class:this.classes(R_service,r)},(0,jsxFactory.u)("div",{class:R_serviceCaptionContainer},(0,jsxFactory.u)("div",{class:R_serviceCaptionText},e.title)),(0,jsxFactory.u)("div",{class:R_serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1,r=!1){const a="color-ramp"===e.type,o="opacity-ramp"===e.type,l="size-ramp"===e.type,n=t.layer;let d=null;if("string"==typeof e.title)d=e.title;else if(e.title){const t=e.title,s=styleUtils_r(this.messages,t,a||o);d=t.title?`${t.title} (${s})`:s}const p=this._getSectionName(n,e,s),m=this._hasIndicators&&!r?(0,jsxFactory.u)("div",null,(0,jsxFactory.u)(Heading.X6,{level:this.headingLevel,class:R_carouselTitle},t.title),(0,jsxFactory.u)(Heading.X6,{level:(0,Heading.MJ)(this.headingLevel),class:R_layerCaption},d)):d?(0,jsxFactory.u)(Heading.X6,{level:this.headingLevel,class:R_layerCaption},d):null,h=t.effectList;let y=null;if("symbol-table"===e.type){const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes&&s[0].properties.classes[R_symbolRow],t={[R_labelContainer]:!e&&!i,[R_relationshipLabelContainer]:i};y=(0,jsxFactory.u)("div",{class:this.classes(t)},s)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?y=this._renderLegendForRamp(e,n.opacity,h):l?y=this._renderSizeRamp(e,n.opacity):"pie-chart-ramp"===e.type?y=this._renderPieChartRamp(e):"relationship-ramp"===e.type?y=relationshipUtils_p(e,this.id,n.opacity,h):"univariate-above-and-below-ramp"===e.type?y=this._renderUnivariateAboveAndBelowRamp(e,n.opacity,h):"univariate-color-size-ramp"===e.type&&(y=this._renderUnivariateColorSizeRamp(e,n.opacity,h));if(!y)return null;const g=(0,jsxFactory.u)("div",{key:p,class:R_section,id:`${p}-panel`,role:"tabpanel","aria-labelledby":p,tabIndex:0},[m,y]);return r||this._sectionMap.set(p,g),g}_renderPieChartRamp(e){return(0,jsxFactory.u)("div",{class:R_pieChartRampPreview,bind:e.preview,afterCreate:styleUtils_t})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=univariateUtils_d(e,t,"horizontal");if(!i)return null;const a=univariateUtils_h(i,"full",!0,"horizontal"),o=univariateUtils_y(i,"above",!0,"horizontal"),l=univariateUtils_y(i,"below",!0,"horizontal"),c=univariateUtils_v(r,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:s}),g=univariateUtils_v(r,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:s}),_=univariateUtils_u(i,"card"),u=i.infos.map((e=>e.label)),f=u.length-1,b=u.map(((e,t)=>0===t||t===f?(0,jsxFactory.u)("div",{key:t},e):null)),S={marginTop:"3px",display:"flex"};(0,widgetUtils.dZ)(this.container)?S.marginRight=`${_}px`:S.marginLeft=`${_}px`;const z={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,jsxFactory.u)("div",{class:R_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,jsxFactory.u)("div",{class:this.classes(R_symbolContainer,R_sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,jsxFactory.u)("div",{key:t,class:R_symbol,bind:e.preview,afterCreate:styleUtils_t})))),c?(0,jsxFactory.u)("div",{class:R_univariateAboveAndBelowColorRamp,styles:S,key:"color-ramp-preview"},(0,jsxFactory.u)("div",{bind:c,afterCreate:styleUtils_t}),(0,jsxFactory.u)("div",{bind:g,afterCreate:styleUtils_t})):null,(0,jsxFactory.u)("div",{class:R_layerInfo},(0,jsxFactory.u)("div",{class:R_rampLabelsContainer,styles:z},b)))}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=univariateUtils_b(e,"horizontal");if(!i)return null;const a=univariateUtils_h(i,"full",!1,"horizontal"),l=univariateUtils_v(r,{width:univariateUtils_y(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:s}),n=univariateUtils_u(i,"card"),c=i.infos.length-1,d=i.infos.map(((e,t)=>0===t||t===c?(0,jsxFactory.u)("div",{key:t},e.label):null)),f={marginTop:"3px",display:"flex"};(0,widgetUtils.dZ)(this.container)?f.marginRight=`${n}px`:f.marginLeft=`${n}px`;const b={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,jsxFactory.u)("div",{class:R_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,jsxFactory.u)("div",{class:this.classes(R_symbolContainer,R_sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,jsxFactory.u)("div",{key:t,class:R_symbol,bind:e.preview,afterCreate:styleUtils_t})))),(0,jsxFactory.u)("div",{class:R_univariateAboveAndBelowColorRamp,styles:f,key:"color-ramp-preview"},(0,jsxFactory.u)("div",{bind:l,afterCreate:styleUtils_t})),(0,jsxFactory.u)("div",{class:R_layerInfo},(0,jsxFactory.u)("div",{class:R_rampLabelsContainer,styles:b},d)))}_renderLegendForElementInfo(e,t,s,i){const r=t.layer;if(e.type)return this._renderLegendForElement(e,t,i,!1,!0);const a=styleUtils_i(r,s);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,jsxFactory.u)("div",{key:i,bind:e.preview,afterCreate:styleUtils_t});const t={[R_symbolCell]:this._hasIndicators};return(0,jsxFactory.u)("div",{key:i,class:this.classes(R_layerRow,{[R_symbolRow]:this._hasIndicators})},(0,jsxFactory.u)("div",{class:this.classes(t),bind:e.preview,afterCreate:styleUtils_t}),(0,jsxFactory.u)("div",{class:this.classes(R_imageLabel,{[R_labelCell]:this._hasIndicators})},styleUtils_r(this.messages,e.label,!1)||""))}let s=255,a=255,o=255,n=0,c=255,d=255,p=255,m=0;const h=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(s=e.symbol.color.r,a=e.symbol.color.g,o=e.symbol.color.b,n=e.symbol.color.a*r.opacity),y&&(c=e.symbol.outline.color.r,d=e.symbol.outline.color.g,p=e.symbol.outline.color.b,m=e.symbol.outline.color.a*r.opacity);const g=e.symbol.color?.isBright??!0,u=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",f={background:h?`rgba(${s}, ${a}, ${o}, ${n})`:"none",color:g?"black":"white",textShadow:`-1px -1px 0 ${u},\n                                              1px -1px 0 ${u},\n                                              -1px 1px 0 ${u},\n                                              1px 1px 0 ${u}`,border:y?`1px solid rgba(${c}, ${d}, ${p}, ${m})`:"none",filter:(0,utils.wJ)(t.effectList)};return(0,jsxFactory.u)("div",{key:i,class:R_layerRow},(0,jsxFactory.u)("div",{class:R_labelElement,styles:f}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r,a);return(0,jsxFactory.u)("div",{key:i,class:R_layerRow},t,(0,jsxFactory.u)("div",{class:R_imageLabel},e.label||""))}}_renderImage(e,t,s){const{label:i,src:r,opacity:a}=e,o={[R_imageryLayerStretchedImage]:s,[R_symbol]:!s},l={opacity:`${null!=a?a:t.opacity}`};return(0,jsxFactory.u)("img",{alt:styleUtils_r(this.messages,i,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(o),styles:l})}_renderSizeRampLines(e){const t=e.infos,s=t[0],r=t[t.length-1],a=s.symbol,o=this._hasIndicators,l=(0,screenUtils.F2)(s.size+s.outlineSize)*Card_j,n=(0,screenUtils.F2)(r.size+r.outlineSize)*Card_j,c=o?l:l+50*Card_j,d=o?l/2+50*Card_j:l,p=function F(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===s||"cone"===s||"tetrahedron"===s}return"triangle"===e.style}}(a),m=function Card_E(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1),i=s.resource&&s.resource.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(a),h=document.createElement("canvas");h.width=c,h.height=d,h.style.width=h.width/Card_j+"px",h.style.height=h.height/Card_j+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=c/2-n/2,i=d;y.moveTo(e,t),y.lineTo(s,i);const r=c,a=0,o=c/2+n/2,l=d;y.moveTo(r,a),y.lineTo(o,l)}else{y.beginPath();const e=0,t=d/2-n/2,s=c,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,a=d/2+n/2,o=c,l=d;y.moveTo(r,a),y.lineTo(o,l)}return y.strokeStyle="#ddd",y.stroke(),(0,jsxFactory.u)("div",{bind:h,afterCreate:styleUtils_t,styles:o?{display:"flex",marginTop:`-${p?0:m?l/2:0}px`,marginBottom:`-${p?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${p?0:m?l/2:0}px`,marginLeft:`-${p?0:m?n/2:0}px`}})}_renderSizeRamp(e,t){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let a=s[0].preview,o=s[s.length-1].preview;const l=this._hasIndicators,n={"flex-direction":l?"column":"row-reverse"};a&&(a=a.cloneNode(!0),a.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:null!=t?`${t}`:""};return(0,jsxFactory.u)("div",{class:this.classes(R_layerRow,{[R_sizeRampRow]:l})},(0,jsxFactory.u)("div",{class:R_rampLabel},l?i:r),(0,jsxFactory.u)("div",{class:R_sizeRampContainer,styles:n},(0,jsxFactory.u)("div",{bind:a,afterCreate:styleUtils_t,class:R_sizeRampPreview,styles:c}),this._renderSizeRampLines(e),(0,jsxFactory.u)("div",{bind:o,afterCreate:styleUtils_t,class:R_sizeRampContainer,styles:c})),(0,jsxFactory.u)("div",{class:R_rampLabel},l?r:i))}_renderLegendForRamp(e,t,s){const i=e.infos,r="heatmap-ramp"===e.type,a=i.length-1,n=25,c=a>2&&!r?25*a:100,d=c+20,p=10,m=i.slice(0).reverse();m.forEach(((e,t)=>{e.offset=r?e.ratio:t/a}));const h=m.length-1,y=m.length%2!=0&&m[m.length/2|0],g=y&&(0,jsxFactory.u)("div",{class:R_intervalSeparatorsContainer},(0,jsxFactory.u)("div",{class:R_intervalSeparator},"|"),(0,jsxFactory.u)("div",{class:R_rampLabel},y.label)),_=i[i.length-1].label,v=i[0].label,u=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:m[0].color,stroke:{width:0}},{shape:{type:"rect",x:p,y:0,width:c,height:n},fill:{type:"linear",x1:p,y1:0,x2:c+p,y2:0,colors:m},stroke:{width:0}},{shape:{type:"path",path:`M${c+p} 0 L${d} 12.5 L${c+p} 25 Z`},fill:m[h].color,stroke:{width:0}}]],f=(0,svgUtils.KB)(u,d,n),{messages:b}=this,w={filter:(0,utils.wJ)(s),opacity:null==t?null:`${t}`};return(0,jsxFactory.u)("div",{class:R_layerRow,styles:{justifyContent:"center"}},(0,jsxFactory.u)("div",{class:R_rampLabel},r?b[_]:_),(0,jsxFactory.u)("div",{class:R_symbolContainer},(0,jsxFactory.u)("div",{styles:w},f),g),(0,jsxFactory.u)("div",{class:R_rampLabel},r?b[v]:v))}};(0,tslib_es6._)([(0,property.Cb)()],Card_T.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.Cb)()],Card_T.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.Cb)()],Card_T.prototype,"layout",void 0),(0,tslib_es6._)([(0,property.Cb)(),(0,messageBundle.H)("esri/widgets/Legend/t9n/Legend")],Card_T.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.Cb)(),(0,messageBundle.H)("esri/t9n/common")],Card_T.prototype,"messagesCommon",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Card_T.prototype,"type",void 0),(0,tslib_es6._)([(0,property.Cb)()],Card_T.prototype,"view",void 0),(0,tslib_es6._)([(0,accessibleHandler.h)()],Card_T.prototype,"_selectSection",null),Card_T=(0,tslib_es6._)([(0,subclass.j)("esri.widgets.Legend.styles.Card")],Card_T);const Card_B=Card_T,Classic_u_service="esri-legend__service",Classic_u_label="esri-legend__service-label",Classic_u_layer="esri-legend__layer",Classic_u_groupLayer="esri-legend__group-layer",Classic_u_groupLayerChild="esri-legend__group-layer-child",Classic_u_layerTable="esri-legend__layer-table",Classic_u_layerTableSizeRamp="esri-legend__layer-table--size-ramp",Classic_u_layerChildTable="esri-legend__layer-child-table",Classic_u_layerCaption="esri-legend__layer-caption",Classic_u_layerBody="esri-legend__layer-body",Classic_u_layerRow="esri-legend__layer-row",Classic_u_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info",Classic_u_imageryLayerStretchedImage="esri-legend__imagery-layer-image--stretched",Classic_u_imageryLayerInfoStretched="esri-legend__imagery-layer-info--stretched",Classic_u_symbolContainer="esri-legend__layer-cell esri-legend__layer-cell--symbols",Classic_u_symbol="esri-legend__symbol",Classic_u_rampContainer="esri-legend__ramps",Classic_u_sizeRamp="esri-legend__size-ramp",Classic_u_colorRamp="esri-legend__color-ramp",Classic_u_opacityRamp="esri-legend__opacity-ramp",Classic_u_rampLabelsContainer="esri-legend__ramp-labels",Classic_u_rampLabel="esri-legend__ramp-label",Classic_u_univariateAboveAndBelowLabel="esri-univariate-above-and-below-ramp__label",Classic_u_message="esri-legend__message",Classic_u_header="esri-widget__heading",Classic_L={display:"flex",alignItems:"flex-start"},Classic_w={marginLeft:"3px"},Classic_C={display:"table-cell",verticalAlign:"middle"};let Classic_R=class extends Widget.Z{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return(0,jsxFactory.u)("div",null,r&&r.length?r:(0,jsxFactory.u)("div",{class:Classic_u_message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`esri-legend__${e.layer.uid}-version-${e.version}`,a=e.title?(0,Heading.X6)({level:this.headingLevel,class:this.classes(Classic_u_header,Classic_u_label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,jsxFactory.u)("div",{key:l,class:this.classes(Classic_u_service,Classic_u_groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer,e.effectList))).filter((e=>!!e));if(!s.length)return null;const t={[Classic_u_groupLayerChild]:!!e.parent};return(0,jsxFactory.u)("div",{key:l,class:this.classes(Classic_u_service,t),tabIndex:0},a,(0,jsxFactory.u)("div",{class:Classic_u_layer},s))}}_renderLegendForElement(e,r,l,a){const t="color-ramp"===e.type,i="opacity-ramp"===e.type,n="size-ramp"===e.type;let o=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,r,l,n,e.legendType))).filter((e=>!!e));a.length&&(o=(0,jsxFactory.u)("div",{class:Classic_u_layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type?o=relationshipUtils_p(e,this.id,r.opacity,l):"pie-chart-ramp"===e.type?o=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,r.opacity,l):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,r.opacity,l));if(!o)return null;const p=e.title;let m=null;if("string"==typeof p)m=p;else if(p){const e=styleUtils_r(this.messages,p,t||i);m=styleUtils_o(0,t||i)&&p.title?`${p.title} (${e})`:e}const c=a?Classic_u_layerChildTable:Classic_u_layerTable,g=m?(0,jsxFactory.u)("div",{class:Classic_u_layerCaption},m):null,v={[Classic_u_layerTableSizeRamp]:n||!a};return(0,jsxFactory.u)("div",{class:this.classes(c,v)},g,o)}_renderPieChartRamp(e){return(0,jsxFactory.u)("div",{bind:e.preview,afterCreate:styleUtils_t})}_renderUnivariateAboveAndBelowRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=univariateUtils_d(e,r);if(!a)return null;const p=univariateUtils_y(a,"above",!0),d=univariateUtils_y(a,"below",!0),c=univariateUtils_v(s,{width:12,height:p,rampAlignment:"vertical",opacity:r,type:"above",effectList:l}),g=univariateUtils_v(s,{width:12,height:d,rampAlignment:"vertical",opacity:r,type:"below",effectList:l}),v=univariateUtils_u(a),b=a.infos.map((e=>e.label)),_=b.map(((e,r)=>{const l=2===r;return 0===r?(0,jsxFactory.u)("div",{key:r,class:e?c?Classic_u_univariateAboveAndBelowLabel:Classic_u_rampLabel:null},e):l?(0,jsxFactory.u)("div",null):null})),f=b.length-1,R=Math.floor(b.length/2),A=b.map(((e,r)=>r===R||r===f?(0,jsxFactory.u)("div",{key:r,class:e?c?Classic_u_univariateAboveAndBelowLabel:Classic_u_rampLabel:null},e):null)),S={display:"table-cell",verticalAlign:"middle"},I={marginTop:`${v}px`},j={height:`${p}px`},k={height:`${d}px`};return(0,jsxFactory.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:Classic_L},(0,jsxFactory.u)("div",{class:Classic_u_layerBody},a.infos.map(((e,r)=>(0,jsxFactory.u)("div",{class:this.classes(Classic_u_layerRow,Classic_u_sizeRamp)},(0,jsxFactory.u)("div",{class:Classic_u_symbol,styles:S,bind:e.preview,afterCreate:styleUtils_t}),c||r%2!=0?null:(0,jsxFactory.u)("div",{class:Classic_u_layerInfo},b[r]))))),c?(0,jsxFactory.u)("div",{styles:I,key:"color-ramp-preview"},(0,jsxFactory.u)("div",{styles:Classic_w},(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampContainer,bind:c,afterCreate:styleUtils_t})),(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampLabelsContainer,styles:j},_))),(0,jsxFactory.u)("div",{styles:Classic_w},(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampContainer,bind:g,afterCreate:styleUtils_t})),(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampLabelsContainer,styles:k},A)))):null)}_renderUnivariateColorSizeRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=univariateUtils_b(e);if(!a)return null;const t=univariateUtils_u(a),y=univariateUtils_y(a,"full",!1),c=univariateUtils_v(s,{width:12,height:y,rampAlignment:"vertical",opacity:r,type:"full",effectList:l}),g=a.infos.length-1,v=a.infos.map(((e,r)=>0===r||r===g?(0,jsxFactory.u)("div",{key:r,class:e.label?s?Classic_u_univariateAboveAndBelowLabel:Classic_u_rampLabel:null},e.label):null)),b={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${t}px`},f={height:`${y}px`};return(0,jsxFactory.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:Classic_L},(0,jsxFactory.u)("div",{class:Classic_u_layerBody},a.infos.map((e=>(0,jsxFactory.u)("div",{class:this.classes(Classic_u_layerRow,Classic_u_sizeRamp)},(0,jsxFactory.u)("div",{class:Classic_u_symbol,styles:b,bind:e.preview,afterCreate:styleUtils_t}))))),(0,jsxFactory.u)("div",{styles:_,key:"color-ramp-preview"},(0,jsxFactory.u)("div",{styles:Classic_w},(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampContainer,bind:c,afterCreate:styleUtils_t})),(0,jsxFactory.u)("div",{styles:Classic_C},(0,jsxFactory.u)("div",{class:Classic_u_rampLabelsContainer,styles:f},v)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,t="stretch-ramp"===e.type,i=e.preview,n=a?Classic_u_opacityRamp:"";i.className=`${Classic_u_colorRamp} ${n}`,null!=r&&(i.style.opacity=r.toString());const o=l.map((e=>(0,jsxFactory.u)("div",{class:e.label?Classic_u_rampLabel:null},s?this.messages[e.label]||e.label:t?this._getStretchStopLabel(e):e.label))),p={width:"24px"},d={height:i.style.height};return(0,jsxFactory.u)("div",{class:Classic_u_layerRow},(0,jsxFactory.u)("div",{class:Classic_u_symbolContainer,styles:p},(0,jsxFactory.u)("div",{class:Classic_u_rampContainer,bind:i,afterCreate:styleUtils_t})),(0,jsxFactory.u)("div",{class:Classic_u_layerInfo},(0,jsxFactory.u)("div",{class:Classic_u_rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,number.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r,l,a,s){if(e.type)return this._renderLegendForElement(e,r,l,!0);let t=null;const i=styleUtils_i(r,s);if(e.preview?t=(0,jsxFactory.u)("div",{class:Classic_u_symbol,bind:e.preview,afterCreate:styleUtils_t}):e.src&&(t=this._renderImage(e,r,i)),!t)return null;const n={[Classic_u_imageryLayerInfoStretched]:i},o={[Classic_u_imageryLayerInfoStretched]:i,[Classic_u_sizeRamp]:!i&&a};return(0,jsxFactory.u)("div",{class:Classic_u_layerRow},(0,jsxFactory.u)("div",{class:this.classes(Classic_u_symbolContainer,o)},t),(0,jsxFactory.u)("div",{class:this.classes(Classic_u_layerInfo,n)},styleUtils_r(this.messages,e.label,!1)||""))}_renderImage(e,r,l){const{label:a,src:s,opacity:t}=e,i={[Classic_u_imageryLayerStretchedImage]:l,[Classic_u_symbol]:!l},n={opacity:`${null!=t?t:r.opacity}`};return(0,jsxFactory.u)("img",{alt:styleUtils_r(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})}};(0,tslib_es6._)([(0,property.Cb)()],Classic_R.prototype,"activeLayerInfos",void 0),(0,tslib_es6._)([(0,property.Cb)()],Classic_R.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.Cb)(),(0,messageBundle.H)("esri/widgets/Legend/t9n/Legend")],Classic_R.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Classic_R.prototype,"type",void 0),Classic_R=(0,tslib_es6._)([(0,subclass.j)("esri.widgets.Legend.styles.Classic")],Classic_R);const Classic_A=Classic_R,Legend_v_base="esri-legend",Legend_v_widget="esri-widget",Legend_v_panel="esri-widget--panel",Legend_v_widgetIcon="esri-icon-layer-list";let Legend_u=class extends Widget.Z{constructor(e,s){super(e,s),this._handles=new Handles.Z,this.headingLevel=3,this.iconClass=Legend_v_widgetIcon,this.messages=null,this.style=new Classic_A,this.viewModel=new LegendViewModel_I}initialize(){this.addHandles([(0,reactiveUtils.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,reactiveUtils.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,reactiveUtils.YP)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,reactiveUtils.YP)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),reactiveUtils.nn)])}destroy(){this._handles=(0,maybe.SC)(this._handles)}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof Card_B||e instanceof Classic_A)return e;if("string"==typeof e)return"card"===e?new Card_B:new Classic_A;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Card_B:Classic_A)(t)}return new Classic_A}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return(0,jsxFactory.u)("div",{class:this.classes(Legend_v_base,Legend_v_widget,this.style instanceof Classic_A?Legend_v_panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=(0,reactiveUtils.YP)((()=>e.version),(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const s=(0,reactiveUtils.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),reactiveUtils.nn);this._handles.add(s,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"activeLayerInfos",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"basemapLegendVisible",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"groundLegendVisible",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"headingLevel",void 0),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"hideLayersNotInCurrentView",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"keepCacheOnDestroy",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"respectLayerVisibility",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"iconClass",void 0),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"label",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"layerInfos",null),(0,tslib_es6._)([(0,property.Cb)(),(0,messageBundle.H)("esri/widgets/Legend/t9n/Legend")],Legend_u.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"style",void 0),(0,tslib_es6._)([(0,cast.p)("style")],Legend_u.prototype,"castStyle",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"view",null),(0,tslib_es6._)([(0,property.Cb)()],Legend_u.prototype,"viewModel",void 0),Legend_u=(0,tslib_es6._)([(0,subclass.j)("esri.widgets.Legend")],Legend_u);const Legend_w=Legend_u}}]);