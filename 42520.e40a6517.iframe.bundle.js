"use strict";(self.webpackChunkaxux=self.webpackChunkaxux||[]).push([[42520],{"./node_modules/@arcgis/core/layers/support/sublayerUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I$:()=>n,gH:()=>o,oR:()=>e});var _core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js");function e(r,e,n){const o=e.flatten((({sublayers:r})=>r)).length;return o!==r.length||(!!r.some((r=>r.originIdOf("minScale")>n||r.originIdOf("maxScale")>n||r.originIdOf("renderer")>n||r.originIdOf("labelingInfo")>n||r.originIdOf("opacity")>n||r.originIdOf("labelsVisible")>n||r.originIdOf("source")>n))||!i(r,e))}function n(e,n,o){return!!e.some((e=>{const n=e.source;return!(!n||"map-layer"===n.type&&n.mapLayerId===e.id&&(null==n.gdbVersion||n.gdbVersion===o))||e.originIdOf("renderer")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.sT.SERVICE||e.originIdOf("labelingInfo")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.sT.SERVICE||e.originIdOf("opacity")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.sT.SERVICE||e.originIdOf("labelsVisible")>_core_accessorSupport_PropertyOrigin_js__WEBPACK_IMPORTED_MODULE_0__.sT.SERVICE}))||!i(e,n)}function i(r,e){if(!r?.length||null==e)return!0;const n=e.slice().reverse().flatten((({sublayers:r})=>r&&r.toArray().reverse())).map((r=>r.id)).toArray();if(r.length>n.length)return!1;let i=0;const o=n.length;for(const{id:t}of r){for(;i<o&&n[i]!==t;)i++;if(i>=o)return!1}return!0}function o(r){return!!r&&r.some((r=>null!=r.minScale||null!=r.layerDefinition?.minScale))}},"./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function t(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,n){return"number"==typeof t?t:t?.stops?.length?function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const o=t[r].size;"number"==typeof o&&(e+=o,n++)}return e/n}(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:r,minSize:o}=e;return(n(r,t)+n(o,t))/2}));let o=0;const s=r.length;if(0===s)return t;for(let n=0;n<s;n++)o+=r[n];const f=Math.floor(o/s);return Math.max(f,t)}function o(e){const n=e?.renderer,o=e?.event?.pointerType,s="touch"===o?9:6;if(!n)return s;const f="visualVariables"in n?r(s,n.visualVariables):s;if("simple"===n.type)return t(f,n.symbol);if("unique-value"===n.type){let e=f;return n.uniqueValueInfos?.forEach((n=>{e=t(e,n.symbol)})),e}if("class-breaks"===n.type){let e=f;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return"dot-density"===n.type||n.type,f}__webpack_require__.d(__webpack_exports__,{U:()=>o})},"./node_modules/@arcgis/core/views/2d/engine/Bitmap.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{SI:()=>b,iG:()=>w,oF:()=>f});var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),_DisplayObject_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),_ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js"),_webgl_contextUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/contextUtils.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),_webgl_Texture_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),_webgl_TextureDescriptor_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/TextureDescriptor.js");function f(t){return t&&"render"in t}function w(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.render(e.getContext("2d")),e}class b extends _DisplayObject_js__WEBPACK_IMPORTED_MODULE_4__.O{constructor(t=null,e=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){null==t&&null==this._source||(this._source=t,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}async setSourceAsync(s,i){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const r=new AbortController,h=(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.qG)();return(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ij)(i,(()=>r.abort())),(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.Ij)(r,(t=>h.reject(t))),this._uploadStatus={controller:r,resolver:h},this.source=s,h.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(t,e){t>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(t,e)}setTransform(t){const e=(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.transforms.dvs),[s,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,l=d*this.width,c=d*this.height,_=Math.PI*this.rotation/180;(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(s,a)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(l/2,c/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.r)(e,e,-_),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.h)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(-l/2,-c/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.l)(e,e,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(l,c)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.m)(this.transforms.dvs,t.displayViewMat3,e)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}async updateTexture({context:t,painter:e}){if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(t)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const i=function v(t){return f(t)?t instanceof _ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__.c?t.getRenderedRasterPixels()?.renderedRasterPixels:w(t):t}(this.source);try{if(null!=this._uploadStatus){const{controller:t,resolver:s}=this._uploadStatus,r={signal:t.signal},{width:h,height:o}=this,u=this._texture,a=e.textureUploadManager;await a.enqueueTextureUpdate({data:i,texture:u,width:h,height:o},r),s.resolve(),this._uploadStatus=null}else this._texture.setData(i);this.ready()}catch(r){(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__.Az)(r)}}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.c)()}}_createTexture(t){const e=this.immutable&&t.type===_webgl_contextUtils_js__WEBPACK_IMPORTED_MODULE_5__.cV.WEBGL2,s=new _webgl_TextureDescriptor_js__WEBPACK_IMPORTED_MODULE_8__.O;return s.internalFormat=e?_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.UV.RGBA8:_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.Id.RGBA,s.wrapMode=_webgl_enums_js__WEBPACK_IMPORTED_MODULE_6__.Qz.CLAMP_TO_EDGE,s.isImmutable=e,s.width=this._sourceWidth,s.height=this._sourceHeight,new _webgl_Texture_js__WEBPACK_IMPORTED_MODULE_7__.w(t,s)}}},"./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>o});var promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),Queue=__webpack_require__("./node_modules/@arcgis/core/core/Queue.js"),AttributeStoreView=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/AttributeStoreView.js"),TileContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),lengthUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),Technique=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/Technique.js"),utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/techniques/utils.js"),capabilities=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities.js");function n(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}class v{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=Technique.c}getSizeVVFieldStops(e){const t=this._vvSizeFieldStops;if(t)switch(t.type){case"static":return t;case"level-dependent":return t.levels[e]??(()=>{let i=1/0,s=0;for(const o in t.levels){const t=parseFloat(o),a=Math.abs(e-t);a<i&&(i=a,s=t)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const a=2**((e-s)/2),l=t.levels[s],r=new Float32Array(l.values);return r[2]*=a,r[3]*=a,{sizes:l.sizes,values:r}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){this._updateEffects(i),this._vvInfo=t,this._technique=(0,utils.O)(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,capabilities.C6)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(e){this.outsideLabelsVisible=null!=e&&e.excludedLabelsVisible}_updateVisualVariables(l,r){const o=this._vvMaterialParameters;if(o.vvOpacityEnabled=!1,o.vvSizeEnabled=!1,o.vvColorEnabled=!1,o.vvRotationEnabled=!1,!l)return;const v=l.size;if(v){if(o.vvSizeEnabled=!0,v.minMaxValue){const t=v.minMaxValue;let i,l;if((0,Utils.Ks)(t.minSize)&&(0,Utils.Ks)(t.maxSize))if((0,Utils.Ib)(t.minSize)&&(0,Utils.Ib)(t.maxSize))i=(0,screenUtils.im)(t.minSize),l=(0,screenUtils.im)(t.maxSize);else{const s=r.scale;i=(0,screenUtils.im)(n(s,t.minSize.stops)),l=(0,screenUtils.im)(n(s,t.maxSize.stops))}this.vvSizeMinMaxValue.set([t.minDataValue,t.maxDataValue,i,l])}if(v.scaleStops&&(this.vvSizeScaleStopsValue=(0,screenUtils.im)(n(r.scale,v.scaleStops.stops))),v.unitValue){const e=(0,unitUtils.k8)(r.spatialReference)/lengthUtils.s[v.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/r.resolution}v.fieldStops&&(this._vvSizeFieldStops=v.fieldStops)}const u=l.color;u&&(o.vvColorEnabled=!0,this.vvColorValues.set(u.values),this.vvColors.set(u.colors));const c=l.opacity;c&&(o.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));const h=l.rotation;h&&(o.vvRotationEnabled=!0,o.vvRotationType=h.type)}}class o extends TileContainer.c{constructor(e){super(e),this._rendererInfo=new v,this._materialItemsRequestQueue=new Queue.c,this.attributeView=new AttributeStoreView.q((()=>this.onAttributeStoreUpdate()))}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return[];const s=(0,promiseUtils.qG)();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,n=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(n).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}},"./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>l});class l{constructor(l,e,t){this.pixelBlock=l,this.extent=e,this.originalPixelBlock=t}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(l){const e=this.pixelBlock;if(null==e)return;const t=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??e});if(null==t.pixelBlock)return;t.pixelBlock.maskIsAlpha&&(t.pixelBlock.premultiplyAlpha=!0);const i=t.pixelBlock.getAsRGBA(),h=l.createImageData(t.pixelBlock.width,t.pixelBlock.height);h.data.set(i),l.putImageData(h,0,0)}getRenderedRasterPixels(){const l=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==l.pixelBlock?null:(l.pixelBlock.maskIsAlpha&&(l.pixelBlock.premultiplyAlpha=!0),{width:l.pixelBlock.width,height:l.pixelBlock.height,renderedRasterPixels:new Uint8Array(l.pixelBlock.getAsRGBA().buffer)})}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>i});var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js"),_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushInfo.js"),_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushStencil.js");const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends _WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__.c{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(r){const n=super.prepareRenderPasses(r);return n.push(r.registerRenderPass({name:"stencil",brushes:[_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_4__.c],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_1__.aM.DEBUG|_enums_js__WEBPACK_IMPORTED_MODULE_1__.aM.MAP|_enums_js__WEBPACK_IMPORTED_MODULE_1__.aM.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.c)("esri-tiles-debug")&&n.push(r.registerRenderPass({name:"tileInfo",brushes:[_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_3__.c],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_1__.aM.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let r=1;for(const s of this.children)s.stencilRef=r++}}},"./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>i});var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),FeatureContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),vec2f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),vec3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js");const v=Math.PI/180;class b extends DisplayObject.O{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,mat3f32.c)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,maybe.yI)(this._program)}doRender(t){const{context:e}=t,r=this._getBounds();if(r.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,r),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(enums.w$.ONE,enums.w$.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const s=this._program;e.bindVAO(this._vao),e.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(enums.Uf.LINES,8*r.length,enums.Ck.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{dvs:(0,mat3f32.c)()}}_createShaderProgram(t){if(this._program)return;this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",y().attributes)}_updateMatricesAndLocalOrigin(t){const{state:a}=t,{displayMat3:u,size:c,resolution:_,pixelRatio:h,rotation:m,viewpoint:d}=a,p=v*m,{x:g,y:x}=d.targetGeometry,b=(0,normalizeUtils.Se)(g,a.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const y=h*c[0],B=h*c[1],M=_*y,j=_*B,A=(0,mat3.g)(this._dvsMat3);(0,mat3.m)(A,A,u),(0,mat3.h)(A,A,(0,vec2f32.f)(y/2,B/2)),(0,mat3.c)(A,A,(0,vec3f32.f)(c[0]/M,-B/j,1)),(0,mat3.r)(A,A,-p)}_updateBufferData(t,e){const{x:r,y:s}=this._localOrigin,i=8*e.length,o=new Float32Array(i),a=new Uint32Array(8*e.length);let n=0,f=0;for(const l of e)l&&(o[2*n]=l[0]-r,o[2*n+1]=l[1]-s,o[2*n+2]=l[0]-r,o[2*n+3]=l[3]-s,o[2*n+4]=l[2]-r,o[2*n+5]=l[3]-s,o[2*n+6]=l[2]-r,o[2*n+7]=l[1]-s,a[f]=n+0,a[f+1]=n+3,a[f+2]=n+3,a[f+3]=n+2,a[f+4]=n+2,a[f+5]=n+1,a[f+6]=n+1,a[f+7]=n+0,n+=4,f+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=BufferObject.g.createVertex(t,enums._m.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=BufferObject.g.createIndex(t,enums._m.DYNAMIC_DRAW,a),!this._vao){const e=y();this._vao=new VertexArrayObject._(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const y=()=>(0,Utils.EV)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:enums.Ck.FLOAT}]});let i=class extends FeatureContainer.O{constructor(e){super(e),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,maybe.mG)(this._boundsRenderer)}enableRenderingBounds(e){this._boundsRenderer=new b(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(const r of this.children)r.isReady&&r.hasData&&(r.commit(e),e.context.setStencilFunction(enums.et.EQUAL,r.stencilRef,255),r.getDisplayList().replay(e,r,t))}}},"./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>a});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js"),_webgl_enums_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js");let o=class extends _BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_8__.c{get hasHighlight(){return this.children.some((r=>r.hasData))}renderChildren(r){if(r.drawPhase!==_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_7__.aM.HIGHLIGHT)return;if(this.attributeView.update(),!this.children.some((r=>r.hasData)))return;this.attributeView.bindTextures(r.context),super.renderChildren(r);const{painter:e}=r,s=e.effects.highlight;s.bind(r),r.context.setColorMask(!0,!0,!0,!0),r.context.clear(_webgl_enums_js__WEBPACK_IMPORTED_MODULE_9__.sl.COLOR_BUFFER_BIT),this._renderChildren(r,s.defines.concat(["highlightAll"])),s.draw(r),s.unbind()}};o=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.c)("esri.views.2d.layers.support.HighlightGraphicContainer")],o);const a=o},"./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>a});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"));const a=a=>{let c=class extends a{initialize(){this.addHandles((0,_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_3__.on)((()=>this.layer),"refresh",(r=>{this.doRefresh(r.dataChanged).catch((r=>{(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__.mA)(r)||_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.c.getLogger(this).error(r)}))})),"RefreshableLayerView")}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.qq)()],c.prototype,"layer",void 0),c=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.c)("esri.layers.mixins.RefreshableLayerView")],c),c}},"./node_modules/@arcgis/core/views/layers/support/MapServiceLayerViewHelper.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y8:()=>G,gB:()=>S});var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),handleUtils=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),MapUtils=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),ensureType=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),scaleUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/scaleUtils.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),floorFilterUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/floorFilterUtils.js"),clickToleranceUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),utils=__webpack_require__("./node_modules/@arcgis/core/rest/utils.js"),sql=__webpack_require__("./node_modules/@arcgis/core/core/sql.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),sublayerUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/sublayerUtils.js");function o(e){const{mapExtent:r,floors:n,width:l,sublayers:o,layerIds:p,layerOption:f,gdbVersion:m}=e,y=o?.find((e=>null!=e.layer))?.layer?.serviceSublayers,u="popup"===f,c={},d=(0,scaleUtils.c1)({extent:r,width:l,spatialReference:r?.spatialReference}),g=[],x=e=>{const r=0===d,t=0===e.minScale||d<=e.minScale,n=0===e.maxScale||d>=e.maxScale;if(e.visible&&(r||t&&n))if(e.sublayers)e.sublayers.forEach(x);else{if(!1===p?.includes(e.id)||u&&(!e.popupTemplate||!e.popupEnabled))return;g.unshift(e)}};if(o?.forEach(x),o&&!g.length)c.layerIds=[];else{const e=(0,sublayerUtils.I$)(g,y,m),r=g.map((e=>{const r=(0,floorFilterUtils.O)(n,e);return e.toExportImageJSON(r)}));if(e)c.dynamicLayers=JSON.stringify(r);else{if(o){let e=g.map((({id:e})=>e));p&&(e=e.filter((e=>p.includes(e)))),c.layerIds=e}else p?.length&&(c.layerIds=p);const e=function a(r,t){const n=!!r?.length,s=t.filter((e=>null!=e.definitionExpression||n&&null!=e.floorInfo));return s.length?s.map((t=>{const n=(0,floorFilterUtils.O)(r,t),s=(0,sql._)(n,t.definitionExpression);return{id:t.id,definitionExpression:s??void 0}})):null}(n,g);if(null!=e&&e.length){const r={};for(const t of e)t.definitionExpression&&(r[t.id]=t.definitionExpression);Object.keys(r).length&&(c.layerDefs=JSON.stringify(r))}}}return c}var m,geometry=__webpack_require__("./node_modules/@arcgis/core/geometry.js"),TimeExtent=__webpack_require__("./node_modules/@arcgis/core/TimeExtent.js"),JSONSupport=__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js"),SpatialReference=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js");let IdentifyParameters_a=m=class extends JSONSupport.am{static from(t){return(0,ensureType.uY)(m,t)}constructor(t){super(t),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"dpi",void 0),(0,tslib_es6._)([(0,property.qq)()],IdentifyParameters_a.prototype,"floors",void 0),(0,tslib_es6._)([(0,property.qq)({type:String,json:{write:!0}})],IdentifyParameters_a.prototype,"gdbVersion",void 0),(0,tslib_es6._)([(0,property.qq)({types:geometry.Su,json:{read:jsonUtils.h4,write:!0}})],IdentifyParameters_a.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"geometryPrecision",void 0),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"height",void 0),(0,tslib_es6._)([(0,property.qq)({type:[Number],json:{write:!0}})],IdentifyParameters_a.prototype,"layerIds",void 0),(0,tslib_es6._)([(0,property.qq)({type:["top","visible","all","popup"],json:{write:!0}})],IdentifyParameters_a.prototype,"layerOption",void 0),(0,tslib_es6._)([(0,property.qq)({type:Extent.c,json:{write:!0}})],IdentifyParameters_a.prototype,"mapExtent",void 0),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"maxAllowableOffset",void 0),(0,tslib_es6._)([(0,property.qq)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnFieldName",void 0),(0,tslib_es6._)([(0,property.qq)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnGeometry",void 0),(0,tslib_es6._)([(0,property.qq)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnM",void 0),(0,tslib_es6._)([(0,property.qq)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnUnformattedValues",void 0),(0,tslib_es6._)([(0,property.qq)({type:Boolean,json:{write:!0}})],IdentifyParameters_a.prototype,"returnZ",void 0),(0,tslib_es6._)([(0,property.qq)({type:SpatialReference.c,json:{write:!0}})],IdentifyParameters_a.prototype,"spatialReference",void 0),(0,tslib_es6._)([(0,property.qq)()],IdentifyParameters_a.prototype,"sublayers",void 0),(0,tslib_es6._)([(0,property.qq)({type:TimeExtent.c,json:{write:!0}})],IdentifyParameters_a.prototype,"timeExtent",void 0),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"tolerance",void 0),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],IdentifyParameters_a.prototype,"width",void 0),IdentifyParameters_a=m=(0,tslib_es6._)([(0,subclass.c)("esri.rest.support.IdentifyParameters")],IdentifyParameters_a);const IdentifyParameters_u=IdentifyParameters_a;var reader=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/reader.js"),writer=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/writer.js"),typeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/typeUtils.js");let u=class extends JSONSupport.am{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,t){return Graphic.c.fromJSON({attributes:{...t.attributes},geometry:{...t.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:t,geometry:o}=r;t&&(e.attributes={...t}),null!=o&&(e.geometry=o.toJSON(),e.geometryType=typeUtils.j.toJSON(o.type))}};(0,tslib_es6._)([(0,property.qq)({type:String,json:{write:!0}})],u.prototype,"displayFieldName",void 0),(0,tslib_es6._)([(0,property.qq)({type:Graphic.c})],u.prototype,"feature",void 0),(0,tslib_es6._)([(0,reader.E)("feature",["attributes","geometry"])],u.prototype,"readFeature",null),(0,tslib_es6._)([(0,writer.G)("feature")],u.prototype,"writeFeature",null),(0,tslib_es6._)([(0,property.qq)({type:Number,json:{write:!0}})],u.prototype,"layerId",void 0),(0,tslib_es6._)([(0,property.qq)({type:String,json:{write:!0}})],u.prototype,"layerName",void 0),u=(0,tslib_es6._)([(0,subclass.c)("esri.rest.support.IdentifyResult")],u);const IdentifyResult_m=u;async function f(u,i,f){const c=(i=function identify_a(r){return IdentifyParameters_u.from(r)}(i)).geometry?[i.geometry]:[],l=(0,utils.UX)(u);return l.path+="/identify",(0,normalizeUtils.WW)(c).then((e=>{const t=function identify_l(e,t){const{dpi:i,gdbVersion:s,geometry:l,geometryPrecision:a,height:p,layerOption:f,mapExtent:m,maxAllowableOffset:y,returnFieldName:u,returnGeometry:c,returnUnformattedValues:d,returnZ:g,spatialReference:x,timeExtent:b,tolerance:h,width:E}=e.toJSON(),{dynamicLayers:O,layerDefs:S,layerIds:j}=o(e),N=null!=t?.geometry?t.geometry:null,$={geometryPrecision:a,maxAllowableOffset:y,returnFieldName:u,returnGeometry:c,returnUnformattedValues:d,returnZ:g,tolerance:h},I=N&&N.toJSON()||l;$.imageDisplay=`${E},${p},${i}`,s&&($.gdbVersion=s),I&&(delete I.spatialReference,$.geometry=JSON.stringify(I),$.geometryType=(0,jsonUtils.Ce)(I));const R=x??I?.spatialReference??m?.spatialReference;if(R&&($.sr=(0,spatialReferenceUtils.um)(R)),$.time=b?[b.start,b.end].join(","):null,m){const{xmin:e,ymin:r,xmax:t,ymax:n}=m;$.mapExtent=`${e},${r},${t},${n}`}return S&&($.layerDefs=S),O&&!S&&($.dynamicLayers=O),$.layers="popup"===f?"visible":f,j&&!O&&($.layers+=`:${j.join(",")}`),$}(i,{geometry:e?.[0]}),u=(0,utils.OW)({...l.query,f:"json",...t}),a=(0,utils.sR)(u,f);return(0,request.c)(l.path,a).then(identify_m).then((r=>function p(r,e){if(!e?.length)return r;const t=new Map;function o(r){t.set(r.id,r),r.sublayers&&r.sublayers.forEach(o)}e.forEach(o);for(const s of r.results)s.feature.sourceLayer=t.get(s.layerId);return r}(r,i.sublayers)))}))}function identify_m(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=Boolean(e.exceededTransferLimit),e.results=e.results.map((r=>IdentifyResult_m.fromJSON(r))),e}var arcadeOnDemand=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),SimpleMarkerSymbol=__webpack_require__("./node_modules/@arcgis/core/symbols/SimpleMarkerSymbol.js"),popupUtils=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js");let P=null;function S(e,t){return"tile"===t.type||"map-image"===t.type}let G=class extends Accessor.c{constructor(e){super(e),this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,promiseUtils.Cu)((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){const e=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,reactiveUtils.on)((()=>this.highlightGraphics),"change",(t=>e(t.added)),{onListenerAdd:t=>e(t)})])}async fetchPopupFeatures(e,t){const{layerView:{layer:r,view:{scale:s}}}=this;if(!e)throw new Error.c("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:r});const i=function U(e,t,r){const s=[];if(!e)return s;const i=e=>{const o=0===e.minScale||t<=e.minScale,a=0===e.maxScale||t>=e.maxScale;if(e.visible&&o&&a)if(e.sublayers)e.sublayers.forEach(i);else if(e.popupEnabled){const t=(0,popupUtils.M$)(e,{...r,defaultPopupTemplateEnabled:!1});null!=t&&s.unshift({sublayer:e,popupTemplate:t})}};return e.map(i),s}(r.sublayers,s,t);if(!i.length)return[];const a=await async function R(e,t){if(e.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(t.map((({sublayer:e})=>e.load().then((()=>e.capabilities.operations.supportsQuery)))))}catch{return!1}}(r,i);if(!((r.capabilities?.operations?.supportsIdentify??1)&&r.version>=10.5||a))throw new Error.c("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:r});return a?this._fetchPopupFeaturesUsingQueries(e,i,t):this._fetchPopupFeaturesUsingIdentify(e,i,t)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(e){const r=this.highlightGraphics;if(!r)return(0,handleUtils.uU)();let o=null;if(e instanceof Graphic.c?o=[e]:Collection.c.isCollection(e)&&e.length>0?o=e.toArray():Array.isArray(e)&&e.length>0&&(o=e),o=o?.filter(arrayUtils.G6),!o?.length)return(0,handleUtils.uU)();for(const t of o){const e=t.sourceLayer;null!=e&&"geometryType"in e&&"point"===e.geometryType&&(t.visible=!1)}return r.addMany(o),(0,handleUtils.uU)((()=>r.removeMany(o??[])))}async _updateHighlightedFeaturesSymbols(e){const{layerView:{view:t},highlightGraphics:r,highlightGraphicUpdated:s}=this;if(r&&s)for(const i of e){const e=i.sourceLayer&&"renderer"in i.sourceLayer&&i.sourceLayer.renderer;i.sourceLayer&&"geometryType"in i.sourceLayer&&"point"===i.sourceLayer.geometryType&&e&&"getSymbolAsync"in e&&e.getSymbolAsync(i).then((async o=>{o||=new SimpleMarkerSymbol.c;let a=null;const n="visualVariables"in e?e.visualVariables?.find((e=>"size"===e.type)):void 0;n&&(P||(P=(await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"))).getSize),a=P(n,i,{view:t.type,scale:t.scale,shape:"simple-marker"===o.type?o.style:null})),a||="width"in o&&"height"in o&&null!=o.width&&null!=o.height?Math.max(o.width,o.height):"size"in o?o.size:16,r.includes(i)&&(i.symbol=new SimpleMarkerSymbol.c({style:"square",size:a,xoffset:"xoffset"in o?o.xoffset:0,yoffset:"yoffset"in o?o.yoffset:0}),s(i,"symbol"),i.visible=!0)}))}}async _updateHighlightedFeaturesGeometries(e){const{layerView:{layer:t,view:r},highlightGraphics:s,highlightGraphicUpdated:i}=this;if(this._highlightGeometriesResolution=e,!i||!s?.length||!t.capabilities.operations.supportsQuery)return;const o=this._getTargetResolution(e),a=new Map;for(const c of s)if(!this._featuresResolutions.has(c)||this._featuresResolutions.get(c)>o){const e=c.sourceLayer;(0,MapUtils.wJ)(a,e,(()=>new Map)).set(c.getObjectId(),c)}const l=Array.from(a,(([e,t])=>{const s=e.createQuery();return s.objectIds=[...t.keys()],s.outFields=[e.objectIdField],s.returnGeometry=!0,s.maxAllowableOffset=o,s.outSpatialReference=r.spatialReference,e.queryFeatures(s)})),p=await Promise.all(l);if(!this.destroyed)for(const{features:n}of p)for(const e of n){const t=e.sourceLayer,r=a.get(t).get(e.getObjectId());r&&s.includes(r)&&(r.geometry=e.geometry,i(r,"geometry"),this._featuresResolutions.set(r,o))}}_getTargetResolution(e){const t=e*(0,unitUtils.k8)(this.layerView.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t,r){const s=await this._createIdentifyParameters(e,t,r);if(null==s)return[];const{results:i}=await f(this.layerView.layer.parsedUrl,s);return i.map((e=>e.feature))}async _createIdentifyParameters(e,t,r){const{floors:s,layer:i,timeExtent:o,view:{spatialReference:a,scale:n}}=this.layerView,l=null!=r?r.event:null;if(!t.length)return null;await Promise.all(t.map((({sublayer:e})=>e.load().catch((()=>{})))));const p=Math.min((0,has.c)("mapservice-popup-identify-max-tolerance"),i.allSublayers.reduce(((e,t)=>t.renderer?(0,clickToleranceUtils.U)({renderer:t.renderer,event:l}):e),2)),c=this.createFetchPopupFeaturesQueryGeometry(e,p),u=(0,scaleUtils.u6)(n,a),h=Math.round(c.width/u),f=new Extent.c({xmin:c.center.x-u*h,ymin:c.center.y-u*h,xmax:c.center.x+u*h,ymax:c.center.y+u*h,spatialReference:c.spatialReference});return new IdentifyParameters_u({floors:s,gdbVersion:"gdbVersion"in i?i.gdbVersion:void 0,geometry:e,height:h,layerOption:"popup",mapExtent:f,returnGeometry:!0,spatialReference:a,sublayers:i.sublayers,timeExtent:o,tolerance:p,width:h})}async _fetchPopupFeaturesUsingQueries(e,t,r){const{layerView:{floors:i,timeExtent:o}}=this,a=null!=r?r.event:null,n=t.map((async({sublayer:t,popupTemplate:r})=>{if(await t.load().catch((()=>{})),t.capabilities&&!t.capabilities.operations.supportsQuery)return[];const s=t.createQuery(),n=(0,clickToleranceUtils.U)({renderer:t.renderer,event:a}),l=this.createFetchPopupFeaturesQueryGeometry(e,n),p=new Set,[c]=await Promise.all([(0,popupUtils.W_)(t,r),t.renderer?.collectRequiredFields(p,t.fieldsIndex)]);(0,fieldUtils.OC)(p,t.fieldsIndex,c);const u=Array.from(p).sort();if(s.geometry=l,s.outFields=u,s.timeExtent=o,i){const e=i.clone(),r=(0,floorFilterUtils.O)(e,t);null!=r&&(s.where=s.where?`(${s.where}) AND (${r})`:r)}const h=this._getTargetResolution(l.width/n),y=await function _(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,arcadeOnDemand.uK)():Promise.resolve()}(r),m="point"===t.geometryType||y&&y.arcadeUtils.hasGeometryOperations(r);m||(s.maxAllowableOffset=h);let{features:w}=await t.queryFeatures(s);const b=m?0:h;w=await async function A(e,t){const r=e.renderer;return r&&"defaultSymbol"in r&&!r.defaultSymbol&&(t=r.valueExpression?await Promise.all(t.map((e=>r.getSymbolAsync(e).then((t=>t?e:null))))).then((e=>e.filter((e=>null!=e)))):t.filter((e=>null!=r.getSymbol(e)))),t}(t,w);for(const e of w)this._featuresResolutions.set(e,b);return w}));return(await Promise.allSettled(n)).reduce(((e,t)=>"fulfilled"===t.status?[...e,...t.value]:e),[]).filter(arrayUtils.G6)}};(0,tslib_es6._)([(0,property.qq)({constructOnly:!0})],G.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,tslib_es6._)([(0,property.qq)({constructOnly:!0})],G.prototype,"layerView",void 0),(0,tslib_es6._)([(0,property.qq)({constructOnly:!0})],G.prototype,"highlightGraphics",void 0),(0,tslib_es6._)([(0,property.qq)({constructOnly:!0})],G.prototype,"highlightGraphicUpdated",void 0),(0,tslib_es6._)([(0,property.qq)({constructOnly:!0})],G.prototype,"updatingHandles",void 0),G=(0,tslib_es6._)([(0,subclass.c)("esri.views.layers.support.MapService")],G)},"./node_modules/@arcgis/core/views/layers/support/popupUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M$:()=>p,W_:()=>n,uC:()=>u});var _layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");async function n(n,p=n.popupTemplate){if(null==p)return[];const u=await p.getRequiredFields(n.fieldsIndex),{lastEditInfoEnabled:t}=p,{objectIdField:d,typeIdField:s,globalIdField:i,relationships:a}=n;if(u.includes("*"))return["*"];const o=t?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.tm)(n):[],f=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.OO)(n.fieldsIndex,[...u,...o]);return s&&f.push(s),f&&d&&n.fieldsIndex?.has(d)&&!f.includes(d)&&f.push(d),f&&i&&n.fieldsIndex?.has(i)&&!f.includes(i)&&f.push(i),a&&a.forEach((e=>{const{keyField:l}=e;f&&l&&n.fieldsIndex?.has(l)&&!f.includes(l)&&f.push(l)})),f}function p(e,l){return e.popupTemplate?e.popupTemplate:null!=l&&l.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function u(e,l){return null!=p(e,{defaultPopupTemplateEnabled:l})}},"./node_modules/@arcgis/core/views/support/drapedUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>r,s:()=>i});__webpack_require__("./node_modules/@arcgis/core/geometry.js");var _core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js"),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");function r(t,r,i,a=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__.c){let o=0;if("2d"===i.type)o=r*(i.resolution??0);else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(t),a=i.basemapSpatialReference;o=null==a||a.equals(i.spatialReference)?r*n:(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.k8)(a)/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_1__.k8)(i.spatialReference)}const s=t.x-o,l=t.y-o,m=t.x+o,p=t.y+o,{spatialReference:c}=i;return a.xmin=Math.min(s,m),a.ymin=Math.min(l,p),a.xmax=Math.max(s,m),a.ymax=Math.max(l,p),a.spatialReference=c,a}function i(e,n,i){const o=i.toMap(e);return null!=o&&r(o,(0,_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_3__.U)(),i,a).intersects(n)}const a=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_2__.c}}]);